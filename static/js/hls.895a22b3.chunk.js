(self.webpackChunk_web_index=self.webpackChunk_web_index||[]).push([[817],{8174:function($i){typeof window!="undefined"&&function(ri,Cr){$i.exports=Cr()}(this,()=>(()=>{var ri={21:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>ie});var Te=function(){function q(V,z){this.subtle=void 0,this.aesIV=void 0,this.subtle=V,this.aesIV=z}return q.prototype.decrypt=function(V,z){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},z,V)},q}(),$=function(){function q(V,z){this.subtle=void 0,this.key=void 0,this.subtle=V,this.key=z}return q.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},q}(),U=Q(145),c=function(){function q(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var V=q.prototype;return V.uint8ArrayToUint32Array_=function(z){for(var ue=new DataView(z),de=new Uint32Array(4),te=0;te<4;te++)de[te]=ue.getUint32(4*te);return de},V.initTable=function(){var z=this.sBox,ue=this.invSBox,de=this.subMix,te=de[0],se=de[1],oe=de[2],Ae=de[3],be=this.invSubMix,Oe=be[0],P=be[1],k=be[2],W=be[3],K=new Uint32Array(256),Re=0,Ie=0,we=0;for(we=0;we<256;we++)K[we]=we<128?we<<1:we<<1^283;for(we=0;we<256;we++){var B=Ie^Ie<<1^Ie<<2^Ie<<3^Ie<<4;B=B>>>8^255&B^99,z[Re]=B,ue[B]=Re;var le=K[Re],ee=K[le],he=K[ee],G=257*K[B]^16843008*B;te[Re]=G<<24|G>>>8,se[Re]=G<<16|G>>>16,oe[Re]=G<<8|G>>>24,Ae[Re]=G,G=16843009*he^65537*ee^257*le^16843008*Re,Oe[B]=G<<24|G>>>8,P[B]=G<<16|G>>>16,k[B]=G<<8|G>>>24,W[B]=G,Re?(Re=le^K[K[K[he^le]]],Ie^=K[K[Ie]]):Re=Ie=1}},V.expandKey=function(z){for(var ue=this.uint8ArrayToUint32Array_(z),de=!0,te=0;te<ue.length&&de;)de=ue[te]===this.key[te],te++;if(!de){this.key=ue;var se=this.keySize=ue.length;if(se!==4&&se!==6&&se!==8)throw new Error("Invalid aes key size="+se);var oe,Ae,be,Oe,P=this.ksRows=4*(se+6+1),k=this.keySchedule=new Uint32Array(P),W=this.invKeySchedule=new Uint32Array(P),K=this.sBox,Re=this.rcon,Ie=this.invSubMix,we=Ie[0],B=Ie[1],le=Ie[2],ee=Ie[3];for(oe=0;oe<P;oe++)oe<se?be=k[oe]=ue[oe]:(Oe=be,oe%se==0?(Oe=K[(Oe=Oe<<8|Oe>>>24)>>>24]<<24|K[Oe>>>16&255]<<16|K[Oe>>>8&255]<<8|K[255&Oe],Oe^=Re[oe/se|0]<<24):se>6&&oe%se==4&&(Oe=K[Oe>>>24]<<24|K[Oe>>>16&255]<<16|K[Oe>>>8&255]<<8|K[255&Oe]),k[oe]=be=(k[oe-se]^Oe)>>>0);for(Ae=0;Ae<P;Ae++)oe=P-Ae,Oe=3&Ae?k[oe]:k[oe-4],W[Ae]=Ae<4||oe<=4?Oe:we[K[Oe>>>24]]^B[K[Oe>>>16&255]]^le[K[Oe>>>8&255]]^ee[K[255&Oe]],W[Ae]=W[Ae]>>>0}},V.networkToHostOrderSwap=function(z){return z<<24|(65280&z)<<8|(16711680&z)>>8|z>>>24},V.decrypt=function(z,ue,de){for(var te,se,oe,Ae,be,Oe,P,k,W,K,Re,Ie,we,B,le=this.keySize+6,ee=this.invKeySchedule,he=this.invSBox,G=this.invSubMix,xe=G[0],Ge=G[1],qe=G[2],it=G[3],ye=this.uint8ArrayToUint32Array_(de),Ze=ye[0],st=ye[1],Et=ye[2],lt=ye[3],vt=new Int32Array(z),St=new Int32Array(vt.length),gt=this.networkToHostOrderSwap;ue<vt.length;){for(W=gt(vt[ue]),K=gt(vt[ue+1]),Re=gt(vt[ue+2]),Ie=gt(vt[ue+3]),be=W^ee[0],Oe=Ie^ee[1],P=Re^ee[2],k=K^ee[3],we=4,B=1;B<le;B++)te=xe[be>>>24]^Ge[Oe>>16&255]^qe[P>>8&255]^it[255&k]^ee[we],se=xe[Oe>>>24]^Ge[P>>16&255]^qe[k>>8&255]^it[255&be]^ee[we+1],oe=xe[P>>>24]^Ge[k>>16&255]^qe[be>>8&255]^it[255&Oe]^ee[we+2],Ae=xe[k>>>24]^Ge[be>>16&255]^qe[Oe>>8&255]^it[255&P]^ee[we+3],be=te,Oe=se,P=oe,k=Ae,we+=4;te=he[be>>>24]<<24^he[Oe>>16&255]<<16^he[P>>8&255]<<8^he[255&k]^ee[we],se=he[Oe>>>24]<<24^he[P>>16&255]<<16^he[k>>8&255]<<8^he[255&be]^ee[we+1],oe=he[P>>>24]<<24^he[k>>16&255]<<16^he[be>>8&255]<<8^he[255&Oe]^ee[we+2],Ae=he[k>>>24]<<24^he[be>>16&255]<<16^he[Oe>>8&255]<<8^he[255&P]^ee[we+3],St[ue]=gt(te^Ze),St[ue+1]=gt(Ae^st),St[ue+2]=gt(oe^Et),St[ue+3]=gt(se^lt),Ze=W,st=K,Et=Re,lt=Ie,ue+=4}return St.buffer},q}(),M=Q(93),_=Q(63),ie=function(){function q(z,ue,de){var te=(de===void 0?{}:de).removePKCS7Padding,se=te===void 0||te;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=z,this.config=ue,this.removePKCS7Padding=se,se)try{var oe=self.crypto;oe&&(this.subtle=oe.subtle||oe.webkitSubtle)}catch(Ae){}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var V=q.prototype;return V.destroy=function(){this.observer=null},V.isSync=function(){return this.config.enableSoftwareAES},V.flush=function(){var z=this.currentResult;if(z){var ue,de,te,se=new Uint8Array(z);return this.reset(),this.removePKCS7Padding?(te=(de=(ue=se).byteLength)&&new DataView(ue.buffer).getUint8(de-1))?(0,U.sliceUint8)(ue,0,de-te):ue:se}this.reset()},V.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},V.decrypt=function(z,ue,de,te){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(z),ue,de);var se=this.flush();se&&te(se.buffer)}else this.webCryptoDecrypt(new Uint8Array(z),ue,de).then(te)},V.softwareDecrypt=function(z,ue,de){var te=this.currentIV,se=this.currentResult,oe=this.remainderData;this.logOnce("JS AES decrypt"),oe&&(z=(0,_.appendUint8Array)(oe,z),this.remainderData=null);var Ae=this.getValidChunk(z);if(!Ae.length)return null;te&&(de=te);var be=this.softwareDecrypter;be||(be=this.softwareDecrypter=new c),be.expandKey(ue);var Oe=se;return this.currentResult=be.decrypt(Ae.buffer,0,de),this.currentIV=(0,U.sliceUint8)(Ae,-16).buffer,Oe||null},V.webCryptoDecrypt=function(z,ue,de){var te=this,se=this.subtle;return this.key===ue&&this.fastAesKey||(this.key=ue,this.fastAesKey=new $(se,ue)),this.fastAesKey.expandKey().then(function(oe){return se?new Te(se,de).decrypt(z.buffer,oe):Promise.reject(new Error("web crypto not initialized"))}).catch(function(oe){return te.onWebCryptoError(oe,z,ue,de)})},V.onWebCryptoError=function(z,ue,de,te){return M.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",z),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(ue,de,te)},V.getValidChunk=function(z){var ue=z,de=z.length-z.length%16;return de!==z.length&&(ue=(0,U.sliceUint8)(z,0,de),this.remainderData=(0,U.sliceUint8)(z,de)),ue},V.logOnce=function(z){this.logEnabled&&(M.logger.log("[decrypter.ts]: "+z),this.logEnabled=!1)},q}()},181:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{canParse:()=>_,decodeFrame:()=>ue,getID3Data:()=>c,getID3Frames:()=>z,getTimeStamp:()=>ie,isFooter:()=>U,isHeader:()=>$,isTimeStampFrame:()=>q,testables:()=>be,utf8ArrayToStr:()=>Ae});var Te,$=function(P,k){return k+10<=P.length&&P[k]===73&&P[k+1]===68&&P[k+2]===51&&P[k+3]<255&&P[k+4]<255&&P[k+6]<128&&P[k+7]<128&&P[k+8]<128&&P[k+9]<128},U=function(P,k){return k+10<=P.length&&P[k]===51&&P[k+1]===68&&P[k+2]===73&&P[k+3]<255&&P[k+4]<255&&P[k+6]<128&&P[k+7]<128&&P[k+8]<128&&P[k+9]<128},c=function(P,k){for(var W=k,K=0;$(P,k);)K+=10,K+=M(P,k+6),U(P,k+10)&&(K+=10),k+=K;if(K>0)return P.subarray(W,W+K)},M=function(P,k){var W=0;return W=(127&P[k])<<21,W|=(127&P[k+1])<<14,(W|=(127&P[k+2])<<7)|127&P[k+3]},_=function(P,k){return $(P,k)&&M(P,k+6)+10<=P.length-k},ie=function(P){for(var k=z(P),W=0;W<k.length;W++){var K=k[W];if(q(K))return oe(K)}},q=function(P){return P&&P.key==="PRIV"&&P.info==="com.apple.streaming.transportStreamTimestamp"},V=function(P){var k=String.fromCharCode(P[0],P[1],P[2],P[3]),W=M(P,4);return{type:k,size:W,data:P.subarray(10,10+W)}},z=function(P){for(var k=0,W=[];$(P,k);){for(var K=M(P,k+6),Re=(k+=10)+K;k+8<Re;){var Ie=V(P.subarray(k)),we=ue(Ie);we&&W.push(we),k+=Ie.size+10}U(P,k)&&(k+=10)}return W},ue=function(P){return P.type==="PRIV"?de(P):P.type[0]==="W"?se(P):te(P)},de=function(P){if(!(P.size<2)){var k=Ae(P.data,!0),W=new Uint8Array(P.data.subarray(k.length+1));return{key:P.type,info:k,data:W.buffer}}},te=function(P){if(!(P.size<2)){if(P.type==="TXXX"){var k=1,W=Ae(P.data.subarray(k),!0);k+=W.length+1;var K=Ae(P.data.subarray(k));return{key:P.type,info:W,data:K}}var Re=Ae(P.data.subarray(1));return{key:P.type,data:Re}}},se=function(P){if(P.type==="WXXX"){if(P.size<2)return;var k=1,W=Ae(P.data.subarray(k),!0);k+=W.length+1;var K=Ae(P.data.subarray(k));return{key:P.type,info:W,data:K}}var Re=Ae(P.data);return{key:P.type,data:Re}},oe=function(P){if(P.data.byteLength===8){var k=new Uint8Array(P.data),W=1&k[3],K=(k[4]<<23)+(k[5]<<15)+(k[6]<<7)+k[7];return K/=45,W&&(K+=4772185884e-2),Math.round(K)}},Ae=function(P,k){k===void 0&&(k=!1);var W=Oe();if(W){var K=W.decode(P);if(k){var Re=K.indexOf("\0");return Re!==-1?K.substring(0,Re):K}return K.replace(/\0/g,"")}for(var Ie,we,B,le=P.length,ee="",he=0;he<le;){if((Ie=P[he++])===0&&k)return ee;if(Ie!==0&&Ie!==3)switch(Ie>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ee+=String.fromCharCode(Ie);break;case 12:case 13:we=P[he++],ee+=String.fromCharCode((31&Ie)<<6|63&we);break;case 14:we=P[he++],B=P[he++],ee+=String.fromCharCode((15&Ie)<<12|(63&we)<<6|(63&B)<<0)}}return ee},be={decodeTextFrame:te};function Oe(){return Te||self.TextDecoder===void 0||(Te=new self.TextDecoder("utf-8")),Te}},182:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>M});var Te=Q(764),$=Q(851),U=Q(93),c=Q(729);function M(V){var z=new c.EventEmitter,ue=function(de,te){V.postMessage({event:de,data:te})};z.on($.Events.FRAG_DECRYPTED,ue),z.on($.Events.ERROR,ue),V.addEventListener("message",function(de){var te=de.data;switch(te.cmd){case"init":var se=JSON.parse(te.config);V.transmuxer=new Te.default(z,te.typeSupported,se,te.vendor,te.id),(0,U.enableLogs)(se.debug,te.id),function(){var Oe=function(k){U.logger[k]=function(W){ue("workerLog",{logType:k,message:W})}};for(var P in U.logger)Oe(P)}(),ue("init",null);break;case"configure":V.transmuxer.configure(te.config);break;case"demux":var oe=V.transmuxer.push(te.data,te.decryptdata,te.chunkMeta,te.state);(0,Te.isPromise)(oe)?oe.then(function(Oe){_(V,Oe)}):_(V,oe);break;case"flush":var Ae=te.chunkMeta,be=V.transmuxer.flush(Ae);(0,Te.isPromise)(be)?be.then(function(Oe){q(V,Oe,Ae)}):q(V,be,Ae)}})}function _(V,z){if(!((ue=z.remuxResult).audio||ue.video||ue.text||ue.id3||ue.initSegment))return!1;var ue,de=[],te=z.remuxResult,se=te.audio,oe=te.video;return se&&ie(de,se),oe&&ie(de,oe),V.postMessage({event:"transmuxComplete",data:z},de),!0}function ie(V,z){z.data1&&V.push(z.data1.buffer),z.data2&&V.push(z.data2.buffer)}function q(V,z,ue){z.reduce(function(de,te){return _(V,te)||de},!1)||V.postMessage({event:"transmuxComplete",data:z[0]}),V.postMessage({event:"flush",data:ue})}},764:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{TransmuxConfig:()=>pt,TransmuxState:()=>ct,default:()=>ze,isPromise:()=>rt});var Te=Q(851),$=Q(973),U=Q(21),c=Q(965),M=Q(181),_=Q(856);function ie(R,I){return R===void 0&&(R=""),I===void 0&&(I=9e4),{type:R,id:-1,pid:-1,inputTimeScale:I,sequenceNumber:-1,samples:[],dropped:0}}var q=Q(63),V=Q(145),z=function(){function R(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var I=R.prototype;return I.resetInitSegment=function(S,C,O,Y){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},I.resetTimeStamp=function(S){this.initPTS=S,this.resetContiguity()},I.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},I.canParse=function(S,C){return!1},I.appendFrame=function(S,C,O){},I.demux=function(S,C){this.cachedData&&(S=(0,q.appendUint8Array)(this.cachedData,S),this.cachedData=null);var O,Y=M.getID3Data(S,0),j=Y?Y.length:0,Z=this._audioTrack,De=this._id3Track,pe=Y?M.getTimeStamp(Y):void 0,ke=S.length;for((this.basePTS===null||this.frameIndex===0&&(0,c.isFiniteNumber)(pe))&&(this.basePTS=ue(pe,C,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),Y&&Y.length>0&&De.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:Y,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});j<ke;){if(this.canParse(S,j)){var Fe=this.appendFrame(Z,S,j);Fe?(this.frameIndex++,this.lastPTS=Fe.sample.pts,O=j+=Fe.length):j=ke}else M.canParse(S,j)?(Y=M.getID3Data(S,j),De.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:Y,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),O=j+=Y.length):j++;if(j===ke&&O!==ke){var Qe=(0,V.sliceUint8)(S,O);this.cachedData?this.cachedData=(0,q.appendUint8Array)(this.cachedData,Qe):this.cachedData=Qe}}return{audioTrack:Z,videoTrack:ie(),id3Track:De,textTrack:ie()}},I.demuxSampleAes=function(S,C,O){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},I.flush=function(S){var C=this.cachedData;return C&&(this.cachedData=null,this.demux(C,0)),{audioTrack:this._audioTrack,videoTrack:ie(),id3Track:this._id3Track,textTrack:ie()}},I.destroy=function(){},R}(),ue=function(R,I,S){return(0,c.isFiniteNumber)(R)?90*R:9e4*I+(S||0)};const de=z;var te=Q(93);function se(R,I){return R[I]===255&&(246&R[I+1])==240}function oe(R,I){return 1&R[I+1]?7:9}function Ae(R,I){return(3&R[I+3])<<11|R[I+4]<<3|(224&R[I+5])>>>5}function be(R,I){return I+1<R.length&&se(R,I)}function Oe(R,I){if(be(R,I)){var S=oe(R,I);if(I+S>=R.length)return!1;var C=Ae(R,I);if(C<=S)return!1;var O=I+C;return O===R.length||be(R,O)}return!1}function P(R,I,S,C,O){if(!R.samplerate){var Y=function(j,Z,De,pe){var ke,Fe,Qe,$e,Ye=navigator.userAgent.toLowerCase(),ot=pe,Tt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ke=1+((192&Z[De+2])>>>6);var dt=(60&Z[De+2])>>>2;if(!(dt>Tt.length-1))return Qe=(1&Z[De+2])<<2,Qe|=(192&Z[De+3])>>>6,te.logger.log("manifest codec:"+pe+", ADTS type:"+ke+", samplingIndex:"+dt),/firefox/i.test(Ye)?dt>=6?(ke=5,$e=new Array(4),Fe=dt-3):(ke=2,$e=new Array(2),Fe=dt):Ye.indexOf("android")!==-1?(ke=2,$e=new Array(2),Fe=dt):(ke=5,$e=new Array(4),pe&&(pe.indexOf("mp4a.40.29")!==-1||pe.indexOf("mp4a.40.5")!==-1)||!pe&&dt>=6?Fe=dt-3:((pe&&pe.indexOf("mp4a.40.2")!==-1&&(dt>=6&&Qe===1||/vivaldi/i.test(Ye))||!pe&&Qe===1)&&(ke=2,$e=new Array(2)),Fe=dt)),$e[0]=ke<<3,$e[0]|=(14&dt)>>1,$e[1]|=(1&dt)<<7,$e[1]|=Qe<<3,ke===5&&($e[1]|=(14&Fe)>>1,$e[2]=(1&Fe)<<7,$e[2]|=8,$e[3]=0),{config:$e,samplerate:Tt[dt],channelCount:Qe,codec:"mp4a.40."+ke,manifestCodec:ot};j.trigger(Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+dt})}(I,S,C,O);if(!Y)return;R.config=Y.config,R.samplerate=Y.samplerate,R.channelCount=Y.channelCount,R.codec=Y.codec,R.manifestCodec=Y.manifestCodec,te.logger.log("parsed codec:"+R.codec+", rate:"+Y.samplerate+", channels:"+Y.channelCount)}}function k(R){return 9216e4/R}function W(R,I,S,C,O){var Y,j=C+O*k(R.samplerate),Z=function(Ye,ot){var Tt=oe(Ye,ot);if(ot+Tt<=Ye.length){var dt=Ae(Ye,ot)-Tt;if(dt>0)return{headerLength:Tt,frameLength:dt}}}(I,S);if(Z){var De=Z.frameLength,pe=Z.headerLength,ke=pe+De,Fe=Math.max(0,S+ke-I.length);Fe?(Y=new Uint8Array(ke-pe)).set(I.subarray(S+pe,I.length),0):Y=I.subarray(S+pe,S+ke);var Qe={unit:Y,pts:j};return Fe||R.samples.push(Qe),{sample:Qe,length:ke,missing:Fe}}var $e=I.length-S;return(Y=new Uint8Array($e)).set(I.subarray(S,I.length),0),{sample:{unit:Y,pts:j},length:$e,missing:-1}}function K(R,I){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,C){return S.__proto__=C,S},K(R,I)}const Re=function(R){var I,S;function C(Y,j){var Z;return(Z=R.call(this)||this).observer=void 0,Z.config=void 0,Z.observer=Y,Z.config=j,Z}S=R,(I=C).prototype=Object.create(S.prototype),I.prototype.constructor=I,K(I,S);var O=C.prototype;return O.resetInitSegment=function(Y,j,Z,De){R.prototype.resetInitSegment.call(this,Y,j,Z,De),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:j,duration:De,inputTimeScale:9e4,dropped:0}},C.probe=function(Y){if(!Y)return!1;for(var j=(M.getID3Data(Y,0)||[]).length,Z=Y.length;j<Z;j++)if(Oe(Y,j))return te.logger.log("ADTS sync word found !"),!0;return!1},O.canParse=function(Y,j){return function(Z,De){return function(pe,ke){return ke+5<pe.length}(Z,De)&&se(Z,De)&&Ae(Z,De)<=Z.length-De}(Y,j)},O.appendFrame=function(Y,j,Z){P(Y,this.observer,j,Z,Y.manifestCodec);var De=W(Y,j,Z,this.basePTS,this.frameIndex);if(De&&De.missing===0)return De},C}(de);var Ie=/\/emsg[-/]ID3/i;const we=function(){function R(S,C){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=C}var I=R.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(S,C,O,Y){var j=(0,q.parseInitSegment)(S),Z=this.videoTrack=ie("video",1),De=this.audioTrack=ie("audio",1),pe=this.txtTrack=ie("text",1);if(this.id3Track=ie("id3",1),this.timeOffset=0,j.video){var ke=j.video,Fe=ke.id,Qe=ke.timescale,$e=ke.codec;Z.id=Fe,Z.timescale=pe.timescale=Qe,Z.codec=$e}if(j.audio){var Ye=j.audio,ot=Ye.id,Tt=Ye.timescale,dt=Ye.codec;De.id=ot,De.timescale=Tt,De.codec=dt}pe.id=q.RemuxerTrackIdConfig.text,Z.sampleDuration=0,Z.duration=De.duration=Y},I.resetContiguity=function(){},R.probe=function(S){return S=S.length>16384?S.subarray(0,16384):S,(0,q.findBox)(S,["moof"]).length>0},I.demux=function(S,C){this.timeOffset=C;var O=S,Y=this.videoTrack,j=this.txtTrack;if(this.config.progressive){this.remainderData&&(O=(0,q.appendUint8Array)(this.remainderData,S));var Z=(0,q.segmentValidRange)(O);this.remainderData=Z.remainder,Y.samples=Z.valid||new Uint8Array}else Y.samples=O;var De=this.extractID3Track(Y,C);return j.samples=(0,q.parseSamples)(C,Y),{videoTrack:Y,audioTrack:this.audioTrack,id3Track:De,textTrack:this.txtTrack}},I.flush=function(){var S=this.timeOffset,C=this.videoTrack,O=this.txtTrack;C.samples=this.remainderData||new Uint8Array,this.remainderData=null;var Y=this.extractID3Track(C,this.timeOffset);return O.samples=(0,q.parseSamples)(S,C),{videoTrack:C,audioTrack:ie(),id3Track:Y,textTrack:ie()}},I.extractID3Track=function(S,C){var O=this.id3Track;if(S.samples.length){var Y=(0,q.findBox)(S.samples,["emsg"]);Y&&Y.forEach(function(j){var Z=(0,q.parseEmsg)(j);if(Ie.test(Z.schemeIdUri)){var De=(0,c.isFiniteNumber)(Z.presentationTime)?Z.presentationTime/Z.timeScale:C+Z.presentationTimeDelta/Z.timeScale,pe=Z.eventDuration===4294967295?Number.POSITIVE_INFINITY:Z.eventDuration/Z.timeScale;pe<=.001&&(pe=Number.POSITIVE_INFINITY);var ke=Z.payload;O.samples.push({data:ke,len:ke.byteLength,dts:De,pts:De,type:_.MetadataSchema.emsg,duration:pe})}})}return O},I.demuxSampleAes=function(S,C,O){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},R}();var B=null,le=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ee=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],he=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],G=[0,1,1,4];function xe(R,I,S,C,O){if(!(S+24>I.length)){var Y=Ge(I,S);if(Y&&S+Y.frameLength<=I.length){var j=C+O*(9e4*Y.samplesPerFrame/Y.sampleRate),Z={unit:I.subarray(S,S+Y.frameLength),pts:j,dts:j};return R.config=[],R.channelCount=Y.channelCount,R.samplerate=Y.sampleRate,R.samples.push(Z),{sample:Z,length:Y.frameLength,missing:0}}}}function Ge(R,I){var S=R[I+1]>>3&3,C=R[I+1]>>1&3,O=R[I+2]>>4&15,Y=R[I+2]>>2&3;if(S!==1&&O!==0&&O!==15&&Y!==3){var j=R[I+2]>>1&1,Z=R[I+3]>>6,De=1e3*le[14*(S===3?3-C:C===3?3:4)+O-1],pe=ee[3*(S===3?0:S===2?1:2)+Y],ke=Z===3?1:2,Fe=he[S][C],Qe=G[C],$e=8*Fe*Qe,Ye=Math.floor(Fe*De/pe+j)*Qe;if(B===null){var ot=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);B=ot?parseInt(ot[1]):0}return!!B&&B<=87&&C===2&&De>=224e3&&Z===0&&(R[I+3]=128|R[I+3]),{sampleRate:pe,channelCount:ke,frameLength:Ye,samplesPerFrame:$e}}}function qe(R,I){return R[I]===255&&(224&R[I+1])==224&&(6&R[I+1])!=0}function it(R,I){return I+1<R.length&&qe(R,I)}function ye(R,I){if(I+1<R.length&&qe(R,I)){var S=Ge(R,I),C=4;S!=null&&S.frameLength&&(C=S.frameLength);var O=I+C;return O===R.length||it(R,O)}return!1}const Ze=function(){function R(S){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=S,this.bytesAvailable=S.byteLength,this.word=0,this.bitsAvailable=0}var I=R.prototype;return I.loadWord=function(){var S=this.data,C=this.bytesAvailable,O=S.byteLength-C,Y=new Uint8Array(4),j=Math.min(4,C);if(j===0)throw new Error("no bytes available");Y.set(S.subarray(O,O+j)),this.word=new DataView(Y.buffer).getUint32(0),this.bitsAvailable=8*j,this.bytesAvailable-=j},I.skipBits=function(S){var C;this.bitsAvailable>S?(this.word<<=S,this.bitsAvailable-=S):(S-=this.bitsAvailable,S-=(C=S>>3)>>3,this.bytesAvailable-=C,this.loadWord(),this.word<<=S,this.bitsAvailable-=S)},I.readBits=function(S){var C=Math.min(this.bitsAvailable,S),O=this.word>>>32-C;return S>32&&te.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0?this.word<<=C:this.bytesAvailable>0&&this.loadWord(),(C=S-C)>0&&this.bitsAvailable?O<<C|this.readBits(C):O},I.skipLZ=function(){var S;for(S=0;S<this.bitsAvailable;++S)if((this.word&2147483648>>>S)!=0)return this.word<<=S,this.bitsAvailable-=S,S;return this.loadWord(),S+this.skipLZ()},I.skipUEG=function(){this.skipBits(1+this.skipLZ())},I.skipEG=function(){this.skipBits(1+this.skipLZ())},I.readUEG=function(){var S=this.skipLZ();return this.readBits(S+1)-1},I.readEG=function(){var S=this.readUEG();return 1&S?1+S>>>1:-1*(S>>>1)},I.readBoolean=function(){return this.readBits(1)===1},I.readUByte=function(){return this.readBits(8)},I.readUShort=function(){return this.readBits(16)},I.readUInt=function(){return this.readBits(32)},I.skipScalingList=function(S){for(var C=8,O=8,Y=0;Y<S;Y++)O!==0&&(O=(C+this.readEG()+256)%256),C=O===0?C:O},I.readSPS=function(){var S,C,O,Y=0,j=0,Z=0,De=0,pe=this.readUByte.bind(this),ke=this.readBits.bind(this),Fe=this.readUEG.bind(this),Qe=this.readBoolean.bind(this),$e=this.skipBits.bind(this),Ye=this.skipEG.bind(this),ot=this.skipUEG.bind(this),Tt=this.skipScalingList.bind(this);pe();var dt=pe();if(ke(5),$e(3),pe(),ot(),dt===100||dt===110||dt===122||dt===244||dt===44||dt===83||dt===86||dt===118||dt===128){var Ft=Fe();if(Ft===3&&$e(1),ot(),ot(),$e(1),Qe())for(C=Ft!==3?8:12,O=0;O<C;O++)Qe()&&Tt(O<6?16:64)}ot();var Qt=Fe();if(Qt===0)Fe();else if(Qt===1)for($e(1),Ye(),Ye(),S=Fe(),O=0;O<S;O++)Ye();ot(),$e(1);var Pt=Fe(),mt=Fe(),Vt=ke(1);Vt===0&&$e(1),$e(1),Qe()&&(Y=Fe(),j=Fe(),Z=Fe(),De=Fe());var bt=[1,1];if(Qe()&&Qe())switch(pe()){case 1:bt=[1,1];break;case 2:bt=[12,11];break;case 3:bt=[10,11];break;case 4:bt=[16,11];break;case 5:bt=[40,33];break;case 6:bt=[24,11];break;case 7:bt=[20,11];break;case 8:bt=[32,11];break;case 9:bt=[80,33];break;case 10:bt=[18,11];break;case 11:bt=[15,11];break;case 12:bt=[64,33];break;case 13:bt=[160,99];break;case 14:bt=[4,3];break;case 15:bt=[3,2];break;case 16:bt=[2,1];break;case 255:bt=[pe()<<8|pe(),pe()<<8|pe()]}return{width:Math.ceil(16*(Pt+1)-2*Y-2*j),height:(2-Vt)*(mt+1)*16-(Vt?2:4)*(Z+De),pixelRatio:bt}},I.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},R}(),st=function(){function R(S,C,O){this.keyData=void 0,this.decrypter=void 0,this.keyData=O,this.decrypter=new U.default(S,C,{removePKCS7Padding:!1})}var I=R.prototype;return I.decryptBuffer=function(S,C){this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer,C)},I.decryptAacSample=function(S,C,O,Y){var j=S[C].unit;if(!(j.length<=16)){var Z=j.subarray(16,j.length-j.length%16),De=Z.buffer.slice(Z.byteOffset,Z.byteOffset+Z.length),pe=this;this.decryptBuffer(De,function(ke){var Fe=new Uint8Array(ke);j.set(Fe,16),Y||pe.decryptAacSamples(S,C+1,O)})}},I.decryptAacSamples=function(S,C,O){for(;;C++){if(C>=S.length)return void O();if(!(S[C].unit.length<32)){var Y=this.decrypter.isSync();if(this.decryptAacSample(S,C,O,Y),!Y)return}}},I.getAvcEncryptedData=function(S){for(var C=16*Math.floor((S.length-48)/160)+16,O=new Int8Array(C),Y=0,j=32;j<S.length-16;j+=160,Y+=16)O.set(S.subarray(j,j+16),Y);return O},I.getAvcDecryptedUnit=function(S,C){for(var O=new Uint8Array(C),Y=0,j=32;j<S.length-16;j+=160,Y+=16)S.set(O.subarray(Y,Y+16),j);return S},I.decryptAvcSample=function(S,C,O,Y,j,Z){var De=(0,q.discardEPB)(j.data),pe=this.getAvcEncryptedData(De),ke=this;this.decryptBuffer(pe.buffer,function(Fe){j.data=ke.getAvcDecryptedUnit(De,Fe),Z||ke.decryptAvcSamples(S,C,O+1,Y)})},I.decryptAvcSamples=function(S,C,O,Y){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;C++,O=0){if(C>=S.length)return void Y();for(var j=S[C].units;!(O>=j.length);O++){var Z=j[O];if(!(Z.data.length<=48||Z.type!==1&&Z.type!==5)){var De=this.decrypter.isSync();if(this.decryptAvcSample(S,C,O,Y,Z,De),!De)return}}}},R}();function Et(){return Et=Object.assign?Object.assign.bind():function(R){for(var I=1;I<arguments.length;I++){var S=arguments[I];for(var C in S)Object.prototype.hasOwnProperty.call(S,C)&&(R[C]=S[C])}return R},Et.apply(this,arguments)}var lt=188;function vt(R,I,S,C){return{key:R,frame:!1,pts:I,dts:S,units:[],debug:C,length:0}}function St(R,I){return(31&R[I+10])<<8|R[I+11]}function gt(R,I,S,C){var O={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},Y=I+3+((15&R[I+1])<<8|R[I+2])-4;for(I+=12+((15&R[I+10])<<8|R[I+11]);I<Y;){var j=(31&R[I+1])<<8|R[I+2];switch(R[I]){case 207:if(!C){te.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:O.audio===-1&&(O.audio=j);break;case 21:O.id3===-1&&(O.id3=j);break;case 219:if(!C){te.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:O.avc===-1&&(O.avc=j);break;case 3:case 4:S.mpeg!==!0&&S.mp3!==!0?te.logger.log("MPEG audio found, not supported in this browser"):O.audio===-1&&(O.audio=j,O.segmentCodec="mp3");break;case 36:te.logger.warn("Unsupported HEVC stream type found")}I+=5+((15&R[I+3])<<8|R[I+4])}return O}function At(R){var I,S,C,O,Y,j=0,Z=R.data;if(!R||R.size===0)return null;for(;Z[0].length<19&&Z.length>1;){var De=new Uint8Array(Z[0].length+Z[1].length);De.set(Z[0]),De.set(Z[1],Z[0].length),Z[0]=De,Z.splice(1,1)}if(((I=Z[0])[0]<<16)+(I[1]<<8)+I[2]===1){if((S=(I[4]<<8)+I[5])&&S>R.size-6)return null;var pe=I[7];192&pe&&(O=536870912*(14&I[9])+4194304*(255&I[10])+16384*(254&I[11])+128*(255&I[12])+(254&I[13])/2,64&pe?O-(Y=536870912*(14&I[14])+4194304*(255&I[15])+16384*(254&I[16])+128*(255&I[17])+(254&I[18])/2)>54e5&&(te.logger.warn(Math.round((O-Y)/9e4)+"s delta between PTS and DTS, align them"),O=Y):Y=O);var ke=(C=I[8])+9;if(R.size<=ke)return null;R.size-=ke;for(var Fe=new Uint8Array(R.size),Qe=0,$e=Z.length;Qe<$e;Qe++){var Ye=(I=Z[Qe]).byteLength;if(ke){if(ke>Ye){ke-=Ye;continue}I=I.subarray(ke),Ye-=ke,ke=0}Fe.set(I,j),j+=Ye}return S&&(S-=C+3),{data:Fe,pts:O,dts:Y,len:S}}return null}function Lt(R,I){if(R.units.length&&R.frame){if(R.pts===void 0){var S=I.samples,C=S.length;if(!C)return void I.dropped++;var O=S[C-1];R.pts=O.pts,R.dts=O.dts}I.samples.push(R)}R.debug.length&&te.logger.log(R.pts+"/"+R.dts+":"+R.debug)}const yt=function(){function R(S,C,O){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=S,this.config=C,this.typeSupported=O}R.probe=function(S){var C=R.syncOffset(S);return C>0&&te.logger.warn("MPEG2-TS detected but first sync word found @ offset "+C),C!==-1},R.syncOffset=function(S){for(var C=Math.min(940,S.length-376)+1,O=0;O<C;){if(S[O]===71&&S[O+lt]===71)return O;O++}return-1},R.createTrack=function(S,C){return{container:S==="video"||S==="audio"?"video/mp2t":void 0,type:S,id:q.RemuxerTrackIdConfig[S],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:S==="audio"?C:void 0}};var I=R.prototype;return I.resetInitSegment=function(S,C,O,Y){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=R.createTrack("video"),this._audioTrack=R.createTrack("audio",Y),this._id3Track=R.createTrack("id3"),this._txtTrack=R.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=C,this.videoCodec=O,this._duration=Y},I.resetTimeStamp=function(){},I.resetContiguity=function(){var S=this._audioTrack,C=this._avcTrack,O=this._id3Track;S&&(S.pesData=null),C&&(C.pesData=null),O&&(O.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},I.demux=function(S,C,O,Y){var j;O===void 0&&(O=!1),Y===void 0&&(Y=!1),O||(this.sampleAes=null);var Z=this._avcTrack,De=this._audioTrack,pe=this._id3Track,ke=this._txtTrack,Fe=Z.pid,Qe=Z.pesData,$e=De.pid,Ye=pe.pid,ot=De.pesData,Tt=pe.pesData,dt=null,Ft=this.pmtParsed,Qt=this._pmtId,Pt=S.length;if(this.remainderData&&(Pt=(S=(0,q.appendUint8Array)(this.remainderData,S)).length,this.remainderData=null),Pt<lt&&!Y)return this.remainderData=S,{audioTrack:De,videoTrack:Z,id3Track:pe,textTrack:ke};var mt=Math.max(0,R.syncOffset(S));(Pt-=(Pt-mt)%lt)<S.byteLength&&!Y&&(this.remainderData=new Uint8Array(S.buffer,Pt,S.buffer.byteLength-Pt));for(var Vt=0,bt=mt;bt<Pt;bt+=lt)if(S[bt]===71){var zt=!!(64&S[bt+1]),dr=((31&S[bt+1])<<8)+S[bt+2],jt=void 0;if((48&S[bt+3])>>4>1){if((jt=bt+5+S[bt+4])===bt+lt)continue}else jt=bt+4;switch(dr){case Fe:zt&&(Qe&&(j=At(Qe))&&this.parseAVCPES(Z,ke,j,!1),Qe={data:[],size:0}),Qe&&(Qe.data.push(S.subarray(jt,bt+lt)),Qe.size+=bt+lt-jt);break;case $e:if(zt){if(ot&&(j=At(ot)))switch(De.segmentCodec){case"aac":this.parseAACPES(De,j);break;case"mp3":this.parseMPEGPES(De,j)}ot={data:[],size:0}}ot&&(ot.data.push(S.subarray(jt,bt+lt)),ot.size+=bt+lt-jt);break;case Ye:zt&&(Tt&&(j=At(Tt))&&this.parseID3PES(pe,j),Tt={data:[],size:0}),Tt&&(Tt.data.push(S.subarray(jt,bt+lt)),Tt.size+=bt+lt-jt);break;case 0:zt&&(jt+=S[jt]+1),Qt=this._pmtId=St(S,jt);break;case Qt:zt&&(jt+=S[jt]+1);var cr=gt(S,jt,this.typeSupported,O);(Fe=cr.avc)>0&&(Z.pid=Fe),($e=cr.audio)>0&&(De.pid=$e,De.segmentCodec=cr.segmentCodec),(Ye=cr.id3)>0&&(pe.pid=Ye),dt===null||Ft||(te.logger.log("unknown PID '"+dt+"' in TS found"),dt=null,bt=mt-188),Ft=this.pmtParsed=!0;break;case 17:case 8191:break;default:dt=dr}}else Vt++;Vt>0&&this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Vt+" TS packet/s that do not start with 0x47"}),Z.pesData=Qe,De.pesData=ot,pe.pesData=Tt;var yr={audioTrack:De,videoTrack:Z,id3Track:pe,textTrack:ke};return Y&&this.extractRemainingSamples(yr),yr},I.flush=function(){var S,C=this.remainderData;return this.remainderData=null,S=C?this.demux(C,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(S),this.sampleAes?this.decrypt(S,this.sampleAes):S},I.extractRemainingSamples=function(S){var C,O=S.audioTrack,Y=S.videoTrack,j=S.id3Track,Z=S.textTrack,De=Y.pesData,pe=O.pesData,ke=j.pesData;if(De&&(C=At(De))?(this.parseAVCPES(Y,Z,C,!0),Y.pesData=null):Y.pesData=De,pe&&(C=At(pe))){switch(O.segmentCodec){case"aac":this.parseAACPES(O,C);break;case"mp3":this.parseMPEGPES(O,C)}O.pesData=null}else pe!=null&&pe.size&&te.logger.log("last AAC PES packet truncated,might overlap between fragments"),O.pesData=pe;ke&&(C=At(ke))?(this.parseID3PES(j,C),j.pesData=null):j.pesData=ke},I.demuxSampleAes=function(S,C,O){var Y=this.demux(S,O,!0,!this.config.progressive),j=this.sampleAes=new st(this.observer,this.config,C);return this.decrypt(Y,j)},I.decrypt=function(S,C){return new Promise(function(O){var Y=S.audioTrack,j=S.videoTrack;Y.samples&&Y.segmentCodec==="aac"?C.decryptAacSamples(Y.samples,0,function(){j.samples?C.decryptAvcSamples(j.samples,0,0,function(){O(S)}):O(S)}):j.samples&&C.decryptAvcSamples(j.samples,0,0,function(){O(S)})})},I.destroy=function(){this._duration=0},I.parseAVCPES=function(S,C,O,Y){var j,Z=this,De=this.parseAVCNALu(S,O.data),pe=this.avcSample,ke=!1;O.data=null,pe&&De.length&&!S.audFound&&(Lt(pe,S),pe=this.avcSample=vt(!1,O.pts,O.dts,"")),De.forEach(function(Fe){switch(Fe.type){case 1:j=!0,pe||(pe=Z.avcSample=vt(!0,O.pts,O.dts,"")),pe.frame=!0;var Qe=Fe.data;if(ke&&Qe.length>4){var $e=new Ze(Qe).readSliceType();$e!==2&&$e!==4&&$e!==7&&$e!==9||(pe.key=!0)}break;case 5:j=!0,pe||(pe=Z.avcSample=vt(!0,O.pts,O.dts,"")),pe.key=!0,pe.frame=!0;break;case 6:j=!0,(0,q.parseSEIMessageFromNALu)(Fe.data,1,O.pts,C.samples);break;case 7:if(j=!0,ke=!0,!S.sps){var Ye=new Ze(Fe.data).readSPS();S.width=Ye.width,S.height=Ye.height,S.pixelRatio=Ye.pixelRatio,S.sps=[Fe.data],S.duration=Z._duration;for(var ot=Fe.data.subarray(1,4),Tt="avc1.",dt=0;dt<3;dt++){var Ft=ot[dt].toString(16);Ft.length<2&&(Ft="0"+Ft),Tt+=Ft}S.codec=Tt}break;case 8:j=!0,S.pps||(S.pps=[Fe.data]);break;case 9:j=!1,S.audFound=!0,pe&&Lt(pe,S),pe=Z.avcSample=vt(!1,O.pts,O.dts,"");break;case 12:j=!0;break;default:j=!1,pe&&(pe.debug+="unknown NAL "+Fe.type+" ")}pe&&j&&pe.units.push(Fe)}),Y&&pe&&(Lt(pe,S),this.avcSample=null)},I.getLastNalUnit=function(S){var C,O,Y=this.avcSample;if(Y&&Y.units.length!==0||(Y=S[S.length-1]),(C=Y)!==null&&C!==void 0&&C.units){var j=Y.units;O=j[j.length-1]}return O},I.parseAVCNALu=function(S,C){var O,Y,j=C.byteLength,Z=S.naluState||0,De=Z,pe=[],ke=0,Fe=-1,Qe=0;for(Z===-1&&(Fe=0,Qe=31&C[0],Z=0,ke=1);ke<j;)if(O=C[ke++],Z)if(Z!==1)if(O)if(O===1){if(Fe>=0){var $e={data:C.subarray(Fe,ke-Z-1),type:Qe};pe.push($e)}else{var Ye=this.getLastNalUnit(S.samples);if(Ye&&(De&&ke<=4-De&&Ye.state&&(Ye.data=Ye.data.subarray(0,Ye.data.byteLength-De)),(Y=ke-Z-1)>0)){var ot=new Uint8Array(Ye.data.byteLength+Y);ot.set(Ye.data,0),ot.set(C.subarray(0,Y),Ye.data.byteLength),Ye.data=ot,Ye.state=0}}ke<j?(Fe=ke,Qe=31&C[ke],Z=0):Z=-1}else Z=0;else Z=3;else Z=O?0:2;else Z=O?0:1;if(Fe>=0&&Z>=0){var Tt={data:C.subarray(Fe,j),type:Qe,state:Z};pe.push(Tt)}if(pe.length===0){var dt=this.getLastNalUnit(S.samples);if(dt){var Ft=new Uint8Array(dt.data.byteLength+C.byteLength);Ft.set(dt.data,0),Ft.set(C,dt.data.byteLength),dt.data=Ft}}return S.naluState=Z,pe},I.parseAACPES=function(S,C){var O,Y,j,Z,De,pe=0,ke=this.aacOverFlow,Fe=C.data;if(ke){this.aacOverFlow=null;var Qe=ke.missing,$e=ke.sample.unit.byteLength;if(Qe===-1){var Ye=new Uint8Array($e+Fe.byteLength);Ye.set(ke.sample.unit,0),Ye.set(Fe,$e),Fe=Ye}else{var ot=$e-Qe;ke.sample.unit.set(Fe.subarray(0,Qe),ot),S.samples.push(ke.sample),pe=ke.missing}}for(O=pe,Y=Fe.length;O<Y-1&&!be(Fe,O);O++);if(O===pe||(O<Y-1?(j="AAC PES did not start with ADTS header,offset:"+O,Z=!1):(j="no ADTS header found in AAC PES",Z=!0),te.logger.warn("parsing error:"+j),this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:Z,reason:j}),!Z)){if(P(S,this.observer,Fe,O,this.audioCodec),C.pts!==void 0)De=C.pts;else{if(!ke)return void te.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var Tt=k(S.samplerate);De=ke.sample.pts+Tt}for(var dt,Ft=0;O<Y;){if(O+=(dt=W(S,Fe,O,De,Ft)).length,dt.missing){this.aacOverFlow=dt;break}for(Ft++;O<Y-1&&!be(Fe,O);O++);}}},I.parseMPEGPES=function(S,C){var O=C.data,Y=O.length,j=0,Z=0,De=C.pts;if(De!==void 0)for(;Z<Y;)if(it(O,Z)){var pe=xe(S,O,Z,De,j);if(!pe)break;Z+=pe.length,j++}else Z++;else te.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},I.parseID3PES=function(S,C){if(C.pts!==void 0){var O=Et({},C,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});S.samples.push(O)}else te.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},R}();function Ot(R,I){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,C){return S.__proto__=C,S},Ot(R,I)}const _t=function(R){var I,S;function C(){return R.apply(this,arguments)||this}S=R,(I=C).prototype=Object.create(S.prototype),I.prototype.constructor=I,Ot(I,S);var O=C.prototype;return O.resetInitSegment=function(Y,j,Z,De){R.prototype.resetInitSegment.call(this,Y,j,Z,De),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:j,duration:De,inputTimeScale:9e4,dropped:0}},C.probe=function(Y){if(!Y)return!1;for(var j=(M.getID3Data(Y,0)||[]).length,Z=Y.length;j<Z;j++)if(ye(Y,j))return te.logger.log("MPEG Audio sync word found !"),!0;return!1},O.canParse=function(Y,j){return function(Z,De){return qe(Z,De)&&4<=Z.length-De}(Y,j)},O.appendFrame=function(Y,j,Z){if(this.basePTS!==null)return xe(Y,j,Z,this.basePTS,this.frameIndex)},C}(de),Jt=function(){function R(){}return R.getSilentFrame=function(I,S){if(I==="mp4a.40.2"){if(S===1)return new Uint8Array([0,200,0,128,35,128]);if(S===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(S===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(S===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(S===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(S===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(S===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},R}();var Gt=Math.pow(2,32)-1,wt=function(){function R(){}return R.init=function(){var I;for(I in R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},R.types)R.types.hasOwnProperty(I)&&(R.types[I]=[I.charCodeAt(0),I.charCodeAt(1),I.charCodeAt(2),I.charCodeAt(3)]);var S=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);R.HDLR_TYPES={video:S,audio:C};var O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Y=new Uint8Array([0,0,0,0,0,0,0,0]);R.STTS=R.STSC=R.STCO=Y,R.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),R.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),R.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var j=new Uint8Array([105,115,111,109]),Z=new Uint8Array([97,118,99,49]),De=new Uint8Array([0,0,0,1]);R.FTYP=R.box(R.types.ftyp,j,De,j,Z),R.DINF=R.box(R.types.dinf,R.box(R.types.dref,O))},R.box=function(I){for(var S=8,C=arguments.length,O=new Array(C>1?C-1:0),Y=1;Y<C;Y++)O[Y-1]=arguments[Y];for(var j=O.length,Z=j;j--;)S+=O[j].byteLength;var De=new Uint8Array(S);for(De[0]=S>>24&255,De[1]=S>>16&255,De[2]=S>>8&255,De[3]=255&S,De.set(I,4),j=0,S=8;j<Z;j++)De.set(O[j],S),S+=O[j].byteLength;return De},R.hdlr=function(I){return R.box(R.types.hdlr,R.HDLR_TYPES[I])},R.mdat=function(I){return R.box(R.types.mdat,I)},R.mdhd=function(I,S){S*=I;var C=Math.floor(S/(Gt+1)),O=Math.floor(S%(Gt+1));return R.box(R.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,C>>24,C>>16&255,C>>8&255,255&C,O>>24,O>>16&255,O>>8&255,255&O,85,196,0,0]))},R.mdia=function(I){return R.box(R.types.mdia,R.mdhd(I.timescale,I.duration),R.hdlr(I.type),R.minf(I))},R.mfhd=function(I){return R.box(R.types.mfhd,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I]))},R.minf=function(I){return I.type==="audio"?R.box(R.types.minf,R.box(R.types.smhd,R.SMHD),R.DINF,R.stbl(I)):R.box(R.types.minf,R.box(R.types.vmhd,R.VMHD),R.DINF,R.stbl(I))},R.moof=function(I,S,C){return R.box(R.types.moof,R.mfhd(I),R.traf(C,S))},R.moov=function(I){for(var S=I.length,C=[];S--;)C[S]=R.trak(I[S]);return R.box.apply(null,[R.types.moov,R.mvhd(I[0].timescale,I[0].duration)].concat(C).concat(R.mvex(I)))},R.mvex=function(I){for(var S=I.length,C=[];S--;)C[S]=R.trex(I[S]);return R.box.apply(null,[R.types.mvex].concat(C))},R.mvhd=function(I,S){S*=I;var C=Math.floor(S/(Gt+1)),O=Math.floor(S%(Gt+1)),Y=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,C>>24,C>>16&255,C>>8&255,255&C,O>>24,O>>16&255,O>>8&255,255&O,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return R.box(R.types.mvhd,Y)},R.sdtp=function(I){var S,C,O=I.samples||[],Y=new Uint8Array(4+O.length);for(S=0;S<O.length;S++)C=O[S].flags,Y[S+4]=C.dependsOn<<4|C.isDependedOn<<2|C.hasRedundancy;return R.box(R.types.sdtp,Y)},R.stbl=function(I){return R.box(R.types.stbl,R.stsd(I),R.box(R.types.stts,R.STTS),R.box(R.types.stsc,R.STSC),R.box(R.types.stsz,R.STSZ),R.box(R.types.stco,R.STCO))},R.avc1=function(I){var S,C,O,Y=[],j=[];for(S=0;S<I.sps.length;S++)O=(C=I.sps[S]).byteLength,Y.push(O>>>8&255),Y.push(255&O),Y=Y.concat(Array.prototype.slice.call(C));for(S=0;S<I.pps.length;S++)O=(C=I.pps[S]).byteLength,j.push(O>>>8&255),j.push(255&O),j=j.concat(Array.prototype.slice.call(C));var Z=R.box(R.types.avcC,new Uint8Array([1,Y[3],Y[4],Y[5],255,224|I.sps.length].concat(Y).concat([I.pps.length]).concat(j))),De=I.width,pe=I.height,ke=I.pixelRatio[0],Fe=I.pixelRatio[1];return R.box(R.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,De>>8&255,255&De,pe>>8&255,255&pe,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Z,R.box(R.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),R.box(R.types.pasp,new Uint8Array([ke>>24,ke>>16&255,ke>>8&255,255&ke,Fe>>24,Fe>>16&255,Fe>>8&255,255&Fe])))},R.esds=function(I){var S=I.config.length;return new Uint8Array([0,0,0,0,3,23+S,0,1,0,4,15+S,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([S]).concat(I.config).concat([6,1,2]))},R.mp4a=function(I){var S=I.samplerate;return R.box(R.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,S>>8&255,255&S,0,0]),R.box(R.types.esds,R.esds(I)))},R.mp3=function(I){var S=I.samplerate;return R.box(R.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,S>>8&255,255&S,0,0]))},R.stsd=function(I){return I.type==="audio"?I.segmentCodec==="mp3"&&I.codec==="mp3"?R.box(R.types.stsd,R.STSD,R.mp3(I)):R.box(R.types.stsd,R.STSD,R.mp4a(I)):R.box(R.types.stsd,R.STSD,R.avc1(I))},R.tkhd=function(I){var S=I.id,C=I.duration*I.timescale,O=I.width,Y=I.height,j=Math.floor(C/(Gt+1)),Z=Math.floor(C%(Gt+1));return R.box(R.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,255&S,0,0,0,0,j>>24,j>>16&255,j>>8&255,255&j,Z>>24,Z>>16&255,Z>>8&255,255&Z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,O>>8&255,255&O,0,0,Y>>8&255,255&Y,0,0]))},R.traf=function(I,S){var C=R.sdtp(I),O=I.id,Y=Math.floor(S/(Gt+1)),j=Math.floor(S%(Gt+1));return R.box(R.types.traf,R.box(R.types.tfhd,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,255&O])),R.box(R.types.tfdt,new Uint8Array([1,0,0,0,Y>>24,Y>>16&255,Y>>8&255,255&Y,j>>24,j>>16&255,j>>8&255,255&j])),R.trun(I,C.length+16+20+8+16+8+8),C)},R.trak=function(I){return I.duration=I.duration||4294967295,R.box(R.types.trak,R.tkhd(I),R.mdia(I))},R.trex=function(I){var S=I.id;return R.box(R.types.trex,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},R.trun=function(I,S){var C,O,Y,j,Z,De,pe=I.samples||[],ke=pe.length,Fe=12+16*ke,Qe=new Uint8Array(Fe);for(S+=8+Fe,Qe.set([I.type==="video"?1:0,0,15,1,ke>>>24&255,ke>>>16&255,ke>>>8&255,255&ke,S>>>24&255,S>>>16&255,S>>>8&255,255&S],0),C=0;C<ke;C++)Y=(O=pe[C]).duration,j=O.size,Z=O.flags,De=O.cts,Qe.set([Y>>>24&255,Y>>>16&255,Y>>>8&255,255&Y,j>>>24&255,j>>>16&255,j>>>8&255,255&j,Z.isLeading<<2|Z.dependsOn,Z.isDependedOn<<6|Z.hasRedundancy<<4|Z.paddingValue<<1|Z.isNonSync,61440&Z.degradPrio,15&Z.degradPrio,De>>>24&255,De>>>16&255,De>>>8&255,255&De],12+16*C);return R.box(R.types.trun,Qe)},R.initSegment=function(I){R.types||R.init();var S=R.moov(I),C=new Uint8Array(R.FTYP.byteLength+S.byteLength);return C.set(R.FTYP),C.set(S,R.FTYP.byteLength),C},R}();wt.types=void 0,wt.HDLR_TYPES=void 0,wt.STTS=void 0,wt.STSC=void 0,wt.STCO=void 0,wt.STSZ=void 0,wt.VMHD=void 0,wt.SMHD=void 0,wt.STSD=void 0,wt.FTYP=void 0,wt.DINF=void 0;const tr=wt;var Zt=Q(308);function rr(R,I){return I===void 0&&(I=!1),function(S,C,O,Y){O===void 0&&(O=1),Y===void 0&&(Y=!1);var j=S*C*O;return Y?Math.round(j):j}(R,1e3,11111111111111112e-21,I)}function lr(){return lr=Object.assign?Object.assign.bind():function(R){for(var I=1;I<arguments.length;I++){var S=arguments[I];for(var C in S)Object.prototype.hasOwnProperty.call(S,C)&&(R[C]=S[C])}return R},lr.apply(this,arguments)}var ur=null,hr=null,Xt=function(){function R(S,C,O,Y){if(Y===void 0&&(Y=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=S,this.config=C,this.typeSupported=O,this.ISGenerated=!1,ur===null){var j=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ur=j?parseInt(j[1]):0}if(hr===null){var Z=navigator.userAgent.match(/Safari\/(\d+)/i);hr=Z?parseInt(Z[1]):0}}var I=R.prototype;return I.destroy=function(){},I.resetTimeStamp=function(S){te.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=S},I.resetNextTimestamp=function(){te.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},I.resetInitSegment=function(){te.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},I.getVideoStartPts=function(S){var C=!1,O=S.reduce(function(Y,j){var Z=j.pts-Y;return Z<-4294967296?(C=!0,sr(Y,j.pts)):Z>0?Y:j.pts},S[0].pts);return C&&te.logger.debug("PTS rollover detected"),O},I.remux=function(S,C,O,Y,j,Z,De,pe){var ke,Fe,Qe,$e,Ye,ot,Tt=j,dt=j,Ft=S.pid>-1,Qt=C.pid>-1,Pt=C.samples.length,mt=S.samples.length>0,Vt=De&&Pt>0||Pt>1;if((!Ft||mt)&&(!Qt||Vt)||this.ISGenerated||De){this.ISGenerated||(Qe=this.generateIS(S,C,j));var bt,zt=this.isVideoContiguous,dr=-1;if(Vt&&(dr=function(ir){for(var gr=0;gr<ir.length;gr++)if(ir[gr].key)return gr;return-1}(C.samples),!zt&&this.config.forceKeyFrameOnDiscontinuity))if(ot=!0,dr>0){te.logger.warn("[mp4-remuxer]: Dropped "+dr+" out of "+Pt+" video samples due to a missing keyframe");var jt=this.getVideoStartPts(C.samples);C.samples=C.samples.slice(dr),C.dropped+=dr,bt=dt+=(C.samples[0].pts-jt)/C.inputTimeScale}else dr===-1&&(te.logger.warn("[mp4-remuxer]: No keyframe found out of "+Pt+" video samples"),ot=!1);if(this.ISGenerated){if(mt&&Vt){var cr=this.getVideoStartPts(C.samples),yr=(sr(S.samples[0].pts,cr)-cr)/C.inputTimeScale;Tt+=Math.max(0,yr),dt+=Math.max(0,-yr)}if(mt){if(S.samplerate||(te.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Qe=this.generateIS(S,C,j)),Fe=this.remuxAudio(S,Tt,this.isAudioContiguous,Z,Qt||Vt||pe===Zt.PlaylistLevelType.AUDIO?dt:void 0),Vt){var mr=Fe?Fe.endPTS-Fe.startPTS:0;C.inputTimeScale||(te.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Qe=this.generateIS(S,C,j)),ke=this.remuxVideo(C,dt,zt,mr)}}else Vt&&(ke=this.remuxVideo(C,dt,zt,0));ke&&(ke.firstKeyFrame=dr,ke.independent=dr!==-1,ke.firstKeyFramePTS=bt)}}return this.ISGenerated&&(O.samples.length&&(Ye=Ee(O,j,this._initPTS,this._initDTS)),Y.samples.length&&($e=ne(Y,j,this._initPTS))),{audio:Fe,video:ke,initSegment:Qe,independent:ot,text:$e,id3:Ye}},I.generateIS=function(S,C,O){var Y,j,Z,De=S.samples,pe=C.samples,ke=this.typeSupported,Fe={},Qe=!(0,c.isFiniteNumber)(this._initPTS),$e="audio/mp4";if(Qe&&(Y=j=1/0),S.config&&De.length&&(S.timescale=S.samplerate,S.segmentCodec==="mp3"&&(ke.mpeg?($e="audio/mpeg",S.codec=""):ke.mp3&&(S.codec="mp3")),Fe.audio={id:"audio",container:$e,codec:S.codec,initSegment:S.segmentCodec==="mp3"&&ke.mpeg?new Uint8Array(0):tr.initSegment([S]),metadata:{channelCount:S.channelCount}},Qe&&(Z=S.inputTimeScale,Y=j=De[0].pts-Math.round(Z*O))),C.sps&&C.pps&&pe.length&&(C.timescale=C.inputTimeScale,Fe.video={id:"main",container:"video/mp4",codec:C.codec,initSegment:tr.initSegment([C]),metadata:{width:C.width,height:C.height}},Qe)){Z=C.inputTimeScale;var Ye=this.getVideoStartPts(pe),ot=Math.round(Z*O);j=Math.min(j,sr(pe[0].dts,Ye)-ot),Y=Math.min(Y,Ye-ot)}if(Object.keys(Fe).length)return this.ISGenerated=!0,Qe&&(this._initPTS=Y,this._initDTS=j),{tracks:Fe,initPTS:Y,timescale:Z}},I.remuxVideo=function(S,C,O,Y){var j,Z,De=S.inputTimeScale,pe=S.samples,ke=[],Fe=pe.length,Qe=this._initPTS,$e=this.nextAvcDts,Ye=8,ot=this.videoSampleDuration,Tt=Number.POSITIVE_INFINITY,dt=Number.NEGATIVE_INFINITY,Ft=!1;O&&$e!==null||($e=C*De-(pe[0].pts-sr(pe[0].dts,pe[0].pts)));for(var Qt=0;Qt<Fe;Qt++){var Pt=pe[Qt];Pt.pts=sr(Pt.pts-Qe,$e),Pt.dts=sr(Pt.dts-Qe,$e),Pt.dts<pe[Qt>0?Qt-1:Qt].dts&&(Ft=!0)}Ft&&pe.sort(function(ti,si){var Ni=ti.dts-si.dts,Ut=ti.pts-si.pts;return Ni||Ut}),j=pe[0].dts;var mt=pe[pe.length-1].dts-j,Vt=mt?Math.round(mt/(Fe-1)):ot||S.inputTimeScale/30;if(O){var bt=j-$e,zt=bt>Vt,dr=bt<-1;if((zt||dr)&&(zt?te.logger.warn("AVC: "+rr(bt,!0)+" ms ("+bt+"dts) hole between fragments detected, filling it"):te.logger.warn("AVC: "+rr(-bt,!0)+" ms ("+bt+"dts) overlapping between fragments detected"),!dr||$e>pe[0].pts)){j=$e;var jt=pe[0].pts-bt;pe[0].dts=j,pe[0].pts=jt,te.logger.log("Video: First PTS/DTS adjusted: "+rr(jt,!0)+"/"+rr(j,!0)+", delta: "+rr(bt,!0)+" ms")}}j=Math.max(0,j);for(var cr=0,yr=0,mr=0;mr<Fe;mr++){for(var ir=pe[mr],gr=ir.units,Ar=gr.length,Rr=0,Br=0;Br<Ar;Br++)Rr+=gr[Br].data.length;yr+=Rr,cr+=Ar,ir.length=Rr,ir.dts=Math.max(ir.dts,j),Tt=Math.min(ir.pts,Tt),dt=Math.max(ir.pts,dt)}Z=pe[Fe-1].dts;var xr,zr=yr+4*cr+8;try{xr=new Uint8Array(zr)}catch(ti){return void this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MUX_ERROR,details:$.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:zr,reason:"fail allocating video mdat "+zr})}var Jr=new DataView(xr.buffer);Jr.setUint32(0,zr),xr.set(tr.types.mdat,4);for(var Xr=!1,Hr=Number.POSITIVE_INFINITY,Nr=Number.POSITIVE_INFINITY,Or=Number.NEGATIVE_INFINITY,Zr=Number.NEGATIVE_INFINITY,kr=0;kr<Fe;kr++){for(var wr=pe[kr],ii=wr.units,gi=0,Pr=0,Ci=ii.length;Pr<Ci;Pr++){var ni=ii[Pr],Oi=ni.data,Li=ni.data.byteLength;Jr.setUint32(Ye,Li),Ye+=4,xr.set(Oi,Ye),Ye+=Li,gi+=4+Li}var vi=void 0;if(kr<Fe-1)ot=pe[kr+1].dts-wr.dts,vi=pe[kr+1].pts-wr.pts;else{var pi=this.config,Qr=kr>0?wr.dts-pe[kr-1].dts:Vt;if(vi=kr>0?wr.pts-pe[kr-1].pts:Vt,pi.stretchShortVideoTrack&&this.nextAudioPts!==null){var mi=Math.floor(pi.maxBufferHole*De),Di=(Y?Tt+Y*De:this.nextAudioPts)-wr.pts;Di>mi?((ot=Di-Qr)<0?ot=Qr:Xr=!0,te.logger.log("[mp4-remuxer]: It is approximately "+Di/90+" ms to the next segment; using duration "+ot/90+" ms for the last video frame.")):ot=Qr}else ot=Qr}var Ai=Math.round(wr.pts-wr.dts);Hr=Math.min(Hr,ot),Or=Math.max(Or,ot),Nr=Math.min(Nr,vi),Zr=Math.max(Zr,vi),ke.push(new x(wr.key,ot,gi,Ai))}if(ke.length){if(ur){if(ur<70){var yi=ke[0].flags;yi.dependsOn=2,yi.isNonSync=0}}else if(hr&&Zr-Nr<Or-Hr&&Vt/Or<.025&&ke[0].cts===0){te.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ai=j,Dr=0,Ei=ke.length;Dr<Ei;Dr++){var ei=ai+ke[Dr].duration,Pi=ai+ke[Dr].cts;if(Dr<Ei-1){var Fi=ei+ke[Dr+1].cts;ke[Dr].duration=Fi-Pi}else ke[Dr].duration=Dr?ke[Dr-1].duration:Vt;ke[Dr].cts=0,ai=ei}}}ot=Xr||!ot?Vt:ot,this.nextAvcDts=$e=Z+ot,this.videoSampleDuration=ot,this.isVideoContiguous=!0;var Mi={data1:tr.moof(S.sequenceNumber++,j,lr({},S,{samples:ke})),data2:xr,startPTS:Tt/De,endPTS:(dt+ot)/De,startDTS:j/De,endDTS:$e/De,type:"video",hasAudio:!1,hasVideo:!0,nb:ke.length,dropped:S.dropped};return S.samples=[],S.dropped=0,Mi},I.remuxAudio=function(S,C,O,Y,j){var Z=S.inputTimeScale,De=Z/(S.samplerate?S.samplerate:Z),pe=S.segmentCodec==="aac"?1024:1152,ke=pe*De,Fe=this._initPTS,Qe=S.segmentCodec==="mp3"&&this.typeSupported.mpeg,$e=[],Ye=j!==void 0,ot=S.samples,Tt=Qe?0:8,dt=this.nextAudioPts||-1,Ft=C*Z;if(this.isAudioContiguous=O=O||ot.length&&dt>0&&(Y&&Math.abs(Ft-dt)<9e3||Math.abs(sr(ot[0].pts-Fe,Ft)-dt)<20*ke),ot.forEach(function(Pr){Pr.pts=sr(Pr.pts-Fe,Ft)}),!O||dt<0){if(ot=ot.filter(function(Pr){return Pr.pts>=0}),!ot.length)return;dt=j===0?0:Y&&!Ye?Math.max(0,Ft):ot[0].pts}if(S.segmentCodec==="aac")for(var Qt=this.config.maxAudioFramesDrift,Pt=0,mt=dt;Pt<ot.length;Pt++){var Vt=ot[Pt],bt=Vt.pts,zt=bt-mt,dr=Math.abs(1e3*zt/Z);if(zt<=-Qt*ke&&Ye)Pt===0&&(te.logger.warn("Audio frame @ "+(bt/Z).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*zt/Z)+" ms."),this.nextAudioPts=dt=mt=bt);else if(zt>=Qt*ke&&dr<1e4&&Ye){var jt=Math.round(zt/ke);(mt=bt-jt*ke)<0&&(jt--,mt+=ke),Pt===0&&(this.nextAudioPts=dt=mt),te.logger.warn("[mp4-remuxer]: Injecting "+jt+" audio frame @ "+(mt/Z).toFixed(3)+"s due to "+Math.round(1e3*zt/Z)+" ms gap.");for(var cr=0;cr<jt;cr++){var yr=Math.max(mt,0),mr=Jt.getSilentFrame(S.manifestCodec||S.codec,S.channelCount);mr||(te.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),mr=Vt.unit.subarray()),ot.splice(Pt,0,{unit:mr,pts:yr}),mt+=ke,Pt++}}Vt.pts=mt,mt+=ke}for(var ir,gr=null,Ar=null,Rr=0,Br=ot.length;Br--;)Rr+=ot[Br].unit.byteLength;for(var xr=0,zr=ot.length;xr<zr;xr++){var Jr=ot[xr],Xr=Jr.unit,Hr=Jr.pts;if(Ar!==null)$e[xr-1].duration=Math.round((Hr-Ar)/De);else{if(O&&S.segmentCodec==="aac"&&(Hr=dt),gr=Hr,!(Rr>0))return;Rr+=Tt;try{ir=new Uint8Array(Rr)}catch(Pr){return void this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MUX_ERROR,details:$.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Rr,reason:"fail allocating audio mdat "+Rr})}Qe||(new DataView(ir.buffer).setUint32(0,Rr),ir.set(tr.types.mdat,4))}ir.set(Xr,Tt);var Nr=Xr.byteLength;Tt+=Nr,$e.push(new x(!0,pe,Nr,0)),Ar=Hr}var Or=$e.length;if(Or){var Zr=$e[$e.length-1];this.nextAudioPts=dt=Ar+De*Zr.duration;var kr=Qe?new Uint8Array(0):tr.moof(S.sequenceNumber++,gr/De,lr({},S,{samples:$e}));S.samples=[];var wr=gr/Z,ii=dt/Z,gi={data1:kr,data2:ir,startPTS:wr,endPTS:ii,startDTS:wr,endDTS:ii,type:"audio",hasAudio:!0,hasVideo:!1,nb:Or};return this.isAudioContiguous=!0,gi}},I.remuxEmptyAudio=function(S,C,O,Y){var j=S.inputTimeScale,Z=j/(S.samplerate?S.samplerate:j),De=this.nextAudioPts,pe=(De!==null?De:Y.startDTS*j)+this._initDTS,ke=Y.endDTS*j+this._initDTS,Fe=1024*Z,Qe=Math.ceil((ke-pe)/Fe),$e=Jt.getSilentFrame(S.manifestCodec||S.codec,S.channelCount);if(te.logger.warn("[mp4-remuxer]: remux empty Audio"),$e){for(var Ye=[],ot=0;ot<Qe;ot++){var Tt=pe+ot*Fe;Ye.push({unit:$e,pts:Tt,dts:Tt})}return S.samples=Ye,this.remuxAudio(S,C,O,!1)}te.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},R}();function sr(R,I){var S;if(I===null)return R;for(S=I<R?-8589934592:8589934592;Math.abs(R-I)>4294967296;)R+=S;return R}function Ee(R,I,S,C){var O=R.samples.length;if(O){for(var Y=R.inputTimeScale,j=0;j<O;j++){var Z=R.samples[j];Z.pts=sr(Z.pts-S,I*Y)/Y,Z.dts=sr(Z.dts-C,I*Y)/Y}var De=R.samples;return R.samples=[],{samples:De}}}function ne(R,I,S){var C=R.samples.length;if(C){for(var O=R.inputTimeScale,Y=0;Y<C;Y++){var j=R.samples[Y];j.pts=sr(j.pts-S,I*O)/O}R.samples.sort(function(De,pe){return De.pts-pe.pts});var Z=R.samples;return R.samples=[],{samples:Z}}}var x=function(R,I,S,C){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=I,this.size=S,this.cts=C,this.flags=new re(R)},re=function(R){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=R?2:1,this.isNonSync=R?0:1},J=Q(923);function ce(R,I){var S=R==null?void 0:R.codec;return S&&S.length>4?S:S==="hvc1"||S==="hev1"?"hvc1.1.c.L120.90":S==="av01"?"av01.0.04M.08":S==="avc1"||I===J.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const ve=function(){function R(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var I=R.prototype;return I.destroy=function(){},I.resetTimeStamp=function(S){this.initPTS=S,this.lastEndTime=null},I.resetNextTimestamp=function(){this.lastEndTime=null},I.resetInitSegment=function(S,C,O){this.audioCodec=C,this.videoCodec=O,this.generateInitSegment(S),this.emitInitSegment=!0},I.generateInitSegment=function(S){var C=this.audioCodec,O=this.videoCodec;if(!S||!S.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var Y=this.initData=(0,q.parseInitSegment)(S);C||(C=ce(Y.audio,J.ElementaryStreamTypes.AUDIO)),O||(O=ce(Y.video,J.ElementaryStreamTypes.VIDEO));var j={};Y.audio&&Y.video?j.audiovideo={container:"video/mp4",codec:C+","+O,initSegment:S,id:"main"}:Y.audio?j.audio={container:"audio/mp4",codec:C,initSegment:S,id:"audio"}:Y.video?j.video={container:"video/mp4",codec:O,initSegment:S,id:"main"}:te.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=j},I.remux=function(S,C,O,Y,j){var Z,De=this.initPTS,pe=this.lastEndTime,ke={audio:void 0,video:void 0,text:Y,id3:O,initSegment:void 0};(0,c.isFiniteNumber)(pe)||(pe=this.lastEndTime=j||0);var Fe=C.samples;if(!Fe||!Fe.length)return ke;var Qe={initPTS:void 0,timescale:1},$e=this.initData;if($e&&$e.length||(this.generateInitSegment(Fe),$e=this.initData),!$e||!$e.length)return te.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ke;this.emitInitSegment&&(Qe.tracks=this.initTracks,this.emitInitSegment=!1);var Ye=(0,q.getStartDTS)($e,Fe);(0,c.isFiniteNumber)(De)||(this.initPTS=Qe.initPTS=De=Ye-j);var ot=(0,q.getDuration)(Fe,$e),Tt=S?Ye-De:pe,dt=Tt+ot;(0,q.offsetStartDTS)($e,Fe,De),ot>0?this.lastEndTime=dt:(te.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var Ft=!!$e.audio,Qt=!!$e.video,Pt="";Ft&&(Pt+="audio"),Qt&&(Pt+="video");var mt={data1:Fe,startPTS:Tt,startDTS:Tt,endPTS:dt,endDTS:dt,type:Pt,hasAudio:Ft,hasVideo:Qt,nb:1,dropped:0};ke.audio=mt.type==="audio"?mt:void 0,ke.video=mt.type!=="audio"?mt:void 0,ke.initSegment=Qe;var Vt=(Z=this.initPTS)!=null?Z:0;return ke.id3=Ee(O,j,Vt,Vt),Y.samples.length&&(ke.text=ne(Y,j,Vt)),ke},R}();var Le;try{Le=self.performance.now.bind(self.performance)}catch(R){te.logger.debug("Unable to use Performance API on this environment"),Le=self.Date.now}var Ne=[{demux:yt,remux:Xt},{demux:we,remux:ve},{demux:Re,remux:Xt},{demux:_t,remux:Xt}],ze=function(){function R(S,C,O,Y,j){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=S,this.typeSupported=C,this.config=O,this.vendor=Y,this.id=j}var I=R.prototype;return I.configure=function(S){this.transmuxConfig=S,this.decrypter&&this.decrypter.reset()},I.push=function(S,C,O,Y){var j=this,Z=O.transmuxing;Z.executeStart=Le();var De=new Uint8Array(S),pe=this.config,ke=this.currentTransmuxState,Fe=this.transmuxConfig;Y&&(this.currentTransmuxState=Y);var Qe=Y||ke,$e=Qe.contiguous,Ye=Qe.discontinuity,ot=Qe.trackSwitch,Tt=Qe.accurateTimeOffset,dt=Qe.timeOffset,Ft=Qe.initSegmentChange,Qt=Fe.audioCodec,Pt=Fe.videoCodec,mt=Fe.defaultInitPts,Vt=Fe.duration,bt=Fe.initSegmentData;(Ye||ot||Ft)&&this.resetInitSegment(bt,Qt,Pt,Vt),(Ye||Ft)&&this.resetInitialTimestamp(mt),$e||this.resetContiguity();var zt=function(mr,ir){var gr=null;return mr.byteLength>0&&ir!=null&&ir.key!=null&&ir.iv!==null&&ir.method!=null&&(gr=ir),gr}(De,C);if(zt&&zt.method==="AES-128"){var dr=this.getDecrypter();if(!pe.enableSoftwareAES)return this.decryptionPromise=dr.webCryptoDecrypt(De,zt.key.buffer,zt.iv.buffer).then(function(mr){var ir=j.push(mr,null,O);return j.decryptionPromise=null,ir}),this.decryptionPromise;var jt=dr.softwareDecrypt(De,zt.key.buffer,zt.iv.buffer);if(!jt)return Z.executeEnd=Le(),Be(O);De=new Uint8Array(jt)}this.needsProbing(De,Ye,ot)&&this.configureTransmuxer(De,Fe);var cr=this.transmux(De,zt,dt,Tt,O),yr=this.currentTransmuxState;return yr.contiguous=!0,yr.discontinuity=!1,yr.trackSwitch=!1,Z.executeEnd=Le(),cr},I.flush=function(S){var C=this,O=S.transmuxing;O.executeStart=Le();var Y=this.decrypter,j=this.currentTransmuxState,Z=this.decryptionPromise;if(Z)return Z.then(function(){return C.flush(S)});var De=[],pe=j.timeOffset;if(Y){var ke=Y.flush();ke&&De.push(this.push(ke,null,S))}var Fe=this.demuxer,Qe=this.remuxer;if(!Fe||!Qe)return this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),O.executeEnd=Le(),[Be(S)];var $e=Fe.flush(pe);return rt($e)?$e.then(function(Ye){return C.flushRemux(De,Ye,S),De}):(this.flushRemux(De,$e,S),De)},I.flushRemux=function(S,C,O){var Y=C.audioTrack,j=C.videoTrack,Z=C.id3Track,De=C.textTrack,pe=this.currentTransmuxState,ke=pe.accurateTimeOffset,Fe=pe.timeOffset;te.logger.log("[transmuxer.ts]: Flushed fragment "+O.sn+(O.part>-1?" p: "+O.part:"")+" of level "+O.level);var Qe=this.remuxer.remux(Y,j,Z,De,Fe,ke,!0,this.id);S.push({remuxResult:Qe,chunkMeta:O}),O.transmuxing.executeEnd=Le()},I.resetInitialTimestamp=function(S){var C=this.demuxer,O=this.remuxer;C&&O&&(C.resetTimeStamp(S),O.resetTimeStamp(S))},I.resetContiguity=function(){var S=this.demuxer,C=this.remuxer;S&&C&&(S.resetContiguity(),C.resetNextTimestamp())},I.resetInitSegment=function(S,C,O,Y){var j=this.demuxer,Z=this.remuxer;j&&Z&&(j.resetInitSegment(S,C,O,Y),Z.resetInitSegment(S,C,O))},I.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},I.transmux=function(S,C,O,Y,j){return C&&C.method==="SAMPLE-AES"?this.transmuxSampleAes(S,C,O,Y,j):this.transmuxUnencrypted(S,O,Y,j)},I.transmuxUnencrypted=function(S,C,O,Y){var j=this.demuxer.demux(S,C,!1,!this.config.progressive),Z=j.audioTrack,De=j.videoTrack,pe=j.id3Track,ke=j.textTrack;return{remuxResult:this.remuxer.remux(Z,De,pe,ke,C,O,!1,this.id),chunkMeta:Y}},I.transmuxSampleAes=function(S,C,O,Y,j){var Z=this;return this.demuxer.demuxSampleAes(S,C,O).then(function(De){return{remuxResult:Z.remuxer.remux(De.audioTrack,De.videoTrack,De.id3Track,De.textTrack,O,Y,!1,Z.id),chunkMeta:j}})},I.configureTransmuxer=function(S,C){for(var O,Y=this.config,j=this.observer,Z=this.typeSupported,De=this.vendor,pe=C.audioCodec,ke=C.defaultInitPts,Fe=C.duration,Qe=C.initSegmentData,$e=C.videoCodec,Ye=0,ot=Ne.length;Ye<ot;Ye++)if(Ne[Ye].demux.probe(S)){O=Ne[Ye];break}O||(te.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),O={demux:we,remux:ve});var Tt=this.demuxer,dt=this.remuxer,Ft=O.remux,Qt=O.demux;dt&&dt instanceof Ft||(this.remuxer=new Ft(j,Y,Z,De)),Tt&&Tt instanceof Qt||(this.demuxer=new Qt(j,Y,Z),this.probe=Qt.probe),this.resetInitSegment(Qe,pe,$e,Fe),this.resetInitialTimestamp(ke)},I.needsProbing=function(S,C,O){return!this.demuxer||!this.remuxer||C||O},I.getDecrypter=function(){var S=this.decrypter;return S||(S=this.decrypter=new U.default(this.observer,this.config)),S},R}(),Be=function(R){return{remuxResult:{},chunkMeta:R}};function rt(R){return"then"in R&&R.then instanceof Function}var pt=function(R,I,S,C,O){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=R,this.videoCodec=I,this.initSegmentData=S,this.duration=C,this.defaultInitPts=O},ct=function(R,I,S,C,O,Y){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=R,this.contiguous=I,this.accurateTimeOffset=S,this.trackSwitch=C,this.timeOffset=O,this.initSegmentChange=Y}},514:ht=>{ht.exports=void 0},973:(ht,Pe,Q)=>{"use strict";var Te,$;Q.r(Pe),Q.d(Pe,{ErrorDetails:()=>$,ErrorTypes:()=>Te}),function(U){U.NETWORK_ERROR="networkError",U.MEDIA_ERROR="mediaError",U.KEY_SYSTEM_ERROR="keySystemError",U.MUX_ERROR="muxError",U.OTHER_ERROR="otherError"}(Te||(Te={})),function(U){U.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",U.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",U.KEY_SYSTEM_NO_SESSION="keySystemNoSession",U.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",U.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",U.MANIFEST_LOAD_ERROR="manifestLoadError",U.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",U.MANIFEST_PARSING_ERROR="manifestParsingError",U.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",U.LEVEL_EMPTY_ERROR="levelEmptyError",U.LEVEL_LOAD_ERROR="levelLoadError",U.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",U.LEVEL_SWITCH_ERROR="levelSwitchError",U.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",U.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",U.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",U.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",U.FRAG_LOAD_ERROR="fragLoadError",U.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",U.FRAG_DECRYPT_ERROR="fragDecryptError",U.FRAG_PARSING_ERROR="fragParsingError",U.REMUX_ALLOC_ERROR="remuxAllocError",U.KEY_LOAD_ERROR="keyLoadError",U.KEY_LOAD_TIMEOUT="keyLoadTimeOut",U.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",U.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",U.BUFFER_APPEND_ERROR="bufferAppendError",U.BUFFER_APPENDING_ERROR="bufferAppendingError",U.BUFFER_STALLED_ERROR="bufferStalledError",U.BUFFER_FULL_ERROR="bufferFullError",U.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",U.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",U.INTERNAL_EXCEPTION="internalException",U.INTERNAL_ABORTED="aborted",U.UNKNOWN="unknown"}($||($={}))},851:(ht,Pe,Q)=>{"use strict";var Te;Q.r(Pe),Q.d(Pe,{Events:()=>Te}),function($){$.MEDIA_ATTACHING="hlsMediaAttaching",$.MEDIA_ATTACHED="hlsMediaAttached",$.MEDIA_DETACHING="hlsMediaDetaching",$.MEDIA_DETACHED="hlsMediaDetached",$.BUFFER_RESET="hlsBufferReset",$.BUFFER_CODECS="hlsBufferCodecs",$.BUFFER_CREATED="hlsBufferCreated",$.BUFFER_APPENDING="hlsBufferAppending",$.BUFFER_APPENDED="hlsBufferAppended",$.BUFFER_EOS="hlsBufferEos",$.BUFFER_FLUSHING="hlsBufferFlushing",$.BUFFER_FLUSHED="hlsBufferFlushed",$.MANIFEST_LOADING="hlsManifestLoading",$.MANIFEST_LOADED="hlsManifestLoaded",$.MANIFEST_PARSED="hlsManifestParsed",$.LEVEL_SWITCHING="hlsLevelSwitching",$.LEVEL_SWITCHED="hlsLevelSwitched",$.LEVEL_LOADING="hlsLevelLoading",$.LEVEL_LOADED="hlsLevelLoaded",$.LEVEL_UPDATED="hlsLevelUpdated",$.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",$.LEVELS_UPDATED="hlsLevelsUpdated",$.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",$.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",$.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",$.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",$.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",$.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",$.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",$.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",$.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",$.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",$.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",$.CUES_PARSED="hlsCuesParsed",$.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",$.INIT_PTS_FOUND="hlsInitPtsFound",$.FRAG_LOADING="hlsFragLoading",$.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",$.FRAG_LOADED="hlsFragLoaded",$.FRAG_DECRYPTED="hlsFragDecrypted",$.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",$.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",$.FRAG_PARSING_METADATA="hlsFragParsingMetadata",$.FRAG_PARSED="hlsFragParsed",$.FRAG_BUFFERED="hlsFragBuffered",$.FRAG_CHANGED="hlsFragChanged",$.FPS_DROP="hlsFpsDrop",$.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",$.ERROR="hlsError",$.DESTROYING="hlsDestroying",$.KEY_LOADING="hlsKeyLoading",$.KEY_LOADED="hlsKeyLoaded",$.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",$.BACK_BUFFER_REACHED="hlsBackBufferReached"}(Te||(Te={}))},392:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>Gi});var Te,$=Q(945),U=Q(965),c=Q(851),M=Q(973),_=Q(93),ie=Q(63),q=/^(\d+)x(\d+)$/,V=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,z=function(){function w(o){for(var u in typeof o=="string"&&(o=w.parseAttrList(o)),o)o.hasOwnProperty(u)&&(this[u]=o[u])}var b=w.prototype;return b.decimalInteger=function(o){var u=parseInt(this[o],10);return u>Number.MAX_SAFE_INTEGER?1/0:u},b.hexadecimalInteger=function(o){if(this[o]){var u=(this[o]||"0x").slice(2);u=(1&u.length?"0":"")+u;for(var g=new Uint8Array(u.length/2),p=0;p<u.length/2;p++)g[p]=parseInt(u.slice(2*p,2*p+2),16);return g}return null},b.hexadecimalIntegerAsNumber=function(o){var u=parseInt(this[o],16);return u>Number.MAX_SAFE_INTEGER?1/0:u},b.decimalFloatingPoint=function(o){return parseFloat(this[o])},b.optionalFloat=function(o,u){var g=this[o];return g?parseFloat(g):u},b.enumeratedString=function(o){return this[o]},b.bool=function(o){return this[o]==="YES"},b.decimalResolution=function(o){var u=q.exec(this[o]);if(u!==null)return{width:parseInt(u[1],10),height:parseInt(u[2],10)}},w.parseAttrList=function(o){var u,g={};for(V.lastIndex=0;(u=V.exec(o))!==null;){var p=u[2];p.indexOf('"')===0&&p.lastIndexOf('"')===p.length-1&&(p=p.slice(1,-1)),g[u[1]]=p}return g},w}();function ue(){return ue=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(w[u]=o[u])}return w},ue.apply(this,arguments)}function de(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}(function(w){w.ID="ID",w.CLASS="CLASS",w.START_DATE="START-DATE",w.DURATION="DURATION",w.END_DATE="END-DATE",w.END_ON_NEXT="END-ON-NEXT",w.PLANNED_DURATION="PLANNED-DURATION",w.SCTE35_OUT="SCTE35-OUT",w.SCTE35_IN="SCTE35-IN"})(Te||(Te={}));var te=function(){function w(u,g){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,g){var p=g.attr;for(var m in p)if(Object.prototype.hasOwnProperty.call(u,m)&&u[m]!==p[m]){_.logger.warn('DATERANGE tag attribute: "'+m+'" does not match for tags with ID: "'+u.ID+'"'),this._badValueForSameId=m;break}u=ue(new z({}),p,u)}if(this.attr=u,this._startDate=new Date(u[Te.START_DATE]),Te.END_DATE in this.attr){var h=new Date(this.attr[Te.END_DATE]);(0,U.isFiniteNumber)(h.getTime())&&(this._endDate=h)}}var b,o;return b=w,(o=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var u=this.duration;return u!==null?new Date(this._startDate.getTime()+1e3*u):null}},{key:"duration",get:function(){if(Te.DURATION in this.attr){var u=this.attr.decimalFloatingPoint(Te.DURATION);if((0,U.isFiniteNumber)(u))return u}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return Te.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(Te.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(Te.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,U.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&de(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}(),se=Q(923);function oe(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}var Ae=function(){function w(u){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=u}var b,o;return w.prototype.reloaded=function(u){if(!u)return this.advanced=!0,void(this.updated=!0);var g=this.lastPartSn-u.lastPartSn,p=this.lastPartIndex-u.lastPartIndex;this.updated=this.endSN!==u.endSN||!!p||!!g,this.advanced=this.endSN>u.endSN||g>0||g===0&&p>0,this.updated||this.advanced?this.misses=Math.floor(.6*u.misses):this.misses=u.misses+1,this.availabilityDelay=u.availabilityDelay},b=w,(o=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,U.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var u=this.driftEndTime-this.driftStartTime;return u>0?1e3*(this.driftEnd-this.driftStart)/u:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var u;return(u=this.partList)!==null&&u!==void 0&&u.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var u;return(u=this.fragments)!==null&&u!==void 0&&u.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var u;return(u=this.partList)!==null&&u!==void 0&&u.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var u;return(u=this.partList)!==null&&u!==void 0&&u.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&oe(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}(),be=Q(960),Oe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function P(w,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+w+'"')}var k=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,W=/#EXT-X-MEDIA:(.*)/g,K=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Re=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ie=/\.(mp4|m4s|m4v|m4a)$/i,we=function(){function w(){}return w.findGroup=function(b,o){for(var u=0;u<b.length;u++){var g=b[u];if(g.id===o)return g}},w.convertAVC1ToAVCOTI=function(b){var o=b.split(".");if(o.length>2){var u=o.shift()+".";return(u+=parseInt(o.shift()).toString(16))+("000"+parseInt(o.shift()).toString(16)).slice(-4)}return b},w.resolve=function(b,o){return $.buildAbsoluteURL(o,b,{alwaysNormalize:!0})},w.parseMasterPlaylist=function(b,o){var u,g=[],p=[],m={},h=!1;for(k.lastIndex=0;(u=k.exec(b))!=null;)if(u[1]){var y,T=new z(u[1]),L={attrs:T,bitrate:T.decimalInteger("AVERAGE-BANDWIDTH")||T.decimalInteger("BANDWIDTH"),name:T.NAME,url:w.resolve(u[2],o)},A=T.decimalResolution("RESOLUTION");A&&(L.width=A.width,L.height=A.height),B((T.CODECS||"").split(/[ ,]+/).filter(function(ae){return ae}),L),L.videoCodec&&L.videoCodec.indexOf("avc1")!==-1&&(L.videoCodec=w.convertAVC1ToAVCOTI(L.videoCodec)),(y=L.unknownCodecs)!==null&&y!==void 0&&y.length||p.push(L),g.push(L)}else if(u[3]){var N=new z(u[3]);N["DATA-ID"]&&(h=!0,m[N["DATA-ID"]]=N)}return{levels:p.length>0&&p.length<g.length?p:g,sessionData:h?m:null}},w.parseMasterPlaylistMedia=function(b,o,u,g){var p;g===void 0&&(g=[]);var m=[],h=0;for(W.lastIndex=0;(p=W.exec(b))!==null;){var y=new z(p[1]);if(y.TYPE===u){var T={attrs:y,bitrate:0,id:h++,groupId:y["GROUP-ID"],instreamId:y["INSTREAM-ID"],name:y.NAME||y.LANGUAGE||"",type:u,default:y.bool("DEFAULT"),autoselect:y.bool("AUTOSELECT"),forced:y.bool("FORCED"),lang:y.LANGUAGE,url:y.URI?w.resolve(y.URI,o):""};if(g.length){var L=w.findGroup(g,T.groupId)||g[0];le(T,L,"audioCodec"),le(T,L,"textCodec")}m.push(T)}}return m},w.parseLevelPlaylist=function(b,o,u,g,p){var m,h,y,T=new Ae(o),L=T.fragments,A=null,N=0,ae=0,fe=0,Se=0,Ce=null,_e=new se.Fragment(g,o),ft=-1,nt=!1;for(K.lastIndex=0,T.m3u8=b;(m=K.exec(b))!==null;){nt&&(nt=!1,(_e=new se.Fragment(g,o)).start=fe,_e.sn=N,_e.cc=Se,_e.level=u,A&&(_e.initSegment=A,_e.rawProgramDateTime=A.rawProgramDateTime,A.rawProgramDateTime=null));var We=m[1];if(We){_e.duration=parseFloat(We);var Je=(" "+m[2]).slice(1);_e.title=Je||null,_e.tagList.push(Je?["INF",We,Je]:["INF",We])}else if(m[3])(0,U.isFiniteNumber)(_e.duration)&&(_e.start=fe,y&&(_e.levelkey=y),_e.sn=N,_e.level=u,_e.cc=Se,_e.urlId=p,L.push(_e),_e.relurl=(" "+m[3]).slice(1),ee(_e,Ce),Ce=_e,fe+=_e.duration,N++,ae=0,nt=!0);else if(m[4]){var et=(" "+m[4]).slice(1);Ce?_e.setByteRange(et,Ce):_e.setByteRange(et)}else if(m[5])_e.rawProgramDateTime=(" "+m[5]).slice(1),_e.tagList.push(["PROGRAM-DATE-TIME",_e.rawProgramDateTime]),ft===-1&&(ft=L.length);else{if(!(m=m[0].match(Re))){_.logger.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<m.length&&m[h]===void 0;h++);var Ve=(" "+m[h]).slice(1),at=(" "+m[h+1]).slice(1),Rt=m[h+2]?(" "+m[h+2]).slice(1):"";switch(Ve){case"PLAYLIST-TYPE":T.type=at.toUpperCase();break;case"MEDIA-SEQUENCE":N=T.startSN=parseInt(at);break;case"SKIP":var $t=new z(at),Ct=$t.decimalInteger("SKIPPED-SEGMENTS");if((0,U.isFiniteNumber)(Ct)){T.skippedSegments=Ct;for(var qt=Ct;qt--;)L.unshift(null);N+=Ct}var or=$t.enumeratedString("RECENTLY-REMOVED-DATERANGES");or&&(T.recentlyRemovedDateranges=or.split("	"));break;case"TARGETDURATION":T.targetduration=parseFloat(at);break;case"VERSION":T.version=parseInt(at);break;case"EXTM3U":break;case"ENDLIST":T.live=!1;break;case"#":(at||Rt)&&_e.tagList.push(Rt?[at,Rt]:[at]);break;case"DISCONTINUITY":Se++,_e.tagList.push(["DIS"]);break;case"GAP":_e.tagList.push([Ve]);break;case"BITRATE":_e.tagList.push([Ve,at]);break;case"DATERANGE":var Bt=new z(at),Mt=new te(Bt,T.dateRanges[Bt.ID]);Mt.isValid||T.skippedSegments?T.dateRanges[Mt.id]=Mt:_.logger.warn('Ignoring invalid DATERANGE tag: "'+at+'"'),_e.tagList.push(["EXT-X-DATERANGE",at]);break;case"DISCONTINUITY-SEQUENCE":Se=parseInt(at);break;case"KEY":var nr,vr=new z(at),br=vr.enumeratedString("METHOD"),Lr=vr.URI,_r=vr.hexadecimalInteger("IV"),oi=vr.enumeratedString("KEYFORMATVERSIONS"),Ti=vr.enumeratedString("KEYID"),It=(nr=vr.enumeratedString("KEYFORMAT"))!=null?nr:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(It)>-1){_.logger.warn("Keyformat "+It+" is not supported from the manifest");continue}if(It!=="identity")continue;br&&(y=be.LevelKey.fromURL(o,Lr),Lr&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(br)>=0&&(y.method=br,y.keyFormat=It,Ti&&(y.keyID=Ti),oi&&(y.keyFormatVersions=oi),y.iv=_r));break;case"START":var Nt=new z(at).decimalFloatingPoint("TIME-OFFSET");(0,U.isFiniteNumber)(Nt)&&(T.startTimeOffset=Nt);break;case"MAP":var li=new z(at);if(_e.duration){var Vr=new se.Fragment(g,o);he(Vr,li,u,y),A=Vr,_e.initSegment=A,A.rawProgramDateTime&&!_e.rawProgramDateTime&&(_e.rawProgramDateTime=A.rawProgramDateTime)}else he(_e,li,u,y),A=_e,nt=!0;break;case"SERVER-CONTROL":var Fr=new z(at);T.canBlockReload=Fr.bool("CAN-BLOCK-RELOAD"),T.canSkipUntil=Fr.optionalFloat("CAN-SKIP-UNTIL",0),T.canSkipDateRanges=T.canSkipUntil>0&&Fr.bool("CAN-SKIP-DATERANGES"),T.partHoldBack=Fr.optionalFloat("PART-HOLD-BACK",0),T.holdBack=Fr.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ui=new z(at);T.partTarget=ui.decimalFloatingPoint("PART-TARGET");break;case"PART":var Mr=T.partList;Mr||(Mr=T.partList=[]);var jr=ae>0?Mr[Mr.length-1]:void 0,di=ae++,Ur=new se.Part(new z(at),_e,o,di,jr);Mr.push(Ur),_e.duration+=Ur.duration;break;case"PRELOAD-HINT":var Ri=new z(at);T.preloadHint=Ri;break;case"RENDITION-REPORT":var Si=new z(at);T.renditionReports=T.renditionReports||[],T.renditionReports.push(Si);break;default:_.logger.warn("line parsed but not handled: "+m)}}}Ce&&!Ce.relurl?(L.pop(),fe-=Ce.duration,T.partList&&(T.fragmentHint=Ce)):T.partList&&(ee(_e,Ce),_e.cc=Se,T.fragmentHint=_e);var Ki=L.length,$r=L[0],Hi=L[Ki-1];if((fe+=T.skippedSegments*T.targetduration)>0&&Ki&&Hi){T.averagetargetduration=fe/Ki;var en=Hi.sn;T.endSN=en!=="initSegment"?en:0,$r&&(T.startCC=$r.cc,$r.initSegment||T.fragments.every(function(ki){return ki.relurl&&(Er=ki.relurl,Ie.test((hi=(fi=$.parseURL(Er))===null||fi===void 0?void 0:fi.path)!=null?hi:""));var Er,hi,fi})&&(_.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(_e=new se.Fragment(g,o)).relurl=Hi.relurl,_e.level=u,_e.sn="initSegment",$r.initSegment=_e,T.needSidxRanges=!0))}else T.endSN=0,T.startCC=0;return T.fragmentHint&&(fe+=T.fragmentHint.duration),T.totalduration=fe,T.endCC=Se,ft>0&&function(ki,Er){for(var hi=ki[Er],fi=Er;fi--;){var _i=ki[fi];if(!_i)return;_i.programDateTime=hi.programDateTime-1e3*_i.duration,hi=_i}}(L,ft),T},w}();function B(w,b){["video","audio","text"].forEach(function(o){var u=w.filter(function(p){return function(m,h){var y=Oe[h];return!!y&&y[m.slice(0,4)]===!0}(p,o)});if(u.length){var g=u.filter(function(p){return p.lastIndexOf("avc1",0)===0||p.lastIndexOf("mp4a",0)===0});b[o+"Codec"]=g.length>0?g[0]:u[0],w=w.filter(function(p){return u.indexOf(p)===-1})}}),b.unknownCodecs=w}function le(w,b,o){var u=b[o];u&&(w[o]=u)}function ee(w,b){w.rawProgramDateTime?w.programDateTime=Date.parse(w.rawProgramDateTime):b!=null&&b.programDateTime&&(w.programDateTime=b.endProgramDateTime),(0,U.isFiniteNumber)(w.programDateTime)||(w.programDateTime=null,w.rawProgramDateTime=null)}function he(w,b,o,u){w.relurl=b.URI,b.BYTERANGE&&w.setByteRange(b.BYTERANGE),w.level=o,w.sn="initSegment",u&&(w.levelkey=u),w.initSegment=null}var G=Q(308);function xe(w,b){var o=w.url;return o!==void 0&&o.indexOf("data:")!==0||(o=b.url),o}const Ge=function(){function w(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var b=w.prototype;return b.startLoad=function(o){},b.stopLoad=function(){this.destroyInternalLoaders()},b.registerListeners=function(){var o=this.hls;o.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.on(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.unregisterListeners=function(){var o=this.hls;o.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.off(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.createInternalLoader=function(o){var u=this.hls.config,g=u.pLoader,p=u.loader,m=new(g||p)(u);return o.loader=m,this.loaders[o.type]=m,m},b.getInternalLoader=function(o){return this.loaders[o.type]},b.resetInternalLoader=function(o){this.loaders[o]&&delete this.loaders[o]},b.destroyInternalLoaders=function(){for(var o in this.loaders){var u=this.loaders[o];u&&u.destroy(),this.resetInternalLoader(o)}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onManifestLoading=function(o,u){var g=u.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:G.PlaylistContextType.MANIFEST,url:g,deliveryDirectives:null})},b.onLevelLoading=function(o,u){var g=u.id,p=u.level,m=u.url,h=u.deliveryDirectives;this.load({id:g,groupId:null,level:p,responseType:"text",type:G.PlaylistContextType.LEVEL,url:m,deliveryDirectives:h})},b.onAudioTrackLoading=function(o,u){var g=u.id,p=u.groupId,m=u.url,h=u.deliveryDirectives;this.load({id:g,groupId:p,level:null,responseType:"text",type:G.PlaylistContextType.AUDIO_TRACK,url:m,deliveryDirectives:h})},b.onSubtitleTrackLoading=function(o,u){var g=u.id,p=u.groupId,m=u.url,h=u.deliveryDirectives;this.load({id:g,groupId:p,level:null,responseType:"text",type:G.PlaylistContextType.SUBTITLE_TRACK,url:m,deliveryDirectives:h})},b.load=function(o){var u,g,p,m,h,y,T=this.hls.config,L=this.getInternalLoader(o);if(L){var A=L.context;if(A&&A.url===o.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+o.type),L.abort()}switch(o.type){case G.PlaylistContextType.MANIFEST:g=T.manifestLoadingMaxRetry,p=T.manifestLoadingTimeOut,m=T.manifestLoadingRetryDelay,h=T.manifestLoadingMaxRetryTimeout;break;case G.PlaylistContextType.LEVEL:case G.PlaylistContextType.AUDIO_TRACK:case G.PlaylistContextType.SUBTITLE_TRACK:g=0,p=T.levelLoadingTimeOut;break;default:g=T.levelLoadingMaxRetry,p=T.levelLoadingTimeOut,m=T.levelLoadingRetryDelay,h=T.levelLoadingMaxRetryTimeout}if(L=this.createInternalLoader(o),(u=o.deliveryDirectives)!==null&&u!==void 0&&u.part&&(o.type===G.PlaylistContextType.LEVEL&&o.level!==null?y=this.hls.levels[o.level].details:o.type===G.PlaylistContextType.AUDIO_TRACK&&o.id!==null?y=this.hls.audioTracks[o.id].details:o.type===G.PlaylistContextType.SUBTITLE_TRACK&&o.id!==null&&(y=this.hls.subtitleTracks[o.id].details),y)){var N=y.partTarget,ae=y.targetduration;N&&ae&&(p=Math.min(1e3*Math.max(3*N,.8*ae),p))}var fe={timeout:p,maxRetry:g,retryDelay:m,maxRetryDelay:h,highWaterMark:0},Se={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};L.load(o,fe,Se)},b.loadsuccess=function(o,u,g,p){if(p===void 0&&(p=null),g.isSidxRequest)return this.handleSidxRequest(o,g),void this.handlePlaylistLoaded(o,u,g,p);this.resetInternalLoader(g.type);var m=o.data;m.indexOf("#EXTM3U")===0?(u.parsing.start=performance.now(),m.indexOf("#EXTINF:")>0||m.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(o,u,g,p):this.handleMasterPlaylist(o,u,g,p)):this.handleManifestParsingError(o,g,"no EXTM3U delimiter",p)},b.loaderror=function(o,u,g){g===void 0&&(g=null),this.handleNetworkError(u,g,!1,o)},b.loadtimeout=function(o,u,g){g===void 0&&(g=null),this.handleNetworkError(u,g,!0)},b.handleMasterPlaylist=function(o,u,g,p){var m=this.hls,h=o.data,y=xe(o,g),T=we.parseMasterPlaylist(h,y),L=T.levels,A=T.sessionData;if(L.length){var N=L.map(function(_e){return{id:_e.attrs.AUDIO,audioCodec:_e.audioCodec}}),ae=L.map(function(_e){return{id:_e.attrs.SUBTITLES,textCodec:_e.textCodec}}),fe=we.parseMasterPlaylistMedia(h,y,"AUDIO",N),Se=we.parseMasterPlaylistMedia(h,y,"SUBTITLES",ae),Ce=we.parseMasterPlaylistMedia(h,y,"CLOSED-CAPTIONS");fe.length&&(fe.some(function(_e){return!_e.url})||!L[0].audioCodec||L[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),fe.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new z({}),bitrate:0,url:""}))),m.trigger(c.Events.MANIFEST_LOADED,{levels:L,audioTracks:fe,subtitles:Se,captions:Ce,url:y,stats:u,networkDetails:p,sessionData:A})}else this.handleManifestParsingError(o,g,"no level found in manifest",p)},b.handleTrackOrLevelPlaylist=function(o,u,g,p){var m=this.hls,h=g.id,y=g.level,T=g.type,L=xe(o,g),A=(0,U.isFiniteNumber)(h)?h:0,N=(0,U.isFiniteNumber)(y)?y:A,ae=function(ft){switch(ft.type){case G.PlaylistContextType.AUDIO_TRACK:return G.PlaylistLevelType.AUDIO;case G.PlaylistContextType.SUBTITLE_TRACK:return G.PlaylistLevelType.SUBTITLE;default:return G.PlaylistLevelType.MAIN}}(g),fe=we.parseLevelPlaylist(o.data,L,N,ae,A);if(fe.fragments.length){if(T===G.PlaylistContextType.MANIFEST){var Se={attrs:new z({}),bitrate:0,details:fe,name:"",url:L};m.trigger(c.Events.MANIFEST_LOADED,{levels:[Se],audioTracks:[],url:L,stats:u,networkDetails:p,sessionData:null})}if(u.parsing.end=performance.now(),fe.needSidxRanges){var Ce,_e=(Ce=fe.fragments[0].initSegment)===null||Ce===void 0?void 0:Ce.url;this.load({url:_e,isSidxRequest:!0,type:T,level:y,levelDetails:fe,id:h,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else g.levelDetails=fe,this.handlePlaylistLoaded(o,u,g,p)}else m.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:L,reason:"no fragments found in level",level:typeof g.level=="number"?g.level:void 0})},b.handleSidxRequest=function(o,u){var g=new Uint8Array(o.data),p=(0,ie.findBox)(g,["sidx"])[0];if(p){var m=(0,ie.parseSegmentIndex)(p);if(m){var h=m.references,y=u.levelDetails;h.forEach(function(T,L){var A=T.info,N=y.fragments[L];if(N.byteRange.length===0&&N.setByteRange(String(1+A.end-A.start)+"@"+String(A.start)),N.initSegment){var ae=(0,ie.findBox)(g,["moov"])[0],fe=ae?ae.length:null;N.initSegment.setByteRange(String(fe)+"@0")}})}}},b.handleManifestParsingError=function(o,u,g,p){this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:u.type===G.PlaylistContextType.MANIFEST,url:o.url,reason:g,response:o,context:u,networkDetails:p})},b.handleNetworkError=function(o,u,g,p){g===void 0&&(g=!1),_.logger.warn("[playlist-loader]: A network "+(g?"timeout":"error")+" occurred while loading "+o.type+" level: "+o.level+" id: "+o.id+' group-id: "'+o.groupId+'"');var m=M.ErrorDetails.UNKNOWN,h=!1,y=this.getInternalLoader(o);switch(o.type){case G.PlaylistContextType.MANIFEST:m=g?M.ErrorDetails.MANIFEST_LOAD_TIMEOUT:M.ErrorDetails.MANIFEST_LOAD_ERROR,h=!0;break;case G.PlaylistContextType.LEVEL:m=g?M.ErrorDetails.LEVEL_LOAD_TIMEOUT:M.ErrorDetails.LEVEL_LOAD_ERROR,h=!1;break;case G.PlaylistContextType.AUDIO_TRACK:m=g?M.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:M.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case G.PlaylistContextType.SUBTITLE_TRACK:m=g?M.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:M.ErrorDetails.SUBTITLE_LOAD_ERROR,h=!1}y&&this.resetInternalLoader(o.type);var T={type:M.ErrorTypes.NETWORK_ERROR,details:m,fatal:h,url:o.url,loader:y,context:o,networkDetails:u};p&&(T.response=p),this.hls.trigger(c.Events.ERROR,T)},b.handlePlaylistLoaded=function(o,u,g,p){var m=g.type,h=g.level,y=g.id,T=g.groupId,L=g.loader,A=g.levelDetails,N=g.deliveryDirectives;if(A!=null&&A.targetduration){if(L)switch(A.live&&(L.getCacheAge&&(A.ageHeader=L.getCacheAge()||0),L.getCacheAge&&!isNaN(A.ageHeader)||(A.ageHeader=0)),m){case G.PlaylistContextType.MANIFEST:case G.PlaylistContextType.LEVEL:this.hls.trigger(c.Events.LEVEL_LOADED,{details:A,level:h||0,id:y||0,stats:u,networkDetails:p,deliveryDirectives:N});break;case G.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,{details:A,id:y||0,groupId:T||"",stats:u,networkDetails:p,deliveryDirectives:N});break;case G.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADED,{details:A,id:y||0,groupId:T||"",stats:u,networkDetails:p,deliveryDirectives:N})}}else this.handleManifestParsingError(o,g,"invalid target duration",p)},w}();var qe=function(){function w(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this.registerListeners()}var b=w.prototype;return b.startLoad=function(o){},b.stopLoad=function(){this.destroyInternalLoaders()},b.registerListeners=function(){this.hls.on(c.Events.KEY_LOADING,this.onKeyLoading,this)},b.unregisterListeners=function(){this.hls.off(c.Events.KEY_LOADING,this.onKeyLoading)},b.destroyInternalLoaders=function(){for(var o in this.loaders){var u=this.loaders[o];u&&u.destroy()}this.loaders={}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onKeyLoading=function(o,u){var g=u.frag,p=g.type,m=this.loaders[p];if(g.decryptdata){var h=g.decryptdata.uri;if(h!==this.decrypturl||this.decryptkey===null){var y=this.hls.config;if(m&&(_.logger.warn("abort previous key loader for type:"+p),m.abort()),!h)return void _.logger.warn("key uri is falsy");var T=y.loader,L=g.loader=this.loaders[p]=new T(y);this.decrypturl=h,this.decryptkey=null;var A={url:h,frag:g,responseType:"arraybuffer"},N={timeout:y.fragLoadingTimeOut,maxRetry:0,retryDelay:y.fragLoadingRetryDelay,maxRetryDelay:y.fragLoadingMaxRetryTimeout,highWaterMark:0},ae={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};L.load(A,N,ae)}else this.decryptkey&&(g.decryptdata.key=this.decryptkey,this.hls.trigger(c.Events.KEY_LOADED,{frag:g}))}else _.logger.warn("Missing decryption data on fragment in onKeyLoading")},b.loadsuccess=function(o,u,g){var p=g.frag;p.decryptdata?(this.decryptkey=p.decryptdata.key=new Uint8Array(o.data),p.loader=null,delete this.loaders[p.type],this.hls.trigger(c.Events.KEY_LOADED,{frag:p})):_.logger.error("after key load, decryptdata unset")},b.loaderror=function(o,u){var g=u.frag,p=g.loader;p&&p.abort(),delete this.loaders[g.type],this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:g,response:o})},b.loadtimeout=function(o,u){var g=u.frag,p=g.loader;p&&p.abort(),delete this.loaders[g.type],this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:g})},w}();function it(w,b){var o;try{o=new Event("addtrack")}catch(u){(o=document.createEvent("Event")).initEvent("addtrack",!1,!1)}o.track=w,b.dispatchEvent(o)}var ye=Q(181),Ze=Q(856);function st(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Et=function(){var w=st();try{new w(0,Number.POSITIVE_INFINITY,"")}catch(b){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function lt(w,b){return w.getTime()/1e3-b}const vt=function(){function w(o){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=o,this._registerListeners()}var b=w.prototype;return b.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},b._registerListeners=function(){var o=this.hls;o.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},b._unregisterListeners=function(){var o=this.hls;o.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},b.onMediaAttached=function(o,u){this.media=u.media},b.onMediaDetaching=function(){this.id3Track&&(function(o){var u=o.mode;if(u==="disabled"&&(o.mode="hidden"),o.cues)for(var g=o.cues.length;g--;)o.removeCue(o.cues[g]);u==="disabled"&&(o.mode=u)}(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},b.onManifestLoading=function(){this.dateRangeCuesAppended={}},b.createTrack=function(o){var u=this.getID3Track(o.textTracks);return u.mode="hidden",u},b.getID3Track=function(o){if(this.media){for(var u=0;u<o.length;u++){var g=o[u];if(g.kind==="metadata"&&g.label==="id3")return it(g,this.media),g}return this.media.addTextTrack("metadata","id3")}},b.onFragParsingMetadata=function(o,u){if(this.media){var g=this.hls.config,p=g.enableEmsgMetadataCues,m=g.enableID3MetadataCues;if(p||m){u.frag;var h=u.samples;u.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=st(),T=0;T<h.length;T++){var L=h[T].type;if((L!==Ze.MetadataSchema.emsg||p)&&m){var A=ye.getID3Frames(h[T].data);if(A){var N=h[T].pts,ae=N+h[T].duration;ae>Et&&(ae=Et),ae-N<=0&&(ae=N+.25);for(var fe=0;fe<A.length;fe++){var Se=A[fe];if(!ye.isTimeStampFrame(Se)){this.updateId3CueEnds(N);var Ce=new y(N,ae,"");Ce.value=Se,L&&(Ce.type=L),this.id3Track.addCue(Ce)}}}}}}}},b.updateId3CueEnds=function(o){var u,g=(u=this.id3Track)===null||u===void 0?void 0:u.cues;if(g)for(var p=g.length;p--;){var m=g[p];m.startTime<o&&m.endTime===Et&&(m.endTime=o)}},b.onBufferFlushing=function(o,u){var g=u.startOffset,p=u.endOffset,m=u.type,h=this.id3Track,y=this.hls;if(y){var T=y.config,L=T.enableEmsgMetadataCues,A=T.enableID3MetadataCues;h&&(L||A)&&function(N,ae,fe,Se){var Ce=N.mode;if(Ce==="disabled"&&(N.mode="hidden"),N.cues&&N.cues.length>0)for(var _e=function(nt,We,Je){var et=[],Ve=function(Ct,qt){if(qt<Ct[0].startTime)return 0;var or=Ct.length-1;if(qt>Ct[or].endTime)return-1;for(var Bt=0,Mt=or;Bt<=Mt;){var nr=Math.floor((Mt+Bt)/2);if(qt<Ct[nr].startTime)Mt=nr-1;else{if(!(qt>Ct[nr].startTime&&Bt<or))return nr;Bt=nr+1}}return Ct[Bt].startTime-qt<qt-Ct[Mt].startTime?Bt:Mt}(nt,We);if(Ve>-1)for(var at=Ve,Rt=nt.length;at<Rt;at++){var $t=nt[at];if($t.startTime>=We&&$t.endTime<=Je)et.push($t);else if($t.startTime>Je)return et}return et}(N.cues,ae,fe),ft=0;ft<_e.length;ft++)Se&&!Se(_e[ft])||N.removeCue(_e[ft]);Ce==="disabled"&&(N.mode=Ce)}(h,g,p,m==="audio"?function(N){return N.type===Ze.MetadataSchema.audioId3&&A}:m==="video"?function(N){return N.type===Ze.MetadataSchema.emsg&&L}:function(N){return N.type===Ze.MetadataSchema.audioId3&&A||N.type===Ze.MetadataSchema.emsg&&L})}},b.onLevelUpdated=function(o,u){var g=this,p=u.details;if(this.media&&p.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var m=this.dateRangeCuesAppended,h=this.id3Track,y=p.dateRanges,T=Object.keys(y);if(h)for(var L=Object.keys(m).filter(function(ft){return!T.includes(ft)}),A=function(ft){var nt=L[ft];Object.keys(m[nt].cues).forEach(function(We){h.removeCue(m[nt].cues[We])}),delete m[nt]},N=L.length;N--;)A(N);var ae=p.fragments[p.fragments.length-1];if(T.length!==0&&(0,U.isFiniteNumber)(ae==null?void 0:ae.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var fe=ae.programDateTime/1e3-ae.start,Se=st(),Ce=function(ft){var nt=T[ft],We=y[nt],Je=m[nt],et=(Je==null?void 0:Je.cues)||{},Ve=(Je==null?void 0:Je.durationKnown)||!1,at=lt(We.startDate,fe),Rt=Et,$t=We.endDate;if($t)Rt=lt($t,fe),Ve=!0;else if(We.endOnNext&&!Ve){var Ct=T.reduce(function(br,Lr){var _r=y[Lr];return _r.class===We.class&&_r.id!==Lr&&_r.startDate>We.startDate&&br.push(_r),br},[]).sort(function(br,Lr){return br.startDate.getTime()-Lr.startDate.getTime()})[0];Ct&&(Rt=lt(Ct.startDate,fe),Ve=!0)}for(var qt,or=Object.keys(We.attr),Bt=0;Bt<or.length;Bt++){var Mt=or[Bt];if(Mt!==Te.ID&&Mt!==Te.CLASS&&Mt!==Te.START_DATE&&Mt!==Te.DURATION&&Mt!==Te.END_DATE&&Mt!==Te.END_ON_NEXT){var nr=et[Mt];if(nr)Ve&&!Je.durationKnown&&(nr.endTime=Rt);else{var vr=We.attr[Mt];nr=new Se(at,Rt,""),Mt!==Te.SCTE35_OUT&&Mt!==Te.SCTE35_IN||(qt=vr,vr=Uint8Array.from(qt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),nr.value={key:Mt,data:vr},nr.type=Ze.MetadataSchema.dateRange,g.id3Track.addCue(nr),et[Mt]=nr}}}m[nt]={cues:et,dateRange:We,durationKnown:Ve}},_e=0;_e<T.length;_e++)Ce(_e)}}},w}();function St(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}var gt,At=function(){function w(g){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var b,o,u=w.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},u.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.Events.ERROR,this.onError)},u.onMediaAttached=function(g,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},u.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},u.onLevelUpdated=function(g,p){var m=p.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},u.onError=function(g,p){p.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,_.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},u.timeupdate=function(){var g=this.media,p=this.levelDetails;if(g&&p){this.currentTime=g.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var h=this.config,y=h.lowLatencyMode,T=h.maxLiveSyncPlaybackRate;if(y&&T!==1){var L=this.targetLatency;if(L!==null){var A=m-L,N=A<Math.min(this.maxLatency,L+p.targetduration);if(p.live&&N&&A>.05&&this.forwardBufferLength>1){var ae=Math.min(2,Math.max(1,T)),fe=Math.round(2/(1+Math.exp(-.75*A-this.edgeStalled))*20)/20;g.playbackRate=Math.min(ae,Math.max(1,fe))}else g.playbackRate!==1&&g.playbackRate!==0&&(g.playbackRate=1)}}}}},u.estimateLiveEdge=function(){var g=this.levelDetails;return g===null?null:g.edge+g.age},u.computeLatency=function(){var g=this.estimateLiveEdge();return g===null?null:g-this.currentTime},b=w,(o=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var g=this.config,p=this.levelDetails;return g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:p?g.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var g=this.levelDetails;if(g===null)return null;var p=g.holdBack,m=g.partHoldBack,h=g.targetduration,y=this.config,T=y.liveSyncDuration,L=y.liveSyncDurationCount,A=y.lowLatencyMode,N=this.hls.userConfig,ae=A&&m||p;(N.liveSyncDuration||N.liveSyncDurationCount||ae===0)&&(ae=T!==void 0?T:L*h);var fe=h;return ae+Math.min(1*this.stallCount,fe)}},{key:"liveSyncPosition",get:function(){var g=this.estimateLiveEdge(),p=this.targetLatency,m=this.levelDetails;if(g===null||p===null||m===null)return null;var h=m.edge,y=g-p-this.edgeStalled,T=h-m.totalduration,L=h-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(T,y),L)}},{key:"drift",get:function(){var g=this.levelDetails;return g===null?1:g.drift}},{key:"edgeStalled",get:function(){var g=this.levelDetails;if(g===null)return 0;var p=3*(this.config.lowLatencyMode&&g.partTarget||g.targetduration);return Math.max(g.age-p,0)}},{key:"forwardBufferLength",get:function(){var g=this.media,p=this.levelDetails;if(!g||!p)return 0;var m=g.buffered.length;return(m?g.buffered.end(m-1):p.edge)-this.currentTime}}])&&St(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}();function Lt(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}(function(w){w.No="",w.Yes="YES",w.v2="v2"})(gt||(gt={}));var yt=function(){function w(b,o,u){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=b,this.part=o,this.skip=u}return w.prototype.addDirectives=function(b){var o=new self.URL(b);return this.msn!==void 0&&o.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&o.searchParams.set("_HLS_part",this.part.toString()),this.skip&&o.searchParams.set("_HLS_skip",this.skip),o.toString()},w}(),Ot=function(){function w(u){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[u.url],this.attrs=u.attrs,this.bitrate=u.bitrate,u.details&&(this.details=u.details),this.id=u.id||0,this.name=u.name,this.width=u.width||0,this.height=u.height||0,this.audioCodec=u.audioCodec,this.videoCodec=u.videoCodec,this.unknownCodecs=u.unknownCodecs,this.codecSet=[u.videoCodec,u.audioCodec].filter(function(g){return g}).join(",").replace(/\.[^.,]+/g,"")}var b,o;return b=w,(o=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(u){var g=u%this.url.length;this._urlId!==g&&(this.details=void 0,this._urlId=g)}}])&&Lt(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}();function _t(){return _t=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(w[u]=o[u])}return w},_t.apply(this,arguments)}function Jt(w,b,o){switch(b){case"audio":w.audioGroupIds||(w.audioGroupIds=[]),w.audioGroupIds.push(o);break;case"text":w.textGroupIds||(w.textGroupIds=[]),w.textGroupIds.push(o)}}function Gt(w){var b={};w.forEach(function(o){var u=o.groupId||"";o.id=b[u]=b[u]||0,b[u]++})}function wt(w,b){var o=b.startPTS;if((0,U.isFiniteNumber)(o)){var u,g=0;b.sn>w.sn?(g=o-w.start,u=w):(g=w.start-o,u=b),u.duration!==g&&(u.duration=g)}else b.sn>w.sn?w.cc===b.cc&&w.minEndPTS?b.start=w.start+(w.minEndPTS-w.start):b.start=w.start+w.duration:b.start=Math.max(w.start-b.duration,0)}function tr(w,b,o,u,g,p){u-o<=0&&(_.logger.warn("Fragment should have a positive duration",b),u=o+b.duration,p=g+b.duration);var m=o,h=u,y=b.startPTS,T=b.endPTS;if((0,U.isFiniteNumber)(y)){var L=Math.abs(y-o);(0,U.isFiniteNumber)(b.deltaPTS)?b.deltaPTS=Math.max(L,b.deltaPTS):b.deltaPTS=L,m=Math.max(o,y),o=Math.min(o,y),g=Math.min(g,b.startDTS),h=Math.min(u,T),u=Math.max(u,T),p=Math.max(p,b.endDTS)}b.duration=u-o;var A=o-b.start;b.appendedPTS=u,b.start=b.startPTS=o,b.maxStartPTS=m,b.startDTS=g,b.endPTS=u,b.minEndPTS=h,b.endDTS=p;var N,ae=b.sn;if(!w||ae<w.startSN||ae>w.endSN)return 0;var fe=ae-w.startSN,Se=w.fragments;for(Se[fe]=b,N=fe;N>0;N--)wt(Se[N],Se[N-1]);for(N=fe;N<Se.length-1;N++)wt(Se[N],Se[N+1]);return w.fragmentHint&&wt(Se[Se.length-1],w.fragmentHint),w.PTSKnown=w.alignedSliding=!0,A}function Zt(w,b){var o=b.startSN+b.skippedSegments-w.startSN,u=w.fragments;o<0||o>=u.length||function(g,p){if(p){for(var m=g.fragments,h=g.skippedSegments;h<m.length;h++)m[h].start+=p;g.fragmentHint&&(g.fragmentHint.start+=p)}}(b,u[o].start)}var rr=function(){function w(o,u){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,u+":"),this.warn=_.logger.warn.bind(_.logger,u+":"),this.hls=o}var b=w.prototype;return b.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},b.onError=function(o,u){u.fatal&&u.type===M.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},b.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},b.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},b.stopLoad=function(){this.canLoad=!1,this.clearTimer()},b.switchParams=function(o,u){var g=u==null?void 0:u.renditionReports;if(g)for(var p=0;p<g.length;p++){var m=g[p],h=""+m.URI;if(h===o.slice(-h.length)){var y=parseInt(m["LAST-MSN"]),T=parseInt(m["LAST-PART"]);if(u&&this.hls.config.lowLatencyMode){var L=Math.min(u.age-u.partTarget,u.targetduration);T!==void 0&&L>u.partTarget&&(T+=1)}if((0,U.isFiniteNumber)(y))return new yt(y,(0,U.isFiniteNumber)(T)?T:void 0,gt.No)}}},b.loadPlaylist=function(o){},b.shouldLoadTrack=function(o){return this.canLoad&&o&&!!o.url&&(!o.details||o.details.live)},b.playlistLoaded=function(o,u,g){var p=this,m=u.details,h=u.stats,y=h.loading.end?Math.max(0,self.performance.now()-h.loading.end):0;if(m.advancedDateTime=Date.now()-y,m.live||g!=null&&g.live){if(m.reloaded(g),g&&this.log("live playlist "+o+" "+(m.advanced?"REFRESHED "+m.lastPartSn+"-"+m.lastPartIndex:"MISSED")),g&&m.fragments.length>0&&function(et,Ve){for(var at=null,Rt=et.fragments,$t=Rt.length-1;$t>=0;$t--){var Ct=Rt[$t].initSegment;if(Ct){at=Ct;break}}et.fragmentHint&&delete et.fragmentHint.endPTS;var qt,or,Bt,Mt,nr,vr=0;if(function(It,Nt,li){for(var Vr=Nt.skippedSegments,Fr=Math.max(It.startSN,Nt.startSN)-Nt.startSN,ui=(It.fragmentHint?1:0)+(Vr?Nt.endSN:Math.min(It.endSN,Nt.endSN))-Nt.startSN,Mr=Nt.startSN-It.startSN,jr=Nt.fragmentHint?Nt.fragments.concat(Nt.fragmentHint):Nt.fragments,di=It.fragmentHint?It.fragments.concat(It.fragmentHint):It.fragments,Ur=Fr;Ur<=ui;Ur++){var Ri=di[Mr+Ur],Si=jr[Ur];Vr&&!Si&&Ur<Vr&&(Si=Nt.fragments[Ur]=Ri),Ri&&Si&&li(Ri,Si)}}(et,Ve,function(It,Nt){It.relurl&&(vr=It.cc-Nt.cc),(0,U.isFiniteNumber)(It.startPTS)&&(0,U.isFiniteNumber)(It.endPTS)&&(Nt.start=Nt.startPTS=It.startPTS,Nt.startDTS=It.startDTS,Nt.appendedPTS=It.appendedPTS,Nt.maxStartPTS=It.maxStartPTS,Nt.endPTS=It.endPTS,Nt.endDTS=It.endDTS,Nt.minEndPTS=It.minEndPTS,Nt.duration=It.endPTS-It.startPTS,Nt.duration&&(qt=Nt),Ve.PTSKnown=Ve.alignedSliding=!0),Nt.elementaryStreams=It.elementaryStreams,Nt.loader=It.loader,Nt.stats=It.stats,Nt.urlId=It.urlId,It.initSegment&&(Nt.initSegment=It.initSegment,at=It.initSegment)}),at&&(Ve.fragmentHint?Ve.fragments.concat(Ve.fragmentHint):Ve.fragments).forEach(function(It){var Nt;It.initSegment&&It.initSegment.relurl!==((Nt=at)===null||Nt===void 0?void 0:Nt.relurl)||(It.initSegment=at)}),Ve.skippedSegments)if(Ve.deltaUpdateFailed=Ve.fragments.some(function(It){return!It}),Ve.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var br=Ve.skippedSegments;br--;)Ve.fragments.shift();Ve.startSN=Ve.fragments[0].sn,Ve.startCC=Ve.fragments[0].cc}else Ve.canSkipDateRanges&&(Ve.dateRanges=(or=et.dateRanges,Bt=Ve.dateRanges,Mt=Ve.recentlyRemovedDateranges,nr=_t({},or),Mt&&Mt.forEach(function(It){delete nr[It]}),Object.keys(Bt).forEach(function(It){var Nt=new te(Bt[It].attr,nr[It]);Nt.isValid?nr[It]=Nt:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Bt[It].attr)+'"')}),nr));var Lr=Ve.fragments;if(vr){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var _r=0;_r<Lr.length;_r++)Lr[_r].cc+=vr}Ve.skippedSegments&&(Ve.startCC=Ve.fragments[0].cc),function(It,Nt,li){if(It&&Nt)for(var Vr=0,Fr=0,ui=It.length;Fr<=ui;Fr++){var Mr=It[Fr],jr=Nt[Fr+Vr];Mr&&jr&&Mr.index===jr.index&&Mr.fragment.sn===jr.fragment.sn?(di=Mr,(Ur=jr).elementaryStreams=di.elementaryStreams,Ur.stats=di.stats):Vr--}var di,Ur}(et.partList,Ve.partList),qt?tr(Ve,qt,qt.startPTS,qt.endPTS,qt.startDTS,qt.endDTS):Zt(et,Ve),Lr.length&&(Ve.totalduration=Ve.edge-Lr[0].start),Ve.driftStartTime=et.driftStartTime,Ve.driftStart=et.driftStart;var oi=Ve.advancedDateTime;if(Ve.advanced&&oi){var Ti=Ve.edge;Ve.driftStart||(Ve.driftStartTime=oi,Ve.driftStart=Ti),Ve.driftEndTime=oi,Ve.driftEnd=Ti}else Ve.driftEndTime=et.driftEndTime,Ve.driftEnd=et.driftEnd,Ve.advancedDateTime=et.advancedDateTime}(g,m),!this.canLoad||!m.live)return;var T,L=void 0,A=void 0;if(m.canBlockReload&&m.endSN&&m.advanced){var N=this.hls.config.lowLatencyMode,ae=m.lastPartSn,fe=m.endSN,Se=m.lastPartIndex,Ce=ae===fe;Se!==-1?(L=Ce?fe+1:ae,A=Ce?N?0:Se:Se+1):L=fe+1;var _e=m.age,ft=_e+m.ageHeader,nt=Math.min(ft-m.partTarget,1.5*m.targetduration);if(nt>0){if(g&&nt>g.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+g.tuneInGoal+" to: "+nt+" with playlist age: "+m.age),nt=0;else{var We=Math.floor(nt/m.targetduration);L+=We,A!==void 0&&(A+=Math.round(nt%m.targetduration/m.partTarget)),this.log("CDN Tune-in age: "+m.ageHeader+"s last advanced "+_e.toFixed(2)+"s goal: "+nt+" skip sn "+We+" to part "+A)}m.tuneInGoal=nt}if(T=this.getDeliveryDirectives(m,u.deliveryDirectives,L,A),N||!Ce)return void this.loadPlaylist(T)}else T=this.getDeliveryDirectives(m,u.deliveryDirectives,L,A);var Je=function(et,Ve){var at,Rt=1e3*et.levelTargetDuration,$t=Rt/2,Ct=et.age,qt=Ct>0&&Ct<3*Rt,or=Ve.loading.end-Ve.loading.start,Bt=et.availabilityDelay;if(et.updated===!1)if(qt){var Mt=333*et.misses;at=Math.max(Math.min($t,2*or),Mt),et.availabilityDelay=(et.availabilityDelay||0)+at}else at=$t;else qt?(Bt=Math.min(Bt||Rt/2,Ct),et.availabilityDelay=Bt,at=Bt+Rt-Ct):at=Rt-or;return Math.round(at)}(m,h);L!==void 0&&m.canBlockReload&&(Je-=m.partTarget||1),this.log("reload live playlist "+o+" in "+Math.round(Je)+" ms"),this.timer=self.setTimeout(function(){return p.loadPlaylist(T)},Je)}else this.clearTimer()},b.getDeliveryDirectives=function(o,u,g,p){var m=function(h,y){var T=h.canSkipUntil,L=h.canSkipDateRanges,A=h.endSN;return T&&(y!==void 0?y-A:0)<T?L?gt.v2:gt.Yes:gt.No}(o,g);return u!=null&&u.skip&&o.deltaUpdateFailed&&(g=u.msn,p=u.part,m=gt.No),new yt(g,p,m)},b.retryLoadingOrFail=function(o){var u,g=this,p=this.hls.config,m=this.retryCount<p.levelLoadingMaxRetry;if(m)if(this.retryCount++,o.details.indexOf("LoadTimeOut")>-1&&(u=o.context)!==null&&u!==void 0&&u.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+o.details+'"'),this.loadPlaylist();else{var h=Math.min(Math.pow(2,this.retryCount)*p.levelLoadingRetryDelay,p.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return g.loadPlaylist()},h),this.warn("retry playlist loading #"+this.retryCount+" in "+h+' ms after "'+o.details+'"')}else this.warn('cannot recover from error "'+o.details+'"'),this.clearTimer(),o.fatal=!0;return m},w}();function lr(){return lr=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(w[u]=o[u])}return w},lr.apply(this,arguments)}function ur(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}function hr(w,b){return hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,u){return o.__proto__=u,o},hr(w,b)}var Xt,sr=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),Ee=function(w){var b,o;function u(h){var y;return(y=w.call(this,h,"[level-controller]")||this)._levels=[],y._firstLevel=-1,y._startLevel=void 0,y.currentLevelIndex=-1,y.manualLevelIndex=-1,y.onParsedComplete=void 0,y._registerListeners(),y}o=w,(b=u).prototype=Object.create(o.prototype),b.prototype.constructor=b,hr(b,o);var g,p,m=u.prototype;return m._registerListeners=function(){var h=this.hls;h.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(c.Events.ERROR,this.onError,this)},m._unregisterListeners=function(){var h=this.hls;h.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),h.off(c.Events.ERROR,this.onError,this)},m.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,w.prototype.destroy.call(this)},m.startLoad=function(){this._levels.forEach(function(h){h.loadError=0}),w.prototype.startLoad.call(this)},m.onManifestLoaded=function(h,y){var T,L,A=[],N=[],ae=[],fe={},Se=!1,Ce=!1,_e=!1;if(y.levels.forEach(function(Je){var et=Je.attrs;Se=Se||!(!Je.width||!Je.height),Ce=Ce||!!Je.videoCodec,_e=_e||!!Je.audioCodec,sr&&Je.audioCodec&&Je.audioCodec.indexOf("mp4a.40.34")!==-1&&(Je.audioCodec=void 0);var Ve=Je.bitrate+"-"+Je.attrs.RESOLUTION+"-"+Je.attrs.CODECS;(L=fe[Ve])?L.url.push(Je.url):(L=new Ot(Je),fe[Ve]=L,A.push(L)),et&&(et.AUDIO&&Jt(L,"audio",et.AUDIO),et.SUBTITLES&&Jt(L,"text",et.SUBTITLES))}),(Se||Ce)&&_e&&(A=A.filter(function(Je){var et=Je.videoCodec,Ve=Je.width,at=Je.height;return!!et||!(!Ve||!at)})),A=A.filter(function(Je){var et=Je.audioCodec,Ve=Je.videoCodec;return(!et||P(et,"audio"))&&(!Ve||P(Ve,"video"))}),y.audioTracks&&Gt(N=y.audioTracks.filter(function(Je){return!Je.audioCodec||P(Je.audioCodec,"audio")})),y.subtitles&&Gt(ae=y.subtitles),A.length>0){T=A[0].bitrate,A.sort(function(Je,et){return Je.bitrate-et.bitrate}),this._levels=A;for(var ft=0;ft<A.length;ft++)if(A[ft].bitrate===T){this._firstLevel=ft,this.log("manifest loaded, "+A.length+" level(s) found, first bitrate: "+T);break}var nt=_e&&!Ce,We={levels:A,audioTracks:N,subtitleTracks:ae,firstLevel:this._firstLevel,stats:y.stats,audio:_e,video:Ce,altAudio:!nt&&N.some(function(Je){return!!Je.url})};this.hls.trigger(c.Events.MANIFEST_PARSED,We),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:y.url,reason:"no level with compatible codecs found in manifest"})},m.onError=function(h,y){var T;if(w.prototype.onError.call(this,h,y),!y.fatal){var L=y.context,A=this._levels[this.currentLevelIndex];if(L&&(L.type===G.PlaylistContextType.AUDIO_TRACK&&A.audioGroupIds&&L.groupId===A.audioGroupIds[A.urlId]||L.type===G.PlaylistContextType.SUBTITLE_TRACK&&A.textGroupIds&&L.groupId===A.textGroupIds[A.urlId]))this.redundantFailover(this.currentLevelIndex);else{var N,ae=!1,fe=!0;switch(y.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:if(y.frag){var Se=y.frag.type===G.PlaylistLevelType.MAIN?y.frag.level:this.currentLevelIndex,Ce=this._levels[Se];Ce?(Ce.fragmentError++,Ce.fragmentError>this.hls.config.fragLoadingMaxRetry&&(N=Se)):N=Se}break;case M.ErrorDetails.LEVEL_LOAD_ERROR:case M.ErrorDetails.LEVEL_LOAD_TIMEOUT:L&&(L.deliveryDirectives&&(fe=!1),N=L.level),ae=!0;break;case M.ErrorDetails.REMUX_ALLOC_ERROR:N=(T=y.level)!=null?T:this.currentLevelIndex,ae=!0}N!==void 0&&this.recoverLevel(y,N,ae,fe)}}},m.recoverLevel=function(h,y,T,L){var A=h.details,N=this._levels[y];if(N.loadError++,T){if(!this.retryLoadingOrFail(h))return void(this.currentLevelIndex=-1);h.levelRetry=!0}if(L){var ae=N.url.length;if(ae>1&&N.loadError<ae)h.levelRetry=!0,this.redundantFailover(y);else if(this.manualLevelIndex===-1){for(var fe=-1,Se=this._levels,Ce=Se.length;Ce--;){var _e=(Ce+this.currentLevelIndex)%Se.length;if(_e!==this.currentLevelIndex&&Se[_e].loadError===0){fe=_e;break}}fe>-1&&this.currentLevelIndex!==fe&&(this.warn(A+": switch to "+fe),h.levelRetry=!0,this.hls.nextAutoLevel=fe)}}},m.redundantFailover=function(h){var y=this._levels[h],T=y.url.length;if(T>1){var L=(y.urlId+1)%T;this.warn("Switching to redundant URL-id "+L),this._levels.forEach(function(A){A.urlId=L}),this.level=h}},m.onFragLoaded=function(h,y){var T=y.frag;if(T!==void 0&&T.type===G.PlaylistLevelType.MAIN){var L=this._levels[T.level];L!==void 0&&(L.fragmentError=0,L.loadError=0)}},m.onLevelLoaded=function(h,y){var T,L,A=y.level,N=y.details,ae=this._levels[A];if(!ae)return this.warn("Invalid level index "+A),void((L=y.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(N.deltaUpdateFailed=!0));A===this.currentLevelIndex?(ae.fragmentError===0&&(ae.loadError=0,this.retryCount=0),this.playlistLoaded(A,y,ae.details)):(T=y.deliveryDirectives)!==null&&T!==void 0&&T.skip&&(N.deltaUpdateFailed=!0)},m.onAudioTrackSwitched=function(h,y){var T=this.hls.levels[this.currentLevelIndex];if(T&&T.audioGroupIds){for(var L=-1,A=this.hls.audioTracks[y.id].groupId,N=0;N<T.audioGroupIds.length;N++)if(T.audioGroupIds[N]===A){L=N;break}L!==T.urlId&&(T.urlId=L,this.startLoad())}},m.loadPlaylist=function(h){var y=this.currentLevelIndex,T=this._levels[y];if(this.canLoad&&T&&T.url.length>0){var L=T.urlId,A=T.url[L];if(h)try{A=h.addDirectives(A)}catch(N){this.warn("Could not construct new URL with HLS Delivery Directives: "+N)}this.log("Attempt loading level index "+y+(h?" at sn "+h.msn+" part "+h.part:"")+" with URL-id "+L+" "+A),this.clearTimer(),this.hls.trigger(c.Events.LEVEL_LOADING,{url:A,level:y,id:L,deliveryDirectives:h||null})}},m.removeLevel=function(h,y){var T=function(A,N){return N!==y},L=this._levels.filter(function(A,N){return N!==h||A.url.length>1&&y!==void 0&&(A.url=A.url.filter(T),A.audioGroupIds&&(A.audioGroupIds=A.audioGroupIds.filter(T)),A.textGroupIds&&(A.textGroupIds=A.textGroupIds.filter(T)),A.urlId=0,!0)}).map(function(A,N){var ae=A.details;return ae!=null&&ae.fragments&&ae.fragments.forEach(function(fe){fe.level=N}),A});this._levels=L,this.hls.trigger(c.Events.LEVELS_UPDATED,{levels:L})},g=u,(p=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(h){var y,T=this._levels;if(T.length!==0&&(this.currentLevelIndex!==h||(y=T[h])===null||y===void 0||!y.details)){if(h<0||h>=T.length){var L=h<0;if(this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.LEVEL_SWITCH_ERROR,level:h,fatal:L,reason:"invalid level idx"}),L)return;h=Math.min(h,T.length-1)}this.clearTimer();var A=this.currentLevelIndex,N=T[A],ae=T[h];this.log("switching to level "+h+" from "+A),this.currentLevelIndex=h;var fe=lr({},ae,{level:h,maxBitrate:ae.maxBitrate,uri:ae.uri,urlId:ae.urlId});delete fe._urlId,this.hls.trigger(c.Events.LEVEL_SWITCHING,fe);var Se=ae.details;if(!Se||Se.live){var Ce=this.switchParams(ae.uri,N==null?void 0:N.details);this.loadPlaylist(Ce)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(h){this.manualLevelIndex=h,this._startLevel===void 0&&(this._startLevel=h),h!==-1&&(this.level=h)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(h){this._firstLevel=h}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var h=this.hls.config.startLevel;return h!==void 0?h:this._firstLevel}return this._startLevel},set:function(h){this._startLevel=h}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(h){this.level=h,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=h)}}])&&ur(g.prototype,p),Object.defineProperty(g,"prototype",{writable:!1}),u}(rr);(function(w){w.NOT_LOADED="NOT_LOADED",w.APPENDING="APPENDING",w.PARTIAL="PARTIAL",w.OK="OK"})(Xt||(Xt={}));var ne=function(){function w(o){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=o,this._registerListeners()}var b=w.prototype;return b._registerListeners=function(){var o=this.hls;o.on(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),o.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.on(c.Events.FRAG_LOADED,this.onFragLoaded,this)},b._unregisterListeners=function(){var o=this.hls;o.off(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),o.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.off(c.Events.FRAG_LOADED,this.onFragLoaded,this)},b.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},b.getAppendedFrag=function(o,u){if(u===G.PlaylistLevelType.MAIN){var g=this.activeFragment,p=this.activeParts;if(!g)return null;if(p)for(var m=p.length;m--;){var h=p[m],y=h?h.end:g.appendedPTS;if(h.start<=o&&y!==void 0&&o<=y)return m>9&&(this.activeParts=p.slice(m-9)),h}else if(g.start<=o&&g.appendedPTS!==void 0&&o<=g.appendedPTS)return g}return this.getBufferedFrag(o,u)},b.getBufferedFrag=function(o,u){for(var g=this.fragments,p=Object.keys(g),m=p.length;m--;){var h=g[p[m]];if((h==null?void 0:h.body.type)===u&&h.buffered){var y=h.body;if(y.start<=o&&o<=y.end)return y}}return null},b.detectEvictedFragments=function(o,u,g){var p=this;Object.keys(this.fragments).forEach(function(m){var h=p.fragments[m];if(h)if(h.buffered){var y=h.range[o];y&&y.time.some(function(T){var L=!p.isTimeBuffered(T.startPTS,T.endPTS,u);return L&&p.removeFragment(h.body),L})}else h.body.type===g&&p.removeFragment(h.body)})},b.detectPartialFragments=function(o){var u=this,g=this.timeRanges,p=o.frag,m=o.part;if(g&&p.sn!=="initSegment"){var h=re(p),y=this.fragments[h];y&&(Object.keys(g).forEach(function(T){var L=p.elementaryStreams[T];if(L){var A=g[T],N=m!==null||L.partial===!0;y.range[T]=u.getBufferedTimes(p,m,N,A)}}),y.loaded=null,Object.keys(y.range).length?y.buffered=!0:this.removeFragment(y.body))}},b.fragBuffered=function(o){var u=re(o),g=this.fragments[u];g&&(g.loaded=null,g.buffered=!0)},b.getBufferedTimes=function(o,u,g,p){for(var m={time:[],partial:g},h=u?u.start:o.start,y=u?u.end:o.end,T=o.minEndPTS||y,L=o.maxStartPTS||h,A=0;A<p.length;A++){var N=p.start(A)-this.bufferPadding,ae=p.end(A)+this.bufferPadding;if(L>=N&&T<=ae){m.time.push({startPTS:Math.max(h,p.start(A)),endPTS:Math.min(y,p.end(A))});break}if(h<ae&&y>N)m.partial=!0,m.time.push({startPTS:Math.max(h,p.start(A)),endPTS:Math.min(y,p.end(A))});else if(y<=N)break}return m},b.getPartialFragment=function(o){var u,g,p,m=null,h=0,y=this.bufferPadding,T=this.fragments;return Object.keys(T).forEach(function(L){var A=T[L];A&&x(A)&&(g=A.body.start-y,p=A.body.end+y,o>=g&&o<=p&&(u=Math.min(o-g,p-o),h<=u&&(m=A.body,h=u)))}),m},b.getState=function(o){var u=re(o),g=this.fragments[u];return g?g.buffered?x(g)?Xt.PARTIAL:Xt.OK:Xt.APPENDING:Xt.NOT_LOADED},b.isTimeBuffered=function(o,u,g){for(var p,m,h=0;h<g.length;h++){if(p=g.start(h)-this.bufferPadding,m=g.end(h)+this.bufferPadding,o>=p&&u<=m)return!0;if(u<=p)return!1}return!1},b.onFragLoaded=function(o,u){var g=u.frag,p=u.part;if(g.sn!=="initSegment"&&!g.bitrateTest&&!p){var m=re(g);this.fragments[m]={body:g,loaded:u,buffered:!1,range:Object.create(null)}}},b.onBufferAppended=function(o,u){var g=this,p=u.frag,m=u.part,h=u.timeRanges;if(p.type===G.PlaylistLevelType.MAIN)if(this.activeFragment=p,m){var y=this.activeParts;y||(this.activeParts=y=[]),y.push(m)}else this.activeParts=null;this.timeRanges=h,Object.keys(h).forEach(function(T){var L=h[T];if(g.detectEvictedFragments(T,L),!m)for(var A=0;A<L.length;A++)p.appendedPTS=Math.max(L.end(A),p.appendedPTS||0)})},b.onFragBuffered=function(o,u){this.detectPartialFragments(u)},b.hasFragment=function(o){var u=re(o);return!!this.fragments[u]},b.removeFragmentsInRange=function(o,u,g){var p=this;Object.keys(this.fragments).forEach(function(m){var h=p.fragments[m];if(h&&h.buffered){var y=h.body;y.type===g&&y.start<u&&y.end>o&&p.removeFragment(y)}})},b.removeFragment=function(o){var u=re(o);o.stats.loaded=0,o.clearElementaryStreamInfo(),delete this.fragments[u]},b.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},w}();function x(w){var b,o;return w.buffered&&(((b=w.range.video)===null||b===void 0?void 0:b.partial)||((o=w.range.audio)===null||o===void 0?void 0:o.partial))}function re(w){return w.type+"_"+w.level+"_"+w.urlId+"_"+w.sn}var J=function(){function w(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=w.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(o){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,o),!0)},b.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},w}(),ce={length:0,start:function(){return 0},end:function(){return 0}},ve=function(){function w(){}return w.isBuffered=function(b,o){try{if(b){for(var u=w.getBuffered(b),g=0;g<u.length;g++)if(o>=u.start(g)&&o<=u.end(g))return!0}}catch(p){}return!1},w.bufferInfo=function(b,o,u){try{if(b){var g,p=w.getBuffered(b),m=[];for(g=0;g<p.length;g++)m.push({start:p.start(g),end:p.end(g)});return this.bufferedInfo(m,o,u)}}catch(h){}return{len:0,start:o,end:o,nextStart:void 0}},w.bufferedInfo=function(b,o,u){o=Math.max(0,o),b.sort(function(Se,Ce){return Se.start-Ce.start||Ce.end-Se.end});var g=[];if(u)for(var p=0;p<b.length;p++){var m=g.length;if(m){var h=g[m-1].end;b[p].start-h<u?b[p].end>h&&(g[m-1].end=b[p].end):g.push(b[p])}else g.push(b[p])}else g=b;for(var y,T=0,L=o,A=o,N=0;N<g.length;N++){var ae=g[N].start,fe=g[N].end;if(o+u>=ae&&o<fe)L=ae,T=(A=fe)-o;else if(o+u<ae){y=ae;break}}return{len:T,start:L||0,end:A||0,nextStart:y}},w.getBuffered=function(b){try{return b.buffered}catch(o){return _.logger.log("failed to get media.buffered",o),ce}},w}(),Le=function(w,b,o,u,g,p){u===void 0&&(u=0),g===void 0&&(g=-1),p===void 0&&(p=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=w,this.sn=b,this.id=o,this.size=u,this.part=g,this.partial=p};function Ne(w,b){if(w){var o=w.start+b;w.start=w.startPTS=o,w.endPTS=o+w.duration}}function ze(w,b){for(var o=b.fragments,u=0,g=o.length;u<g;u++)Ne(o[u],w);b.fragmentHint&&Ne(b.fragmentHint,w),b.alignedSliding=!0}const Be=function(w,b){for(var o=0,u=w.length-1,g=null,p=null;o<=u;){var m=b(p=w[g=(o+u)/2|0]);if(m>0)o=g+1;else{if(!(m<0))return p;u=g-1}}return null};function rt(w,b,o){w===void 0&&(w=0),b===void 0&&(b=0);var u=Math.min(b,o.duration+(o.deltaPTS?o.deltaPTS:0));return o.start+o.duration-u<=w?1:o.start-u>w&&o.start?-1:0}function pt(w,b,o){var u=1e3*Math.min(b,o.duration+(o.deltaPTS?o.deltaPTS:0));return(o.endProgramDateTime||0)-u>w}function ct(w){var b=typeof Map=="function"?new Map:void 0;return ct=function(o){if(o===null||(u=o,Function.toString.call(u).indexOf("[native code]")===-1))return o;var u;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(b!==void 0){if(b.has(o))return b.get(o);b.set(o,g)}function g(){return R(o,arguments,C(this).constructor)}return g.prototype=Object.create(o.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),S(g,o)},ct(w)}function R(w,b,o){return R=I()?Reflect.construct.bind():function(u,g,p){var m=[null];m.push.apply(m,g);var h=new(Function.bind.apply(u,m));return p&&S(h,p.prototype),h},R.apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(w){return!1}}function S(w,b){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,u){return o.__proto__=u,o},S(w,b)}function C(w){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(b){return b.__proto__||Object.getPrototypeOf(b)},C(w)}var O=Math.pow(2,17),Y=function(){function w(o){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=o}var b=w.prototype;return b.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},b.abort=function(){this.loader&&this.loader.abort()},b.load=function(o,u){var g=this,p=o.url;if(!p)return Promise.reject(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,networkDetails:null},"Fragment does not have a "+(p?"part list":"url")));this.abort();var m=this.config,h=m.fLoader,y=m.loader;return new Promise(function(T,L){g.loader&&g.loader.destroy();var A=g.loader=o.loader=h?new h(m):new y(m),N=j(o),ae={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:m.fragLoadingMaxRetryTimeout,highWaterMark:o.sn==="initSegment"?1/0:O};o.stats=A.stats,A.load(N,ae,{onSuccess:function(fe,Se,Ce,_e){g.resetLoader(o,A),T({frag:o,part:null,payload:fe.data,networkDetails:_e})},onError:function(fe,Se,Ce){g.resetLoader(o,A),L(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,response:fe,networkDetails:Ce}))},onAbort:function(fe,Se,Ce){g.resetLoader(o,A),L(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:o,networkDetails:Ce}))},onTimeout:function(fe,Se,Ce){g.resetLoader(o,A),L(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,networkDetails:Ce}))},onProgress:function(fe,Se,Ce,_e){u&&u({frag:o,part:null,payload:Ce,networkDetails:_e})}})})},b.loadPart=function(o,u,g){var p=this;this.abort();var m=this.config,h=m.fLoader,y=m.loader;return new Promise(function(T,L){p.loader&&p.loader.destroy();var A=p.loader=o.loader=h?new h(m):new y(m),N=j(o,u),ae={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:m.fragLoadingMaxRetryTimeout,highWaterMark:O};u.stats=A.stats,A.load(N,ae,{onSuccess:function(fe,Se,Ce,_e){p.resetLoader(o,A),p.updateStatsFromPart(o,u);var ft={frag:o,part:u,payload:fe.data,networkDetails:_e};g(ft),T(ft)},onError:function(fe,Se,Ce){p.resetLoader(o,A),L(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,part:u,response:fe,networkDetails:Ce}))},onAbort:function(fe,Se,Ce){o.stats.aborted=u.stats.aborted,p.resetLoader(o,A),L(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:o,part:u,networkDetails:Ce}))},onTimeout:function(fe,Se,Ce){p.resetLoader(o,A),L(new Z({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,part:u,networkDetails:Ce}))}})})},b.updateStatsFromPart=function(o,u){var g=o.stats,p=u.stats,m=p.total;if(g.loaded+=p.loaded,m){var h=Math.round(o.duration/u.duration),y=Math.min(Math.round(g.loaded/m),h),T=(h-y)*Math.round(g.loaded/y);g.total=g.loaded+T}else g.total=Math.max(g.loaded,g.total);var L=g.loading,A=p.loading;L.start?L.first+=A.first-A.start:(L.start=A.start,L.first=A.first),L.end=A.end},b.resetLoader=function(o,u){o.loader=null,this.loader===u&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),u.destroy()},w}();function j(w,b){b===void 0&&(b=null);var o=b||w,u={frag:w,part:b,responseType:"arraybuffer",url:o.url,headers:{},rangeStart:0,rangeEnd:0},g=o.byteRangeStartOffset,p=o.byteRangeEndOffset;return(0,U.isFiniteNumber)(g)&&(0,U.isFiniteNumber)(p)&&(u.rangeStart=g,u.rangeEnd=p),u}var Z=function(w){var b,o;function u(g){for(var p,m=arguments.length,h=new Array(m>1?m-1:0),y=1;y<m;y++)h[y-1]=arguments[y];return(p=w.call.apply(w,[this].concat(h))||this).data=void 0,p.data=g,p}return o=w,(b=u).prototype=Object.create(o.prototype),b.prototype.constructor=b,S(b,o),u}(ct(Error)),De=Q(21);const pe=function(w){for(var b="",o=w.length,u=0;u<o;u++)b+="["+w.start(u).toFixed(3)+","+w.end(u).toFixed(3)+"]";return b};function ke(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}function Fe(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function Qe(w,b){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,u){return o.__proto__=u,o},Qe(w,b)}var $e="STOPPED",Ye="IDLE",ot="KEY_LOADING",Tt="FRAG_LOADING",dt="FRAG_LOADING_WAITING_RETRY",Ft="PARSING",Qt="PARSED",Pt="ENDED",mt="ERROR",Vt="WAITING_LEVEL",bt=function(w){var b,o;function u(h,y,T){var L;return(L=w.call(this)||this).hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=$e,L.media=null,L.mediaBuffer=null,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=T,L.log=_.logger.log.bind(_.logger,T+":"),L.warn=_.logger.warn.bind(_.logger,T+":"),L.hls=h,L.fragmentLoader=new Y(h.config),L.fragmentTracker=y,L.config=h.config,L.decrypter=new De.default(h,h.config),h.on(c.Events.KEY_LOADED,L.onKeyLoaded,Fe(L)),h.on(c.Events.LEVEL_SWITCHING,L.onLevelSwitching,Fe(L)),L}o=w,(b=u).prototype=Object.create(o.prototype),b.prototype.constructor=b,Qe(b,o);var g,p,m=u.prototype;return m.doTick=function(){this.onTickEnd()},m.onTickEnd=function(){},m.startLoad=function(h){},m.stopLoad=function(){this.fragmentLoader.abort();var h=this.fragCurrent;h&&this.fragmentTracker.removeFragment(h),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$e},m._streamEnded=function(h,y){var T=this.fragCurrent,L=this.fragmentTracker;if(!y.live&&T&&this.media&&T.sn>=y.endSN&&!h.nextStart){var A=y.partList;if(A!=null&&A.length){var N=A[A.length-1];return ve.isBuffered(this.media,N.start+N.duration/2)}var ae=L.getState(T);return ae===Xt.PARTIAL||ae===Xt.OK}return!1},m.onMediaAttached=function(h,y){var T=this.media=this.mediaBuffer=y.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),T.addEventListener("seeking",this.onvseeking),T.addEventListener("ended",this.onvended);var L=this.config;this.levels&&L.autoStartLoad&&this.state===$e&&this.startLoad(L.startPosition)},m.onMediaDetaching=function(){var h=this.media;h!=null&&h.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),h&&this.onvseeking&&this.onvended&&(h.removeEventListener("seeking",this.onvseeking),h.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},m.onMediaSeeking=function(){var h=this.config,y=this.fragCurrent,T=this.media,L=this.mediaBuffer,A=this.state,N=T?T.currentTime:0,ae=ve.bufferInfo(L||T,N,h.maxBufferHole);if(this.log("media seeking to "+((0,U.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+A),A===Pt)this.resetLoadingState();else if(y){var fe=h.maxFragLookUpTolerance,Se=y.start-fe,Ce=y.start+y.duration+fe;if(!ae.len||Ce<ae.start||Se>ae.end){var _e=N>Ce;(N<Se||_e)&&(_e&&y.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),y.loader.abort()),this.resetLoadingState())}}T&&(this.lastCurrentTime=N),this.loadedmetadata||ae.len||(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},m.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},m.onKeyLoaded=function(h,y){if(this.state===ot&&y.frag===this.fragCurrent&&this.levels){this.state=Ye;var T=this.levels[y.frag.level].details;T&&this.loadFragment(y.frag,T,y.frag.start)}},m.onLevelSwitching=function(h,y){this.fragLoadError=0},m.onHandlerDestroying=function(){this.stopLoad(),w.prototype.onHandlerDestroying.call(this)},m.onHandlerDestroyed=function(){this.state=$e,this.hls.off(c.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,w.prototype.onHandlerDestroyed.call(this)},m.loadKey=function(h,y){this.log("Loading key for "+h.sn+" of ["+y.startSN+"-"+y.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+h.level),this.state=ot,this.fragCurrent=h,this.hls.trigger(c.Events.KEY_LOADING,{frag:h})},m.loadFragment=function(h,y,T){this._loadFragForPlayback(h,y,T)},m._loadFragForPlayback=function(h,y,T){var L=this;this._doFragLoad(h,y,T,function(A){if(L.fragContextChanged(h))return L.warn("Fragment "+h.sn+(A.part?" p: "+A.part.index:"")+" of level "+h.level+" was dropped during download."),void L.fragmentTracker.removeFragment(h);h.stats.chunkCount++,L._handleFragmentLoadProgress(A)}).then(function(A){if(A){L.fragLoadError=0;var N=L.state;L.fragContextChanged(h)?(N===Tt||!L.fragCurrent&&N===Ft)&&(L.fragmentTracker.removeFragment(h),L.state=Ye):("payload"in A&&(L.log("Loaded fragment "+h.sn+" of level "+h.level),L.hls.trigger(c.Events.FRAG_LOADED,A)),L._handleFragmentLoadComplete(A))}}).catch(function(A){L.state!==$e&&L.state!==mt&&(L.warn(A),L.resetFragmentLoading(h))})},m.flushMainBuffer=function(h,y,T){if(T===void 0&&(T=null),h-y){var L={startOffset:h,endOffset:y,type:T};this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,L)}},m._loadInitSegment=function(h){var y=this;this._doFragLoad(h).then(function(T){if(!T||y.fragContextChanged(h)||!y.levels)throw new Error("init load aborted");return T}).then(function(T){var L=y.hls,A=T.payload,N=h.decryptdata;if(A&&A.byteLength>0&&N&&N.key&&N.iv&&N.method==="AES-128"){var ae=self.performance.now();return y.decrypter.webCryptoDecrypt(new Uint8Array(A),N.key.buffer,N.iv.buffer).then(function(fe){var Se=self.performance.now();return L.trigger(c.Events.FRAG_DECRYPTED,{frag:h,payload:fe,stats:{tstart:ae,tdecrypt:Se}}),T.payload=fe,T})}return T}).then(function(T){var L=y.fragCurrent,A=y.hls,N=y.levels;if(!N)throw new Error("init load aborted, missing levels");N[h.level].details;var ae=h.stats;y.state=Ye,y.fragLoadError=0,h.data=new Uint8Array(T.payload),ae.parsing.start=ae.buffering.start=self.performance.now(),ae.parsing.end=ae.buffering.end=self.performance.now(),T.frag===L&&A.trigger(c.Events.FRAG_BUFFERED,{stats:ae,frag:L,part:null,id:h.type}),y.tick()}).catch(function(T){y.state!==$e&&y.state!==mt&&(y.warn(T),y.resetFragmentLoading(h))})},m.fragContextChanged=function(h){var y=this.fragCurrent;return!h||!y||h.level!==y.level||h.sn!==y.sn||h.urlId!==y.urlId},m.fragBufferedComplete=function(h,y){var T,L,A=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+h.type+" sn: "+h.sn+(y?" part: "+y.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+h.level+" "+(A?pe(ve.getBuffered(A)):"(detached)")),this.state=Ye,A&&(!this.loadedmetadata&&h.type==G.PlaylistLevelType.MAIN&&A.buffered.length&&((T=this.fragCurrent)===null||T===void 0?void 0:T.sn)===((L=this.fragPrevious)===null||L===void 0?void 0:L.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},m.seekToStartPos=function(){},m._handleFragmentLoadComplete=function(h){var y=this.transmuxer;if(y){var T=h.frag,L=h.part,A=h.partsLoaded,N=!A||A.length===0||A.some(function(fe){return!fe}),ae=new Le(T.level,T.sn,T.stats.chunkCount+1,0,L?L.index:-1,!N);y.flush(ae)}},m._handleFragmentLoadProgress=function(h){},m._doFragLoad=function(h,y,T,L){var A=this;if(T===void 0&&(T=null),!this.levels)throw new Error("frag load aborted, missing levels");if(T=Math.max(h.start,T||0),this.config.lowLatencyMode&&y){var N=y.partList;if(N&&L){T>h.end&&y.fragmentHint&&(h=y.fragmentHint);var ae=this.getNextPart(N,h,T);if(ae>-1){var fe=N[ae];return this.log("Loading part sn: "+h.sn+" p: "+fe.index+" cc: "+h.cc+" of playlist ["+y.startSN+"-"+y.endSN+"] parts [0-"+ae+"-"+(N.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+h.level+", target: "+parseFloat(T.toFixed(3))),this.nextLoadPosition=fe.start+fe.duration,this.state=Tt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:h,part:N[ae],targetBufferTime:T}),this.doFragPartsLoad(h,N,ae,L).catch(function(Se){return A.handleFragLoadError(Se)})}if(!h.url||this.loadedEndOfParts(N,T))return Promise.resolve(null)}}return this.log("Loading fragment "+h.sn+" cc: "+h.cc+" "+(y?"of ["+y.startSN+"-"+y.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+h.level+", target: "+parseFloat(T.toFixed(3))),(0,U.isFiniteNumber)(h.sn)&&!this.bitrateTest&&(this.nextLoadPosition=h.start+h.duration),this.state=Tt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:h,targetBufferTime:T}),this.fragmentLoader.load(h,L).catch(function(Se){return A.handleFragLoadError(Se)})},m.doFragPartsLoad=function(h,y,T,L){var A=this;return new Promise(function(N,ae){var fe=[];(function Se(Ce){var _e=y[Ce];A.fragmentLoader.loadPart(h,_e,L).then(function(ft){fe[_e.index]=ft;var nt=ft.part;A.hls.trigger(c.Events.FRAG_LOADED,ft);var We=y[Ce+1];if(!We||We.fragment!==h)return N({frag:h,part:nt,partsLoaded:fe});Se(Ce+1)}).catch(ae)})(T)})},m.handleFragLoadError=function(h){var y=h.data;return y&&y.details===M.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(y.frag,y.part):this.hls.trigger(c.Events.ERROR,y),null},m._handleTransmuxerFlush=function(h){var y=this.getCurrentContext(h);if(y&&this.state===Ft){var T=y.frag,L=y.part,A=y.level,N=self.performance.now();T.stats.parsing.end=N,L&&(L.stats.parsing.end=N),this.updateLevelTiming(T,L,A,h.partial)}else this.fragCurrent||(this.state=Ye)},m.getCurrentContext=function(h){var y=this.levels,T=h.level,L=h.sn,A=h.part;if(!y||!y[T])return this.warn("Levels object was unset while buffering fragment "+L+" of level "+T+". The current chunk will not be buffered."),null;var N=y[T],ae=A>-1?function(Se,Ce,_e){if(!Se||!Se.details)return null;var ft=Se.details.partList;if(ft)for(var nt=ft.length;nt--;){var We=ft[nt];if(We.index===_e&&We.fragment.sn===Ce)return We}return null}(N,L,A):null,fe=ae?ae.fragment:function(Se,Ce,_e){if(!Se||!Se.details)return null;var ft=Se.details,nt=ft.fragments[Ce-ft.startSN];return nt||((nt=ft.fragmentHint)&&nt.sn===Ce?nt:Ce<ft.startSN&&_e&&_e.sn===Ce?_e:null)}(N,L,this.fragCurrent);return fe?{frag:fe,part:ae,level:N}:null},m.bufferFragmentData=function(h,y,T,L){if(h&&this.state===Ft){var A=h.data1,N=h.data2,ae=A;if(A&&N&&(ae=(0,ie.appendUint8Array)(A,N)),ae&&ae.length){var fe={type:h.type,frag:y,part:T,chunkMeta:L,parent:y.type,data:ae};this.hls.trigger(c.Events.BUFFER_APPENDING,fe),h.dropped&&h.independent&&!T&&this.flushBufferGap(y)}}},m.flushBufferGap=function(h){var y=this.media;if(y)if(ve.isBuffered(y,y.currentTime)){var T=y.currentTime,L=ve.bufferInfo(y,T,0),A=h.duration,N=Math.min(2*this.config.maxFragLookUpTolerance,.25*A),ae=Math.max(Math.min(h.start-N,L.end-N),T+N);h.start-ae>N&&this.flushMainBuffer(ae,h.start)}else this.flushMainBuffer(0,h.start)},m.getFwdBufferInfo=function(h,y){var T=this.config,L=this.getLoadPosition();if(!(0,U.isFiniteNumber)(L))return null;var A=ve.bufferInfo(h,L,T.maxBufferHole);if(A.len===0&&A.nextStart!==void 0){var N=this.fragmentTracker.getBufferedFrag(L,y);if(N&&A.nextStart<N.end)return ve.bufferInfo(h,L,Math.max(A.nextStart,T.maxBufferHole))}return A},m.getMaxBufferLength=function(h){var y,T=this.config;return y=h?Math.max(8*T.maxBufferSize/h,T.maxBufferLength):T.maxBufferLength,Math.min(y,T.maxMaxBufferLength)},m.reduceMaxBufferLength=function(h){var y=this.config,T=h||y.maxBufferLength;return y.maxMaxBufferLength>=T&&(y.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+y.maxMaxBufferLength+"s"),!0)},m.getNextFragment=function(h,y){var T=y.fragments,L=T.length;if(!L)return null;var A,N=this.config,ae=T[0].start;if(y.live){var fe=N.initialLiveManifestSize;if(L<fe)return this.warn("Not enough fragments to start playback (have: "+L+", need: "+fe+")"),null;y.PTSKnown||this.startFragRequested||this.startPosition!==-1||(A=this.getInitialLiveFragment(y,T),this.startPosition=A?this.hls.liveSyncPosition||A.start:h)}else h<=ae&&(A=T[0]);if(!A){var Se=N.lowLatencyMode?y.partEnd:y.fragmentEnd;A=this.getFragmentAtPosition(h,Se,y)}return this.mapToInitFragWhenRequired(A)},m.mapToInitFragWhenRequired=function(h){return h==null||!h.initSegment||h!=null&&h.initSegment.data||this.bitrateTest?h:h.initSegment},m.getNextPart=function(h,y,T){for(var L=-1,A=!1,N=!0,ae=0,fe=h.length;ae<fe;ae++){var Se=h[ae];if(N=N&&!Se.independent,L>-1&&T<Se.start)break;var Ce=Se.loaded;!Ce&&(A||Se.independent||N)&&Se.fragment===y&&(L=ae),A=Ce}return L},m.loadedEndOfParts=function(h,y){var T=h[h.length-1];return T&&y>T.start&&T.loaded},m.getInitialLiveFragment=function(h,y){var T=this.fragPrevious,L=null;if(T){if(h.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+T.programDateTime),L=function(fe,Se,Ce){if(Se===null||!Array.isArray(fe)||!fe.length||!(0,U.isFiniteNumber)(Se)||Se<(fe[0].programDateTime||0)||Se>=(fe[fe.length-1].endProgramDateTime||0))return null;Ce=Ce||0;for(var _e=0;_e<fe.length;++_e){var ft=fe[_e];if(pt(Se,Ce,ft))return ft}return null}(y,T.endProgramDateTime,this.config.maxFragLookUpTolerance)),!L){var A=T.sn+1;if(A>=h.startSN&&A<=h.endSN){var N=y[A-h.startSN];T.cc===N.cc&&(L=N,this.log("Live playlist, switching playlist, load frag with next SN: "+L.sn))}L||(L=function(fe,Se){return Be(fe,function(Ce){return Ce.cc<Se?1:Ce.cc>Se?-1:0})}(y,T.cc),L&&this.log("Live playlist, switching playlist, load frag with same CC: "+L.sn))}}else{var ae=this.hls.liveSyncPosition;ae!==null&&(L=this.getFragmentAtPosition(ae,this.bitrateTest?h.fragmentEnd:h.edge,h))}return L},m.getFragmentAtPosition=function(h,y,T){var L,A=this.config,N=this.fragPrevious,ae=T.fragments,fe=T.endSN,Se=T.fragmentHint,Ce=A.maxFragLookUpTolerance,_e=!!(A.lowLatencyMode&&T.partList&&Se);if(_e&&Se&&!this.bitrateTest&&(ae=ae.concat(Se),fe=Se.sn),L=h<y?function(We,Je,et,Ve){et===void 0&&(et=0),Ve===void 0&&(Ve=0);var at=null;return We?at=Je[We.sn-Je[0].sn+1]||null:et===0&&Je[0].start===0&&(at=Je[0]),at&&rt(et,Ve,at)===0?at:Be(Je,rt.bind(null,et,Ve))||at}(N,ae,h,h>y-Ce?0:Ce):ae[ae.length-1],L){var ft=L.sn-T.startSN;if(this.fragmentTracker.getState(L)===Xt.OK&&(N=L),N&&L.sn===N.sn&&!_e&&N&&L.level===N.level){var nt=ae[ft+1];L.sn<fe&&this.fragmentTracker.getState(nt)!==Xt.OK?(this.log("SN "+L.sn+" just loaded, load next one: "+nt.sn),L=nt):L=null}}return L},m.synchronizeToLiveEdge=function(h){var y=this.config,T=this.media;if(T){var L=this.hls.liveSyncPosition,A=T.currentTime,N=h.fragments[0].start,ae=h.edge,fe=A>=N-y.maxFragLookUpTolerance&&A<=ae;if(L!==null&&T.duration>L&&(A<L||!fe)){var Se=y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:y.liveMaxLatencyDurationCount*h.targetduration;(!fe&&T.readyState<4||A<ae-Se)&&(this.loadedmetadata||(this.nextLoadPosition=L),T.readyState&&(this.warn("Playback: "+A.toFixed(3)+" is located too far from the end of live sliding playlist: "+ae+", reset currentTime to : "+L.toFixed(3)),T.currentTime=L))}}},m.alignPlaylists=function(h,y){var T=this.levels,L=this.levelLastLoaded,A=this.fragPrevious,N=L!==null?T[L]:null,ae=h.fragments.length;if(!ae)return this.warn("No fragments in live playlist"),0;var fe=h.fragments[0].start,Se=!y,Ce=h.alignedSliding&&(0,U.isFiniteNumber)(fe);if(Se||!Ce&&!fe){(function(ft,nt,We){nt&&(function(Je,et,Ve){if(function(Rt,$t,Ct){return!(!$t.details||!(Ct.endCC>Ct.startCC||Rt&&Rt.cc<Ct.startCC))}(Je,Ve,et)){var at=function(Rt,$t,Ct){Ct===void 0&&(Ct=0);var qt=Rt.fragments,or=$t.fragments;if(or.length&&qt.length){var Bt=function(Mt,nr){for(var vr=null,br=0,Lr=Mt.length;br<Lr;br++){var _r=Mt[br];if(_r&&_r.cc===nr){vr=_r;break}}return vr}(qt,or[0].cc);if(Bt&&(!Bt||Bt.startPTS))return Bt;_.logger.log("No frag in previous level to align on")}else _.logger.log("No fragments to align")}(Ve.details,et);at&&(0,U.isFiniteNumber)(at.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+et.url),ze(at.start,et))}}(ft,We,nt),!We.alignedSliding&&nt.details&&function(Je,et){if(et.fragments.length&&Je.hasProgramDateTime&&et.hasProgramDateTime){var Ve=et.fragments[0].programDateTime,at=Je.fragments[0].programDateTime,Rt=(at-Ve)/1e3+et.fragments[0].start;Rt&&(0,U.isFiniteNumber)(Rt)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(at-Ve)+"ms, sliding:"+Rt.toFixed(3)+" "+Je.url+" "),ze(Rt,Je))}}(We,nt.details),We.alignedSliding||!nt.details||We.skippedSegments||Zt(nt.details,We))})(A,N,h);var _e=h.fragments[0].start;return this.log("Live playlist sliding: "+_e.toFixed(2)+" start-sn: "+(y?y.startSN:"na")+"->"+h.startSN+" prev-sn: "+(A?A.sn:"na")+" fragments: "+ae),_e}return fe},m.waitForCdnTuneIn=function(h){return h.live&&h.canBlockReload&&h.partTarget&&h.tuneInGoal>Math.max(h.partHoldBack,3*h.partTarget)},m.setStartPosition=function(h,y){var T=this.startPosition;if(T<y&&(T=-1),T===-1||this.lastCurrentTime===-1){var L=h.startTimeOffset;(0,U.isFiniteNumber)(L)?(T=y+L,L<0&&(T+=h.totalduration),T=Math.min(Math.max(y,T),y+h.totalduration),this.log("Start time offset "+L+" found in playlist, adjust startPosition to "+T),this.startPosition=T):h.live?T=this.hls.liveSyncPosition||y:this.startPosition=T=0,this.lastCurrentTime=T}this.nextLoadPosition=T},m.getLoadPosition=function(){var h=this.media,y=0;return this.loadedmetadata&&h?y=h.currentTime:this.nextLoadPosition&&(y=this.nextLoadPosition),y},m.handleFragLoadAborted=function(h,y){this.transmuxer&&h.sn!=="initSegment"&&h.stats.aborted&&(this.warn("Fragment "+h.sn+(y?" part"+y.index:"")+" of level "+h.level+" was aborted"),this.resetFragmentLoading(h))},m.resetFragmentLoading=function(h){this.fragCurrent&&(this.fragContextChanged(h)||this.state===dt)||(this.state=Ye)},m.onFragmentOrKeyLoadError=function(h,y){if(!y.fatal){var T=y.frag;if(T&&T.type===h){this.fragCurrent;var L=this.config;if(this.fragLoadError+1<=L.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var A=Math.min(Math.pow(2,this.fragLoadError)*L.fragLoadingRetryDelay,L.fragLoadingMaxRetryTimeout);this.warn("Fragment "+T.sn+" of "+h+" "+T.level+" failed to load, retrying in "+A+"ms"),this.retryDate=self.performance.now()+A,this.fragLoadError++,this.state=dt}else y.levelRetry?(h===G.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Ye):(_.logger.error(y.details+" reaches max retry, redispatch as fatal ..."),y.fatal=!0,this.hls.stopLoad(),this.state=mt)}}},m.afterBufferFlushed=function(h,y,T){if(h){var L=ve.getBuffered(h);this.fragmentTracker.detectEvictedFragments(y,L,T),this.state===Pt&&this.resetLoadingState()}},m.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=Ye},m.resetStartWhenNotLoaded=function(h){if(!this.loadedmetadata){this.startFragRequested=!1;var y=this.levels?this.levels[h].details:null;y!=null&&y.live?(this.startPosition=-1,this.setStartPosition(y,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},m.updateLevelTiming=function(h,y,T,L){var A=this,N=T.details;Object.keys(h.elementaryStreams).reduce(function(ae,fe){var Se=h.elementaryStreams[fe];if(Se){var Ce=Se.endPTS-Se.startPTS;if(Ce<=0)return A.warn("Could not parse fragment "+h.sn+" "+fe+" duration reliably ("+Ce+")"),ae||!1;var _e=L?0:tr(N,h,Se.startPTS,Se.endPTS,Se.startDTS,Se.endDTS);return A.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:N,level:T,drift:_e,type:fe,frag:h,start:Se.startPTS,end:Se.endPTS}),!0}return ae},!1)||(this.warn("Found no media in fragment "+h.sn+" of level "+T.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=Qt,this.hls.trigger(c.Events.FRAG_PARSED,{frag:h,part:y})},m.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},g=u,(p=[{key:"state",get:function(){return this._state},set:function(h){var y=this._state;y!==h&&(this._state=h,this.log(y+"->"+h))}}])&&ke(g.prototype,p),Object.defineProperty(g,"prototype",{writable:!1}),u}(J);function zt(){return self.MediaSource||self.WebKitMediaSource}function dr(){return self.SourceBuffer||self.WebKitSourceBuffer}var jt=function(){var w=ENTRY_MODULE,b={},o=function g(p){var m=b[p];if(m!==void 0)return m.exports;var h=b[p]={exports:{}};return w[p].call(h.exports,h,h.exports,g),h.exports};o.m=w,o.n=function(g){var p=g&&g.__esModule?function(){return g.default}:function(){return g};return o.d(p,{a:p}),p},o.d=function(g,p){for(var m in p)o.o(p,m)&&!o.o(g,m)&&Object.defineProperty(g,m,{enumerable:!0,get:p[m]})},o.o=function(g,p){return Object.prototype.hasOwnProperty.call(g,p)},o.r=function(g){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var u=o(ENTRY_MODULE);return u.default||u}.toString().split("ENTRY_MODULE"),cr="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function yr(w){return(w+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function mr(w,b,o){var u={};u[o]=[];var g=b.toString().replace(/^"[^"]+"/,"function"),p=g.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||g.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!p)return u;for(var m,h=p[1],y=new RegExp("(\\\\n|\\W)"+yr(h)+cr,"g");m=y.exec(g);)m[3]!=="dll-reference"&&u[o].push(m[3]);for(y=new RegExp("\\("+yr(h)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+cr,"g");m=y.exec(g);)w[m[2]]||(u[o].push(m[1]),w[m[2]]=Q(m[1]).m),u[m[2]]=u[m[2]]||[],u[m[2]].push(m[4]);for(var T,L=Object.keys(u),A=0;A<L.length;A++)for(var N=0;N<u[L[A]].length;N++)T=u[L[A]][N],isNaN(1*T)||(u[L[A]][N]=1*u[L[A]][N]);return u}function ir(w){return Object.keys(w).reduce(function(b,o){return b||w[o].length>0},!1)}function gr(w,b,o,u){var g=w[u].map(function(p){return'"'+p+'": '+b[u][p].toString().replace(/^"[^"]+"/,"function")}).join(",");return jt[0]+"{"+g+"}"+jt[1]+'"'+o+'"'+jt[2]}var Ar=Q(764),Rr=Q(729),Br=zt()||{isTypeSupported:function(){return!1}},xr=function(){function w(o,u,g,p){var m=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var h=o.config;this.hls=o,this.id=u,this.useWorker=!!h.enableWorker,this.onTransmuxComplete=g,this.onFlush=p;var y=function(N,ae){(ae=ae||{}).frag=m.frag,ae.id=m.id,m.hls.trigger(N,ae)};this.observer=new Rr.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,y),this.observer.on(c.Events.ERROR,y);var T={mp4:Br.isTypeSupported("video/mp4"),mpeg:Br.isTypeSupported("audio/mpeg"),mp3:Br.isTypeSupported('audio/mp4; codecs="mp3"')},L=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){var A;_.logger.log("demuxing in webworker");try{A=this.worker=function(N,ae){ae=ae||{};var fe={main:Q.m},Se=ae.all?{main:Object.keys(fe.main)}:function(We,Je){for(var et={main:[Je]},Ve={main:[]},at={main:{}};ir(et);)for(var Rt=Object.keys(et),$t=0;$t<Rt.length;$t++){var Ct=Rt[$t],qt=et[Ct].pop();if(at[Ct]=at[Ct]||{},!at[Ct][qt]&&We[Ct][qt]){at[Ct][qt]=!0,Ve[Ct]=Ve[Ct]||[],Ve[Ct].push(qt);for(var or=mr(We,We[Ct][qt],Ct),Bt=Object.keys(or),Mt=0;Mt<Bt.length;Mt++)et[Bt[Mt]]=et[Bt[Mt]]||[],et[Bt[Mt]]=et[Bt[Mt]].concat(or[Bt[Mt]])}}return Ve}(fe,N),Ce="";Object.keys(Se).filter(function(We){return We!=="main"}).forEach(function(We){for(var Je=0;Se[We][Je];)Je++;Se[We].push(Je),fe[We][Je]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",Ce=Ce+"var "+We+" = ("+gr(Se,fe,Je,modules)+`)();
`}),Ce=Ce+"new (("+gr(Se,fe,N,"main")+")())(self);";var _e=new window.Blob([Ce],{type:"text/javascript"}),ft=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(_e),nt=new window.Worker(ft);return nt.objectURL=ft,nt}(182),this.onwmsg=this.onWorkerMessage.bind(this),A.addEventListener("message",this.onwmsg),A.onerror=function(N){m.useWorker=!1,_.logger.warn("Exception in webworker, fallback to inline"),m.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(N.message+"  ("+N.filename+":"+N.lineno+")")})},A.postMessage({cmd:"init",typeSupported:T,vendor:L,id:u,config:JSON.stringify(h)})}catch(N){_.logger.warn("Error in worker:",N),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),A&&self.URL.revokeObjectURL(A.objectURL),this.transmuxer=new Ar.default(this.observer,T,h,L,u),this.worker=null}}else this.transmuxer=new Ar.default(this.observer,T,h,L,u)}var b=w.prototype;return b.destroy=function(){var o=this.worker;if(o)o.removeEventListener("message",this.onwmsg),o.terminate(),this.worker=null,this.onwmsg=void 0;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var g=this.observer;g&&g.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},b.push=function(o,u,g,p,m,h,y,T,L,A){var N,ae,fe=this;L.transmuxing.start=self.performance.now();var Se=this.transmuxer,Ce=this.worker,_e=h?h.start:m.start,ft=m.decryptdata,nt=this.frag,We=!(nt&&m.cc===nt.cc),Je=!(nt&&L.level===nt.level),et=nt?L.sn-nt.sn:-1,Ve=this.part?L.part-this.part.index:-1,at=et===0&&L.id>1&&L.id===(nt==null?void 0:nt.stats.chunkCount),Rt=!Je&&(et===1||et===0&&(Ve===1||at&&Ve<=0)),$t=self.performance.now();(Je||et||m.stats.parsing.start===0)&&(m.stats.parsing.start=$t),!h||!Ve&&Rt||(h.stats.parsing.start=$t);var Ct=!(nt&&((N=m.initSegment)===null||N===void 0?void 0:N.url)===((ae=nt.initSegment)===null||ae===void 0?void 0:ae.url)),qt=new Ar.TransmuxState(We,Rt,T,Je,_e,Ct);if(!Rt||We||Ct){_.logger.log("[transmuxer-interface, "+m.type+"]: Starting new transmux session for sn: "+L.sn+" p: "+L.part+" level: "+L.level+" id: "+L.id+`
        discontinuity: `+We+`
        trackSwitch: `+Je+`
        contiguous: `+Rt+`
        accurateTimeOffset: `+T+`
        timeOffset: `+_e+`
        initSegmentChange: `+Ct);var or=new Ar.TransmuxConfig(g,p,u,y,A);this.configureTransmuxer(or)}if(this.frag=m,this.part=h,Ce)Ce.postMessage({cmd:"demux",data:o,decryptdata:ft,chunkMeta:L,state:qt},o instanceof ArrayBuffer?[o]:[]);else if(Se){var Bt=Se.push(o,ft,L,qt);(0,Ar.isPromise)(Bt)?Bt.then(function(Mt){fe.handleTransmuxComplete(Mt)}):this.handleTransmuxComplete(Bt)}},b.flush=function(o){var u=this;o.transmuxing.start=self.performance.now();var g=this.transmuxer,p=this.worker;if(p)p.postMessage({cmd:"flush",chunkMeta:o});else if(g){var m=g.flush(o);(0,Ar.isPromise)(m)?m.then(function(h){u.handleFlushResult(h,o)}):this.handleFlushResult(m,o)}},b.handleFlushResult=function(o,u){var g=this;o.forEach(function(p){g.handleTransmuxComplete(p)}),this.onFlush(u)},b.onWorkerMessage=function(o){var u=o.data,g=this.hls;switch(u.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(u.data);break;case"flush":this.onFlush(u.data);break;case"workerLog":_.logger[u.data.logType]&&_.logger[u.data.logType](u.data.message);break;default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,g.trigger(u.event,u.data)}},b.configureTransmuxer=function(o){var u=this.worker,g=this.transmuxer;u?u.postMessage({cmd:"configure",config:o}):g&&g.configure(o)},b.handleTransmuxComplete=function(o){o.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(o)},w}(),zr=function(){function w(o,u,g,p){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=o,this.media=u,this.fragmentTracker=g,this.hls=p}var b=w.prototype;return b.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},b.poll=function(o,u){var g=this.config,p=this.media,m=this.stalled;if(p!==null){var h=p.currentTime,y=p.seeking,T=this.seeking&&!y,L=!this.seeking&&y;if(this.seeking=y,h===o){if((L||T)&&(this.stalled=null),!(p.paused&&!y||p.ended||p.playbackRate===0)&&ve.getBuffered(p).length){var A=ve.bufferInfo(p,h,0),N=A.len>0,ae=A.nextStart||0;if(N||ae){if(y){var fe=A.len>2,Se=!ae||u&&u.start<=h||ae-h>2&&!this.fragmentTracker.getPartialFragment(h);if(fe||Se)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var Ce,_e=Math.max(ae,A.start||0)-h,ft=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,nt=!(ft==null||(Ce=ft.details)===null||Ce===void 0)&&Ce.live?2*ft.details.targetduration:2;if(_e>0&&_e<=nt)return void this._trySkipBufferHole(null)}var We=self.performance.now();if(m!==null){var Je=We-m;if(y||!(Je>=250)||(this._reportStall(A),this.media)){var et=ve.bufferInfo(p,h,g.maxBufferHole);this._tryFixBufferStall(et,Je)}}else this.stalled=We}}}else if(this.moved=!0,m!==null){if(this.stallReported){var Ve=self.performance.now()-m;_.logger.warn("playback not stuck anymore @"+h+", after "+Math.round(Ve)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},b._tryFixBufferStall=function(o,u){var g=this.config,p=this.fragmentTracker,m=this.media;if(m!==null){var h=m.currentTime,y=p.getPartialFragment(h);if(y&&(this._trySkipBufferHole(y)||!this.media))return;o.len>g.maxBufferHole&&u>1e3*g.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},b._reportStall=function(o){var u=this.hls,g=this.media;!this.stallReported&&g&&(this.stallReported=!0,_.logger.warn("Playback stalling at @"+g.currentTime+" due to low buffer ("+JSON.stringify(o)+")"),u.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:o.len}))},b._trySkipBufferHole=function(o){var u=this.config,g=this.hls,p=this.media;if(p===null)return 0;for(var m=p.currentTime,h=0,y=ve.getBuffered(p),T=0;T<y.length;T++){var L=y.start(T);if(m+u.maxBufferHole>=h&&m<L){var A=Math.max(L+.05,p.currentTime+.1);return _.logger.warn("skipping hole, adjusting currentTime from "+m+" to "+A),this.moved=!0,this.stalled=null,p.currentTime=A,o&&g.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+m+" to "+A,frag:o}),A}h=y.end(T)}return 0},b._tryNudgeBuffer=function(){var o=this.config,u=this.hls,g=this.media,p=this.nudgeRetry;if(g!==null){var m=g.currentTime;if(this.nudgeRetry++,p<o.nudgeMaxRetry){var h=m+(p+1)*o.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+m+" to "+h),g.currentTime=h,u.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+m+" after "+o.nudgeMaxRetry+" nudges"),u.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},w}();function Jr(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}function Xr(w,b){return Xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,u){return o.__proto__=u,o},Xr(w,b)}var Hr=function(w){var b,o;function u(h,y){var T;return(T=w.call(this,h,y,"[stream-controller]")||this).audioCodecSwap=!1,T.gapController=null,T.level=-1,T._forceStartLoad=!1,T.altAudio=!1,T.audioOnly=!1,T.fragPlaying=null,T.onvplaying=null,T.onvseeked=null,T.fragLastKbps=0,T.couldBacktrack=!1,T.backtrackFragment=null,T.audioCodecSwitch=!1,T.videoBuffer=null,T._registerListeners(),T}o=w,(b=u).prototype=Object.create(o.prototype),b.prototype.constructor=b,Xr(b,o);var g,p,m=u.prototype;return m._registerListeners=function(){var h=this.hls;h.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),h.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),h.on(c.Events.ERROR,this.onError,this),h.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),h.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),h.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),h.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),h.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var h=this.hls;h.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),h.off(c.Events.ERROR,this.onError,this),h.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),h.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),h.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),h.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),h.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},m.startLoad=function(h){if(this.levels){var y=this.lastCurrentTime,T=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var L=T.startLevel;L===-1&&(T.config.testBandwidth&&this.levels.length>1?(L=0,this.bitrateTest=!0):L=T.nextAutoLevel),this.level=T.nextLoadLevel=L,this.loadedmetadata=!1}y>0&&h===-1&&(this.log("Override startPosition with lastCurrentTime @"+y.toFixed(3)),h=y),this.state=Ye,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=h,this.tick()}else this._forceStartLoad=!0,this.state=$e},m.stopLoad=function(){this._forceStartLoad=!1,w.prototype.stopLoad.call(this)},m.doTick=function(){switch(this.state){case Ye:this.doTickIdle();break;case Vt:var h,y=this.levels,T=this.level,L=y==null||(h=y[T])===null||h===void 0?void 0:h.details;if(L&&(!L.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(L))break;this.state=Ye;break}break;case dt:var A,N=self.performance.now(),ae=this.retryDate;(!ae||N>=ae||(A=this.media)!==null&&A!==void 0&&A.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=Ye)}this.onTickEnd()},m.onTickEnd=function(){w.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},m.doTickIdle=function(){var h,y,T=this.hls,L=this.levelLastLoaded,A=this.levels,N=this.media,ae=T.config,fe=T.nextLoadLevel;if(L!==null&&(N||!this.startFragRequested&&ae.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&A&&A[fe]){var Se=A[fe];this.level=T.nextLoadLevel=fe;var Ce=Se.details;if(!Ce||this.state===Vt||Ce.live&&this.levelLastLoaded!==fe)this.state=Vt;else{var _e=this.getMainFwdBufferInfo();if(_e!==null&&!(_e.len>=this.getMaxBufferLength(Se.maxBitrate))){if(this._streamEnded(_e,Ce)){var ft={};return this.altAudio&&(ft.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,ft),void(this.state=Pt)}this.backtrackFragment&&this.backtrackFragment.start>_e.end&&(this.backtrackFragment=null);var nt=this.backtrackFragment?this.backtrackFragment.start:_e.end,We=this.getNextFragment(nt,Ce);if(this.couldBacktrack&&!this.fragPrevious&&We&&We.sn!=="initSegment"&&this.fragmentTracker.getState(We)!==Xt.OK){var Je,et=((Je=this.backtrackFragment)!=null?Je:We).sn-Ce.startSN,Ve=Ce.fragments[et-1];Ve&&We.cc===Ve.cc&&(We=Ve,this.fragmentTracker.removeFragment(Ve))}else this.backtrackFragment&&_e.len&&(this.backtrackFragment=null);if(We&&this.fragmentTracker.getState(We)===Xt.OK&&this.nextLoadPosition>nt){var at=this.audioOnly&&!this.altAudio?se.ElementaryStreamTypes.AUDIO:se.ElementaryStreamTypes.VIDEO;N&&this.afterBufferFlushed(N,at,G.PlaylistLevelType.MAIN),We=this.getNextFragment(this.nextLoadPosition,Ce)}We&&(!We.initSegment||We.initSegment.data||this.bitrateTest||(We=We.initSegment),((h=We.decryptdata)===null||h===void 0?void 0:h.keyFormat)!=="identity"||(y=We.decryptdata)!==null&&y!==void 0&&y.key?this.loadFragment(We,Ce,nt):this.loadKey(We,Ce))}}}},m.loadFragment=function(h,y,T){var L,A=this.fragmentTracker.getState(h);this.fragCurrent=h,A===Xt.NOT_LOADED?h.sn==="initSegment"?this._loadInitSegment(h):this.bitrateTest?(this.log("Fragment "+h.sn+" of level "+h.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(h)):(this.startFragRequested=!0,w.prototype.loadFragment.call(this,h,y,T)):A===Xt.APPENDING?this.reduceMaxBufferLength(h.duration)&&this.fragmentTracker.removeFragment(h):((L=this.media)===null||L===void 0?void 0:L.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},m.getAppendedFrag=function(h){var y=this.fragmentTracker.getAppendedFrag(h,G.PlaylistLevelType.MAIN);return y&&"fragment"in y?y.fragment:y},m.getBufferedFrag=function(h){return this.fragmentTracker.getBufferedFrag(h,G.PlaylistLevelType.MAIN)},m.followingBufferedFrag=function(h){return h?this.getBufferedFrag(h.end+.5):null},m.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},m.nextLevelSwitch=function(){var h=this.levels,y=this.media;if(y!=null&&y.readyState){var T,L=this.getAppendedFrag(y.currentTime);if(L&&L.start>1&&this.flushMainBuffer(0,L.start-1),!y.paused&&h){var A=h[this.hls.nextLoadLevel],N=this.fragLastKbps;T=N&&this.fragCurrent?this.fragCurrent.duration*A.maxBitrate/(1e3*N)+1:0}else T=0;var ae=this.getBufferedFrag(y.currentTime+T);if(ae){var fe=this.followingBufferedFrag(ae);if(fe){this.abortCurrentFrag();var Se=fe.maxStartPTS?fe.maxStartPTS:fe.start,Ce=fe.duration,_e=Math.max(ae.end,Se+Math.min(Math.max(Ce-this.config.maxFragLookUpTolerance,.5*Ce),.75*Ce));this.flushMainBuffer(_e,Number.POSITIVE_INFINITY)}}}},m.abortCurrentFrag=function(){var h=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,h!=null&&h.loader&&h.loader.abort(),this.state){case ot:case Tt:case dt:case Ft:case Qt:this.state=Ye}this.nextLoadPosition=this.getLoadPosition()},m.flushMainBuffer=function(h,y){w.prototype.flushMainBuffer.call(this,h,y,this.altAudio?"video":null)},m.onMediaAttached=function(h,y){w.prototype.onMediaAttached.call(this,h,y);var T=y.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),T.addEventListener("playing",this.onvplaying),T.addEventListener("seeked",this.onvseeked),this.gapController=new zr(this.config,T,this.fragmentTracker,this.hls)},m.onMediaDetaching=function(){var h=this.media;h&&this.onvplaying&&this.onvseeked&&(h.removeEventListener("playing",this.onvplaying),h.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),w.prototype.onMediaDetaching.call(this)},m.onMediaPlaying=function(){this.tick()},m.onMediaSeeked=function(){var h=this.media,y=h?h.currentTime:null;(0,U.isFiniteNumber)(y)&&this.log("Media seeked to "+y.toFixed(3)),this.tick()},m.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},m.onManifestParsed=function(h,y){var T,L,A,N=!1,ae=!1;y.levels.forEach(function(fe){(T=fe.audioCodec)&&(T.indexOf("mp4a.40.2")!==-1&&(N=!0),T.indexOf("mp4a.40.5")!==-1&&(ae=!0))}),this.audioCodecSwitch=N&&ae&&typeof((A=dr())==null||(L=A.prototype)===null||L===void 0?void 0:L.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=y.levels,this.startFragRequested=!1},m.onLevelLoading=function(h,y){var T=this.levels;if(T&&this.state===Ye){var L=T[y.level];(!L.details||L.details.live&&this.levelLastLoaded!==y.level||this.waitForCdnTuneIn(L.details))&&(this.state=Vt)}},m.onLevelLoaded=function(h,y){var T,L=this.levels,A=y.level,N=y.details,ae=N.totalduration;if(L){this.log("Level "+A+" loaded ["+N.startSN+","+N.endSN+"], cc ["+N.startCC+", "+N.endCC+"] duration:"+ae);var fe=this.fragCurrent;!fe||this.state!==Tt&&this.state!==dt||fe.level!==y.level&&fe.loader&&(this.state=Ye,this.backtrackFragment=null,fe.loader.abort());var Se=L[A],Ce=0;if(N.live||(T=Se.details)!==null&&T!==void 0&&T.live){if(N.fragments[0]||(N.deltaUpdateFailed=!0),N.deltaUpdateFailed)return;Ce=this.alignPlaylists(N,Se.details)}if(Se.details=N,this.levelLastLoaded=A,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:N,level:A}),this.state===Vt){if(this.waitForCdnTuneIn(N))return;this.state=Ye}this.startFragRequested?N.live&&this.synchronizeToLiveEdge(N):this.setStartPosition(N,Ce),this.tick()}else this.warn("Levels were reset while loading level "+A)},m._handleFragmentLoadProgress=function(h){var y,T=h.frag,L=h.part,A=h.payload,N=this.levels;if(N){var ae=N[T.level],fe=ae.details;if(fe){var Se=ae.videoCodec,Ce=fe.PTSKnown||!fe.live,_e=(y=T.initSegment)===null||y===void 0?void 0:y.data,ft=this._getAudioCodec(ae),nt=this.transmuxer=this.transmuxer||new xr(this.hls,G.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),We=L?L.index:-1,Je=We!==-1,et=new Le(T.level,T.sn,T.stats.chunkCount,A.byteLength,We,Je),Ve=this.initPTS[T.cc];nt.push(A,_e,ft,Se,T,L,fe.totalduration,Ce,et,Ve)}else this.warn("Dropping fragment "+T.sn+" of level "+T.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+T.sn+" of level "+T.level+" will not be buffered")},m.onAudioTrackSwitching=function(h,y){var T=this.altAudio,L=!!y.url,A=y.id;if(!L){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var N=this.fragCurrent;N!=null&&N.loader&&(this.log("Switching to main audio track, cancel main fragment load"),N.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var ae=this.hls;T&&ae.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),ae.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:A})}},m.onAudioTrackSwitched=function(h,y){var T=y.id,L=!!this.hls.audioTracks[T].url;if(L){var A=this.videoBuffer;A&&this.mediaBuffer!==A&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=A)}this.altAudio=L,this.tick()},m.onBufferCreated=function(h,y){var T,L,A=y.tracks,N=!1;for(var ae in A){var fe=A[ae];if(fe.id==="main"){if(L=ae,T=fe,ae==="video"){var Se=A[ae];Se&&(this.videoBuffer=Se.buffer)}}else N=!0}N&&T?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=T.buffer):this.mediaBuffer=this.media},m.onFragBuffered=function(h,y){var T=y.frag,L=y.part;if(!T||T.type===G.PlaylistLevelType.MAIN){if(this.fragContextChanged(T))return this.warn("Fragment "+T.sn+(L?" p: "+L.index:"")+" of level "+T.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Qt&&(this.state=Ye));var A=L?L.stats:T.stats;this.fragLastKbps=Math.round(8*A.total/(A.buffering.end-A.loading.first)),T.sn!=="initSegment"&&(this.fragPrevious=T),this.fragBufferedComplete(T,L)}},m.onError=function(h,y){switch(y.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.PlaylistLevelType.MAIN,y);break;case M.ErrorDetails.LEVEL_LOAD_ERROR:case M.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==mt&&(y.fatal?(this.warn(""+y.details),this.state=mt):y.levelRetry||this.state!==Vt||(this.state=Ye));break;case M.ErrorDetails.BUFFER_FULL_ERROR:if(y.parent==="main"&&(this.state===Ft||this.state===Qt)){var T=!0,L=this.getFwdBufferInfo(this.media,G.PlaylistLevelType.MAIN);L&&L.len>.5&&(T=!this.reduceMaxBufferLength(L.len)),T&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},m.checkBuffer=function(){var h=this.media,y=this.gapController;if(h&&y&&h.readyState){if(this.loadedmetadata||!ve.getBuffered(h).length){var T=this.state!==Ye?this.fragCurrent:null;y.poll(this.lastCurrentTime,T)}this.lastCurrentTime=h.currentTime}},m.onFragLoadEmergencyAborted=function(){this.state=Ye,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},m.onBufferFlushed=function(h,y){var T=y.type;if(T!==se.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var L=(T===se.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(L,T,G.PlaylistLevelType.MAIN)}},m.onLevelsUpdated=function(h,y){this.levels=y.levels},m.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},m.seekToStartPos=function(){var h=this.media;if(h){var y=h.currentTime,T=this.startPosition;if(T>=0&&y<T){if(h.seeking)return void this.log("could not seek to "+T+", already seeking at "+y);var L=ve.getBuffered(h),A=(L.length?L.start(0):0)-T;A>0&&(A<this.config.maxBufferHole||A<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+A+" to match buffer start"),T+=A,this.startPosition=T),this.log("seek to target start position "+T+" from current time "+y),h.currentTime=T}}},m._getAudioCodec=function(h){var y=this.config.defaultAudioCodec||h.audioCodec;return this.audioCodecSwap&&y&&(this.log("Swapping audio codec"),y=y.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),y},m._loadBitrateTestFrag=function(h){var y=this;h.bitrateTest=!0,this._doFragLoad(h).then(function(T){var L=y.hls;if(T&&!L.nextLoadLevel&&!y.fragContextChanged(h)){y.fragLoadError=0,y.state=Ye,y.startFragRequested=!1,y.bitrateTest=!1;var A=h.stats;A.parsing.start=A.parsing.end=A.buffering.start=A.buffering.end=self.performance.now(),L.trigger(c.Events.FRAG_LOADED,T),h.bitrateTest=!1}})},m._handleTransmuxComplete=function(h){var y,T="main",L=this.hls,A=h.remuxResult,N=h.chunkMeta,ae=this.getCurrentContext(N);if(!ae)return this.warn("The loading context changed while buffering fragment "+N.sn+" of level "+N.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(N.level);var fe=ae.frag,Se=ae.part,Ce=ae.level,_e=A.video,ft=A.text,nt=A.id3,We=A.initSegment,Je=Ce.details,et=this.altAudio?void 0:A.audio;if(!this.fragContextChanged(fe)){if(this.state=Ft,We){We.tracks&&(this._bufferInitSegment(Ce,We.tracks,fe,N),L.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:fe,id:T,tracks:We.tracks}));var Ve=We.initPTS,at=We.timescale;(0,U.isFiniteNumber)(Ve)&&(this.initPTS[fe.cc]=Ve,L.trigger(c.Events.INIT_PTS_FOUND,{frag:fe,id:T,initPTS:Ve,timescale:at}))}if(_e&&A.independent!==!1){if(Je){var Rt=_e.startPTS,$t=_e.endPTS,Ct=_e.startDTS,qt=_e.endDTS;if(Se)Se.elementaryStreams[_e.type]={startPTS:Rt,endPTS:$t,startDTS:Ct,endDTS:qt};else if(_e.firstKeyFrame&&_e.independent&&(this.couldBacktrack=!0),_e.dropped&&_e.independent){var or=this.getMainFwdBufferInfo();if((or?or.end:this.getLoadPosition())+this.config.maxBufferHole<(_e.firstKeyFramePTS?_e.firstKeyFramePTS:Rt)-this.config.maxBufferHole)return void this.backtrack(fe);fe.setElementaryStreamInfo(_e.type,fe.start,$t,fe.start,qt,!0)}fe.setElementaryStreamInfo(_e.type,Rt,$t,Ct,qt),this.backtrackFragment&&(this.backtrackFragment=fe),this.bufferFragmentData(_e,fe,Se,N)}}else if(A.independent===!1)return void this.backtrack(fe);if(et){var Bt=et.startPTS,Mt=et.endPTS,nr=et.startDTS,vr=et.endDTS;Se&&(Se.elementaryStreams[se.ElementaryStreamTypes.AUDIO]={startPTS:Bt,endPTS:Mt,startDTS:nr,endDTS:vr}),fe.setElementaryStreamInfo(se.ElementaryStreamTypes.AUDIO,Bt,Mt,nr,vr),this.bufferFragmentData(et,fe,Se,N)}if(Je&&nt!=null&&(y=nt.samples)!==null&&y!==void 0&&y.length){var br={id:T,frag:fe,details:Je,samples:nt.samples};L.trigger(c.Events.FRAG_PARSING_METADATA,br)}if(Je&&ft){var Lr={id:T,frag:fe,details:Je,samples:ft.samples};L.trigger(c.Events.FRAG_PARSING_USERDATA,Lr)}}},m._bufferInitSegment=function(h,y,T,L){var A=this;if(this.state===Ft){this.audioOnly=!!y.audio&&!y.video,this.altAudio&&!this.audioOnly&&delete y.audio;var N=y.audio,ae=y.video,fe=y.audiovideo;if(N){var Se=h.audioCodec,Ce=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(Se&&(Se=Se.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),N.metadata.channelCount!==1&&Ce.indexOf("firefox")===-1&&(Se="mp4a.40.5")),Ce.indexOf("android")!==-1&&N.container!=="audio/mpeg"&&(Se="mp4a.40.2",this.log("Android: force audio codec to "+Se)),h.audioCodec&&h.audioCodec!==Se&&this.log('Swapping manifest audio codec "'+h.audioCodec+'" for "'+Se+'"'),N.levelCodec=Se,N.id="main",this.log("Init audio buffer, container:"+N.container+", codecs[selected/level/parsed]=["+(Se||"")+"/"+(h.audioCodec||"")+"/"+N.codec+"]")}ae&&(ae.levelCodec=h.videoCodec,ae.id="main",this.log("Init video buffer, container:"+ae.container+", codecs[level/parsed]=["+(h.videoCodec||"")+"/"+ae.codec+"]")),fe&&this.log("Init audiovideo buffer, container:"+fe.container+", codecs[level/parsed]=["+(h.attrs.CODECS||"")+"/"+fe.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,y),Object.keys(y).forEach(function(_e){var ft=y[_e].initSegment;ft!=null&&ft.byteLength&&A.hls.trigger(c.Events.BUFFER_APPENDING,{type:_e,data:ft,frag:T,part:null,chunkMeta:L,parent:T.type})}),this.tick()}},m.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.PlaylistLevelType.MAIN)},m.backtrack=function(h){this.couldBacktrack=!0,this.backtrackFragment=h,this.resetTransmuxer(),this.flushBufferGap(h),this.fragmentTracker.removeFragment(h),this.fragPrevious=null,this.nextLoadPosition=h.start,this.state=Ye},m.checkFragmentChanged=function(){var h=this.media,y=null;if(h&&h.readyState>1&&h.seeking===!1){var T=h.currentTime;if(ve.isBuffered(h,T)?y=this.getAppendedFrag(T):ve.isBuffered(h,T+.1)&&(y=this.getAppendedFrag(T+.1)),y){this.backtrackFragment=null;var L=this.fragPlaying,A=y.level;L&&y.sn===L.sn&&L.level===A&&y.urlId===L.urlId||(this.hls.trigger(c.Events.FRAG_CHANGED,{frag:y}),L&&L.level===A||this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:A}),this.fragPlaying=y)}}},g=u,(p=[{key:"nextLevel",get:function(){var h=this.nextBufferedFrag;return h?h.level:-1}},{key:"currentFrag",get:function(){var h=this.media;return h?this.fragPlaying||this.getAppendedFrag(h.currentTime):null}},{key:"currentProgramDateTime",get:function(){var h=this.media;if(h){var y=h.currentTime,T=this.currentFrag;if(T&&(0,U.isFiniteNumber)(y)&&(0,U.isFiniteNumber)(T.programDateTime)){var L=T.programDateTime+1e3*(y-T.start);return new Date(L)}}return null}},{key:"currentLevel",get:function(){var h=this.currentFrag;return h?h.level:-1}},{key:"nextBufferedFrag",get:function(){var h=this.currentFrag;return h?this.followingBufferedFrag(h):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&Jr(g.prototype,p),Object.defineProperty(g,"prototype",{writable:!1}),u}(bt);const Nr=function(){function w(o,u,g){u===void 0&&(u=0),g===void 0&&(g=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=o,this.alpha_=o?Math.exp(Math.log(.5)/o):0,this.estimate_=u,this.totalWeight_=g}var b=w.prototype;return b.sample=function(o,u){var g=Math.pow(this.alpha_,o);this.estimate_=u*(1-g)+g*this.estimate_,this.totalWeight_+=o},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var o=1-Math.pow(this.alpha_,this.totalWeight_);if(o)return this.estimate_/o}return this.estimate_},w}(),Or=function(){function w(o,u,g){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=g,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Nr(o),this.fast_=new Nr(u)}var b=w.prototype;return b.update=function(o,u){var g=this.slow_,p=this.fast_;this.slow_.halfLife!==o&&(this.slow_=new Nr(o,g.getEstimate(),g.getTotalWeight())),this.fast_.halfLife!==u&&(this.fast_=new Nr(u,p.getEstimate(),p.getTotalWeight()))},b.sample=function(o,u){var g=(o=Math.max(o,this.minDelayMs_))/1e3,p=8*u/g;this.fast_.sample(g,p),this.slow_.sample(g,p)},b.canEstimate=function(){var o=this.fast_;return o&&o.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},w}();function Zr(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}const kr=function(){function w(g){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=g;var p=g.config;this.bwEstimator=new Or(p.abrEwmaSlowVoD,p.abrEwmaFastVoD,p.abrEwmaDefaultEstimate),this.registerListeners()}var b,o,u=w.prototype;return u.registerListeners=function(){var g=this.hls;g.on(c.Events.FRAG_LOADING,this.onFragLoading,this),g.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(c.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var g=this.hls;g.off(c.Events.FRAG_LOADING,this.onFragLoading,this),g.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(c.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(g,p){var m,h=p.frag;h.type===G.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=h,this.partCurrent=(m=p.part)!=null?m:null,this.timer=self.setInterval(this.onCheck,100)))},u.onLevelLoaded=function(g,p){var m=this.hls.config;p.details.live?this.bwEstimator.update(m.abrEwmaSlowLive,m.abrEwmaFastLive):this.bwEstimator.update(m.abrEwmaSlowVoD,m.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var g=this.fragCurrent,p=this.partCurrent,m=this.hls,h=m.autoLevelEnabled,y=(m.config,m.media);if(g&&y){var T=p?p.stats:g.stats,L=p?p.duration:g.duration;if(T.aborted||T.loaded&&T.loaded===T.total||g.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(h&&!y.paused&&y.playbackRate&&y.readyState){var A=m.mainForwardBufferInfo;if(A!==null){var N=performance.now()-T.loading.start,ae=Math.abs(y.playbackRate);if(!(N<=500*L/ae)){var fe=T.loaded&&T.loading.first,Se=this.bwEstimator.getEstimate(),Ce=m.levels,_e=m.minAutoLevel,ft=Ce[g.level],nt=T.total||Math.max(T.loaded,Math.round(L*ft.maxBitrate/8)),We=fe?1e3*T.loaded/N:0,Je=We?(nt-T.loaded)/We:8*nt/Se,et=A.len/ae;if(!(Je<=et)){var Ve,at=Number.POSITIVE_INFINITY;for(Ve=g.level-1;Ve>_e;Ve--){var Rt=Ce[Ve].maxBitrate;if((at=We?L*Rt/(6.4*We):L*Rt/Se)<et)break}at>=Je||(_.logger.warn("Fragment "+g.sn+(p?" part "+p.index:"")+" of level "+g.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Ve+`
      Current BW estimate: `+((0,U.isFiniteNumber)(Se)?(Se/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+Je.toFixed(3)+` s
      Estimated load time for the next fragment: `+at.toFixed(3)+` s
      Time to underbuffer: `+et.toFixed(3)+" s"),m.nextLoadLevel=Ve,fe&&this.bwEstimator.sample(N,T.loaded),this.clearTimer(),g.loader&&(this.fragCurrent=this.partCurrent=null,g.loader.abort()),m.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:g,part:p,stats:T}))}}}}}},u.onFragLoaded=function(g,p){var m=p.frag,h=p.part;if(m.type===G.PlaylistLevelType.MAIN&&(0,U.isFiniteNumber)(m.sn)){var y=h?h.stats:m.stats,T=h?h.duration:m.duration;if(this.clearTimer(),this.lastLoadedFragLevel=m.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var L=this.hls.levels[m.level],A=(L.loaded?L.loaded.bytes:0)+y.loaded,N=(L.loaded?L.loaded.duration:0)+T;L.loaded={bytes:A,duration:N},L.realBitrate=Math.round(8*A/N)}if(m.bitrateTest){var ae={stats:y,frag:m,part:h,id:m.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,ae)}}},u.onFragBuffered=function(g,p){var m=p.frag,h=p.part,y=h?h.stats:m.stats;if(!y.aborted&&m.type===G.PlaylistLevelType.MAIN&&m.sn!=="initSegment"){var T=y.parsing.end-y.loading.start;this.bwEstimator.sample(T,y.loaded),y.bwEstimate=this.bwEstimator.getEstimate(),m.bitrateTest?this.bitrateTestDelay=T/1e3:this.bitrateTestDelay=0}},u.onError=function(g,p){switch(p.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var g=this.fragCurrent,p=this.partCurrent,m=this.hls,h=m.maxAutoLevel,y=m.config,T=m.minAutoLevel,L=m.media,A=p?p.duration:g?g.duration:0,N=(L&&L.currentTime,L&&L.playbackRate!==0?Math.abs(L.playbackRate):1),ae=this.bwEstimator?this.bwEstimator.getEstimate():y.abrEwmaDefaultEstimate,fe=m.mainForwardBufferInfo,Se=(fe?fe.len:0)/N,Ce=this.findBestLevel(ae,T,h,Se,y.abrBandWidthFactor,y.abrBandWidthUpFactor);if(Ce>=0)return Ce;_.logger.trace((Se?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var _e=A?Math.min(A,y.maxStarvationDelay):y.maxStarvationDelay,ft=y.abrBandWidthFactor,nt=y.abrBandWidthUpFactor;if(!Se){var We=this.bitrateTestDelay;We&&(_e=(A?Math.min(A,y.maxLoadingDelay):y.maxLoadingDelay)-We,_.logger.trace("bitrate test took "+Math.round(1e3*We)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*_e)+" ms"),ft=nt=1)}return Ce=this.findBestLevel(ae,T,h,Se+_e,ft,nt),Math.max(Ce,0)},u.findBestLevel=function(g,p,m,h,y,T){for(var L,A=this.fragCurrent,N=this.partCurrent,ae=this.lastLoadedFragLevel,fe=this.hls.levels,Se=fe[ae],Ce=!(Se==null||(L=Se.details)===null||L===void 0||!L.live),_e=Se==null?void 0:Se.codecSet,ft=N?N.duration:A?A.duration:0,nt=m;nt>=p;nt--){var We=fe[nt];if(We&&(!_e||We.codecSet===_e)){var Je,et=We.details,Ve=(N?et==null?void 0:et.partTarget:et==null?void 0:et.averagetargetduration)||ft;Je=nt<=ae?y*g:T*g;var at=fe[nt].maxBitrate,Rt=at*Ve/Je;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+nt+"/"+Math.round(Je)+"/"+at+"/"+Ve+"/"+h+"/"+Rt),Je>at&&(Rt===0||!(0,U.isFiniteNumber)(Rt)||Ce&&!this.bitrateTestDelay||Rt<h))return nt}}return-1},b=w,(o=[{key:"nextAutoLevel",get:function(){var g=this._nextAutoLevel,p=this.bwEstimator;if(g!==-1&&!p.canEstimate())return g;var m=this.getNextABRAutoLevel();return g!==-1&&this.hls.levels[m].loadError?g:(g!==-1&&(m=Math.min(g,m)),m)},set:function(g){this._nextAutoLevel=g}}])&&Zr(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}();var wr=Q(514),ii=Q.n(wr),gi=function(){function w(o){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=o}var b=w.prototype;return b.append=function(o,u){var g=this.queues[u];g.push(o),g.length===1&&this.buffers[u]&&this.executeNext(u)},b.insertAbort=function(o,u){this.queues[u].unshift(o),this.executeNext(u)},b.appendBlocker=function(o){var u,g=new Promise(function(m){u=m}),p={execute:u,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(p,o),g},b.executeNext=function(o){var u=this.buffers,g=this.queues,p=u[o],m=g[o];if(m.length){var h=m[0];try{h.execute()}catch(y){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(y),p&&p.updating||(m.shift(),this.executeNext(o))}}},b.shiftAndExecuteNext=function(o){this.queues[o].shift(),this.executeNext(o)},b.current=function(o){return this.queues[o][0]},w}(),Pr=zt(),Ci=/([ha]vc.)(?:\.[^.,]+)+/,ni=function(){function w(o){var u=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var g=u.hls,p=u.media,m=u.mediaSource;_.logger.log("[buffer-controller]: Media source opened"),p&&(u.updateMediaElementDuration(),g.trigger(c.Events.MEDIA_ATTACHED,{media:p})),m&&m.removeEventListener("sourceopen",u._onMediaSourceOpen),u.checkPendingTracks()},this._onMediaSourceClose=function(){_.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){_.logger.log("[buffer-controller]: Media source ended")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var b=w.prototype;return b.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},b.destroy=function(){this.unregisterListeners(),this.details=null},b.registerListeners=function(){var o=this.hls;o.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(c.Events.BUFFER_RESET,this.onBufferReset,this),o.on(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.on(c.Events.BUFFER_EOS,this.onBufferEos,this),o.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.on(c.Events.FRAG_PARSED,this.onFragParsed,this),o.on(c.Events.FRAG_CHANGED,this.onFragChanged,this)},b.unregisterListeners=function(){var o=this.hls;o.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(c.Events.BUFFER_RESET,this.onBufferReset,this),o.off(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.off(c.Events.BUFFER_EOS,this.onBufferEos,this),o.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.off(c.Events.FRAG_PARSED,this.onFragParsed,this),o.off(c.Events.FRAG_CHANGED,this.onFragChanged,this)},b._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new gi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},b.onManifestParsed=function(o,u){var g=2;(u.audio&&!u.video||!u.altAudio)&&(g=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=g,this.details=null,_.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},b.onMediaAttaching=function(o,u){var g=this.media=u.media;if(g&&Pr){var p=this.mediaSource=new Pr;p.addEventListener("sourceopen",this._onMediaSourceOpen),p.addEventListener("sourceended",this._onMediaSourceEnded),p.addEventListener("sourceclose",this._onMediaSourceClose),g.src=self.URL.createObjectURL(p),this._objectUrl=g.src}},b.onMediaDetaching=function(){var o=this.media,u=this.mediaSource,g=this._objectUrl;if(u){if(_.logger.log("[buffer-controller]: media source detaching"),u.readyState==="open")try{u.endOfStream()}catch(p){_.logger.warn("[buffer-controller]: onMediaDetaching: "+p.message+" while calling endOfStream")}this.onBufferReset(),u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),o&&(g&&self.URL.revokeObjectURL(g),o.src===g?(o.removeAttribute("src"),o.load()):_.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.Events.MEDIA_DETACHED,void 0)},b.onBufferReset=function(){var o=this;this.getSourceBufferTypes().forEach(function(u){var g=o.sourceBuffer[u];try{g&&(o.removeBufferListeners(u),o.mediaSource&&o.mediaSource.removeSourceBuffer(g),o.sourceBuffer[u]=void 0)}catch(p){_.logger.warn("[buffer-controller]: Failed to reset the "+u+" buffer",p)}}),this._initSourceBuffer()},b.onBufferCodecs=function(o,u){var g=this,p=this.getSourceBufferTypes().length;Object.keys(u).forEach(function(m){if(p){var h=g.tracks[m];if(h&&typeof h.buffer.changeType=="function"){var y=u[m],T=y.id,L=y.codec,A=y.levelCodec,N=y.container,ae=y.metadata,fe=(h.levelCodec||h.codec).replace(Ci,"$1"),Se=(A||L).replace(Ci,"$1");if(fe!==Se){var Ce=N+";codecs="+(A||L);g.appendChangeType(m,Ce),_.logger.log("[buffer-controller]: switching codec "+fe+" to "+Se),g.tracks[m]={buffer:h.buffer,codec:L,container:N,levelCodec:A,metadata:ae,id:T}}}}else g.pendingTracks[m]=u[m]}),p||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},b.appendChangeType=function(o,u){var g=this,p=this.operationQueue,m={execute:function(){var h=g.sourceBuffer[o];h&&(_.logger.log("[buffer-controller]: changing "+o+" sourceBuffer type to "+u),h.changeType(u)),p.shiftAndExecuteNext(o)},onStart:function(){},onComplete:function(){},onError:function(h){_.logger.warn("[buffer-controller]: Failed to change "+o+" SourceBuffer type",h)}};p.append(m,o)},b.onBufferAppending=function(o,u){var g=this,p=this.hls,m=this.operationQueue,h=this.tracks,y=u.data,T=u.type,L=u.frag,A=u.part,N=u.chunkMeta,ae=N.buffering[T],fe=self.performance.now();ae.start=fe;var Se=L.stats.buffering,Ce=A?A.stats.buffering:null;Se.start===0&&(Se.start=fe),Ce&&Ce.start===0&&(Ce.start=fe);var _e=h.audio,ft=T==="audio"&&N.id===1&&(_e==null?void 0:_e.container)==="audio/mpeg",nt={execute:function(){if(ae.executeStart=self.performance.now(),ft){var We=g.sourceBuffer[T];if(We){var Je=L.start-We.timestampOffset;Math.abs(Je)>=.1&&(_.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+L.start+" (delta: "+Je+") sn: "+L.sn+")"),We.timestampOffset=L.start)}}g.appendExecutor(y,T)},onStart:function(){},onComplete:function(){var We=self.performance.now();ae.executeEnd=ae.end=We,Se.first===0&&(Se.first=We),Ce&&Ce.first===0&&(Ce.first=We);var Je=g.sourceBuffer,et={};for(var Ve in Je)et[Ve]=ve.getBuffered(Je[Ve]);g.appendError=0,g.hls.trigger(c.Events.BUFFER_APPENDED,{type:T,frag:L,part:A,chunkMeta:N,parent:L.type,timeRanges:et})},onError:function(We){_.logger.error("[buffer-controller]: Error encountered while trying to append to the "+T+" SourceBuffer",We);var Je={type:M.ErrorTypes.MEDIA_ERROR,parent:L.type,details:M.ErrorDetails.BUFFER_APPEND_ERROR,err:We,fatal:!1};We.code===DOMException.QUOTA_EXCEEDED_ERR?Je.details=M.ErrorDetails.BUFFER_FULL_ERROR:(g.appendError++,Je.details=M.ErrorDetails.BUFFER_APPEND_ERROR,g.appendError>p.config.appendErrorMaxRetry&&(_.logger.error("[buffer-controller]: Failed "+p.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),Je.fatal=!0,p.stopLoad())),p.trigger(c.Events.ERROR,Je)}};m.append(nt,T)},b.onBufferFlushing=function(o,u){var g=this,p=this.operationQueue,m=function(h){return{execute:g.removeExecutor.bind(g,h,u.startOffset,u.endOffset),onStart:function(){},onComplete:function(){g.hls.trigger(c.Events.BUFFER_FLUSHED,{type:h})},onError:function(y){_.logger.warn("[buffer-controller]: Failed to remove from "+h+" SourceBuffer",y)}}};u.type?p.append(m(u.type),u.type):this.getSourceBufferTypes().forEach(function(h){p.append(m(h),h)})},b.onFragParsed=function(o,u){var g=this,p=u.frag,m=u.part,h=[],y=m?m.elementaryStreams:p.elementaryStreams;y[se.ElementaryStreamTypes.AUDIOVIDEO]?h.push("audiovideo"):(y[se.ElementaryStreamTypes.AUDIO]&&h.push("audio"),y[se.ElementaryStreamTypes.VIDEO]&&h.push("video")),h.length===0&&_.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+p.type+" level: "+p.level+" sn: "+p.sn),this.blockBuffers(function(){var T=self.performance.now();p.stats.buffering.end=T,m&&(m.stats.buffering.end=T);var L=m?m.stats:p.stats;g.hls.trigger(c.Events.FRAG_BUFFERED,{frag:p,part:m,stats:L,id:p.type})},h)},b.onFragChanged=function(o,u){this.flushBackBuffer()},b.onBufferEos=function(o,u){var g=this;this.getSourceBufferTypes().reduce(function(p,m){var h=g.sourceBuffer[m];return u.type&&u.type!==m||h&&!h.ended&&(h.ended=!0,_.logger.log("[buffer-controller]: "+m+" sourceBuffer now EOS")),p&&!(h&&!h.ended)},!0)&&this.blockBuffers(function(){var p=g.mediaSource;p&&p.readyState==="open"&&p.endOfStream()})},b.onLevelUpdated=function(o,u){var g=u.details;g.fragments.length&&(this.details=g,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},b.flushBackBuffer=function(){var o=this.hls,u=this.details,g=this.media,p=this.sourceBuffer;if(g&&u!==null){var m=this.getSourceBufferTypes();if(m.length){var h=u.live&&o.config.liveBackBufferLength!==null?o.config.liveBackBufferLength:o.config.backBufferLength;if((0,U.isFiniteNumber)(h)&&!(h<0)){var y=g.currentTime,T=u.levelTargetDuration,L=Math.max(h,T),A=Math.floor(y/T)*T-L;m.forEach(function(N){var ae=p[N];if(ae){var fe=ve.getBuffered(ae);fe.length>0&&A>fe.start(0)&&(o.trigger(c.Events.BACK_BUFFER_REACHED,{bufferEnd:A}),u.live&&o.trigger(c.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:A}),o.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:A,type:N}))}})}}}},b.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var o=this.details,u=this.hls,g=this.media,p=this.mediaSource,m=o.fragments[0].start+o.totalduration,h=g.duration,y=(0,U.isFiniteNumber)(p.duration)?p.duration:0;o.live&&u.config.liveDurationInfinity?(_.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),p.duration=1/0,this.updateSeekableRange(o)):(m>y&&m>h||!(0,U.isFiniteNumber)(h))&&(_.logger.log("[buffer-controller]: Updating Media Source duration to "+m.toFixed(3)),p.duration=m)}},b.updateSeekableRange=function(o){var u=this.mediaSource,g=o.fragments;if(g.length&&o.live&&u!=null&&u.setLiveSeekableRange){var p=Math.max(0,g[0].start),m=Math.max(p,p+o.totalduration);u.setLiveSeekableRange(p,m)}},b.checkPendingTracks=function(){var o=this.bufferCodecEventsExpected,u=this.operationQueue,g=this.pendingTracks,p=Object.keys(g).length;if(p&&!o||p===2){this.createSourceBuffers(g),this.pendingTracks={};var m=this.getSourceBufferTypes();if(m.length===0)return void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});m.forEach(function(h){u.executeNext(h)})}},b.createSourceBuffers=function(o){var u=this.sourceBuffer,g=this.mediaSource;if(!g)throw Error("createSourceBuffers called when mediaSource was null");var p=0;for(var m in o)if(!u[m]){var h=o[m];if(!h)throw Error("source buffer exists for track "+m+", however track does not");var y=h.levelCodec||h.codec,T=h.container+";codecs="+y;_.logger.log("[buffer-controller]: creating sourceBuffer("+T+")");try{var L=u[m]=g.addSourceBuffer(T),A=m;this.addBufferListener(A,"updatestart",this._onSBUpdateStart),this.addBufferListener(A,"updateend",this._onSBUpdateEnd),this.addBufferListener(A,"error",this._onSBUpdateError),this.tracks[m]={buffer:L,codec:y,container:h.container,levelCodec:h.levelCodec,metadata:h.metadata,id:h.id},p++}catch(N){_.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+N.message),this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:N,mimeType:T})}}p&&this.hls.trigger(c.Events.BUFFER_CREATED,{tracks:this.tracks})},b._onSBUpdateStart=function(o){this.operationQueue.current(o).onStart()},b._onSBUpdateEnd=function(o){var u=this.operationQueue;u.current(o).onComplete(),u.shiftAndExecuteNext(o)},b._onSBUpdateError=function(o,u){_.logger.error("[buffer-controller]: "+o+" SourceBuffer error",u),this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var g=this.operationQueue.current(o);g&&g.onError(u)},b.removeExecutor=function(o,u,g){var p=this.media,m=this.mediaSource,h=this.operationQueue,y=this.sourceBuffer[o];if(!p||!m||!y)return _.logger.warn("[buffer-controller]: Attempting to remove from the "+o+" SourceBuffer, but it does not exist"),void h.shiftAndExecuteNext(o);var T=(0,U.isFiniteNumber)(p.duration)?p.duration:1/0,L=(0,U.isFiniteNumber)(m.duration)?m.duration:1/0,A=Math.max(0,u),N=Math.min(g,T,L);N>A?(_.logger.log("[buffer-controller]: Removing ["+A+","+N+"] from the "+o+" SourceBuffer"),y.remove(A,N)):h.shiftAndExecuteNext(o)},b.appendExecutor=function(o,u){var g=this.operationQueue,p=this.sourceBuffer[u];if(!p)return _.logger.warn("[buffer-controller]: Attempting to append to the "+u+" SourceBuffer, but it does not exist"),void g.shiftAndExecuteNext(u);p.ended=!1,p.appendBuffer(o)},b.blockBuffers=function(o,u){var g=this;if(u===void 0&&(u=this.getSourceBufferTypes()),!u.length)return _.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(o);var p=this.operationQueue,m=u.map(function(h){return p.appendBlocker(h)});Promise.all(m).then(function(){o(),u.forEach(function(h){var y=g.sourceBuffer[h];y&&y.updating||p.shiftAndExecuteNext(h)})})},b.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},b.addBufferListener=function(o,u,g){var p=this.sourceBuffer[o];if(p){var m=g.bind(this,o);this.listeners[o].push({event:u,listener:m}),p.addEventListener(u,m)}},b.removeBufferListeners=function(o){var u=this.sourceBuffer[o];u&&this.listeners[o].forEach(function(g){u.removeEventListener(g.event,g.listener)})},w}();function Oi(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}const Li=function(){function w(g){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=g,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b,o,u=w.prototype;return u.setStreamController=function(g){this.streamController=g},u.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},u.registerListeners=function(){var g=this.hls;g.on(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},u.unregisterListener=function(){var g=this.hls;g.off(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},u.onFpsDropLevelCapping=function(g,p){w.isLevelAllowed(p.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(p.droppedLevel)},u.onMediaAttaching=function(g,p){this.media=p.media instanceof HTMLVideoElement?p.media:null},u.onManifestParsed=function(g,p){var m=this.hls;this.restrictedLevels=[],this.firstLevel=p.firstLevel,m.config.capLevelToPlayerSize&&p.video&&this.startCapping()},u.onBufferCodecs=function(g,p){this.hls.config.capLevelToPlayerSize&&p.video&&this.startCapping()},u.onMediaDetaching=function(){this.stopCapping()},u.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var p=this.hls;p.autoLevelCapping=this.getMaxLevel(g.length-1),p.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=p.autoLevelCapping}}},u.getMaxLevel=function(g){var p=this,m=this.hls.levels;if(!m.length)return-1;var h=m.filter(function(y,T){return w.isLevelAllowed(T,p.restrictedLevels)&&T<=g});return this.clientRect=null,w.getMaxLevelByMediaSize(h,this.mediaWidth,this.mediaHeight)},u.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},u.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},u.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,p={width:0,height:0};if(g){var m=g.getBoundingClientRect();p.width=m.width,p.height=m.height,p.width||p.height||(p.width=m.right-m.left||g.width||0,p.height=m.bottom-m.top||g.height||0)}return this.clientRect=p,p},w.isLevelAllowed=function(g,p){return p===void 0&&(p=[]),p.indexOf(g)===-1},w.getMaxLevelByMediaSize=function(g,p,m){if(!g||!g.length)return-1;for(var h,y,T=g.length-1,L=0;L<g.length;L+=1){var A=g[L];if((A.width>=p||A.height>=m)&&(h=A,!(y=g[L+1])||h.width!==y.width||h.height!==y.height)){T=L;break}}return T},b=w,(o=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch(p){}return g}}])&&Oi(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}(),vi=function(){function w(o){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=o,this.registerListeners()}var b=w.prototype;return b.setStreamController=function(o){this.streamController=o},b.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(o,u){var g=this.hls.config;if(g.capLevelOnFPSDrop){var p=u.media instanceof self.HTMLVideoElement?u.media:null;this.media=p,p&&typeof p.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),g.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(o,u,g){var p=performance.now();if(u){if(this.lastTime){var m=p-this.lastTime,h=g-this.lastDroppedFrames,y=u-this.lastDecodedFrames,T=1e3*h/m,L=this.hls;if(L.trigger(c.Events.FPS_DROP,{currentDropped:h,currentDecoded:y,totalDroppedFrames:g}),T>0&&h>L.config.fpsDroppedMonitoringThreshold*y){var A=L.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+A),A>0&&(L.autoLevelCapping===-1||L.autoLevelCapping>=A)&&(A-=1,L.trigger(c.Events.FPS_DROP_LEVEL_CAPPING,{level:A,droppedLevel:L.currentLevel}),L.autoLevelCapping=A,this.streamController.nextLevelSwitch())}}this.lastTime=p,this.lastDroppedFrames=g,this.lastDecodedFrames=u}},b.checkFPSInterval=function(){var o=this.media;if(o)if(this.isVideoPlaybackQualityAvailable){var u=o.getVideoPlaybackQuality();this.checkFPS(o,u.totalVideoFrames,u.droppedVideoFrames)}else this.checkFPS(o,o.webkitDecodedFrameCount,o.webkitDroppedFrameCount)},w}();var pi=Q(408),Qr=/^age:\s*[\d.]+\s*$/m;const mi=function(){function w(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new pi.LoadStats,this.retryDelay=0}var b=w.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},b.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(o,u,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=u,this.callbacks=g,this.retryDelay=u.retryDelay,this.loadInternal()},b.loadInternal=function(){var o=this.config,u=this.context;if(o){var g=this.loader=new self.XMLHttpRequest,p=this.stats;p.loading.first=0,p.loaded=0;var m=this.xhrSetup;try{if(m)try{m(g,u.url)}catch(T){g.open("GET",u.url,!0),m(g,u.url)}g.readyState||g.open("GET",u.url,!0);var h=this.context.headers;if(h)for(var y in h)g.setRequestHeader(y,h[y])}catch(T){return void this.callbacks.onError({code:g.status,text:T.message},u,g)}u.rangeEnd&&g.setRequestHeader("Range","bytes="+u.rangeStart+"-"+(u.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=u.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),g.send()}},b.readystatechange=function(){var o=this.context,u=this.loader,g=this.stats;if(o&&u){var p=u.readyState,m=this.config;if(!g.aborted&&p>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),p===4){u.onreadystatechange=null,u.onprogress=null;var h=u.status,y=u.responseType==="arraybuffer";if(h>=200&&h<300&&(y&&u.response||u.responseText!==null)){var T,L;if(g.loading.end=Math.max(self.performance.now(),g.loading.first),L=y?(T=u.response).byteLength:(T=u.responseText).length,g.loaded=g.total=L,!this.callbacks)return;var A=this.callbacks.onProgress;if(A&&A(g,o,T,u),!this.callbacks)return;var N={url:u.responseURL,data:T};this.callbacks.onSuccess(N,g,o,u)}else g.retry>=m.maxRetry||h>=400&&h<499?(_.logger.error(h+" while loading "+o.url),this.callbacks.onError({code:h,text:u.statusText},o,u)):(_.logger.warn(h+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},b.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(o){var u=this.stats;u.loaded=o.loaded,o.lengthComputable&&(u.total=o.total)},b.getCacheAge=function(){var o=null;if(this.loader&&Qr.test(this.loader.getAllResponseHeaders())){var u=this.loader.getResponseHeader("age");o=u?parseFloat(u):null}return o},w}();var Di=function(){function w(){this.chunks=[],this.dataLength=0}var b=w.prototype;return b.push=function(o){this.chunks.push(o),this.dataLength+=o.length},b.flush=function(){var o,u=this.chunks,g=this.dataLength;return u.length?(o=u.length===1?u[0]:function(p,m){for(var h=new Uint8Array(m),y=0,T=0;T<p.length;T++){var L=p[T];h.set(L,y),y+=L.length}return h}(u,g),this.reset(),o):new Uint8Array(0)},b.reset=function(){this.chunks.length=0,this.dataLength=0},w}();function Ai(w){var b=typeof Map=="function"?new Map:void 0;return Ai=function(o){if(o===null||(u=o,Function.toString.call(u).indexOf("[native code]")===-1))return o;var u;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(b!==void 0){if(b.has(o))return b.get(o);b.set(o,g)}function g(){return yi(o,arguments,Ei(this).constructor)}return g.prototype=Object.create(o.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),Dr(g,o)},Ai(w)}function yi(w,b,o){return yi=ai()?Reflect.construct.bind():function(u,g,p){var m=[null];m.push.apply(m,g);var h=new(Function.bind.apply(u,m));return p&&Dr(h,p.prototype),h},yi.apply(null,arguments)}function ai(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(w){return!1}}function Dr(w,b){return Dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,u){return o.__proto__=u,o},Dr(w,b)}function Ei(w){return Ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(b){return b.__proto__||Object.getPrototypeOf(b)},Ei(w)}function ei(){return ei=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(w[u]=o[u])}return w},ei.apply(this,arguments)}var Pi=function(){function w(o){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=o.fetchSetup||Fi,this.controller=new self.AbortController,this.stats=new pi.LoadStats}var b=w.prototype;return b.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},b.abortInternal=function(){var o=this.response;o&&o.ok||(this.stats.aborted=!0,this.controller.abort())},b.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},b.load=function(o,u,g){var p=this,m=this.stats;if(m.loading.start)throw new Error("Loader can only be used once.");m.loading.start=self.performance.now();var h=function(A,N){var ae={method:"GET",mode:"cors",credentials:"same-origin",signal:N,headers:new self.Headers(ei({},A.headers))};return A.rangeEnd&&ae.headers.set("Range","bytes="+A.rangeStart+"-"+String(A.rangeEnd-1)),ae}(o,this.controller.signal),y=g.onProgress,T=o.responseType==="arraybuffer",L=T?"byteLength":"length";this.context=o,this.config=u,this.callbacks=g,this.request=this.fetchSetup(o,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){p.abortInternal(),g.onTimeout(m,o,p.response)},u.timeout),self.fetch(this.request).then(function(A){if(p.response=p.loader=A,!A.ok){var N=A.status,ae=A.statusText;throw new Mi(ae||"fetch, bad network response",N,A)}return m.loading.first=Math.max(self.performance.now(),m.loading.start),m.total=parseInt(A.headers.get("Content-Length")||"0"),y&&(0,U.isFiniteNumber)(u.highWaterMark)?p.loadProgressively(A,m,o,u.highWaterMark,y):T?A.arrayBuffer():A.text()}).then(function(A){var N=p.response;self.clearTimeout(p.requestTimeout),m.loading.end=Math.max(self.performance.now(),m.loading.first);var ae=A[L];ae&&(m.loaded=m.total=ae);var fe={url:N.url,data:A};y&&!(0,U.isFiniteNumber)(u.highWaterMark)&&y(m,o,A,N),g.onSuccess(fe,m,o,N)}).catch(function(A){if(self.clearTimeout(p.requestTimeout),!m.aborted){var N=A&&A.code||0,ae=A?A.message:null;g.onError({code:N,text:ae},o,A?A.details:null)}})},b.getCacheAge=function(){var o=null;if(this.response){var u=this.response.headers.get("age");o=u?parseFloat(u):null}return o},b.loadProgressively=function(o,u,g,p,m){p===void 0&&(p=0);var h=new Di,y=o.body.getReader();return function T(){return y.read().then(function(L){if(L.done)return h.dataLength&&m(u,g,h.flush(),o),Promise.resolve(new ArrayBuffer(0));var A=L.value,N=A.length;return u.loaded+=N,N<p||h.dataLength?(h.push(A),h.dataLength>=p&&m(u,g,h.flush(),o)):m(u,g,A,o),T()}).catch(function(){return Promise.reject()})}()},w}();function Fi(w,b){return new self.Request(w.url,b)}var Mi=function(w){var b,o;function u(g,p,m){var h;return(h=w.call(this,g)||this).code=void 0,h.details=void 0,h.code=p,h.details=m,h}return o=w,(b=u).prototype=Object.create(o.prototype),b.prototype.constructor=b,Dr(b,o),u}(Ai(Error));const ti=Pi;var si;(function(w){w.WIDEVINE="com.widevine.alpha",w.PLAYREADY="com.microsoft.playready"})(si||(si={}));var Ni=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Ut(){return Ut=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(w[u]=o[u])}return w},Ut.apply(this,arguments)}function Ji(w,b){var o=Object.keys(w);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(w);b&&(u=u.filter(function(g){return Object.getOwnPropertyDescriptor(w,g).enumerable})),o.push.apply(o,u)}return o}function Ui(w){for(var b=1;b<arguments.length;b++){var o=arguments[b]!=null?arguments[b]:{};b%2?Ji(Object(o),!0).forEach(function(u){Zi(w,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(o)):Ji(Object(o)).forEach(function(u){Object.defineProperty(w,u,Object.getOwnPropertyDescriptor(o,u))})}return w}function Zi(w,b,o){return b in w?Object.defineProperty(w,b,{value:o,enumerable:!0,configurable:!0,writable:!0}):w[b]=o,w}var an=Ui(Ui({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:mi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:kr,bufferController:ni,capLevelController:Li,fpsController:vi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ni,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:ii(),enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0});function Bi(w,b){for(var o=0;o<b.length;o++){var u=b[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(w,u.key,u)}}var Gi=function(){function w(p){p===void 0&&(p={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Rr.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var m=this.config=function(Ve,at){if((at.liveSyncDurationCount||at.liveMaxLatencyDurationCount)&&(at.liveSyncDuration||at.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(at.liveMaxLatencyDurationCount!==void 0&&(at.liveSyncDurationCount===void 0||at.liveMaxLatencyDurationCount<=at.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(at.liveMaxLatencyDuration!==void 0&&(at.liveSyncDuration===void 0||at.liveMaxLatencyDuration<=at.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return Ut({},Ve,at)}(w.DefaultConfig,p);this.userConfig=p,(0,_.enableLogs)(m.debug,"Hls instance"),this._autoLevelCapping=-1,m.progressive&&function(Ve){var at=Ve.loader;at!==ti&&at!==mi?(_.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),Ve.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(Rt){}return!1}()&&(Ve.loader=ti,Ve.progressive=!0,Ve.enableSoftwareAES=!0,_.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(m);var h=m.abrController,y=m.bufferController,T=m.capLevelController,L=m.fpsController,A=this.abrController=new h(this),N=this.bufferController=new y(this),ae=this.capLevelController=new T(this),fe=new L(this),Se=new Ge(this),Ce=new qe(this),_e=new vt(this),ft=this.levelController=new Ee(this),nt=new ne(this),We=this.streamController=new Hr(this,nt);ae.setStreamController(We),fe.setStreamController(We);var Je=[Se,Ce,ft,We];this.networkControllers=Je;var et=[A,N,ae,fe,_e,nt];this.audioTrackController=this.createController(m.audioTrackController,null,Je),this.createController(m.audioStreamController,nt,Je),this.subtitleTrackController=this.createController(m.subtitleTrackController,null,Je),this.createController(m.subtitleStreamController,nt,Je),this.createController(m.timelineController,null,et),this.emeController=this.createController(m.emeController,null,et),this.cmcdController=this.createController(m.cmcdController,null,et),this.latencyController=this.createController(At,null,et),this.coreComponents=et}w.isSupported=function(){return function(){var p=zt();if(!p)return!1;var m=dr(),h=p&&typeof p.isTypeSupported=="function"&&p.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),y=!m||m.prototype&&typeof m.prototype.appendBuffer=="function"&&typeof m.prototype.remove=="function";return!!h&&!!y}()};var b,o,u,g=w.prototype;return g.createController=function(p,m,h){if(p){var y=m?new p(this,m):new p(this);return h&&h.push(y),y}return null},g.on=function(p,m,h){h===void 0&&(h=this),this._emitter.on(p,m,h)},g.once=function(p,m,h){h===void 0&&(h=this),this._emitter.once(p,m,h)},g.removeAllListeners=function(p){this._emitter.removeAllListeners(p)},g.off=function(p,m,h,y){h===void 0&&(h=this),this._emitter.off(p,m,h,y)},g.listeners=function(p){return this._emitter.listeners(p)},g.emit=function(p,m,h){return this._emitter.emit(p,m,h)},g.trigger=function(p,m){if(this.config.debug)return this.emit(p,p,m);try{return this.emit(p,p,m)}catch(h){_.logger.error("An internal error happened while handling event "+p+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:p,error:h})}return!1},g.listenerCount=function(p){return this._emitter.listenerCount(p)},g.destroy=function(){_.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(p){return p.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(p){return p.destroy()}),this.coreComponents.length=0},g.attachMedia=function(p){_.logger.log("attachMedia"),this._media=p,this.trigger(c.Events.MEDIA_ATTACHING,{media:p})},g.detachMedia=function(){_.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},g.loadSource=function(p){this.stopLoad();var m=this.media,h=this.url,y=this.url=$.buildAbsoluteURL(self.location.href,p,{alwaysNormalize:!0});_.logger.log("loadSource:"+y),m&&h&&h!==y&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(m)),this.trigger(c.Events.MANIFEST_LOADING,{url:p})},g.startLoad=function(p){p===void 0&&(p=-1),_.logger.log("startLoad("+p+")"),this.networkControllers.forEach(function(m){m.startLoad(p)})},g.stopLoad=function(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(p){p.stopLoad()})},g.swapAudioCodec=function(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},g.recoverMediaError=function(){_.logger.log("recoverMediaError");var p=this._media;this.detachMedia(),p&&this.attachMedia(p)},g.removeLevel=function(p,m){m===void 0&&(m=0),this.levelController.removeLevel(p,m)},b=w,u=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return M.ErrorTypes}},{key:"ErrorDetails",get:function(){return M.ErrorDetails}},{key:"DefaultConfig",get:function(){return w.defaultConfig?w.defaultConfig:an},set:function(p){w.defaultConfig=p}}],(o=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(p){_.logger.log("set currentLevel:"+p),this.loadLevel=p,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(p){_.logger.log("set nextLevel:"+p),this.levelController.manualLevel=p,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(p){_.logger.log("set loadLevel:"+p),this.levelController.manualLevel=p}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(p){this.levelController.nextLoadLevel=p}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(p){_.logger.log("set firstLevel:"+p),this.levelController.firstLevel=p}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(p){_.logger.log("set startLevel:"+p),p!==-1&&(p=Math.max(p,this.minAutoLevel)),this.levelController.startLevel=p}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(p){var m=!!p;m!==this.config.capLevelToPlayerSize&&(m?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=m)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(p){this._autoLevelCapping!==p&&(_.logger.log("set autoLevelCapping:"+p),this._autoLevelCapping=p)}},{key:"bandwidthEstimate",get:function(){var p=this.abrController.bwEstimator;return p?p.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var p=this.levels,m=this.config.minAutoBitrate;if(!p)return 0;for(var h=p.length,y=0;y<h;y++)if(p[y].maxBitrate>=m)return y;return 0}},{key:"maxAutoLevel",get:function(){var p=this.levels,m=this.autoLevelCapping;return m===-1&&p&&p.length?p.length-1:m}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(p){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,p)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var p=this.audioTrackController;return p?p.audioTracks:[]}},{key:"audioTrack",get:function(){var p=this.audioTrackController;return p?p.audioTrack:-1},set:function(p){var m=this.audioTrackController;m&&(m.audioTrack=p)}},{key:"subtitleTracks",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTrack:-1},set:function(p){var m=this.subtitleTrackController;m&&(m.subtitleTrack=p)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var p=this.subtitleTrackController;return!!p&&p.subtitleDisplay},set:function(p){var m=this.subtitleTrackController;m&&(m.subtitleDisplay=p)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(p){this.config.lowLatencyMode=p}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Bi(b.prototype,o),u&&Bi(b,u),Object.defineProperty(b,"prototype",{writable:!1}),w}();Gi.defaultConfig=void 0},923:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{BaseSegment:()=>ue,ElementaryStreamTypes:()=>Te,Fragment:()=>de,Part:()=>te});var Te,$=Q(965),U=Q(945),c=Q(93),M=Q(960),_=Q(408);function ie(se,oe){se.prototype=Object.create(oe.prototype),se.prototype.constructor=se,q(se,oe)}function q(se,oe){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Ae,be){return Ae.__proto__=be,Ae},q(se,oe)}function V(se,oe){for(var Ae=0;Ae<oe.length;Ae++){var be=oe[Ae];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(se,be.key,be)}}function z(se,oe,Ae){return oe&&V(se.prototype,oe),Ae&&V(se,Ae),Object.defineProperty(se,"prototype",{writable:!1}),se}(function(se){se.AUDIO="audio",se.VIDEO="video",se.AUDIOVIDEO="audiovideo"})(Te||(Te={}));var ue=function(){function se(oe){var Ae;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((Ae={})[Te.AUDIO]=null,Ae[Te.VIDEO]=null,Ae[Te.AUDIOVIDEO]=null,Ae),this.baseurl=oe}return se.prototype.setByteRange=function(oe,Ae){var be=oe.split("@",2),Oe=[];be.length===1?Oe[0]=Ae?Ae.byteRangeEndOffset:0:Oe[0]=parseInt(be[1]),Oe[1]=parseInt(be[0])+Oe[0],this._byteRange=Oe},z(se,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,U.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(oe){this._url=oe}}]),se}(),de=function(se){function oe(be,Oe){var P;return(P=se.call(this,Oe)||this)._decryptdata=null,P.rawProgramDateTime=null,P.programDateTime=null,P.tagList=[],P.duration=0,P.sn=0,P.levelkey=void 0,P.type=void 0,P.loader=null,P.level=-1,P.cc=0,P.startPTS=void 0,P.endPTS=void 0,P.appendedPTS=void 0,P.startDTS=void 0,P.endDTS=void 0,P.start=0,P.deltaPTS=void 0,P.maxStartPTS=void 0,P.minEndPTS=void 0,P.stats=new _.LoadStats,P.urlId=0,P.data=void 0,P.bitrateTest=!1,P.title=null,P.initSegment=null,P.type=be,P}ie(oe,se);var Ae=oe.prototype;return Ae.createInitializationVector=function(be){for(var Oe=new Uint8Array(16),P=12;P<16;P++)Oe[P]=be>>8*(15-P)&255;return Oe},Ae.setDecryptDataFromLevelKey=function(be,Oe){var P=be;return(be==null?void 0:be.method)==="AES-128"&&be.uri&&!be.iv&&((P=M.LevelKey.fromURI(be.uri)).method=be.method,P.iv=this.createInitializationVector(Oe),P.keyFormat="identity"),P},Ae.setElementaryStreamInfo=function(be,Oe,P,k,W,K){K===void 0&&(K=!1);var Re=this.elementaryStreams,Ie=Re[be];Ie?(Ie.startPTS=Math.min(Ie.startPTS,Oe),Ie.endPTS=Math.max(Ie.endPTS,P),Ie.startDTS=Math.min(Ie.startDTS,k),Ie.endDTS=Math.max(Ie.endDTS,W)):Re[be]={startPTS:Oe,endPTS:P,startDTS:k,endDTS:W,partial:K}},Ae.clearElementaryStreamInfo=function(){var be=this.elementaryStreams;be[Te.AUDIO]=null,be[Te.VIDEO]=null,be[Te.AUDIOVIDEO]=null},z(oe,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var be=this.sn;typeof be!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),be=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,be)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,$.isFiniteNumber)(this.programDateTime))return null;var be=(0,$.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*be}},{key:"encrypted",get:function(){var be;return!((be=this.decryptdata)===null||be===void 0||!be.keyFormat||!this.decryptdata.uri)}}]),oe}(ue),te=function(se){function oe(Ae,be,Oe,P,k){var W;(W=se.call(this,Oe)||this).fragOffset=0,W.duration=0,W.gap=!1,W.independent=!1,W.relurl=void 0,W.fragment=void 0,W.index=void 0,W.stats=new _.LoadStats,W.duration=Ae.decimalFloatingPoint("DURATION"),W.gap=Ae.bool("GAP"),W.independent=Ae.bool("INDEPENDENT"),W.relurl=Ae.enumeratedString("URI"),W.fragment=be,W.index=P;var K=Ae.enumeratedString("BYTERANGE");return K&&W.setByteRange(K,k),k&&(W.fragOffset=k.fragOffset+k.duration),W}return ie(oe,se),z(oe,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var Ae=this.elementaryStreams;return!!(Ae.audio||Ae.video||Ae.audiovideo)}}]),oe}(ue)},960:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{LevelKey:()=>U});var Te=Q(945);function $(c,M){for(var _=0;_<M.length;_++){var ie=M[_];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(c,ie.key,ie)}}var U=function(){function c(ie,q){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=q?(0,Te.buildAbsoluteURL)(ie,q,{alwaysNormalize:!0}):ie}var M,_;return c.fromURL=function(ie,q){return new c(ie,q)},c.fromURI=function(ie){return new c(ie)},M=c,(_=[{key:"uri",get:function(){return this._uri}}])&&$(M.prototype,_),Object.defineProperty(M,"prototype",{writable:!1}),c}()},408:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{LoadStats:()=>Te});var Te=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{MAX_SAFE_INTEGER:()=>$,isFiniteNumber:()=>Te});var Te=Number.isFinite||function(U){return typeof U=="number"&&isFinite(U)},$=Number.MAX_SAFE_INTEGER||9007199254740991},856:(ht,Pe,Q)=>{"use strict";var Te;Q.r(Pe),Q.d(Pe,{MetadataSchema:()=>Te}),function($){$.audioId3="org.id3",$.dateRange="com.apple.quicktime.HLS",$.emsg="https://aomedia.org/emsg/ID3"}(Te||(Te={}))},308:(ht,Pe,Q)=>{"use strict";var Te,$;Q.r(Pe),Q.d(Pe,{PlaylistContextType:()=>Te,PlaylistLevelType:()=>$}),function(U){U.MANIFEST="manifest",U.LEVEL="level",U.AUDIO_TRACK="audioTrack",U.SUBTITLE_TRACK="subtitleTrack"}(Te||(Te={})),function(U){U.MAIN="main",U.AUDIO="audio",U.SUBTITLE="subtitle"}($||($={}))},93:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{enableLogs:()=>M,logger:()=>_});var Te=function(){},$={trace:Te,debug:Te,log:Te,warn:Te,info:Te,error:Te},U=$;function c(ie){var q=self.console[ie];return q?q.bind(self.console,"["+ie+"] >"):Te}function M(ie,q){if(self.console&&ie===!0||typeof ie=="object"){(function(V){for(var z=arguments.length,ue=new Array(z>1?z-1:0),de=1;de<z;de++)ue[de-1]=arguments[de];ue.forEach(function(te){U[te]=V[te]?V[te].bind(V):c(te)})})(ie,"debug","log","info","warn","error");try{U.log('Debug logs enabled for "'+q+'"')}catch(V){U=$}}else U=$}var _=$},63:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{RemuxerTrackIdConfig:()=>_,appendUint8Array:()=>k,bin2str:()=>ie,computeRawDurationFromSamples:()=>be,discardEPB:()=>Ie,findBox:()=>de,getDuration:()=>Ae,getStartDTS:()=>oe,offsetStartDTS:()=>Oe,parseEmsg:()=>we,parseInitSegment:()=>se,parseSEIMessageFromNALu:()=>Re,parseSamples:()=>W,parseSegmentIndex:()=>te,readSint32:()=>z,readUint16:()=>q,readUint32:()=>V,segmentValidRange:()=>P,writeUint32:()=>ue});var Te=Q(145),$=Q(923),U=Q(181),c=Math.pow(2,32)-1,M=[].push,_={video:1,audio:2,id3:3,text:4};function ie(B){return String.fromCharCode.apply(null,B)}function q(B,le){var ee=B[le]<<8|B[le+1];return ee<0?65536+ee:ee}function V(B,le){var ee=z(B,le);return ee<0?4294967296+ee:ee}function z(B,le){return B[le]<<24|B[le+1]<<16|B[le+2]<<8|B[le+3]}function ue(B,le,ee){B[le]=ee>>24,B[le+1]=ee>>16&255,B[le+2]=ee>>8&255,B[le+3]=255&ee}function de(B,le){var ee=[];if(!le.length)return ee;for(var he=B.byteLength,G=0;G<he;){var xe=V(B,G),Ge=xe>1?G+xe:he;if(ie(B.subarray(G+4,G+8))===le[0])if(le.length===1)ee.push(B.subarray(G+8,Ge));else{var qe=de(B.subarray(G+8,Ge),le.slice(1));qe.length&&M.apply(ee,qe)}G=Ge}return ee}function te(B){var le=[],ee=B[0],he=8,G=V(B,he);he+=4,he+=ee===0?8:16,he+=2;var xe=B.length+0,Ge=q(B,he);he+=2;for(var qe=0;qe<Ge;qe++){var it=he,ye=V(B,it);it+=4;var Ze=2147483647&ye;if((2147483648&ye)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var st=V(B,it);it+=4,le.push({referenceSize:Ze,subsegmentDuration:st,info:{duration:st/G,start:xe,end:xe+Ze-1}}),xe+=Ze,he=it+=4}return{earliestPresentationTime:0,timescale:G,version:ee,referencesCount:Ge,references:le}}function se(B){for(var le=[],ee=de(B,["moov","trak"]),he=0;he<ee.length;he++){var G=ee[he],xe=de(G,["tkhd"])[0];if(xe){var Ge=xe[0],qe=Ge===0?12:20,it=V(xe,qe),ye=de(G,["mdia","mdhd"])[0];if(ye){var Ze=V(ye,qe=(Ge=ye[0])===0?12:20),st=de(G,["mdia","hdlr"])[0];if(st){var Et=ie(st.subarray(8,12)),lt={soun:$.ElementaryStreamTypes.AUDIO,vide:$.ElementaryStreamTypes.VIDEO}[Et];if(lt){var vt=de(G,["mdia","minf","stbl","stsd"])[0],St=void 0;vt&&(St=ie(vt.subarray(12,16))),le[it]={timescale:Ze,type:lt},le[lt]={timescale:Ze,id:it,codec:St}}}}}}return de(B,["moov","mvex","trex"]).forEach(function(gt){var At=V(gt,4),Lt=le[At];Lt&&(Lt.default={duration:V(gt,12),flags:V(gt,20)})}),le}function oe(B,le){return de(le,["moof","traf"]).reduce(function(ee,he){var G=de(he,["tfdt"])[0],xe=G[0],Ge=de(he,["tfhd"]).reduce(function(qe,it){var ye=V(it,4),Ze=B[ye];if(Ze){var st=V(G,4);xe===1&&(st*=Math.pow(2,32),st+=V(G,8));var Et=st/(Ze.timescale||9e4);if(isFinite(Et)&&(qe===null||Et<qe))return Et}return qe},null);return Ge!==null&&isFinite(Ge)&&(ee===null||Ge<ee)?Ge:ee},null)||0}function Ae(B,le){for(var ee=0,he=0,G=0,xe=de(B,["moof","traf"]),Ge=0;Ge<xe.length;Ge++){var qe=xe[Ge],it=de(qe,["tfhd"])[0],ye=le[V(it,4)];if(ye){var Ze=ye.default,st=V(it,0)|(Ze==null?void 0:Ze.flags),Et=Ze==null?void 0:Ze.duration;8&st&&(Et=V(it,2&st?12:8));for(var lt=ye.timescale||9e4,vt=de(qe,["trun"]),St=0;St<vt.length;St++)!(ee=be(vt[St]))&&Et&&(ee=Et*V(vt[St],4)),ye.type===$.ElementaryStreamTypes.VIDEO?he+=ee/lt:ye.type===$.ElementaryStreamTypes.AUDIO&&(G+=ee/lt)}}if(he===0&&G===0){for(var gt=0,At=de(B,["sidx"]),Lt=0;Lt<At.length;Lt++){var yt=te(At[Lt]);yt!=null&&yt.references&&(gt+=yt.references.reduce(function(Ot,_t){return Ot+_t.info.duration||0},0))}return gt}return he||G}function be(B){var le=V(B,0),ee=8;1&le&&(ee+=4),4&le&&(ee+=4);for(var he=0,G=V(B,4),xe=0;xe<G;xe++)256&le&&(he+=V(B,ee),ee+=4),512&le&&(ee+=4),1024&le&&(ee+=4),2048&le&&(ee+=4);return he}function Oe(B,le,ee){de(le,["moof","traf"]).forEach(function(he){de(he,["tfhd"]).forEach(function(G){var xe=V(G,4),Ge=B[xe];if(Ge){var qe=Ge.timescale||9e4;de(he,["tfdt"]).forEach(function(it){var ye=it[0],Ze=V(it,4);if(ye===0)Ze-=ee*qe,ue(it,4,Ze=Math.max(Ze,0));else{Ze*=Math.pow(2,32),Ze+=V(it,8),Ze-=ee*qe,Ze=Math.max(Ze,0);var st=Math.floor(Ze/(c+1)),Et=Math.floor(Ze%(c+1));ue(it,4,st),ue(it,8,Et)}})}})})}function P(B){var le={valid:null,remainder:null},ee=de(B,["moof"]);if(!ee)return le;if(ee.length<2)return le.remainder=B,le;var he=ee[ee.length-1];return le.valid=(0,Te.sliceUint8)(B,0,he.byteOffset-8),le.remainder=(0,Te.sliceUint8)(B,he.byteOffset-8),le}function k(B,le){var ee=new Uint8Array(B.length+le.length);return ee.set(B),ee.set(le,B.length),ee}function W(B,le){var ee=[],he=le.samples,G=le.timescale,xe=le.id,Ge=!1;return de(he,["moof"]).map(function(qe){var it=qe.byteOffset-8;de(qe,["traf"]).map(function(ye){var Ze=de(ye,["tfdt"]).map(function(st){var Et=st[0],lt=V(st,4);return Et===1&&(lt*=Math.pow(2,32),lt+=V(st,8)),lt/G})[0];return Ze!==void 0&&(B=Ze),de(ye,["tfhd"]).map(function(st){var Et=V(st,4),lt=16777215&V(st,0),vt=0,St=(16&lt)!=0,gt=0,At=(32&lt)!=0,Lt=8;Et===xe&&((1&lt)!=0&&(Lt+=8),(2&lt)!=0&&(Lt+=4),(8&lt)!=0&&(vt=V(st,Lt),Lt+=4),St&&(gt=V(st,Lt),Lt+=4),At&&(Lt+=4),le.type==="video"&&(Ge=function(yt){if(!yt)return!1;var Ot=yt.indexOf("."),_t=Ot<0?yt:yt.substring(0,Ot);return _t==="hvc1"||_t==="hev1"||_t==="dvh1"||_t==="dvhe"}(le.codec)),de(ye,["trun"]).map(function(yt){var Ot=yt[0],_t=16777215&V(yt,0),Jt=(1&_t)!=0,Gt=0,wt=(4&_t)!=0,tr=(256&_t)!=0,Zt=0,rr=(512&_t)!=0,lr=0,ur=(1024&_t)!=0,hr=(2048&_t)!=0,Xt=0,sr=V(yt,4),Ee=8;Jt&&(Gt=V(yt,Ee),Ee+=4),wt&&(Ee+=4);for(var ne=Gt+it,x=0;x<sr;x++){if(tr?(Zt=V(yt,Ee),Ee+=4):Zt=vt,rr?(lr=V(yt,Ee),Ee+=4):lr=gt,ur&&(Ee+=4),hr&&(Xt=Ot===0?V(yt,Ee):z(yt,Ee),Ee+=4),le.type===$.ElementaryStreamTypes.VIDEO)for(var re=0;re<lr;){var J=V(he,ne);K(Ge,he[ne+=4])&&Re(he.subarray(ne,ne+J),Ge?2:1,B+Xt/G,ee),ne+=J,re+=J+4}B+=Zt/G}}))})})}),ee}function K(B,le){if(B){var ee=le>>1&63;return ee===39||ee===40}return(31&le)==6}function Re(B,le,ee,he){var G=Ie(B),xe=0;xe+=le;for(var Ge=0,qe=0,it=!1,ye=0;xe<G.length;){Ge=0;do{if(xe>=G.length)break;Ge+=ye=G[xe++]}while(ye===255);qe=0;do{if(xe>=G.length)break;qe+=ye=G[xe++]}while(ye===255);var Ze=G.length-xe;if(!it&&Ge===4&&xe<G.length){if(it=!0,G[xe++]===181){var st=q(G,xe);if(xe+=2,st===49){var Et=V(G,xe);if(xe+=4,Et===1195456820){var lt=G[xe++];if(lt===3){var vt=G[xe++],St=64&vt,gt=St?2+3*(31&vt):0,At=new Uint8Array(gt);if(St){At[0]=vt;for(var Lt=1;Lt<gt;Lt++)At[Lt]=G[xe++]}he.push({type:lt,payloadType:Ge,pts:ee,bytes:At})}}}}}else if(Ge===5&&qe<Ze){if(it=!0,qe>16){for(var yt=[],Ot=0;Ot<16;Ot++){var _t=G[xe++].toString(16);yt.push(_t.length==1?"0"+_t:_t),Ot!==3&&Ot!==5&&Ot!==7&&Ot!==9||yt.push("-")}for(var Jt=qe-16,Gt=new Uint8Array(Jt),wt=0;wt<Jt;wt++)Gt[wt]=G[xe++];he.push({payloadType:Ge,pts:ee,uuid:yt.join(""),userData:(0,U.utf8ArrayToStr)(Gt),userDataBytes:Gt})}}else if(qe<Ze)xe+=qe;else if(qe>Ze)break}}function Ie(B){for(var le=B.byteLength,ee=[],he=1;he<le-2;)B[he]===0&&B[he+1]===0&&B[he+2]===3?(ee.push(he+2),he+=2):he++;if(ee.length===0)return B;var G=le-ee.length,xe=new Uint8Array(G),Ge=0;for(he=0;he<G;Ge++,he++)Ge===ee[0]&&(Ge++,ee.shift()),xe[he]=B[Ge];return xe}function we(B){var le=B[0],ee="",he="",G=0,xe=0,Ge=0,qe=0,it=0,ye=0;if(le===0){for(;ie(B.subarray(ye,ye+1))!=="\0";)ee+=ie(B.subarray(ye,ye+1)),ye+=1;for(ee+=ie(B.subarray(ye,ye+1)),ye+=1;ie(B.subarray(ye,ye+1))!=="\0";)he+=ie(B.subarray(ye,ye+1)),ye+=1;he+=ie(B.subarray(ye,ye+1)),ye+=1,G=V(B,12),xe=V(B,16),qe=V(B,20),it=V(B,24),ye=28}else if(le===1){G=V(B,ye+=4);var Ze=V(B,ye+=4),st=V(B,ye+=4);for(ye+=4,Ge=Math.pow(2,32)*Ze+st,Number.isSafeInteger(Ge)||(Ge=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),qe=V(B,ye),it=V(B,ye+=4),ye+=4;ie(B.subarray(ye,ye+1))!=="\0";)ee+=ie(B.subarray(ye,ye+1)),ye+=1;for(ee+=ie(B.subarray(ye,ye+1)),ye+=1;ie(B.subarray(ye,ye+1))!=="\0";)he+=ie(B.subarray(ye,ye+1)),ye+=1;he+=ie(B.subarray(ye,ye+1)),ye+=1}return{schemeIdUri:ee,value:he,timeScale:G,presentationTime:Ge,presentationTimeDelta:xe,eventDuration:qe,id:it,payload:B.subarray(ye,B.byteLength)}}},145:(ht,Pe,Q)=>{"use strict";function Te($,U,c){return Uint8Array.prototype.slice?$.slice(U,c):new Uint8Array(Array.prototype.slice.call($,U,c))}Q.r(Pe),Q.d(Pe,{sliceUint8:()=>Te})},729:ht=>{"use strict";var Pe=Object.prototype.hasOwnProperty,Q="~";function Te(){}function $(_,ie,q){this.fn=_,this.context=ie,this.once=q||!1}function U(_,ie,q,V,z){if(typeof q!="function")throw new TypeError("The listener must be a function");var ue=new $(q,V||_,z),de=Q?Q+ie:ie;return _._events[de]?_._events[de].fn?_._events[de]=[_._events[de],ue]:_._events[de].push(ue):(_._events[de]=ue,_._eventsCount++),_}function c(_,ie){--_._eventsCount==0?_._events=new Te:delete _._events[ie]}function M(){this._events=new Te,this._eventsCount=0}Object.create&&(Te.prototype=Object.create(null),new Te().__proto__||(Q=!1)),M.prototype.eventNames=function(){var _,ie,q=[];if(this._eventsCount===0)return q;for(ie in _=this._events)Pe.call(_,ie)&&q.push(Q?ie.slice(1):ie);return Object.getOwnPropertySymbols?q.concat(Object.getOwnPropertySymbols(_)):q},M.prototype.listeners=function(_){var ie=Q?Q+_:_,q=this._events[ie];if(!q)return[];if(q.fn)return[q.fn];for(var V=0,z=q.length,ue=new Array(z);V<z;V++)ue[V]=q[V].fn;return ue},M.prototype.listenerCount=function(_){var ie=Q?Q+_:_,q=this._events[ie];return q?q.fn?1:q.length:0},M.prototype.emit=function(_,ie,q,V,z,ue){var de=Q?Q+_:_;if(!this._events[de])return!1;var te,se,oe=this._events[de],Ae=arguments.length;if(oe.fn){switch(oe.once&&this.removeListener(_,oe.fn,void 0,!0),Ae){case 1:return oe.fn.call(oe.context),!0;case 2:return oe.fn.call(oe.context,ie),!0;case 3:return oe.fn.call(oe.context,ie,q),!0;case 4:return oe.fn.call(oe.context,ie,q,V),!0;case 5:return oe.fn.call(oe.context,ie,q,V,z),!0;case 6:return oe.fn.call(oe.context,ie,q,V,z,ue),!0}for(se=1,te=new Array(Ae-1);se<Ae;se++)te[se-1]=arguments[se];oe.fn.apply(oe.context,te)}else{var be,Oe=oe.length;for(se=0;se<Oe;se++)switch(oe[se].once&&this.removeListener(_,oe[se].fn,void 0,!0),Ae){case 1:oe[se].fn.call(oe[se].context);break;case 2:oe[se].fn.call(oe[se].context,ie);break;case 3:oe[se].fn.call(oe[se].context,ie,q);break;case 4:oe[se].fn.call(oe[se].context,ie,q,V);break;default:if(!te)for(be=1,te=new Array(Ae-1);be<Ae;be++)te[be-1]=arguments[be];oe[se].fn.apply(oe[se].context,te)}}return!0},M.prototype.on=function(_,ie,q){return U(this,_,ie,q,!1)},M.prototype.once=function(_,ie,q){return U(this,_,ie,q,!0)},M.prototype.removeListener=function(_,ie,q,V){var z=Q?Q+_:_;if(!this._events[z])return this;if(!ie)return c(this,z),this;var ue=this._events[z];if(ue.fn)ue.fn!==ie||V&&!ue.once||q&&ue.context!==q||c(this,z);else{for(var de=0,te=[],se=ue.length;de<se;de++)(ue[de].fn!==ie||V&&!ue[de].once||q&&ue[de].context!==q)&&te.push(ue[de]);te.length?this._events[z]=te.length===1?te[0]:te:c(this,z)}return this},M.prototype.removeAllListeners=function(_){var ie;return _?(ie=Q?Q+_:_,this._events[ie]&&c(this,ie)):(this._events=new Te,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=Q,M.EventEmitter=M,ht.exports=M},945:function(ht){var Pe,Q,Te,$,U;Pe=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Q=/^(?=([^\/?#]*))\1([^]*)$/,Te=/(?:\/|^)\.(?=\/)/g,$=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,U={buildAbsoluteURL:function(c,M,_){if(_=_||{},c=c.trim(),!(M=M.trim())){if(!_.alwaysNormalize)return c;var ie=U.parseURL(c);if(!ie)throw new Error("Error trying to parse base URL.");return ie.path=U.normalizePath(ie.path),U.buildURLFromParts(ie)}var q=U.parseURL(M);if(!q)throw new Error("Error trying to parse relative URL.");if(q.scheme)return _.alwaysNormalize?(q.path=U.normalizePath(q.path),U.buildURLFromParts(q)):M;var V=U.parseURL(c);if(!V)throw new Error("Error trying to parse base URL.");if(!V.netLoc&&V.path&&V.path[0]!=="/"){var z=Q.exec(V.path);V.netLoc=z[1],V.path=z[2]}V.netLoc&&!V.path&&(V.path="/");var ue={scheme:V.scheme,netLoc:q.netLoc,path:null,params:q.params,query:q.query,fragment:q.fragment};if(!q.netLoc&&(ue.netLoc=V.netLoc,q.path[0]!=="/"))if(q.path){var de=V.path,te=de.substring(0,de.lastIndexOf("/")+1)+q.path;ue.path=U.normalizePath(te)}else ue.path=V.path,q.params||(ue.params=V.params,q.query||(ue.query=V.query));return ue.path===null&&(ue.path=_.alwaysNormalize?U.normalizePath(q.path):q.path),U.buildURLFromParts(ue)},parseURL:function(c){var M=Pe.exec(c);return M?{scheme:M[1]||"",netLoc:M[2]||"",path:M[3]||"",params:M[4]||"",query:M[5]||"",fragment:M[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(Te,"");c.length!==(c=c.replace($,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}},ht.exports=U}},Cr={};function pr(ht){var Pe=Cr[ht];if(Pe!==void 0)return Pe.exports;var Q=Cr[ht]={exports:{}};return ri[ht].call(Q.exports,Q,Q.exports,pr),Q.exports}pr.m=ri,pr.n=ht=>{var Pe=ht&&ht.__esModule?()=>ht.default:()=>ht;return pr.d(Pe,{a:Pe}),Pe},pr.d=(ht,Pe)=>{for(var Q in Pe)pr.o(Pe,Q)&&!pr.o(ht,Q)&&Object.defineProperty(ht,Q,{enumerable:!0,get:Pe[Q]})},pr.o=(ht,Pe)=>Object.prototype.hasOwnProperty.call(ht,Pe),pr.r=ht=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(ht,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ht,"__esModule",{value:!0})};var Kr=pr(392);return Kr.default})())},7807:function($i){typeof window!="undefined"&&function(ri,Cr){$i.exports=Cr()}(this,()=>(()=>{var ri={21:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>ie});var Te=function(){function q(V,z){this.subtle=void 0,this.aesIV=void 0,this.subtle=V,this.aesIV=z}return q.prototype.decrypt=function(V,z){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},z,V)},q}(),$=function(){function q(V,z){this.subtle=void 0,this.key=void 0,this.subtle=V,this.key=z}return q.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},q}(),U=Q(145),c=function(){function q(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var V=q.prototype;return V.uint8ArrayToUint32Array_=function(z){for(var ue=new DataView(z),de=new Uint32Array(4),te=0;te<4;te++)de[te]=ue.getUint32(4*te);return de},V.initTable=function(){var z=this.sBox,ue=this.invSBox,de=this.subMix,te=de[0],se=de[1],oe=de[2],Ae=de[3],be=this.invSubMix,Oe=be[0],P=be[1],k=be[2],W=be[3],K=new Uint32Array(256),Re=0,Ie=0,we=0;for(we=0;we<256;we++)K[we]=we<128?we<<1:we<<1^283;for(we=0;we<256;we++){var B=Ie^Ie<<1^Ie<<2^Ie<<3^Ie<<4;B=B>>>8^255&B^99,z[Re]=B,ue[B]=Re;var le=K[Re],ee=K[le],he=K[ee],G=257*K[B]^16843008*B;te[Re]=G<<24|G>>>8,se[Re]=G<<16|G>>>16,oe[Re]=G<<8|G>>>24,Ae[Re]=G,G=16843009*he^65537*ee^257*le^16843008*Re,Oe[B]=G<<24|G>>>8,P[B]=G<<16|G>>>16,k[B]=G<<8|G>>>24,W[B]=G,Re?(Re=le^K[K[K[he^le]]],Ie^=K[K[Ie]]):Re=Ie=1}},V.expandKey=function(z){for(var ue=this.uint8ArrayToUint32Array_(z),de=!0,te=0;te<ue.length&&de;)de=ue[te]===this.key[te],te++;if(!de){this.key=ue;var se=this.keySize=ue.length;if(se!==4&&se!==6&&se!==8)throw new Error("Invalid aes key size="+se);var oe,Ae,be,Oe,P=this.ksRows=4*(se+6+1),k=this.keySchedule=new Uint32Array(P),W=this.invKeySchedule=new Uint32Array(P),K=this.sBox,Re=this.rcon,Ie=this.invSubMix,we=Ie[0],B=Ie[1],le=Ie[2],ee=Ie[3];for(oe=0;oe<P;oe++)oe<se?be=k[oe]=ue[oe]:(Oe=be,oe%se==0?(Oe=K[(Oe=Oe<<8|Oe>>>24)>>>24]<<24|K[Oe>>>16&255]<<16|K[Oe>>>8&255]<<8|K[255&Oe],Oe^=Re[oe/se|0]<<24):se>6&&oe%se==4&&(Oe=K[Oe>>>24]<<24|K[Oe>>>16&255]<<16|K[Oe>>>8&255]<<8|K[255&Oe]),k[oe]=be=(k[oe-se]^Oe)>>>0);for(Ae=0;Ae<P;Ae++)oe=P-Ae,Oe=3&Ae?k[oe]:k[oe-4],W[Ae]=Ae<4||oe<=4?Oe:we[K[Oe>>>24]]^B[K[Oe>>>16&255]]^le[K[Oe>>>8&255]]^ee[K[255&Oe]],W[Ae]=W[Ae]>>>0}},V.networkToHostOrderSwap=function(z){return z<<24|(65280&z)<<8|(16711680&z)>>8|z>>>24},V.decrypt=function(z,ue,de){for(var te,se,oe,Ae,be,Oe,P,k,W,K,Re,Ie,we,B,le=this.keySize+6,ee=this.invKeySchedule,he=this.invSBox,G=this.invSubMix,xe=G[0],Ge=G[1],qe=G[2],it=G[3],ye=this.uint8ArrayToUint32Array_(de),Ze=ye[0],st=ye[1],Et=ye[2],lt=ye[3],vt=new Int32Array(z),St=new Int32Array(vt.length),gt=this.networkToHostOrderSwap;ue<vt.length;){for(W=gt(vt[ue]),K=gt(vt[ue+1]),Re=gt(vt[ue+2]),Ie=gt(vt[ue+3]),be=W^ee[0],Oe=Ie^ee[1],P=Re^ee[2],k=K^ee[3],we=4,B=1;B<le;B++)te=xe[be>>>24]^Ge[Oe>>16&255]^qe[P>>8&255]^it[255&k]^ee[we],se=xe[Oe>>>24]^Ge[P>>16&255]^qe[k>>8&255]^it[255&be]^ee[we+1],oe=xe[P>>>24]^Ge[k>>16&255]^qe[be>>8&255]^it[255&Oe]^ee[we+2],Ae=xe[k>>>24]^Ge[be>>16&255]^qe[Oe>>8&255]^it[255&P]^ee[we+3],be=te,Oe=se,P=oe,k=Ae,we+=4;te=he[be>>>24]<<24^he[Oe>>16&255]<<16^he[P>>8&255]<<8^he[255&k]^ee[we],se=he[Oe>>>24]<<24^he[P>>16&255]<<16^he[k>>8&255]<<8^he[255&be]^ee[we+1],oe=he[P>>>24]<<24^he[k>>16&255]<<16^he[be>>8&255]<<8^he[255&Oe]^ee[we+2],Ae=he[k>>>24]<<24^he[be>>16&255]<<16^he[Oe>>8&255]<<8^he[255&P]^ee[we+3],St[ue]=gt(te^Ze),St[ue+1]=gt(Ae^st),St[ue+2]=gt(oe^Et),St[ue+3]=gt(se^lt),Ze=W,st=K,Et=Re,lt=Ie,ue+=4}return St.buffer},q}(),M=Q(93),_=Q(63),ie=function(){function q(z,ue,de){var te=(de===void 0?{}:de).removePKCS7Padding,se=te===void 0||te;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=z,this.config=ue,this.removePKCS7Padding=se,se)try{var oe=self.crypto;oe&&(this.subtle=oe.subtle||oe.webkitSubtle)}catch(Ae){}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var V=q.prototype;return V.destroy=function(){this.observer=null},V.isSync=function(){return this.config.enableSoftwareAES},V.flush=function(){var z=this.currentResult;if(z){var ue,de,te,se=new Uint8Array(z);return this.reset(),this.removePKCS7Padding?(te=(de=(ue=se).byteLength)&&new DataView(ue.buffer).getUint8(de-1))?(0,U.sliceUint8)(ue,0,de-te):ue:se}this.reset()},V.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},V.decrypt=function(z,ue,de,te){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(z),ue,de);var se=this.flush();se&&te(se.buffer)}else this.webCryptoDecrypt(new Uint8Array(z),ue,de).then(te)},V.softwareDecrypt=function(z,ue,de){var te=this.currentIV,se=this.currentResult,oe=this.remainderData;this.logOnce("JS AES decrypt"),oe&&(z=(0,_.appendUint8Array)(oe,z),this.remainderData=null);var Ae=this.getValidChunk(z);if(!Ae.length)return null;te&&(de=te);var be=this.softwareDecrypter;be||(be=this.softwareDecrypter=new c),be.expandKey(ue);var Oe=se;return this.currentResult=be.decrypt(Ae.buffer,0,de),this.currentIV=(0,U.sliceUint8)(Ae,-16).buffer,Oe||null},V.webCryptoDecrypt=function(z,ue,de){var te=this,se=this.subtle;return this.key===ue&&this.fastAesKey||(this.key=ue,this.fastAesKey=new $(se,ue)),this.fastAesKey.expandKey().then(function(oe){return se?new Te(se,de).decrypt(z.buffer,oe):Promise.reject(new Error("web crypto not initialized"))}).catch(function(oe){return te.onWebCryptoError(oe,z,ue,de)})},V.onWebCryptoError=function(z,ue,de,te){return M.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",z),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(ue,de,te)},V.getValidChunk=function(z){var ue=z,de=z.length-z.length%16;return de!==z.length&&(ue=(0,U.sliceUint8)(z,0,de),this.remainderData=(0,U.sliceUint8)(z,de)),ue},V.logOnce=function(z){this.logEnabled&&(M.logger.log("[decrypter.ts]: "+z),this.logEnabled=!1)},q}()},181:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{canParse:()=>_,decodeFrame:()=>ue,getID3Data:()=>c,getID3Frames:()=>z,getTimeStamp:()=>ie,isFooter:()=>U,isHeader:()=>$,isTimeStampFrame:()=>q,testables:()=>be,utf8ArrayToStr:()=>Ae});var Te,$=function(P,k){return k+10<=P.length&&P[k]===73&&P[k+1]===68&&P[k+2]===51&&P[k+3]<255&&P[k+4]<255&&P[k+6]<128&&P[k+7]<128&&P[k+8]<128&&P[k+9]<128},U=function(P,k){return k+10<=P.length&&P[k]===51&&P[k+1]===68&&P[k+2]===73&&P[k+3]<255&&P[k+4]<255&&P[k+6]<128&&P[k+7]<128&&P[k+8]<128&&P[k+9]<128},c=function(P,k){for(var W=k,K=0;$(P,k);)K+=10,K+=M(P,k+6),U(P,k+10)&&(K+=10),k+=K;if(K>0)return P.subarray(W,W+K)},M=function(P,k){var W=0;return W=(127&P[k])<<21,W|=(127&P[k+1])<<14,(W|=(127&P[k+2])<<7)|127&P[k+3]},_=function(P,k){return $(P,k)&&M(P,k+6)+10<=P.length-k},ie=function(P){for(var k=z(P),W=0;W<k.length;W++){var K=k[W];if(q(K))return oe(K)}},q=function(P){return P&&P.key==="PRIV"&&P.info==="com.apple.streaming.transportStreamTimestamp"},V=function(P){var k=String.fromCharCode(P[0],P[1],P[2],P[3]),W=M(P,4);return{type:k,size:W,data:P.subarray(10,10+W)}},z=function(P){for(var k=0,W=[];$(P,k);){for(var K=M(P,k+6),Re=(k+=10)+K;k+8<Re;){var Ie=V(P.subarray(k)),we=ue(Ie);we&&W.push(we),k+=Ie.size+10}U(P,k)&&(k+=10)}return W},ue=function(P){return P.type==="PRIV"?de(P):P.type[0]==="W"?se(P):te(P)},de=function(P){if(!(P.size<2)){var k=Ae(P.data,!0),W=new Uint8Array(P.data.subarray(k.length+1));return{key:P.type,info:k,data:W.buffer}}},te=function(P){if(!(P.size<2)){if(P.type==="TXXX"){var k=1,W=Ae(P.data.subarray(k),!0);k+=W.length+1;var K=Ae(P.data.subarray(k));return{key:P.type,info:W,data:K}}var Re=Ae(P.data.subarray(1));return{key:P.type,data:Re}}},se=function(P){if(P.type==="WXXX"){if(P.size<2)return;var k=1,W=Ae(P.data.subarray(k),!0);k+=W.length+1;var K=Ae(P.data.subarray(k));return{key:P.type,info:W,data:K}}var Re=Ae(P.data);return{key:P.type,data:Re}},oe=function(P){if(P.data.byteLength===8){var k=new Uint8Array(P.data),W=1&k[3],K=(k[4]<<23)+(k[5]<<15)+(k[6]<<7)+k[7];return K/=45,W&&(K+=4772185884e-2),Math.round(K)}},Ae=function(P,k){k===void 0&&(k=!1);var W=Oe();if(W){var K=W.decode(P);if(k){var Re=K.indexOf("\0");return Re!==-1?K.substring(0,Re):K}return K.replace(/\0/g,"")}for(var Ie,we,B,le=P.length,ee="",he=0;he<le;){if((Ie=P[he++])===0&&k)return ee;if(Ie!==0&&Ie!==3)switch(Ie>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ee+=String.fromCharCode(Ie);break;case 12:case 13:we=P[he++],ee+=String.fromCharCode((31&Ie)<<6|63&we);break;case 14:we=P[he++],B=P[he++],ee+=String.fromCharCode((15&Ie)<<12|(63&we)<<6|(63&B)<<0)}}return ee},be={decodeTextFrame:te};function Oe(){return Te||self.TextDecoder===void 0||(Te=new self.TextDecoder("utf-8")),Te}},182:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>M});var Te=Q(544),$=Q(851),U=Q(93),c=Q(729);function M(V){var z=new c.EventEmitter,ue=function(de,te){V.postMessage({event:de,data:te})};z.on($.Events.FRAG_DECRYPTED,ue),z.on($.Events.ERROR,ue),V.addEventListener("message",function(de){var te=de.data;switch(te.cmd){case"init":var se=JSON.parse(te.config);V.transmuxer=new Te.default(z,te.typeSupported,se,te.vendor,te.id),(0,U.enableLogs)(se.debug,te.id),function(){var Oe=function(k){U.logger[k]=function(W){ue("workerLog",{logType:k,message:W})}};for(var P in U.logger)Oe(P)}(),ue("init",null);break;case"configure":V.transmuxer.configure(te.config);break;case"demux":var oe=V.transmuxer.push(te.data,te.decryptdata,te.chunkMeta,te.state);(0,Te.isPromise)(oe)?oe.then(function(Oe){_(V,Oe)}):_(V,oe);break;case"flush":var Ae=te.chunkMeta,be=V.transmuxer.flush(Ae);(0,Te.isPromise)(be)?be.then(function(Oe){q(V,Oe,Ae)}):q(V,be,Ae)}})}function _(V,z){if(!((ue=z.remuxResult).audio||ue.video||ue.text||ue.id3||ue.initSegment))return!1;var ue,de=[],te=z.remuxResult,se=te.audio,oe=te.video;return se&&ie(de,se),oe&&ie(de,oe),V.postMessage({event:"transmuxComplete",data:z},de),!0}function ie(V,z){z.data1&&V.push(z.data1.buffer),z.data2&&V.push(z.data2.buffer)}function q(V,z,ue){z.reduce(function(de,te){return _(V,te)||de},!1)||V.postMessage({event:"transmuxComplete",data:z[0]}),V.postMessage({event:"flush",data:ue})}},544:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{TransmuxConfig:()=>Xt,TransmuxState:()=>sr,default:()=>lr,isPromise:()=>hr});var Te=Q(851),$=Q(973),U=Q(21),c=Q(965),M=Q(181),_=Q(856);function ie(Ee,ne){return Ee===void 0&&(Ee=""),ne===void 0&&(ne=9e4),{type:Ee,id:-1,pid:-1,inputTimeScale:ne,sequenceNumber:-1,samples:[],dropped:0}}var q=Q(63),V=Q(145),z=function(){function Ee(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var ne=Ee.prototype;return ne.resetInitSegment=function(x,re,J,ce){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},ne.resetTimeStamp=function(x){this.initPTS=x,this.resetContiguity()},ne.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},ne.canParse=function(x,re){return!1},ne.appendFrame=function(x,re,J){},ne.demux=function(x,re){this.cachedData&&(x=(0,q.appendUint8Array)(this.cachedData,x),this.cachedData=null);var J,ce=M.getID3Data(x,0),ve=ce?ce.length:0,Le=this._audioTrack,Ne=this._id3Track,ze=ce?M.getTimeStamp(ce):void 0,Be=x.length;for((this.basePTS===null||this.frameIndex===0&&(0,c.isFiniteNumber)(ze))&&(this.basePTS=ue(ze,re,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),ce&&ce.length>0&&Ne.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ce,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});ve<Be;){if(this.canParse(x,ve)){var rt=this.appendFrame(Le,x,ve);rt?(this.frameIndex++,this.lastPTS=rt.sample.pts,J=ve+=rt.length):ve=Be}else M.canParse(x,ve)?(ce=M.getID3Data(x,ve),Ne.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ce,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),J=ve+=ce.length):ve++;if(ve===Be&&J!==Be){var pt=(0,V.sliceUint8)(x,J);this.cachedData?this.cachedData=(0,q.appendUint8Array)(this.cachedData,pt):this.cachedData=pt}}return{audioTrack:Le,videoTrack:ie(),id3Track:Ne,textTrack:ie()}},ne.demuxSampleAes=function(x,re,J){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},ne.flush=function(x){var re=this.cachedData;return re&&(this.cachedData=null,this.demux(re,0)),{audioTrack:this._audioTrack,videoTrack:ie(),id3Track:this._id3Track,textTrack:ie()}},ne.destroy=function(){},Ee}(),ue=function(Ee,ne,x){return(0,c.isFiniteNumber)(Ee)?90*Ee:9e4*ne+(x||0)};const de=z;var te=Q(93);function se(Ee,ne){return Ee[ne]===255&&(246&Ee[ne+1])==240}function oe(Ee,ne){return 1&Ee[ne+1]?7:9}function Ae(Ee,ne){return(3&Ee[ne+3])<<11|Ee[ne+4]<<3|(224&Ee[ne+5])>>>5}function be(Ee,ne){return ne+1<Ee.length&&se(Ee,ne)}function Oe(Ee,ne){if(be(Ee,ne)){var x=oe(Ee,ne);if(ne+x>=Ee.length)return!1;var re=Ae(Ee,ne);if(re<=x)return!1;var J=ne+re;return J===Ee.length||be(Ee,J)}return!1}function P(Ee,ne,x,re,J){if(!Ee.samplerate){var ce=function(ve,Le,Ne,ze){var Be,rt,pt,ct,R=navigator.userAgent.toLowerCase(),I=ze,S=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Be=1+((192&Le[Ne+2])>>>6);var C=(60&Le[Ne+2])>>>2;if(!(C>S.length-1))return pt=(1&Le[Ne+2])<<2,pt|=(192&Le[Ne+3])>>>6,te.logger.log("manifest codec:"+ze+", ADTS type:"+Be+", samplingIndex:"+C),/firefox/i.test(R)?C>=6?(Be=5,ct=new Array(4),rt=C-3):(Be=2,ct=new Array(2),rt=C):R.indexOf("android")!==-1?(Be=2,ct=new Array(2),rt=C):(Be=5,ct=new Array(4),ze&&(ze.indexOf("mp4a.40.29")!==-1||ze.indexOf("mp4a.40.5")!==-1)||!ze&&C>=6?rt=C-3:((ze&&ze.indexOf("mp4a.40.2")!==-1&&(C>=6&&pt===1||/vivaldi/i.test(R))||!ze&&pt===1)&&(Be=2,ct=new Array(2)),rt=C)),ct[0]=Be<<3,ct[0]|=(14&C)>>1,ct[1]|=(1&C)<<7,ct[1]|=pt<<3,Be===5&&(ct[1]|=(14&rt)>>1,ct[2]=(1&rt)<<7,ct[2]|=8,ct[3]=0),{config:ct,samplerate:S[C],channelCount:pt,codec:"mp4a.40."+Be,manifestCodec:I};ve.trigger(Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+C})}(ne,x,re,J);if(!ce)return;Ee.config=ce.config,Ee.samplerate=ce.samplerate,Ee.channelCount=ce.channelCount,Ee.codec=ce.codec,Ee.manifestCodec=ce.manifestCodec,te.logger.log("parsed codec:"+Ee.codec+", rate:"+ce.samplerate+", channels:"+ce.channelCount)}}function k(Ee){return 9216e4/Ee}function W(Ee,ne,x,re,J){var ce,ve=re+J*k(Ee.samplerate),Le=function(R,I){var S=oe(R,I);if(I+S<=R.length){var C=Ae(R,I)-S;if(C>0)return{headerLength:S,frameLength:C}}}(ne,x);if(Le){var Ne=Le.frameLength,ze=Le.headerLength,Be=ze+Ne,rt=Math.max(0,x+Be-ne.length);rt?(ce=new Uint8Array(Be-ze)).set(ne.subarray(x+ze,ne.length),0):ce=ne.subarray(x+ze,x+Be);var pt={unit:ce,pts:ve};return rt||Ee.samples.push(pt),{sample:pt,length:Be,missing:rt}}var ct=ne.length-x;return(ce=new Uint8Array(ct)).set(ne.subarray(x,ne.length),0),{sample:{unit:ce,pts:ve},length:ct,missing:-1}}function K(Ee,ne){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,re){return x.__proto__=re,x},K(Ee,ne)}const Re=function(Ee){var ne,x;function re(ce,ve){var Le;return(Le=Ee.call(this)||this).observer=void 0,Le.config=void 0,Le.observer=ce,Le.config=ve,Le}x=Ee,(ne=re).prototype=Object.create(x.prototype),ne.prototype.constructor=ne,K(ne,x);var J=re.prototype;return J.resetInitSegment=function(ce,ve,Le,Ne){Ee.prototype.resetInitSegment.call(this,ce,ve,Le,Ne),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:ve,duration:Ne,inputTimeScale:9e4,dropped:0}},re.probe=function(ce){if(!ce)return!1;for(var ve=(M.getID3Data(ce,0)||[]).length,Le=ce.length;ve<Le;ve++)if(Oe(ce,ve))return te.logger.log("ADTS sync word found !"),!0;return!1},J.canParse=function(ce,ve){return function(Le,Ne){return function(ze,Be){return Be+5<ze.length}(Le,Ne)&&se(Le,Ne)&&Ae(Le,Ne)<=Le.length-Ne}(ce,ve)},J.appendFrame=function(ce,ve,Le){P(ce,this.observer,ve,Le,ce.manifestCodec);var Ne=W(ce,ve,Le,this.basePTS,this.frameIndex);if(Ne&&Ne.missing===0)return Ne},re}(de);var Ie=/\/emsg[-/]ID3/i;const we=function(){function Ee(x,re){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=re}var ne=Ee.prototype;return ne.resetTimeStamp=function(){},ne.resetInitSegment=function(x,re,J,ce){var ve=(0,q.parseInitSegment)(x),Le=this.videoTrack=ie("video",1),Ne=this.audioTrack=ie("audio",1),ze=this.txtTrack=ie("text",1);if(this.id3Track=ie("id3",1),this.timeOffset=0,ve.video){var Be=ve.video,rt=Be.id,pt=Be.timescale,ct=Be.codec;Le.id=rt,Le.timescale=ze.timescale=pt,Le.codec=ct}if(ve.audio){var R=ve.audio,I=R.id,S=R.timescale,C=R.codec;Ne.id=I,Ne.timescale=S,Ne.codec=C}ze.id=q.RemuxerTrackIdConfig.text,Le.sampleDuration=0,Le.duration=Ne.duration=ce},ne.resetContiguity=function(){},Ee.probe=function(x){return x=x.length>16384?x.subarray(0,16384):x,(0,q.findBox)(x,["moof"]).length>0},ne.demux=function(x,re){this.timeOffset=re;var J=x,ce=this.videoTrack,ve=this.txtTrack;if(this.config.progressive){this.remainderData&&(J=(0,q.appendUint8Array)(this.remainderData,x));var Le=(0,q.segmentValidRange)(J);this.remainderData=Le.remainder,ce.samples=Le.valid||new Uint8Array}else ce.samples=J;var Ne=this.extractID3Track(ce,re);return ve.samples=(0,q.parseSamples)(re,ce),{videoTrack:ce,audioTrack:this.audioTrack,id3Track:Ne,textTrack:this.txtTrack}},ne.flush=function(){var x=this.timeOffset,re=this.videoTrack,J=this.txtTrack;re.samples=this.remainderData||new Uint8Array,this.remainderData=null;var ce=this.extractID3Track(re,this.timeOffset);return J.samples=(0,q.parseSamples)(x,re),{videoTrack:re,audioTrack:ie(),id3Track:ce,textTrack:ie()}},ne.extractID3Track=function(x,re){var J=this.id3Track;if(x.samples.length){var ce=(0,q.findBox)(x.samples,["emsg"]);ce&&ce.forEach(function(ve){var Le=(0,q.parseEmsg)(ve);if(Ie.test(Le.schemeIdUri)){var Ne=(0,c.isFiniteNumber)(Le.presentationTime)?Le.presentationTime/Le.timeScale:re+Le.presentationTimeDelta/Le.timeScale,ze=Le.eventDuration===4294967295?Number.POSITIVE_INFINITY:Le.eventDuration/Le.timeScale;ze<=.001&&(ze=Number.POSITIVE_INFINITY);var Be=Le.payload;J.samples.push({data:Be,len:Be.byteLength,dts:Ne,pts:Ne,type:_.MetadataSchema.emsg,duration:ze})}})}return J},ne.demuxSampleAes=function(x,re,J){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},ne.destroy=function(){},Ee}();var B=null,le=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ee=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],he=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],G=[0,1,1,4];function xe(Ee,ne,x,re,J){if(!(x+24>ne.length)){var ce=Ge(ne,x);if(ce&&x+ce.frameLength<=ne.length){var ve=re+J*(9e4*ce.samplesPerFrame/ce.sampleRate),Le={unit:ne.subarray(x,x+ce.frameLength),pts:ve,dts:ve};return Ee.config=[],Ee.channelCount=ce.channelCount,Ee.samplerate=ce.sampleRate,Ee.samples.push(Le),{sample:Le,length:ce.frameLength,missing:0}}}}function Ge(Ee,ne){var x=Ee[ne+1]>>3&3,re=Ee[ne+1]>>1&3,J=Ee[ne+2]>>4&15,ce=Ee[ne+2]>>2&3;if(x!==1&&J!==0&&J!==15&&ce!==3){var ve=Ee[ne+2]>>1&1,Le=Ee[ne+3]>>6,Ne=1e3*le[14*(x===3?3-re:re===3?3:4)+J-1],ze=ee[3*(x===3?0:x===2?1:2)+ce],Be=Le===3?1:2,rt=he[x][re],pt=G[re],ct=8*rt*pt,R=Math.floor(rt*Ne/ze+ve)*pt;if(B===null){var I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);B=I?parseInt(I[1]):0}return!!B&&B<=87&&re===2&&Ne>=224e3&&Le===0&&(Ee[ne+3]=128|Ee[ne+3]),{sampleRate:ze,channelCount:Be,frameLength:R,samplesPerFrame:ct}}}function qe(Ee,ne){return Ee[ne]===255&&(224&Ee[ne+1])==224&&(6&Ee[ne+1])!=0}function it(Ee,ne){return ne+1<Ee.length&&qe(Ee,ne)}function ye(Ee,ne){if(ne+1<Ee.length&&qe(Ee,ne)){var x=Ge(Ee,ne),re=4;x!=null&&x.frameLength&&(re=x.frameLength);var J=ne+re;return J===Ee.length||it(Ee,J)}return!1}const Ze=function(){function Ee(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var ne=Ee.prototype;return ne.loadWord=function(){var x=this.data,re=this.bytesAvailable,J=x.byteLength-re,ce=new Uint8Array(4),ve=Math.min(4,re);if(ve===0)throw new Error("no bytes available");ce.set(x.subarray(J,J+ve)),this.word=new DataView(ce.buffer).getUint32(0),this.bitsAvailable=8*ve,this.bytesAvailable-=ve},ne.skipBits=function(x){var re;this.bitsAvailable>x?(this.word<<=x,this.bitsAvailable-=x):(x-=this.bitsAvailable,x-=(re=x>>3)>>3,this.bytesAvailable-=re,this.loadWord(),this.word<<=x,this.bitsAvailable-=x)},ne.readBits=function(x){var re=Math.min(this.bitsAvailable,x),J=this.word>>>32-re;return x>32&&te.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=re,this.bitsAvailable>0?this.word<<=re:this.bytesAvailable>0&&this.loadWord(),(re=x-re)>0&&this.bitsAvailable?J<<re|this.readBits(re):J},ne.skipLZ=function(){var x;for(x=0;x<this.bitsAvailable;++x)if((this.word&2147483648>>>x)!=0)return this.word<<=x,this.bitsAvailable-=x,x;return this.loadWord(),x+this.skipLZ()},ne.skipUEG=function(){this.skipBits(1+this.skipLZ())},ne.skipEG=function(){this.skipBits(1+this.skipLZ())},ne.readUEG=function(){var x=this.skipLZ();return this.readBits(x+1)-1},ne.readEG=function(){var x=this.readUEG();return 1&x?1+x>>>1:-1*(x>>>1)},ne.readBoolean=function(){return this.readBits(1)===1},ne.readUByte=function(){return this.readBits(8)},ne.readUShort=function(){return this.readBits(16)},ne.readUInt=function(){return this.readBits(32)},ne.skipScalingList=function(x){for(var re=8,J=8,ce=0;ce<x;ce++)J!==0&&(J=(re+this.readEG()+256)%256),re=J===0?re:J},ne.readSPS=function(){var x,re,J,ce=0,ve=0,Le=0,Ne=0,ze=this.readUByte.bind(this),Be=this.readBits.bind(this),rt=this.readUEG.bind(this),pt=this.readBoolean.bind(this),ct=this.skipBits.bind(this),R=this.skipEG.bind(this),I=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);ze();var C=ze();if(Be(5),ct(3),ze(),I(),C===100||C===110||C===122||C===244||C===44||C===83||C===86||C===118||C===128){var O=rt();if(O===3&&ct(1),I(),I(),ct(1),pt())for(re=O!==3?8:12,J=0;J<re;J++)pt()&&S(J<6?16:64)}I();var Y=rt();if(Y===0)rt();else if(Y===1)for(ct(1),R(),R(),x=rt(),J=0;J<x;J++)R();I(),ct(1);var j=rt(),Z=rt(),De=Be(1);De===0&&ct(1),ct(1),pt()&&(ce=rt(),ve=rt(),Le=rt(),Ne=rt());var pe=[1,1];if(pt()&&pt())switch(ze()){case 1:pe=[1,1];break;case 2:pe=[12,11];break;case 3:pe=[10,11];break;case 4:pe=[16,11];break;case 5:pe=[40,33];break;case 6:pe=[24,11];break;case 7:pe=[20,11];break;case 8:pe=[32,11];break;case 9:pe=[80,33];break;case 10:pe=[18,11];break;case 11:pe=[15,11];break;case 12:pe=[64,33];break;case 13:pe=[160,99];break;case 14:pe=[4,3];break;case 15:pe=[3,2];break;case 16:pe=[2,1];break;case 255:pe=[ze()<<8|ze(),ze()<<8|ze()]}return{width:Math.ceil(16*(j+1)-2*ce-2*ve),height:(2-De)*(Z+1)*16-(De?2:4)*(Le+Ne),pixelRatio:pe}},ne.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},Ee}(),st=function(){function Ee(x,re,J){this.keyData=void 0,this.decrypter=void 0,this.keyData=J,this.decrypter=new U.default(x,re,{removePKCS7Padding:!1})}var ne=Ee.prototype;return ne.decryptBuffer=function(x,re){this.decrypter.decrypt(x,this.keyData.key.buffer,this.keyData.iv.buffer,re)},ne.decryptAacSample=function(x,re,J,ce){var ve=x[re].unit;if(!(ve.length<=16)){var Le=ve.subarray(16,ve.length-ve.length%16),Ne=Le.buffer.slice(Le.byteOffset,Le.byteOffset+Le.length),ze=this;this.decryptBuffer(Ne,function(Be){var rt=new Uint8Array(Be);ve.set(rt,16),ce||ze.decryptAacSamples(x,re+1,J)})}},ne.decryptAacSamples=function(x,re,J){for(;;re++){if(re>=x.length)return void J();if(!(x[re].unit.length<32)){var ce=this.decrypter.isSync();if(this.decryptAacSample(x,re,J,ce),!ce)return}}},ne.getAvcEncryptedData=function(x){for(var re=16*Math.floor((x.length-48)/160)+16,J=new Int8Array(re),ce=0,ve=32;ve<x.length-16;ve+=160,ce+=16)J.set(x.subarray(ve,ve+16),ce);return J},ne.getAvcDecryptedUnit=function(x,re){for(var J=new Uint8Array(re),ce=0,ve=32;ve<x.length-16;ve+=160,ce+=16)x.set(J.subarray(ce,ce+16),ve);return x},ne.decryptAvcSample=function(x,re,J,ce,ve,Le){var Ne=(0,q.discardEPB)(ve.data),ze=this.getAvcEncryptedData(Ne),Be=this;this.decryptBuffer(ze.buffer,function(rt){ve.data=Be.getAvcDecryptedUnit(Ne,rt),Le||Be.decryptAvcSamples(x,re,J+1,ce)})},ne.decryptAvcSamples=function(x,re,J,ce){if(x instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;re++,J=0){if(re>=x.length)return void ce();for(var ve=x[re].units;!(J>=ve.length);J++){var Le=ve[J];if(!(Le.data.length<=48||Le.type!==1&&Le.type!==5)){var Ne=this.decrypter.isSync();if(this.decryptAvcSample(x,re,J,ce,Le,Ne),!Ne)return}}}},Ee}();function Et(){return Et=Object.assign?Object.assign.bind():function(Ee){for(var ne=1;ne<arguments.length;ne++){var x=arguments[ne];for(var re in x)Object.prototype.hasOwnProperty.call(x,re)&&(Ee[re]=x[re])}return Ee},Et.apply(this,arguments)}var lt=188;function vt(Ee,ne,x,re){return{key:Ee,frame:!1,pts:ne,dts:x,units:[],debug:re,length:0}}function St(Ee,ne){return(31&Ee[ne+10])<<8|Ee[ne+11]}function gt(Ee,ne,x,re){var J={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},ce=ne+3+((15&Ee[ne+1])<<8|Ee[ne+2])-4;for(ne+=12+((15&Ee[ne+10])<<8|Ee[ne+11]);ne<ce;){var ve=(31&Ee[ne+1])<<8|Ee[ne+2];switch(Ee[ne]){case 207:if(!re){te.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:J.audio===-1&&(J.audio=ve);break;case 21:J.id3===-1&&(J.id3=ve);break;case 219:if(!re){te.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:J.avc===-1&&(J.avc=ve);break;case 3:case 4:x.mpeg!==!0&&x.mp3!==!0?te.logger.log("MPEG audio found, not supported in this browser"):J.audio===-1&&(J.audio=ve,J.segmentCodec="mp3");break;case 36:te.logger.warn("Unsupported HEVC stream type found")}ne+=5+((15&Ee[ne+3])<<8|Ee[ne+4])}return J}function At(Ee){var ne,x,re,J,ce,ve=0,Le=Ee.data;if(!Ee||Ee.size===0)return null;for(;Le[0].length<19&&Le.length>1;){var Ne=new Uint8Array(Le[0].length+Le[1].length);Ne.set(Le[0]),Ne.set(Le[1],Le[0].length),Le[0]=Ne,Le.splice(1,1)}if(((ne=Le[0])[0]<<16)+(ne[1]<<8)+ne[2]===1){if((x=(ne[4]<<8)+ne[5])&&x>Ee.size-6)return null;var ze=ne[7];192&ze&&(J=536870912*(14&ne[9])+4194304*(255&ne[10])+16384*(254&ne[11])+128*(255&ne[12])+(254&ne[13])/2,64&ze?J-(ce=536870912*(14&ne[14])+4194304*(255&ne[15])+16384*(254&ne[16])+128*(255&ne[17])+(254&ne[18])/2)>54e5&&(te.logger.warn(Math.round((J-ce)/9e4)+"s delta between PTS and DTS, align them"),J=ce):ce=J);var Be=(re=ne[8])+9;if(Ee.size<=Be)return null;Ee.size-=Be;for(var rt=new Uint8Array(Ee.size),pt=0,ct=Le.length;pt<ct;pt++){var R=(ne=Le[pt]).byteLength;if(Be){if(Be>R){Be-=R;continue}ne=ne.subarray(Be),R-=Be,Be=0}rt.set(ne,ve),ve+=R}return x&&(x-=re+3),{data:rt,pts:J,dts:ce,len:x}}return null}function Lt(Ee,ne){if(Ee.units.length&&Ee.frame){if(Ee.pts===void 0){var x=ne.samples,re=x.length;if(!re)return void ne.dropped++;var J=x[re-1];Ee.pts=J.pts,Ee.dts=J.dts}ne.samples.push(Ee)}Ee.debug.length&&te.logger.log(Ee.pts+"/"+Ee.dts+":"+Ee.debug)}const yt=function(){function Ee(x,re,J){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=x,this.config=re,this.typeSupported=J}Ee.probe=function(x){var re=Ee.syncOffset(x);return re>0&&te.logger.warn("MPEG2-TS detected but first sync word found @ offset "+re),re!==-1},Ee.syncOffset=function(x){for(var re=Math.min(940,x.length-376)+1,J=0;J<re;){if(x[J]===71&&x[J+lt]===71)return J;J++}return-1},Ee.createTrack=function(x,re){return{container:x==="video"||x==="audio"?"video/mp2t":void 0,type:x,id:q.RemuxerTrackIdConfig[x],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:x==="audio"?re:void 0}};var ne=Ee.prototype;return ne.resetInitSegment=function(x,re,J,ce){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Ee.createTrack("video"),this._audioTrack=Ee.createTrack("audio",ce),this._id3Track=Ee.createTrack("id3"),this._txtTrack=Ee.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=re,this.videoCodec=J,this._duration=ce},ne.resetTimeStamp=function(){},ne.resetContiguity=function(){var x=this._audioTrack,re=this._avcTrack,J=this._id3Track;x&&(x.pesData=null),re&&(re.pesData=null),J&&(J.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},ne.demux=function(x,re,J,ce){var ve;J===void 0&&(J=!1),ce===void 0&&(ce=!1),J||(this.sampleAes=null);var Le=this._avcTrack,Ne=this._audioTrack,ze=this._id3Track,Be=this._txtTrack,rt=Le.pid,pt=Le.pesData,ct=Ne.pid,R=ze.pid,I=Ne.pesData,S=ze.pesData,C=null,O=this.pmtParsed,Y=this._pmtId,j=x.length;if(this.remainderData&&(j=(x=(0,q.appendUint8Array)(this.remainderData,x)).length,this.remainderData=null),j<lt&&!ce)return this.remainderData=x,{audioTrack:Ne,videoTrack:Le,id3Track:ze,textTrack:Be};var Z=Math.max(0,Ee.syncOffset(x));(j-=(j-Z)%lt)<x.byteLength&&!ce&&(this.remainderData=new Uint8Array(x.buffer,j,x.buffer.byteLength-j));for(var De=0,pe=Z;pe<j;pe+=lt)if(x[pe]===71){var ke=!!(64&x[pe+1]),Fe=((31&x[pe+1])<<8)+x[pe+2],Qe=void 0;if((48&x[pe+3])>>4>1){if((Qe=pe+5+x[pe+4])===pe+lt)continue}else Qe=pe+4;switch(Fe){case rt:ke&&(pt&&(ve=At(pt))&&this.parseAVCPES(Le,Be,ve,!1),pt={data:[],size:0}),pt&&(pt.data.push(x.subarray(Qe,pe+lt)),pt.size+=pe+lt-Qe);break;case ct:if(ke){if(I&&(ve=At(I)))switch(Ne.segmentCodec){case"aac":this.parseAACPES(Ne,ve);break;case"mp3":this.parseMPEGPES(Ne,ve)}I={data:[],size:0}}I&&(I.data.push(x.subarray(Qe,pe+lt)),I.size+=pe+lt-Qe);break;case R:ke&&(S&&(ve=At(S))&&this.parseID3PES(ze,ve),S={data:[],size:0}),S&&(S.data.push(x.subarray(Qe,pe+lt)),S.size+=pe+lt-Qe);break;case 0:ke&&(Qe+=x[Qe]+1),Y=this._pmtId=St(x,Qe);break;case Y:ke&&(Qe+=x[Qe]+1);var $e=gt(x,Qe,this.typeSupported,J);(rt=$e.avc)>0&&(Le.pid=rt),(ct=$e.audio)>0&&(Ne.pid=ct,Ne.segmentCodec=$e.segmentCodec),(R=$e.id3)>0&&(ze.pid=R),C===null||O||(te.logger.log("unknown PID '"+C+"' in TS found"),C=null,pe=Z-188),O=this.pmtParsed=!0;break;case 17:case 8191:break;default:C=Fe}}else De++;De>0&&this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+De+" TS packet/s that do not start with 0x47"}),Le.pesData=pt,Ne.pesData=I,ze.pesData=S;var Ye={audioTrack:Ne,videoTrack:Le,id3Track:ze,textTrack:Be};return ce&&this.extractRemainingSamples(Ye),Ye},ne.flush=function(){var x,re=this.remainderData;return this.remainderData=null,x=re?this.demux(re,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(x),this.sampleAes?this.decrypt(x,this.sampleAes):x},ne.extractRemainingSamples=function(x){var re,J=x.audioTrack,ce=x.videoTrack,ve=x.id3Track,Le=x.textTrack,Ne=ce.pesData,ze=J.pesData,Be=ve.pesData;if(Ne&&(re=At(Ne))?(this.parseAVCPES(ce,Le,re,!0),ce.pesData=null):ce.pesData=Ne,ze&&(re=At(ze))){switch(J.segmentCodec){case"aac":this.parseAACPES(J,re);break;case"mp3":this.parseMPEGPES(J,re)}J.pesData=null}else ze!=null&&ze.size&&te.logger.log("last AAC PES packet truncated,might overlap between fragments"),J.pesData=ze;Be&&(re=At(Be))?(this.parseID3PES(ve,re),ve.pesData=null):ve.pesData=Be},ne.demuxSampleAes=function(x,re,J){var ce=this.demux(x,J,!0,!this.config.progressive),ve=this.sampleAes=new st(this.observer,this.config,re);return this.decrypt(ce,ve)},ne.decrypt=function(x,re){return new Promise(function(J){var ce=x.audioTrack,ve=x.videoTrack;ce.samples&&ce.segmentCodec==="aac"?re.decryptAacSamples(ce.samples,0,function(){ve.samples?re.decryptAvcSamples(ve.samples,0,0,function(){J(x)}):J(x)}):ve.samples&&re.decryptAvcSamples(ve.samples,0,0,function(){J(x)})})},ne.destroy=function(){this._duration=0},ne.parseAVCPES=function(x,re,J,ce){var ve,Le=this,Ne=this.parseAVCNALu(x,J.data),ze=this.avcSample,Be=!1;J.data=null,ze&&Ne.length&&!x.audFound&&(Lt(ze,x),ze=this.avcSample=vt(!1,J.pts,J.dts,"")),Ne.forEach(function(rt){switch(rt.type){case 1:ve=!0,ze||(ze=Le.avcSample=vt(!0,J.pts,J.dts,"")),ze.frame=!0;var pt=rt.data;if(Be&&pt.length>4){var ct=new Ze(pt).readSliceType();ct!==2&&ct!==4&&ct!==7&&ct!==9||(ze.key=!0)}break;case 5:ve=!0,ze||(ze=Le.avcSample=vt(!0,J.pts,J.dts,"")),ze.key=!0,ze.frame=!0;break;case 6:ve=!0,(0,q.parseSEIMessageFromNALu)(rt.data,1,J.pts,re.samples);break;case 7:if(ve=!0,Be=!0,!x.sps){var R=new Ze(rt.data).readSPS();x.width=R.width,x.height=R.height,x.pixelRatio=R.pixelRatio,x.sps=[rt.data],x.duration=Le._duration;for(var I=rt.data.subarray(1,4),S="avc1.",C=0;C<3;C++){var O=I[C].toString(16);O.length<2&&(O="0"+O),S+=O}x.codec=S}break;case 8:ve=!0,x.pps||(x.pps=[rt.data]);break;case 9:ve=!1,x.audFound=!0,ze&&Lt(ze,x),ze=Le.avcSample=vt(!1,J.pts,J.dts,"");break;case 12:ve=!0;break;default:ve=!1,ze&&(ze.debug+="unknown NAL "+rt.type+" ")}ze&&ve&&ze.units.push(rt)}),ce&&ze&&(Lt(ze,x),this.avcSample=null)},ne.getLastNalUnit=function(x){var re,J,ce=this.avcSample;if(ce&&ce.units.length!==0||(ce=x[x.length-1]),(re=ce)!==null&&re!==void 0&&re.units){var ve=ce.units;J=ve[ve.length-1]}return J},ne.parseAVCNALu=function(x,re){var J,ce,ve=re.byteLength,Le=x.naluState||0,Ne=Le,ze=[],Be=0,rt=-1,pt=0;for(Le===-1&&(rt=0,pt=31&re[0],Le=0,Be=1);Be<ve;)if(J=re[Be++],Le)if(Le!==1)if(J)if(J===1){if(rt>=0){var ct={data:re.subarray(rt,Be-Le-1),type:pt};ze.push(ct)}else{var R=this.getLastNalUnit(x.samples);if(R&&(Ne&&Be<=4-Ne&&R.state&&(R.data=R.data.subarray(0,R.data.byteLength-Ne)),(ce=Be-Le-1)>0)){var I=new Uint8Array(R.data.byteLength+ce);I.set(R.data,0),I.set(re.subarray(0,ce),R.data.byteLength),R.data=I,R.state=0}}Be<ve?(rt=Be,pt=31&re[Be],Le=0):Le=-1}else Le=0;else Le=3;else Le=J?0:2;else Le=J?0:1;if(rt>=0&&Le>=0){var S={data:re.subarray(rt,ve),type:pt,state:Le};ze.push(S)}if(ze.length===0){var C=this.getLastNalUnit(x.samples);if(C){var O=new Uint8Array(C.data.byteLength+re.byteLength);O.set(C.data,0),O.set(re,C.data.byteLength),C.data=O}}return x.naluState=Le,ze},ne.parseAACPES=function(x,re){var J,ce,ve,Le,Ne,ze=0,Be=this.aacOverFlow,rt=re.data;if(Be){this.aacOverFlow=null;var pt=Be.missing,ct=Be.sample.unit.byteLength;if(pt===-1){var R=new Uint8Array(ct+rt.byteLength);R.set(Be.sample.unit,0),R.set(rt,ct),rt=R}else{var I=ct-pt;Be.sample.unit.set(rt.subarray(0,pt),I),x.samples.push(Be.sample),ze=Be.missing}}for(J=ze,ce=rt.length;J<ce-1&&!be(rt,J);J++);if(J===ze||(J<ce-1?(ve="AAC PES did not start with ADTS header,offset:"+J,Le=!1):(ve="no ADTS header found in AAC PES",Le=!0),te.logger.warn("parsing error:"+ve),this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:Le,reason:ve}),!Le)){if(P(x,this.observer,rt,J,this.audioCodec),re.pts!==void 0)Ne=re.pts;else{if(!Be)return void te.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var S=k(x.samplerate);Ne=Be.sample.pts+S}for(var C,O=0;J<ce;){if(J+=(C=W(x,rt,J,Ne,O)).length,C.missing){this.aacOverFlow=C;break}for(O++;J<ce-1&&!be(rt,J);J++);}}},ne.parseMPEGPES=function(x,re){var J=re.data,ce=J.length,ve=0,Le=0,Ne=re.pts;if(Ne!==void 0)for(;Le<ce;)if(it(J,Le)){var ze=xe(x,J,Le,Ne,ve);if(!ze)break;Le+=ze.length,ve++}else Le++;else te.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},ne.parseID3PES=function(x,re){if(re.pts!==void 0){var J=Et({},re,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});x.samples.push(J)}else te.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},Ee}();function Ot(Ee,ne){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,re){return x.__proto__=re,x},Ot(Ee,ne)}const _t=function(Ee){var ne,x;function re(){return Ee.apply(this,arguments)||this}x=Ee,(ne=re).prototype=Object.create(x.prototype),ne.prototype.constructor=ne,Ot(ne,x);var J=re.prototype;return J.resetInitSegment=function(ce,ve,Le,Ne){Ee.prototype.resetInitSegment.call(this,ce,ve,Le,Ne),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:ve,duration:Ne,inputTimeScale:9e4,dropped:0}},re.probe=function(ce){if(!ce)return!1;for(var ve=(M.getID3Data(ce,0)||[]).length,Le=ce.length;ve<Le;ve++)if(ye(ce,ve))return te.logger.log("MPEG Audio sync word found !"),!0;return!1},J.canParse=function(ce,ve){return function(Le,Ne){return qe(Le,Ne)&&4<=Le.length-Ne}(ce,ve)},J.appendFrame=function(ce,ve,Le){if(this.basePTS!==null)return xe(ce,ve,Le,this.basePTS,this.frameIndex)},re}(de);var Jt=Q(524),Gt=Q(923);function wt(Ee,ne){var x=Ee==null?void 0:Ee.codec;return x&&x.length>4?x:x==="hvc1"||x==="hev1"?"hvc1.1.c.L120.90":x==="av01"?"av01.0.04M.08":x==="avc1"||ne===Gt.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const tr=function(){function Ee(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var ne=Ee.prototype;return ne.destroy=function(){},ne.resetTimeStamp=function(x){this.initPTS=x,this.lastEndTime=null},ne.resetNextTimestamp=function(){this.lastEndTime=null},ne.resetInitSegment=function(x,re,J){this.audioCodec=re,this.videoCodec=J,this.generateInitSegment(x),this.emitInitSegment=!0},ne.generateInitSegment=function(x){var re=this.audioCodec,J=this.videoCodec;if(!x||!x.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var ce=this.initData=(0,q.parseInitSegment)(x);re||(re=wt(ce.audio,Gt.ElementaryStreamTypes.AUDIO)),J||(J=wt(ce.video,Gt.ElementaryStreamTypes.VIDEO));var ve={};ce.audio&&ce.video?ve.audiovideo={container:"video/mp4",codec:re+","+J,initSegment:x,id:"main"}:ce.audio?ve.audio={container:"audio/mp4",codec:re,initSegment:x,id:"audio"}:ce.video?ve.video={container:"video/mp4",codec:J,initSegment:x,id:"main"}:te.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=ve},ne.remux=function(x,re,J,ce,ve){var Le,Ne=this.initPTS,ze=this.lastEndTime,Be={audio:void 0,video:void 0,text:ce,id3:J,initSegment:void 0};(0,c.isFiniteNumber)(ze)||(ze=this.lastEndTime=ve||0);var rt=re.samples;if(!rt||!rt.length)return Be;var pt={initPTS:void 0,timescale:1},ct=this.initData;if(ct&&ct.length||(this.generateInitSegment(rt),ct=this.initData),!ct||!ct.length)return te.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),Be;this.emitInitSegment&&(pt.tracks=this.initTracks,this.emitInitSegment=!1);var R=(0,q.getStartDTS)(ct,rt);(0,c.isFiniteNumber)(Ne)||(this.initPTS=pt.initPTS=Ne=R-ve);var I=(0,q.getDuration)(rt,ct),S=x?R-Ne:ze,C=S+I;(0,q.offsetStartDTS)(ct,rt,Ne),I>0?this.lastEndTime=C:(te.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var O=!!ct.audio,Y=!!ct.video,j="";O&&(j+="audio"),Y&&(j+="video");var Z={data1:rt,startPTS:S,startDTS:S,endPTS:C,endDTS:C,type:j,hasAudio:O,hasVideo:Y,nb:1,dropped:0};Be.audio=Z.type==="audio"?Z:void 0,Be.video=Z.type!=="audio"?Z:void 0,Be.initSegment=pt;var De=(Le=this.initPTS)!=null?Le:0;return Be.id3=(0,Jt.flushTextTrackMetadataCueSamples)(J,ve,De,De),ce.samples.length&&(Be.text=(0,Jt.flushTextTrackUserdataCueSamples)(ce,ve,De)),Be},Ee}();var Zt;try{Zt=self.performance.now.bind(self.performance)}catch(Ee){te.logger.debug("Unable to use Performance API on this environment"),Zt=self.Date.now}var rr=[{demux:yt,remux:Jt.default},{demux:we,remux:tr},{demux:Re,remux:Jt.default},{demux:_t,remux:Jt.default}],lr=function(){function Ee(x,re,J,ce,ve){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=x,this.typeSupported=re,this.config=J,this.vendor=ce,this.id=ve}var ne=Ee.prototype;return ne.configure=function(x){this.transmuxConfig=x,this.decrypter&&this.decrypter.reset()},ne.push=function(x,re,J,ce){var ve=this,Le=J.transmuxing;Le.executeStart=Zt();var Ne=new Uint8Array(x),ze=this.config,Be=this.currentTransmuxState,rt=this.transmuxConfig;ce&&(this.currentTransmuxState=ce);var pt=ce||Be,ct=pt.contiguous,R=pt.discontinuity,I=pt.trackSwitch,S=pt.accurateTimeOffset,C=pt.timeOffset,O=pt.initSegmentChange,Y=rt.audioCodec,j=rt.videoCodec,Z=rt.defaultInitPts,De=rt.duration,pe=rt.initSegmentData;(R||I||O)&&this.resetInitSegment(pe,Y,j,De),(R||O)&&this.resetInitialTimestamp(Z),ct||this.resetContiguity();var ke=function(ot,Tt){var dt=null;return ot.byteLength>0&&Tt!=null&&Tt.key!=null&&Tt.iv!==null&&Tt.method!=null&&(dt=Tt),dt}(Ne,re);if(ke&&ke.method==="AES-128"){var Fe=this.getDecrypter();if(!ze.enableSoftwareAES)return this.decryptionPromise=Fe.webCryptoDecrypt(Ne,ke.key.buffer,ke.iv.buffer).then(function(ot){var Tt=ve.push(ot,null,J);return ve.decryptionPromise=null,Tt}),this.decryptionPromise;var Qe=Fe.softwareDecrypt(Ne,ke.key.buffer,ke.iv.buffer);if(!Qe)return Le.executeEnd=Zt(),ur(J);Ne=new Uint8Array(Qe)}this.needsProbing(Ne,R,I)&&this.configureTransmuxer(Ne,rt);var $e=this.transmux(Ne,ke,C,S,J),Ye=this.currentTransmuxState;return Ye.contiguous=!0,Ye.discontinuity=!1,Ye.trackSwitch=!1,Le.executeEnd=Zt(),$e},ne.flush=function(x){var re=this,J=x.transmuxing;J.executeStart=Zt();var ce=this.decrypter,ve=this.currentTransmuxState,Le=this.decryptionPromise;if(Le)return Le.then(function(){return re.flush(x)});var Ne=[],ze=ve.timeOffset;if(ce){var Be=ce.flush();Be&&Ne.push(this.push(Be,null,x))}var rt=this.demuxer,pt=this.remuxer;if(!rt||!pt)return this.observer.emit(Te.Events.ERROR,Te.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),J.executeEnd=Zt(),[ur(x)];var ct=rt.flush(ze);return hr(ct)?ct.then(function(R){return re.flushRemux(Ne,R,x),Ne}):(this.flushRemux(Ne,ct,x),Ne)},ne.flushRemux=function(x,re,J){var ce=re.audioTrack,ve=re.videoTrack,Le=re.id3Track,Ne=re.textTrack,ze=this.currentTransmuxState,Be=ze.accurateTimeOffset,rt=ze.timeOffset;te.logger.log("[transmuxer.ts]: Flushed fragment "+J.sn+(J.part>-1?" p: "+J.part:"")+" of level "+J.level);var pt=this.remuxer.remux(ce,ve,Le,Ne,rt,Be,!0,this.id);x.push({remuxResult:pt,chunkMeta:J}),J.transmuxing.executeEnd=Zt()},ne.resetInitialTimestamp=function(x){var re=this.demuxer,J=this.remuxer;re&&J&&(re.resetTimeStamp(x),J.resetTimeStamp(x))},ne.resetContiguity=function(){var x=this.demuxer,re=this.remuxer;x&&re&&(x.resetContiguity(),re.resetNextTimestamp())},ne.resetInitSegment=function(x,re,J,ce){var ve=this.demuxer,Le=this.remuxer;ve&&Le&&(ve.resetInitSegment(x,re,J,ce),Le.resetInitSegment(x,re,J))},ne.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},ne.transmux=function(x,re,J,ce,ve){return re&&re.method==="SAMPLE-AES"?this.transmuxSampleAes(x,re,J,ce,ve):this.transmuxUnencrypted(x,J,ce,ve)},ne.transmuxUnencrypted=function(x,re,J,ce){var ve=this.demuxer.demux(x,re,!1,!this.config.progressive),Le=ve.audioTrack,Ne=ve.videoTrack,ze=ve.id3Track,Be=ve.textTrack;return{remuxResult:this.remuxer.remux(Le,Ne,ze,Be,re,J,!1,this.id),chunkMeta:ce}},ne.transmuxSampleAes=function(x,re,J,ce,ve){var Le=this;return this.demuxer.demuxSampleAes(x,re,J).then(function(Ne){return{remuxResult:Le.remuxer.remux(Ne.audioTrack,Ne.videoTrack,Ne.id3Track,Ne.textTrack,J,ce,!1,Le.id),chunkMeta:ve}})},ne.configureTransmuxer=function(x,re){for(var J,ce=this.config,ve=this.observer,Le=this.typeSupported,Ne=this.vendor,ze=re.audioCodec,Be=re.defaultInitPts,rt=re.duration,pt=re.initSegmentData,ct=re.videoCodec,R=0,I=rr.length;R<I;R++)if(rr[R].demux.probe(x)){J=rr[R];break}J||(te.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),J={demux:we,remux:tr});var S=this.demuxer,C=this.remuxer,O=J.remux,Y=J.demux;C&&C instanceof O||(this.remuxer=new O(ve,ce,Le,Ne)),S&&S instanceof Y||(this.demuxer=new Y(ve,ce,Le),this.probe=Y.probe),this.resetInitSegment(pt,ze,ct,rt),this.resetInitialTimestamp(Be)},ne.needsProbing=function(x,re,J){return!this.demuxer||!this.remuxer||re||J},ne.getDecrypter=function(){var x=this.decrypter;return x||(x=this.decrypter=new U.default(this.observer,this.config)),x},Ee}(),ur=function(Ee){return{remuxResult:{},chunkMeta:Ee}};function hr(Ee){return"then"in Ee&&Ee.then instanceof Function}var Xt=function(Ee,ne,x,re,J){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=Ee,this.videoCodec=ne,this.initSegmentData=x,this.duration=re,this.defaultInitPts=J},sr=function(Ee,ne,x,re,J,ce){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=Ee,this.contiguous=ne,this.accurateTimeOffset=x,this.trackSwitch=re,this.timeOffset=J,this.initSegmentChange=ce}},973:(ht,Pe,Q)=>{"use strict";var Te,$;Q.r(Pe),Q.d(Pe,{ErrorDetails:()=>$,ErrorTypes:()=>Te}),function(U){U.NETWORK_ERROR="networkError",U.MEDIA_ERROR="mediaError",U.KEY_SYSTEM_ERROR="keySystemError",U.MUX_ERROR="muxError",U.OTHER_ERROR="otherError"}(Te||(Te={})),function(U){U.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",U.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",U.KEY_SYSTEM_NO_SESSION="keySystemNoSession",U.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",U.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",U.MANIFEST_LOAD_ERROR="manifestLoadError",U.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",U.MANIFEST_PARSING_ERROR="manifestParsingError",U.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",U.LEVEL_EMPTY_ERROR="levelEmptyError",U.LEVEL_LOAD_ERROR="levelLoadError",U.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",U.LEVEL_SWITCH_ERROR="levelSwitchError",U.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",U.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",U.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",U.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",U.FRAG_LOAD_ERROR="fragLoadError",U.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",U.FRAG_DECRYPT_ERROR="fragDecryptError",U.FRAG_PARSING_ERROR="fragParsingError",U.REMUX_ALLOC_ERROR="remuxAllocError",U.KEY_LOAD_ERROR="keyLoadError",U.KEY_LOAD_TIMEOUT="keyLoadTimeOut",U.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",U.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",U.BUFFER_APPEND_ERROR="bufferAppendError",U.BUFFER_APPENDING_ERROR="bufferAppendingError",U.BUFFER_STALLED_ERROR="bufferStalledError",U.BUFFER_FULL_ERROR="bufferFullError",U.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",U.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",U.INTERNAL_EXCEPTION="internalException",U.INTERNAL_ABORTED="aborted",U.UNKNOWN="unknown"}($||($={}))},851:(ht,Pe,Q)=>{"use strict";var Te;Q.r(Pe),Q.d(Pe,{Events:()=>Te}),function($){$.MEDIA_ATTACHING="hlsMediaAttaching",$.MEDIA_ATTACHED="hlsMediaAttached",$.MEDIA_DETACHING="hlsMediaDetaching",$.MEDIA_DETACHED="hlsMediaDetached",$.BUFFER_RESET="hlsBufferReset",$.BUFFER_CODECS="hlsBufferCodecs",$.BUFFER_CREATED="hlsBufferCreated",$.BUFFER_APPENDING="hlsBufferAppending",$.BUFFER_APPENDED="hlsBufferAppended",$.BUFFER_EOS="hlsBufferEos",$.BUFFER_FLUSHING="hlsBufferFlushing",$.BUFFER_FLUSHED="hlsBufferFlushed",$.MANIFEST_LOADING="hlsManifestLoading",$.MANIFEST_LOADED="hlsManifestLoaded",$.MANIFEST_PARSED="hlsManifestParsed",$.LEVEL_SWITCHING="hlsLevelSwitching",$.LEVEL_SWITCHED="hlsLevelSwitched",$.LEVEL_LOADING="hlsLevelLoading",$.LEVEL_LOADED="hlsLevelLoaded",$.LEVEL_UPDATED="hlsLevelUpdated",$.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",$.LEVELS_UPDATED="hlsLevelsUpdated",$.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",$.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",$.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",$.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",$.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",$.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",$.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",$.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",$.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",$.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",$.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",$.CUES_PARSED="hlsCuesParsed",$.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",$.INIT_PTS_FOUND="hlsInitPtsFound",$.FRAG_LOADING="hlsFragLoading",$.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",$.FRAG_LOADED="hlsFragLoaded",$.FRAG_DECRYPTED="hlsFragDecrypted",$.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",$.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",$.FRAG_PARSING_METADATA="hlsFragParsingMetadata",$.FRAG_PARSED="hlsFragParsed",$.FRAG_BUFFERED="hlsFragBuffered",$.FRAG_CHANGED="hlsFragChanged",$.FPS_DROP="hlsFpsDrop",$.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",$.ERROR="hlsError",$.DESTROYING="hlsDestroying",$.KEY_LOADING="hlsKeyLoading",$.KEY_LOADED="hlsKeyLoaded",$.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",$.BACK_BUFFER_REACHED="hlsBackBufferReached"}(Te||(Te={}))},817:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>bn});var Te,$=Q(945),U=Q(965),c=Q(851),M=Q(973),_=Q(93),ie=Q(63),q=/^(\d+)x(\d+)$/,V=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,z=function(){function v(e){for(var t in typeof e=="string"&&(e=v.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var d=v.prototype;return d.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},d.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},d.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},d.decimalFloatingPoint=function(e){return parseFloat(this[e])},d.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},d.enumeratedString=function(e){return this[e]},d.bool=function(e){return this[e]==="YES"},d.decimalResolution=function(e){var t=q.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},v.parseAttrList=function(e){var t,i={};for(V.lastIndex=0;(t=V.exec(e))!==null;){var n=t[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},v}();function ue(){return ue=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},ue.apply(this,arguments)}function de(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}(function(v){v.ID="ID",v.CLASS="CLASS",v.START_DATE="START-DATE",v.DURATION="DURATION",v.END_DATE="END-DATE",v.END_ON_NEXT="END-ON-NEXT",v.PLANNED_DURATION="PLANNED-DURATION",v.SCTE35_OUT="SCTE35-OUT",v.SCTE35_IN="SCTE35-IN"})(Te||(Te={}));var te=function(){function v(t,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var s in n)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==n[s]){_.logger.warn('DATERANGE tag attribute: "'+s+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=s;break}t=ue(new z({}),n,t)}if(this.attr=t,this._startDate=new Date(t[Te.START_DATE]),Te.END_DATE in this.attr){var r=new Date(this.attr[Te.END_DATE]);(0,U.isFiniteNumber)(r.getTime())&&(this._endDate=r)}}var d,e;return d=v,(e=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return t!==null?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(Te.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(Te.DURATION);if((0,U.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return Te.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(Te.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(Te.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,U.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&de(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}(),se=Q(923);function oe(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}var Ae=function(){function v(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}var d,e;return v.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},d=v,(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,U.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!==null&&t!==void 0&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&oe(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}(),be=Q(960),Oe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function P(v,d){return MediaSource.isTypeSupported((d||"video")+'/mp4;codecs="'+v+'"')}var k=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,W=/#EXT-X-MEDIA:(.*)/g,K=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Re=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ie=/\.(mp4|m4s|m4v|m4a)$/i,we=function(){function v(){}return v.findGroup=function(d,e){for(var t=0;t<d.length;t++){var i=d[t];if(i.id===e)return i}},v.convertAVC1ToAVCOTI=function(d){var e=d.split(".");if(e.length>2){var t=e.shift()+".";return(t+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return d},v.resolve=function(d,e){return $.buildAbsoluteURL(e,d,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(d,e){var t,i=[],n=[],s={},r=!1;for(k.lastIndex=0;(t=k.exec(d))!=null;)if(t[1]){var a,l=new z(t[1]),f={attrs:l,bitrate:l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),name:l.NAME,url:v.resolve(t[2],e)},E=l.decimalResolution("RESOLUTION");E&&(f.width=E.width,f.height=E.height),B((l.CODECS||"").split(/[ ,]+/).filter(function(F){return F}),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=v.convertAVC1ToAVCOTI(f.videoCodec)),(a=f.unknownCodecs)!==null&&a!==void 0&&a.length||n.push(f),i.push(f)}else if(t[3]){var D=new z(t[3]);D["DATA-ID"]&&(r=!0,s[D["DATA-ID"]]=D)}return{levels:n.length>0&&n.length<i.length?n:i,sessionData:r?s:null}},v.parseMasterPlaylistMedia=function(d,e,t,i){var n;i===void 0&&(i=[]);var s=[],r=0;for(W.lastIndex=0;(n=W.exec(d))!==null;){var a=new z(n[1]);if(a.TYPE===t){var l={attrs:a,bitrate:0,id:r++,groupId:a["GROUP-ID"],instreamId:a["INSTREAM-ID"],name:a.NAME||a.LANGUAGE||"",type:t,default:a.bool("DEFAULT"),autoselect:a.bool("AUTOSELECT"),forced:a.bool("FORCED"),lang:a.LANGUAGE,url:a.URI?v.resolve(a.URI,e):""};if(i.length){var f=v.findGroup(i,l.groupId)||i[0];le(l,f,"audioCodec"),le(l,f,"textCodec")}s.push(l)}}return s},v.parseLevelPlaylist=function(d,e,t,i,n){var s,r,a,l=new Ae(e),f=l.fragments,E=null,D=0,F=0,H=0,X=0,me=null,ge=new se.Fragment(i,e),Ke=-1,He=!1;for(K.lastIndex=0,l.m3u8=d;(s=K.exec(d))!==null;){He&&(He=!1,(ge=new se.Fragment(i,e)).start=H,ge.sn=D,ge.cc=X,ge.level=t,E&&(ge.initSegment=E,ge.rawProgramDateTime=E.rawProgramDateTime,E.rawProgramDateTime=null));var Me=s[1];if(Me){ge.duration=parseFloat(Me);var je=(" "+s[2]).slice(1);ge.title=je||null,ge.tagList.push(je?["INF",Me,je]:["INF",Me])}else if(s[3])(0,U.isFiniteNumber)(ge.duration)&&(ge.start=H,a&&(ge.levelkey=a),ge.sn=D,ge.level=t,ge.cc=X,ge.urlId=n,f.push(ge),ge.relurl=(" "+s[3]).slice(1),ee(ge,me),me=ge,H+=ge.duration,D++,F=0,He=!0);else if(s[4]){var Xe=(" "+s[4]).slice(1);me?ge.setByteRange(Xe,me):ge.setByteRange(Xe)}else if(s[5])ge.rawProgramDateTime=(" "+s[5]).slice(1),ge.tagList.push(["PROGRAM-DATE-TIME",ge.rawProgramDateTime]),Ke===-1&&(Ke=f.length);else{if(!(s=s[0].match(Re))){_.logger.warn("No matches on slow regex match for level playlist!");continue}for(r=1;r<s.length&&s[r]===void 0;r++);var Ue=(" "+s[r]).slice(1),ut=(" "+s[r+1]).slice(1),tt=s[r+2]?(" "+s[r+2]).slice(1):"";switch(Ue){case"PLAYLIST-TYPE":l.type=ut.toUpperCase();break;case"MEDIA-SEQUENCE":D=l.startSN=parseInt(ut);break;case"SKIP":var Dt=new z(ut),kt=Dt.decimalInteger("SKIPPED-SEGMENTS");if((0,U.isFiniteNumber)(kt)){l.skippedSegments=kt;for(var Yt=kt;Yt--;)f.unshift(null);D+=kt}var er=Dt.enumeratedString("RECENTLY-REMOVED-DATERANGES");er&&(l.recentlyRemovedDateranges=er.split("	"));break;case"TARGETDURATION":l.targetduration=parseFloat(ut);break;case"VERSION":l.version=parseInt(ut);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(ut||tt)&&ge.tagList.push(tt?[ut,tt]:[ut]);break;case"DISCONTINUITY":X++,ge.tagList.push(["DIS"]);break;case"GAP":ge.tagList.push([Ue]);break;case"BITRATE":ge.tagList.push([Ue,ut]);break;case"DATERANGE":var Kt=new z(ut),Wt=new te(Kt,l.dateRanges[Kt.ID]);Wt.isValid||l.skippedSegments?l.dateRanges[Wt.id]=Wt:_.logger.warn('Ignoring invalid DATERANGE tag: "'+ut+'"'),ge.tagList.push(["EXT-X-DATERANGE",ut]);break;case"DISCONTINUITY-SEQUENCE":X=parseInt(ut);break;case"KEY":var ar,Tr=new z(ut),Ir=Tr.enumeratedString("METHOD"),fr=Tr.URI,Sr=Tr.hexadecimalInteger("IV"),Gr=Tr.enumeratedString("KEYFORMATVERSIONS"),ji=Tr.enumeratedString("KEYID"),xt=(ar=Tr.enumeratedString("KEYFORMAT"))!=null?ar:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(xt)>-1){_.logger.warn("Keyformat "+xt+" is not supported from the manifest");continue}if(xt!=="identity")continue;Ir&&(a=be.LevelKey.fromURL(e,fr),fr&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Ir)>=0&&(a.method=Ir,a.keyFormat=xt,ji&&(a.keyID=ji),Gr&&(a.keyFormatVersions=Gr),a.iv=Sr));break;case"START":var Ht=new z(ut).decimalFloatingPoint("TIME-OFFSET");(0,U.isFiniteNumber)(Ht)&&(l.startTimeOffset=Ht);break;case"MAP":var Yi=new z(ut);if(ge.duration){var ci=new se.Fragment(i,e);he(ci,Yi,t,a),E=ci,ge.initSegment=E,E.rawProgramDateTime&&!ge.rawProgramDateTime&&(ge.rawProgramDateTime=E.rawProgramDateTime)}else he(ge,Yi,t,a),E=ge,He=!0;break;case"SERVER-CONTROL":var Yr=new z(ut);l.canBlockReload=Yr.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=Yr.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&Yr.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=Yr.optionalFloat("PART-HOLD-BACK",0),l.holdBack=Yr.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Wi=new z(ut);l.partTarget=Wi.decimalFloatingPoint("PART-TARGET");break;case"PART":var Wr=l.partList;Wr||(Wr=l.partList=[]);var bi=F>0?Wr[Wr.length-1]:void 0,Ii=F++,qr=new se.Part(new z(ut),ge,e,Ii,bi);Wr.push(qr),ge.duration+=qr.duration;break;case"PRELOAD-HINT":var qi=new z(ut);l.preloadHint=qi;break;case"RENDITION-REPORT":var wi=new z(ut);l.renditionReports=l.renditionReports||[],l.renditionReports.push(wi);break;default:_.logger.warn("line parsed but not handled: "+s)}}}me&&!me.relurl?(f.pop(),H-=me.duration,l.partList&&(l.fragmentHint=me)):l.partList&&(ee(ge,me),ge.cc=X,l.fragmentHint=ge);var hn=f.length,rn=f[0],fn=f[hn-1];if((H+=l.skippedSegments*l.targetduration)>0&&hn&&fn){l.averagetargetduration=H/hn;var Ln=fn.sn;l.endSN=Ln!=="initSegment"?Ln:0,rn&&(l.startCC=rn.cc,rn.initSegment||l.fragments.every(function(zi){return zi.relurl&&(Xi=zi.relurl,Ie.test((Qi=(xi=$.parseURL(Xi))===null||xi===void 0?void 0:xi.path)!=null?Qi:""));var Xi,Qi,xi})&&(_.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(ge=new se.Fragment(i,e)).relurl=fn.relurl,ge.level=t,ge.sn="initSegment",rn.initSegment=ge,l.needSidxRanges=!0))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(H+=l.fragmentHint.duration),l.totalduration=H,l.endCC=X,Ke>0&&function(zi,Xi){for(var Qi=zi[Xi],xi=Xi;xi--;){var nn=zi[xi];if(!nn)return;nn.programDateTime=Qi.programDateTime-1e3*nn.duration,Qi=nn}}(f,Ke),l},v}();function B(v,d){["video","audio","text"].forEach(function(e){var t=v.filter(function(n){return function(s,r){var a=Oe[r];return!!a&&a[s.slice(0,4)]===!0}(n,e)});if(t.length){var i=t.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});d[e+"Codec"]=i.length>0?i[0]:t[0],v=v.filter(function(n){return t.indexOf(n)===-1})}}),d.unknownCodecs=v}function le(v,d,e){var t=d[e];t&&(v[e]=t)}function ee(v,d){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):d!=null&&d.programDateTime&&(v.programDateTime=d.endProgramDateTime),(0,U.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function he(v,d,e,t){v.relurl=d.URI,d.BYTERANGE&&v.setByteRange(d.BYTERANGE),v.level=e,v.sn="initSegment",t&&(v.levelkey=t),v.initSegment=null}var G=Q(308);function xe(v,d){var e=v.url;return e!==void 0&&e.indexOf("data:")!==0||(e=d.url),e}const Ge=function(){function v(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var d=v.prototype;return d.startLoad=function(e){},d.stopLoad=function(){this.destroyInternalLoaders()},d.registerListeners=function(){var e=this.hls;e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,s=new(i||n)(t);return e.loader=s,this.loaders[e.type]=s,s},d.getInternalLoader=function(e){return this.loaders[e.type]},d.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},d.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},d.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},d.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:G.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},d.onLevelLoading=function(e,t){var i=t.id,n=t.level,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:G.PlaylistContextType.LEVEL,url:s,deliveryDirectives:r})},d.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:G.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:r})},d.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:G.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:r})},d.load=function(e){var t,i,n,s,r,a,l=this.hls.config,f=this.getInternalLoader(e);if(f){var E=f.context;if(E&&E.url===e.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}switch(e.type){case G.PlaylistContextType.MANIFEST:i=l.manifestLoadingMaxRetry,n=l.manifestLoadingTimeOut,s=l.manifestLoadingRetryDelay,r=l.manifestLoadingMaxRetryTimeout;break;case G.PlaylistContextType.LEVEL:case G.PlaylistContextType.AUDIO_TRACK:case G.PlaylistContextType.SUBTITLE_TRACK:i=0,n=l.levelLoadingTimeOut;break;default:i=l.levelLoadingMaxRetry,n=l.levelLoadingTimeOut,s=l.levelLoadingRetryDelay,r=l.levelLoadingMaxRetryTimeout}if(f=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part&&(e.type===G.PlaylistContextType.LEVEL&&e.level!==null?a=this.hls.levels[e.level].details:e.type===G.PlaylistContextType.AUDIO_TRACK&&e.id!==null?a=this.hls.audioTracks[e.id].details:e.type===G.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(a=this.hls.subtitleTracks[e.id].details),a)){var D=a.partTarget,F=a.targetduration;D&&F&&(n=Math.min(1e3*Math.max(3*D,.8*F),n))}var H={timeout:n,maxRetry:i,retryDelay:s,maxRetryDelay:r,highWaterMark:0},X={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,H,X)},d.loadsuccess=function(e,t,i,n){if(n===void 0&&(n=null),i.isSidxRequest)return this.handleSidxRequest(e,i),void this.handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var s=e.data;s.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,n):this.handleMasterPlaylist(e,t,i,n)):this.handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},d.loaderror=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,e)},d.loadtimeout=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},d.handleMasterPlaylist=function(e,t,i,n){var s=this.hls,r=e.data,a=xe(e,i),l=we.parseMasterPlaylist(r,a),f=l.levels,E=l.sessionData;if(f.length){var D=f.map(function(ge){return{id:ge.attrs.AUDIO,audioCodec:ge.audioCodec}}),F=f.map(function(ge){return{id:ge.attrs.SUBTITLES,textCodec:ge.textCodec}}),H=we.parseMasterPlaylistMedia(r,a,"AUDIO",D),X=we.parseMasterPlaylistMedia(r,a,"SUBTITLES",F),me=we.parseMasterPlaylistMedia(r,a,"CLOSED-CAPTIONS");H.length&&(H.some(function(ge){return!ge.url})||!f[0].audioCodec||f[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),H.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new z({}),bitrate:0,url:""}))),s.trigger(c.Events.MANIFEST_LOADED,{levels:f,audioTracks:H,subtitles:X,captions:me,url:a,stats:t,networkDetails:n,sessionData:E})}else this.handleManifestParsingError(e,i,"no level found in manifest",n)},d.handleTrackOrLevelPlaylist=function(e,t,i,n){var s=this.hls,r=i.id,a=i.level,l=i.type,f=xe(e,i),E=(0,U.isFiniteNumber)(r)?r:0,D=(0,U.isFiniteNumber)(a)?a:E,F=function(Ke){switch(Ke.type){case G.PlaylistContextType.AUDIO_TRACK:return G.PlaylistLevelType.AUDIO;case G.PlaylistContextType.SUBTITLE_TRACK:return G.PlaylistLevelType.SUBTITLE;default:return G.PlaylistLevelType.MAIN}}(i),H=we.parseLevelPlaylist(e.data,f,D,F,E);if(H.fragments.length){if(l===G.PlaylistContextType.MANIFEST){var X={attrs:new z({}),bitrate:0,details:H,name:"",url:f};s.trigger(c.Events.MANIFEST_LOADED,{levels:[X],audioTracks:[],url:f,stats:t,networkDetails:n,sessionData:null})}if(t.parsing.end=performance.now(),H.needSidxRanges){var me,ge=(me=H.fragments[0].initSegment)===null||me===void 0?void 0:me.url;this.load({url:ge,isSidxRequest:!0,type:l,level:a,levelDetails:H,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=H,this.handlePlaylistLoaded(e,t,i,n)}else s.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},d.handleSidxRequest=function(e,t){var i=new Uint8Array(e.data),n=(0,ie.findBox)(i,["sidx"])[0];if(n){var s=(0,ie.parseSegmentIndex)(n);if(s){var r=s.references,a=t.levelDetails;r.forEach(function(l,f){var E=l.info,D=a.fragments[f];if(D.byteRange.length===0&&D.setByteRange(String(1+E.end-E.start)+"@"+String(E.start)),D.initSegment){var F=(0,ie.findBox)(i,["moov"])[0],H=F?F.length:null;D.initSegment.setByteRange(String(H)+"@0")}})}}},d.handleManifestParsingError=function(e,t,i,n){this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===G.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:n})},d.handleNetworkError=function(e,t,i,n){i===void 0&&(i=!1),_.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=M.ErrorDetails.UNKNOWN,r=!1,a=this.getInternalLoader(e);switch(e.type){case G.PlaylistContextType.MANIFEST:s=i?M.ErrorDetails.MANIFEST_LOAD_TIMEOUT:M.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case G.PlaylistContextType.LEVEL:s=i?M.ErrorDetails.LEVEL_LOAD_TIMEOUT:M.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case G.PlaylistContextType.AUDIO_TRACK:s=i?M.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:M.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case G.PlaylistContextType.SUBTITLE_TRACK:s=i?M.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:M.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1}a&&this.resetInternalLoader(e.type);var l={type:M.ErrorTypes.NETWORK_ERROR,details:s,fatal:r,url:e.url,loader:a,context:e,networkDetails:t};n&&(l.response=n),this.hls.trigger(c.Events.ERROR,l)},d.handlePlaylistLoaded=function(e,t,i,n){var s=i.type,r=i.level,a=i.id,l=i.groupId,f=i.loader,E=i.levelDetails,D=i.deliveryDirectives;if(E!=null&&E.targetduration){if(f)switch(E.live&&(f.getCacheAge&&(E.ageHeader=f.getCacheAge()||0),f.getCacheAge&&!isNaN(E.ageHeader)||(E.ageHeader=0)),s){case G.PlaylistContextType.MANIFEST:case G.PlaylistContextType.LEVEL:this.hls.trigger(c.Events.LEVEL_LOADED,{details:E,level:r||0,id:a||0,stats:t,networkDetails:n,deliveryDirectives:D});break;case G.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,{details:E,id:a||0,groupId:l||"",stats:t,networkDetails:n,deliveryDirectives:D});break;case G.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADED,{details:E,id:a||0,groupId:l||"",stats:t,networkDetails:n,deliveryDirectives:D})}}else this.handleManifestParsingError(e,i,"invalid target duration",n)},v}();var qe=function(){function v(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this.registerListeners()}var d=v.prototype;return d.startLoad=function(e){},d.stopLoad=function(){this.destroyInternalLoaders()},d.registerListeners=function(){this.hls.on(c.Events.KEY_LOADING,this.onKeyLoading,this)},d.unregisterListeners=function(){this.hls.off(c.Events.KEY_LOADING,this.onKeyLoading)},d.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},d.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},d.onKeyLoading=function(e,t){var i=t.frag,n=i.type,s=this.loaders[n];if(i.decryptdata){var r=i.decryptdata.uri;if(r!==this.decrypturl||this.decryptkey===null){var a=this.hls.config;if(s&&(_.logger.warn("abort previous key loader for type:"+n),s.abort()),!r)return void _.logger.warn("key uri is falsy");var l=a.loader,f=i.loader=this.loaders[n]=new l(a);this.decrypturl=r,this.decryptkey=null;var E={url:r,frag:i,responseType:"arraybuffer"},D={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:0},F={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(E,D,F)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(c.Events.KEY_LOADED,{frag:i}))}else _.logger.warn("Missing decryption data on fragment in onKeyLoading")},d.loadsuccess=function(e,t,i){var n=i.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(c.Events.KEY_LOADED,{frag:n})):_.logger.error("after key load, decryptdata unset")},d.loaderror=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},d.loadtimeout=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},v}();function it(v,d){var e;try{e=new Event("addtrack")}catch(t){(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=v,d.dispatchEvent(e)}function ye(v,d){var e=v.mode;if(e==="disabled"&&(v.mode="hidden"),v.cues&&!v.cues.getCueById(d.id))try{if(v.addCue(d),!v.cues.getCueById(d.id))throw new Error("addCue is failed for: "+d)}catch(i){_.logger.debug("[texttrack-utils]: "+i);var t=new self.TextTrackCue(d.startTime,d.endTime,d.text);t.id=d.id,v.addCue(t)}e==="disabled"&&(v.mode=e)}function Ze(v){var d=v.mode;if(d==="disabled"&&(v.mode="hidden"),v.cues)for(var e=v.cues.length;e--;)v.removeCue(v.cues[e]);d==="disabled"&&(v.mode=d)}function st(v,d,e,t){var i=v.mode;if(i==="disabled"&&(v.mode="hidden"),v.cues&&v.cues.length>0)for(var n=function(r,a,l){var f=[],E=function(X,me){if(me<X[0].startTime)return 0;var ge=X.length-1;if(me>X[ge].endTime)return-1;for(var Ke=0,He=ge;Ke<=He;){var Me=Math.floor((He+Ke)/2);if(me<X[Me].startTime)He=Me-1;else{if(!(me>X[Me].startTime&&Ke<ge))return Me;Ke=Me+1}}return X[Ke].startTime-me<me-X[He].startTime?Ke:He}(r,a);if(E>-1)for(var D=E,F=r.length;D<F;D++){var H=r[D];if(H.startTime>=a&&H.endTime<=l)f.push(H);else if(H.startTime>l)return f}return f}(v.cues,d,e),s=0;s<n.length;s++)t&&!t(n[s])||v.removeCue(n[s]);i==="disabled"&&(v.mode=i)}var Et=Q(181),lt=Q(856);function vt(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var St=function(){var v=vt();try{new v(0,Number.POSITIVE_INFINITY,"")}catch(d){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function gt(v,d){return v.getTime()/1e3-d}const At=function(){function v(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var d=v.prototype;return d.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},d._registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},d._unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},d.onMediaAttached=function(e,t){this.media=t.media},d.onMediaDetaching=function(){this.id3Track&&(Ze(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},d.onManifestLoading=function(){this.dateRangeCuesAppended={}},d.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},d.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if(i.kind==="metadata"&&i.label==="id3")return it(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},d.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,s=i.enableID3MetadataCues;if(n||s){t.frag;var r=t.samples;t.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=vt(),l=0;l<r.length;l++){var f=r[l].type;if((f!==lt.MetadataSchema.emsg||n)&&s){var E=Et.getID3Frames(r[l].data);if(E){var D=r[l].pts,F=D+r[l].duration;F>St&&(F=St),F-D<=0&&(F=D+.25);for(var H=0;H<E.length;H++){var X=E[H];if(!Et.isTimeStampFrame(X)){this.updateId3CueEnds(D);var me=new a(D,F,"");me.value=X,f&&(me.type=f),this.id3Track.addCue(me)}}}}}}}},d.updateId3CueEnds=function(e){var t,i=(t=this.id3Track)===null||t===void 0?void 0:t.cues;if(i)for(var n=i.length;n--;){var s=i[n];s.startTime<e&&s.endTime===St&&(s.endTime=e)}},d.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,s=t.type,r=this.id3Track,a=this.hls;if(a){var l=a.config,f=l.enableEmsgMetadataCues,E=l.enableID3MetadataCues;r&&(f||E)&&st(r,i,n,s==="audio"?function(D){return D.type===lt.MetadataSchema.audioId3&&E}:s==="video"?function(D){return D.type===lt.MetadataSchema.emsg&&f}:function(D){return D.type===lt.MetadataSchema.audioId3&&E||D.type===lt.MetadataSchema.emsg&&f})}},d.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,r=this.id3Track,a=n.dateRanges,l=Object.keys(a);if(r)for(var f=Object.keys(s).filter(function(Ke){return!l.includes(Ke)}),E=function(Ke){var He=f[Ke];Object.keys(s[He].cues).forEach(function(Me){r.removeCue(s[He].cues[Me])}),delete s[He]},D=f.length;D--;)E(D);var F=n.fragments[n.fragments.length-1];if(l.length!==0&&(0,U.isFiniteNumber)(F==null?void 0:F.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var H=F.programDateTime/1e3-F.start,X=vt(),me=function(Ke){var He=l[Ke],Me=a[He],je=s[He],Xe=(je==null?void 0:je.cues)||{},Ue=(je==null?void 0:je.durationKnown)||!1,ut=gt(Me.startDate,H),tt=St,Dt=Me.endDate;if(Dt)tt=gt(Dt,H),Ue=!0;else if(Me.endOnNext&&!Ue){var kt=l.reduce(function(Ir,fr){var Sr=a[fr];return Sr.class===Me.class&&Sr.id!==fr&&Sr.startDate>Me.startDate&&Ir.push(Sr),Ir},[]).sort(function(Ir,fr){return Ir.startDate.getTime()-fr.startDate.getTime()})[0];kt&&(tt=gt(kt.startDate,H),Ue=!0)}for(var Yt,er=Object.keys(Me.attr),Kt=0;Kt<er.length;Kt++){var Wt=er[Kt];if(Wt!==Te.ID&&Wt!==Te.CLASS&&Wt!==Te.START_DATE&&Wt!==Te.DURATION&&Wt!==Te.END_DATE&&Wt!==Te.END_ON_NEXT){var ar=Xe[Wt];if(ar)Ue&&!je.durationKnown&&(ar.endTime=tt);else{var Tr=Me.attr[Wt];ar=new X(ut,tt,""),Wt!==Te.SCTE35_OUT&&Wt!==Te.SCTE35_IN||(Yt=Tr,Tr=Uint8Array.from(Yt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),ar.value={key:Wt,data:Tr},ar.type=lt.MetadataSchema.dateRange,i.id3Track.addCue(ar),Xe[Wt]=ar}}}s[He]={cues:Xe,dateRange:Me,durationKnown:Ue}},ge=0;ge<l.length;ge++)me(ge)}}},v}();function Lt(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}var yt,Ot=function(){function v(i){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=i,this.config=i.config,this.registerListeners()}var d,e,t=v.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.Events.ERROR,this.onError)},t.onMediaAttached=function(i,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(i,n){var s=n.details;this.levelDetails=s,s.advanced&&this.timeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(i,n){n.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,_.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var i=this.media,n=this.levelDetails;if(i&&n){this.currentTime=i.currentTime;var s=this.computeLatency();if(s!==null){this._latency=s;var r=this.config,a=r.lowLatencyMode,l=r.maxLiveSyncPlaybackRate;if(a&&l!==1){var f=this.targetLatency;if(f!==null){var E=s-f,D=E<Math.min(this.maxLatency,f+n.targetduration);if(n.live&&D&&E>.05&&this.forwardBufferLength>1){var F=Math.min(2,Math.max(1,l)),H=Math.round(2/(1+Math.exp(-.75*E-this.edgeStalled))*20)/20;i.playbackRate=Math.min(F,Math.max(1,H))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var i=this.levelDetails;return i===null?null:i.edge+i.age},t.computeLatency=function(){var i=this.estimateLiveEdge();return i===null?null:i-this.currentTime},d=v,(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var i=this.config,n=this.levelDetails;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:n?i.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var i=this.levelDetails;if(i===null)return null;var n=i.holdBack,s=i.partHoldBack,r=i.targetduration,a=this.config,l=a.liveSyncDuration,f=a.liveSyncDurationCount,E=a.lowLatencyMode,D=this.hls.userConfig,F=E&&s||n;(D.liveSyncDuration||D.liveSyncDurationCount||F===0)&&(F=l!==void 0?l:f*r);var H=r;return F+Math.min(1*this.stallCount,H)}},{key:"liveSyncPosition",get:function(){var i=this.estimateLiveEdge(),n=this.targetLatency,s=this.levelDetails;if(i===null||n===null||s===null)return null;var r=s.edge,a=i-n-this.edgeStalled,l=r-s.totalduration,f=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,a),f)}},{key:"drift",get:function(){var i=this.levelDetails;return i===null?1:i.drift}},{key:"edgeStalled",get:function(){var i=this.levelDetails;if(i===null)return 0;var n=3*(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.max(i.age-n,0)}},{key:"forwardBufferLength",get:function(){var i=this.media,n=this.levelDetails;if(!i||!n)return 0;var s=i.buffered.length;return(s?i.buffered.end(s-1):n.edge)-this.currentTime}}])&&Lt(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();function _t(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}(function(v){v.No="",v.Yes="YES",v.v2="v2"})(yt||(yt={}));var Jt=function(){function v(d,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=d,this.part=e,this.skip=t}return v.prototype.addDirectives=function(d){var e=new self.URL(d);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},v}(),Gt=function(){function v(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(i){return i}).join(",").replace(/\.[^.,]+/g,"")}var d,e;return d=v,(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&_t(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();function wt(){return wt=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},wt.apply(this,arguments)}function tr(v,d,e){switch(d){case"audio":v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds.push(e);break;case"text":v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds.push(e)}}function Zt(v){var d={};v.forEach(function(e){var t=e.groupId||"";e.id=d[t]=d[t]||0,d[t]++})}function rr(v,d){var e=d.startPTS;if((0,U.isFiniteNumber)(e)){var t,i=0;d.sn>v.sn?(i=e-v.start,t=v):(i=v.start-e,t=d),t.duration!==i&&(t.duration=i)}else d.sn>v.sn?v.cc===d.cc&&v.minEndPTS?d.start=v.start+(v.minEndPTS-v.start):d.start=v.start+v.duration:d.start=Math.max(v.start-d.duration,0)}function lr(v,d,e,t,i,n){t-e<=0&&(_.logger.warn("Fragment should have a positive duration",d),t=e+d.duration,n=i+d.duration);var s=e,r=t,a=d.startPTS,l=d.endPTS;if((0,U.isFiniteNumber)(a)){var f=Math.abs(a-e);(0,U.isFiniteNumber)(d.deltaPTS)?d.deltaPTS=Math.max(f,d.deltaPTS):d.deltaPTS=f,s=Math.max(e,a),e=Math.min(e,a),i=Math.min(i,d.startDTS),r=Math.min(t,l),t=Math.max(t,l),n=Math.max(n,d.endDTS)}d.duration=t-e;var E=e-d.start;d.appendedPTS=t,d.start=d.startPTS=e,d.maxStartPTS=s,d.startDTS=i,d.endPTS=t,d.minEndPTS=r,d.endDTS=n;var D,F=d.sn;if(!v||F<v.startSN||F>v.endSN)return 0;var H=F-v.startSN,X=v.fragments;for(X[H]=d,D=H;D>0;D--)rr(X[D],X[D-1]);for(D=H;D<X.length-1;D++)rr(X[D],X[D+1]);return v.fragmentHint&&rr(X[X.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,E}function ur(v,d){var e=d.startSN+d.skippedSegments-v.startSN,t=v.fragments;e<0||e>=t.length||hr(d,t[e].start)}function hr(v,d){if(d){for(var e=v.fragments,t=v.skippedSegments;t<e.length;t++)e[t].start+=d;v.fragmentHint&&(v.fragmentHint.start+=d)}}var Xt=function(){function v(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,t+":"),this.warn=_.logger.warn.bind(_.logger,t+":"),this.hls=e}var d=v.prototype;return d.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},d.onError=function(e,t){t.fatal&&t.type===M.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},d.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},d.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},d.stopLoad=function(){this.canLoad=!1,this.clearTimer()},d.switchParams=function(e,t){var i=t==null?void 0:t.renditionReports;if(i)for(var n=0;n<i.length;n++){var s=i[n],r=""+s.URI;if(r===e.slice(-r.length)){var a=parseInt(s["LAST-MSN"]),l=parseInt(s["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var f=Math.min(t.age-t.partTarget,t.targetduration);l!==void 0&&f>t.partTarget&&(l+=1)}if((0,U.isFiniteNumber)(a))return new Jt(a,(0,U.isFiniteNumber)(l)?l:void 0,yt.No)}}},d.loadPlaylist=function(e){},d.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},d.playlistLoaded=function(e,t,i){var n=this,s=t.details,r=t.stats,a=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(s.advancedDateTime=Date.now()-a,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),i&&s.fragments.length>0&&function(Xe,Ue){for(var ut=null,tt=Xe.fragments,Dt=tt.length-1;Dt>=0;Dt--){var kt=tt[Dt].initSegment;if(kt){ut=kt;break}}Xe.fragmentHint&&delete Xe.fragmentHint.endPTS;var Yt,er,Kt,Wt,ar,Tr=0;if(function(xt,Ht,Yi){for(var ci=Ht.skippedSegments,Yr=Math.max(xt.startSN,Ht.startSN)-Ht.startSN,Wi=(xt.fragmentHint?1:0)+(ci?Ht.endSN:Math.min(xt.endSN,Ht.endSN))-Ht.startSN,Wr=Ht.startSN-xt.startSN,bi=Ht.fragmentHint?Ht.fragments.concat(Ht.fragmentHint):Ht.fragments,Ii=xt.fragmentHint?xt.fragments.concat(xt.fragmentHint):xt.fragments,qr=Yr;qr<=Wi;qr++){var qi=Ii[Wr+qr],wi=bi[qr];ci&&!wi&&qr<ci&&(wi=Ht.fragments[qr]=qi),qi&&wi&&Yi(qi,wi)}}(Xe,Ue,function(xt,Ht){xt.relurl&&(Tr=xt.cc-Ht.cc),(0,U.isFiniteNumber)(xt.startPTS)&&(0,U.isFiniteNumber)(xt.endPTS)&&(Ht.start=Ht.startPTS=xt.startPTS,Ht.startDTS=xt.startDTS,Ht.appendedPTS=xt.appendedPTS,Ht.maxStartPTS=xt.maxStartPTS,Ht.endPTS=xt.endPTS,Ht.endDTS=xt.endDTS,Ht.minEndPTS=xt.minEndPTS,Ht.duration=xt.endPTS-xt.startPTS,Ht.duration&&(Yt=Ht),Ue.PTSKnown=Ue.alignedSliding=!0),Ht.elementaryStreams=xt.elementaryStreams,Ht.loader=xt.loader,Ht.stats=xt.stats,Ht.urlId=xt.urlId,xt.initSegment&&(Ht.initSegment=xt.initSegment,ut=xt.initSegment)}),ut&&(Ue.fragmentHint?Ue.fragments.concat(Ue.fragmentHint):Ue.fragments).forEach(function(xt){var Ht;xt.initSegment&&xt.initSegment.relurl!==((Ht=ut)===null||Ht===void 0?void 0:Ht.relurl)||(xt.initSegment=ut)}),Ue.skippedSegments)if(Ue.deltaUpdateFailed=Ue.fragments.some(function(xt){return!xt}),Ue.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var Ir=Ue.skippedSegments;Ir--;)Ue.fragments.shift();Ue.startSN=Ue.fragments[0].sn,Ue.startCC=Ue.fragments[0].cc}else Ue.canSkipDateRanges&&(Ue.dateRanges=(er=Xe.dateRanges,Kt=Ue.dateRanges,Wt=Ue.recentlyRemovedDateranges,ar=wt({},er),Wt&&Wt.forEach(function(xt){delete ar[xt]}),Object.keys(Kt).forEach(function(xt){var Ht=new te(Kt[xt].attr,ar[xt]);Ht.isValid?ar[xt]=Ht:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Kt[xt].attr)+'"')}),ar));var fr=Ue.fragments;if(Tr){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var Sr=0;Sr<fr.length;Sr++)fr[Sr].cc+=Tr}Ue.skippedSegments&&(Ue.startCC=Ue.fragments[0].cc),function(xt,Ht,Yi){if(xt&&Ht)for(var ci=0,Yr=0,Wi=xt.length;Yr<=Wi;Yr++){var Wr=xt[Yr],bi=Ht[Yr+ci];Wr&&bi&&Wr.index===bi.index&&Wr.fragment.sn===bi.fragment.sn?(Ii=Wr,(qr=bi).elementaryStreams=Ii.elementaryStreams,qr.stats=Ii.stats):ci--}var Ii,qr}(Xe.partList,Ue.partList),Yt?lr(Ue,Yt,Yt.startPTS,Yt.endPTS,Yt.startDTS,Yt.endDTS):ur(Xe,Ue),fr.length&&(Ue.totalduration=Ue.edge-fr[0].start),Ue.driftStartTime=Xe.driftStartTime,Ue.driftStart=Xe.driftStart;var Gr=Ue.advancedDateTime;if(Ue.advanced&&Gr){var ji=Ue.edge;Ue.driftStart||(Ue.driftStartTime=Gr,Ue.driftStart=ji),Ue.driftEndTime=Gr,Ue.driftEnd=ji}else Ue.driftEndTime=Xe.driftEndTime,Ue.driftEnd=Xe.driftEnd,Ue.advancedDateTime=Xe.advancedDateTime}(i,s),!this.canLoad||!s.live)return;var l,f=void 0,E=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var D=this.hls.config.lowLatencyMode,F=s.lastPartSn,H=s.endSN,X=s.lastPartIndex,me=F===H;X!==-1?(f=me?H+1:F,E=me?D?0:X:X+1):f=H+1;var ge=s.age,Ke=ge+s.ageHeader,He=Math.min(Ke-s.partTarget,1.5*s.targetduration);if(He>0){if(i&&He>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+He+" with playlist age: "+s.age),He=0;else{var Me=Math.floor(He/s.targetduration);f+=Me,E!==void 0&&(E+=Math.round(He%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+ge.toFixed(2)+"s goal: "+He+" skip sn "+Me+" to part "+E)}s.tuneInGoal=He}if(l=this.getDeliveryDirectives(s,t.deliveryDirectives,f,E),D||!me)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(s,t.deliveryDirectives,f,E);var je=function(Xe,Ue){var ut,tt=1e3*Xe.levelTargetDuration,Dt=tt/2,kt=Xe.age,Yt=kt>0&&kt<3*tt,er=Ue.loading.end-Ue.loading.start,Kt=Xe.availabilityDelay;if(Xe.updated===!1)if(Yt){var Wt=333*Xe.misses;ut=Math.max(Math.min(Dt,2*er),Wt),Xe.availabilityDelay=(Xe.availabilityDelay||0)+ut}else ut=Dt;else Yt?(Kt=Math.min(Kt||tt/2,kt),Xe.availabilityDelay=Kt,ut=Kt+tt-kt):ut=tt-er;return Math.round(ut)}(s,r);f!==void 0&&s.canBlockReload&&(je-=s.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(je)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(l)},je)}else this.clearTimer()},d.getDeliveryDirectives=function(e,t,i,n){var s=function(r,a){var l=r.canSkipUntil,f=r.canSkipDateRanges,E=r.endSN;return l&&(a!==void 0?a-E:0)<l?f?yt.v2:yt.Yes:yt.No}(e,i);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,s=yt.No),new Jt(i,n,s)},d.retryLoadingOrFail=function(e){var t,i=this,n=this.hls.config,s=this.retryCount<n.levelLoadingMaxRetry;if(s)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&(t=e.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return i.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return s},v}();function sr(){return sr=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},sr.apply(this,arguments)}function Ee(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ne(v,d){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(v,d)}var x,re=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),J=function(v){var d,e;function t(r){var a;return(a=v.call(this,r,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ne(d,e);var i,n,s=t.prototype;return s._registerListeners=function(){var r=this.hls;r.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(c.Events.ERROR,this.onError,this)},s._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(c.Events.ERROR,this.onError,this)},s.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,v.prototype.destroy.call(this)},s.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),v.prototype.startLoad.call(this)},s.onManifestLoaded=function(r,a){var l,f,E=[],D=[],F=[],H={},X=!1,me=!1,ge=!1;if(a.levels.forEach(function(je){var Xe=je.attrs;X=X||!(!je.width||!je.height),me=me||!!je.videoCodec,ge=ge||!!je.audioCodec,re&&je.audioCodec&&je.audioCodec.indexOf("mp4a.40.34")!==-1&&(je.audioCodec=void 0);var Ue=je.bitrate+"-"+je.attrs.RESOLUTION+"-"+je.attrs.CODECS;(f=H[Ue])?f.url.push(je.url):(f=new Gt(je),H[Ue]=f,E.push(f)),Xe&&(Xe.AUDIO&&tr(f,"audio",Xe.AUDIO),Xe.SUBTITLES&&tr(f,"text",Xe.SUBTITLES))}),(X||me)&&ge&&(E=E.filter(function(je){var Xe=je.videoCodec,Ue=je.width,ut=je.height;return!!Xe||!(!Ue||!ut)})),E=E.filter(function(je){var Xe=je.audioCodec,Ue=je.videoCodec;return(!Xe||P(Xe,"audio"))&&(!Ue||P(Ue,"video"))}),a.audioTracks&&Zt(D=a.audioTracks.filter(function(je){return!je.audioCodec||P(je.audioCodec,"audio")})),a.subtitles&&Zt(F=a.subtitles),E.length>0){l=E[0].bitrate,E.sort(function(je,Xe){return je.bitrate-Xe.bitrate}),this._levels=E;for(var Ke=0;Ke<E.length;Ke++)if(E[Ke].bitrate===l){this._firstLevel=Ke,this.log("manifest loaded, "+E.length+" level(s) found, first bitrate: "+l);break}var He=ge&&!me,Me={levels:E,audioTracks:D,subtitleTracks:F,firstLevel:this._firstLevel,stats:a.stats,audio:ge,video:me,altAudio:!He&&D.some(function(je){return!!je.url})};this.hls.trigger(c.Events.MANIFEST_PARSED,Me),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},s.onError=function(r,a){var l;if(v.prototype.onError.call(this,r,a),!a.fatal){var f=a.context,E=this._levels[this.currentLevelIndex];if(f&&(f.type===G.PlaylistContextType.AUDIO_TRACK&&E.audioGroupIds&&f.groupId===E.audioGroupIds[E.urlId]||f.type===G.PlaylistContextType.SUBTITLE_TRACK&&E.textGroupIds&&f.groupId===E.textGroupIds[E.urlId]))this.redundantFailover(this.currentLevelIndex);else{var D,F=!1,H=!0;switch(a.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var X=a.frag.type===G.PlaylistLevelType.MAIN?a.frag.level:this.currentLevelIndex,me=this._levels[X];me?(me.fragmentError++,me.fragmentError>this.hls.config.fragLoadingMaxRetry&&(D=X)):D=X}break;case M.ErrorDetails.LEVEL_LOAD_ERROR:case M.ErrorDetails.LEVEL_LOAD_TIMEOUT:f&&(f.deliveryDirectives&&(H=!1),D=f.level),F=!0;break;case M.ErrorDetails.REMUX_ALLOC_ERROR:D=(l=a.level)!=null?l:this.currentLevelIndex,F=!0}D!==void 0&&this.recoverLevel(a,D,F,H)}}},s.recoverLevel=function(r,a,l,f){var E=r.details,D=this._levels[a];if(D.loadError++,l){if(!this.retryLoadingOrFail(r))return void(this.currentLevelIndex=-1);r.levelRetry=!0}if(f){var F=D.url.length;if(F>1&&D.loadError<F)r.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){for(var H=-1,X=this._levels,me=X.length;me--;){var ge=(me+this.currentLevelIndex)%X.length;if(ge!==this.currentLevelIndex&&X[ge].loadError===0){H=ge;break}}H>-1&&this.currentLevelIndex!==H&&(this.warn(E+": switch to "+H),r.levelRetry=!0,this.hls.nextAutoLevel=H)}}},s.redundantFailover=function(r){var a=this._levels[r],l=a.url.length;if(l>1){var f=(a.urlId+1)%l;this.warn("Switching to redundant URL-id "+f),this._levels.forEach(function(E){E.urlId=f}),this.level=r}},s.onFragLoaded=function(r,a){var l=a.frag;if(l!==void 0&&l.type===G.PlaylistLevelType.MAIN){var f=this._levels[l.level];f!==void 0&&(f.fragmentError=0,f.loadError=0)}},s.onLevelLoaded=function(r,a){var l,f,E=a.level,D=a.details,F=this._levels[E];if(!F)return this.warn("Invalid level index "+E),void((f=a.deliveryDirectives)!==null&&f!==void 0&&f.skip&&(D.deltaUpdateFailed=!0));E===this.currentLevelIndex?(F.fragmentError===0&&(F.loadError=0,this.retryCount=0),this.playlistLoaded(E,a,F.details)):(l=a.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(D.deltaUpdateFailed=!0)},s.onAudioTrackSwitched=function(r,a){var l=this.hls.levels[this.currentLevelIndex];if(l&&l.audioGroupIds){for(var f=-1,E=this.hls.audioTracks[a.id].groupId,D=0;D<l.audioGroupIds.length;D++)if(l.audioGroupIds[D]===E){f=D;break}f!==l.urlId&&(l.urlId=f,this.startLoad())}},s.loadPlaylist=function(r){var a=this.currentLevelIndex,l=this._levels[a];if(this.canLoad&&l&&l.url.length>0){var f=l.urlId,E=l.url[f];if(r)try{E=r.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("Attempt loading level index "+a+(r?" at sn "+r.msn+" part "+r.part:"")+" with URL-id "+f+" "+E),this.clearTimer(),this.hls.trigger(c.Events.LEVEL_LOADING,{url:E,level:a,id:f,deliveryDirectives:r||null})}},s.removeLevel=function(r,a){var l=function(E,D){return D!==a},f=this._levels.filter(function(E,D){return D!==r||E.url.length>1&&a!==void 0&&(E.url=E.url.filter(l),E.audioGroupIds&&(E.audioGroupIds=E.audioGroupIds.filter(l)),E.textGroupIds&&(E.textGroupIds=E.textGroupIds.filter(l)),E.urlId=0,!0)}).map(function(E,D){var F=E.details;return F!=null&&F.fragments&&F.fragments.forEach(function(H){H.level=D}),E});this._levels=f,this.hls.trigger(c.Events.LEVELS_UPDATED,{levels:f})},i=t,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var a,l=this._levels;if(l.length!==0&&(this.currentLevelIndex!==r||(a=l[r])===null||a===void 0||!a.details)){if(r<0||r>=l.length){var f=r<0;if(this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.LEVEL_SWITCH_ERROR,level:r,fatal:f,reason:"invalid level idx"}),f)return;r=Math.min(r,l.length-1)}this.clearTimer();var E=this.currentLevelIndex,D=l[E],F=l[r];this.log("switching to level "+r+" from "+E),this.currentLevelIndex=r;var H=sr({},F,{level:r,maxBitrate:F.maxBitrate,uri:F.uri,urlId:F.urlId});delete H._urlId,this.hls.trigger(c.Events.LEVEL_SWITCHING,H);var X=F.details;if(!X||X.live){var me=this.switchParams(F.uri,D==null?void 0:D.details);this.loadPlaylist(me)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this._firstLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}])&&Ee(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Xt);(function(v){v.NOT_LOADED="NOT_LOADED",v.APPENDING="APPENDING",v.PARTIAL="PARTIAL",v.OK="OK"})(x||(x={}));var ce=function(){function v(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var d=v.prototype;return d._registerListeners=function(){var e=this.hls;e.on(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(c.Events.FRAG_LOADED,this.onFragLoaded,this)},d._unregisterListeners=function(){var e=this.hls;e.off(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(c.Events.FRAG_LOADED,this.onFragLoaded,this)},d.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},d.getAppendedFrag=function(e,t){if(t===G.PlaylistLevelType.MAIN){var i=this.activeFragment,n=this.activeParts;if(!i)return null;if(n)for(var s=n.length;s--;){var r=n[s],a=r?r.end:i.appendedPTS;if(r.start<=e&&a!==void 0&&e<=a)return s>9&&(this.activeParts=n.slice(s-9)),r}else if(i.start<=e&&i.appendedPTS!==void 0&&e<=i.appendedPTS)return i}return this.getBufferedFrag(e,t)},d.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),s=n.length;s--;){var r=i[n[s]];if((r==null?void 0:r.body.type)===t&&r.buffered){var a=r.body;if(a.start<=e&&e<=a.end)return a}}return null},d.detectEvictedFragments=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r)if(r.buffered){var a=r.range[e];a&&a.time.some(function(l){var f=!n.isTimeBuffered(l.startPTS,l.endPTS,t);return f&&n.removeFragment(r.body),f})}else r.body.type===i&&n.removeFragment(r.body)})},d.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,s=e.part;if(i&&n.sn!=="initSegment"){var r=Le(n),a=this.fragments[r];a&&(Object.keys(i).forEach(function(l){var f=n.elementaryStreams[l];if(f){var E=i[l],D=s!==null||f.partial===!0;a.range[l]=t.getBufferedTimes(n,s,D,E)}}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},d.fragBuffered=function(e){var t=Le(e),i=this.fragments[t];i&&(i.loaded=null,i.buffered=!0)},d.getBufferedTimes=function(e,t,i,n){for(var s={time:[],partial:i},r=t?t.start:e.start,a=t?t.end:e.end,l=e.minEndPTS||a,f=e.maxStartPTS||r,E=0;E<n.length;E++){var D=n.start(E)-this.bufferPadding,F=n.end(E)+this.bufferPadding;if(f>=D&&l<=F){s.time.push({startPTS:Math.max(r,n.start(E)),endPTS:Math.min(a,n.end(E))});break}if(r<F&&a>D)s.partial=!0,s.time.push({startPTS:Math.max(r,n.start(E)),endPTS:Math.min(a,n.end(E))});else if(a<=D)break}return s},d.getPartialFragment=function(e){var t,i,n,s=null,r=0,a=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(f){var E=l[f];E&&ve(E)&&(i=E.body.start-a,n=E.body.end+a,e>=i&&e<=n&&(t=Math.min(e-i,n-e),r<=t&&(s=E.body,r=t)))}),s},d.getState=function(e){var t=Le(e),i=this.fragments[t];return i?i.buffered?ve(i)?x.PARTIAL:x.OK:x.APPENDING:x.NOT_LOADED},d.isTimeBuffered=function(e,t,i){for(var n,s,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,s=i.end(r)+this.bufferPadding,e>=n&&t<=s)return!0;if(t<=n)return!1}return!1},d.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if(i.sn!=="initSegment"&&!i.bitrateTest&&!n){var s=Le(i);this.fragments[s]={body:i,loaded:t,buffered:!1,range:Object.create(null)}}},d.onBufferAppended=function(e,t){var i=this,n=t.frag,s=t.part,r=t.timeRanges;if(n.type===G.PlaylistLevelType.MAIN)if(this.activeFragment=n,s){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(s)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(l){var f=r[l];if(i.detectEvictedFragments(l,f),!s)for(var E=0;E<f.length;E++)n.appendedPTS=Math.max(f.end(E),n.appendedPTS||0)})},d.onFragBuffered=function(e,t){this.detectPartialFragments(t)},d.hasFragment=function(e){var t=Le(e);return!!this.fragments[t]},d.removeFragmentsInRange=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r&&r.buffered){var a=r.body;a.type===i&&a.start<t&&a.end>e&&n.removeFragment(a)}})},d.removeFragment=function(e){var t=Le(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},d.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},v}();function ve(v){var d,e;return v.buffered&&(((d=v.range.video)===null||d===void 0?void 0:d.partial)||((e=v.range.audio)===null||e===void 0?void 0:e.partial))}function Le(v){return v.type+"_"+v.level+"_"+v.urlId+"_"+v.sn}var Ne=function(){function v(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var d=v.prototype;return d.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},d.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},d.onHandlerDestroyed=function(){},d.hasInterval=function(){return!!this._tickInterval},d.hasNextTick=function(){return!!this._tickTimer},d.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},d.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},d.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},d.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},d.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},d.doTick=function(){},v}(),ze={length:0,start:function(){return 0},end:function(){return 0}},Be=function(){function v(){}return v.isBuffered=function(d,e){try{if(d){for(var t=v.getBuffered(d),i=0;i<t.length;i++)if(e>=t.start(i)&&e<=t.end(i))return!0}}catch(n){}return!1},v.bufferInfo=function(d,e,t){try{if(d){var i,n=v.getBuffered(d),s=[];for(i=0;i<n.length;i++)s.push({start:n.start(i),end:n.end(i)});return this.bufferedInfo(s,e,t)}}catch(r){}return{len:0,start:e,end:e,nextStart:void 0}},v.bufferedInfo=function(d,e,t){e=Math.max(0,e),d.sort(function(X,me){return X.start-me.start||me.end-X.end});var i=[];if(t)for(var n=0;n<d.length;n++){var s=i.length;if(s){var r=i[s-1].end;d[n].start-r<t?d[n].end>r&&(i[s-1].end=d[n].end):i.push(d[n])}else i.push(d[n])}else i=d;for(var a,l=0,f=e,E=e,D=0;D<i.length;D++){var F=i[D].start,H=i[D].end;if(e+t>=F&&e<H)f=F,l=(E=H)-e;else if(e+t<F){a=F;break}}return{len:l,start:f||0,end:E||0,nextStart:a}},v.getBuffered=function(d){try{return d.buffered}catch(e){return _.logger.log("failed to get media.buffered",e),ze}},v}(),rt=function(v,d,e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=v,this.sn=d,this.id=e,this.size=t,this.part=i,this.partial=n};function pt(v,d){for(var e=null,t=0,i=v.length;t<i;t++){var n=v[t];if(n&&n.cc===d){e=n;break}}return e}function ct(v,d){if(v){var e=v.start+d;v.start=v.startPTS=e,v.endPTS=e+v.duration}}function R(v,d){for(var e=d.fragments,t=0,i=e.length;t<i;t++)ct(e[t],v);d.fragmentHint&&ct(d.fragmentHint,v),d.alignedSliding=!0}function I(v,d){if(v.hasProgramDateTime&&d.hasProgramDateTime){var e=v.fragments,t=d.fragments;if(e.length&&t.length){var i=t[Math.round(t.length/2)-1],n=pt(e,i.cc)||e[Math.round(e.length/2)-1],s=i.programDateTime,r=n.programDateTime;s!==null&&r!==null&&R((r-s)/1e3-(n.start-i.start),v)}}}const S=function(v,d){for(var e=0,t=v.length-1,i=null,n=null;e<=t;){var s=d(n=v[i=(e+t)/2|0]);if(s>0)e=i+1;else{if(!(s<0))return n;t=i-1}}return null};function C(v,d,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var i=null;return v?i=d[v.sn-d[0].sn+1]||null:e===0&&d[0].start===0&&(i=d[0]),i&&O(e,t,i)===0?i:S(d,O.bind(null,e,t))||i}function O(v,d,e){v===void 0&&(v=0),d===void 0&&(d=0);var t=Math.min(d,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=v?1:e.start-t>v&&e.start?-1:0}function Y(v,d,e){var t=1e3*Math.min(d,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>v}function j(v){var d=typeof Map=="function"?new Map:void 0;return j=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(d!==void 0){if(d.has(e))return d.get(e);d.set(e,i)}function i(){return Z(e,arguments,ke(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),pe(i,e)},j(v)}function Z(v,d,e){return Z=De()?Reflect.construct.bind():function(t,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(t,s));return n&&pe(r,n.prototype),r},Z.apply(null,arguments)}function De(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}function pe(v,d){return pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pe(v,d)}function ke(v){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},ke(v)}var Fe=Math.pow(2,17),Qe=function(){function v(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var d=v.prototype;return d.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},d.abort=function(){this.loader&&this.loader.abort()},d.load=function(e,t){var i=this,n=e.url;if(!n)return Promise.reject(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(l,f){i.loader&&i.loader.destroy();var E=i.loader=e.loader=r?new r(s):new a(s),D=$e(e),F={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:e.sn==="initSegment"?1/0:Fe};e.stats=E.stats,E.load(D,F,{onSuccess:function(H,X,me,ge){i.resetLoader(e,E),l({frag:e,part:null,payload:H.data,networkDetails:ge})},onError:function(H,X,me){i.resetLoader(e,E),f(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:H,networkDetails:me}))},onAbort:function(H,X,me){i.resetLoader(e,E),f(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:me}))},onTimeout:function(H,X,me){i.resetLoader(e,E),f(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:me}))},onProgress:function(H,X,me,ge){t&&t({frag:e,part:null,payload:me,networkDetails:ge})}})})},d.loadPart=function(e,t,i){var n=this;this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(l,f){n.loader&&n.loader.destroy();var E=n.loader=e.loader=r?new r(s):new a(s),D=$e(e,t),F={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:Fe};t.stats=E.stats,E.load(D,F,{onSuccess:function(H,X,me,ge){n.resetLoader(e,E),n.updateStatsFromPart(e,t);var Ke={frag:e,part:t,payload:H.data,networkDetails:ge};i(Ke),l(Ke)},onError:function(H,X,me){n.resetLoader(e,E),f(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:H,networkDetails:me}))},onAbort:function(H,X,me){e.stats.aborted=t.stats.aborted,n.resetLoader(e,E),f(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:me}))},onTimeout:function(H,X,me){n.resetLoader(e,E),f(new Ye({type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:me}))}})})},d.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,s=n.total;if(i.loaded+=n.loaded,s){var r=Math.round(e.duration/t.duration),a=Math.min(Math.round(i.loaded/s),r),l=(r-a)*Math.round(i.loaded/a);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var f=i.loading,E=n.loading;f.start?f.first+=E.first-E.start:(f.start=E.start,f.first=E.first),f.end=E.end},d.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},v}();function $e(v,d){d===void 0&&(d=null);var e=d||v,t={frag:v,part:d,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return(0,U.isFiniteNumber)(i)&&(0,U.isFiniteNumber)(n)&&(t.rangeStart=i,t.rangeEnd=n),t}var Ye=function(v){var d,e;function t(i){for(var n,s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return(n=v.call.apply(v,[this].concat(r))||this).data=void 0,n.data=i,n}return e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,pe(d,e),t}(j(Error)),ot=Q(21);const Tt=function(v){for(var d="",e=v.length,t=0;t<e;t++)d+="["+v.start(t).toFixed(3)+","+v.end(t).toFixed(3)+"]";return d};function dt(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function Ft(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function Qt(v,d){return Qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qt(v,d)}var Pt="STOPPED",mt="IDLE",Vt="KEY_LOADING",bt="FRAG_LOADING",zt="FRAG_LOADING_WAITING_RETRY",dr="WAITING_TRACK",jt="PARSING",cr="PARSED",yr="ENDED",mr="ERROR",ir="WAITING_INIT_PTS",gr="WAITING_LEVEL",Ar=function(v){var d,e;function t(r,a,l){var f;return(f=v.call(this)||this).hls=void 0,f.fragPrevious=null,f.fragCurrent=null,f.fragmentTracker=void 0,f.transmuxer=null,f._state=Pt,f.media=null,f.mediaBuffer=null,f.config=void 0,f.bitrateTest=!1,f.lastCurrentTime=0,f.nextLoadPosition=0,f.startPosition=0,f.loadedmetadata=!1,f.fragLoadError=0,f.retryDate=0,f.levels=null,f.fragmentLoader=void 0,f.levelLastLoaded=null,f.startFragRequested=!1,f.decrypter=void 0,f.initPTS=[],f.onvseeking=null,f.onvended=null,f.logPrefix="",f.log=void 0,f.warn=void 0,f.logPrefix=l,f.log=_.logger.log.bind(_.logger,l+":"),f.warn=_.logger.warn.bind(_.logger,l+":"),f.hls=r,f.fragmentLoader=new Qe(r.config),f.fragmentTracker=a,f.config=r.config,f.decrypter=new ot.default(r,r.config),r.on(c.Events.KEY_LOADED,f.onKeyLoaded,Ft(f)),r.on(c.Events.LEVEL_SWITCHING,f.onLevelSwitching,Ft(f)),f}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Qt(d,e);var i,n,s=t.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(r){},s.stopLoad=function(){this.fragmentLoader.abort();var r=this.fragCurrent;r&&this.fragmentTracker.removeFragment(r),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Pt},s._streamEnded=function(r,a){var l=this.fragCurrent,f=this.fragmentTracker;if(!a.live&&l&&this.media&&l.sn>=a.endSN&&!r.nextStart){var E=a.partList;if(E!=null&&E.length){var D=E[E.length-1];return Be.isBuffered(this.media,D.start+D.duration/2)}var F=f.getState(l);return F===x.PARTIAL||F===x.OK}return!1},s.onMediaAttached=function(r,a){var l=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),l.addEventListener("seeking",this.onvseeking),l.addEventListener("ended",this.onvended);var f=this.config;this.levels&&f.autoStartLoad&&this.state===Pt&&this.startLoad(f.startPosition)},s.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var r=this.config,a=this.fragCurrent,l=this.media,f=this.mediaBuffer,E=this.state,D=l?l.currentTime:0,F=Be.bufferInfo(f||l,D,r.maxBufferHole);if(this.log("media seeking to "+((0,U.isFiniteNumber)(D)?D.toFixed(3):D)+", state: "+E),E===yr)this.resetLoadingState();else if(a){var H=r.maxFragLookUpTolerance,X=a.start-H,me=a.start+a.duration+H;if(!F.len||me<F.start||X>F.end){var ge=D>me;(D<X||ge)&&(ge&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.resetLoadingState())}}l&&(this.lastCurrentTime=D),this.loadedmetadata||F.len||(this.nextLoadPosition=this.startPosition=D),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onKeyLoaded=function(r,a){if(this.state===Vt&&a.frag===this.fragCurrent&&this.levels){this.state=mt;var l=this.levels[a.frag.level].details;l&&this.loadFragment(a.frag,l,a.frag.start)}},s.onLevelSwitching=function(r,a){this.fragLoadError=0},s.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=Pt,this.hls.off(c.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},s.loadKey=function(r,a){this.log("Loading key for "+r.sn+" of ["+a.startSN+"-"+a.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=Vt,this.fragCurrent=r,this.hls.trigger(c.Events.KEY_LOADING,{frag:r})},s.loadFragment=function(r,a,l){this._loadFragForPlayback(r,a,l)},s._loadFragForPlayback=function(r,a,l){var f=this;this._doFragLoad(r,a,l,function(E){if(f.fragContextChanged(r))return f.warn("Fragment "+r.sn+(E.part?" p: "+E.part.index:"")+" of level "+r.level+" was dropped during download."),void f.fragmentTracker.removeFragment(r);r.stats.chunkCount++,f._handleFragmentLoadProgress(E)}).then(function(E){if(E){f.fragLoadError=0;var D=f.state;f.fragContextChanged(r)?(D===bt||!f.fragCurrent&&D===jt)&&(f.fragmentTracker.removeFragment(r),f.state=mt):("payload"in E&&(f.log("Loaded fragment "+r.sn+" of level "+r.level),f.hls.trigger(c.Events.FRAG_LOADED,E)),f._handleFragmentLoadComplete(E))}}).catch(function(E){f.state!==Pt&&f.state!==mr&&(f.warn(E),f.resetFragmentLoading(r))})},s.flushMainBuffer=function(r,a,l){if(l===void 0&&(l=null),r-a){var f={startOffset:r,endOffset:a,type:l};this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,f)}},s._loadInitSegment=function(r){var a=this;this._doFragLoad(r).then(function(l){if(!l||a.fragContextChanged(r)||!a.levels)throw new Error("init load aborted");return l}).then(function(l){var f=a.hls,E=l.payload,D=r.decryptdata;if(E&&E.byteLength>0&&D&&D.key&&D.iv&&D.method==="AES-128"){var F=self.performance.now();return a.decrypter.webCryptoDecrypt(new Uint8Array(E),D.key.buffer,D.iv.buffer).then(function(H){var X=self.performance.now();return f.trigger(c.Events.FRAG_DECRYPTED,{frag:r,payload:H,stats:{tstart:F,tdecrypt:X}}),l.payload=H,l})}return l}).then(function(l){var f=a.fragCurrent,E=a.hls,D=a.levels;if(!D)throw new Error("init load aborted, missing levels");D[r.level].details;var F=r.stats;a.state=mt,a.fragLoadError=0,r.data=new Uint8Array(l.payload),F.parsing.start=F.buffering.start=self.performance.now(),F.parsing.end=F.buffering.end=self.performance.now(),l.frag===f&&E.trigger(c.Events.FRAG_BUFFERED,{stats:F,frag:f,part:null,id:r.type}),a.tick()}).catch(function(l){a.state!==Pt&&a.state!==mr&&(a.warn(l),a.resetFragmentLoading(r))})},s.fragContextChanged=function(r){var a=this.fragCurrent;return!r||!a||r.level!==a.level||r.sn!==a.sn||r.urlId!==a.urlId},s.fragBufferedComplete=function(r,a){var l,f,E=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+r.type+" sn: "+r.sn+(a?" part: "+a.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level+" "+(E?Tt(Be.getBuffered(E)):"(detached)")),this.state=mt,E&&(!this.loadedmetadata&&r.type==G.PlaylistLevelType.MAIN&&E.buffered.length&&((l=this.fragCurrent)===null||l===void 0?void 0:l.sn)===((f=this.fragPrevious)===null||f===void 0?void 0:f.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},s.seekToStartPos=function(){},s._handleFragmentLoadComplete=function(r){var a=this.transmuxer;if(a){var l=r.frag,f=r.part,E=r.partsLoaded,D=!E||E.length===0||E.some(function(H){return!H}),F=new rt(l.level,l.sn,l.stats.chunkCount+1,0,f?f.index:-1,!D);a.flush(F)}},s._handleFragmentLoadProgress=function(r){},s._doFragLoad=function(r,a,l,f){var E=this;if(l===void 0&&(l=null),!this.levels)throw new Error("frag load aborted, missing levels");if(l=Math.max(r.start,l||0),this.config.lowLatencyMode&&a){var D=a.partList;if(D&&f){l>r.end&&a.fragmentHint&&(r=a.fragmentHint);var F=this.getNextPart(D,r,l);if(F>-1){var H=D[F];return this.log("Loading part sn: "+r.sn+" p: "+H.index+" cc: "+r.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+F+"-"+(D.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(l.toFixed(3))),this.nextLoadPosition=H.start+H.duration,this.state=bt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:r,part:D[F],targetBufferTime:l}),this.doFragPartsLoad(r,D,F,f).catch(function(X){return E.handleFragLoadError(X)})}if(!r.url||this.loadedEndOfParts(D,l))return Promise.resolve(null)}}return this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(l.toFixed(3))),(0,U.isFiniteNumber)(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=bt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:r,targetBufferTime:l}),this.fragmentLoader.load(r,f).catch(function(X){return E.handleFragLoadError(X)})},s.doFragPartsLoad=function(r,a,l,f){var E=this;return new Promise(function(D,F){var H=[];(function X(me){var ge=a[me];E.fragmentLoader.loadPart(r,ge,f).then(function(Ke){H[ge.index]=Ke;var He=Ke.part;E.hls.trigger(c.Events.FRAG_LOADED,Ke);var Me=a[me+1];if(!Me||Me.fragment!==r)return D({frag:r,part:He,partsLoaded:H});X(me+1)}).catch(F)})(l)})},s.handleFragLoadError=function(r){var a=r.data;return a&&a.details===M.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(c.Events.ERROR,a),null},s._handleTransmuxerFlush=function(r){var a=this.getCurrentContext(r);if(a&&this.state===jt){var l=a.frag,f=a.part,E=a.level,D=self.performance.now();l.stats.parsing.end=D,f&&(f.stats.parsing.end=D),this.updateLevelTiming(l,f,E,r.partial)}else this.fragCurrent||(this.state=mt)},s.getCurrentContext=function(r){var a=this.levels,l=r.level,f=r.sn,E=r.part;if(!a||!a[l])return this.warn("Levels object was unset while buffering fragment "+f+" of level "+l+". The current chunk will not be buffered."),null;var D=a[l],F=E>-1?function(X,me,ge){if(!X||!X.details)return null;var Ke=X.details.partList;if(Ke)for(var He=Ke.length;He--;){var Me=Ke[He];if(Me.index===ge&&Me.fragment.sn===me)return Me}return null}(D,f,E):null,H=F?F.fragment:function(X,me,ge){if(!X||!X.details)return null;var Ke=X.details,He=Ke.fragments[me-Ke.startSN];return He||((He=Ke.fragmentHint)&&He.sn===me?He:me<Ke.startSN&&ge&&ge.sn===me?ge:null)}(D,f,this.fragCurrent);return H?{frag:H,part:F,level:D}:null},s.bufferFragmentData=function(r,a,l,f){if(r&&this.state===jt){var E=r.data1,D=r.data2,F=E;if(E&&D&&(F=(0,ie.appendUint8Array)(E,D)),F&&F.length){var H={type:r.type,frag:a,part:l,chunkMeta:f,parent:a.type,data:F};this.hls.trigger(c.Events.BUFFER_APPENDING,H),r.dropped&&r.independent&&!l&&this.flushBufferGap(a)}}},s.flushBufferGap=function(r){var a=this.media;if(a)if(Be.isBuffered(a,a.currentTime)){var l=a.currentTime,f=Be.bufferInfo(a,l,0),E=r.duration,D=Math.min(2*this.config.maxFragLookUpTolerance,.25*E),F=Math.max(Math.min(r.start-D,f.end-D),l+D);r.start-F>D&&this.flushMainBuffer(F,r.start)}else this.flushMainBuffer(0,r.start)},s.getFwdBufferInfo=function(r,a){var l=this.config,f=this.getLoadPosition();if(!(0,U.isFiniteNumber)(f))return null;var E=Be.bufferInfo(r,f,l.maxBufferHole);if(E.len===0&&E.nextStart!==void 0){var D=this.fragmentTracker.getBufferedFrag(f,a);if(D&&E.nextStart<D.end)return Be.bufferInfo(r,f,Math.max(E.nextStart,l.maxBufferHole))}return E},s.getMaxBufferLength=function(r){var a,l=this.config;return a=r?Math.max(8*l.maxBufferSize/r,l.maxBufferLength):l.maxBufferLength,Math.min(a,l.maxMaxBufferLength)},s.reduceMaxBufferLength=function(r){var a=this.config,l=r||a.maxBufferLength;return a.maxMaxBufferLength>=l&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},s.getNextFragment=function(r,a){var l=a.fragments,f=l.length;if(!f)return null;var E,D=this.config,F=l[0].start;if(a.live){var H=D.initialLiveManifestSize;if(f<H)return this.warn("Not enough fragments to start playback (have: "+f+", need: "+H+")"),null;a.PTSKnown||this.startFragRequested||this.startPosition!==-1||(E=this.getInitialLiveFragment(a,l),this.startPosition=E?this.hls.liveSyncPosition||E.start:r)}else r<=F&&(E=l[0]);if(!E){var X=D.lowLatencyMode?a.partEnd:a.fragmentEnd;E=this.getFragmentAtPosition(r,X,a)}return this.mapToInitFragWhenRequired(E)},s.mapToInitFragWhenRequired=function(r){return r==null||!r.initSegment||r!=null&&r.initSegment.data||this.bitrateTest?r:r.initSegment},s.getNextPart=function(r,a,l){for(var f=-1,E=!1,D=!0,F=0,H=r.length;F<H;F++){var X=r[F];if(D=D&&!X.independent,f>-1&&l<X.start)break;var me=X.loaded;!me&&(E||X.independent||D)&&X.fragment===a&&(f=F),E=me}return f},s.loadedEndOfParts=function(r,a){var l=r[r.length-1];return l&&a>l.start&&l.loaded},s.getInitialLiveFragment=function(r,a){var l=this.fragPrevious,f=null;if(l){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),f=function(H,X,me){if(X===null||!Array.isArray(H)||!H.length||!(0,U.isFiniteNumber)(X)||X<(H[0].programDateTime||0)||X>=(H[H.length-1].endProgramDateTime||0))return null;me=me||0;for(var ge=0;ge<H.length;++ge){var Ke=H[ge];if(Y(X,me,Ke))return Ke}return null}(a,l.endProgramDateTime,this.config.maxFragLookUpTolerance)),!f){var E=l.sn+1;if(E>=r.startSN&&E<=r.endSN){var D=a[E-r.startSN];l.cc===D.cc&&(f=D,this.log("Live playlist, switching playlist, load frag with next SN: "+f.sn))}f||(f=function(H,X){return S(H,function(me){return me.cc<X?1:me.cc>X?-1:0})}(a,l.cc),f&&this.log("Live playlist, switching playlist, load frag with same CC: "+f.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(f=this.getFragmentAtPosition(F,this.bitrateTest?r.fragmentEnd:r.edge,r))}return f},s.getFragmentAtPosition=function(r,a,l){var f,E=this.config,D=this.fragPrevious,F=l.fragments,H=l.endSN,X=l.fragmentHint,me=E.maxFragLookUpTolerance,ge=!!(E.lowLatencyMode&&l.partList&&X);if(ge&&X&&!this.bitrateTest&&(F=F.concat(X),H=X.sn),f=r<a?C(D,F,r,r>a-me?0:me):F[F.length-1]){var Ke=f.sn-l.startSN;if(this.fragmentTracker.getState(f)===x.OK&&(D=f),D&&f.sn===D.sn&&!ge&&D&&f.level===D.level){var He=F[Ke+1];f.sn<H&&this.fragmentTracker.getState(He)!==x.OK?(this.log("SN "+f.sn+" just loaded, load next one: "+He.sn),f=He):f=null}}return f},s.synchronizeToLiveEdge=function(r){var a=this.config,l=this.media;if(l){var f=this.hls.liveSyncPosition,E=l.currentTime,D=r.fragments[0].start,F=r.edge,H=E>=D-a.maxFragLookUpTolerance&&E<=F;if(f!==null&&l.duration>f&&(E<f||!H)){var X=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*r.targetduration;(!H&&l.readyState<4||E<F-X)&&(this.loadedmetadata||(this.nextLoadPosition=f),l.readyState&&(this.warn("Playback: "+E.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+f.toFixed(3)),l.currentTime=f))}}},s.alignPlaylists=function(r,a){var l=this.levels,f=this.levelLastLoaded,E=this.fragPrevious,D=f!==null?l[f]:null,F=r.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var H=r.fragments[0].start,X=!a,me=r.alignedSliding&&(0,U.isFiniteNumber)(H);if(X||!me&&!H){(function(Ke,He,Me){He&&(function(je,Xe,Ue){if(function(tt,Dt,kt){return!(!Dt.details||!(kt.endCC>kt.startCC||tt&&tt.cc<kt.startCC))}(je,Ue,Xe)){var ut=function(tt,Dt,kt){kt===void 0&&(kt=0);var Yt=tt.fragments,er=Dt.fragments;if(er.length&&Yt.length){var Kt=pt(Yt,er[0].cc);if(Kt&&(!Kt||Kt.startPTS))return Kt;_.logger.log("No frag in previous level to align on")}else _.logger.log("No fragments to align")}(Ue.details,Xe);ut&&(0,U.isFiniteNumber)(ut.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+Xe.url),R(ut.start,Xe))}}(Ke,Me,He),!Me.alignedSliding&&He.details&&function(je,Xe){if(Xe.fragments.length&&je.hasProgramDateTime&&Xe.hasProgramDateTime){var Ue=Xe.fragments[0].programDateTime,ut=je.fragments[0].programDateTime,tt=(ut-Ue)/1e3+Xe.fragments[0].start;tt&&(0,U.isFiniteNumber)(tt)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(ut-Ue)+"ms, sliding:"+tt.toFixed(3)+" "+je.url+" "),R(tt,je))}}(Me,He.details),Me.alignedSliding||!He.details||Me.skippedSegments||ur(He.details,Me))})(E,D,r);var ge=r.fragments[0].start;return this.log("Live playlist sliding: "+ge.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+r.startSN+" prev-sn: "+(E?E.sn:"na")+" fragments: "+F),ge}return H},s.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,3*r.partTarget)},s.setStartPosition=function(r,a){var l=this.startPosition;if(l<a&&(l=-1),l===-1||this.lastCurrentTime===-1){var f=r.startTimeOffset;(0,U.isFiniteNumber)(f)?(l=a+f,f<0&&(l+=r.totalduration),l=Math.min(Math.max(a,l),a+r.totalduration),this.log("Start time offset "+f+" found in playlist, adjust startPosition to "+l),this.startPosition=l):r.live?l=this.hls.liveSyncPosition||a:this.startPosition=l=0,this.lastCurrentTime=l}this.nextLoadPosition=l},s.getLoadPosition=function(){var r=this.media,a=0;return this.loadedmetadata&&r?a=r.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},s.handleFragLoadAborted=function(r,a){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(a?" part"+a.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},s.resetFragmentLoading=function(r){this.fragCurrent&&(this.fragContextChanged(r)||this.state===zt)||(this.state=mt)},s.onFragmentOrKeyLoadError=function(r,a){if(!a.fatal){var l=a.frag;if(l&&l.type===r){this.fragCurrent;var f=this.config;if(this.fragLoadError+1<=f.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var E=Math.min(Math.pow(2,this.fragLoadError)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout);this.warn("Fragment "+l.sn+" of "+r+" "+l.level+" failed to load, retrying in "+E+"ms"),this.retryDate=self.performance.now()+E,this.fragLoadError++,this.state=zt}else a.levelRetry?(r===G.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=mt):(_.logger.error(a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.stopLoad(),this.state=mr)}}},s.afterBufferFlushed=function(r,a,l){if(r){var f=Be.getBuffered(r);this.fragmentTracker.detectEvictedFragments(a,f,l),this.state===yr&&this.resetLoadingState()}},s.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=mt},s.resetStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[r].details:null;a!=null&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},s.updateLevelTiming=function(r,a,l,f){var E=this,D=l.details;Object.keys(r.elementaryStreams).reduce(function(F,H){var X=r.elementaryStreams[H];if(X){var me=X.endPTS-X.startPTS;if(me<=0)return E.warn("Could not parse fragment "+r.sn+" "+H+" duration reliably ("+me+")"),F||!1;var ge=f?0:lr(D,r,X.startPTS,X.endPTS,X.startDTS,X.endDTS);return E.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:D,level:l,drift:ge,type:H,frag:r,start:X.startPTS,end:X.endPTS}),!0}return F},!1)||(this.warn("Found no media in fragment "+r.sn+" of level "+l.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=cr,this.hls.trigger(c.Events.FRAG_PARSED,{frag:r,part:a})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=t,(n=[{key:"state",get:function(){return this._state},set:function(r){var a=this._state;a!==r&&(this._state=r,this.log(a+"->"+r))}}])&&dt(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ne);function Rr(){return self.MediaSource||self.WebKitMediaSource}function Br(){return self.SourceBuffer||self.WebKitSourceBuffer}var xr=function(){var v=ENTRY_MODULE,d={},e=function i(n){var s=d[n];if(s!==void 0)return s.exports;var r=d[n]={exports:{}};return v[n].call(r.exports,r,r.exports,i),r.exports};e.m=v,e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,{a:n}),n},e.d=function(i,n){for(var s in n)e.o(n,s)&&!e.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:n[s]})},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var t=e(ENTRY_MODULE);return t.default||t}.toString().split("ENTRY_MODULE"),zr="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function Jr(v){return(v+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Xr(v,d,e){var t={};t[e]=[];var i=d.toString().replace(/^"[^"]+"/,"function"),n=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return t;for(var s,r=n[1],a=new RegExp("(\\\\n|\\W)"+Jr(r)+zr,"g");s=a.exec(i);)s[3]!=="dll-reference"&&t[e].push(s[3]);for(a=new RegExp("\\("+Jr(r)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+zr,"g");s=a.exec(i);)v[s[2]]||(t[e].push(s[1]),v[s[2]]=Q(s[1]).m),t[s[2]]=t[s[2]]||[],t[s[2]].push(s[4]);for(var l,f=Object.keys(t),E=0;E<f.length;E++)for(var D=0;D<t[f[E]].length;D++)l=t[f[E]][D],isNaN(1*l)||(t[f[E]][D]=1*t[f[E]][D]);return t}function Hr(v){return Object.keys(v).reduce(function(d,e){return d||v[e].length>0},!1)}function Nr(v,d,e,t){var i=v[t].map(function(n){return'"'+n+'": '+d[t][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return xr[0]+"{"+i+"}"+xr[1]+'"'+e+'"'+xr[2]}var Or=Q(544),Zr=Q(729),kr=Rr()||{isTypeSupported:function(){return!1}},wr=function(){function v(e,t,i,n){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var a=function(D,F){(F=F||{}).frag=s.frag,F.id=s.id,s.hls.trigger(D,F)};this.observer=new Zr.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,a),this.observer.on(c.Events.ERROR,a);var l={mp4:kr.isTypeSupported("video/mp4"),mpeg:kr.isTypeSupported("audio/mpeg"),mp3:kr.isTypeSupported('audio/mp4; codecs="mp3"')},f=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){var E;_.logger.log("demuxing in webworker");try{E=this.worker=function(D,F){F=F||{};var H={main:Q.m},X=F.all?{main:Object.keys(H.main)}:function(Me,je){for(var Xe={main:[je]},Ue={main:[]},ut={main:{}};Hr(Xe);)for(var tt=Object.keys(Xe),Dt=0;Dt<tt.length;Dt++){var kt=tt[Dt],Yt=Xe[kt].pop();if(ut[kt]=ut[kt]||{},!ut[kt][Yt]&&Me[kt][Yt]){ut[kt][Yt]=!0,Ue[kt]=Ue[kt]||[],Ue[kt].push(Yt);for(var er=Xr(Me,Me[kt][Yt],kt),Kt=Object.keys(er),Wt=0;Wt<Kt.length;Wt++)Xe[Kt[Wt]]=Xe[Kt[Wt]]||[],Xe[Kt[Wt]]=Xe[Kt[Wt]].concat(er[Kt[Wt]])}}return Ue}(H,D),me="";Object.keys(X).filter(function(Me){return Me!=="main"}).forEach(function(Me){for(var je=0;X[Me][je];)je++;X[Me].push(je),H[Me][je]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",me=me+"var "+Me+" = ("+Nr(X,H,je,modules)+`)();
`}),me=me+"new (("+Nr(X,H,D,"main")+")())(self);";var ge=new window.Blob([me],{type:"text/javascript"}),Ke=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(ge),He=new window.Worker(Ke);return He.objectURL=Ke,He}(182),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(D){s.useWorker=!1,_.logger.warn("Exception in webworker, fallback to inline"),s.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(D.message+"  ("+D.filename+":"+D.lineno+")")})},E.postMessage({cmd:"init",typeSupported:l,vendor:f,id:t,config:JSON.stringify(r)})}catch(D){_.logger.warn("Error in worker:",D),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new Or.default(this.observer,l,r,f,t),this.worker=null}}else this.transmuxer=new Or.default(this.observer,l,r,f,t)}var d=v.prototype;return d.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},d.push=function(e,t,i,n,s,r,a,l,f,E){var D,F,H=this;f.transmuxing.start=self.performance.now();var X=this.transmuxer,me=this.worker,ge=r?r.start:s.start,Ke=s.decryptdata,He=this.frag,Me=!(He&&s.cc===He.cc),je=!(He&&f.level===He.level),Xe=He?f.sn-He.sn:-1,Ue=this.part?f.part-this.part.index:-1,ut=Xe===0&&f.id>1&&f.id===(He==null?void 0:He.stats.chunkCount),tt=!je&&(Xe===1||Xe===0&&(Ue===1||ut&&Ue<=0)),Dt=self.performance.now();(je||Xe||s.stats.parsing.start===0)&&(s.stats.parsing.start=Dt),!r||!Ue&&tt||(r.stats.parsing.start=Dt);var kt=!(He&&((D=s.initSegment)===null||D===void 0?void 0:D.url)===((F=He.initSegment)===null||F===void 0?void 0:F.url)),Yt=new Or.TransmuxState(Me,tt,l,je,ge,kt);if(!tt||Me||kt){_.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+f.sn+" p: "+f.part+" level: "+f.level+" id: "+f.id+`
        discontinuity: `+Me+`
        trackSwitch: `+je+`
        contiguous: `+tt+`
        accurateTimeOffset: `+l+`
        timeOffset: `+ge+`
        initSegmentChange: `+kt);var er=new Or.TransmuxConfig(i,n,t,a,E);this.configureTransmuxer(er)}if(this.frag=s,this.part=r,me)me.postMessage({cmd:"demux",data:e,decryptdata:Ke,chunkMeta:f,state:Yt},e instanceof ArrayBuffer?[e]:[]);else if(X){var Kt=X.push(e,Ke,f,Yt);(0,Or.isPromise)(Kt)?Kt.then(function(Wt){H.handleTransmuxComplete(Wt)}):this.handleTransmuxComplete(Kt)}},d.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(i){var s=i.flush(e);(0,Or.isPromise)(s)?s.then(function(r){t.handleFlushResult(r,e)}):this.handleFlushResult(s,e)}},d.handleFlushResult=function(e,t){var i=this;e.forEach(function(n){i.handleTransmuxComplete(n)}),this.onFlush(t)},d.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":_.logger[t.data.logType]&&_.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},d.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},d.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},v}(),ii=function(){function v(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var d=v.prototype;return d.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},d.poll=function(e,t){var i=this.config,n=this.media,s=this.stalled;if(n!==null){var r=n.currentTime,a=n.seeking,l=this.seeking&&!a,f=!this.seeking&&a;if(this.seeking=a,r===e){if((f||l)&&(this.stalled=null),!(n.paused&&!a||n.ended||n.playbackRate===0)&&Be.getBuffered(n).length){var E=Be.bufferInfo(n,r,0),D=E.len>0,F=E.nextStart||0;if(D||F){if(a){var H=E.len>2,X=!F||t&&t.start<=r||F-r>2&&!this.fragmentTracker.getPartialFragment(r);if(H||X)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var me,ge=Math.max(F,E.start||0)-r,Ke=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,He=!(Ke==null||(me=Ke.details)===null||me===void 0)&&me.live?2*Ke.details.targetduration:2;if(ge>0&&ge<=He)return void this._trySkipBufferHole(null)}var Me=self.performance.now();if(s!==null){var je=Me-s;if(a||!(je>=250)||(this._reportStall(E),this.media)){var Xe=Be.bufferInfo(n,r,i.maxBufferHole);this._tryFixBufferStall(Xe,je)}}else this.stalled=Me}}}else if(this.moved=!0,s!==null){if(this.stallReported){var Ue=self.performance.now()-s;_.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(Ue)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},d._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,s=this.media;if(s!==null){var r=s.currentTime,a=n.getPartialFragment(r);if(a&&(this._trySkipBufferHole(a)||!this.media))return;e.len>i.maxBufferHole&&t>1e3*i.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},d._reportStall=function(e){var t=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,_.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},d._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(n===null)return 0;for(var s=n.currentTime,r=0,a=Be.getBuffered(n),l=0;l<a.length;l++){var f=a.start(l);if(s+t.maxBufferHole>=r&&s<f){var E=Math.max(f+.05,n.currentTime+.1);return _.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+E),this.moved=!0,this.stalled=null,n.currentTime=E,e&&i.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+E,frag:e}),E}r=a.end(l)}return 0},d._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(i!==null){var s=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var r=s+(n+1)*e.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+s+" to "+r),i.currentTime=r,t.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+s+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},v}();function gi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function Pr(v,d){return Pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pr(v,d)}var Ci=function(v){var d,e;function t(r,a){var l;return(l=v.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,l.gapController=null,l.level=-1,l._forceStartLoad=!1,l.altAudio=!1,l.audioOnly=!1,l.fragPlaying=null,l.onvplaying=null,l.onvseeked=null,l.fragLastKbps=0,l.couldBacktrack=!1,l.backtrackFragment=null,l.audioCodecSwitch=!1,l.videoBuffer=null,l._registerListeners(),l}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Pr(d,e);var i,n,s=t.prototype;return s._registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(c.Events.ERROR,this.onError,this),r.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(c.Events.ERROR,this.onError,this),r.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},s.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var f=l.startLevel;f===-1&&(l.config.testBandwidth&&this.levels.length>1?(f=0,this.bitrateTest=!0):f=l.nextAutoLevel),this.level=l.nextLoadLevel=f,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=mt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=Pt},s.stopLoad=function(){this._forceStartLoad=!1,v.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case mt:this.doTickIdle();break;case gr:var r,a=this.levels,l=this.level,f=a==null||(r=a[l])===null||r===void 0?void 0:r.details;if(f&&(!f.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(f))break;this.state=mt;break}break;case zt:var E,D=self.performance.now(),F=this.retryDate;(!F||D>=F||(E=this.media)!==null&&E!==void 0&&E.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=mt)}this.onTickEnd()},s.onTickEnd=function(){v.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},s.doTickIdle=function(){var r,a,l=this.hls,f=this.levelLastLoaded,E=this.levels,D=this.media,F=l.config,H=l.nextLoadLevel;if(f!==null&&(D||!this.startFragRequested&&F.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&E&&E[H]){var X=E[H];this.level=l.nextLoadLevel=H;var me=X.details;if(!me||this.state===gr||me.live&&this.levelLastLoaded!==H)this.state=gr;else{var ge=this.getMainFwdBufferInfo();if(ge!==null&&!(ge.len>=this.getMaxBufferLength(X.maxBitrate))){if(this._streamEnded(ge,me)){var Ke={};return this.altAudio&&(Ke.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,Ke),void(this.state=yr)}this.backtrackFragment&&this.backtrackFragment.start>ge.end&&(this.backtrackFragment=null);var He=this.backtrackFragment?this.backtrackFragment.start:ge.end,Me=this.getNextFragment(He,me);if(this.couldBacktrack&&!this.fragPrevious&&Me&&Me.sn!=="initSegment"&&this.fragmentTracker.getState(Me)!==x.OK){var je,Xe=((je=this.backtrackFragment)!=null?je:Me).sn-me.startSN,Ue=me.fragments[Xe-1];Ue&&Me.cc===Ue.cc&&(Me=Ue,this.fragmentTracker.removeFragment(Ue))}else this.backtrackFragment&&ge.len&&(this.backtrackFragment=null);if(Me&&this.fragmentTracker.getState(Me)===x.OK&&this.nextLoadPosition>He){var ut=this.audioOnly&&!this.altAudio?se.ElementaryStreamTypes.AUDIO:se.ElementaryStreamTypes.VIDEO;D&&this.afterBufferFlushed(D,ut,G.PlaylistLevelType.MAIN),Me=this.getNextFragment(this.nextLoadPosition,me)}Me&&(!Me.initSegment||Me.initSegment.data||this.bitrateTest||(Me=Me.initSegment),((r=Me.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=Me.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(Me,me,He):this.loadKey(Me,me))}}}},s.loadFragment=function(r,a,l){var f,E=this.fragmentTracker.getState(r);this.fragCurrent=r,E===x.NOT_LOADED?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,r,a,l)):E===x.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((f=this.media)===null||f===void 0?void 0:f.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},s.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,G.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},s.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,G.PlaylistLevelType.MAIN)},s.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},s.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var l,f=this.getAppendedFrag(a.currentTime);if(f&&f.start>1&&this.flushMainBuffer(0,f.start-1),!a.paused&&r){var E=r[this.hls.nextLoadLevel],D=this.fragLastKbps;l=D&&this.fragCurrent?this.fragCurrent.duration*E.maxBitrate/(1e3*D)+1:0}else l=0;var F=this.getBufferedFrag(a.currentTime+l);if(F){var H=this.followingBufferedFrag(F);if(H){this.abortCurrentFrag();var X=H.maxStartPTS?H.maxStartPTS:H.start,me=H.duration,ge=Math.max(F.end,X+Math.min(Math.max(me-this.config.maxFragLookUpTolerance,.5*me),.75*me));this.flushMainBuffer(ge,Number.POSITIVE_INFINITY)}}}},s.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r!=null&&r.loader&&r.loader.abort(),this.state){case Vt:case bt:case zt:case jt:case cr:this.state=mt}this.nextLoadPosition=this.getLoadPosition()},s.flushMainBuffer=function(r,a){v.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},s.onMediaAttached=function(r,a){v.prototype.onMediaAttached.call(this,r,a);var l=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),l.addEventListener("playing",this.onvplaying),l.addEventListener("seeked",this.onvseeked),this.gapController=new ii(this.config,l,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var r=this.media;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),v.prototype.onMediaDetaching.call(this)},s.onMediaPlaying=function(){this.tick()},s.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;(0,U.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},s.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},s.onManifestParsed=function(r,a){var l,f,E,D=!1,F=!1;a.levels.forEach(function(H){(l=H.audioCodec)&&(l.indexOf("mp4a.40.2")!==-1&&(D=!0),l.indexOf("mp4a.40.5")!==-1&&(F=!0))}),this.audioCodecSwitch=D&&F&&typeof((E=Br())==null||(f=E.prototype)===null||f===void 0?void 0:f.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},s.onLevelLoading=function(r,a){var l=this.levels;if(l&&this.state===mt){var f=l[a.level];(!f.details||f.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(f.details))&&(this.state=gr)}},s.onLevelLoaded=function(r,a){var l,f=this.levels,E=a.level,D=a.details,F=D.totalduration;if(f){this.log("Level "+E+" loaded ["+D.startSN+","+D.endSN+"], cc ["+D.startCC+", "+D.endCC+"] duration:"+F);var H=this.fragCurrent;!H||this.state!==bt&&this.state!==zt||H.level!==a.level&&H.loader&&(this.state=mt,this.backtrackFragment=null,H.loader.abort());var X=f[E],me=0;if(D.live||(l=X.details)!==null&&l!==void 0&&l.live){if(D.fragments[0]||(D.deltaUpdateFailed=!0),D.deltaUpdateFailed)return;me=this.alignPlaylists(D,X.details)}if(X.details=D,this.levelLastLoaded=E,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:D,level:E}),this.state===gr){if(this.waitForCdnTuneIn(D))return;this.state=mt}this.startFragRequested?D.live&&this.synchronizeToLiveEdge(D):this.setStartPosition(D,me),this.tick()}else this.warn("Levels were reset while loading level "+E)},s._handleFragmentLoadProgress=function(r){var a,l=r.frag,f=r.part,E=r.payload,D=this.levels;if(D){var F=D[l.level],H=F.details;if(H){var X=F.videoCodec,me=H.PTSKnown||!H.live,ge=(a=l.initSegment)===null||a===void 0?void 0:a.data,Ke=this._getAudioCodec(F),He=this.transmuxer=this.transmuxer||new wr(this.hls,G.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Me=f?f.index:-1,je=Me!==-1,Xe=new rt(l.level,l.sn,l.stats.chunkCount,E.byteLength,Me,je),Ue=this.initPTS[l.cc];He.push(E,ge,Ke,X,l,f,H.totalduration,me,Xe,Ue)}else this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered")},s.onAudioTrackSwitching=function(r,a){var l=this.altAudio,f=!!a.url,E=a.id;if(!f){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var D=this.fragCurrent;D!=null&&D.loader&&(this.log("Switching to main audio track, cancel main fragment load"),D.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var F=this.hls;l&&F.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),F.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:E})}},s.onAudioTrackSwitched=function(r,a){var l=a.id,f=!!this.hls.audioTracks[l].url;if(f){var E=this.videoBuffer;E&&this.mediaBuffer!==E&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=E)}this.altAudio=f,this.tick()},s.onBufferCreated=function(r,a){var l,f,E=a.tracks,D=!1;for(var F in E){var H=E[F];if(H.id==="main"){if(f=F,l=H,F==="video"){var X=E[F];X&&(this.videoBuffer=X.buffer)}}else D=!0}D&&l?(this.log("Alternate track found, use "+f+".buffered to schedule main fragment loading"),this.mediaBuffer=l.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(r,a){var l=a.frag,f=a.part;if(!l||l.type===G.PlaylistLevelType.MAIN){if(this.fragContextChanged(l))return this.warn("Fragment "+l.sn+(f?" p: "+f.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===cr&&(this.state=mt));var E=f?f.stats:l.stats;this.fragLastKbps=Math.round(8*E.total/(E.buffering.end-E.loading.first)),l.sn!=="initSegment"&&(this.fragPrevious=l),this.fragBufferedComplete(l,f)}},s.onError=function(r,a){switch(a.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.PlaylistLevelType.MAIN,a);break;case M.ErrorDetails.LEVEL_LOAD_ERROR:case M.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==mr&&(a.fatal?(this.warn(""+a.details),this.state=mr):a.levelRetry||this.state!==gr||(this.state=mt));break;case M.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===jt||this.state===cr)){var l=!0,f=this.getFwdBufferInfo(this.media,G.PlaylistLevelType.MAIN);f&&f.len>.5&&(l=!this.reduceMaxBufferLength(f.len)),l&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},s.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){if(this.loadedmetadata||!Be.getBuffered(r).length){var l=this.state!==mt?this.fragCurrent:null;a.poll(this.lastCurrentTime,l)}this.lastCurrentTime=r.currentTime}},s.onFragLoadEmergencyAborted=function(){this.state=mt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},s.onBufferFlushed=function(r,a){var l=a.type;if(l!==se.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var f=(l===se.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(f,l,G.PlaylistLevelType.MAIN)}},s.onLevelsUpdated=function(r,a){this.levels=a.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s.seekToStartPos=function(){var r=this.media;if(r){var a=r.currentTime,l=this.startPosition;if(l>=0&&a<l){if(r.seeking)return void this.log("could not seek to "+l+", already seeking at "+a);var f=Be.getBuffered(r),E=(f.length?f.start(0):0)-l;E>0&&(E<this.config.maxBufferHole||E<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+E+" to match buffer start"),l+=E,this.startPosition=l),this.log("seek to target start position "+l+" from current time "+a),r.currentTime=l}}},s._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},s._loadBitrateTestFrag=function(r){var a=this;r.bitrateTest=!0,this._doFragLoad(r).then(function(l){var f=a.hls;if(l&&!f.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=mt,a.startFragRequested=!1,a.bitrateTest=!1;var E=r.stats;E.parsing.start=E.parsing.end=E.buffering.start=E.buffering.end=self.performance.now(),f.trigger(c.Events.FRAG_LOADED,l),r.bitrateTest=!1}})},s._handleTransmuxComplete=function(r){var a,l="main",f=this.hls,E=r.remuxResult,D=r.chunkMeta,F=this.getCurrentContext(D);if(!F)return this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(D.level);var H=F.frag,X=F.part,me=F.level,ge=E.video,Ke=E.text,He=E.id3,Me=E.initSegment,je=me.details,Xe=this.altAudio?void 0:E.audio;if(!this.fragContextChanged(H)){if(this.state=jt,Me){Me.tracks&&(this._bufferInitSegment(me,Me.tracks,H,D),f.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:H,id:l,tracks:Me.tracks}));var Ue=Me.initPTS,ut=Me.timescale;(0,U.isFiniteNumber)(Ue)&&(this.initPTS[H.cc]=Ue,f.trigger(c.Events.INIT_PTS_FOUND,{frag:H,id:l,initPTS:Ue,timescale:ut}))}if(ge&&E.independent!==!1){if(je){var tt=ge.startPTS,Dt=ge.endPTS,kt=ge.startDTS,Yt=ge.endDTS;if(X)X.elementaryStreams[ge.type]={startPTS:tt,endPTS:Dt,startDTS:kt,endDTS:Yt};else if(ge.firstKeyFrame&&ge.independent&&(this.couldBacktrack=!0),ge.dropped&&ge.independent){var er=this.getMainFwdBufferInfo();if((er?er.end:this.getLoadPosition())+this.config.maxBufferHole<(ge.firstKeyFramePTS?ge.firstKeyFramePTS:tt)-this.config.maxBufferHole)return void this.backtrack(H);H.setElementaryStreamInfo(ge.type,H.start,Dt,H.start,Yt,!0)}H.setElementaryStreamInfo(ge.type,tt,Dt,kt,Yt),this.backtrackFragment&&(this.backtrackFragment=H),this.bufferFragmentData(ge,H,X,D)}}else if(E.independent===!1)return void this.backtrack(H);if(Xe){var Kt=Xe.startPTS,Wt=Xe.endPTS,ar=Xe.startDTS,Tr=Xe.endDTS;X&&(X.elementaryStreams[se.ElementaryStreamTypes.AUDIO]={startPTS:Kt,endPTS:Wt,startDTS:ar,endDTS:Tr}),H.setElementaryStreamInfo(se.ElementaryStreamTypes.AUDIO,Kt,Wt,ar,Tr),this.bufferFragmentData(Xe,H,X,D)}if(je&&He!=null&&(a=He.samples)!==null&&a!==void 0&&a.length){var Ir={id:l,frag:H,details:je,samples:He.samples};f.trigger(c.Events.FRAG_PARSING_METADATA,Ir)}if(je&&Ke){var fr={id:l,frag:H,details:je,samples:Ke.samples};f.trigger(c.Events.FRAG_PARSING_USERDATA,fr)}}},s._bufferInitSegment=function(r,a,l,f){var E=this;if(this.state===jt){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var D=a.audio,F=a.video,H=a.audiovideo;if(D){var X=r.audioCodec,me=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(X&&(X=X.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),D.metadata.channelCount!==1&&me.indexOf("firefox")===-1&&(X="mp4a.40.5")),me.indexOf("android")!==-1&&D.container!=="audio/mpeg"&&(X="mp4a.40.2",this.log("Android: force audio codec to "+X)),r.audioCodec&&r.audioCodec!==X&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+X+'"'),D.levelCodec=X,D.id="main",this.log("Init audio buffer, container:"+D.container+", codecs[selected/level/parsed]=["+(X||"")+"/"+(r.audioCodec||"")+"/"+D.codec+"]")}F&&(F.levelCodec=r.videoCodec,F.id="main",this.log("Init video buffer, container:"+F.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+F.codec+"]")),H&&this.log("Init audiovideo buffer, container:"+H.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+H.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(ge){var Ke=a[ge].initSegment;Ke!=null&&Ke.byteLength&&E.hls.trigger(c.Events.BUFFER_APPENDING,{type:ge,data:Ke,frag:l,part:null,chunkMeta:f,parent:l.type})}),this.tick()}},s.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.PlaylistLevelType.MAIN)},s.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=mt},s.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var l=r.currentTime;if(Be.isBuffered(r,l)?a=this.getAppendedFrag(l):Be.isBuffered(r,l+.1)&&(a=this.getAppendedFrag(l+.1)),a){this.backtrackFragment=null;var f=this.fragPlaying,E=a.level;f&&a.sn===f.sn&&f.level===E&&a.urlId===f.urlId||(this.hls.trigger(c.Events.FRAG_CHANGED,{frag:a}),f&&f.level===E||this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:E}),this.fragPlaying=a)}}},i=t,(n=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var a=r.currentTime,l=this.currentFrag;if(l&&(0,U.isFiniteNumber)(a)&&(0,U.isFiniteNumber)(l.programDateTime)){var f=l.programDateTime+1e3*(a-l.start);return new Date(f)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&gi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ar);const ni=function(){function v(e,t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var d=v.prototype;return d.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},d.getTotalWeight=function(){return this.totalWeight_},d.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},v}(),Oi=function(){function v(e,t,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ni(e),this.fast_=new ni(t)}var d=v.prototype;return d.update=function(e,t){var i=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new ni(e,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new ni(t,n.getEstimate(),n.getTotalWeight()))},d.sample=function(e,t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},d.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},d.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},d.destroy=function(){},v}();function Li(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}const vi=function(){function v(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var n=i.config;this.bwEstimator=new Oi(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var d,e,t=v.prototype;return t.registerListeners=function(){var i=this.hls;i.on(c.Events.FRAG_LOADING,this.onFragLoading,this),i.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(c.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var i=this.hls;i.off(c.Events.FRAG_LOADING,this.onFragLoading,this),i.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(c.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(i,n){var s,r=n.frag;r.type===G.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=(s=n.part)!=null?s:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(i,n){var s=this.hls.config;n.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.autoLevelEnabled,a=(s.config,s.media);if(i&&a){var l=n?n.stats:i.stats,f=n?n.duration:i.duration;if(l.aborted||l.loaded&&l.loaded===l.total||i.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!a.paused&&a.playbackRate&&a.readyState){var E=s.mainForwardBufferInfo;if(E!==null){var D=performance.now()-l.loading.start,F=Math.abs(a.playbackRate);if(!(D<=500*f/F)){var H=l.loaded&&l.loading.first,X=this.bwEstimator.getEstimate(),me=s.levels,ge=s.minAutoLevel,Ke=me[i.level],He=l.total||Math.max(l.loaded,Math.round(f*Ke.maxBitrate/8)),Me=H?1e3*l.loaded/D:0,je=Me?(He-l.loaded)/Me:8*He/X,Xe=E.len/F;if(!(je<=Xe)){var Ue,ut=Number.POSITIVE_INFINITY;for(Ue=i.level-1;Ue>ge;Ue--){var tt=me[Ue].maxBitrate;if((ut=Me?f*tt/(6.4*Me):f*tt/X)<Xe)break}ut>=je||(_.logger.warn("Fragment "+i.sn+(n?" part "+n.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Ue+`
      Current BW estimate: `+((0,U.isFiniteNumber)(X)?(X/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+je.toFixed(3)+` s
      Estimated load time for the next fragment: `+ut.toFixed(3)+` s
      Time to underbuffer: `+Xe.toFixed(3)+" s"),s.nextLoadLevel=Ue,H&&this.bwEstimator.sample(D,l.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),s.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:l}))}}}}}},t.onFragLoaded=function(i,n){var s=n.frag,r=n.part;if(s.type===G.PlaylistLevelType.MAIN&&(0,U.isFiniteNumber)(s.sn)){var a=r?r.stats:s.stats,l=r?r.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var f=this.hls.levels[s.level],E=(f.loaded?f.loaded.bytes:0)+a.loaded,D=(f.loaded?f.loaded.duration:0)+l;f.loaded={bytes:E,duration:D},f.realBitrate=Math.round(8*E/D)}if(s.bitrateTest){var F={stats:a,frag:s,part:r,id:s.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,F)}}},t.onFragBuffered=function(i,n){var s=n.frag,r=n.part,a=r?r.stats:s.stats;if(!a.aborted&&s.type===G.PlaylistLevelType.MAIN&&s.sn!=="initSegment"){var l=a.parsing.end-a.loading.start;this.bwEstimator.sample(l,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},t.onError=function(i,n){switch(n.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.maxAutoLevel,a=s.config,l=s.minAutoLevel,f=s.media,E=n?n.duration:i?i.duration:0,D=(f&&f.currentTime,f&&f.playbackRate!==0?Math.abs(f.playbackRate):1),F=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,H=s.mainForwardBufferInfo,X=(H?H.len:0)/D,me=this.findBestLevel(F,l,r,X,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(me>=0)return me;_.logger.trace((X?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var ge=E?Math.min(E,a.maxStarvationDelay):a.maxStarvationDelay,Ke=a.abrBandWidthFactor,He=a.abrBandWidthUpFactor;if(!X){var Me=this.bitrateTestDelay;Me&&(ge=(E?Math.min(E,a.maxLoadingDelay):a.maxLoadingDelay)-Me,_.logger.trace("bitrate test took "+Math.round(1e3*Me)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*ge)+" ms"),Ke=He=1)}return me=this.findBestLevel(F,l,r,X+ge,Ke,He),Math.max(me,0)},t.findBestLevel=function(i,n,s,r,a,l){for(var f,E=this.fragCurrent,D=this.partCurrent,F=this.lastLoadedFragLevel,H=this.hls.levels,X=H[F],me=!(X==null||(f=X.details)===null||f===void 0||!f.live),ge=X==null?void 0:X.codecSet,Ke=D?D.duration:E?E.duration:0,He=s;He>=n;He--){var Me=H[He];if(Me&&(!ge||Me.codecSet===ge)){var je,Xe=Me.details,Ue=(D?Xe==null?void 0:Xe.partTarget:Xe==null?void 0:Xe.averagetargetduration)||Ke;je=He<=F?a*i:l*i;var ut=H[He].maxBitrate,tt=ut*Ue/je;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+He+"/"+Math.round(je)+"/"+ut+"/"+Ue+"/"+r+"/"+tt),je>ut&&(tt===0||!(0,U.isFiniteNumber)(tt)||me&&!this.bitrateTestDelay||tt<r))return He}}return-1},d=v,(e=[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,n=this.bwEstimator;if(i!==-1&&!n.canEstimate())return i;var s=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[s].loadError?i:(i!==-1&&(s=Math.min(i,s)),s)},set:function(i){this._nextAutoLevel=i}}])&&Li(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();var pi=function(){function v(){this.chunks=[],this.dataLength=0}var d=v.prototype;return d.push=function(e){this.chunks.push(e),this.dataLength+=e.length},d.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=t.length===1?t[0]:function(n,s){for(var r=new Uint8Array(s),a=0,l=0;l<n.length;l++){var f=n[l];r.set(f,a),a+=f.length}return r}(t,i),this.reset(),e):new Uint8Array(0)},d.reset=function(){this.chunks.length=0,this.dataLength=0},v}();function Qr(){return Qr=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},Qr.apply(this,arguments)}function mi(v,d){return mi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mi(v,d)}var Di=function(v){var d,e;function t(n,s){var r;return(r=v.call(this,n,s,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,mi(d,e);var i=t.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var n=this.hls;n.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(c.Events.ERROR,this.onError,this),n.on(c.Events.BUFFER_RESET,this.onBufferReset,this),n.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var n=this.hls;n.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(c.Events.ERROR,this.onError,this),n.off(c.Events.BUFFER_RESET,this.onBufferReset,this),n.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(n,s){var r=s.frag,a=s.id,l=s.initPTS;if(a==="main"){var f=r.cc;this.initPTS[r.cc]=l,this.log("InitPTS for cc: "+f+" found from main: "+l),this.videoTrackCC=f,this.state===ir&&this.tick()}},i.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=Pt);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),n=s,this.state=mt):(this.loadedmetadata=!1,this.state=dr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},i.doTick=function(){switch(this.state){case mt:this.doTickIdle();break;case dr:var n,s=this.levels,r=this.trackId,a=s==null||(n=s[r])===null||n===void 0?void 0:n.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=ir}break;case zt:var l,f=performance.now(),E=this.retryDate;(!E||f>=E||(l=this.media)!==null&&l!==void 0&&l.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=mt);break;case ir:var D=this.waitingData;if(D){var F=D.frag,H=D.part,X=D.cache,me=D.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=bt;var ge={frag:F,part:H,payload:X.flush(),networkDetails:null};this._handleFragmentLoadProgress(ge),me&&v.prototype._handleFragmentLoadComplete.call(this,ge)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Ke=this.getLoadPosition(),He=Be.bufferInfo(this.mediaBuffer,Ke,this.config.maxBufferHole);O(He.end,this.config.maxFragLookUpTolerance,F)<0&&(this.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+He.end+" is needed"),this.clearWaitingFragment())}}else this.state=mt}this.onTickEnd()},i.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=mt)},i.resetLoadingState=function(){this.clearWaitingFragment(),v.prototype.resetLoadingState.call(this)},i.onTickEnd=function(){var n=this.media;n&&n.readyState&&(this.lastCurrentTime=n.currentTime)},i.doTickIdle=function(){var n,s,r=this.hls,a=this.levels,l=this.media,f=this.trackId,E=r.config;if(a&&a[f]&&(l||!this.startFragRequested&&E.startFragPrefetch)){var D=a[f].details;if(!D||D.live&&this.levelLastLoaded!==f||this.waitForCdnTuneIn(D))this.state=dr;else{var F=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&F&&(this.bufferFlushed=!1,this.afterBufferFlushed(F,se.ElementaryStreamTypes.AUDIO,G.PlaylistLevelType.AUDIO));var H=this.getFwdBufferInfo(F,G.PlaylistLevelType.AUDIO);if(H!==null){var X=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,G.PlaylistLevelType.MAIN),me=H.len,ge=this.getMaxBufferLength(X==null?void 0:X.len),Ke=this.audioSwitch;if(!(me>=ge)||Ke){if(!Ke&&this._streamEnded(H,D))return r.trigger(c.Events.BUFFER_EOS,{type:"audio"}),void(this.state=yr);var He=D.fragments[0].start,Me=H.end;if(Ke&&l){var je=this.getLoadPosition();Me=je,D.PTSKnown&&je<He&&(H.end>He||H.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),l.currentTime=He+.05)}if(!(X&&Me>X.end+D.targetduration)&&(X&&X.len||!H.len)){var Xe=this.getNextFragment(Me,D);Xe?((n=Xe.decryptdata)===null||n===void 0?void 0:n.keyFormat)!=="identity"||(s=Xe.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(Xe,D,Me):this.loadKey(Xe,D):this.bufferFlushed=!0}}}}}},i.getMaxBufferLength=function(n){var s=v.prototype.getMaxBufferLength.call(this);return n?Math.max(s,n):s},i.onMediaDetaching=function(){this.videoBuffer=null,v.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(n,s){var r=s.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(a){return new Gt(a)})},i.onAudioTrackSwitching=function(n,s){var r=!!s.url;this.trackId=s.id;var a=this.fragCurrent;a!=null&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=mt):this.state=Pt,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(n,s){this.mainDetails=s.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(n,s){var r;if(this.mainDetails!=null){var a=this.levels,l=s.details,f=s.id;if(a){this.log("Track "+f+" loaded ["+l.startSN+","+l.endSN+"],duration:"+l.totalduration);var E=a[f],D=0;if(l.live||(r=E.details)!==null&&r!==void 0&&r.live){var F=this.mainDetails;if(l.fragments[0]||(l.deltaUpdateFailed=!0),l.deltaUpdateFailed||!F)return;!E.details&&l.hasProgramDateTime&&F.hasProgramDateTime?(I(l,F),D=l.fragments[0].start):D=this.alignPlaylists(l,E.details)}E.details=l,this.levelLastLoaded=f,this.startFragRequested||!this.mainDetails&&l.live||this.setStartPosition(E.details,D),this.state!==dr||this.waitForCdnTuneIn(l)||(this.state=mt),this.tick()}else this.warn("Audio tracks were reset while loading level "+f)}else this.cachedTrackLoadedData=s},i._handleFragmentLoadProgress=function(n){var s,r=n.frag,a=n.part,l=n.payload,f=this.config,E=this.trackId,D=this.levels;if(D){var F=D[E],H=F.details,X=f.defaultAudioCodec||F.audioCodec||"mp4a.40.2",me=this.transmuxer;me||(me=this.transmuxer=new wr(this.hls,G.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var ge=this.initPTS[r.cc],Ke=(s=r.initSegment)===null||s===void 0?void 0:s.data;if(ge!==void 0){var He=a?a.index:-1,Me=He!==-1,je=new rt(r.level,r.sn,r.stats.chunkCount,l.byteLength,He,Me);me.push(l,Ke,X,"",r,a,H.totalduration,!1,je,ge)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+H.startSN+" ,"+H.endSN+"],track "+E),(this.waitingData=this.waitingData||{frag:r,part:a,cache:new pi,complete:!1}).cache.push(new Uint8Array(l)),this.waitingVideoCC=this.videoTrackCC,this.state=ir}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:v.prototype._handleFragmentLoadComplete.call(this,n)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(n,s){var r=s.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer||null)},i.onFragBuffered=function(n,s){var r,a=s.frag,l=s.part;a.type===G.PlaylistLevelType.AUDIO?this.fragContextChanged(a)?this.warn("Fragment "+a.sn+(l?" p: "+l.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,l)):this.loadedmetadata||a.type!==G.PlaylistLevelType.MAIN||(r=this.videoBuffer||this.media)!==null&&r!==void 0&&r.buffered.length&&(this.loadedmetadata=!0)},i.onError=function(n,s){switch(s.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.PlaylistLevelType.AUDIO,s);break;case M.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case M.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==mr&&this.state!==Pt&&(this.state=s.fatal?mr:mt,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case M.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===jt||this.state===cr)){var r=!0,a=this.getFwdBufferInfo(this.mediaBuffer,G.PlaylistLevelType.AUDIO);a&&a.len>.5&&(r=!this.reduceMaxBufferLength(a.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},i.onBufferFlushed=function(n,s){s.type===se.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},i._handleTransmuxComplete=function(n){var s,r="audio",a=this.hls,l=n.remuxResult,f=n.chunkMeta,E=this.getCurrentContext(f);if(!E)return this.warn("The loading context changed while buffering fragment "+f.sn+" of level "+f.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(f.level);var D=E.frag,F=E.part,H=E.level.details,X=l.audio,me=l.text,ge=l.id3,Ke=l.initSegment;if(!this.fragContextChanged(D)&&H){if(this.state=jt,this.audioSwitch&&X&&this.completeAudioSwitch(),Ke!=null&&Ke.tracks&&(this._bufferInitSegment(Ke.tracks,D,f),a.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:r,tracks:Ke.tracks})),X){var He=X.startPTS,Me=X.endPTS,je=X.startDTS,Xe=X.endDTS;F&&(F.elementaryStreams[se.ElementaryStreamTypes.AUDIO]={startPTS:He,endPTS:Me,startDTS:je,endDTS:Xe}),D.setElementaryStreamInfo(se.ElementaryStreamTypes.AUDIO,He,Me,je,Xe),this.bufferFragmentData(X,D,F,f)}if(ge!=null&&(s=ge.samples)!==null&&s!==void 0&&s.length){var Ue=Qr({id:r,frag:D,details:H},ge);a.trigger(c.Events.FRAG_PARSING_METADATA,Ue)}if(me){var ut=Qr({id:r,frag:D,details:H},me);a.trigger(c.Events.FRAG_PARSING_USERDATA,ut)}}},i._bufferInitSegment=function(n,s,r){if(this.state===jt){n.video&&delete n.video;var a=n.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,n);var l=a.initSegment;if(l!=null&&l.byteLength){var f={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:l};this.hls.trigger(c.Events.BUFFER_APPENDING,f)}this.tick()}}},i.loadFragment=function(n,s,r){var a=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||a===x.NOT_LOADED||a===x.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):s.live&&!(0,U.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=ir):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,n,s,r)))},i.completeAudioSwitch=function(){var n=this.hls,s=this.media,r=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:r})},t}(Ar);const Ai=Di;function yi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ai(v,d){return ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ai(v,d)}const Dr=function(v){var d,e;function t(r){var a;return(a=v.call(this,r,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ai(d,e);var i,n,s=t.prototype;return s.registerListeners=function(){var r=this.hls;r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(c.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(c.Events.ERROR,this.onError,this)},s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,v.prototype.destroy.call(this)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.audioTracks||[]},s.onAudioTrackLoaded=function(r,a){var l=a.id,f=a.details,E=this.tracksInGroup[l];if(E){var D=E.details;E.details=a.details,this.log("audioTrack "+l+" loaded ["+f.startSN+"-"+f.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,a,D))}else this.warn("Invalid audio track id "+l)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.audioGroupIds){var l=a.audioGroupIds[a.urlId];if(this.groupId!==l){this.groupId=l;var f=this.tracks.filter(function(D){return!l||D.groupId===l});this.selectDefaultTrack&&!f.some(function(D){return D.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=f;var E={audioTracks:f};this.log("Updating audio tracks, "+f.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(c.Events.AUDIO_TRACKS_UPDATED,E),this.selectInitialTrack()}}},s.onError=function(r,a){v.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===G.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.setAudioTrack=function(r){var a=this.tracksInGroup;if(r<0||r>=a.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var l=a[this.trackId];this.log("Now switching to audio-track index "+r);var f=a[r],E=f.id,D=f.groupId,F=D===void 0?"":D,H=f.name,X=f.type,me=f.url;if(this.trackId=r,this.trackName=H,this.selectDefaultTrack=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHING,{id:E,groupId:F,name:H,type:X,url:me}),!f.details||f.details.live){var ge=this.switchParams(f.url,l==null?void 0:l.details);this.loadPlaylist(ge)}}},s.selectInitialTrack=function(){this.tracksInGroup;var r=this.trackName,a=this.findTrackId(r)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},s.findTrackId=function(r){for(var a=this.tracksInGroup,l=0;l<a.length;l++){var f=a[l];if((!this.selectDefaultTrack||f.default)&&(!r||r===f.name))return f.id}return-1},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var l=a.id,f=a.groupId,E=a.url;if(r)try{E=r.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("loading audio-track playlist for id: "+l),this.clearTimer(),this.hls.trigger(c.Events.AUDIO_TRACK_LOADING,{url:E,id:l,groupId:f,deliveryDirectives:r||null})}},i=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}])&&yi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Xt);function Ei(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ei(v,d){return ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ei(v,d)}var Pi=function(v){var d,e;function t(r,a){var l;return(l=v.call(this,r,a,"[subtitle-stream-controller]")||this).levels=[],l.currentTrackId=-1,l.tracksBuffered=[],l.mainDetails=null,l._registerListeners(),l}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ei(d,e);var i,n,s=t.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.ERROR,this.onError,this),r.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(c.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.ERROR,this.onError,this),r.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(c.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.startLoad=function(r){this.stopLoad(),this.state=mt,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(r,a){this.mainDetails=a.details},s.onSubtitleFragProcessed=function(r,a){var l=a.frag,f=a.success;if(this.fragPrevious=l,this.state=mt,f){var E=this.tracksBuffered[this.currentTrackId];if(E){for(var D,F=l.start,H=0;H<E.length;H++)if(F>=E[H].start&&F<=E[H].end){D=E[H];break}var X=l.start+l.duration;D?D.end=X:(D={start:F,end:X},E.push(D)),this.fragmentTracker.fragBuffered(l)}}},s.onBufferFlushing=function(r,a){var l=a.startOffset,f=a.endOffset;if(l===0&&f!==Number.POSITIVE_INFINITY){var E=this.currentTrackId,D=this.levels;if(!D.length||!D[E]||!D[E].details)return;var F=f-D[E].details.targetduration;if(F<=0)return;a.endOffsetSubtitles=Math.max(0,F),this.tracksBuffered.forEach(function(H){for(var X=0;X<H.length;)if(H[X].end<=F)H.shift();else{if(!(H[X].start<F))break;H[X].start=F,X++}}),this.fragmentTracker.removeFragmentsInRange(l,F,G.PlaylistLevelType.SUBTITLE)}},s.onFragBuffered=function(r,a){var l;this.loadedmetadata||a.frag.type!==G.PlaylistLevelType.MAIN||(l=this.media)!==null&&l!==void 0&&l.buffered.length&&(this.loadedmetadata=!0)},s.onError=function(r,a){var l,f=a.frag;f&&f.type===G.PlaylistLevelType.SUBTITLE&&((l=this.fragCurrent)!==null&&l!==void 0&&l.loader&&this.fragCurrent.loader.abort(),this.state=mt)},s.onSubtitleTracksUpdated=function(r,a){var l=this,f=a.subtitleTracks;this.tracksBuffered=[],this.levels=f.map(function(E){return new Gt(E)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(E){l.tracksBuffered[E.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(r,a){if(this.currentTrackId=a.id,this.levels.length&&this.currentTrackId!==-1){var l=this.levels[this.currentTrackId];l!=null&&l.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,l&&this.setInterval(500)}else this.clearInterval()},s.onSubtitleTrackLoaded=function(r,a){var l,f=a.details,E=a.id,D=this.currentTrackId,F=this.levels;if(F.length){var H=F[D];if(!(E>=F.length||E!==D)&&H){this.mediaBuffer=this.mediaBufferTimeRanges;var X=0;if(f.live||(l=H.details)!==null&&l!==void 0&&l.live){var me=this.mainDetails;if(f.deltaUpdateFailed||!me)return;var ge=me.fragments[0];H.details?(X=this.alignPlaylists(f,H.details))===0&&ge&&hr(f,X=ge.start):f.hasProgramDateTime&&me.hasProgramDateTime?(I(f,me),X=f.fragments[0].start):ge&&hr(f,X=ge.start)}H.details=f,this.levelLastLoaded=E,this.startFragRequested||!this.mainDetails&&f.live||this.setStartPosition(H.details,X),this.tick(),f.live&&!this.fragCurrent&&this.media&&this.state===mt&&(C(null,f.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),H.details=void 0))}}},s._handleFragmentLoadComplete=function(r){var a=r.frag,l=r.payload,f=a.decryptdata,E=this.hls;if(!this.fragContextChanged(a)&&l&&l.byteLength>0&&f&&f.key&&f.iv&&f.method==="AES-128"){var D=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(l),f.key.buffer,f.iv.buffer).then(function(F){var H=performance.now();E.trigger(c.Events.FRAG_DECRYPTED,{frag:a,payload:F,stats:{tstart:D,tdecrypt:H}})})}},s.doTick=function(){if(this.media){if(this.state===mt){var r=this.currentTrackId,a=this.levels;if(!a.length||!a[r]||!a[r].details)return;var l=a[r].details,f=l.targetduration,E=this.config,D=this.getLoadPosition(),F=Be.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],D-f,E.maxBufferHole),H=F.end,X=F.len,me=this.getFwdBufferInfo(this.media,G.PlaylistLevelType.MAIN);if(X>this.getMaxBufferLength(me==null?void 0:me.len)+f)return;var ge,Ke=l.fragments,He=Ke.length,Me=l.edge,je=this.fragPrevious;if(H<Me){var Xe=E.maxFragLookUpTolerance;!(ge=C(je,Ke,Math.max(Ke[0].start,H),Xe))&&je&&je.start<Ke[0].start&&(ge=Ke[0])}else ge=Ke[He-1];if(!(ge=this.mapToInitFragWhenRequired(ge))||this.fragmentTracker.getState(ge)!==x.NOT_LOADED)return;ge.encrypted?this.loadKey(ge,l):this.loadFragment(ge,l,H)}}else this.state=mt},s.getMaxBufferLength=function(r){var a=v.prototype.getMaxBufferLength.call(this);return r?Math.max(a,r):a},s.loadFragment=function(r,a,l){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,r,a,l))},i=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return new Fi(this.tracksBuffered[this.currentTrackId]||[])}}])&&Ei(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ar),Fi=function(v){this.buffered=void 0;var d=function(e,t,i){if((t>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return v[t][e]};this.buffered={get length(){return v.length},end:function(e){return d("end",e,v.length)},start:function(e){return d("start",e,v.length)}}};function Mi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ti(v,d){return ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ti(v,d)}function si(v){for(var d=[],e=0;e<v.length;e++){var t=v[e];t.kind==="subtitles"&&t.label&&d.push(v[e])}return d}const Ni=function(v){var d,e;function t(r){var a;return(a=v.call(this,r,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a._subtitleDisplay=!0,a.registerListeners(),a}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ti(d,e);var i,n,s=t.prototype;return s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,v.prototype.destroy.call(this)},s.registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.Events.ERROR,this.onError,this)},s.onMediaAttached=function(r,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},s.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},s.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),si(this.media.textTracks).forEach(function(r){Ze(r)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.subtitleTracks},s.onSubtitleTrackLoaded=function(r,a){var l=a.id,f=a.details,E=this.trackId,D=this.tracksInGroup[E];if(D){var F=D.details;D.details=a.details,this.log("subtitle track "+l+" loaded ["+f.startSN+"-"+f.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,a,F))}else this.warn("Invalid subtitle track id "+l)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.textGroupIds){var l=a.textGroupIds[a.urlId];if(this.groupId!==l){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,E=this.tracks.filter(function(H){return!l||H.groupId===l});this.tracksInGroup=E;var D=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=l;var F={subtitleTracks:E};this.log("Updating subtitle tracks, "+E.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(c.Events.SUBTITLE_TRACKS_UPDATED,F),D!==-1&&this.setSubtitleTrack(D,f)}}},s.findTrackId=function(r){for(var a=this.tracksInGroup,l=0;l<a.length;l++){var f=a[l];if((!this.selectDefaultTrack||f.default)&&(!r||r===f.name))return f.id}return-1},s.onError=function(r,a){v.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===G.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var l=a.id,f=a.groupId,E=a.url;if(r)try{E=r.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADING,{url:E,id:l,groupId:f,deliveryDirectives:r||null})}},s.toggleTrackModes=function(r){var a=this,l=this.media,f=this.trackId;if(l){var E=si(l.textTracks),D=E.filter(function(X){return X.groupId===a.groupId});if(r===-1)[].slice.call(E).forEach(function(X){X.mode="disabled"});else{var F=D[f];F&&(F.mode="disabled")}var H=D[r];H&&(H.mode=this.subtitleDisplay?"showing":"hidden")}},s.setSubtitleTrack=function(r,a){var l,f=this.tracksInGroup;if(this.media){if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(l=f[r])!==null&&l!==void 0&&l.details)||r<-1||r>=f.length)){this.clearTimer();var E=f[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,E){var D=E.id,F=E.groupId,H=F===void 0?"":F,X=E.name,me=E.type,ge=E.url;this.hls.trigger(c.Events.SUBTITLE_TRACK_SWITCH,{id:D,groupId:H,name:X,type:me,url:ge});var Ke=this.switchParams(E.url,a==null?void 0:a.details);this.loadPlaylist(Ke)}else this.hls.trigger(c.Events.SUBTITLE_TRACK_SWITCH,{id:r})}}else this.queuedDefaultTrack=r},s.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var r=-1,a=si(this.media.textTracks),l=0;l<a.length;l++)if(a[l].mode==="hidden")r=l;else if(a[l].mode==="showing"){r=l;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},i=t,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,a)}}])&&Mi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Xt);var Ut,Ji=function(){function v(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var d=v.prototype;return d.append=function(e,t){var i=this.queues[t];i.push(e),i.length===1&&this.buffers[t]&&this.executeNext(t)},d.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},d.appendBlocker=function(e){var t,i=new Promise(function(s){t=s}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},d.executeNext=function(e){var t=this.buffers,i=this.queues,n=t[e],s=i[e];if(s.length){var r=s[0];try{r.execute()}catch(a){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(a),n&&n.updating||(s.shift(),this.executeNext(e))}}},d.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},d.current=function(e){return this.queues[e][0]},v}(),Ui=Rr(),Zi=/([ha]vc.)(?:\.[^.,]+)+/,an=function(){function v(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=t.hls,n=t.media,s=t.mediaSource;_.logger.log("[buffer-controller]: Media source opened"),n&&(t.updateMediaElementDuration(),i.trigger(c.Events.MEDIA_ATTACHED,{media:n})),s&&s.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){_.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){_.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var d=v.prototype;return d.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},d.destroy=function(){this.unregisterListeners(),this.details=null},d.registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(c.Events.BUFFER_RESET,this.onBufferReset,this),e.on(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(c.Events.BUFFER_EOS,this.onBufferEos,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(c.Events.FRAG_PARSED,this.onFragParsed,this),e.on(c.Events.FRAG_CHANGED,this.onFragChanged,this)},d.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(c.Events.BUFFER_RESET,this.onBufferReset,this),e.off(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(c.Events.BUFFER_EOS,this.onBufferEos,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(c.Events.FRAG_PARSED,this.onFragParsed,this),e.off(c.Events.FRAG_CHANGED,this.onFragChanged,this)},d._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Ji(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},d.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,_.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},d.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&Ui){var n=this.mediaSource=new Ui;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src}},d.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(_.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(n){_.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):_.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.Events.MEDIA_DETACHED,void 0)},d.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(n){_.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",n)}}),this._initSourceBuffer()},d.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(s){if(n){var r=i.tracks[s];if(r&&typeof r.buffer.changeType=="function"){var a=t[s],l=a.id,f=a.codec,E=a.levelCodec,D=a.container,F=a.metadata,H=(r.levelCodec||r.codec).replace(Zi,"$1"),X=(E||f).replace(Zi,"$1");if(H!==X){var me=D+";codecs="+(E||f);i.appendChangeType(s,me),_.logger.log("[buffer-controller]: switching codec "+H+" to "+X),i.tracks[s]={buffer:r.buffer,codec:f,container:D,levelCodec:E,metadata:F,id:l}}}}else i.pendingTracks[s]=t[s]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},d.appendChangeType=function(e,t){var i=this,n=this.operationQueue,s={execute:function(){var r=i.sourceBuffer[e];r&&(_.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(r){_.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",r)}};n.append(s,e)},d.onBufferAppending=function(e,t){var i=this,n=this.hls,s=this.operationQueue,r=this.tracks,a=t.data,l=t.type,f=t.frag,E=t.part,D=t.chunkMeta,F=D.buffering[l],H=self.performance.now();F.start=H;var X=f.stats.buffering,me=E?E.stats.buffering:null;X.start===0&&(X.start=H),me&&me.start===0&&(me.start=H);var ge=r.audio,Ke=l==="audio"&&D.id===1&&(ge==null?void 0:ge.container)==="audio/mpeg",He={execute:function(){if(F.executeStart=self.performance.now(),Ke){var Me=i.sourceBuffer[l];if(Me){var je=f.start-Me.timestampOffset;Math.abs(je)>=.1&&(_.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+je+") sn: "+f.sn+")"),Me.timestampOffset=f.start)}}i.appendExecutor(a,l)},onStart:function(){},onComplete:function(){var Me=self.performance.now();F.executeEnd=F.end=Me,X.first===0&&(X.first=Me),me&&me.first===0&&(me.first=Me);var je=i.sourceBuffer,Xe={};for(var Ue in je)Xe[Ue]=Be.getBuffered(je[Ue]);i.appendError=0,i.hls.trigger(c.Events.BUFFER_APPENDED,{type:l,frag:f,part:E,chunkMeta:D,parent:f.type,timeRanges:Xe})},onError:function(Me){_.logger.error("[buffer-controller]: Error encountered while trying to append to the "+l+" SourceBuffer",Me);var je={type:M.ErrorTypes.MEDIA_ERROR,parent:f.type,details:M.ErrorDetails.BUFFER_APPEND_ERROR,err:Me,fatal:!1};Me.code===DOMException.QUOTA_EXCEEDED_ERR?je.details=M.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,je.details=M.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(_.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),je.fatal=!0,n.stopLoad())),n.trigger(c.Events.ERROR,je)}};s.append(He,l)},d.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,s=function(r){return{execute:i.removeExecutor.bind(i,r,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(c.Events.BUFFER_FLUSHED,{type:r})},onError:function(a){_.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",a)}}};t.type?n.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(function(r){n.append(s(r),r)})},d.onFragParsed=function(e,t){var i=this,n=t.frag,s=t.part,r=[],a=s?s.elementaryStreams:n.elementaryStreams;a[se.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(a[se.ElementaryStreamTypes.AUDIO]&&r.push("audio"),a[se.ElementaryStreamTypes.VIDEO]&&r.push("video")),r.length===0&&_.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var l=self.performance.now();n.stats.buffering.end=l,s&&(s.stats.buffering.end=l);var f=s?s.stats:n.stats;i.hls.trigger(c.Events.FRAG_BUFFERED,{frag:n,part:s,stats:f,id:n.type})},r)},d.onFragChanged=function(e,t){this.flushBackBuffer()},d.onBufferEos=function(e,t){var i=this;this.getSourceBufferTypes().reduce(function(n,s){var r=i.sourceBuffer[s];return t.type&&t.type!==s||r&&!r.ended&&(r.ended=!0,_.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS")),n&&!(r&&!r.ended)},!0)&&this.blockBuffers(function(){var n=i.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},d.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},d.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,n=this.sourceBuffer;if(i&&t!==null){var s=this.getSourceBufferTypes();if(s.length){var r=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,U.isFiniteNumber)(r)&&!(r<0)){var a=i.currentTime,l=t.levelTargetDuration,f=Math.max(r,l),E=Math.floor(a/l)*l-f;s.forEach(function(D){var F=n[D];if(F){var H=Be.getBuffered(F);H.length>0&&E>H.start(0)&&(e.trigger(c.Events.BACK_BUFFER_REACHED,{bufferEnd:E}),t.live&&e.trigger(c.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:E}),e.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:E,type:D}))}})}}}},d.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,s=e.fragments[0].start+e.totalduration,r=i.duration,a=(0,U.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(_.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>r||!(0,U.isFiniteNumber)(r))&&(_.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},d.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){var n=Math.max(0,i[0].start),s=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,s)}},d.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!e||n===2){this.createSourceBuffers(i),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0)return void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach(function(r){t.executeNext(r)})}},d.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var s in e)if(!t[s]){var r=e[s];if(!r)throw Error("source buffer exists for track "+s+", however track does not");var a=r.levelCodec||r.codec,l=r.container+";codecs="+a;_.logger.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var f=t[s]=i.addSourceBuffer(l),E=s;this.addBufferListener(E,"updatestart",this._onSBUpdateStart),this.addBufferListener(E,"updateend",this._onSBUpdateEnd),this.addBufferListener(E,"error",this._onSBUpdateError),this.tracks[s]={buffer:f,codec:a,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},n++}catch(D){_.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+D.message),this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:D,mimeType:l})}}n&&this.hls.trigger(c.Events.BUFFER_CREATED,{tracks:this.tracks})},d._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},d._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},d._onSBUpdateError=function(e,t){_.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},d.removeExecutor=function(e,t,i){var n=this.media,s=this.mediaSource,r=this.operationQueue,a=this.sourceBuffer[e];if(!n||!s||!a)return _.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);var l=(0,U.isFiniteNumber)(n.duration)?n.duration:1/0,f=(0,U.isFiniteNumber)(s.duration)?s.duration:1/0,E=Math.max(0,t),D=Math.min(i,l,f);D>E?(_.logger.log("[buffer-controller]: Removing ["+E+","+D+"] from the "+e+" SourceBuffer"),a.remove(E,D)):r.shiftAndExecuteNext(e)},d.appendExecutor=function(e,t){var i=this.operationQueue,n=this.sourceBuffer[t];if(!n)return _.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)},d.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return _.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,s=t.map(function(r){return n.appendBlocker(r)});Promise.all(s).then(function(){e(),t.forEach(function(r){var a=i.sourceBuffer[r];a&&a.updating||n.shiftAndExecuteNext(r)})})},d.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},d.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var s=i.bind(this,e);this.listeners[e].push({event:t,listener:s}),n.addEventListener(t,s)}},d.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(i){t.removeEventListener(i.event,i.listener)})},v}(),Bi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Gi=function(v){var d=v;return Bi.hasOwnProperty(v)&&(d=Bi[v]),String.fromCharCode(d)},w=15,b=100,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},m=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(v){v[v.ERROR=0]="ERROR",v[v.TEXT=1]="TEXT",v[v.WARNING=2]="WARNING",v[v.INFO=2]="INFO",v[v.DEBUG=3]="DEBUG",v[v.DATA=3]="DATA"})(Ut||(Ut={}));var h=function(){function v(){this.time=null,this.verboseLevel=Ut.ERROR}return v.prototype.log=function(d,e){this.verboseLevel>=d&&_.logger.log(this.time+" ["+d+"] "+e)},v}(),y=function(v){for(var d=[],e=0;e<v.length;e++)d.push(v[e].toString(16));return d},T=function(){function v(e,t,i,n,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}var d=v.prototype;return d.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},d.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},d.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},d.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},d.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},d.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),L=function(){function v(e,t,i,n,s,r){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new T(t,i,n,s,r)}var d=v.prototype;return d.reset=function(){this.uchar=" ",this.penState.reset()},d.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},d.setPenState=function(e){this.penState.copy(e)},d.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},d.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},d.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),A=function(){function v(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<b;t++)this.chars.push(new L);this.logger=e,this.pos=0,this.currPenState=new T}var d=v.prototype;return d.equals=function(e){for(var t=!0,i=0;i<b;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},d.copy=function(e){for(var t=0;t<b;t++)this.chars[t].copy(e.chars[t])},d.isEmpty=function(){for(var e=!0,t=0;t<b;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},d.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(Ut.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>b&&(this.logger.log(Ut.DEBUG,"Too large cursor position "+this.pos),this.pos=b)},d.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},d.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},d.insertChar=function(e){e>=144&&this.backSpace();var t=Gi(e);this.pos>=b?this.logger.log(Ut.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},d.clearFromPos=function(e){var t;for(t=e;t<b;t++)this.chars[t].reset()},d.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},d.clearToEndOfRow=function(){this.clearFromPos(this.pos)},d.getTextString=function(){for(var e=[],t=!0,i=0;i<b;i++){var n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")},d.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},v}(),N=function(){function v(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<w;t++)this.rows.push(new A(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var d=v.prototype;return d.reset=function(){for(var e=0;e<w;e++)this.rows[e].clear();this.currRow=14},d.equals=function(e){for(var t=!0,i=0;i<w;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},d.copy=function(e){for(var t=0;t<w;t++)this.rows[t].copy(e.rows[t])},d.isEmpty=function(){for(var e=!0,t=0;t<w;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},d.backSpace=function(){this.rows[this.currRow].backSpace()},d.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},d.insertChar=function(e){this.rows[this.currRow].insertChar(e)},d.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},d.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},d.setCursor=function(e){this.logger.log(Ut.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},d.setPAC=function(e){this.logger.log(Ut.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<w;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var r=s.rows[n].cueStartTime,a=this.logger.time;if(r&&a!==null&&r<a)for(var l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(s.rows[n+l])}}this.currRow=t;var f=this.rows[this.currRow];if(e.indent!==null){var E=e.indent,D=Math.max(E-1,0);f.setCursor(e.indent),e.color=f.chars[D].penState.foreground}var F={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(F)},d.setBkgData=function(e){this.logger.log(Ut.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},d.setRollUpRows=function(e){this.nrRollUpRows=e},d.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(Ut.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(Ut.INFO,"Rolling up")}else this.logger.log(Ut.DEBUG,"roll_up but nrRollUpRows not set yet")},d.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,s=0;s<w;s++){var r=this.rows[s].getTextString();r&&(n=s+1,e?t.push("Row "+n+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join(`
`)),i},d.getTextAndFormat=function(){return this.rows},v}(),ae=function(){function v(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new N(i),this.nonDisplayedMemory=new N(i),this.lastOutputScreen=new N(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var d=v.prototype;return d.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},d.getHandler=function(){return this.outputFilter},d.setHandler=function(e){this.outputFilter=e},d.setPAC=function(e){this.writeScreen.setPAC(e)},d.setBkgData=function(e){this.writeScreen.setBkgData(e)},d.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(Ut.INFO,"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},d.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Ut.INFO,i+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(Ut.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},d.ccRCL=function(){this.logger.log(Ut.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},d.ccBS=function(){this.logger.log(Ut.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},d.ccAOF=function(){},d.ccAON=function(){},d.ccDER=function(){this.logger.log(Ut.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},d.ccRU=function(e){this.logger.log(Ut.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},d.ccFON=function(){this.logger.log(Ut.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},d.ccRDC=function(){this.logger.log(Ut.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},d.ccTR=function(){this.logger.log(Ut.INFO,"TR"),this.setMode("MODE_TEXT")},d.ccRTD=function(){this.logger.log(Ut.INFO,"RTD"),this.setMode("MODE_TEXT")},d.ccEDM=function(){this.logger.log(Ut.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},d.ccCR=function(){this.logger.log(Ut.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},d.ccENM=function(){this.logger.log(Ut.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},d.ccEOC=function(){if(this.logger.log(Ut.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Ut.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},d.ccTO=function(e){this.logger.log(Ut.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},d.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(Ut.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},d.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},d.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},v}(),fe=function(){function v(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new h;this.channels=[null,new ae(e,t,n),new ae(e+1,i,n)],this.cmdHistory={a:null,b:null},this.logger=n}var d=v.prototype;return d.getHandler=function(e){return this.channels[e].getHandler()},d.setHandler=function(e,t){this.channels[e].setHandler(t)},d.addData=function(e,t){var i,n,s,r=!1;this.logger.time=e;for(var a=0;a<t.length;a+=2)if(n=127&t[a],s=127&t[a+1],n!==0||s!==0){if(this.logger.log(Ut.DATA,"["+y([t[a],t[a+1]])+"] -> ("+y([n,s])+")"),(i=this.parseCmd(n,s))||(i=this.parseMidrow(n,s)),i||(i=this.parsePAC(n,s)),i||(i=this.parseBackgroundAttributes(n,s)),!i&&(r=this.parseChars(n,s))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(r):this.logger.log(Ut.WARNING,"No channel found yet. TEXT-MODE?")}i||r||this.logger.log(Ut.WARNING,"Couldn't parse cleaned data "+y([n,s])+" orig: "+y([t[a],t[a+1]]))}},d.parseCmd=function(e,t){var i=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Ce(e,t,i))return Se(null,null,i),this.logger.log(Ut.DEBUG,"Repeated command ("+y([e,t])+") is dropped"),!0;var n=e===20||e===21||e===23?1:2,s=this.channels[n];return e===20||e===21||e===28||e===29?t===32?s.ccRCL():t===33?s.ccBS():t===34?s.ccAOF():t===35?s.ccAON():t===36?s.ccDER():t===37?s.ccRU(2):t===38?s.ccRU(3):t===39?s.ccRU(4):t===40?s.ccFON():t===41?s.ccRDC():t===42?s.ccTR():t===43?s.ccRTD():t===44?s.ccEDM():t===45?s.ccCR():t===46?s.ccENM():t===47&&s.ccEOC():s.ccTO(t-32),Se(e,t,i),this.currentChannel=n,!0},d.parseMidrow=function(e,t){var i=0;if((e===17||e===25)&&t>=32&&t<=47){if((i=e===17?1:2)!==this.currentChannel)return this.logger.log(Ut.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[i];return!!n&&(n.ccMIDROW(t),this.logger.log(Ut.DEBUG,"MIDROW ("+y([e,t])+")"),!0)}return!1},d.parsePAC=function(e,t){var i,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Ce(e,t,n))return Se(null,null,n),!0;var s=e<=23?1:2;i=t>=64&&t<=95?s===1?o[e]:g[e]:s===1?u[e]:p[e];var r=this.channels[s];return!!r&&(r.setPAC(this.interpretPAC(i,t)),Se(e,t,n),this.currentChannel=s,!0)},d.interpretPAC=function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=(1&i)==1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},d.parseChars=function(e,t){var i,n,s=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19?(n=r===17?t+80:r===18?t+112:t+144,this.logger.log(Ut.INFO,"Special char '"+Gi(n)+"' in channel "+i),s=[n]):e>=32&&e<=127&&(s=t===0?[e]:[e,t]),s){var a=y(s);this.logger.log(Ut.DEBUG,"Char codes =  "+a.join(",")),Se(e,t,this.cmdHistory)}return s},d.parseBackgroundAttributes=function(e,t){var i;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var n={};e===16||e===24?(i=Math.floor((t-32)/2),n.background=m[i],t%2==1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));var s=e<=23?1:2;return this.channels[s].setBkgData(n),Se(e,t,this.cmdHistory),!0},d.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},d.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t];i&&i.cueSplitAtTime(e)}},v}();function Se(v,d,e){e.a=v,e.b=d}function Ce(v,d,e){return e.a===v&&e.b===d}const _e=fe;var ft=function(){function v(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var d=v.prototype;return d.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},d.newCue=function(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},d.reset=function(){this.cueRanges=[],this.startTime=null},v}();const nt=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var v=["","lr","rl"],d=["start","middle","end","left","right"];function e(s,r){if(typeof r!="string"||!Array.isArray(s))return!1;var a=r.toLowerCase();return!!~s.indexOf(a)&&a}function t(s){return e(d,s)}function i(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];for(var f=1;f<arguments.length;f++){var E=arguments[f];for(var D in E)s[D]=E[D]}return s}function n(s,r,a){var l=this,f={enumerable:!0};l.hasBeenReset=!1;var E="",D=!1,F=s,H=r,X=a,me=null,ge="",Ke=!0,He="auto",Me="start",je=50,Xe="middle",Ue=50,ut="middle";Object.defineProperty(l,"id",i({},f,{get:function(){return E},set:function(tt){E=""+tt}})),Object.defineProperty(l,"pauseOnExit",i({},f,{get:function(){return D},set:function(tt){D=!!tt}})),Object.defineProperty(l,"startTime",i({},f,{get:function(){return F},set:function(tt){if(typeof tt!="number")throw new TypeError("Start time must be set to a number.");F=tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"endTime",i({},f,{get:function(){return H},set:function(tt){if(typeof tt!="number")throw new TypeError("End time must be set to a number.");H=tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"text",i({},f,{get:function(){return X},set:function(tt){X=""+tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"region",i({},f,{get:function(){return me},set:function(tt){me=tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"vertical",i({},f,{get:function(){return ge},set:function(tt){var Dt=function(kt){return e(v,kt)}(tt);if(Dt===!1)throw new SyntaxError("An invalid or illegal string was specified.");ge=Dt,this.hasBeenReset=!0}})),Object.defineProperty(l,"snapToLines",i({},f,{get:function(){return Ke},set:function(tt){Ke=!!tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"line",i({},f,{get:function(){return He},set:function(tt){if(typeof tt!="number"&&tt!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");He=tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"lineAlign",i({},f,{get:function(){return Me},set:function(tt){var Dt=t(tt);if(!Dt)throw new SyntaxError("An invalid or illegal string was specified.");Me=Dt,this.hasBeenReset=!0}})),Object.defineProperty(l,"position",i({},f,{get:function(){return je},set:function(tt){if(tt<0||tt>100)throw new Error("Position must be between 0 and 100.");je=tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"positionAlign",i({},f,{get:function(){return Xe},set:function(tt){var Dt=t(tt);if(!Dt)throw new SyntaxError("An invalid or illegal string was specified.");Xe=Dt,this.hasBeenReset=!0}})),Object.defineProperty(l,"size",i({},f,{get:function(){return Ue},set:function(tt){if(tt<0||tt>100)throw new Error("Size must be between 0 and 100.");Ue=tt,this.hasBeenReset=!0}})),Object.defineProperty(l,"align",i({},f,{get:function(){return ut},set:function(tt){var Dt=t(tt);if(!Dt)throw new SyntaxError("An invalid or illegal string was specified.");ut=Dt,this.hasBeenReset=!0}})),l.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();var We=function(){function v(){}return v.prototype.decode=function(d,e){if(!d)return"";if(typeof d!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(d))},v}();function Je(v){function d(t,i,n,s){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(s||0)}var e=v.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?d(e[2],e[3],0,e[4]):d(e[1],e[2],e[3],e[4]):null}var et=function(){function v(){this.values=Object.create(null)}var d=v.prototype;return d.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},d.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},d.has=function(e){return e in this.values},d.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},d.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},d.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},v}();function Ve(v,d,e,t){var i=t?v.split(t):[v];for(var n in i)if(typeof i[n]=="string"){var s=i[n].split(e);s.length===2&&d(s[0],s[1])}}var at=new nt(0,0,""),Rt=at.align==="middle"?"middle":"center";function $t(v,d,e){var t=v;function i(){var s=Je(v);if(s===null)throw new Error("Malformed timestamp: "+t);return v=v.replace(/^[^\sa-zA-Z-]+/,""),s}function n(){v=v.replace(/^\s+/,"")}if(n(),d.startTime=i(),n(),v.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);v=v.slice(3),n(),d.endTime=i(),n(),function(s,r){var a=new et;Ve(s,function(E,D){var F;switch(E){case"region":for(var H=e.length-1;H>=0;H--)if(e[H].id===D){a.set(E,e[H].region);break}break;case"vertical":a.alt(E,D,["rl","lr"]);break;case"line":F=D.split(","),a.integer(E,F[0]),a.percent(E,F[0])&&a.set("snapToLines",!1),a.alt(E,F[0],["auto"]),F.length===2&&a.alt("lineAlign",F[1],["start",Rt,"end"]);break;case"position":F=D.split(","),a.percent(E,F[0]),F.length===2&&a.alt("positionAlign",F[1],["start",Rt,"end","line-left","line-right","auto"]);break;case"size":a.percent(E,D);break;case"align":a.alt(E,D,["start",Rt,"end","left","right"])}},/:/,/\s/),r.region=a.get("region",null),r.vertical=a.get("vertical","");var l=a.get("line","auto");l==="auto"&&at.line===-1&&(l=-1),r.line=l,r.lineAlign=a.get("lineAlign","start"),r.snapToLines=a.get("snapToLines",!0),r.size=a.get("size",100),r.align=a.get("align",Rt);var f=a.get("position","auto");f==="auto"&&at.position===50&&(f=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=f}(v,d)}function Ct(v){return v.replace(/<br(?: \/)?>/gi,`
`)}var qt=function(){function v(){this.state="INITIAL",this.buffer="",this.decoder=new We,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var d=v.prototype;return d.parse=function(e){var t=this;function i(){var l=t.buffer,f=0;for(l=Ct(l);f<l.length&&l[f]!=="\r"&&l[f]!==`
`;)++f;var E=l.slice(0,f);return l[f]==="\r"&&++f,l[f]===`
`&&++f,t.buffer=l.slice(f),E}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(n=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?Ve(n,function(l,f){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new nt(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{$t(n,t.cue,t.regionList)}catch(l){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=n.indexOf("-->")!==-1;if(!n||a&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(l){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},d.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},v}(),or=Q(673),Bt=Q(524),Mt=/\r\n|\n\r|\n|\r/g,nr=function(v,d,e){return e===void 0&&(e=0),v.slice(e,e+d.length)===d},vr=function(v){for(var d=5381,e=v.length;e;)d=33*d^v.charCodeAt(--e);return(d>>>0).toString()};function br(v,d,e){return vr(v.toString())+vr(d.toString())+vr(e)}function Lr(){return Lr=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},Lr.apply(this,arguments)}var _r="stpp.ttml.im1t",oi=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ti=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,It={left:"start",center:"center",right:"end",start:"start",end:"end"};function Nt(v,d,e,t,i){var n=(0,ie.findBox)(new Uint8Array(v),["mdat"]);if(n.length!==0){var s=n.map(function(a){return(0,Et.utf8ArrayToStr)(a)}),r=(0,or.toTimescaleFromScale)(d,1,e);try{s.forEach(function(a){return t(function(l,f){var E=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!E)throw new Error("Invalid ttml");var D={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},F=Object.keys(D).reduce(function(Ke,He){return Ke[He]=E.getAttribute("ttp:"+He)||D[He],Ke},{}),H=E.getAttribute("xml:space")!=="preserve",X=Vr(li(E,"styling","style")),me=Vr(li(E,"layout","region")),ge=li(E,"body","[begin]");return[].map.call(ge,function(Ke){var He=Fr(Ke,H);if(!He||!Ke.hasAttribute("begin"))return null;var Me=jr(Ke.getAttribute("begin"),F),je=jr(Ke.getAttribute("dur"),F),Xe=jr(Ke.getAttribute("end"),F);if(Me===null)throw Mr(Ke);if(Xe===null){if(je===null)throw Mr(Ke);Xe=Me+je}var Ue=new nt(Me-f,Xe-f,He);Ue.id=br(Ue.startTime,Ue.endTime,Ue.text);var ut=me[Ke.getAttribute("region")],tt=X[Ke.getAttribute("style")];Ue.position=10,Ue.size=80;var Dt=function(er,Kt,Wt){var ar="http://www.w3.org/ns/ttml#styling",Tr=null,Ir=er!=null&&er.hasAttribute("style")?er.getAttribute("style"):null;return Ir&&Wt.hasOwnProperty(Ir)&&(Tr=Wt[Ir]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(fr,Sr){var Gr=ui(Kt,ar,Sr)||ui(er,ar,Sr)||ui(Tr,ar,Sr);return Gr&&(fr[Sr]=Gr),fr},{})}(ut,tt,X),kt=Dt.textAlign;if(kt){var Yt=It[kt];Yt&&(Ue.lineAlign=Yt),Ue.align=kt}return Lr(Ue,Dt),Ue}).filter(function(Ke){return Ke!==null})}(a,r))})}catch(a){i(a)}}else i(new Error("Could not parse IMSC1 mdat"))}function li(v,d,e){var t=v.getElementsByTagName(d)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Vr(v){return v.reduce(function(d,e){var t=e.getAttribute("xml:id");return t&&(d[t]=e),d},{})}function Fr(v,d){return[].slice.call(v.childNodes).reduce(function(e,t,i){var n;return t.nodeName==="br"&&i?e+`
`:(n=t.childNodes)!==null&&n!==void 0&&n.length?Fr(t,d):d?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function ui(v,d,e){return v&&v.hasAttributeNS(d,e)?v.getAttributeNS(d,e):null}function Mr(v){return new Error("Could not parse ttml timestamp "+v)}function jr(v,d){if(!v)return null;var e=Je(v);return e===null&&(oi.test(v)?e=function(t,i){var n=oi.exec(t),s=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+s/i.frameRate}(v,d):Ti.test(v)&&(e=function(t,i){var n=Ti.exec(t),s=Number(n[1]);switch(n[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/i.frameRate;case"t":return s/i.tickRate}return s}(v,d))),e}var di=function(){function v(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new ft(this,"textTrack1"),i=new ft(this,"textTrack2"),n=new ft(this,"textTrack3"),s=new ft(this,"textTrack4");this.cea608Parser1=new _e(1,t,i),this.cea608Parser2=new _e(3,n,s)}e.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(c.Events.FRAG_LOADING,this.onFragLoading,this),e.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=v.prototype;return d.destroy=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(c.Events.FRAG_LOADING,this.onFragLoading,this),e.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(e,t,i,n,s){for(var r,a,l,f,E=!1,D=s.length;D--;){var F=s[D],H=(r=F[0],a=F[1],l=t,f=i,Math.min(a,f)-Math.max(r,l));if(H>=0&&(F[0]=Math.min(F[0],t),F[1]=Math.max(F[1],i),E=!0,H/(i-t)>.5))return}if(E||s.push([t,i]),this.config.renderTextTracksNatively){var X=this.captionsTracks[e];this.Cues.newCue(X,t,i,n)}else{var me=this.Cues.newCue(null,t,i,n);this.hls.trigger(c.Events.CUES_PARSED,{type:"captions",cues:me,track:e})}},d.onInitPtsFound=function(e,t){var i=this,n=t.frag,s=t.id,r=t.initPTS,a=t.timescale,l=this.unparsedVttFrags;s==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=a),l.length&&(this.unparsedVttFrags=[],l.forEach(function(f){i.onFragLoaded(c.Events.FRAG_LOADED,f)}))},d.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null},d.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},d.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,i=this.captionsTracks,n=this.media,s=t[e],r=s.label,a=s.languageCode,l=this.getExistingTrack(e);if(l)i[e]=l,Ze(i[e]),it(i[e],n);else{var f=this.createTextTrack("captions",r,a);f&&(f[e]=!0,i[e]=f)}}},d.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},d.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},d.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},d.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Ze(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)Ze(t[i])}},d.onSubtitleTracksUpdated=function(e,t){var i=this;this.textTracks=[];var n=t.subtitleTracks||[],s=n.some(function(f){return f.textCodec===_r});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,E){var D;if(E<a.length){for(var F=null,H=0;H<a.length;H++)if(Ur(a[H],f)){F=a[H];break}F&&(D=F)}if(D)Ze(D);else{var X=i._captionsOrSubtitlesFromCharacteristics(f);(D=i.createTextTrack(X,f.name,f.lang))&&(D.mode="disabled")}D&&(D.groupId=f.groupId,i.textTracks.push(D))})}else if(!r&&this.tracks&&this.tracks.length){var l=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},d._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!==null&&t!==void 0&&t.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"},d.onManifestLoaded=function(e,t){var i=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(n){var s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(s){var r="textTrack"+s[1],a=i.captionsProperties[r];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)}})},d.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},d.onFragLoading=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2,s=this.lastSn,r=this.lastPartIndex;if(this.enabled&&i&&n&&t.frag.type===G.PlaylistLevelType.MAIN){var a,l,f=t.frag.sn,E=(a=t==null||(l=t.part)===null||l===void 0?void 0:l.index)!=null?a:-1;f===s+1||f===s&&E===r+1||(i.reset(),n.reset()),this.lastSn=f,this.lastPartIndex=E}},d.onFragLoaded=function(e,t){var i=t.frag,n=t.payload,s=this.initPTS,r=this.unparsedVttFrags;if(i.type===G.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,U.isFiniteNumber)(s[i.cc]))return r.push(t),void(s.length&&this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var a=i.decryptdata,l="stats"in t;if(a==null||a.key==null||a.method!=="AES-128"||l){var f=this.tracks[i.level],E=this.vttCCs;E[i.cc]||(E[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),f&&f.textCodec===_r?this._parseIMSC1(i,n):this._parseVTTs(i,n,E)}}else this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(e,t){var i=this,n=this.hls;Nt(t,this.initPTS[e.cc],this.timescale[e.cc],function(s){i._appendCues(s,e.level),n.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){_.logger.log("Failed to parse IMSC1: "+s),n.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},d._parseVTTs=function(e,t,i){var n,s=this,r=this.hls;(function(a,l,f,E,D,F,H,X){var me,ge=new qt,Ke=(0,Et.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(Mt,`
`).split(`
`),He=[],Me=(0,or.toMpegTsClockFromTimescale)(l,f),je="00:00.000",Xe=0,Ue=0,ut=!0;ge.oncue=function(tt){var Dt=E[D],kt=E.ccOffset,Yt=(Xe-Me)/9e4;Dt!=null&&Dt.new&&(Ue!==void 0?kt=E.ccOffset=Dt.start:function(ar,Tr,Ir){var fr=ar[Tr],Sr=ar[fr.prevCC];if(!Sr||!Sr.new&&fr.new)return ar.ccOffset=ar.presentationOffset=fr.start,void(fr.new=!1);for(;(Gr=Sr)!==null&&Gr!==void 0&&Gr.new;){var Gr;ar.ccOffset+=fr.start-Sr.start,fr.new=!1,Sr=ar[(fr=Sr).prevCC]}ar.presentationOffset=Ir}(E,D,Yt)),Yt&&(kt=Yt-E.presentationOffset);var er=tt.endTime-tt.startTime,Kt=(0,Bt.normalizePts)(9e4*(tt.startTime+kt-Ue),9e4*F)/9e4;tt.startTime=Math.max(Kt,0),tt.endTime=Math.max(Kt+er,0);var Wt=tt.text.trim();tt.text=decodeURIComponent(encodeURIComponent(Wt)),tt.id||(tt.id=br(tt.startTime,tt.endTime,Wt)),tt.endTime>0&&He.push(tt)},ge.onparsingerror=function(tt){me=tt},ge.onflush=function(){me?X(me):H(He)},Ke.forEach(function(tt){if(ut){if(nr(tt,"X-TIMESTAMP-MAP=")){ut=!1,tt.slice(16).split(",").forEach(function(Dt){nr(Dt,"LOCAL:")?je=Dt.slice(6):nr(Dt,"MPEGTS:")&&(Xe=parseInt(Dt.slice(7)))});try{Ue=function(Dt){var kt=parseInt(Dt.slice(-3)),Yt=parseInt(Dt.slice(-6,-4)),er=parseInt(Dt.slice(-9,-7)),Kt=Dt.length>9?parseInt(Dt.substring(0,Dt.indexOf(":"))):0;if(!((0,U.isFiniteNumber)(kt)&&(0,U.isFiniteNumber)(Yt)&&(0,U.isFiniteNumber)(er)&&(0,U.isFiniteNumber)(Kt)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+Dt);return kt+=1e3*Yt,(kt+=6e4*er)+36e5*Kt}(je)/1e3}catch(Dt){me=Dt}return}tt===""&&(ut=!1)}ge.parse(tt+`
`)}),ge.flush()})((n=e.initSegment)!==null&&n!==void 0&&n.data?(0,ie.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],this.timescale[e.cc],i,e.cc,e.start,function(a){s._appendCues(a,e.level),r.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){s._fallbackToIMSC1(e,t),_.logger.log("Failed to parse VTT cue: "+a),r.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},d._fallbackToIMSC1=function(e,t){var i=this,n=this.tracks[e.level];n.textCodec||Nt(t,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=_r,i._parseIMSC1(e,t)},function(){n.textCodec="wvtt"})},d._appendCues=function(e,t){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(function(a){return ye(n,a)})}else{var s=this.tracks[t];if(!s)return;var r=s.default?"default":"subtitles"+t;i.trigger(c.Events.CUES_PARSED,{type:"subtitles",cues:e,track:r})}},d.onFragDecrypted=function(e,t){var i=t.frag;if(i.type===G.PlaylistLevelType.SUBTITLE){if(!(0,U.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(c.Events.FRAG_LOADED,t)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&i&&n){var s=t.frag,r=t.samples;if(s.type!==G.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(s)!=="NONE")for(var a=0;a<r.length;a++){var l=r[a].bytes;if(l){var f=this.extractCea608Data(l);i.addData(r[a].pts,f[0]),n.addData(r[a].pts,f[1])}}}},d.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,s=t.endOffsetSubtitles,r=t.type,a=this.media;if(a&&!(a.currentTime<n)){if(!r||r==="video"){var l=this.captionsTracks;Object.keys(l).forEach(function(E){return st(l[E],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&s!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(E){return st(f[E],i,s)})}}},d.extractCea608Data=function(e){for(var t=[[],[]],i=31&e[0],n=2,s=0;s<i;s++){var r=e[n++],a=127&e[n++],l=127&e[n++];if((a!==0||l!==0)&&(4&r)!=0){var f=3&r;f!==0&&f!==1||(t[f].push(a),t[f].push(l))}}return t},v}();function Ur(v,d){return v&&v.label===d.name&&!(v.textTrack1||v.textTrack2)}function Ri(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}const Si=function(){function v(i){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var d,e,t=v.prototype;return t.setStreamController=function(i){this.streamController=i},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var i=this.hls;i.on(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var i=this.hls;i.off(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(i,n){v.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},t.onMediaAttaching=function(i,n){this.media=n.media instanceof HTMLVideoElement?n.media:null},t.onManifestParsed=function(i,n){var s=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,s.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onBufferCodecs=function(i,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(i.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},t.getMaxLevel=function(i){var n=this,s=this.hls.levels;if(!s.length)return-1;var r=s.filter(function(a,l){return v.isLevelAllowed(l,n.restrictedLevels)&&l<=i});return this.clientRect=null,v.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,n={width:0,height:0};if(i){var s=i.getBoundingClientRect();n.width=s.width,n.height=s.height,n.width||n.height||(n.width=s.right-s.left||i.width||0,n.height=s.bottom-s.top||i.height||0)}return this.clientRect=n,n},v.isLevelAllowed=function(i,n){return n===void 0&&(n=[]),n.indexOf(i)===-1},v.getMaxLevelByMediaSize=function(i,n,s){if(!i||!i.length)return-1;for(var r,a,l=i.length-1,f=0;f<i.length;f+=1){var E=i[f];if((E.width>=n||E.height>=s)&&(r=E,!(a=i[f+1])||r.width!==a.width||r.height!==a.height)){l=f;break}}return l},d=v,(e=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch(n){}return i}}])&&Ri(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}(),Ki=function(){function v(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var d=v.prototype;return d.setStreamController=function(e){this.streamController=e},d.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},d.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching)},d.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},d.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},d.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var s=n-this.lastTime,r=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*r/s,f=this.hls;if(f.trigger(c.Events.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:i}),l>0&&r>f.config.fpsDroppedMonitoringThreshold*a){var E=f.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+E),E>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=E)&&(E-=1,f.trigger(c.Events.FPS_DROP_LEVEL_CAPPING,{level:E,droppedLevel:f.currentLevel}),f.autoLevelCapping=E,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},d.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},v}();var $r;(function(v){v.WIDEVINE="com.widevine.alpha",v.PLAYREADY="com.microsoft.playready"})($r||($r={}));var Hi=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function en(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}const ki=function(){function v(i){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=i,this._config=i.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var d,e,t=v.prototype;return t.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},t._registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t._unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t.getLicenseServerUrl=function(i){switch(i){case $r.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},t._attemptKeySystemAccess=function(i,n,s){var r=this,a=function(f,E,D,F){if(f===$r.WIDEVINE)return function(H,X,me){var ge={audioCapabilities:[],videoCapabilities:[]};return H.forEach(function(Ke){ge.audioCapabilities.push({contentType:'audio/mp4; codecs="'+Ke+'"',robustness:me.audioRobustness||""})}),X.forEach(function(Ke){ge.videoCapabilities.push({contentType:'video/mp4; codecs="'+Ke+'"',robustness:me.videoRobustness||""})}),[ge]}(E,D,F);throw new Error("Unknown key-system: "+f)}(i,n,s,this._drmSystemOptions);_.logger.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(i,a);this.mediaKeysPromise=l.then(function(f){return r._onMediaKeySystemAccessObtained(i,f)}),l.catch(function(f){_.logger.error('Failed to obtain key-system "'+i+'" access:',f)})},t._onMediaKeySystemAccessObtained=function(i,n){var s=this;_.logger.log('Access for key-system "'+i+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:n,mediaKeySystemDomain:i};this._mediaKeysList.push(r);var a=Promise.resolve().then(function(){return n.createMediaKeys()}).then(function(l){return r.mediaKeys=l,_.logger.log('Media-keys created for key-system "'+i+'"'),s._onMediaKeysCreated(),l});return a.catch(function(l){_.logger.error("Failed to create media-keys:",l)}),a},t._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(n){n.mediaKeysSession||(n.mediaKeysSession=n.mediaKeys.createSession(),i._onNewMediaKeySession(n.mediaKeysSession))})},t._onNewMediaKeySession=function(i){var n=this;_.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(s){n._onKeySessionMessage(i,s.message)},!1)},t._onKeySessionMessage=function(i,n){_.logger.log("Got EME message event, creating license request"),this._requestLicense(n,function(s){_.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),i.update(s).catch(function(r){_.logger.warn("Updating key-session failed: "+r)})})},t.onMediaEncrypted=function(i){var n=this;if(_.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise)return _.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var s=function(r){n._media&&(n._attemptSetMediaKeys(r),n._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(s).catch(s)},t._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var n=this._mediaKeysList[0];if(!n||!n.mediaKeys)return _.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});_.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(n.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(i,n){var s=this,r=this._mediaKeysList[0];if(!r)return _.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)_.logger.warn("Key-Session already initialized but requested again");else{var a=r.mediaKeysSession;if(!a)return _.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!n)return _.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});_.logger.log('Generating key-session request for "'+i+'" init data type'),r.mediaKeysSessionInitialized=!0,a.generateRequest(i,n).then(function(){_.logger.debug("Key-session generation succeeded")}).catch(function(l){_.logger.error("Error generating key-session request:",l),s.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t._createLicenseXhr=function(i,n,s){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,i,n,s);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,r,i),a=void 0}catch(l){_.logger.error(l)}try{r.readyState||r.open("POST",i,!0),a&&a.call(this.hls,r,i)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return r},t._onLicenseRequestReadyStageChange=function(i,n,s,r){if(i.readyState===4)if(i.status===200){this._requestLicenseFailureCount=0,_.logger.log("License request succeeded");var a=i.response,l=this._licenseResponseCallback;if(l)try{a=l.call(this.hls,i,n)}catch(E){_.logger.error(E)}r(a)}else{if(_.logger.error("License Request XHR failed ("+n+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var f=3-this._requestLicenseFailureCount+1;_.logger.warn("Retrying license request, "+f+" attempts left"),this._requestLicense(s,r)}},t._generateLicenseRequestChallenge=function(i,n){if(i.mediaKeySystemDomain===$r.WIDEVINE)return n;throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},t._requestLicense=function(i,n){_.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s)return _.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(s.mediaKeySystemDomain),a=this._createLicenseXhr(r,i,n);_.logger.log("Sending license request to URL: "+r);var l=this._generateLicenseRequestChallenge(s,i);a.send(l)}catch(f){_.logger.error("Failure requesting DRM license: "+f),this.hls.trigger(c.Events.ERROR,{type:M.ErrorTypes.KEY_SYSTEM_ERROR,details:M.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(i,n){if(this._emeEnabled){var s=n.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){var i=this._media,n=this._mediaKeysList;i&&(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(n.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},t.onManifestParsed=function(i,n){if(this._emeEnabled){var s=n.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),r=n.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess($r.WIDEVINE,s,r)}},d=v,(e=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&en(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();var Er,hi,fi;function _i(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function cn(v,d,e){return d&&_i(v.prototype,d),e&&_i(v,e),Object.defineProperty(v,"prototype",{writable:!1}),v}function gn(v,d){var e=typeof Symbol!="undefined"&&v[Symbol.iterator]||v["@@iterator"];if(e)return(e=e.call(v)).next.bind(e);if(Array.isArray(v)||(e=function(i,n){if(i){if(typeof i=="string")return vn(i,n);var s=Object.prototype.toString.call(i).slice(8,-1);return s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set"?Array.from(i):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?vn(i,n):void 0}}(v))||d&&v&&typeof v.length=="number"){e&&(v=e);var t=0;return function(){return t>=v.length?{done:!0}:{done:!1,value:v[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vn(v,d){(d==null||d>v.length)&&(d=v.length);for(var e=0,t=new Array(d);e<d;e++)t[e]=v[e];return t}function tn(){return tn=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},tn.apply(this,arguments)}(function(v){v.MANIFEST="m",v.AUDIO="a",v.VIDEO="v",v.MUXED="av",v.INIT="i",v.CAPTION="c",v.TIMED_TEXT="tt",v.KEY="k",v.OTHER="o"})(Er||(Er={})),function(v){v.DASH="d",v.HLS="h",v.SMOOTH="s",v.OTHER="o"}(hi||(hi={})),function(v){v.VOD="v",v.LIVE="l"}(fi||(fi={}));var Dn=function(){function v(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(s){try{t.apply(s,{ot:Er.MANIFEST,su:!t.initialized})}catch(r){_.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=function(s){try{var r=s.frag,a=t.hls.levels[r.level],l=t.getObjectType(r),f={d:1e3*r.duration,ot:l};l!==Er.VIDEO&&l!==Er.AUDIO&&l!=Er.MUXED||(f.br=a.bitrate/1e3,f.tb=t.getTopBandwidth(l)/1e3,f.bl=t.getBufferLength(l)),t.apply(s,f)}catch(E){_.logger.warn("Could not generate segment CMCD data.",E)}},this.hls=e;var i=this.config=e.config,n=i.cmcd;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||v.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var d=v.prototype;return d.registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this)},d.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},d.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},d.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},d.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},d.onBufferCreated=function(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)===null||n===void 0?void 0:n.buffer},d.createData=function(){var e;return{v:1,sf:hi.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},d.apply=function(e,t){t===void 0&&(t={}),tn(t,this.createData());var i=t.ot===Er.INIT||t.ot===Er.VIDEO||t.ot===Er.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var n=v.toHeaders(t);if(!Object.keys(n).length)return;e.headers||(e.headers={}),tn(e.headers,n)}else{var s=v.toQuery(t);if(!s)return;e.url=v.appendQueryToUri(e.url,s)}},d.getObjectType=function(e){var t=e.type;return t==="subtitle"?Er.TIMED_TEXT:e.sn==="initSegment"?Er.INIT:t==="audio"?Er.AUDIO:t==="main"?this.hls.audioTracks.length?Er.VIDEO:Er.MUXED:void 0},d.getTopBandwidth=function(e){var t,i=0,n=this.hls;if(e===Er.AUDIO)t=n.audioTracks;else{var s=n.maxAutoLevel,r=s>-1?s+1:n.levels.length;t=n.levels.slice(0,r)}for(var a,l=gn(t);!(a=l()).done;){var f=a.value;f.bitrate>i&&(i=f.bitrate)}return i>0?i:NaN},d.getBufferLength=function(e){var t=this.hls.media,i=e===Er.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*Be.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN},d.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,l){t(r),this.loader.load(r,a,l)},cn(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},d.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,l){t(r),this.loader.load(r,a,l)},cn(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},v.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},v.serialize=function(e){for(var t,i=[],n=function(X){return!Number.isNaN(X)&&X!=null&&X!==""&&X!==!1},s=function(X){return Math.round(X)},r=function(X){return 100*s(X/100)},a={br:s,d:s,bl:r,dl:r,mtp:r,nor:function(X){return encodeURIComponent(X)},rtp:r,tb:s},l=gn(Object.keys(e||{}).sort());!(t=l()).done;){var f=t.value,E=e[f];if(n(E)&&!(f==="v"&&E===1||f=="pr"&&E===1)){var D=a[f];D&&(E=D(E));var F,H=typeof E;F=f==="ot"||f==="sf"||f==="st"?f+"="+E:H==="boolean"?f:H==="number"?f+"="+E:f+"="+JSON.stringify(E),i.push(F)}}return i.join(",")},v.toHeaders=function(e){for(var t={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,a=Object.keys(e);r<a.length;r++){var l=a[r];n[s[l]!=null?s[l]:1][l]=e[l]}for(var f=0;f<n.length;f++){var E=v.serialize(n[f]);E&&(t["CMCD-"+i[f]]=E)}return t},v.toQuery=function(e){return"CMCD="+encodeURIComponent(v.serialize(e))},v.appendQueryToUri=function(e,t){if(!t)return e;var i=e.includes("?")?"&":"?";return""+e+i+t},v}(),pn=Q(408),An=/^age:\s*[\d.]+\s*$/m;const mn=function(){function v(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new pn.LoadStats,this.retryDelay=0}var d=v.prototype;return d.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},d.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},d.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},d.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.retryDelay=t.retryDelay,this.loadInternal()},d.loadInternal=function(){var e=this.config,t=this.context;if(e){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var s=this.xhrSetup;try{if(s)try{s(i,t.url)}catch(l){i.open("GET",t.url,!0),s(i,t.url)}i.readyState||i.open("GET",t.url,!0);var r=this.context.headers;if(r)for(var a in r)i.setRequestHeader(a,r[a])}catch(l){return void this.callbacks.onError({code:i.status,text:l.message},t,i)}t.rangeEnd&&i.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),i.send()}},d.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,s=this.config;if(!i.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),n===4){t.onreadystatechange=null,t.onprogress=null;var r=t.status,a=t.responseType==="arraybuffer";if(r>=200&&r<300&&(a&&t.response||t.responseText!==null)){var l,f;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),f=a?(l=t.response).byteLength:(l=t.responseText).length,i.loaded=i.total=f,!this.callbacks)return;var E=this.callbacks.onProgress;if(E&&E(i,e,l,t),!this.callbacks)return;var D={url:t.responseURL,data:l};this.callbacks.onSuccess(D,i,e,t)}else i.retry>=s.maxRetry||r>=400&&r<499?(_.logger.error(r+" while loading "+e.url),this.callbacks.onError({code:r,text:t.statusText},e,t)):(_.logger.warn(r+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},d.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},d.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},d.getCacheAge=function(){var e=null;if(this.loader&&An.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},v}();function sn(v){var d=typeof Map=="function"?new Map:void 0;return sn=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(d!==void 0){if(d.has(e))return d.get(e);d.set(e,i)}function i(){return on(e,arguments,ln(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Vi(i,e)},sn(v)}function on(v,d,e){return on=Rn()?Reflect.construct.bind():function(t,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(t,s));return n&&Vi(r,n.prototype),r},on.apply(null,arguments)}function Rn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}function Vi(v,d){return Vi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vi(v,d)}function ln(v){return ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},ln(v)}function un(){return un=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},un.apply(this,arguments)}var kn=function(){function v(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||_n,this.controller=new self.AbortController,this.stats=new pn.LoadStats}var d=v.prototype;return d.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},d.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},d.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},d.load=function(e,t,i){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var r=function(E,D){var F={method:"GET",mode:"cors",credentials:"same-origin",signal:D,headers:new self.Headers(un({},E.headers))};return E.rangeEnd&&F.headers.set("Range","bytes="+E.rangeStart+"-"+String(E.rangeEnd-1)),F}(e,this.controller.signal),a=i.onProgress,l=e.responseType==="arraybuffer",f=l?"byteLength":"length";this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),i.onTimeout(s,e,n.response)},t.timeout),self.fetch(this.request).then(function(E){if(n.response=n.loader=E,!E.ok){var D=E.status,F=E.statusText;throw new In(F||"fetch, bad network response",D,E)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(E.headers.get("Content-Length")||"0"),a&&(0,U.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(E,s,e,t.highWaterMark,a):l?E.arrayBuffer():E.text()}).then(function(E){var D=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var F=E[f];F&&(s.loaded=s.total=F);var H={url:D.url,data:E};a&&!(0,U.isFiniteNumber)(t.highWaterMark)&&a(s,e,E,D),i.onSuccess(H,s,e,D)}).catch(function(E){if(self.clearTimeout(n.requestTimeout),!s.aborted){var D=E&&E.code||0,F=E?E.message:null;i.onError({code:D,text:F},e,E?E.details:null)}})},d.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},d.loadProgressively=function(e,t,i,n,s){n===void 0&&(n=0);var r=new pi,a=e.body.getReader();return function l(){return a.read().then(function(f){if(f.done)return r.dataLength&&s(t,i,r.flush(),e),Promise.resolve(new ArrayBuffer(0));var E=f.value,D=E.length;return t.loaded+=D,D<n||r.dataLength?(r.push(E),r.dataLength>=n&&s(t,i,r.flush(),e)):s(t,i,E,e),l()}).catch(function(){return Promise.reject()})}()},v}();function _n(v,d){return new self.Request(v.url,d)}var In=function(v){var d,e;function t(i,n,s){var r;return(r=v.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=s,r}return e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Vi(d,e),t}(sn(Error));const yn=kn;var Cn=/\s/;function dn(){return dn=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},dn.apply(this,arguments)}function En(v,d){var e=Object.keys(v);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(v);d&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(v,i).enumerable})),e.push.apply(e,t)}return e}function Tn(v){for(var d=1;d<arguments.length;d++){var e=arguments[d]!=null?arguments[d]:{};d%2?En(Object(e),!0).forEach(function(t){wn(v,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(e)):En(Object(e)).forEach(function(t){Object.defineProperty(v,t,Object.getOwnPropertyDescriptor(e,t))})}return v}function wn(v,d,e){return d in v?Object.defineProperty(v,d,{value:e,enumerable:!0,configurable:!0,writable:!0}):v[d]=e,v}var xn=Tn(Tn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:mn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:vi,bufferController:an,capLevelController:Si,fpsController:Ki,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Hi,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(v,d,e,t){for(var i,n,s,r,a,l=[],f=self.VTTCue||self.TextTrackCue,E=0;E<t.rows.length;E++)if(s=!0,r=0,a="",!(i=t.rows[E]).isEmpty()){for(var D=0;D<i.chars.length;D++)Cn.test(i.chars[D].uchar)&&s?r++:(a+=i.chars[D].uchar,s=!1);i.cueStartTime=d,d===e&&(e+=1e-4),r>=16?r--:r++;var F=Ct(a.trim()),H=br(d,e,F);v&&v.cues&&v.cues.getCueById(H)||((n=new f(d,e,F)).id=H,n.line=E+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*r/32)),l.push(n))}return v&&l.length&&(l.sort(function(X,me){return X.line==="auto"||me.line==="auto"?0:X.line>8&&me.line>8?me.line-X.line:X.line-me.line}),l.forEach(function(X){return ye(v,X)})),l}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Pi,subtitleTrackController:Ni,timelineController:di,audioStreamController:Ai,audioTrackController:Dr,emeController:ki,cmcdController:Dn});function Sn(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}var bn=function(){function v(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Zr.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var s=this.config=function(Ue,ut){if((ut.liveSyncDurationCount||ut.liveMaxLatencyDurationCount)&&(ut.liveSyncDuration||ut.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(ut.liveMaxLatencyDurationCount!==void 0&&(ut.liveSyncDurationCount===void 0||ut.liveMaxLatencyDurationCount<=ut.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(ut.liveMaxLatencyDuration!==void 0&&(ut.liveSyncDuration===void 0||ut.liveMaxLatencyDuration<=ut.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return dn({},Ue,ut)}(v.DefaultConfig,n);this.userConfig=n,(0,_.enableLogs)(s.debug,"Hls instance"),this._autoLevelCapping=-1,s.progressive&&function(Ue){var ut=Ue.loader;ut!==yn&&ut!==mn?(_.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),Ue.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(tt){}return!1}()&&(Ue.loader=yn,Ue.progressive=!0,Ue.enableSoftwareAES=!0,_.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(s);var r=s.abrController,a=s.bufferController,l=s.capLevelController,f=s.fpsController,E=this.abrController=new r(this),D=this.bufferController=new a(this),F=this.capLevelController=new l(this),H=new f(this),X=new Ge(this),me=new qe(this),ge=new At(this),Ke=this.levelController=new J(this),He=new ce(this),Me=this.streamController=new Ci(this,He);F.setStreamController(Me),H.setStreamController(Me);var je=[X,me,Ke,Me];this.networkControllers=je;var Xe=[E,D,F,H,ge,He];this.audioTrackController=this.createController(s.audioTrackController,null,je),this.createController(s.audioStreamController,He,je),this.subtitleTrackController=this.createController(s.subtitleTrackController,null,je),this.createController(s.subtitleStreamController,He,je),this.createController(s.timelineController,null,Xe),this.emeController=this.createController(s.emeController,null,Xe),this.cmcdController=this.createController(s.cmcdController,null,Xe),this.latencyController=this.createController(Ot,null,Xe),this.coreComponents=Xe}v.isSupported=function(){return function(){var n=Rr();if(!n)return!1;var s=Br(),r=n&&typeof n.isTypeSupported=="function"&&n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function";return!!r&&!!a}()};var d,e,t,i=v.prototype;return i.createController=function(n,s,r){if(n){var a=s?new n(this,s):new n(this);return r&&r.push(a),a}return null},i.on=function(n,s,r){r===void 0&&(r=this),this._emitter.on(n,s,r)},i.once=function(n,s,r){r===void 0&&(r=this),this._emitter.once(n,s,r)},i.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},i.off=function(n,s,r,a){r===void 0&&(r=this),this._emitter.off(n,s,r,a)},i.listeners=function(n){return this._emitter.listeners(n)},i.emit=function(n,s,r){return this._emitter.emit(n,s,r)},i.trigger=function(n,s){if(this.config.debug)return this.emit(n,n,s);try{return this.emit(n,n,s)}catch(r){_.logger.error("An internal error happened while handling event "+n+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:r})}return!1},i.listenerCount=function(n){return this._emitter.listenerCount(n)},i.destroy=function(){_.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},i.attachMedia=function(n){_.logger.log("attachMedia"),this._media=n,this.trigger(c.Events.MEDIA_ATTACHING,{media:n})},i.detachMedia=function(){_.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(n){this.stopLoad();var s=this.media,r=this.url,a=this.url=$.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});_.logger.log("loadSource:"+a),s&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(c.Events.MANIFEST_LOADING,{url:n})},i.startLoad=function(n){n===void 0&&(n=-1),_.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(s){s.startLoad(n)})},i.stopLoad=function(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},i.swapAudioCodec=function(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){_.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},i.removeLevel=function(n,s){s===void 0&&(s=0),this.levelController.removeLevel(n,s)},d=v,t=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return M.ErrorTypes}},{key:"ErrorDetails",get:function(){return M.ErrorDetails}},{key:"DefaultConfig",get:function(){return v.defaultConfig?v.defaultConfig:xn},set:function(n){v.defaultConfig=n}}],(e=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){_.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){_.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){_.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){_.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){_.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var s=!!n;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(_.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,s=this.config.minAutoBitrate;if(!n)return 0;for(var r=n.length,a=0;a<r;a++)if(n[a].maxBitrate>=s)return a;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,s=this.autoLevelCapping;return s===-1&&n&&n.length?n.length-1:s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var s=this.audioTrackController;s&&(s.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Sn(d.prototype,e),t&&Sn(d,t),Object.defineProperty(d,"prototype",{writable:!1}),v}();bn.defaultConfig=void 0},923:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{BaseSegment:()=>ue,ElementaryStreamTypes:()=>Te,Fragment:()=>de,Part:()=>te});var Te,$=Q(965),U=Q(945),c=Q(93),M=Q(960),_=Q(408);function ie(se,oe){se.prototype=Object.create(oe.prototype),se.prototype.constructor=se,q(se,oe)}function q(se,oe){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Ae,be){return Ae.__proto__=be,Ae},q(se,oe)}function V(se,oe){for(var Ae=0;Ae<oe.length;Ae++){var be=oe[Ae];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(se,be.key,be)}}function z(se,oe,Ae){return oe&&V(se.prototype,oe),Ae&&V(se,Ae),Object.defineProperty(se,"prototype",{writable:!1}),se}(function(se){se.AUDIO="audio",se.VIDEO="video",se.AUDIOVIDEO="audiovideo"})(Te||(Te={}));var ue=function(){function se(oe){var Ae;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((Ae={})[Te.AUDIO]=null,Ae[Te.VIDEO]=null,Ae[Te.AUDIOVIDEO]=null,Ae),this.baseurl=oe}return se.prototype.setByteRange=function(oe,Ae){var be=oe.split("@",2),Oe=[];be.length===1?Oe[0]=Ae?Ae.byteRangeEndOffset:0:Oe[0]=parseInt(be[1]),Oe[1]=parseInt(be[0])+Oe[0],this._byteRange=Oe},z(se,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,U.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(oe){this._url=oe}}]),se}(),de=function(se){function oe(be,Oe){var P;return(P=se.call(this,Oe)||this)._decryptdata=null,P.rawProgramDateTime=null,P.programDateTime=null,P.tagList=[],P.duration=0,P.sn=0,P.levelkey=void 0,P.type=void 0,P.loader=null,P.level=-1,P.cc=0,P.startPTS=void 0,P.endPTS=void 0,P.appendedPTS=void 0,P.startDTS=void 0,P.endDTS=void 0,P.start=0,P.deltaPTS=void 0,P.maxStartPTS=void 0,P.minEndPTS=void 0,P.stats=new _.LoadStats,P.urlId=0,P.data=void 0,P.bitrateTest=!1,P.title=null,P.initSegment=null,P.type=be,P}ie(oe,se);var Ae=oe.prototype;return Ae.createInitializationVector=function(be){for(var Oe=new Uint8Array(16),P=12;P<16;P++)Oe[P]=be>>8*(15-P)&255;return Oe},Ae.setDecryptDataFromLevelKey=function(be,Oe){var P=be;return(be==null?void 0:be.method)==="AES-128"&&be.uri&&!be.iv&&((P=M.LevelKey.fromURI(be.uri)).method=be.method,P.iv=this.createInitializationVector(Oe),P.keyFormat="identity"),P},Ae.setElementaryStreamInfo=function(be,Oe,P,k,W,K){K===void 0&&(K=!1);var Re=this.elementaryStreams,Ie=Re[be];Ie?(Ie.startPTS=Math.min(Ie.startPTS,Oe),Ie.endPTS=Math.max(Ie.endPTS,P),Ie.startDTS=Math.min(Ie.startDTS,k),Ie.endDTS=Math.max(Ie.endDTS,W)):Re[be]={startPTS:Oe,endPTS:P,startDTS:k,endDTS:W,partial:K}},Ae.clearElementaryStreamInfo=function(){var be=this.elementaryStreams;be[Te.AUDIO]=null,be[Te.VIDEO]=null,be[Te.AUDIOVIDEO]=null},z(oe,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var be=this.sn;typeof be!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),be=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,be)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,$.isFiniteNumber)(this.programDateTime))return null;var be=(0,$.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*be}},{key:"encrypted",get:function(){var be;return!((be=this.decryptdata)===null||be===void 0||!be.keyFormat||!this.decryptdata.uri)}}]),oe}(ue),te=function(se){function oe(Ae,be,Oe,P,k){var W;(W=se.call(this,Oe)||this).fragOffset=0,W.duration=0,W.gap=!1,W.independent=!1,W.relurl=void 0,W.fragment=void 0,W.index=void 0,W.stats=new _.LoadStats,W.duration=Ae.decimalFloatingPoint("DURATION"),W.gap=Ae.bool("GAP"),W.independent=Ae.bool("INDEPENDENT"),W.relurl=Ae.enumeratedString("URI"),W.fragment=be,W.index=P;var K=Ae.enumeratedString("BYTERANGE");return K&&W.setByteRange(K,k),k&&(W.fragOffset=k.fragOffset+k.duration),W}return ie(oe,se),z(oe,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var Ae=this.elementaryStreams;return!!(Ae.audio||Ae.video||Ae.audiovideo)}}]),oe}(ue)},960:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{LevelKey:()=>U});var Te=Q(945);function $(c,M){for(var _=0;_<M.length;_++){var ie=M[_];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(c,ie.key,ie)}}var U=function(){function c(ie,q){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=q?(0,Te.buildAbsoluteURL)(ie,q,{alwaysNormalize:!0}):ie}var M,_;return c.fromURL=function(ie,q){return new c(ie,q)},c.fromURI=function(ie){return new c(ie)},M=c,(_=[{key:"uri",get:function(){return this._uri}}])&&$(M.prototype,_),Object.defineProperty(M,"prototype",{writable:!1}),c}()},408:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{LoadStats:()=>Te});var Te=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{MAX_SAFE_INTEGER:()=>$,isFiniteNumber:()=>Te});var Te=Number.isFinite||function(U){return typeof U=="number"&&isFinite(U)},$=Number.MAX_SAFE_INTEGER||9007199254740991},524:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{default:()=>se,flushTextTrackMetadataCueSamples:()=>Ae,flushTextTrackUserdataCueSamples:()=>be,normalizePts:()=>oe});var Te=Q(965);const $=function(){function k(){}return k.getSilentFrame=function(W,K){if(W==="mp4a.40.2"){if(K===1)return new Uint8Array([0,200,0,128,35,128]);if(K===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(K===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(K===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(K===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(K===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(K===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(K===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(K===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},k}();var U=Math.pow(2,32)-1,c=function(){function k(){}return k.init=function(){var W;for(W in k.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},k.types)k.types.hasOwnProperty(W)&&(k.types[W]=[W.charCodeAt(0),W.charCodeAt(1),W.charCodeAt(2),W.charCodeAt(3)]);var K=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Re=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:K,audio:Re};var Ie=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),we=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=we,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var B=new Uint8Array([105,115,111,109]),le=new Uint8Array([97,118,99,49]),ee=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,B,ee,B,le),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,Ie))},k.box=function(W){for(var K=8,Re=arguments.length,Ie=new Array(Re>1?Re-1:0),we=1;we<Re;we++)Ie[we-1]=arguments[we];for(var B=Ie.length,le=B;B--;)K+=Ie[B].byteLength;var ee=new Uint8Array(K);for(ee[0]=K>>24&255,ee[1]=K>>16&255,ee[2]=K>>8&255,ee[3]=255&K,ee.set(W,4),B=0,K=8;B<le;B++)ee.set(Ie[B],K),K+=Ie[B].byteLength;return ee},k.hdlr=function(W){return k.box(k.types.hdlr,k.HDLR_TYPES[W])},k.mdat=function(W){return k.box(k.types.mdat,W)},k.mdhd=function(W,K){K*=W;var Re=Math.floor(K/(U+1)),Ie=Math.floor(K%(U+1));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,W>>24&255,W>>16&255,W>>8&255,255&W,Re>>24,Re>>16&255,Re>>8&255,255&Re,Ie>>24,Ie>>16&255,Ie>>8&255,255&Ie,85,196,0,0]))},k.mdia=function(W){return k.box(k.types.mdia,k.mdhd(W.timescale,W.duration),k.hdlr(W.type),k.minf(W))},k.mfhd=function(W){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,W>>24,W>>16&255,W>>8&255,255&W]))},k.minf=function(W){return W.type==="audio"?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(W)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(W))},k.moof=function(W,K,Re){return k.box(k.types.moof,k.mfhd(W),k.traf(Re,K))},k.moov=function(W){for(var K=W.length,Re=[];K--;)Re[K]=k.trak(W[K]);return k.box.apply(null,[k.types.moov,k.mvhd(W[0].timescale,W[0].duration)].concat(Re).concat(k.mvex(W)))},k.mvex=function(W){for(var K=W.length,Re=[];K--;)Re[K]=k.trex(W[K]);return k.box.apply(null,[k.types.mvex].concat(Re))},k.mvhd=function(W,K){K*=W;var Re=Math.floor(K/(U+1)),Ie=Math.floor(K%(U+1)),we=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,W>>24&255,W>>16&255,W>>8&255,255&W,Re>>24,Re>>16&255,Re>>8&255,255&Re,Ie>>24,Ie>>16&255,Ie>>8&255,255&Ie,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,we)},k.sdtp=function(W){var K,Re,Ie=W.samples||[],we=new Uint8Array(4+Ie.length);for(K=0;K<Ie.length;K++)Re=Ie[K].flags,we[K+4]=Re.dependsOn<<4|Re.isDependedOn<<2|Re.hasRedundancy;return k.box(k.types.sdtp,we)},k.stbl=function(W){return k.box(k.types.stbl,k.stsd(W),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))},k.avc1=function(W){var K,Re,Ie,we=[],B=[];for(K=0;K<W.sps.length;K++)Ie=(Re=W.sps[K]).byteLength,we.push(Ie>>>8&255),we.push(255&Ie),we=we.concat(Array.prototype.slice.call(Re));for(K=0;K<W.pps.length;K++)Ie=(Re=W.pps[K]).byteLength,B.push(Ie>>>8&255),B.push(255&Ie),B=B.concat(Array.prototype.slice.call(Re));var le=k.box(k.types.avcC,new Uint8Array([1,we[3],we[4],we[5],255,224|W.sps.length].concat(we).concat([W.pps.length]).concat(B))),ee=W.width,he=W.height,G=W.pixelRatio[0],xe=W.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ee>>8&255,255&ee,he>>8&255,255&he,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),le,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([G>>24,G>>16&255,G>>8&255,255&G,xe>>24,xe>>16&255,xe>>8&255,255&xe])))},k.esds=function(W){var K=W.config.length;return new Uint8Array([0,0,0,0,3,23+K,0,1,0,4,15+K,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([K]).concat(W.config).concat([6,1,2]))},k.mp4a=function(W){var K=W.samplerate;return k.box(k.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,W.channelCount,0,16,0,0,0,0,K>>8&255,255&K,0,0]),k.box(k.types.esds,k.esds(W)))},k.mp3=function(W){var K=W.samplerate;return k.box(k.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,W.channelCount,0,16,0,0,0,0,K>>8&255,255&K,0,0]))},k.stsd=function(W){return W.type==="audio"?W.segmentCodec==="mp3"&&W.codec==="mp3"?k.box(k.types.stsd,k.STSD,k.mp3(W)):k.box(k.types.stsd,k.STSD,k.mp4a(W)):k.box(k.types.stsd,k.STSD,k.avc1(W))},k.tkhd=function(W){var K=W.id,Re=W.duration*W.timescale,Ie=W.width,we=W.height,B=Math.floor(Re/(U+1)),le=Math.floor(Re%(U+1));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,K>>24&255,K>>16&255,K>>8&255,255&K,0,0,0,0,B>>24,B>>16&255,B>>8&255,255&B,le>>24,le>>16&255,le>>8&255,255&le,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,Ie>>8&255,255&Ie,0,0,we>>8&255,255&we,0,0]))},k.traf=function(W,K){var Re=k.sdtp(W),Ie=W.id,we=Math.floor(K/(U+1)),B=Math.floor(K%(U+1));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,Ie>>24,Ie>>16&255,Ie>>8&255,255&Ie])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,we>>24,we>>16&255,we>>8&255,255&we,B>>24,B>>16&255,B>>8&255,255&B])),k.trun(W,Re.length+16+20+8+16+8+8),Re)},k.trak=function(W){return W.duration=W.duration||4294967295,k.box(k.types.trak,k.tkhd(W),k.mdia(W))},k.trex=function(W){var K=W.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,K>>24,K>>16&255,K>>8&255,255&K,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},k.trun=function(W,K){var Re,Ie,we,B,le,ee,he=W.samples||[],G=he.length,xe=12+16*G,Ge=new Uint8Array(xe);for(K+=8+xe,Ge.set([W.type==="video"?1:0,0,15,1,G>>>24&255,G>>>16&255,G>>>8&255,255&G,K>>>24&255,K>>>16&255,K>>>8&255,255&K],0),Re=0;Re<G;Re++)we=(Ie=he[Re]).duration,B=Ie.size,le=Ie.flags,ee=Ie.cts,Ge.set([we>>>24&255,we>>>16&255,we>>>8&255,255&we,B>>>24&255,B>>>16&255,B>>>8&255,255&B,le.isLeading<<2|le.dependsOn,le.isDependedOn<<6|le.hasRedundancy<<4|le.paddingValue<<1|le.isNonSync,61440&le.degradPrio,15&le.degradPrio,ee>>>24&255,ee>>>16&255,ee>>>8&255,255&ee],12+16*Re);return k.box(k.types.trun,Ge)},k.initSegment=function(W){k.types||k.init();var K=k.moov(W),Re=new Uint8Array(k.FTYP.byteLength+K.byteLength);return Re.set(k.FTYP),Re.set(K,k.FTYP.byteLength),Re},k}();c.types=void 0,c.HDLR_TYPES=void 0,c.STTS=void 0,c.STSC=void 0,c.STCO=void 0,c.STSZ=void 0,c.VMHD=void 0,c.SMHD=void 0,c.STSD=void 0,c.FTYP=void 0,c.DINF=void 0;const M=c;var _=Q(851),ie=Q(973),q=Q(93),V=Q(308),z=Q(673);function ue(){return ue=Object.assign?Object.assign.bind():function(k){for(var W=1;W<arguments.length;W++){var K=arguments[W];for(var Re in K)Object.prototype.hasOwnProperty.call(K,Re)&&(k[Re]=K[Re])}return k},ue.apply(this,arguments)}var de=null,te=null,se=function(){function k(K,Re,Ie,we){if(we===void 0&&(we=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=K,this.config=Re,this.typeSupported=Ie,this.ISGenerated=!1,de===null){var B=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);de=B?parseInt(B[1]):0}if(te===null){var le=navigator.userAgent.match(/Safari\/(\d+)/i);te=le?parseInt(le[1]):0}}var W=k.prototype;return W.destroy=function(){},W.resetTimeStamp=function(K){q.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=K},W.resetNextTimestamp=function(){q.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},W.resetInitSegment=function(){q.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},W.getVideoStartPts=function(K){var Re=!1,Ie=K.reduce(function(we,B){var le=B.pts-we;return le<-4294967296?(Re=!0,oe(we,B.pts)):le>0?we:B.pts},K[0].pts);return Re&&q.logger.debug("PTS rollover detected"),Ie},W.remux=function(K,Re,Ie,we,B,le,ee,he){var G,xe,Ge,qe,it,ye,Ze=B,st=B,Et=K.pid>-1,lt=Re.pid>-1,vt=Re.samples.length,St=K.samples.length>0,gt=ee&&vt>0||vt>1;if((!Et||St)&&(!lt||gt)||this.ISGenerated||ee){this.ISGenerated||(Ge=this.generateIS(K,Re,B));var At,Lt=this.isVideoContiguous,yt=-1;if(gt&&(yt=function(wt){for(var tr=0;tr<wt.length;tr++)if(wt[tr].key)return tr;return-1}(Re.samples),!Lt&&this.config.forceKeyFrameOnDiscontinuity))if(ye=!0,yt>0){q.logger.warn("[mp4-remuxer]: Dropped "+yt+" out of "+vt+" video samples due to a missing keyframe");var Ot=this.getVideoStartPts(Re.samples);Re.samples=Re.samples.slice(yt),Re.dropped+=yt,At=st+=(Re.samples[0].pts-Ot)/Re.inputTimeScale}else yt===-1&&(q.logger.warn("[mp4-remuxer]: No keyframe found out of "+vt+" video samples"),ye=!1);if(this.ISGenerated){if(St&&gt){var _t=this.getVideoStartPts(Re.samples),Jt=(oe(K.samples[0].pts,_t)-_t)/Re.inputTimeScale;Ze+=Math.max(0,Jt),st+=Math.max(0,-Jt)}if(St){if(K.samplerate||(q.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Ge=this.generateIS(K,Re,B)),xe=this.remuxAudio(K,Ze,this.isAudioContiguous,le,lt||gt||he===V.PlaylistLevelType.AUDIO?st:void 0),gt){var Gt=xe?xe.endPTS-xe.startPTS:0;Re.inputTimeScale||(q.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Ge=this.generateIS(K,Re,B)),G=this.remuxVideo(Re,st,Lt,Gt)}}else gt&&(G=this.remuxVideo(Re,st,Lt,0));G&&(G.firstKeyFrame=yt,G.independent=yt!==-1,G.firstKeyFramePTS=At)}}return this.ISGenerated&&(Ie.samples.length&&(it=Ae(Ie,B,this._initPTS,this._initDTS)),we.samples.length&&(qe=be(we,B,this._initPTS))),{audio:xe,video:G,initSegment:Ge,independent:ye,text:qe,id3:it}},W.generateIS=function(K,Re,Ie){var we,B,le,ee=K.samples,he=Re.samples,G=this.typeSupported,xe={},Ge=!(0,Te.isFiniteNumber)(this._initPTS),qe="audio/mp4";if(Ge&&(we=B=1/0),K.config&&ee.length&&(K.timescale=K.samplerate,K.segmentCodec==="mp3"&&(G.mpeg?(qe="audio/mpeg",K.codec=""):G.mp3&&(K.codec="mp3")),xe.audio={id:"audio",container:qe,codec:K.codec,initSegment:K.segmentCodec==="mp3"&&G.mpeg?new Uint8Array(0):M.initSegment([K]),metadata:{channelCount:K.channelCount}},Ge&&(le=K.inputTimeScale,we=B=ee[0].pts-Math.round(le*Ie))),Re.sps&&Re.pps&&he.length&&(Re.timescale=Re.inputTimeScale,xe.video={id:"main",container:"video/mp4",codec:Re.codec,initSegment:M.initSegment([Re]),metadata:{width:Re.width,height:Re.height}},Ge)){le=Re.inputTimeScale;var it=this.getVideoStartPts(he),ye=Math.round(le*Ie);B=Math.min(B,oe(he[0].dts,it)-ye),we=Math.min(we,it-ye)}if(Object.keys(xe).length)return this.ISGenerated=!0,Ge&&(this._initPTS=we,this._initDTS=B),{tracks:xe,initPTS:we,timescale:le}},W.remuxVideo=function(K,Re,Ie,we){var B,le,ee=K.inputTimeScale,he=K.samples,G=[],xe=he.length,Ge=this._initPTS,qe=this.nextAvcDts,it=8,ye=this.videoSampleDuration,Ze=Number.POSITIVE_INFINITY,st=Number.NEGATIVE_INFINITY,Et=!1;Ie&&qe!==null||(qe=Re*ee-(he[0].pts-oe(he[0].dts,he[0].pts)));for(var lt=0;lt<xe;lt++){var vt=he[lt];vt.pts=oe(vt.pts-Ge,qe),vt.dts=oe(vt.dts-Ge,qe),vt.dts<he[lt>0?lt-1:lt].dts&&(Et=!0)}Et&&he.sort(function($e,Ye){var ot=$e.dts-Ye.dts,Tt=$e.pts-Ye.pts;return ot||Tt}),B=he[0].dts;var St=he[he.length-1].dts-B,gt=St?Math.round(St/(xe-1)):ye||K.inputTimeScale/30;if(Ie){var At=B-qe,Lt=At>gt,yt=At<-1;if((Lt||yt)&&(Lt?q.logger.warn("AVC: "+(0,z.toMsFromMpegTsClock)(At,!0)+" ms ("+At+"dts) hole between fragments detected, filling it"):q.logger.warn("AVC: "+(0,z.toMsFromMpegTsClock)(-At,!0)+" ms ("+At+"dts) overlapping between fragments detected"),!yt||qe>he[0].pts)){B=qe;var Ot=he[0].pts-At;he[0].dts=B,he[0].pts=Ot,q.logger.log("Video: First PTS/DTS adjusted: "+(0,z.toMsFromMpegTsClock)(Ot,!0)+"/"+(0,z.toMsFromMpegTsClock)(B,!0)+", delta: "+(0,z.toMsFromMpegTsClock)(At,!0)+" ms")}}B=Math.max(0,B);for(var _t=0,Jt=0,Gt=0;Gt<xe;Gt++){for(var wt=he[Gt],tr=wt.units,Zt=tr.length,rr=0,lr=0;lr<Zt;lr++)rr+=tr[lr].data.length;Jt+=rr,_t+=Zt,wt.length=rr,wt.dts=Math.max(wt.dts,B),Ze=Math.min(wt.pts,Ze),st=Math.max(wt.pts,st)}le=he[xe-1].dts;var ur,hr=Jt+4*_t+8;try{ur=new Uint8Array(hr)}catch($e){return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:ie.ErrorTypes.MUX_ERROR,details:ie.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:hr,reason:"fail allocating video mdat "+hr})}var Xt=new DataView(ur.buffer);Xt.setUint32(0,hr),ur.set(M.types.mdat,4);for(var sr=!1,Ee=Number.POSITIVE_INFINITY,ne=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,re=Number.NEGATIVE_INFINITY,J=0;J<xe;J++){for(var ce=he[J],ve=ce.units,Le=0,Ne=0,ze=ve.length;Ne<ze;Ne++){var Be=ve[Ne],rt=Be.data,pt=Be.data.byteLength;Xt.setUint32(it,pt),it+=4,ur.set(rt,it),it+=pt,Le+=4+pt}var ct=void 0;if(J<xe-1)ye=he[J+1].dts-ce.dts,ct=he[J+1].pts-ce.pts;else{var R=this.config,I=J>0?ce.dts-he[J-1].dts:gt;if(ct=J>0?ce.pts-he[J-1].pts:gt,R.stretchShortVideoTrack&&this.nextAudioPts!==null){var S=Math.floor(R.maxBufferHole*ee),C=(we?Ze+we*ee:this.nextAudioPts)-ce.pts;C>S?((ye=C-I)<0?ye=I:sr=!0,q.logger.log("[mp4-remuxer]: It is approximately "+C/90+" ms to the next segment; using duration "+ye/90+" ms for the last video frame.")):ye=I}else ye=I}var O=Math.round(ce.pts-ce.dts);Ee=Math.min(Ee,ye),x=Math.max(x,ye),ne=Math.min(ne,ct),re=Math.max(re,ct),G.push(new Oe(ce.key,ye,Le,O))}if(G.length){if(de){if(de<70){var Y=G[0].flags;Y.dependsOn=2,Y.isNonSync=0}}else if(te&&re-ne<x-Ee&&gt/x<.025&&G[0].cts===0){q.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var j=B,Z=0,De=G.length;Z<De;Z++){var pe=j+G[Z].duration,ke=j+G[Z].cts;if(Z<De-1){var Fe=pe+G[Z+1].cts;G[Z].duration=Fe-ke}else G[Z].duration=Z?G[Z-1].duration:gt;G[Z].cts=0,j=pe}}}ye=sr||!ye?gt:ye,this.nextAvcDts=qe=le+ye,this.videoSampleDuration=ye,this.isVideoContiguous=!0;var Qe={data1:M.moof(K.sequenceNumber++,B,ue({},K,{samples:G})),data2:ur,startPTS:Ze/ee,endPTS:(st+ye)/ee,startDTS:B/ee,endDTS:qe/ee,type:"video",hasAudio:!1,hasVideo:!0,nb:G.length,dropped:K.dropped};return K.samples=[],K.dropped=0,Qe},W.remuxAudio=function(K,Re,Ie,we,B){var le=K.inputTimeScale,ee=le/(K.samplerate?K.samplerate:le),he=K.segmentCodec==="aac"?1024:1152,G=he*ee,xe=this._initPTS,Ge=K.segmentCodec==="mp3"&&this.typeSupported.mpeg,qe=[],it=B!==void 0,ye=K.samples,Ze=Ge?0:8,st=this.nextAudioPts||-1,Et=Re*le;if(this.isAudioContiguous=Ie=Ie||ye.length&&st>0&&(we&&Math.abs(Et-st)<9e3||Math.abs(oe(ye[0].pts-xe,Et)-st)<20*G),ye.forEach(function(Ne){Ne.pts=oe(Ne.pts-xe,Et)}),!Ie||st<0){if(ye=ye.filter(function(Ne){return Ne.pts>=0}),!ye.length)return;st=B===0?0:we&&!it?Math.max(0,Et):ye[0].pts}if(K.segmentCodec==="aac")for(var lt=this.config.maxAudioFramesDrift,vt=0,St=st;vt<ye.length;vt++){var gt=ye[vt],At=gt.pts,Lt=At-St,yt=Math.abs(1e3*Lt/le);if(Lt<=-lt*G&&it)vt===0&&(q.logger.warn("Audio frame @ "+(At/le).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Lt/le)+" ms."),this.nextAudioPts=st=St=At);else if(Lt>=lt*G&&yt<1e4&&it){var Ot=Math.round(Lt/G);(St=At-Ot*G)<0&&(Ot--,St+=G),vt===0&&(this.nextAudioPts=st=St),q.logger.warn("[mp4-remuxer]: Injecting "+Ot+" audio frame @ "+(St/le).toFixed(3)+"s due to "+Math.round(1e3*Lt/le)+" ms gap.");for(var _t=0;_t<Ot;_t++){var Jt=Math.max(St,0),Gt=$.getSilentFrame(K.manifestCodec||K.codec,K.channelCount);Gt||(q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Gt=gt.unit.subarray()),ye.splice(vt,0,{unit:Gt,pts:Jt}),St+=G,vt++}}gt.pts=St,St+=G}for(var wt,tr=null,Zt=null,rr=0,lr=ye.length;lr--;)rr+=ye[lr].unit.byteLength;for(var ur=0,hr=ye.length;ur<hr;ur++){var Xt=ye[ur],sr=Xt.unit,Ee=Xt.pts;if(Zt!==null)qe[ur-1].duration=Math.round((Ee-Zt)/ee);else{if(Ie&&K.segmentCodec==="aac"&&(Ee=st),tr=Ee,!(rr>0))return;rr+=Ze;try{wt=new Uint8Array(rr)}catch(Ne){return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:ie.ErrorTypes.MUX_ERROR,details:ie.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:rr,reason:"fail allocating audio mdat "+rr})}Ge||(new DataView(wt.buffer).setUint32(0,rr),wt.set(M.types.mdat,4))}wt.set(sr,Ze);var ne=sr.byteLength;Ze+=ne,qe.push(new Oe(!0,he,ne,0)),Zt=Ee}var x=qe.length;if(x){var re=qe[qe.length-1];this.nextAudioPts=st=Zt+ee*re.duration;var J=Ge?new Uint8Array(0):M.moof(K.sequenceNumber++,tr/ee,ue({},K,{samples:qe}));K.samples=[];var ce=tr/le,ve=st/le,Le={data1:J,data2:wt,startPTS:ce,endPTS:ve,startDTS:ce,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:x};return this.isAudioContiguous=!0,Le}},W.remuxEmptyAudio=function(K,Re,Ie,we){var B=K.inputTimeScale,le=B/(K.samplerate?K.samplerate:B),ee=this.nextAudioPts,he=(ee!==null?ee:we.startDTS*B)+this._initDTS,G=we.endDTS*B+this._initDTS,xe=1024*le,Ge=Math.ceil((G-he)/xe),qe=$.getSilentFrame(K.manifestCodec||K.codec,K.channelCount);if(q.logger.warn("[mp4-remuxer]: remux empty Audio"),qe){for(var it=[],ye=0;ye<Ge;ye++){var Ze=he+ye*xe;it.push({unit:qe,pts:Ze,dts:Ze})}return K.samples=it,this.remuxAudio(K,Re,Ie,!1)}q.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},k}();function oe(k,W){var K;if(W===null)return k;for(K=W<k?-8589934592:8589934592;Math.abs(k-W)>4294967296;)k+=K;return k}function Ae(k,W,K,Re){var Ie=k.samples.length;if(Ie){for(var we=k.inputTimeScale,B=0;B<Ie;B++){var le=k.samples[B];le.pts=oe(le.pts-K,W*we)/we,le.dts=oe(le.dts-Re,W*we)/we}var ee=k.samples;return k.samples=[],{samples:ee}}}function be(k,W,K){var Re=k.samples.length;if(Re){for(var Ie=k.inputTimeScale,we=0;we<Re;we++){var B=k.samples[we];B.pts=oe(B.pts-K,W*Ie)/Ie}k.samples.sort(function(ee,he){return ee.pts-he.pts});var le=k.samples;return k.samples=[],{samples:le}}}var Oe=function(k,W,K,Re){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=W,this.size=K,this.cts=Re,this.flags=new P(k)},P=function(k){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=k?2:1,this.isNonSync=k?0:1}},856:(ht,Pe,Q)=>{"use strict";var Te;Q.r(Pe),Q.d(Pe,{MetadataSchema:()=>Te}),function($){$.audioId3="org.id3",$.dateRange="com.apple.quicktime.HLS",$.emsg="https://aomedia.org/emsg/ID3"}(Te||(Te={}))},308:(ht,Pe,Q)=>{"use strict";var Te,$;Q.r(Pe),Q.d(Pe,{PlaylistContextType:()=>Te,PlaylistLevelType:()=>$}),function(U){U.MANIFEST="manifest",U.LEVEL="level",U.AUDIO_TRACK="audioTrack",U.SUBTITLE_TRACK="subtitleTrack"}(Te||(Te={})),function(U){U.MAIN="main",U.AUDIO="audio",U.SUBTITLE="subtitle"}($||($={}))},93:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{enableLogs:()=>M,logger:()=>_});var Te=function(){},$={trace:Te,debug:Te,log:Te,warn:Te,info:Te,error:Te},U=$;function c(ie){var q=self.console[ie];return q?q.bind(self.console,"["+ie+"] >"):Te}function M(ie,q){if(self.console&&ie===!0||typeof ie=="object"){(function(V){for(var z=arguments.length,ue=new Array(z>1?z-1:0),de=1;de<z;de++)ue[de-1]=arguments[de];ue.forEach(function(te){U[te]=V[te]?V[te].bind(V):c(te)})})(ie,"debug","log","info","warn","error");try{U.log('Debug logs enabled for "'+q+'"')}catch(V){U=$}}else U=$}var _=$},63:(ht,Pe,Q)=>{"use strict";Q.r(Pe),Q.d(Pe,{RemuxerTrackIdConfig:()=>_,appendUint8Array:()=>k,bin2str:()=>ie,computeRawDurationFromSamples:()=>be,discardEPB:()=>Ie,findBox:()=>de,getDuration:()=>Ae,getStartDTS:()=>oe,offsetStartDTS:()=>Oe,parseEmsg:()=>we,parseInitSegment:()=>se,parseSEIMessageFromNALu:()=>Re,parseSamples:()=>W,parseSegmentIndex:()=>te,readSint32:()=>z,readUint16:()=>q,readUint32:()=>V,segmentValidRange:()=>P,writeUint32:()=>ue});var Te=Q(145),$=Q(923),U=Q(181),c=Math.pow(2,32)-1,M=[].push,_={video:1,audio:2,id3:3,text:4};function ie(B){return String.fromCharCode.apply(null,B)}function q(B,le){var ee=B[le]<<8|B[le+1];return ee<0?65536+ee:ee}function V(B,le){var ee=z(B,le);return ee<0?4294967296+ee:ee}function z(B,le){return B[le]<<24|B[le+1]<<16|B[le+2]<<8|B[le+3]}function ue(B,le,ee){B[le]=ee>>24,B[le+1]=ee>>16&255,B[le+2]=ee>>8&255,B[le+3]=255&ee}function de(B,le){var ee=[];if(!le.length)return ee;for(var he=B.byteLength,G=0;G<he;){var xe=V(B,G),Ge=xe>1?G+xe:he;if(ie(B.subarray(G+4,G+8))===le[0])if(le.length===1)ee.push(B.subarray(G+8,Ge));else{var qe=de(B.subarray(G+8,Ge),le.slice(1));qe.length&&M.apply(ee,qe)}G=Ge}return ee}function te(B){var le=[],ee=B[0],he=8,G=V(B,he);he+=4,he+=ee===0?8:16,he+=2;var xe=B.length+0,Ge=q(B,he);he+=2;for(var qe=0;qe<Ge;qe++){var it=he,ye=V(B,it);it+=4;var Ze=2147483647&ye;if((2147483648&ye)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var st=V(B,it);it+=4,le.push({referenceSize:Ze,subsegmentDuration:st,info:{duration:st/G,start:xe,end:xe+Ze-1}}),xe+=Ze,he=it+=4}return{earliestPresentationTime:0,timescale:G,version:ee,referencesCount:Ge,references:le}}function se(B){for(var le=[],ee=de(B,["moov","trak"]),he=0;he<ee.length;he++){var G=ee[he],xe=de(G,["tkhd"])[0];if(xe){var Ge=xe[0],qe=Ge===0?12:20,it=V(xe,qe),ye=de(G,["mdia","mdhd"])[0];if(ye){var Ze=V(ye,qe=(Ge=ye[0])===0?12:20),st=de(G,["mdia","hdlr"])[0];if(st){var Et=ie(st.subarray(8,12)),lt={soun:$.ElementaryStreamTypes.AUDIO,vide:$.ElementaryStreamTypes.VIDEO}[Et];if(lt){var vt=de(G,["mdia","minf","stbl","stsd"])[0],St=void 0;vt&&(St=ie(vt.subarray(12,16))),le[it]={timescale:Ze,type:lt},le[lt]={timescale:Ze,id:it,codec:St}}}}}}return de(B,["moov","mvex","trex"]).forEach(function(gt){var At=V(gt,4),Lt=le[At];Lt&&(Lt.default={duration:V(gt,12),flags:V(gt,20)})}),le}function oe(B,le){return de(le,["moof","traf"]).reduce(function(ee,he){var G=de(he,["tfdt"])[0],xe=G[0],Ge=de(he,["tfhd"]).reduce(function(qe,it){var ye=V(it,4),Ze=B[ye];if(Ze){var st=V(G,4);xe===1&&(st*=Math.pow(2,32),st+=V(G,8));var Et=st/(Ze.timescale||9e4);if(isFinite(Et)&&(qe===null||Et<qe))return Et}return qe},null);return Ge!==null&&isFinite(Ge)&&(ee===null||Ge<ee)?Ge:ee},null)||0}function Ae(B,le){for(var ee=0,he=0,G=0,xe=de(B,["moof","traf"]),Ge=0;Ge<xe.length;Ge++){var qe=xe[Ge],it=de(qe,["tfhd"])[0],ye=le[V(it,4)];if(ye){var Ze=ye.default,st=V(it,0)|(Ze==null?void 0:Ze.flags),Et=Ze==null?void 0:Ze.duration;8&st&&(Et=V(it,2&st?12:8));for(var lt=ye.timescale||9e4,vt=de(qe,["trun"]),St=0;St<vt.length;St++)!(ee=be(vt[St]))&&Et&&(ee=Et*V(vt[St],4)),ye.type===$.ElementaryStreamTypes.VIDEO?he+=ee/lt:ye.type===$.ElementaryStreamTypes.AUDIO&&(G+=ee/lt)}}if(he===0&&G===0){for(var gt=0,At=de(B,["sidx"]),Lt=0;Lt<At.length;Lt++){var yt=te(At[Lt]);yt!=null&&yt.references&&(gt+=yt.references.reduce(function(Ot,_t){return Ot+_t.info.duration||0},0))}return gt}return he||G}function be(B){var le=V(B,0),ee=8;1&le&&(ee+=4),4&le&&(ee+=4);for(var he=0,G=V(B,4),xe=0;xe<G;xe++)256&le&&(he+=V(B,ee),ee+=4),512&le&&(ee+=4),1024&le&&(ee+=4),2048&le&&(ee+=4);return he}function Oe(B,le,ee){de(le,["moof","traf"]).forEach(function(he){de(he,["tfhd"]).forEach(function(G){var xe=V(G,4),Ge=B[xe];if(Ge){var qe=Ge.timescale||9e4;de(he,["tfdt"]).forEach(function(it){var ye=it[0],Ze=V(it,4);if(ye===0)Ze-=ee*qe,ue(it,4,Ze=Math.max(Ze,0));else{Ze*=Math.pow(2,32),Ze+=V(it,8),Ze-=ee*qe,Ze=Math.max(Ze,0);var st=Math.floor(Ze/(c+1)),Et=Math.floor(Ze%(c+1));ue(it,4,st),ue(it,8,Et)}})}})})}function P(B){var le={valid:null,remainder:null},ee=de(B,["moof"]);if(!ee)return le;if(ee.length<2)return le.remainder=B,le;var he=ee[ee.length-1];return le.valid=(0,Te.sliceUint8)(B,0,he.byteOffset-8),le.remainder=(0,Te.sliceUint8)(B,he.byteOffset-8),le}function k(B,le){var ee=new Uint8Array(B.length+le.length);return ee.set(B),ee.set(le,B.length),ee}function W(B,le){var ee=[],he=le.samples,G=le.timescale,xe=le.id,Ge=!1;return de(he,["moof"]).map(function(qe){var it=qe.byteOffset-8;de(qe,["traf"]).map(function(ye){var Ze=de(ye,["tfdt"]).map(function(st){var Et=st[0],lt=V(st,4);return Et===1&&(lt*=Math.pow(2,32),lt+=V(st,8)),lt/G})[0];return Ze!==void 0&&(B=Ze),de(ye,["tfhd"]).map(function(st){var Et=V(st,4),lt=16777215&V(st,0),vt=0,St=(16&lt)!=0,gt=0,At=(32&lt)!=0,Lt=8;Et===xe&&((1&lt)!=0&&(Lt+=8),(2&lt)!=0&&(Lt+=4),(8&lt)!=0&&(vt=V(st,Lt),Lt+=4),St&&(gt=V(st,Lt),Lt+=4),At&&(Lt+=4),le.type==="video"&&(Ge=function(yt){if(!yt)return!1;var Ot=yt.indexOf("."),_t=Ot<0?yt:yt.substring(0,Ot);return _t==="hvc1"||_t==="hev1"||_t==="dvh1"||_t==="dvhe"}(le.codec)),de(ye,["trun"]).map(function(yt){var Ot=yt[0],_t=16777215&V(yt,0),Jt=(1&_t)!=0,Gt=0,wt=(4&_t)!=0,tr=(256&_t)!=0,Zt=0,rr=(512&_t)!=0,lr=0,ur=(1024&_t)!=0,hr=(2048&_t)!=0,Xt=0,sr=V(yt,4),Ee=8;Jt&&(Gt=V(yt,Ee),Ee+=4),wt&&(Ee+=4);for(var ne=Gt+it,x=0;x<sr;x++){if(tr?(Zt=V(yt,Ee),Ee+=4):Zt=vt,rr?(lr=V(yt,Ee),Ee+=4):lr=gt,ur&&(Ee+=4),hr&&(Xt=Ot===0?V(yt,Ee):z(yt,Ee),Ee+=4),le.type===$.ElementaryStreamTypes.VIDEO)for(var re=0;re<lr;){var J=V(he,ne);K(Ge,he[ne+=4])&&Re(he.subarray(ne,ne+J),Ge?2:1,B+Xt/G,ee),ne+=J,re+=J+4}B+=Zt/G}}))})})}),ee}function K(B,le){if(B){var ee=le>>1&63;return ee===39||ee===40}return(31&le)==6}function Re(B,le,ee,he){var G=Ie(B),xe=0;xe+=le;for(var Ge=0,qe=0,it=!1,ye=0;xe<G.length;){Ge=0;do{if(xe>=G.length)break;Ge+=ye=G[xe++]}while(ye===255);qe=0;do{if(xe>=G.length)break;qe+=ye=G[xe++]}while(ye===255);var Ze=G.length-xe;if(!it&&Ge===4&&xe<G.length){if(it=!0,G[xe++]===181){var st=q(G,xe);if(xe+=2,st===49){var Et=V(G,xe);if(xe+=4,Et===1195456820){var lt=G[xe++];if(lt===3){var vt=G[xe++],St=64&vt,gt=St?2+3*(31&vt):0,At=new Uint8Array(gt);if(St){At[0]=vt;for(var Lt=1;Lt<gt;Lt++)At[Lt]=G[xe++]}he.push({type:lt,payloadType:Ge,pts:ee,bytes:At})}}}}}else if(Ge===5&&qe<Ze){if(it=!0,qe>16){for(var yt=[],Ot=0;Ot<16;Ot++){var _t=G[xe++].toString(16);yt.push(_t.length==1?"0"+_t:_t),Ot!==3&&Ot!==5&&Ot!==7&&Ot!==9||yt.push("-")}for(var Jt=qe-16,Gt=new Uint8Array(Jt),wt=0;wt<Jt;wt++)Gt[wt]=G[xe++];he.push({payloadType:Ge,pts:ee,uuid:yt.join(""),userData:(0,U.utf8ArrayToStr)(Gt),userDataBytes:Gt})}}else if(qe<Ze)xe+=qe;else if(qe>Ze)break}}function Ie(B){for(var le=B.byteLength,ee=[],he=1;he<le-2;)B[he]===0&&B[he+1]===0&&B[he+2]===3?(ee.push(he+2),he+=2):he++;if(ee.length===0)return B;var G=le-ee.length,xe=new Uint8Array(G),Ge=0;for(he=0;he<G;Ge++,he++)Ge===ee[0]&&(Ge++,ee.shift()),xe[he]=B[Ge];return xe}function we(B){var le=B[0],ee="",he="",G=0,xe=0,Ge=0,qe=0,it=0,ye=0;if(le===0){for(;ie(B.subarray(ye,ye+1))!=="\0";)ee+=ie(B.subarray(ye,ye+1)),ye+=1;for(ee+=ie(B.subarray(ye,ye+1)),ye+=1;ie(B.subarray(ye,ye+1))!=="\0";)he+=ie(B.subarray(ye,ye+1)),ye+=1;he+=ie(B.subarray(ye,ye+1)),ye+=1,G=V(B,12),xe=V(B,16),qe=V(B,20),it=V(B,24),ye=28}else if(le===1){G=V(B,ye+=4);var Ze=V(B,ye+=4),st=V(B,ye+=4);for(ye+=4,Ge=Math.pow(2,32)*Ze+st,Number.isSafeInteger(Ge)||(Ge=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),qe=V(B,ye),it=V(B,ye+=4),ye+=4;ie(B.subarray(ye,ye+1))!=="\0";)ee+=ie(B.subarray(ye,ye+1)),ye+=1;for(ee+=ie(B.subarray(ye,ye+1)),ye+=1;ie(B.subarray(ye,ye+1))!=="\0";)he+=ie(B.subarray(ye,ye+1)),ye+=1;he+=ie(B.subarray(ye,ye+1)),ye+=1}return{schemeIdUri:ee,value:he,timeScale:G,presentationTime:Ge,presentationTimeDelta:xe,eventDuration:qe,id:it,payload:B.subarray(ye,B.byteLength)}}},673:(ht,Pe,Q)=>{"use strict";function Te(M,_,ie,q){ie===void 0&&(ie=1),q===void 0&&(q=!1);var V=M*_*ie;return q?Math.round(V):V}function $(M,_,ie,q){return ie===void 0&&(ie=1),q===void 0&&(q=!1),Te(M,_,1/ie,q)}function U(M,_){return _===void 0&&(_=!1),Te(M,1e3,11111111111111112e-21,_)}function c(M,_){return _===void 0&&(_=1),Te(M,9e4,1/_)}Q.r(Pe),Q.d(Pe,{toMpegTsClockFromTimescale:()=>c,toMsFromMpegTsClock:()=>U,toTimescaleFromBase:()=>Te,toTimescaleFromScale:()=>$})},145:(ht,Pe,Q)=>{"use strict";function Te($,U,c){return Uint8Array.prototype.slice?$.slice(U,c):new Uint8Array(Array.prototype.slice.call($,U,c))}Q.r(Pe),Q.d(Pe,{sliceUint8:()=>Te})},729:ht=>{"use strict";var Pe=Object.prototype.hasOwnProperty,Q="~";function Te(){}function $(_,ie,q){this.fn=_,this.context=ie,this.once=q||!1}function U(_,ie,q,V,z){if(typeof q!="function")throw new TypeError("The listener must be a function");var ue=new $(q,V||_,z),de=Q?Q+ie:ie;return _._events[de]?_._events[de].fn?_._events[de]=[_._events[de],ue]:_._events[de].push(ue):(_._events[de]=ue,_._eventsCount++),_}function c(_,ie){--_._eventsCount==0?_._events=new Te:delete _._events[ie]}function M(){this._events=new Te,this._eventsCount=0}Object.create&&(Te.prototype=Object.create(null),new Te().__proto__||(Q=!1)),M.prototype.eventNames=function(){var _,ie,q=[];if(this._eventsCount===0)return q;for(ie in _=this._events)Pe.call(_,ie)&&q.push(Q?ie.slice(1):ie);return Object.getOwnPropertySymbols?q.concat(Object.getOwnPropertySymbols(_)):q},M.prototype.listeners=function(_){var ie=Q?Q+_:_,q=this._events[ie];if(!q)return[];if(q.fn)return[q.fn];for(var V=0,z=q.length,ue=new Array(z);V<z;V++)ue[V]=q[V].fn;return ue},M.prototype.listenerCount=function(_){var ie=Q?Q+_:_,q=this._events[ie];return q?q.fn?1:q.length:0},M.prototype.emit=function(_,ie,q,V,z,ue){var de=Q?Q+_:_;if(!this._events[de])return!1;var te,se,oe=this._events[de],Ae=arguments.length;if(oe.fn){switch(oe.once&&this.removeListener(_,oe.fn,void 0,!0),Ae){case 1:return oe.fn.call(oe.context),!0;case 2:return oe.fn.call(oe.context,ie),!0;case 3:return oe.fn.call(oe.context,ie,q),!0;case 4:return oe.fn.call(oe.context,ie,q,V),!0;case 5:return oe.fn.call(oe.context,ie,q,V,z),!0;case 6:return oe.fn.call(oe.context,ie,q,V,z,ue),!0}for(se=1,te=new Array(Ae-1);se<Ae;se++)te[se-1]=arguments[se];oe.fn.apply(oe.context,te)}else{var be,Oe=oe.length;for(se=0;se<Oe;se++)switch(oe[se].once&&this.removeListener(_,oe[se].fn,void 0,!0),Ae){case 1:oe[se].fn.call(oe[se].context);break;case 2:oe[se].fn.call(oe[se].context,ie);break;case 3:oe[se].fn.call(oe[se].context,ie,q);break;case 4:oe[se].fn.call(oe[se].context,ie,q,V);break;default:if(!te)for(be=1,te=new Array(Ae-1);be<Ae;be++)te[be-1]=arguments[be];oe[se].fn.apply(oe[se].context,te)}}return!0},M.prototype.on=function(_,ie,q){return U(this,_,ie,q,!1)},M.prototype.once=function(_,ie,q){return U(this,_,ie,q,!0)},M.prototype.removeListener=function(_,ie,q,V){var z=Q?Q+_:_;if(!this._events[z])return this;if(!ie)return c(this,z),this;var ue=this._events[z];if(ue.fn)ue.fn!==ie||V&&!ue.once||q&&ue.context!==q||c(this,z);else{for(var de=0,te=[],se=ue.length;de<se;de++)(ue[de].fn!==ie||V&&!ue[de].once||q&&ue[de].context!==q)&&te.push(ue[de]);te.length?this._events[z]=te.length===1?te[0]:te:c(this,z)}return this},M.prototype.removeAllListeners=function(_){var ie;return _?(ie=Q?Q+_:_,this._events[ie]&&c(this,ie)):(this._events=new Te,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=Q,M.EventEmitter=M,ht.exports=M},945:function(ht){var Pe,Q,Te,$,U;Pe=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Q=/^(?=([^\/?#]*))\1([^]*)$/,Te=/(?:\/|^)\.(?=\/)/g,$=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,U={buildAbsoluteURL:function(c,M,_){if(_=_||{},c=c.trim(),!(M=M.trim())){if(!_.alwaysNormalize)return c;var ie=U.parseURL(c);if(!ie)throw new Error("Error trying to parse base URL.");return ie.path=U.normalizePath(ie.path),U.buildURLFromParts(ie)}var q=U.parseURL(M);if(!q)throw new Error("Error trying to parse relative URL.");if(q.scheme)return _.alwaysNormalize?(q.path=U.normalizePath(q.path),U.buildURLFromParts(q)):M;var V=U.parseURL(c);if(!V)throw new Error("Error trying to parse base URL.");if(!V.netLoc&&V.path&&V.path[0]!=="/"){var z=Q.exec(V.path);V.netLoc=z[1],V.path=z[2]}V.netLoc&&!V.path&&(V.path="/");var ue={scheme:V.scheme,netLoc:q.netLoc,path:null,params:q.params,query:q.query,fragment:q.fragment};if(!q.netLoc&&(ue.netLoc=V.netLoc,q.path[0]!=="/"))if(q.path){var de=V.path,te=de.substring(0,de.lastIndexOf("/")+1)+q.path;ue.path=U.normalizePath(te)}else ue.path=V.path,q.params||(ue.params=V.params,q.query||(ue.query=V.query));return ue.path===null&&(ue.path=_.alwaysNormalize?U.normalizePath(q.path):q.path),U.buildURLFromParts(ue)},parseURL:function(c){var M=Pe.exec(c);return M?{scheme:M[1]||"",netLoc:M[2]||"",path:M[3]||"",params:M[4]||"",query:M[5]||"",fragment:M[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(Te,"");c.length!==(c=c.replace($,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}},ht.exports=U}},Cr={};function pr(ht){var Pe=Cr[ht];if(Pe!==void 0)return Pe.exports;var Q=Cr[ht]={exports:{}};return ri[ht].call(Q.exports,Q,Q.exports,pr),Q.exports}pr.m=ri,pr.n=ht=>{var Pe=ht&&ht.__esModule?()=>ht.default:()=>ht;return pr.d(Pe,{a:Pe}),Pe},pr.d=(ht,Pe)=>{for(var Q in Pe)pr.o(Pe,Q)&&!pr.o(ht,Q)&&Object.defineProperty(ht,Q,{enumerable:!0,get:Pe[Q]})},pr.o=(ht,Pe)=>Object.prototype.hasOwnProperty.call(ht,Pe),pr.r=ht=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(ht,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ht,"__esModule",{value:!0})};var Kr=pr(817);return Kr.default})())},8809:function($i,ri,Cr){"use strict";Cr.d(ri,{Z:function(){return Te}});var pr=($,U,c)=>new Promise((M,_)=>{var ie=z=>{try{V(c.next(z))}catch(ue){_(ue)}},q=z=>{try{V(c.throw(z))}catch(ue){_(ue)}},V=z=>z.done?M(z.value):Promise.resolve(z.value).then(ie,q);V((c=c.apply($,U)).next())});const Kr="oplayer-plugin-hls";let ht=globalThis.Hls;const Pe=($,U,c)=>(c||!(Boolean($.canPlayType("application/x-mpegURL"))||Boolean($.canPlayType("application/vnd.apple.mpegURL"))))&&(U.format==="m3u8"||(U.format==="auto"||typeof U.format=="undefined")&&/m3u8(#|\?|$)/i.test(U.src)),Q=function($,U){let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!c.hlsQualityControl)return;const M=()=>{var ie,q;const V=[{name:$.locales.get("Auto"),default:!0,value:-1}];U.levels.length>1&&U.levels.forEach((z,ue)=>{let de=(z.name||z.height).toString();if(isFinite(+de)&&(de+="p"),c.withBitrate){const te=z.bitrate/1e3,se=te>1e3,oe=se?~~(te/1e3):Math.floor(te);de+=" ("+oe+(se?"m":"k")+"bps)"}return V.push({name:de,default:!1,value:ue})}),(ie=$.plugins.ui)==null||ie.setting.unregister(Kr),(q=$.plugins.ui)==null||q.setting.register({name:$.locales.get("Quality"),type:"selector",key:Kr,icon:$.plugins.ui.icons.quality,onChange:z=>{c.hlsQualitySwitch=="immediate"?(U.currentLevel=z.value,z.value!==-1&&(U.loadLevel=z.value)):(U.nextLevel=z.value,z.value!==-1&&(U.nextLoadLevel=z.value))},children:V})},_=ie=>{var q,V;const z=ie.level;if(U.autoLevelEnabled){const ue=U.levels[z].height,de=$.locales.get("Auto")+(ue?" ("+ue+"p)":"");(q=$.plugins.ui)==null||q.setting.updateLabel(Kr,de)}else(V=$.plugins.ui)==null||V.setting.select(Kr,z+1,!1)};U.once(ht.Events.MANIFEST_PARSED,M),U.on(ht.Events.LEVEL_SWITCHED,(ie,q)=>_(q))},Te=function(){let $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=$.hlsConfig,c=U===void 0?{}:U,M=$.matcher,_=M===void 0?Pe:M,ie=$.options,q;const V=Object.assign({light:!0,hlsQualityControl:!1,hlsQualitySwitch:"smooth"},ie);return V.hlsQualityControl&&(V.light=!1),{name:Kr,key:"hls",load:(z,ue,de)=>pr(this,null,function*(){var te;const se=_(z.$video,ue,V.forceHLS);return q&&((te=z.plugins.ui)==null||te.setting.unregister(Kr),q.destroy(),q=null),de.loader||!se||(ht!=null||(ht=(yield V.light?Cr.e(817).then(Cr.t.bind(Cr,8174,19)):Cr.e(817).then(Cr.t.bind(Cr,7807,19))).default),!ht.isSupported())?!1:(q=new ht(c),q.loadSource(ue.src),q.attachMedia(z.$video),z.isNativeUI||Q(z,q,V),q.on(ht.Events.ERROR,function(oe,Ae){const be=Ae.type,Oe=Ae.details;Ae.fatal?(z.hasError=!0,z.emit("error",Object.assign({},Ae,{pluginName:Kr,message:be+": "+Oe}))):V.showWarning&&z.emit("notice",Object.assign({},Ae,{pluginName:Kr,text:be+": "+Oe}))}),!0)}),apply:z=>(z.on("destroy",()=>{q==null||q.destroy(),q=null}),{value:()=>q,constructor:()=>ht})}}}}]);
