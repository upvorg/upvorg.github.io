(self.webpackChunk_web_index=self.webpackChunk_web_index||[]).push([[458],{9302:function(ze){typeof window!="undefined"&&function(Mt,ft){ze.exports=ft()}(this,function(){return function(Mt){var ft={};function J(X){if(ft[X])return ft[X].exports;var Y=ft[X]={i:X,l:!1,exports:{}};return Mt[X].call(Y.exports,Y,Y.exports,J),Y.l=!0,Y.exports}return J.m=Mt,J.c=ft,J.d=function(X,Y,Z){J.o(X,Y)||Object.defineProperty(X,Y,{enumerable:!0,get:Z})},J.r=function(X){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(X,"__esModule",{value:!0})},J.t=function(X,Y){if(1&Y&&(X=J(X)),8&Y||4&Y&&typeof X=="object"&&X&&X.__esModule)return X;var Z=Object.create(null);if(J.r(Z),Object.defineProperty(Z,"default",{enumerable:!0,value:X}),2&Y&&typeof X!="string")for(var ot in X)J.d(Z,ot,function(_){return X[_]}.bind(null,ot));return Z},J.n=function(X){var Y=X&&X.__esModule?function(){return X.default}:function(){return X};return J.d(Y,"a",Y),Y},J.o=function(X,Y){return Object.prototype.hasOwnProperty.call(X,Y)},J.p="/dist/",J(J.s=13)}([function(Mt,ft,J){"use strict";J.d(ft,"a",function(){return d}),J.d(ft,"b",function(){return E});var X=J(5);function Y(){}var Z={trace:Y,debug:Y,log:Y,warn:Y,info:Y,error:Y},ot=Z;function _(k,C){return C="["+k+"] > "+C}var I=Object(X.a)();function h(k){var C=I.console[k];return C?function(){for(var F=arguments.length,D=new Array(F),U=0;U<F;U++)D[U]=arguments[U];D[0]&&(D[0]=_(k,D[0])),C.apply(I.console,D)}:Y}var d=function(k){if(I.console&&k===!0||typeof k=="object"){(function(C){for(var F=arguments.length,D=new Array(F>1?F-1:0),U=1;U<F;U++)D[U-1]=arguments[U];D.forEach(function(j){ot[j]=C[j]?C[j].bind(C):h(j)})})(k,"debug","log","info","warn","error");try{ot.log()}catch(C){ot=Z}}else ot=Z},E=ot},function(Mt,ft,J){"use strict";ft.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},function(Mt,ft,J){"use strict";var X,Y;J.d(ft,"b",function(){return X}),J.d(ft,"a",function(){return Y}),function(Z){Z.NETWORK_ERROR="networkError",Z.MEDIA_ERROR="mediaError",Z.KEY_SYSTEM_ERROR="keySystemError",Z.MUX_ERROR="muxError",Z.OTHER_ERROR="otherError"}(X||(X={})),function(Z){Z.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",Z.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",Z.KEY_SYSTEM_NO_SESSION="keySystemNoSession",Z.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",Z.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",Z.MANIFEST_LOAD_ERROR="manifestLoadError",Z.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",Z.MANIFEST_PARSING_ERROR="manifestParsingError",Z.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",Z.LEVEL_EMPTY_ERROR="levelEmptyError",Z.LEVEL_LOAD_ERROR="levelLoadError",Z.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",Z.LEVEL_SWITCH_ERROR="levelSwitchError",Z.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",Z.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",Z.FRAG_LOAD_ERROR="fragLoadError",Z.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",Z.FRAG_DECRYPT_ERROR="fragDecryptError",Z.FRAG_PARSING_ERROR="fragParsingError",Z.REMUX_ALLOC_ERROR="remuxAllocError",Z.KEY_LOAD_ERROR="keyLoadError",Z.KEY_LOAD_TIMEOUT="keyLoadTimeOut",Z.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",Z.BUFFER_APPEND_ERROR="bufferAppendError",Z.BUFFER_APPENDING_ERROR="bufferAppendingError",Z.BUFFER_STALLED_ERROR="bufferStalledError",Z.BUFFER_FULL_ERROR="bufferFullError",Z.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",Z.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",Z.INTERNAL_EXCEPTION="internalException"}(Y||(Y={}))},function(Mt,ft,J){"use strict";J.d(ft,"a",function(){return X});var X=Number.isFinite||function(Y){return typeof Y=="number"&&isFinite(Y)};Number.MAX_SAFE_INTEGER},function(Mt,ft,J){"use strict";J.d(ft,"b",function(){return _});var X,Y=J(5),Z=function(){function I(){}return I.isHeader=function(h,d){return d+10<=h.length&&h[d]===73&&h[d+1]===68&&h[d+2]===51&&h[d+3]<255&&h[d+4]<255&&h[d+6]<128&&h[d+7]<128&&h[d+8]<128&&h[d+9]<128},I.isFooter=function(h,d){return d+10<=h.length&&h[d]===51&&h[d+1]===68&&h[d+2]===73&&h[d+3]<255&&h[d+4]<255&&h[d+6]<128&&h[d+7]<128&&h[d+8]<128&&h[d+9]<128},I.getID3Data=function(h,d){for(var E=d,k=0;I.isHeader(h,d);)k+=10,k+=I._readSize(h,d+6),I.isFooter(h,d+10)&&(k+=10),d+=k;if(k>0)return h.subarray(E,E+k)},I._readSize=function(h,d){var E=0;return E=(127&h[d])<<21,E|=(127&h[d+1])<<14,E|=(127&h[d+2])<<7,E|=127&h[d+3]},I.getTimeStamp=function(h){for(var d=I.getID3Frames(h),E=0;E<d.length;E++){var k=d[E];if(I.isTimeStampFrame(k))return I._readTimeStamp(k)}},I.isTimeStampFrame=function(h){return h&&h.key==="PRIV"&&h.info==="com.apple.streaming.transportStreamTimestamp"},I._getFrameData=function(h){var d=String.fromCharCode(h[0],h[1],h[2],h[3]),E=I._readSize(h,4);return{type:d,size:E,data:h.subarray(10,10+E)}},I.getID3Frames=function(h){for(var d=0,E=[];I.isHeader(h,d);){for(var k=I._readSize(h,d+6),C=(d+=10)+k;d+8<C;){var F=I._getFrameData(h.subarray(d)),D=I._decodeFrame(F);D&&E.push(D),d+=F.size+10}I.isFooter(h,d)&&(d+=10)}return E},I._decodeFrame=function(h){return h.type==="PRIV"?I._decodePrivFrame(h):h.type[0]==="W"?I._decodeURLFrame(h):I._decodeTextFrame(h)},I._readTimeStamp=function(h){if(h.data.byteLength===8){var d=new Uint8Array(h.data),E=1&d[3],k=(d[4]<<23)+(d[5]<<15)+(d[6]<<7)+d[7];return k/=45,E&&(k+=4772185884e-2),Math.round(k)}},I._decodePrivFrame=function(h){if(!(h.size<2)){var d=I._utf8ArrayToStr(h.data,!0),E=new Uint8Array(h.data.subarray(d.length+1));return{key:h.type,info:d,data:E.buffer}}},I._decodeTextFrame=function(h){if(!(h.size<2)){if(h.type==="TXXX"){var d=1,E=I._utf8ArrayToStr(h.data.subarray(d),!0);d+=E.length+1;var k=I._utf8ArrayToStr(h.data.subarray(d));return{key:h.type,info:E,data:k}}var C=I._utf8ArrayToStr(h.data.subarray(1));return{key:h.type,data:C}}},I._decodeURLFrame=function(h){if(h.type==="WXXX"){if(h.size<2)return;var d=1,E=I._utf8ArrayToStr(h.data.subarray(d),!0);d+=E.length+1;var k=I._utf8ArrayToStr(h.data.subarray(d));return{key:h.type,info:E,data:k}}var C=I._utf8ArrayToStr(h.data);return{key:h.type,data:C}},I._utf8ArrayToStr=function(h,d){d===void 0&&(d=!1);var E=ot();if(E){var k=E.decode(h);if(d){var C=k.indexOf("\0");return C!==-1?k.substring(0,C):k}return k.replace(/\0/g,"")}for(var F,D,U,j=h.length,N="",K=0;K<j;){if((F=h[K++])===0&&d)return N;if(F!==0&&F!==3)switch(F>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:N+=String.fromCharCode(F);break;case 12:case 13:D=h[K++],N+=String.fromCharCode((31&F)<<6|63&D);break;case 14:D=h[K++],U=h[K++],N+=String.fromCharCode((15&F)<<12|(63&D)<<6|(63&U)<<0)}}return N},I}();function ot(){var I=Object(Y.a)();return X||I.TextDecoder===void 0||(X=new I.TextDecoder("utf-8")),X}var _=Z._utf8ArrayToStr;ft.a=Z},function(Mt,ft,J){"use strict";function X(){return typeof window=="undefined"?self:window}J.d(ft,"a",function(){return X})},function(Mt,ft,J){var X,Y,Z,ot,_;X=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,Y=/^([^\/?#]*)(.*)$/,Z=/(?:\/|^)\.(?=\/)/g,ot=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,_={buildAbsoluteURL:function(I,h,d){if(d=d||{},I=I.trim(),!(h=h.trim())){if(!d.alwaysNormalize)return I;var E=_.parseURL(I);if(!E)throw new Error("Error trying to parse base URL.");return E.path=_.normalizePath(E.path),_.buildURLFromParts(E)}var k=_.parseURL(h);if(!k)throw new Error("Error trying to parse relative URL.");if(k.scheme)return d.alwaysNormalize?(k.path=_.normalizePath(k.path),_.buildURLFromParts(k)):h;var C=_.parseURL(I);if(!C)throw new Error("Error trying to parse base URL.");if(!C.netLoc&&C.path&&C.path[0]!=="/"){var F=Y.exec(C.path);C.netLoc=F[1],C.path=F[2]}C.netLoc&&!C.path&&(C.path="/");var D={scheme:C.scheme,netLoc:k.netLoc,path:null,params:k.params,query:k.query,fragment:k.fragment};if(!k.netLoc&&(D.netLoc=C.netLoc,k.path[0]!=="/"))if(k.path){var U=C.path,j=U.substring(0,U.lastIndexOf("/")+1)+k.path;D.path=_.normalizePath(j)}else D.path=C.path,k.params||(D.params=C.params,k.query||(D.query=C.query));return D.path===null&&(D.path=d.alwaysNormalize?_.normalizePath(k.path):k.path),_.buildURLFromParts(D)},parseURL:function(I){var h=X.exec(I);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(I){for(I=I.split("").reverse().join("").replace(Z,"");I.length!==(I=I.replace(ot,"")).length;);return I.split("").reverse().join("")},buildURLFromParts:function(I){return I.scheme+I.netLoc+I.path+I.params+I.query+I.fragment}},Mt.exports=_},function(Mt,ft,J){"use strict";var X=function(){function k(C,F){this.subtle=C,this.aesIV=F}return k.prototype.decrypt=function(C,F){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},F,C)},k}(),Y=function(){function k(C,F){this.subtle=C,this.key=F}return k.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},k}(),Z=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var C=k.prototype;return C.uint8ArrayToUint32Array_=function(F){for(var D=new DataView(F),U=new Uint32Array(4),j=0;j<4;j++)U[j]=D.getUint32(4*j);return U},C.initTable=function(){var F=this.sBox,D=this.invSBox,U=this.subMix,j=U[0],N=U[1],K=U[2],et=U[3],lt=this.invSubMix,rt=lt[0],dt=lt[1],Rt=lt[2],St=lt[3],ct=new Uint32Array(256),Dt=0,At=0,Ct=0;for(Ct=0;Ct<256;Ct++)ct[Ct]=Ct<128?Ct<<1:Ct<<1^283;for(Ct=0;Ct<256;Ct++){var _t=At^At<<1^At<<2^At<<3^At<<4;_t=_t>>>8^255&_t^99,F[Dt]=_t,D[_t]=Dt;var yt=ct[Dt],zt=ct[yt],Jt=ct[zt],Ft=257*ct[_t]^16843008*_t;j[Dt]=Ft<<24|Ft>>>8,N[Dt]=Ft<<16|Ft>>>16,K[Dt]=Ft<<8|Ft>>>24,et[Dt]=Ft,Ft=16843009*Jt^65537*zt^257*yt^16843008*Dt,rt[_t]=Ft<<24|Ft>>>8,dt[_t]=Ft<<16|Ft>>>16,Rt[_t]=Ft<<8|Ft>>>24,St[_t]=Ft,Dt?(Dt=yt^ct[ct[ct[Jt^yt]]],At^=ct[ct[At]]):Dt=At=1}},C.expandKey=function(F){for(var D=this.uint8ArrayToUint32Array_(F),U=!0,j=0;j<D.length&&U;)U=D[j]===this.key[j],j++;if(!U){this.key=D;var N=this.keySize=D.length;if(N!==4&&N!==6&&N!==8)throw new Error("Invalid aes key size="+N);var K,et,lt,rt,dt=this.ksRows=4*(N+6+1),Rt=this.keySchedule=new Uint32Array(dt),St=this.invKeySchedule=new Uint32Array(dt),ct=this.sBox,Dt=this.rcon,At=this.invSubMix,Ct=At[0],_t=At[1],yt=At[2],zt=At[3];for(K=0;K<dt;K++)K<N?lt=Rt[K]=D[K]:(rt=lt,K%N==0?(rt=ct[(rt=rt<<8|rt>>>24)>>>24]<<24|ct[rt>>>16&255]<<16|ct[rt>>>8&255]<<8|ct[255&rt],rt^=Dt[K/N|0]<<24):N>6&&K%N==4&&(rt=ct[rt>>>24]<<24|ct[rt>>>16&255]<<16|ct[rt>>>8&255]<<8|ct[255&rt]),Rt[K]=lt=(Rt[K-N]^rt)>>>0);for(et=0;et<dt;et++)K=dt-et,rt=3&et?Rt[K]:Rt[K-4],St[et]=et<4||K<=4?rt:Ct[ct[rt>>>24]]^_t[ct[rt>>>16&255]]^yt[ct[rt>>>8&255]]^zt[ct[255&rt]],St[et]=St[et]>>>0}},C.networkToHostOrderSwap=function(F){return F<<24|(65280&F)<<8|(16711680&F)>>8|F>>>24},C.decrypt=function(F,D,U,j){for(var N,K,et,lt,rt,dt,Rt,St,ct,Dt,At,Ct,_t,yt,zt,Jt,Ft,de=this.keySize+6,Ot=this.invKeySchedule,Lt=this.invSBox,ie=this.invSubMix,ae=ie[0],te=ie[1],ce=ie[2],y=ie[3],T=this.uint8ArrayToUint32Array_(U),u=T[0],m=T[1],R=T[2],S=T[3],A=new Int32Array(F),w=new Int32Array(A.length),P=this.networkToHostOrderSwap;D<A.length;){for(ct=P(A[D]),Dt=P(A[D+1]),At=P(A[D+2]),Ct=P(A[D+3]),rt=ct^Ot[0],dt=Ct^Ot[1],Rt=At^Ot[2],St=Dt^Ot[3],_t=4,yt=1;yt<de;yt++)N=ae[rt>>>24]^te[dt>>16&255]^ce[Rt>>8&255]^y[255&St]^Ot[_t],K=ae[dt>>>24]^te[Rt>>16&255]^ce[St>>8&255]^y[255&rt]^Ot[_t+1],et=ae[Rt>>>24]^te[St>>16&255]^ce[rt>>8&255]^y[255&dt]^Ot[_t+2],lt=ae[St>>>24]^te[rt>>16&255]^ce[dt>>8&255]^y[255&Rt]^Ot[_t+3],rt=N,dt=K,Rt=et,St=lt,_t+=4;N=Lt[rt>>>24]<<24^Lt[dt>>16&255]<<16^Lt[Rt>>8&255]<<8^Lt[255&St]^Ot[_t],K=Lt[dt>>>24]<<24^Lt[Rt>>16&255]<<16^Lt[St>>8&255]<<8^Lt[255&rt]^Ot[_t+1],et=Lt[Rt>>>24]<<24^Lt[St>>16&255]<<16^Lt[rt>>8&255]<<8^Lt[255&dt]^Ot[_t+2],lt=Lt[St>>>24]<<24^Lt[rt>>16&255]<<16^Lt[dt>>8&255]<<8^Lt[255&Rt]^Ot[_t+3],_t+=3,w[D]=P(N^u),w[D+1]=P(lt^m),w[D+2]=P(et^R),w[D+3]=P(K^S),u=ct,m=Dt,R=At,S=Ct,D+=4}return j?(zt=w.buffer,Jt=zt.byteLength,(Ft=Jt&&new DataView(zt).getUint8(Jt-1))?zt.slice(0,Jt-Ft):zt):w.buffer},C.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},k}(),ot=J(2),_=J(0),I=J(1),h=J(5),d=Object(h.a)(),E=function(){function k(F,D,U){var j=(U===void 0?{}:U).removePKCS7Padding,N=j===void 0||j;if(this.logEnabled=!0,this.observer=F,this.config=D,this.removePKCS7Padding=N,N)try{var K=d.crypto;K&&(this.subtle=K.subtle||K.webkitSubtle)}catch(et){}this.disableWebCrypto=!this.subtle}var C=k.prototype;return C.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},C.decrypt=function(F,D,U,j){var N=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(_.b.log("JS AES decrypt"),this.logEnabled=!1);var K=this.decryptor;K||(this.decryptor=K=new Z),K.expandKey(D),j(K.decrypt(F,0,U,this.removePKCS7Padding))}else{this.logEnabled&&(_.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var et=this.subtle;this.key!==D&&(this.key=D,this.fastAesKey=new Y(et,D)),this.fastAesKey.expandKey().then(function(lt){new X(et,U).decrypt(F,lt).catch(function(rt){N.onWebCryptoError(rt,F,D,U,j)}).then(function(rt){j(rt)})}).catch(function(lt){N.onWebCryptoError(lt,F,D,U,j)})}},C.onWebCryptoError=function(F,D,U,j,N){this.config.enableSoftwareAES?(_.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(D,U,j,N)):(_.b.error("decrypting error : "+F.message),this.observer.trigger(I.a.ERROR,{type:ot.b.MEDIA_ERROR,details:ot.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:F.message}))},C.destroy=function(){var F=this.decryptor;F&&(F.destroy(),this.decryptor=void 0)},k}();ft.a=E},function(Mt,ft,J){"use strict";var X=Object.prototype.hasOwnProperty,Y="~";function Z(){}function ot(d,E,k){this.fn=d,this.context=E,this.once=k||!1}function _(d,E,k,C,F){if(typeof k!="function")throw new TypeError("The listener must be a function");var D=new ot(k,C||d,F),U=Y?Y+E:E;return d._events[U]?d._events[U].fn?d._events[U]=[d._events[U],D]:d._events[U].push(D):(d._events[U]=D,d._eventsCount++),d}function I(d,E){--d._eventsCount==0?d._events=new Z:delete d._events[E]}function h(){this._events=new Z,this._eventsCount=0}Object.create&&(Z.prototype=Object.create(null),new Z().__proto__||(Y=!1)),h.prototype.eventNames=function(){var d,E,k=[];if(this._eventsCount===0)return k;for(E in d=this._events)X.call(d,E)&&k.push(Y?E.slice(1):E);return Object.getOwnPropertySymbols?k.concat(Object.getOwnPropertySymbols(d)):k},h.prototype.listeners=function(d){var E=Y?Y+d:d,k=this._events[E];if(!k)return[];if(k.fn)return[k.fn];for(var C=0,F=k.length,D=new Array(F);C<F;C++)D[C]=k[C].fn;return D},h.prototype.listenerCount=function(d){var E=Y?Y+d:d,k=this._events[E];return k?k.fn?1:k.length:0},h.prototype.emit=function(d,E,k,C,F,D){var U=Y?Y+d:d;if(!this._events[U])return!1;var j,N,K=this._events[U],et=arguments.length;if(K.fn){switch(K.once&&this.removeListener(d,K.fn,void 0,!0),et){case 1:return K.fn.call(K.context),!0;case 2:return K.fn.call(K.context,E),!0;case 3:return K.fn.call(K.context,E,k),!0;case 4:return K.fn.call(K.context,E,k,C),!0;case 5:return K.fn.call(K.context,E,k,C,F),!0;case 6:return K.fn.call(K.context,E,k,C,F,D),!0}for(N=1,j=new Array(et-1);N<et;N++)j[N-1]=arguments[N];K.fn.apply(K.context,j)}else{var lt,rt=K.length;for(N=0;N<rt;N++)switch(K[N].once&&this.removeListener(d,K[N].fn,void 0,!0),et){case 1:K[N].fn.call(K[N].context);break;case 2:K[N].fn.call(K[N].context,E);break;case 3:K[N].fn.call(K[N].context,E,k);break;case 4:K[N].fn.call(K[N].context,E,k,C);break;default:if(!j)for(lt=1,j=new Array(et-1);lt<et;lt++)j[lt-1]=arguments[lt];K[N].fn.apply(K[N].context,j)}}return!0},h.prototype.on=function(d,E,k){return _(this,d,E,k,!1)},h.prototype.once=function(d,E,k){return _(this,d,E,k,!0)},h.prototype.removeListener=function(d,E,k,C){var F=Y?Y+d:d;if(!this._events[F])return this;if(!E)return I(this,F),this;var D=this._events[F];if(D.fn)D.fn!==E||C&&!D.once||k&&D.context!==k||I(this,F);else{for(var U=0,j=[],N=D.length;U<N;U++)(D[U].fn!==E||C&&!D[U].once||k&&D[U].context!==k)&&j.push(D[U]);j.length?this._events[F]=j.length===1?j[0]:j:I(this,F)}return this},h.prototype.removeAllListeners=function(d){var E;return d?(E=Y?Y+d:d,this._events[E]&&I(this,E)):(this._events=new Z,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=Y,h.EventEmitter=h,Mt.exports=h},function(Mt,ft,J){"use strict";var X=J(1),Y=J(2),Z=J(7),ot=J(3),_=J(0),I=J(5);function h(y,T){return y[T]===255&&(246&y[T+1])==240}function d(y,T){return 1&y[T+1]?7:9}function E(y,T){return(3&y[T+3])<<11|y[T+4]<<3|(224&y[T+5])>>>5}function k(y,T){return!!(T+1<y.length&&h(y,T))}function C(y,T){if(k(y,T)){var u=d(y,T);if(T+u>=y.length)return!1;var m=E(y,T);if(m<=u)return!1;var R=T+m;if(R===y.length||R+1<y.length&&h(y,R))return!0}return!1}function F(y,T,u,m,R){if(!y.samplerate){var S=function(A,w,P,G){var x,W,H,Q,V,q=navigator.userAgent.toLowerCase(),tt=G,it=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(x=1+((192&w[P+2])>>>6),!((W=(60&w[P+2])>>>2)>it.length-1))return Q=(1&w[P+2])<<2,Q|=(192&w[P+3])>>>6,_.b.log("manifest codec:"+G+",ADTS data:type:"+x+",sampleingIndex:"+W+"["+it[W]+"Hz],channelConfig:"+Q),/firefox/i.test(q)?W>=6?(x=5,V=new Array(4),H=W-3):(x=2,V=new Array(2),H=W):q.indexOf("android")!==-1?(x=2,V=new Array(2),H=W):(x=5,V=new Array(4),G&&(G.indexOf("mp4a.40.29")!==-1||G.indexOf("mp4a.40.5")!==-1)||!G&&W>=6?H=W-3:((G&&G.indexOf("mp4a.40.2")!==-1&&(W>=6&&Q===1||/vivaldi/i.test(q))||!G&&Q===1)&&(x=2,V=new Array(2)),H=W)),V[0]=x<<3,V[0]|=(14&W)>>1,V[1]|=(1&W)<<7,V[1]|=Q<<3,x===5&&(V[1]|=(14&H)>>1,V[2]=(1&H)<<7,V[2]|=8,V[3]=0),{config:V,samplerate:it[W],channelCount:Q,codec:"mp4a.40."+x,manifestCodec:tt};A.trigger(X.a.ERROR,{type:Y.b.MEDIA_ERROR,details:Y.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+W})}(T,u,m,R);y.config=S.config,y.samplerate=S.samplerate,y.channelCount=S.channelCount,y.codec=S.codec,y.manifestCodec=S.manifestCodec,_.b.log("parsed codec:"+y.codec+",rate:"+S.samplerate+",nb channel:"+S.channelCount)}}function D(y){return 9216e4/y}function U(y,T,u,m,R){var S=function(x,W,H,Q,V){var q,tt,it=x.length;if(q=d(x,W),tt=E(x,W),(tt-=q)>0&&W+q+tt<=it)return{headerLength:q,frameLength:tt,stamp:H+Q*V}}(T,u,m,R,D(y.samplerate));if(S){var A=S.stamp,w=S.headerLength,P=S.frameLength,G={unit:T.subarray(u+w,u+w+P),pts:A,dts:A};return y.samples.push(G),{sample:G,length:P+w}}}var j=J(4),N=function(){function y(u,m,R){this.observer=u,this.config=R,this.remuxer=m}var T=y.prototype;return T.resetInitSegment=function(u,m,R,S){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:m,duration:S,inputTimeScale:9e4}},T.resetTimeStamp=function(){},y.probe=function(u){if(!u)return!1;for(var m=(j.a.getID3Data(u,0)||[]).length,R=u.length;m<R;m++)if(C(u,m))return _.b.log("ADTS sync word found !"),!0;return!1},T.append=function(u,m,R,S){for(var A=this._audioTrack,w=j.a.getID3Data(u,0)||[],P=j.a.getTimeStamp(w),G=Object(ot.a)(P)?90*P:9e4*m,x=0,W=G,H=u.length,Q=w.length,V=[{pts:W,dts:W,data:w}];Q<H-1;)if(k(u,Q)&&Q+5<H){F(A,this.observer,u,Q,A.manifestCodec);var q=U(A,u,Q,G,x);if(!q){_.b.log("Unable to parse AAC frame");break}Q+=q.length,W=q.sample.pts,x++}else j.a.isHeader(u,Q)?(w=j.a.getID3Data(u,Q),V.push({pts:W,dts:W,data:w}),Q+=w.length):Q++;this.remuxer.remux(A,{samples:[]},{samples:V,inputTimeScale:9e4},{samples:[]},m,R,S)},T.destroy=function(){},y}(),K=J(10),et={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(y,T,u,m,R){if(!(u+24>T.length)){var S=this.parseHeader(T,u);if(S&&u+S.frameLength<=T.length){var A=m+R*(9e4*S.samplesPerFrame/S.sampleRate),w={unit:T.subarray(u,u+S.frameLength),pts:A,dts:A};return y.config=[],y.channelCount=S.channelCount,y.samplerate=S.sampleRate,y.samples.push(w),{sample:w,length:S.frameLength}}}},parseHeader:function(y,T){var u=y[T+1]>>3&3,m=y[T+1]>>1&3,R=y[T+2]>>4&15,S=y[T+2]>>2&3,A=y[T+2]>>1&1;if(u!==1&&R!==0&&R!==15&&S!==3){var w=u===3?3-m:m===3?3:4,P=1e3*et.BitratesMap[14*w+R-1],G=u===3?0:u===2?1:2,x=et.SamplingRateMap[3*G+S],W=y[T+3]>>6==3?1:2,H=et.SamplesCoefficients[u][m],Q=et.BytesInSlot[m],V=8*H*Q;return{sampleRate:x,channelCount:W,frameLength:parseInt(H*P/x+A,10)*Q,samplesPerFrame:V}}},isHeaderPattern:function(y,T){return y[T]===255&&(224&y[T+1])==224&&(6&y[T+1])!=0},isHeader:function(y,T){return!!(T+1<y.length&&this.isHeaderPattern(y,T))},probe:function(y,T){if(T+1<y.length&&this.isHeaderPattern(y,T)){var u=this.parseHeader(y,T),m=4;u&&u.frameLength&&(m=u.frameLength);var R=T+m;if(R===y.length||R+1<y.length&&this.isHeaderPattern(y,R))return!0}return!1}},lt=et,rt=function(){function y(u){this.data=u,this.bytesAvailable=u.byteLength,this.word=0,this.bitsAvailable=0}var T=y.prototype;return T.loadWord=function(){var u=this.data,m=this.bytesAvailable,R=u.byteLength-m,S=new Uint8Array(4),A=Math.min(4,m);if(A===0)throw new Error("no bytes available");S.set(u.subarray(R,R+A)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=8*A,this.bytesAvailable-=A},T.skipBits=function(u){var m;this.bitsAvailable>u?(this.word<<=u,this.bitsAvailable-=u):(u-=this.bitsAvailable,u-=(m=u>>3)>>3,this.bytesAvailable-=m,this.loadWord(),this.word<<=u,this.bitsAvailable-=u)},T.readBits=function(u){var m=Math.min(this.bitsAvailable,u),R=this.word>>>32-m;return u>32&&_.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=m,this.bitsAvailable>0?this.word<<=m:this.bytesAvailable>0&&this.loadWord(),(m=u-m)>0&&this.bitsAvailable?R<<m|this.readBits(m):R},T.skipLZ=function(){var u;for(u=0;u<this.bitsAvailable;++u)if(this.word&2147483648>>>u)return this.word<<=u,this.bitsAvailable-=u,u;return this.loadWord(),u+this.skipLZ()},T.skipUEG=function(){this.skipBits(1+this.skipLZ())},T.skipEG=function(){this.skipBits(1+this.skipLZ())},T.readUEG=function(){var u=this.skipLZ();return this.readBits(u+1)-1},T.readEG=function(){var u=this.readUEG();return 1&u?1+u>>>1:-1*(u>>>1)},T.readBoolean=function(){return this.readBits(1)===1},T.readUByte=function(){return this.readBits(8)},T.readUShort=function(){return this.readBits(16)},T.readUInt=function(){return this.readBits(32)},T.skipScalingList=function(u){var m,R=8,S=8;for(m=0;m<u;m++)S!==0&&(S=(R+this.readEG()+256)%256),R=S===0?R:S},T.readSPS=function(){var u,m,R,S,A,w,P,G=0,x=0,W=0,H=0,Q=this.readUByte.bind(this),V=this.readBits.bind(this),q=this.readUEG.bind(this),tt=this.readBoolean.bind(this),it=this.skipBits.bind(this),Et=this.skipEG.bind(this),ht=this.skipUEG.bind(this),It=this.skipScalingList.bind(this);if(Q(),u=Q(),V(5),it(3),Q(),ht(),u===100||u===110||u===122||u===244||u===44||u===83||u===86||u===118||u===128){var gt=q();if(gt===3&&it(1),ht(),ht(),it(1),tt())for(w=gt!==3?8:12,P=0;P<w;P++)tt()&&It(P<6?16:64)}ht();var Tt=q();if(Tt===0)q();else if(Tt===1)for(it(1),Et(),Et(),m=q(),P=0;P<m;P++)Et();ht(),it(1),R=q(),S=q(),(A=V(1))===0&&it(1),it(1),tt()&&(G=q(),x=q(),W=q(),H=q());var nt=[1,1];if(tt()&&tt())switch(Q()){case 1:nt=[1,1];break;case 2:nt=[12,11];break;case 3:nt=[10,11];break;case 4:nt=[16,11];break;case 5:nt=[40,33];break;case 6:nt=[24,11];break;case 7:nt=[20,11];break;case 8:nt=[32,11];break;case 9:nt=[80,33];break;case 10:nt=[18,11];break;case 11:nt=[15,11];break;case 12:nt=[64,33];break;case 13:nt=[160,99];break;case 14:nt=[4,3];break;case 15:nt=[3,2];break;case 16:nt=[2,1];break;case 255:nt=[Q()<<8|Q(),Q()<<8|Q()]}return{width:Math.ceil(16*(R+1)-2*G-2*x),height:(2-A)*(S+1)*16-(A?2:4)*(W+H),pixelRatio:nt}},T.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},y}(),dt=function(){function y(u,m,R,S){this.decryptdata=R,this.discardEPB=S,this.decrypter=new Z.a(u,m,{removePKCS7Padding:!1})}var T=y.prototype;return T.decryptBuffer=function(u,m){this.decrypter.decrypt(u,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,m)},T.decryptAacSample=function(u,m,R,S){var A=u[m].unit,w=A.subarray(16,A.length-A.length%16),P=w.buffer.slice(w.byteOffset,w.byteOffset+w.length),G=this;this.decryptBuffer(P,function(x){x=new Uint8Array(x),A.set(x,16),S||G.decryptAacSamples(u,m+1,R)})},T.decryptAacSamples=function(u,m,R){for(;;m++){if(m>=u.length)return void R();if(!(u[m].unit.length<32)){var S=this.decrypter.isSync();if(this.decryptAacSample(u,m,R,S),!S)return}}},T.getAvcEncryptedData=function(u){for(var m=16*Math.floor((u.length-48)/160)+16,R=new Int8Array(m),S=0,A=32;A<=u.length-16;A+=160,S+=16)R.set(u.subarray(A,A+16),S);return R},T.getAvcDecryptedUnit=function(u,m){m=new Uint8Array(m);for(var R=0,S=32;S<=u.length-16;S+=160,R+=16)u.set(m.subarray(R,R+16),S);return u},T.decryptAvcSample=function(u,m,R,S,A,w){var P=this.discardEPB(A.data),G=this.getAvcEncryptedData(P),x=this;this.decryptBuffer(G.buffer,function(W){A.data=x.getAvcDecryptedUnit(P,W),w||x.decryptAvcSamples(u,m,R+1,S)})},T.decryptAvcSamples=function(u,m,R,S){for(;;m++,R=0){if(m>=u.length)return void S();for(var A=u[m].units;!(R>=A.length);R++){var w=A[R];if(!(w.data.length<=48||w.type!==1&&w.type!==5)){var P=this.decrypter.isSync();if(this.decryptAvcSample(u,m,R,S,w,P),!P)return}}}},y}(),Rt={video:1,audio:2,id3:3,text:4},St=function(){function y(u,m,R,S){this.observer=u,this.config=R,this.typeSupported=S,this.remuxer=m,this.sampleAes=null,this.pmtUnknownTypes={}}var T=y.prototype;return T.setDecryptData=function(u){u!=null&&u.key!=null&&u.method==="SAMPLE-AES"?this.sampleAes=new dt(this.observer,this.config,u,this.discardEPB):this.sampleAes=null},y.probe=function(u){var m=y._syncOffset(u);return!(m<0)&&(m&&_.b.warn("MPEG2-TS detected but first sync word found @ offset "+m+", junk ahead ?"),!0)},y._syncOffset=function(u){for(var m=Math.min(1e3,u.length-564),R=0;R<m;){if(u[R]===71&&u[R+188]===71&&u[R+376]===71)return R;R++}return-1},y.createTrack=function(u,m){return{container:u==="video"||u==="audio"?"video/mp2t":void 0,type:u,id:Rt[u],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:u==="video"?0:void 0,isAAC:u==="audio"||void 0,duration:u==="audio"?m:void 0}},T.resetInitSegment=function(u,m,R,S){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=y.createTrack("video",S),this._audioTrack=y.createTrack("audio",S),this._id3Track=y.createTrack("id3",S),this._txtTrack=y.createTrack("text",S),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=R,this._duration=S},T.resetTimeStamp=function(){},T.append=function(u,m,R,S){var A,w,P,G,x,W=u.length,H=!1;this.pmtUnknownTypes={},this.contiguous=R;var Q=this.pmtParsed,V=this._avcTrack,q=this._audioTrack,tt=this._id3Track,it=V.pid,Et=q.pid,ht=tt.pid,It=this._pmtId,gt=V.pesData,Tt=q.pesData,nt=tt.pesData,Pt=this._parsePAT,Ht=this._parsePMT.bind(this),xt=this._parsePES,kt=this._parseAVCPES.bind(this),Gt=this._parseAACPES.bind(this),st=this._parseMPEGPES.bind(this),Wt=this._parseID3PES.bind(this),Ut=y._syncOffset(u);for(W-=(W+Ut)%188,A=Ut;A<W;A+=188)if(u[A]===71){if(w=!!(64&u[A+1]),P=((31&u[A+1])<<8)+u[A+2],(48&u[A+3])>>4>1){if((G=A+5+u[A+4])===A+188)continue}else G=A+4;switch(P){case it:w&&(gt&&(x=xt(gt))&&kt(x,!1),gt={data:[],size:0}),gt&&(gt.data.push(u.subarray(G,A+188)),gt.size+=A+188-G);break;case Et:w&&(Tt&&(x=xt(Tt))&&(q.isAAC?Gt(x):st(x)),Tt={data:[],size:0}),Tt&&(Tt.data.push(u.subarray(G,A+188)),Tt.size+=A+188-G);break;case ht:w&&(nt&&(x=xt(nt))&&Wt(x),nt={data:[],size:0}),nt&&(nt.data.push(u.subarray(G,A+188)),nt.size+=A+188-G);break;case 0:w&&(G+=u[G]+1),It=this._pmtId=Pt(u,G);break;case It:w&&(G+=u[G]+1);var wt=Ht(u,G,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);(it=wt.avc)>0&&(V.pid=it),(Et=wt.audio)>0&&(q.pid=Et,q.isAAC=wt.isAAC),(ht=wt.id3)>0&&(tt.pid=ht),H&&!Q&&(_.b.log("reparse from beginning"),H=!1,A=Ut-188),Q=this.pmtParsed=!0;break;case 17:case 8191:break;default:H=!0}}else this.observer.trigger(X.a.ERROR,{type:Y.b.MEDIA_ERROR,details:Y.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});gt&&(x=xt(gt))?(kt(x,!0),V.pesData=null):V.pesData=gt,Tt&&(x=xt(Tt))?(q.isAAC?Gt(x):st(x),q.pesData=null):(Tt&&Tt.size&&_.b.log("last AAC PES packet truncated,might overlap between fragments"),q.pesData=Tt),nt&&(x=xt(nt))?(Wt(x),tt.pesData=null):tt.pesData=nt,this.sampleAes==null?this.remuxer.remux(q,V,tt,this._txtTrack,m,R,S):this.decryptAndRemux(q,V,tt,this._txtTrack,m,R,S)},T.decryptAndRemux=function(u,m,R,S,A,w,P){if(u.samples&&u.isAAC){var G=this;this.sampleAes.decryptAacSamples(u.samples,0,function(){G.decryptAndRemuxAvc(u,m,R,S,A,w,P)})}else this.decryptAndRemuxAvc(u,m,R,S,A,w,P)},T.decryptAndRemuxAvc=function(u,m,R,S,A,w,P){if(m.samples){var G=this;this.sampleAes.decryptAvcSamples(m.samples,0,0,function(){G.remuxer.remux(u,m,R,S,A,w,P)})}else this.remuxer.remux(u,m,R,S,A,w,P)},T.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},T._parsePAT=function(u,m){return(31&u[m+10])<<8|u[m+11]},T._trackUnknownPmt=function(u,m,R){var S=this.pmtUnknownTypes[u]||0;return S===0&&(this.pmtUnknownTypes[u]=0,m.call(_.b,R)),this.pmtUnknownTypes[u]++,S},T._parsePMT=function(u,m,R,S){var A,w,P={audio:-1,avc:-1,id3:-1,isAAC:!0};for(A=m+3+((15&u[m+1])<<8|u[m+2])-4,m+=12+((15&u[m+10])<<8|u[m+11]);m<A;){switch(w=(31&u[m+1])<<8|u[m+2],u[m]){case 207:if(!S){this._trackUnknownPmt(u[m],_.b.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:P.audio===-1&&(P.audio=w);break;case 21:P.id3===-1&&(P.id3=w);break;case 219:if(!S){this._trackUnknownPmt(u[m],_.b.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:P.avc===-1&&(P.avc=w);break;case 3:case 4:R?P.audio===-1&&(P.audio=w,P.isAAC=!1):this._trackUnknownPmt(u[m],_.b.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(u[m],_.b.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(u[m],_.b.log,"Unknown stream type:"+u[m])}m+=5+((15&u[m+3])<<8|u[m+4])}return P},T._parsePES=function(u){var m,R,S,A,w,P,G,x,W=0,H=u.data;if(!u||u.size===0)return null;for(;H[0].length<19&&H.length>1;){var Q=new Uint8Array(H[0].length+H[1].length);Q.set(H[0]),Q.set(H[1],H[0].length),H[0]=Q,H.splice(1,1)}if(((m=H[0])[0]<<16)+(m[1]<<8)+m[2]===1){if((S=(m[4]<<8)+m[5])&&S>u.size-6||(192&(R=m[7])&&(P=536870912*(14&m[9])+4194304*(255&m[10])+16384*(254&m[11])+128*(255&m[12])+(254&m[13])/2,64&R?P-(G=536870912*(14&m[14])+4194304*(255&m[15])+16384*(254&m[16])+128*(255&m[17])+(254&m[18])/2)>54e5&&(_.b.warn(Math.round((P-G)/9e4)+"s delta between PTS and DTS, align them"),P=G):G=P),x=(A=m[8])+9,u.size<=x))return null;u.size-=x,w=new Uint8Array(u.size);for(var V=0,q=H.length;V<q;V++){var tt=(m=H[V]).byteLength;if(x){if(x>tt){x-=tt;continue}m=m.subarray(x),tt-=x,x=0}w.set(m,W),W+=tt}return S&&(S-=A+3),{data:w,pts:P,dts:G,len:S}}return null},T.pushAccesUnit=function(u,m){if(u.units.length&&u.frame){var R=m.samples,S=R.length;if(isNaN(u.pts)){if(!S)return void m.dropped++;var A=R[S-1];u.pts=A.pts,u.dts=A.dts}!this.config.forceKeyFrameOnDiscontinuity||u.key===!0||m.sps&&(S||this.contiguous)?(u.id=S,R.push(u)):m.dropped++}u.debug.length&&_.b.log(u.pts+"/"+u.dts+":"+u.debug)},T._parseAVCPES=function(u,m){var R,S,A,w=this,P=this._avcTrack,G=this._parseAVCNALu(u.data),x=this.avcSample,W=!1,H=this.pushAccesUnit.bind(this),Q=function(V,q,tt,it){return{key:V,pts:q,dts:tt,units:[],debug:it}};u.data=null,x&&G.length&&!P.audFound&&(H(x,P),x=this.avcSample=Q(!1,u.pts,u.dts,"")),G.forEach(function(V){switch(V.type){case 1:S=!0,x||(x=w.avcSample=Q(!0,u.pts,u.dts,"")),x.frame=!0;var q=V.data;if(W&&q.length>4){var tt=new rt(q).readSliceType();tt!==2&&tt!==4&&tt!==7&&tt!==9||(x.key=!0)}break;case 5:S=!0,x||(x=w.avcSample=Q(!0,u.pts,u.dts,"")),x.key=!0,x.frame=!0;break;case 6:S=!0,(R=new rt(w.discardEPB(V.data))).readUByte();for(var it=0,Et=0,ht=!1,It=0;!ht&&R.bytesAvailable>1;){it=0;do it+=It=R.readUByte();while(It===255);Et=0;do Et+=It=R.readUByte();while(It===255);if(it===4&&R.bytesAvailable!==0){if(ht=!0,R.readUByte()===181&&R.readUShort()===49&&R.readUInt()===1195456820&&R.readUByte()===3){var gt=R.readUByte(),Tt=31&gt,nt=[gt,R.readUByte()];for(A=0;A<Tt;A++)nt.push(R.readUByte()),nt.push(R.readUByte()),nt.push(R.readUByte());w._insertSampleInOrder(w._txtTrack.samples,{type:3,pts:u.pts,bytes:nt})}}else if(it===5&&R.bytesAvailable!==0){if(ht=!0,Et>16){var Pt=[];for(A=0;A<16;A++)Pt.push(R.readUByte().toString(16)),A!==3&&A!==5&&A!==7&&A!==9||Pt.push("-");var Ht=Et-16,xt=new Uint8Array(Ht);for(A=0;A<Ht;A++)xt[A]=R.readUByte();w._insertSampleInOrder(w._txtTrack.samples,{pts:u.pts,payloadType:it,uuid:Pt.join(""),userDataBytes:xt,userData:Object(j.b)(xt.buffer)})}}else if(Et<R.bytesAvailable)for(A=0;A<Et;A++)R.readUByte()}break;case 7:if(S=!0,W=!0,!P.sps){var kt=(R=new rt(V.data)).readSPS();P.width=kt.width,P.height=kt.height,P.pixelRatio=kt.pixelRatio,P.sps=[V.data],P.duration=w._duration;var Gt=V.data.subarray(1,4),st="avc1.";for(A=0;A<3;A++){var Wt=Gt[A].toString(16);Wt.length<2&&(Wt="0"+Wt),st+=Wt}P.codec=st}break;case 8:S=!0,P.pps||(P.pps=[V.data]);break;case 9:S=!1,P.audFound=!0,x&&H(x,P),x=w.avcSample=Q(!1,u.pts,u.dts,"");break;case 12:S=!1;break;default:S=!1,x&&(x.debug+="unknown NAL "+V.type+" ")}x&&S&&x.units.push(V)}),m&&x&&(H(x,P),this.avcSample=null)},T._insertSampleInOrder=function(u,m){var R=u.length;if(R>0){if(m.pts>=u[R-1].pts)u.push(m);else for(var S=R-1;S>=0;S--)if(m.pts<u[S].pts){u.splice(S,0,m);break}}else u.push(m)},T._getLastNalUnit=function(){var u,m=this.avcSample;if(!m||m.units.length===0){var R=this._avcTrack.samples;m=R[R.length-1]}if(m){var S=m.units;u=S[S.length-1]}return u},T._parseAVCNALu=function(u){var m,R,S,A,w=0,P=u.byteLength,G=this._avcTrack,x=G.naluState||0,W=x,H=[],Q=-1;for(x===-1&&(Q=0,A=31&u[0],x=0,w=1);w<P;)if(m=u[w++],x)if(x!==1)if(m)if(m===1){if(Q>=0)S={data:u.subarray(Q,w-x-1),type:A},H.push(S);else{var V=this._getLastNalUnit();if(V&&(W&&w<=4-W&&V.state&&(V.data=V.data.subarray(0,V.data.byteLength-W)),(R=w-x-1)>0)){var q=new Uint8Array(V.data.byteLength+R);q.set(V.data,0),q.set(u.subarray(0,R),V.data.byteLength),V.data=q}}w<P?(Q=w,A=31&u[w],x=0):x=-1}else x=0;else x=3;else x=m?0:2;else x=m?0:1;if(Q>=0&&x>=0&&(S={data:u.subarray(Q,P),type:A,state:x},H.push(S)),H.length===0){var tt=this._getLastNalUnit();if(tt){var it=new Uint8Array(tt.data.byteLength+u.byteLength);it.set(tt.data,0),it.set(u,tt.data.byteLength),tt.data=it}}return G.naluState=x,H},T.discardEPB=function(u){for(var m,R,S=u.byteLength,A=[],w=1;w<S-2;)u[w]===0&&u[w+1]===0&&u[w+2]===3?(A.push(w+2),w+=2):w++;if(A.length===0)return u;m=S-A.length,R=new Uint8Array(m);var P=0;for(w=0;w<m;P++,w++)P===A[0]&&(P++,A.shift()),R[w]=u[P];return R},T._parseAACPES=function(u){var m,R,S,A,w,P,G,x=this._audioTrack,W=u.data,H=u.pts,Q=this.aacOverFlow,V=this.aacLastPTS;if(Q){var q=new Uint8Array(Q.byteLength+W.byteLength);q.set(Q,0),q.set(W,Q.byteLength),W=q}for(S=0,w=W.length;S<w-1&&!k(W,S);S++);if(!(S&&(S<w-1?(P="AAC PES did not start with ADTS header,offset:"+S,G=!1):(P="no ADTS header found in AAC PES",G=!0),_.b.warn("parsing error:"+P),this.observer.trigger(X.a.ERROR,{type:Y.b.MEDIA_ERROR,details:Y.a.FRAG_PARSING_ERROR,fatal:G,reason:P}),G))){if(F(x,this.observer,W,S,this.audioCodec),R=0,m=D(x.samplerate),Q&&V){var tt=V+m;Math.abs(tt-H)>1&&(_.b.log("AAC: align PTS for overlapping frames by "+Math.round((tt-H)/90)),H=tt)}for(;S<w;){if(k(W,S)){if(S+5<w){var it=U(x,W,S,H,R);if(it){S+=it.length,A=it.sample.pts,R++;continue}}break}S++}Q=S<w?W.subarray(S,w):null,this.aacOverFlow=Q,this.aacLastPTS=A}},T._parseMPEGPES=function(u){for(var m=u.data,R=m.length,S=0,A=0,w=u.pts;A<R;)if(lt.isHeader(m,A)){var P=lt.appendFrame(this._audioTrack,m,A,w,S);if(!P)break;A+=P.length,S++}else A++},T._parseID3PES=function(u){this._id3Track.samples.push(u)},y}(),ct=function(){function y(u,m,R){this.observer=u,this.config=R,this.remuxer=m}var T=y.prototype;return T.resetInitSegment=function(u,m,R,S){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:m,duration:S,inputTimeScale:9e4}},T.resetTimeStamp=function(){},y.probe=function(u){var m,R,S=j.a.getID3Data(u,0);if(S&&j.a.getTimeStamp(S)!==void 0){for(m=S.length,R=Math.min(u.length-1,m+100);m<R;m++)if(lt.probe(u,m))return _.b.log("MPEG Audio sync word found !"),!0}return!1},T.append=function(u,m,R,S){for(var A=j.a.getID3Data(u,0)||[],w=j.a.getTimeStamp(A),P=w!==void 0?90*w:9e4*m,G=A.length,x=u.length,W=0,H=0,Q=this._audioTrack,V=[{pts:P,dts:P,data:A}];G<x;)if(lt.isHeader(u,G)){var q=lt.appendFrame(Q,u,G,P,W);if(!q)break;G+=q.length,H=q.sample.pts,W++}else j.a.isHeader(u,G)?(A=j.a.getID3Data(u,G),V.push({pts:H,dts:H,data:A}),G+=A.length):G++;this.remuxer.remux(Q,{samples:[]},{samples:V,inputTimeScale:9e4},{samples:[]},m,R,S)},T.destroy=function(){},y}(),Dt=function(){function y(){}return y.getSilentFrame=function(T,u){switch(T){case"mp4a.40.2":if(u===1)return new Uint8Array([0,200,0,128,35,128]);if(u===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(u===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(u===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(u===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(u===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(u===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(u===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(u===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},y}(),At=Math.pow(2,32)-1,Ct=function(){function y(){}return y.init=function(){var T;for(T in y.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},y.types)y.types.hasOwnProperty(T)&&(y.types[T]=[T.charCodeAt(0),T.charCodeAt(1),T.charCodeAt(2),T.charCodeAt(3)]);var u=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),m=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);y.HDLR_TYPES={video:u,audio:m};var R=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);y.STTS=y.STSC=y.STCO=S,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var A=new Uint8Array([105,115,111,109]),w=new Uint8Array([97,118,99,49]),P=new Uint8Array([0,0,0,1]);y.FTYP=y.box(y.types.ftyp,A,P,A,w),y.DINF=y.box(y.types.dinf,y.box(y.types.dref,R))},y.box=function(T){for(var u,m=Array.prototype.slice.call(arguments,1),R=8,S=m.length,A=S;S--;)R+=m[S].byteLength;for((u=new Uint8Array(R))[0]=R>>24&255,u[1]=R>>16&255,u[2]=R>>8&255,u[3]=255&R,u.set(T,4),S=0,R=8;S<A;S++)u.set(m[S],R),R+=m[S].byteLength;return u},y.hdlr=function(T){return y.box(y.types.hdlr,y.HDLR_TYPES[T])},y.mdat=function(T){return y.box(y.types.mdat,T)},y.mdhd=function(T,u){u*=T;var m=Math.floor(u/(At+1)),R=Math.floor(u%(At+1));return y.box(y.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,255&T,m>>24,m>>16&255,m>>8&255,255&m,R>>24,R>>16&255,R>>8&255,255&R,85,196,0,0]))},y.mdia=function(T){return y.box(y.types.mdia,y.mdhd(T.timescale,T.duration),y.hdlr(T.type),y.minf(T))},y.mfhd=function(T){return y.box(y.types.mfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,255&T]))},y.minf=function(T){return T.type==="audio"?y.box(y.types.minf,y.box(y.types.smhd,y.SMHD),y.DINF,y.stbl(T)):y.box(y.types.minf,y.box(y.types.vmhd,y.VMHD),y.DINF,y.stbl(T))},y.moof=function(T,u,m){return y.box(y.types.moof,y.mfhd(T),y.traf(m,u))},y.moov=function(T){for(var u=T.length,m=[];u--;)m[u]=y.trak(T[u]);return y.box.apply(null,[y.types.moov,y.mvhd(T[0].timescale,T[0].duration)].concat(m).concat(y.mvex(T)))},y.mvex=function(T){for(var u=T.length,m=[];u--;)m[u]=y.trex(T[u]);return y.box.apply(null,[y.types.mvex].concat(m))},y.mvhd=function(T,u){u*=T;var m=Math.floor(u/(At+1)),R=Math.floor(u%(At+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,255&T,m>>24,m>>16&255,m>>8&255,255&m,R>>24,R>>16&255,R>>8&255,255&R,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return y.box(y.types.mvhd,S)},y.sdtp=function(T){var u,m,R=T.samples||[],S=new Uint8Array(4+R.length);for(m=0;m<R.length;m++)u=R[m].flags,S[m+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return y.box(y.types.sdtp,S)},y.stbl=function(T){return y.box(y.types.stbl,y.stsd(T),y.box(y.types.stts,y.STTS),y.box(y.types.stsc,y.STSC),y.box(y.types.stsz,y.STSZ),y.box(y.types.stco,y.STCO))},y.avc1=function(T){var u,m,R,S=[],A=[];for(u=0;u<T.sps.length;u++)R=(m=T.sps[u]).byteLength,S.push(R>>>8&255),S.push(255&R),S=S.concat(Array.prototype.slice.call(m));for(u=0;u<T.pps.length;u++)R=(m=T.pps[u]).byteLength,A.push(R>>>8&255),A.push(255&R),A=A.concat(Array.prototype.slice.call(m));var w=y.box(y.types.avcC,new Uint8Array([1,S[3],S[4],S[5],255,224|T.sps.length].concat(S).concat([T.pps.length]).concat(A))),P=T.width,G=T.height,x=T.pixelRatio[0],W=T.pixelRatio[1];return y.box(y.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,P>>8&255,255&P,G>>8&255,255&G,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),w,y.box(y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),y.box(y.types.pasp,new Uint8Array([x>>24,x>>16&255,x>>8&255,255&x,W>>24,W>>16&255,W>>8&255,255&W])))},y.esds=function(T){var u=T.config.length;return new Uint8Array([0,0,0,0,3,23+u,0,1,0,4,15+u,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([u]).concat(T.config).concat([6,1,2]))},y.mp4a=function(T){var u=T.samplerate;return y.box(y.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,T.channelCount,0,16,0,0,0,0,u>>8&255,255&u,0,0]),y.box(y.types.esds,y.esds(T)))},y.mp3=function(T){var u=T.samplerate;return y.box(y.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,T.channelCount,0,16,0,0,0,0,u>>8&255,255&u,0,0]))},y.stsd=function(T){return T.type==="audio"?T.isAAC||T.codec!=="mp3"?y.box(y.types.stsd,y.STSD,y.mp4a(T)):y.box(y.types.stsd,y.STSD,y.mp3(T)):y.box(y.types.stsd,y.STSD,y.avc1(T))},y.tkhd=function(T){var u=T.id,m=T.duration*T.timescale,R=T.width,S=T.height,A=Math.floor(m/(At+1)),w=Math.floor(m%(At+1));return y.box(y.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,u>>24&255,u>>16&255,u>>8&255,255&u,0,0,0,0,A>>24,A>>16&255,A>>8&255,255&A,w>>24,w>>16&255,w>>8&255,255&w,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,R>>8&255,255&R,0,0,S>>8&255,255&S,0,0]))},y.traf=function(T,u){var m=y.sdtp(T),R=T.id,S=Math.floor(u/(At+1)),A=Math.floor(u%(At+1));return y.box(y.types.traf,y.box(y.types.tfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R])),y.box(y.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,A>>24,A>>16&255,A>>8&255,255&A])),y.trun(T,m.length+16+20+8+16+8+8),m)},y.trak=function(T){return T.duration=T.duration||4294967295,y.box(y.types.trak,y.tkhd(T),y.mdia(T))},y.trex=function(T){var u=T.id;return y.box(y.types.trex,new Uint8Array([0,0,0,0,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},y.trun=function(T,u){var m,R,S,A,w,P,G=T.samples||[],x=G.length,W=12+16*x,H=new Uint8Array(W);for(u+=8+W,H.set([0,0,15,1,x>>>24&255,x>>>16&255,x>>>8&255,255&x,u>>>24&255,u>>>16&255,u>>>8&255,255&u],0),m=0;m<x;m++)S=(R=G[m]).duration,A=R.size,w=R.flags,P=R.cts,H.set([S>>>24&255,S>>>16&255,S>>>8&255,255&S,A>>>24&255,A>>>16&255,A>>>8&255,255&A,w.isLeading<<2|w.dependsOn,w.isDependedOn<<6|w.hasRedundancy<<4|w.paddingValue<<1|w.isNonSync,61440&w.degradPrio,15&w.degradPrio,P>>>24&255,P>>>16&255,P>>>8&255,255&P],12+16*m);return y.box(y.types.trun,H)},y.initSegment=function(T){y.types||y.init();var u,m=y.moov(T);return(u=new Uint8Array(y.FTYP.byteLength+m.byteLength)).set(y.FTYP),u.set(m,y.FTYP.byteLength),u},y}();function _t(y,T,u,m){u===void 0&&(u=1),m===void 0&&(m=!1);var R=y*T*u;return m?Math.round(R):R}function yt(y,T){return T===void 0&&(T=!1),_t(y,1e3,1/9e4,T)}function zt(y,T){return T===void 0&&(T=1),_t(y,9e4,1/T)}var Jt=zt(10),Ft=zt(.2),de=null;function Ot(y,T){var u;if(T===void 0)return y;for(u=T<y?-8589934592:8589934592;Math.abs(y-T)>4294967296;)y+=u;return y}var Lt,ie=function(){function y(u,m,R,S){if(this.observer=u,this.config=m,this.typeSupported=R,this.ISGenerated=!1,de===null){var A=navigator.userAgent.match(/Chrome\/(\d+)/i);de=A?parseInt(A[1]):0}}var T=y.prototype;return T.destroy=function(){},T.resetTimeStamp=function(u){this._initPTS=this._initDTS=u},T.resetInitSegment=function(){this.ISGenerated=!1},T.getVideoStartPts=function(u){var m=!1,R=u.reduce(function(S,A){var w=A.pts-S;return w<-4294967296?(m=!0,Ot(S,A.pts)):w>0?S:A.pts},u[0].pts);return m&&_.b.debug("PTS rollover detected"),R},T.remux=function(u,m,R,S,A,w,P){if(this.ISGenerated||this.generateIS(u,m,A),this.ISGenerated){var G=u.samples.length,x=m.samples.length,W=A,H=A;if(G&&x){var Q=this.getVideoStartPts(m.samples),V=(Ot(u.samples[0].pts,Q)-Q)/m.inputTimeScale;W+=Math.max(0,V),H+=Math.max(0,-V)}if(G){u.timescale||(_.b.warn("regenerate InitSegment as audio detected"),this.generateIS(u,m,A));var q,tt=this.remuxAudio(u,W,w,P);x&&(tt&&(q=tt.endPTS-tt.startPTS),m.timescale||(_.b.warn("regenerate InitSegment as video detected"),this.generateIS(u,m,A)),this.remuxVideo(m,H,w,q))}else if(x){var it=this.remuxVideo(m,H,w,0,P);it&&u.codec&&this.remuxEmptyAudio(u,W,w,it)}}R.samples.length&&this.remuxID3(R,A),S.samples.length&&this.remuxText(S,A),this.observer.trigger(X.a.FRAG_PARSED)},T.generateIS=function(u,m,R){var S,A,w=this.observer,P=u.samples,G=m.samples,x=this.typeSupported,W="audio/mp4",H={},Q={tracks:H},V=this._initPTS===void 0;if(V&&(S=A=1/0),u.config&&P.length&&(u.timescale=u.samplerate,_.b.log("audio sampling rate : "+u.samplerate),u.isAAC||(x.mpeg?(W="audio/mpeg",u.codec=""):x.mp3&&(u.codec="mp3")),H.audio={container:W,codec:u.codec,initSegment:!u.isAAC&&x.mpeg?new Uint8Array:Ct.initSegment([u]),metadata:{channelCount:u.channelCount}},V&&(S=A=P[0].pts-Math.round(u.inputTimeScale*R))),m.sps&&m.pps&&G.length){var q=m.inputTimeScale;if(m.timescale=q,H.video={container:"video/mp4",codec:m.codec,initSegment:Ct.initSegment([m]),metadata:{width:m.width,height:m.height}},V){var tt=this.getVideoStartPts(G),it=Math.round(q*R);A=Math.min(A,Ot(G[0].dts,tt)-it),S=Math.min(S,tt-it),this.observer.trigger(X.a.INIT_PTS_FOUND,{initPTS:S})}}else V&&H.audio&&this.observer.trigger(X.a.INIT_PTS_FOUND,{initPTS:S});Object.keys(H).length?(w.trigger(X.a.FRAG_PARSING_INIT_SEGMENT,Q),this.ISGenerated=!0,V&&(this._initPTS=S,this._initDTS=A)):w.trigger(X.a.ERROR,{type:Y.b.MEDIA_ERROR,details:Y.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},T.remuxVideo=function(u,m,R,S){var A,w,P,G,x,W=u.timescale,H=u.samples,Q=[],V=H.length,q=this._initPTS,tt=8,it=Number.POSITIVE_INFINITY,Et=Number.NEGATIVE_INFINITY,ht=0,It=!1,gt=this.nextAvcDts;if(V!==0){R||(gt=m*W-(H[0].pts-Ot(H[0].dts,H[0].pts)));for(var Tt=0;Tt<V;Tt++){var nt=H[Tt];nt.pts=Ot(nt.pts-q,gt),nt.dts=Ot(nt.dts-q,gt),nt.dts>nt.pts&&(ht=Math.max(Math.min(ht,nt.pts-nt.dts),-1*Ft)),nt.dts<H[Tt>0?Tt-1:Tt].dts&&(It=!0)}It&&H.sort(function(ve,Re){var Be=ve.dts-Re.dts,Ge=ve.pts-Re.pts;return Be||Ge||ve.id-Re.id}),G=H[0].dts,x=H[V-1].dts;var Pt=Math.round((x-G)/(V-1));if(ht<0){if(ht<-2*Pt){_.b.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+yt(-Pt,!0)+" ms");for(var Ht=ht,xt=0;xt<V;xt++)H[xt].dts=Ht=Math.max(Ht,H[xt].pts-Pt),H[xt].pts=Math.max(Ht,H[xt].pts)}else{_.b.warn("PTS < DTS detected in video samples, shifting DTS by "+yt(ht,!0)+" ms to overcome this issue");for(var kt=0;kt<V;kt++)H[kt].dts=H[kt].dts+ht}G=H[0].dts,x=H[V-1].dts}if(R){var Gt=G-gt,st=Gt>Pt;if(st||Gt<-1){st?_.b.warn("AVC: "+yt(Gt,!0)+" ms ("+Gt+"dts) hole between fragments detected, filling it"):_.b.warn("AVC: "+yt(-Gt,!0)+" ms ("+Gt+"dts) overlapping between fragments detected"),G=gt;var Wt=H[0].pts-Gt;H[0].dts=G,H[0].pts=Wt,_.b.log("Video: First PTS/DTS adjusted: "+yt(Wt,!0)+"/"+yt(G,!0)+", delta: "+yt(Gt,!0)+" ms")}}de&&de<75&&(G=Math.max(0,G));for(var Ut=0,wt=0,re=0;re<V;re++){for(var qt=H[re],Nt=qt.units,Kt=Nt.length,Vt=0,$t=0;$t<Kt;$t++)Vt+=Nt[$t].data.length;wt+=Vt,Ut+=Kt,qt.length=Vt,qt.dts=Math.max(qt.dts,G),qt.pts=Math.max(qt.pts,qt.dts,0),it=Math.min(qt.pts,it),Et=Math.max(qt.pts,Et)}x=H[V-1].dts;var Yt=wt+4*Ut+8;try{w=new Uint8Array(Yt)}catch(ve){return void this.observer.trigger(X.a.ERROR,{type:Y.b.MUX_ERROR,details:Y.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Yt,reason:"fail allocating video mdat "+Yt})}var se=new DataView(w.buffer);se.setUint32(0,Yt),w.set(Ct.types.mdat,4);for(var Xt=0;Xt<V;Xt++){for(var ne,Zt=H[Xt],he=Zt.units,ge=0,ee=0,Fe=he.length;ee<Fe;ee++){var ye=he[ee],we=ye.data,oe=ye.data.byteLength;se.setUint32(tt,oe),tt+=4,w.set(we,tt),tt+=oe,ge+=4+oe}if(Xt<V-1)A=H[Xt+1].dts-Zt.dts;else{var De=this.config,pe=Zt.dts-H[Xt>0?Xt-1:Xt].dts;if(De.stretchShortVideoTrack){var Ue=De.maxBufferHole,Ce=Math.floor(Ue*W),Se=(S?it+S*W:this.nextAudioPts)-Zt.pts;Se>Ce?((A=Se-pe)<0&&(A=pe),_.b.log("It is approximately "+yt(Se,!1)+" ms to the next segment; using duration "+yt(A,!1)+" ms for the last video frame.")):A=pe}else A=pe}ne=Math.round(Zt.pts-Zt.dts),Q.push({size:ge,duration:A,cts:ne,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Zt.key?2:1,isNonSync:Zt.key?0:1}})}this.nextAvcDts=x+A;var Ne=u.dropped;if(u.nbNalu=0,u.dropped=0,Q.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var _e=Q[0].flags;_e.dependsOn=2,_e.isNonSync=0}u.samples=Q,P=Ct.moof(u.sequenceNumber++,G,u),u.samples=[];var Oe={data1:P,data2:w,startPTS:it/W,endPTS:(Et+A)/W,startDTS:G/W,endDTS:this.nextAvcDts/W,type:"video",hasAudio:!1,hasVideo:!0,nb:Q.length,dropped:Ne};return this.observer.trigger(X.a.FRAG_PARSING_DATA,Oe),Oe}},T.remuxAudio=function(u,m,R,S){var A,w,P,G,x,W,H=u.inputTimeScale,Q=u.timescale,V=H/Q,q=(u.isAAC?1024:1152)*V,tt=this._initPTS,it=!u.isAAC&&this.typeSupported.mpeg,Et=it?0:8,ht=u.samples,It=[],gt=this.nextAudioPts;if(R|=ht.length&&gt&&(S&&Math.abs(m-gt/H)<.1||Math.abs(ht[0].pts-gt-tt)<20*q),ht.forEach(function(ee){ee.pts=ee.dts=Ot(ee.pts-tt,m*H)}),(ht=ht.filter(function(ee){return ee.pts>=0})).length!==0){if(R||(gt=S?Math.max(0,m*H):ht[0].pts),u.isAAC)for(var Tt=this.config.maxAudioFramesDrift,nt=0,Pt=gt;nt<ht.length;){var Ht=ht[nt],xt=Ht.pts,kt=xt-Pt;if(kt<=-Tt*q)R||nt>0?(_.b.warn("Dropping 1 audio frame @ "+yt(Pt,!0)/1e3+"s due to "+yt(kt,!0)+" ms overlap."),ht.splice(nt,1)):(_.b.warn("Audio frame @ "+yt(xt,!0)/1e3+"s overlaps nextAudioPts by "+yt(kt,!0)+" ms."),Pt=xt+q,nt++);else if(kt>=Tt*q&&kt<Jt&&Pt){var Gt=Math.round(kt/q);_.b.warn("Injecting "+Gt+" audio frames @ "+yt(Pt,!0)/1e3+"s due to "+yt(kt,!0)+" ms gap.");for(var st=0;st<Gt;st++){var Wt=Math.max(Pt,0);(w=Dt.getSilentFrame(u.manifestCodec||u.codec,u.channelCount))||(_.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),w=Ht.unit.subarray()),ht.splice(nt,0,{unit:w,pts:Wt,dts:Wt}),Pt+=q,nt++}Ht.pts=Ht.dts=Pt,Pt+=q,nt++}else Math.abs(kt),Ht.pts=Ht.dts=Pt,Pt+=q,nt++}for(var Ut=ht.length,wt=0;Ut--;)wt+=ht[Ut].unit.byteLength;for(var re=0,qt=ht.length;re<qt;re++){var Nt=ht[re],Kt=Nt.unit,Vt=Nt.pts;if(W!==void 0&&A)A.duration=Math.round((Vt-W)/V);else{var $t=Vt-gt,Yt=0;if(R&&u.isAAC&&$t){if($t>0&&$t<Jt)Yt=Math.round((Vt-gt)/q),_.b.log(yt($t,!0)+" ms hole between AAC samples detected,filling it"),Yt>0&&((w=Dt.getSilentFrame(u.manifestCodec||u.codec,u.channelCount))||(w=Kt.subarray()),wt+=Yt*w.length);else if($t<-12){_.b.log("drop overlapping AAC sample, expected/parsed/delta: "+yt(gt,!0)+" ms / "+yt(Vt,!0)+" ms / "+yt(-$t,!0)+" ms"),wt-=Kt.byteLength;continue}Vt=gt}if(x=Vt,!(wt>0))return;wt+=Et;try{P=new Uint8Array(wt)}catch(ee){return void this.observer.trigger(X.a.ERROR,{type:Y.b.MUX_ERROR,details:Y.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:wt,reason:"fail allocating audio mdat "+wt})}it||(new DataView(P.buffer).setUint32(0,wt),P.set(Ct.types.mdat,4));for(var se=0;se<Yt;se++)(w=Dt.getSilentFrame(u.manifestCodec||u.codec,u.channelCount))||(_.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),w=Kt.subarray()),P.set(w,Et),Et+=w.byteLength,A={size:w.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},It.push(A)}P.set(Kt,Et);var Xt=Kt.byteLength;Et+=Xt,A={size:Xt,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},It.push(A),W=Vt}var ne=0;if((Ut=It.length)>=2&&(ne=It[Ut-2].duration,A.duration=ne),Ut){this.nextAudioPts=gt=W+V*ne,u.samples=It,G=it?new Uint8Array:Ct.moof(u.sequenceNumber++,x/V,u),u.samples=[];var Zt=x/H,he=gt/H,ge={data1:G,data2:P,startPTS:Zt,endPTS:he,startDTS:Zt,endDTS:he,type:"audio",hasAudio:!0,hasVideo:!1,nb:Ut};return this.observer.trigger(X.a.FRAG_PARSING_DATA,ge),ge}return null}},T.remuxEmptyAudio=function(u,m,R,S){var A=u.inputTimeScale,w=A/(u.samplerate?u.samplerate:A),P=this.nextAudioPts,G=(P!==void 0?P:S.startDTS*A)+this._initDTS,x=S.endDTS*A+this._initDTS,W=1024*w,H=Math.ceil((x-G)/W),Q=Dt.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);if(_.b.warn("remux empty Audio"),Q){for(var V=[],q=0;q<H;q++){var tt=G+q*W;V.push({unit:Q,pts:tt,dts:tt})}u.samples=V,this.remuxAudio(u,m,R)}else _.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},T.remuxID3=function(u,m){var R=u.samples.length;if(R){for(var S=u.inputTimeScale,A=this._initPTS,w=this._initDTS,P=0;P<R;P++){var G=u.samples[P];G.pts=Ot(G.pts-A,m*S)/S,G.dts=Ot(G.dts-w,m*S)/S}this.observer.trigger(X.a.FRAG_PARSING_METADATA,{samples:u.samples}),u.samples=[]}},T.remuxText=function(u,m){var R=u.samples.length,S=u.inputTimeScale,A=this._initPTS;if(R){for(var w=0;w<R;w++){var P=u.samples[w];P.pts=Ot(P.pts-A,m*S)/S}u.samples.sort(function(G,x){return G.pts-x.pts}),this.observer.trigger(X.a.FRAG_PARSING_USERDATA,{samples:u.samples})}u.samples=[]},y}(),ae=function(){function y(u){this.observer=u}var T=y.prototype;return T.destroy=function(){},T.resetTimeStamp=function(){},T.resetInitSegment=function(){},T.remux=function(u,m,R,S,A,w,P,G){var x=this.observer,W="";u&&(W+="audio"),m&&(W+="video"),x.trigger(X.a.FRAG_PARSING_DATA,{data1:G,startPTS:A,startDTS:A,type:W,hasAudio:!!u,hasVideo:!!m,nb:1,dropped:0}),x.trigger(X.a.FRAG_PARSED)},y}(),te=Object(I.a)();try{Lt=te.performance.now.bind(te.performance)}catch(y){_.b.debug("Unable to use Performance API on this environment"),Lt=te.Date.now}var ce=function(){function y(u,m,R,S){this.observer=u,this.typeSupported=m,this.config=R,this.vendor=S}var T=y.prototype;return T.destroy=function(){var u=this.demuxer;u&&u.destroy()},T.push=function(u,m,R,S,A,w,P,G,x,W,H,Q){var V=this;if(u.byteLength>0&&m!=null&&m.key!=null&&m.method==="AES-128"){var q=this.decrypter;q==null&&(q=this.decrypter=new Z.a(this.observer,this.config));var tt=Lt();q.decrypt(u,m.key.buffer,m.iv.buffer,function(it){var Et=Lt();V.observer.trigger(X.a.FRAG_DECRYPTED,{stats:{tstart:tt,tdecrypt:Et}}),V.pushDecrypted(new Uint8Array(it),m,new Uint8Array(R),S,A,w,P,G,x,W,H,Q)})}else this.pushDecrypted(new Uint8Array(u),m,new Uint8Array(R),S,A,w,P,G,x,W,H,Q)},T.pushDecrypted=function(u,m,R,S,A,w,P,G,x,W,H,Q){var V=this.demuxer,q=this.remuxer;if(!V||P||G){for(var tt,it=this.observer,Et=this.typeSupported,ht=this.config,It=[{demux:St,remux:ie},{demux:K.a,remux:ae},{demux:N,remux:ie},{demux:ct,remux:ie}],gt=0,Tt=It.length;gt<Tt&&!(tt=It[gt]).demux.probe(u);gt++);if(!tt)return void it.trigger(X.a.ERROR,{type:Y.b.MEDIA_ERROR,details:Y.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});q&&q instanceof tt.remux||(q=new tt.remux(it,ht,Et,this.vendor)),V&&V instanceof tt.demux||(V=new tt.demux(it,q,ht,Et),this.probe=tt.demux.probe),this.demuxer=V,this.remuxer=q}(P||G)&&(V.resetInitSegment(R,S,A,W),q.resetInitSegment()),P&&(V.resetTimeStamp(Q),q.resetTimeStamp(Q)),typeof V.setDecryptData=="function"&&V.setDecryptData(m),V.append(u,w,x,H)},y}();ft.a=ce},function(Mt,ft,J){"use strict";var X=J(0),Y=J(1),Z=Math.pow(2,32)-1,ot=function(){function _(h,d){this.observer=h,this.remuxer=d}var I=_.prototype;return I.resetTimeStamp=function(h){this.initPTS=h},I.resetInitSegment=function(h,d,E,k){if(h&&h.byteLength){var C=this.initData=_.parseInitSegment(h);d==null&&(d="mp4a.40.5"),E==null&&(E="avc1.42e01e");var F={};C.audio&&C.video?F.audiovideo={container:"video/mp4",codec:d+","+E,initSegment:k?h:null}:(C.audio&&(F.audio={container:"audio/mp4",codec:d,initSegment:k?h:null}),C.video&&(F.video={container:"video/mp4",codec:E,initSegment:k?h:null})),this.observer.trigger(Y.a.FRAG_PARSING_INIT_SEGMENT,{tracks:F})}else d&&(this.audioCodec=d),E&&(this.videoCodec=E)},_.probe=function(h){return _.findBox({data:h,start:0,end:Math.min(h.length,16384)},["moof"]).length>0},_.bin2str=function(h){return String.fromCharCode.apply(null,h)},_.readUint16=function(h,d){h.data&&(d+=h.start,h=h.data);var E=h[d]<<8|h[d+1];return E<0?65536+E:E},_.readUint32=function(h,d){h.data&&(d+=h.start,h=h.data);var E=h[d]<<24|h[d+1]<<16|h[d+2]<<8|h[d+3];return E<0?4294967296+E:E},_.writeUint32=function(h,d,E){h.data&&(d+=h.start,h=h.data),h[d]=E>>24,h[d+1]=E>>16&255,h[d+2]=E>>8&255,h[d+3]=255&E},_.findBox=function(h,d){var E,k,C,F,D,U,j=[];if(h.data?(D=h.start,C=h.end,h=h.data):(D=0,C=h.byteLength),!d.length)return null;for(E=D;E<C;)U=(k=_.readUint32(h,E))>1?E+k:C,_.bin2str(h.subarray(E+4,E+8))===d[0]&&(d.length===1?j.push({data:h,start:E+8,end:U}):(F=_.findBox({data:h,start:E+8,end:U},d.slice(1))).length&&(j=j.concat(F))),E=U;return j},_.parseSegmentIndex=function(h){var d,E=_.findBox(h,["moov"])[0],k=E?E.end:null,C=0,F=_.findBox(h,["sidx"]);if(!F||!F[0])return null;d=[];var D=(F=F[0]).data[0];C=D===0?8:16;var U=_.readUint32(F,C);C+=4,C+=D===0?8:16,C+=2;var j=F.end+0,N=_.readUint16(F,C);C+=2;for(var K=0;K<N;K++){var et=C,lt=_.readUint32(F,et);et+=4;var rt=2147483647&lt;if((2147483648&lt)>>>31===1)return void console.warn("SIDX has hierarchical references (not supported)");var dt=_.readUint32(F,et);et+=4,d.push({referenceSize:rt,subsegmentDuration:dt,info:{duration:dt/U,start:j,end:j+rt-1}}),j+=rt,C=et+=4}return{earliestPresentationTime:0,timescale:U,version:D,referencesCount:N,references:d,moovEndOffset:k}},_.parseInitSegment=function(h){var d=[];return _.findBox(h,["moov","trak"]).forEach(function(E){var k=_.findBox(E,["tkhd"])[0];if(k){var C=k.data[k.start],F=C===0?12:20,D=_.readUint32(k,F),U=_.findBox(E,["mdia","mdhd"])[0];if(U){F=(C=U.data[U.start])===0?12:20;var j=_.readUint32(U,F),N=_.findBox(E,["mdia","hdlr"])[0];if(N){var K={soun:"audio",vide:"video"}[_.bin2str(N.data.subarray(N.start+8,N.start+12))];if(K){var et=_.findBox(E,["mdia","minf","stbl","stsd"]);if(et.length){et=et[0];var lt=_.bin2str(et.data.subarray(et.start+12,et.start+16));X.b.log("MP4Demuxer:"+K+":"+lt+" found")}d[D]={timescale:j,type:K},d[K]={timescale:j,id:D}}}}}}),d},_.getStartDTS=function(h,d){var E,k,C;return E=_.findBox(d,["moof","traf"]),k=[].concat.apply([],E.map(function(F){return _.findBox(F,["tfhd"]).map(function(D){var U,j;return U=_.readUint32(D,4),j=h[U].timescale||9e4,_.findBox(F,["tfdt"]).map(function(N){var K,et;return K=N.data[N.start],et=_.readUint32(N,4),K===1&&(et*=Math.pow(2,32),et+=_.readUint32(N,8)),et})[0]/j})})),C=Math.min.apply(null,k),isFinite(C)?C:0},_.offsetStartDTS=function(h,d,E){_.findBox(d,["moof","traf"]).map(function(k){return _.findBox(k,["tfhd"]).map(function(C){var F=_.readUint32(C,4),D=h[F].timescale||9e4;_.findBox(k,["tfdt"]).map(function(U){var j=U.data[U.start],N=_.readUint32(U,4);if(j===0)_.writeUint32(U,4,N-E*D);else{N*=Math.pow(2,32),N+=_.readUint32(U,8),N-=E*D,N=Math.max(N,0);var K=Math.floor(N/(Z+1)),et=Math.floor(N%(Z+1));_.writeUint32(U,4,K),_.writeUint32(U,8,et)}})})})},I.append=function(h,d,E,k){var C=this.initData;C||(this.resetInitSegment(h,this.audioCodec,this.videoCodec,!1),C=this.initData);var F,D=this.initPTS;if(D===void 0){var U=_.getStartDTS(C,h);this.initPTS=D=U-d,this.observer.trigger(Y.a.INIT_PTS_FOUND,{initPTS:D})}_.offsetStartDTS(C,h,D),F=_.getStartDTS(C,h),this.remuxer.remux(C.audio,C.video,null,null,F,E,k,h)},I.destroy=function(){},_}();ft.a=ot},function(Mt,ft,J){function X(_){var I={};function h(E){if(I[E])return I[E].exports;var k=I[E]={i:E,l:!1,exports:{}};return _[E].call(k.exports,k,k.exports,h),k.l=!0,k.exports}h.m=_,h.c=I,h.i=function(E){return E},h.d=function(E,k,C){h.o(E,k)||Object.defineProperty(E,k,{configurable:!1,enumerable:!0,get:C})},h.r=function(E){Object.defineProperty(E,"__esModule",{value:!0})},h.n=function(E){var k=E&&E.__esModule?function(){return E.default}:function(){return E};return h.d(k,"a",k),k},h.o=function(E,k){return Object.prototype.hasOwnProperty.call(E,k)},h.p="/",h.oe=function(E){throw console.error(E),E};var d=h(h.s=ENTRY_MODULE);return d.default||d}function Y(_){return(_+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Z(_,I,h){var d={};d[h]=[];var E=I.toString(),k=E.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!k)return d;for(var C,F=k[1],D=new RegExp("(\\\\n|\\W)"+Y(F)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");C=D.exec(E);)C[3]!=="dll-reference"&&d[h].push(C[3]);for(D=new RegExp("\\("+Y(F)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");C=D.exec(E);)_[C[2]]||(d[h].push(C[1]),_[C[2]]=J(C[1]).m),d[C[2]]=d[C[2]]||[],d[C[2]].push(C[4]);for(var U,j=Object.keys(d),N=0;N<j.length;N++)for(var K=0;K<d[j[N]].length;K++)U=d[j[N]][K],isNaN(1*U)||(d[j[N]][K]=1*d[j[N]][K]);return d}function ot(_){return Object.keys(_).reduce(function(I,h){return I||_[h].length>0},!1)}Mt.exports=function(_,I){I=I||{};var h={main:J.m},d=I.all?{main:Object.keys(h.main)}:function(D,U){for(var j={main:[U]},N={main:[]},K={main:{}};ot(j);)for(var et=Object.keys(j),lt=0;lt<et.length;lt++){var rt=et[lt],dt=j[rt].pop();if(K[rt]=K[rt]||{},!K[rt][dt]&&D[rt][dt]){K[rt][dt]=!0,N[rt]=N[rt]||[],N[rt].push(dt);for(var Rt=Z(D,D[rt][dt],rt),St=Object.keys(Rt),ct=0;ct<St.length;ct++)j[St[ct]]=j[St[ct]]||[],j[St[ct]]=j[St[ct]].concat(Rt[St[ct]])}}return N}(h,_),E="";Object.keys(d).filter(function(D){return D!=="main"}).forEach(function(D){for(var U=0;d[D][U];)U++;d[D].push(U),h[D][U]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",E=E+"var "+D+" = ("+X.toString().replace("ENTRY_MODULE",JSON.stringify(U))+")({"+d[D].map(function(j){return JSON.stringify(j)+": "+h[D][j].toString()}).join(",")+`});
`}),E=E+"new (("+X.toString().replace("ENTRY_MODULE",JSON.stringify(_))+")({"+d.main.map(function(D){return JSON.stringify(D)+": "+h.main[D].toString()}).join(",")+"}))(self);";var k=new window.Blob([E],{type:"text/javascript"});if(I.bare)return k;var C=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(k),F=new window.Worker(C);return F.objectURL=C,F}},function(Mt,ft,J){"use strict";J.r(ft);var X=J(9),Y=J(1),Z=J(0),ot=J(8);ft.default=function(_){var I=new ot.EventEmitter;I.trigger=function(d){for(var E=arguments.length,k=new Array(E>1?E-1:0),C=1;C<E;C++)k[C-1]=arguments[C];I.emit.apply(I,[d,d].concat(k))},I.off=function(d){for(var E=arguments.length,k=new Array(E>1?E-1:0),C=1;C<E;C++)k[C-1]=arguments[C];I.removeListener.apply(I,[d].concat(k))};var h=function(d,E){_.postMessage({event:d,data:E})};_.addEventListener("message",function(d){var E=d.data;switch(E.cmd){case"init":var k=JSON.parse(E.config);_.demuxer=new X.a(I,E.typeSupported,k,E.vendor),Object(Z.a)(k.debug),h("init",null);break;case"demux":_.demuxer.push(E.data,E.decryptdata,E.initSegment,E.audioCodec,E.videoCodec,E.timeOffset,E.discontinuity,E.trackSwitch,E.contiguous,E.duration,E.accurateTimeOffset,E.defaultInitPTS)}}),I.on(Y.a.FRAG_DECRYPTED,h),I.on(Y.a.FRAG_PARSING_INIT_SEGMENT,h),I.on(Y.a.FRAG_PARSED,h),I.on(Y.a.ERROR,h),I.on(Y.a.FRAG_PARSING_METADATA,h),I.on(Y.a.FRAG_PARSING_USERDATA,h),I.on(Y.a.INIT_PTS_FOUND,h),I.on(Y.a.FRAG_PARSING_DATA,function(d,E){var k=[],C={event:d,data:E};E.data1&&(C.data1=E.data1.buffer,k.push(E.data1.buffer),delete E.data1),E.data2&&(C.data2=E.data2.buffer,k.push(E.data2.buffer),delete E.data2),_.postMessage(C,k)})}},function(Mt,ft,J){"use strict";J.r(ft),J.d(ft,"default",function(){return yr});var X={};J.r(X),J.d(X,"newCue",function(){return Dr});var Y,Z,ot=J(6),_=J(2),I=J(3),h=J(1),d=J(0),E={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},k=function(){function g(n){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=n,this.onEvent=this.onEvent.bind(this);for(var a=arguments.length,c=new Array(a>1?a-1:0),r=1;r<a;r++)c[r-1]=arguments[r];this.handledEvents=c,this.useGenericHandler=!0,this.registerListeners()}var l=g.prototype;return l.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},l.onHandlerDestroying=function(){},l.onHandlerDestroyed=function(){},l.isEventHandler=function(){return typeof this.handledEvents=="object"&&this.handledEvents.length&&typeof this.onEvent=="function"},l.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(n){if(E[n])throw new Error("Forbidden event-name: "+n);this.hls.on(n,this.onEvent)},this)},l.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(n){this.hls.off(n,this.onEvent)},this)},l.onEvent=function(n,a){this.onEventGeneric(n,a)},l.onEventGeneric=function(n,a){try{(function(c,r){var i="on"+c.replace("hls","");if(typeof this[i]!="function")throw new Error("Event "+c+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,r)}).call(this,n,a).call()}catch(c){d.b.error("An internal error happened while handling event "+n+'. Error message: "'+c.message+'". Here is a stacktrace:',c),this.hls.trigger(h.a.ERROR,{type:_.b.OTHER_ERROR,details:_.a.INTERNAL_EXCEPTION,fatal:!1,event:n,err:c})}},g}();(function(g){g.MANIFEST="manifest",g.LEVEL="level",g.AUDIO_TRACK="audioTrack",g.SUBTITLE_TRACK="subtitleTrack"})(Y||(Y={})),function(g){g.MAIN="main",g.AUDIO="audio",g.SUBTITLE="subtitle"}(Z||(Z={}));var C=J(10);function F(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var D,U=function(){function g(c,r){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=c,this.reluri=r}var l,n,a;return l=g,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(ot.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&F(l.prototype,n),a&&F(l,a),g}();function j(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}(function(g){g.AUDIO="audio",g.VIDEO="video"})(D||(D={}));var N=function(){function g(){var r;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((r={})[D.AUDIO]=!1,r[D.VIDEO]=!1,r),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var l,n,a,c=g.prototype;return c.setByteRange=function(r,i){var s=r.split("@",2),t=[];s.length===1?t[0]=i?i.byteRangeEndOffset:0:t[0]=parseInt(s[1]),t[1]=parseInt(s[0])+t[0],this._byteRange=t},c.addElementaryStream=function(r){this._elementaryStreams[r]=!0},c.hasElementaryStream=function(r){return this._elementaryStreams[r]===!0},c.createInitializationVector=function(r){for(var i=new Uint8Array(16),s=12;s<16;s++)i[s]=r>>8*(15-s)&255;return i},c.setDecryptDataFromLevelKey=function(r,i){var s=r;return r!=null&&r.method&&r.uri&&!r.iv&&((s=new U(r.baseuri,r.reluri)).method=r.method,s.iv=this.createInitializationVector(i)),s},l=g,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(ot.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(r){this._url=r}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var r=this.sn;typeof r!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&d.b.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),r=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,r)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(I.a)(this.programDateTime))return null;var r=Object(I.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*r}},{key:"encrypted",get:function(){return!(!this.decryptdata||this.decryptdata.uri===null||this.decryptdata.key!==null)}}])&&j(l.prototype,n),a&&j(l,a),g}();function K(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var et=function(){function g(c){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=c,this.version=null}var l,n,a;return l=g,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(I.a)(this.fragments[0].programDateTime))}}])&&K(l.prototype,n),a&&K(l,a),g}(),lt=/^(\d+)x(\d+)$/,rt=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,dt=function(){function g(n){for(var a in typeof n=="string"&&(n=g.parseAttrList(n)),n)n.hasOwnProperty(a)&&(this[a]=n[a])}var l=g.prototype;return l.decimalInteger=function(n){var a=parseInt(this[n],10);return a>Number.MAX_SAFE_INTEGER?1/0:a},l.hexadecimalInteger=function(n){if(this[n]){var a=(this[n]||"0x").slice(2);a=(1&a.length?"0":"")+a;for(var c=new Uint8Array(a.length/2),r=0;r<a.length/2;r++)c[r]=parseInt(a.slice(2*r,2*r+2),16);return c}return null},l.hexadecimalIntegerAsNumber=function(n){var a=parseInt(this[n],16);return a>Number.MAX_SAFE_INTEGER?1/0:a},l.decimalFloatingPoint=function(n){return parseFloat(this[n])},l.enumeratedString=function(n){return this[n]},l.decimalResolution=function(n){var a=lt.exec(this[n]);if(a!==null)return{width:parseInt(a[1],10),height:parseInt(a[2],10)}},g.parseAttrList=function(n){var a,c={};for(rt.lastIndex=0;(a=rt.exec(n))!==null;){var r=a[2];r.indexOf('"')===0&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),c[a[1]]=r}return c},g}(),Rt={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function St(g,l){return MediaSource.isTypeSupported((l||"video")+'/mp4;codecs="'+g+'"')}var ct=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,Dt=/#EXT-X-MEDIA:(.*)/g,At=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ct=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,_t=/\.(mp4|m4s|m4v|m4a)$/i,yt=function(){function g(){}return g.findGroup=function(l,n){for(var a=0;a<l.length;a++){var c=l[a];if(c.id===n)return c}},g.convertAVC1ToAVCOTI=function(l){var n,a=l.split(".");return a.length>2?(n=a.shift()+".",n+=parseInt(a.shift()).toString(16),n+=("000"+parseInt(a.shift()).toString(16)).substr(-4)):n=l,n},g.resolve=function(l,n){return ot.buildAbsoluteURL(n,l,{alwaysNormalize:!0})},g.parseMasterPlaylist=function(l,n){var a,c=[],r={},i=!1;function s(p,v){["video","audio"].forEach(function(b){var L=p.filter(function(M){return function(B,z){var $=Rt[z];return!!$&&$[B.slice(0,4)]===!0}(M,b)});if(L.length){var O=L.filter(function(M){return M.lastIndexOf("avc1",0)===0||M.lastIndexOf("mp4a",0)===0});v[b+"Codec"]=O.length>0?O[0]:L[0],p=p.filter(function(M){return L.indexOf(M)===-1})}}),v.unknownCodecs=p}for(ct.lastIndex=0;(a=ct.exec(l))!=null;)if(a[1]){var t={},e=t.attrs=new dt(a[1]);t.url=g.resolve(a[2],n);var o=e.decimalResolution("RESOLUTION");o&&(t.width=o.width,t.height=o.height),t.bitrate=e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),t.name=e.NAME,s([].concat((e.CODECS||"").split(/[ ,]+/)),t),t.videoCodec&&t.videoCodec.indexOf("avc1")!==-1&&(t.videoCodec=g.convertAVC1ToAVCOTI(t.videoCodec)),c.push(t)}else if(a[3]){var f=new dt(a[3]);f["DATA-ID"]&&(i=!0,r[f["DATA-ID"]]=f)}return{levels:c,sessionData:i?r:null}},g.parseMasterPlaylistMedia=function(l,n,a,c){var r;c===void 0&&(c=[]);var i=[],s=0;for(Dt.lastIndex=0;(r=Dt.exec(l))!==null;){var t=new dt(r[1]);if(t.TYPE===a){var e={attrs:t,id:s++,groupId:t["GROUP-ID"],instreamId:t["INSTREAM-ID"],name:t.NAME||t.LANGUAGE,type:a,default:t.DEFAULT==="YES",autoselect:t.AUTOSELECT==="YES",forced:t.FORCED==="YES",lang:t.LANGUAGE};if(t.URI&&(e.url=g.resolve(t.URI,n)),c.length){var o=g.findGroup(c,e.groupId);e.audioCodec=o?o.codec:c[0].codec}i.push(e)}}return i},g.parseLevelPlaylist=function(l,n,a,c,r){var i,s,t,e=0,o=0,f=new et(n),p=0,v=null,b=new N,L=null;for(At.lastIndex=0;(i=At.exec(l))!==null;){var O=i[1];if(O){b.duration=parseFloat(O);var M=(" "+i[2]).slice(1);b.title=M||null,b.tagList.push(M?["INF",O,M]:["INF",O])}else if(i[3]){if(Object(I.a)(b.duration)){var B=e++;b.type=c,b.start=o,t&&(b.levelkey=t),b.sn=B,b.level=a,b.cc=p,b.urlId=r,b.baseurl=n,b.relurl=(" "+i[3]).slice(1),zt(b,v),f.fragments.push(b),v=b,o+=b.duration,b=new N}}else if(i[4]){var z=(" "+i[4]).slice(1);v?b.setByteRange(z,v):b.setByteRange(z)}else if(i[5])b.rawProgramDateTime=(" "+i[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),L===null&&(L=f.fragments.length);else{if(!(i=i[0].match(Ct))){d.b.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<i.length&&i[s]===void 0;s++);var $=(" "+i[s+1]).slice(1),ut=(" "+i[s+2]).slice(1);switch(i[s]){case"#":b.tagList.push(ut?[$,ut]:[$]);break;case"PLAYLIST-TYPE":f.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":e=f.startSN=parseInt($);break;case"TARGETDURATION":f.targetduration=parseFloat($);break;case"VERSION":f.version=parseInt($);break;case"EXTM3U":break;case"ENDLIST":f.live=!1;break;case"DIS":p++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":p=parseInt($);break;case"KEY":var vt=new dt($),mt=vt.enumeratedString("METHOD"),at=vt.URI,Bt=vt.hexadecimalInteger("IV");if((vt.KEYFORMAT||"identity")==="com.apple.streamingkeydelivery"){d.b.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}mt&&(t=new U(n,at),at&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(mt)>=0&&(t.method=mt,t.key=null,t.iv=Bt));break;case"START":var bt=new dt($).decimalFloatingPoint("TIME-OFFSET");Object(I.a)(bt)&&(f.startTimeOffset=bt);break;case"MAP":var Qt=new dt($);b.relurl=Qt.URI,Qt.BYTERANGE&&b.setByteRange(Qt.BYTERANGE),b.baseurl=n,b.level=a,b.type=c,b.sn="initSegment",f.initSegment=b,(b=new N).rawProgramDateTime=f.initSegment.rawProgramDateTime;break;default:d.b.warn("line parsed but not handled: "+i)}}}return(b=v)&&!b.relurl&&(f.fragments.pop(),o-=b.duration),f.totalduration=o,f.averagetargetduration=o/f.fragments.length,f.endSN=e-1,f.startCC=f.fragments[0]?f.fragments[0].cc:0,f.endCC=p,!f.initSegment&&f.fragments.length&&f.fragments.every(function(fe){return _t.test(fe.relurl)})&&(d.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(b=new N).relurl=f.fragments[0].relurl,b.baseurl=n,b.level=a,b.type=c,b.sn="initSegment",f.initSegment=b,f.needSidxRanges=!0),L&&function(fe,le){for(var ke=fe[le],Ee=le-1;Ee>=0;Ee--){var ue=fe[Ee];ue.programDateTime=ke.programDateTime-1e3*ue.duration,ke=ue}}(f.fragments,L),f},g}();function zt(g,l){g.rawProgramDateTime?g.programDateTime=Date.parse(g.rawProgramDateTime):l!=null&&l.programDateTime&&(g.programDateTime=l.endProgramDateTime),Object(I.a)(g.programDateTime)||(g.programDateTime=null,g.rawProgramDateTime=null)}var Jt=window.performance,Ft=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,h.a.MANIFEST_LOADING,h.a.LEVEL_LOADING,h.a.AUDIO_TRACK_LOADING,h.a.SUBTITLE_TRACK_LOADING)||this).loaders={},i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n,a.canHaveQualityLevels=function(r){return r!==Y.AUDIO_TRACK&&r!==Y.SUBTITLE_TRACK},a.mapContextToLevelType=function(r){switch(r.type){case Y.AUDIO_TRACK:return Z.AUDIO;case Y.SUBTITLE_TRACK:return Z.SUBTITLE;default:return Z.MAIN}},a.getResponseUrl=function(r,i){var s=r.url;return s!==void 0&&s.indexOf("data:")!==0||(s=i.url),s};var c=a.prototype;return c.createInternalLoader=function(r){var i=this.hls.config,s=i.pLoader,t=i.loader,e=new(s||t)(i);return r.loader=e,this.loaders[r.type]=e,e},c.getInternalLoader=function(r){return this.loaders[r.type]},c.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},c.destroyInternalLoaders=function(){for(var r in this.loaders){var i=this.loaders[r];i&&i.destroy(),this.resetInternalLoader(r)}},c.destroy=function(){this.destroyInternalLoaders(),g.prototype.destroy.call(this)},c.onManifestLoading=function(r){this.load({url:r.url,type:Y.MANIFEST,level:0,id:null,responseType:"text"})},c.onLevelLoading=function(r){this.load({url:r.url,type:Y.LEVEL,level:r.level,id:r.id,responseType:"text"})},c.onAudioTrackLoading=function(r){this.load({url:r.url,type:Y.AUDIO_TRACK,level:null,id:r.id,responseType:"text"})},c.onSubtitleTrackLoading=function(r){this.load({url:r.url,type:Y.SUBTITLE_TRACK,level:null,id:r.id,responseType:"text"})},c.load=function(r){var i=this.hls.config;d.b.debug("Loading playlist of type "+r.type+", level: "+r.level+", id: "+r.id);var s,t,e,o,f=this.getInternalLoader(r);if(f){var p=f.context;if(p&&p.url===r.url)return d.b.trace("playlist request ongoing"),!1;d.b.warn("aborting previous loader for type: "+r.type),f.abort()}switch(r.type){case Y.MANIFEST:s=i.manifestLoadingMaxRetry,t=i.manifestLoadingTimeOut,e=i.manifestLoadingRetryDelay,o=i.manifestLoadingMaxRetryTimeout;break;case Y.LEVEL:s=0,o=0,e=0,t=i.levelLoadingTimeOut;break;default:s=i.levelLoadingMaxRetry,t=i.levelLoadingTimeOut,e=i.levelLoadingRetryDelay,o=i.levelLoadingMaxRetryTimeout}f=this.createInternalLoader(r);var v={timeout:t,maxRetry:s,retryDelay:e,maxRetryDelay:o},b={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return d.b.debug("Calling internal loader delegate for URL: "+r.url),f.load(r,v,b),!0},c.loadsuccess=function(r,i,s,t){if(t===void 0&&(t=null),s.isSidxRequest)return this._handleSidxRequest(r,s),void this._handlePlaylistLoaded(r,i,s,t);if(this.resetInternalLoader(s.type),typeof r.data!="string")throw new Error('expected responseType of "text" for PlaylistLoader');var e=r.data;i.tload=Jt.now(),e.indexOf("#EXTM3U")===0?e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(r,i,s,t):this._handleMasterPlaylist(r,i,s,t):this._handleManifestParsingError(r,s,"no EXTM3U delimiter",t)},c.loaderror=function(r,i,s){s===void 0&&(s=null),this._handleNetworkError(i,s,!1,r)},c.loadtimeout=function(r,i,s){s===void 0&&(s=null),this._handleNetworkError(i,s,!0)},c._handleMasterPlaylist=function(r,i,s,t){var e=this.hls,o=r.data,f=a.getResponseUrl(r,s),p=yt.parseMasterPlaylist(o,f),v=p.levels,b=p.sessionData;if(v.length){var L=v.map(function($){return{id:$.attrs.AUDIO,codec:$.audioCodec}}),O=yt.parseMasterPlaylistMedia(o,f,"AUDIO",L),M=yt.parseMasterPlaylistMedia(o,f,"SUBTITLES"),B=yt.parseMasterPlaylistMedia(o,f,"CLOSED-CAPTIONS");if(O.length){var z=!1;O.forEach(function($){$.url||(z=!0)}),z===!1&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(d.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),O.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}e.trigger(h.a.MANIFEST_LOADED,{levels:v,audioTracks:O,subtitles:M,captions:B,url:f,stats:i,networkDetails:t,sessionData:b})}else this._handleManifestParsingError(r,s,"no level found in manifest",t)},c._handleTrackOrLevelPlaylist=function(r,i,s,t){var e=this.hls,o=s.id,f=s.level,p=s.type,v=a.getResponseUrl(r,s),b=Object(I.a)(o)?o:0,L=Object(I.a)(f)?f:b,O=a.mapContextToLevelType(s),M=yt.parseLevelPlaylist(r.data,v,L,O,b);if(M.tload=i.tload,M.fragments.length){if(p===Y.MANIFEST){var B={url:v,details:M};e.trigger(h.a.MANIFEST_LOADED,{levels:[B],audioTracks:[],url:v,stats:i,networkDetails:t,sessionData:null})}if(i.tparsed=Jt.now(),M.needSidxRanges){var z=M.initSegment.url;this.load({url:z,isSidxRequest:!0,type:p,level:f,levelDetails:M,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else s.levelDetails=M,this._handlePlaylistLoaded(r,i,s,t)}else e.trigger(h.a.ERROR,{type:_.b.NETWORK_ERROR,details:_.a.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof s.level=="number"?s.level:void 0})},c._handleSidxRequest=function(r,i){if(typeof r.data=="string")throw new Error("sidx request must be made with responseType of array buffer");var s=C.a.parseSegmentIndex(new Uint8Array(r.data));if(s){var t=s.references,e=i.levelDetails;t.forEach(function(o,f){var p=o.info;if(e){var v=e.fragments[f];v.byteRange.length===0&&v.setByteRange(String(1+p.end-p.start)+"@"+String(p.start))}}),e&&e.initSegment.setByteRange(String(s.moovEndOffset)+"@0")}},c._handleManifestParsingError=function(r,i,s,t){this.hls.trigger(h.a.ERROR,{type:_.b.NETWORK_ERROR,details:_.a.MANIFEST_PARSING_ERROR,fatal:!0,url:r.url,reason:s,networkDetails:t})},c._handleNetworkError=function(r,i,s,t){var e,o;s===void 0&&(s=!1),t===void 0&&(t=null),d.b.info("A network error occured while loading a "+r.type+"-type playlist");var f=this.getInternalLoader(r);switch(r.type){case Y.MANIFEST:e=s?_.a.MANIFEST_LOAD_TIMEOUT:_.a.MANIFEST_LOAD_ERROR,o=!0;break;case Y.LEVEL:e=s?_.a.LEVEL_LOAD_TIMEOUT:_.a.LEVEL_LOAD_ERROR,o=!1;break;case Y.AUDIO_TRACK:e=s?_.a.AUDIO_TRACK_LOAD_TIMEOUT:_.a.AUDIO_TRACK_LOAD_ERROR,o=!1;break;default:o=!1}f&&(f.abort(),this.resetInternalLoader(r.type));var p={type:_.b.NETWORK_ERROR,details:e,fatal:o,url:r.url,loader:f,context:r,networkDetails:i};t&&(p.response=t),this.hls.trigger(h.a.ERROR,p)},c._handlePlaylistLoaded=function(r,i,s,t){var e=s.type,o=s.level,f=s.id,p=s.levelDetails;if(p&&p.targetduration)if(a.canHaveQualityLevels(s.type))this.hls.trigger(h.a.LEVEL_LOADED,{details:p,level:o||0,id:f||0,stats:i,networkDetails:t});else switch(e){case Y.AUDIO_TRACK:this.hls.trigger(h.a.AUDIO_TRACK_LOADED,{details:p,id:f,stats:i,networkDetails:t});break;case Y.SUBTITLE_TRACK:this.hls.trigger(h.a.SUBTITLE_TRACK_LOADED,{details:p,id:f,stats:i,networkDetails:t})}else this._handleManifestParsingError(r,s,"invalid target duration",t)},a}(k),de=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,h.a.FRAG_LOADING)||this).loaders={},i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.destroy=function(){var r=this.loaders;for(var i in r){var s=r[i];s&&s.destroy()}this.loaders={},g.prototype.destroy.call(this)},c.onFragLoading=function(r){var i=r.frag,s=i.type,t=this.loaders,e=this.hls.config,o=e.fLoader,f=e.loader;i.loaded=0;var p,v,b,L=t[s];L&&(d.b.warn("abort previous fragment loader for type: "+s),L.abort()),L=t[s]=i.loader=e.fLoader?new o(e):new f(e),p={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var O=i.byteRangeStartOffset,M=i.byteRangeEndOffset;Object(I.a)(O)&&Object(I.a)(M)&&(p.rangeStart=O,p.rangeEnd=M),v={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},b={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},L.load(p,v,b)},c.loadsuccess=function(r,i,s,t){t===void 0&&(t=null);var e=r.data,o=s.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(h.a.FRAG_LOADED,{payload:e,frag:o,stats:i,networkDetails:t})},c.loaderror=function(r,i,s){s===void 0&&(s=null);var t=i.frag,e=t.loader;e&&e.abort(),this.loaders[t.type]=void 0,this.hls.trigger(h.a.ERROR,{type:_.b.NETWORK_ERROR,details:_.a.FRAG_LOAD_ERROR,fatal:!1,frag:i.frag,response:r,networkDetails:s})},c.loadtimeout=function(r,i,s){s===void 0&&(s=null);var t=i.frag,e=t.loader;e&&e.abort(),this.loaders[t.type]=void 0,this.hls.trigger(h.a.ERROR,{type:_.b.NETWORK_ERROR,details:_.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i.frag,networkDetails:s})},c.loadprogress=function(r,i,s,t){t===void 0&&(t=null);var e=i.frag;e.loaded=r.loaded,this.hls.trigger(h.a.FRAG_LOAD_PROGRESS,{frag:e,stats:r,networkDetails:t})},a}(k),Ot=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,h.a.KEY_LOADING)||this).loaders={},i.decryptkey=null,i.decrypturl=null,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.destroy=function(){for(var r in this.loaders){var i=this.loaders[r];i&&i.destroy()}this.loaders={},g.prototype.destroy.call(this)},c.onKeyLoading=function(r){var i=r.frag,s=i.type,t=this.loaders[s];if(i.decryptdata){var e=i.decryptdata.uri;if(e!==this.decrypturl||this.decryptkey===null){var o=this.hls.config;if(t&&(d.b.warn("abort previous key loader for type:"+s),t.abort()),!e)return void d.b.warn("key uri is falsy");i.loader=this.loaders[s]=new o.loader(o),this.decrypturl=e,this.decryptkey=null;var f={url:e,frag:i,responseType:"arraybuffer"},p={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.loader.load(f,p,v)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(h.a.KEY_LOADED,{frag:i}))}else d.b.warn("Missing decryption data on fragment in onKeyLoading")},c.loadsuccess=function(r,i,s){var t=s.frag;t.decryptdata?(this.decryptkey=t.decryptdata.key=new Uint8Array(r.data),t.loader=void 0,delete this.loaders[t.type],this.hls.trigger(h.a.KEY_LOADED,{frag:t})):d.b.error("after key load, decryptdata unset")},c.loaderror=function(r,i){var s=i.frag,t=s.loader;t&&t.abort(),delete this.loaders[s.type],this.hls.trigger(h.a.ERROR,{type:_.b.NETWORK_ERROR,details:_.a.KEY_LOAD_ERROR,fatal:!1,frag:s,response:r})},c.loadtimeout=function(r,i){var s=i.frag,t=s.loader;t&&t.abort(),delete this.loaders[s.type],this.hls.trigger(h.a.ERROR,{type:_.b.NETWORK_ERROR,details:_.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:s})},a}(k),Lt="NOT_LOADED",ie="APPENDING",ae="PARTIAL",te="OK",ce=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,h.a.BUFFER_APPENDED,h.a.FRAG_BUFFERED,h.a.FRAG_LOADED)||this).bufferPadding=.2,i.fragments=Object.create(null),i.timeRanges=Object.create(null),i.config=r.config,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,k.prototype.destroy.call(this),g.prototype.destroy.call(this)},c.getBufferedFrag=function(r,i){var s=this.fragments,t=Object.keys(s).filter(function(o){var f=s[o];if(f.body.type!==i||!f.buffered)return!1;var p=f.body;return p.startPTS<=r&&r<=p.endPTS});if(t.length===0)return null;var e=t.pop();return s[e].body},c.detectEvictedFragments=function(r,i){var s=this;Object.keys(this.fragments).forEach(function(t){var e=s.fragments[t];if(e&&e.buffered){var o=e.range[r];if(o)for(var f=o.time,p=0;p<f.length;p++){var v=f[p];if(!s.isTimeBuffered(v.startPTS,v.endPTS,i)){s.removeFragment(e.body);break}}}})},c.detectPartialFragments=function(r){var i=this,s=this.getFragmentKey(r),t=this.fragments[s];t&&(t.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){if(r.hasElementaryStream(e)){var o=i.timeRanges[e];t.range[e]=i.getBufferedTimes(r.startPTS,r.endPTS,o)}}))},c.getBufferedTimes=function(r,i,s){for(var t,e,o=[],f=!1,p=0;p<s.length;p++){if(t=s.start(p)-this.bufferPadding,e=s.end(p)+this.bufferPadding,r>=t&&i<=e){o.push({startPTS:Math.max(r,s.start(p)),endPTS:Math.min(i,s.end(p))});break}if(r<e&&i>t)o.push({startPTS:Math.max(r,s.start(p)),endPTS:Math.min(i,s.end(p))}),f=!0;else if(i<=t)break}return{time:o,partial:f}},c.getFragmentKey=function(r){return r.type+"_"+r.level+"_"+r.urlId+"_"+r.sn},c.getPartialFragment=function(r){var i,s,t,e=this,o=null,f=0;return Object.keys(this.fragments).forEach(function(p){var v=e.fragments[p];e.isPartial(v)&&(s=v.body.startPTS-e.bufferPadding,t=v.body.endPTS+e.bufferPadding,r>=s&&r<=t&&(i=Math.min(r-s,t-r),f<=i&&(o=v.body,f=i)))}),o},c.getState=function(r){var i=this.getFragmentKey(r),s=this.fragments[i],t=Lt;return s!==void 0&&(t=s.buffered?this.isPartial(s)===!0?ae:te:ie),t},c.isPartial=function(r){return r.buffered===!0&&(r.range.video!==void 0&&r.range.video.partial===!0||r.range.audio!==void 0&&r.range.audio.partial===!0)},c.isTimeBuffered=function(r,i,s){for(var t,e,o=0;o<s.length;o++){if(t=s.start(o)-this.bufferPadding,e=s.end(o)+this.bufferPadding,r>=t&&i<=e)return!0;if(i<=t)return!1}return!1},c.onFragLoaded=function(r){var i=r.frag;Object(I.a)(i.sn)&&!i.bitrateTest&&(this.fragments[this.getFragmentKey(i)]={body:i,range:Object.create(null),buffered:!1})},c.onBufferAppended=function(r){var i=this;this.timeRanges=r.timeRanges,Object.keys(this.timeRanges).forEach(function(s){var t=i.timeRanges[s];i.detectEvictedFragments(s,t)})},c.onFragBuffered=function(r){this.detectPartialFragments(r.frag)},c.hasFragment=function(r){var i=this.getFragmentKey(r);return this.fragments[i]!==void 0},c.removeFragment=function(r){var i=this.getFragmentKey(r);delete this.fragments[i]},c.removeAllFragments=function(){this.fragments=Object.create(null)},a}(k),y={search:function(g,l){for(var n=0,a=g.length-1,c=null,r=null;n<=a;){var i=l(r=g[c=(n+a)/2|0]);if(i>0)n=c+1;else{if(!(i<0))return r;a=c-1}}return null}},T=function(){function g(){}return g.isBuffered=function(l,n){try{if(l){for(var a=l.buffered,c=0;c<a.length;c++)if(n>=a.start(c)&&n<=a.end(c))return!0}}catch(r){}return!1},g.bufferInfo=function(l,n,a){try{if(l){var c,r=l.buffered,i=[];for(c=0;c<r.length;c++)i.push({start:r.start(c),end:r.end(c)});return this.bufferedInfo(i,n,a)}}catch(s){}return{len:0,start:n,end:n,nextStart:void 0}},g.bufferedInfo=function(l,n,a){l.sort(function(L,O){var M=L.start-O.start;return M||O.end-L.end});var c=[];if(a)for(var r=0;r<l.length;r++){var i=c.length;if(i){var s=c[i-1].end;l[r].start-s<a?l[r].end>s&&(c[i-1].end=l[r].end):c.push(l[r])}else c.push(l[r])}else c=l;for(var t,e=0,o=n,f=n,p=0;p<c.length;p++){var v=c[p].start,b=c[p].end;if(n+a>=v&&n<b)o=v,e=(f=b)-n;else if(n+a<v){t=v;break}}return{len:e,start:o,end:f,nextStart:t}},g}(),u=J(8),m=J(11),R=J(9);function S(){return window.MediaSource||window.WebKitMediaSource}var A=J(5),w=function(g){var l,n;function a(){return g.apply(this,arguments)||this}return n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n,a.prototype.trigger=function(c){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];this.emit.apply(this,[c,c].concat(i))},a}(u.EventEmitter),P=Object(A.a)(),G=S()||{isTypeSupported:function(){return!1}},x=function(){function g(n,a){var c=this;this.hls=n,this.id=a;var r=this.observer=new w,i=n.config,s=function(f,p){(p=p||{}).frag=c.frag,p.id=c.id,n.trigger(f,p)};r.on(h.a.FRAG_DECRYPTED,s),r.on(h.a.FRAG_PARSING_INIT_SEGMENT,s),r.on(h.a.FRAG_PARSING_DATA,s),r.on(h.a.FRAG_PARSED,s),r.on(h.a.ERROR,s),r.on(h.a.FRAG_PARSING_METADATA,s),r.on(h.a.FRAG_PARSING_USERDATA,s),r.on(h.a.INIT_PTS_FOUND,s);var t={mp4:G.isTypeSupported("video/mp4"),mpeg:G.isTypeSupported("audio/mpeg"),mp3:G.isTypeSupported('audio/mp4; codecs="mp3"')},e=navigator.vendor;if(i.enableWorker&&typeof Worker!="undefined"){var o;d.b.log("demuxing in webworker");try{o=this.w=m(12),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(f){n.trigger(h.a.ERROR,{type:_.b.OTHER_ERROR,details:_.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:f.message+" ("+f.filename+":"+f.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:t,vendor:e,id:a,config:JSON.stringify(i)})}catch(f){d.b.warn("Error in worker:",f),d.b.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&P.URL.revokeObjectURL(o.objectURL),this.demuxer=new R.a(r,t,i,e),this.w=void 0}}else this.demuxer=new R.a(r,t,i,e)}var l=g.prototype;return l.destroy=function(){var n=this.w;if(n)n.removeEventListener("message",this.onwmsg),n.terminate(),this.w=null;else{var a=this.demuxer;a&&(a.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)},l.push=function(n,a,c,r,i,s,t,e){var o=this.w,f=Object(I.a)(i.startPTS)?i.startPTS:i.start,p=i.decryptdata,v=this.frag,b=!(v&&i.cc===v.cc),L=!(v&&i.level===v.level),O=v&&i.sn===v.sn+1,M=!L&&O;if(b&&d.b.log(this.id+":discontinuity detected"),L&&d.b.log(this.id+":switch detected"),this.frag=i,o)o.postMessage({cmd:"demux",data:n,decryptdata:p,initSegment:a,audioCodec:c,videoCodec:r,timeOffset:f,discontinuity:b,trackSwitch:L,contiguous:M,duration:s,accurateTimeOffset:t,defaultInitPTS:e},n instanceof ArrayBuffer?[n]:[]);else{var B=this.demuxer;B&&B.push(n,p,a,c,r,f,b,L,M,s,t,e)}},l.onWorkerMessage=function(n){var a=n.data,c=this.hls;switch(a.event){case"init":P.URL.revokeObjectURL(this.w.objectURL);break;case h.a.FRAG_PARSING_DATA:a.data.data1=new Uint8Array(a.data1),a.data2&&(a.data.data2=new Uint8Array(a.data2));default:a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,c.trigger(a.event,a.data)}},g}();function W(g,l,n){switch(l){case"audio":g.audioGroupIds||(g.audioGroupIds=[]),g.audioGroupIds.push(n);break;case"text":g.textGroupIds||(g.textGroupIds=[]),g.textGroupIds.push(n)}}function H(g,l,n){var a=g[l],c=g[n],r=c.startPTS;if(Object(I.a)(r))n>l?(a.duration=r-a.start,a.duration<0&&d.b.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(c.duration=a.start-r,c.duration<0&&d.b.warn("negative duration computed for frag "+c.sn+",level "+c.level+", there should be some duration drift between playlist and fragment!"));else if(n>l){var i=a.cc===c.cc;c.start=a.start+(i&&a.minEndPTS?a.minEndPTS-a.start:a.duration)}else c.start=Math.max(a.start-c.duration,0)}function Q(g,l,n,a,c,r){var i=n,s=a;if(Object(I.a)(l.startPTS)){var t=Math.abs(l.startPTS-n);Object(I.a)(l.deltaPTS)?l.deltaPTS=Math.max(t,l.deltaPTS):l.deltaPTS=t,i=Math.max(n,l.startPTS),n=Math.min(n,l.startPTS),s=Math.min(a,l.endPTS),a=Math.max(a,l.endPTS),c=Math.min(c,l.startDTS),r=Math.max(r,l.endDTS)}var e=n-l.start;l.start=l.startPTS=n,l.maxStartPTS=i,l.endPTS=a,l.minEndPTS=s,l.startDTS=c,l.endDTS=r,l.duration=a-n;var o,f,p,v=l.sn;if(!g||v<g.startSN||v>g.endSN)return 0;for(o=v-g.startSN,(f=g.fragments)[o]=l,p=o;p>0;p--)H(f,p,p-1);for(p=o;p<f.length-1;p++)H(f,p,p+1);return g.PTSKnown=!0,e}function V(g,l){l.initSegment&&g.initSegment&&(l.initSegment=g.initSegment);var n,a=0;if(q(g,l,function(i,s){a=i.cc-s.cc,Object(I.a)(i.startPTS)&&(s.start=s.startPTS=i.startPTS,s.endPTS=i.endPTS,s.duration=i.duration,s.backtracked=i.backtracked,s.dropped=i.dropped,n=s),l.PTSKnown=!0}),l.PTSKnown){if(a){d.b.log("discontinuity sliding from playlist, take drift into account");for(var c=l.fragments,r=0;r<c.length;r++)c[r].cc+=a}n?Q(l,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(i,s){var t=s.startSN-i.startSN,e=i.fragments,o=s.fragments;if(!(t<0||t>e.length))for(var f=0;f<o.length;f++)o[f].start+=e[t].start}(g,l),l.PTSKnown=g.PTSKnown}}function q(g,l,n){if(g&&l)for(var a=Math.max(g.startSN,l.startSN)-l.startSN,c=Math.min(g.endSN,l.endSN)-l.startSN,r=l.startSN-g.startSN,i=a;i<=c;i++){var s=g.fragments[r+i],t=l.fragments[i];if(!s||!t)break;n(s,t,i)}}function tt(g,l,n){var a=1e3*(l.averagetargetduration?l.averagetargetduration:l.targetduration),c=a/2;return g&&l.endSN===g.endSN&&(a=c),n&&(a=Math.max(c,a-(window.performance.now()-n))),Math.round(a)}var it={toString:function(g){for(var l="",n=g.length,a=0;a<n;a++)l+="["+g.start(a).toFixed(3)+","+g.end(a).toFixed(3)+"]";return l}};function Et(g,l){l.fragments.forEach(function(n){if(n){var a=n.start+g;n.start=n.startPTS=a,n.endPTS=a+n.duration}}),l.PTSKnown=!0}function ht(g,l,n){(function(a,c,r){if(function(s,t,e){var o=!1;return t&&t.details&&e&&(e.endCC>e.startCC||s&&s.cc<e.startCC)&&(o=!0),o}(a,r,c)){var i=function(s,t){var e=s.fragments,o=t.fragments;if(o.length&&e.length){var f=function(p,v){for(var b=null,L=0;L<p.length;L+=1){var O=p[L];if(O&&O.cc===v){b=O;break}}return b}(e,o[0].cc);if(f&&(!f||f.startPTS))return f;d.b.log("No frag in previous level to align on")}else d.b.log("No fragments to align")}(r.details,c);i&&(d.b.log("Adjusting PTS using last level due to CC increase within current level"),Et(i.start,c))}})(g,n,l),!n.PTSKnown&&l&&function(a,c){if(c&&c.fragments.length){if(!a.hasProgramDateTime||!c.hasProgramDateTime)return;var r=c.fragments[0].programDateTime,i=(a.fragments[0].programDateTime-r)/1e3+c.fragments[0].start;Object(I.a)(i)&&(d.b.log("adjusting PTS using programDateTime delta, sliding:"+i.toFixed(3)),Et(i,a))}}(n,l.details)}function It(g,l,n){if(l===null||!Array.isArray(g)||!g.length||!Object(I.a)(l)||l<(g[0].programDateTime||0)||l>=(g[g.length-1].endProgramDateTime||0))return null;n=n||0;for(var a=0;a<g.length;++a){var c=g[a];if(nt(l,n,c))return c}return null}function gt(g,l,n,a){n===void 0&&(n=0),a===void 0&&(a=0);var c=null;if(g?c=l[g.sn-l[0].sn+1]:n===0&&l[0].start===0&&(c=l[0]),c&&Tt(n,a,c)===0)return c;var r=y.search(l,Tt.bind(null,n,a));return r||c}function Tt(g,l,n){g===void 0&&(g=0),l===void 0&&(l=0);var a=Math.min(l,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-a<=g?1:n.start-a>g&&n.start?-1:0}function nt(g,l,n){var a=1e3*Math.min(l,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-a>g}var Pt=function(){function g(n,a,c,r){this.config=n,this.media=a,this.fragmentTracker=c,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var l=g.prototype;return l.poll=function(n){var a=this.config,c=this.media,r=this.stalled,i=c.currentTime,s=c.seeking,t=this.seeking&&!s,e=!this.seeking&&s;if(this.seeking=s,i===n){if((e||t)&&(this.stalled=null),!c.paused&&!c.ended&&c.playbackRate!==0&&c.buffered.length){var o=T.bufferInfo(c,i,0),f=o.len>0,p=o.nextStart||0;if(f||p){if(s){var v=o.len>2,b=!p||p-i>2&&!this.fragmentTracker.getPartialFragment(i);if(v||b)return;this.moved=!1}if(!this.moved&&this.stalled){var L=Math.max(p,o.start||0)-i;if(L>0&&L<=2)return void this._trySkipBufferHole(null)}var O=self.performance.now();if(r!==null){var M=O-r;!s&&M>=250&&this._reportStall(o.len);var B=T.bufferInfo(c,i,a.maxBufferHole);this._tryFixBufferStall(B,M)}else this.stalled=O}}}else if(this.moved=!0,r!==null){if(this.stallReported){var z=self.performance.now()-r;d.b.warn("playback not stuck anymore @"+i+", after "+Math.round(z)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},l._tryFixBufferStall=function(n,a){var c=this.config,r=this.fragmentTracker,i=this.media.currentTime,s=r.getPartialFragment(i);s&&this._trySkipBufferHole(s)||n.len>c.maxBufferHole&&a>1e3*c.highBufferWatchdogPeriod&&(d.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},l._reportStall=function(n){var a=this.hls,c=this.media;this.stallReported||(this.stallReported=!0,d.b.warn("Playback stalling at @"+c.currentTime+" due to low buffer (buffer="+n+")"),a.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:n}))},l._trySkipBufferHole=function(n){for(var a=this.config,c=this.hls,r=this.media,i=r.currentTime,s=0,t=0;t<r.buffered.length;t++){var e=r.buffered.start(t);if(i+a.maxBufferHole>=s&&i<e){var o=Math.max(e+.05,r.currentTime+.1);return d.b.warn("skipping hole, adjusting currentTime from "+i+" to "+o),this.moved=!0,this.stalled=null,r.currentTime=o,n&&c.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+o,frag:n}),o}s=r.buffered.end(t)}return 0},l._tryNudgeBuffer=function(){var n=this.config,a=this.hls,c=this.media,r=c.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<n.nudgeMaxRetry){var s=r+i*n.nudgeOffset;d.b.warn("Nudging 'currentTime' from "+r+" to "+s),c.currentTime=s,a.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else d.b.error("Playhead still not moving while enough data buffered @"+r+" after "+n.nudgeMaxRetry+" nudges"),a.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.BUFFER_STALLED_ERROR,fatal:!0})},g}();function Ht(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}var xt=function(g){var l,n;function a(r){for(var i,s=arguments.length,t=new Array(s>1?s-1:0),e=1;e<s;e++)t[e-1]=arguments[e];return(i=g.call.apply(g,[this,r].concat(t))||this)._boundTick=void 0,i._tickTimer=null,i._tickInterval=null,i._tickCallCount=0,i._boundTick=i.tick.bind(Ht(i)),i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},c.hasInterval=function(){return!!this._tickInterval},c.hasNextTick=function(){return!!this._tickTimer},c.setInterval=function(r){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,r),!0)},c.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},c.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},c.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},c.doTick=function(){},a}(k),kt="STOPPED",Gt="STARTING",st="IDLE",Wt="PAUSED",Ut="KEY_LOADING",wt="FRAG_LOADING",re="FRAG_LOADING_WAITING_RETRY",qt="WAITING_TRACK",Nt="PARSING",Kt="PARSED",Vt="BUFFER_FLUSHING",$t="ENDED",Yt="ERROR",se="WAITING_INIT_PTS",Xt="WAITING_LEVEL",ne=function(g){var l,n;function a(){return g.apply(this,arguments)||this}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.doTick=function(){},c.startLoad=function(){},c.stopLoad=function(){var r=this.fragCurrent;r&&(r.loader&&r.loader.abort(),this.fragmentTracker.removeFragment(r)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=kt},c._streamEnded=function(r,i){var s=this.fragCurrent,t=this.fragmentTracker;if(!i.live&&s&&!s.backtracked&&s.sn===i.endSN&&!r.nextStart){var e=t.getState(s);return e===ae||e===te}return!1},c.onMediaSeeking=function(){var r=this.config,i=this.media,s=this.mediaBuffer,t=this.state,e=i?i.currentTime:null,o=T.bufferInfo(s||i,e,this.config.maxBufferHole);if(d.b.log("media seeking to "+(Object(I.a)(e)?e.toFixed(3):e)),t===wt){var f=this.fragCurrent;if(o.len===0&&f){var p=r.maxFragLookUpTolerance,v=f.start-p,b=f.start+f.duration+p;e<v||e>b?(f.loader&&(d.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=st):d.b.log("seeking outside of buffer but within currently loaded fragment range")}}else t===$t&&(o.len===0&&(this.fragPrevious=null,this.fragCurrent=null),this.state=st);i&&(this.lastCurrentTime=e),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},c.onHandlerDestroying=function(){this.stopLoad(),g.prototype.onHandlerDestroying.call(this)},c.onHandlerDestroyed=function(){this.state=kt,this.fragmentTracker=null},c.computeLivePosition=function(r,i){var s=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*i.targetduration;return r+Math.max(0,i.totalduration-s)},a}(xt);function Zt(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var he,ge=function(g){var l,n;function a(t,e){var o;return(o=g.call(this,t,h.a.MEDIA_ATTACHED,h.a.MEDIA_DETACHING,h.a.MANIFEST_LOADING,h.a.MANIFEST_PARSED,h.a.LEVEL_LOADED,h.a.LEVELS_UPDATED,h.a.KEY_LOADED,h.a.FRAG_LOADED,h.a.FRAG_LOAD_EMERGENCY_ABORTED,h.a.FRAG_PARSING_INIT_SEGMENT,h.a.FRAG_PARSING_DATA,h.a.FRAG_PARSED,h.a.ERROR,h.a.AUDIO_TRACK_SWITCHING,h.a.AUDIO_TRACK_SWITCHED,h.a.BUFFER_CREATED,h.a.BUFFER_APPENDED,h.a.BUFFER_FLUSHED)||this).fragmentTracker=e,o.config=t.config,o.audioCodecSwap=!1,o._state=kt,o.stallReported=!1,o.gapController=null,o.altAudio=!1,o.audioOnly=!1,o.bitrateTest=!1,o}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var f=o.startLevel;f===-1&&(o.config.testBandwidth?(f=0,this.bitrateTest=!0):f=o.nextAutoLevel),this.level=o.nextLoadLevel=f,this.loadedmetadata=!1}e>0&&t===-1&&(d.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=st,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=kt},s.stopLoad=function(){this.forceStartLoad=!1,g.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case Vt:this.fragLoadError=0;break;case st:this._doTickIdle();break;case Xt:var t=this.levels[this.level];t&&t.details&&(this.state=st);break;case re:var e=window.performance.now(),o=this.retryDate;(!o||e>=o||this.media&&this.media.seeking)&&(d.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=st)}this._checkBuffer(),this._checkFragmentChanged()},s._doTickIdle=function(){var t=this.hls,e=t.config,o=this.media;if(this.levelLastLoaded!==void 0&&(o||!this.startFragRequested&&e.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var f;f=this.loadedmetadata?o.currentTime:this.nextLoadPosition;var p=t.nextLoadLevel,v=this.levels[p];if(v){var b,L=v.bitrate;b=L?Math.max(8*e.maxBufferSize/L,e.maxBufferLength):e.maxBufferLength,b=Math.min(b,e.maxMaxBufferLength);var O=f<e.maxBufferHole?Math.max(2,e.maxBufferHole):e.maxBufferHole,M=T.bufferInfo(this.mediaBuffer?this.mediaBuffer:o,f,O),B=M.len;if(!(B>=b)){d.b.trace("buffer length of "+B.toFixed(3)+" is below max of "+b.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=p;var z=v.details;if(!z||z.live&&this.levelLastLoaded!==p)this.state=Xt;else{if(this._streamEnded(M,z)){var $={};return this.altAudio&&($.type="video"),this.hls.trigger(h.a.BUFFER_EOS,$),void(this.state=$t)}this._fetchPayloadOrEos(f,M,z)}}}}},s._fetchPayloadOrEos=function(t,e,o){var f=this.fragPrevious,p=(this.level,o.fragments),v=p.length;if(v!==0){var b,L=p[0].start,O=p[v-1].start+p[v-1].duration,M=e.end;if(o.initSegment&&!o.initSegment.data)b=o.initSegment;else if(o.live){var B=this.config.initialLiveManifestSize;if(v<B)return void d.b.warn("Can not start playback of a level, reason: not enough fragments "+v+" < "+B);if((b=this._ensureFragmentAtLivePoint(o,M,L,O,f,p))===null)return}else M<L&&(b=p[0]);b||(b=this._findFragment(L,f,v,p,M,O,o)),b&&(b.encrypted?this._loadKey(b,o):this._loadFragment(b,o,t,M))}},s._ensureFragmentAtLivePoint=function(t,e,o,f,p,v){var b,L=this.hls.config,O=this.media,M=1/0;if(L.liveMaxLatencyDuration!==void 0?M=L.liveMaxLatencyDuration:Object(I.a)(L.liveMaxLatencyDurationCount)&&(M=L.liveMaxLatencyDurationCount*t.targetduration),e<Math.max(o-L.maxFragLookUpTolerance,f-M)){var B=this.liveSyncPosition=this.computeLivePosition(o,t);e=B,O&&!O.paused&&O.readyState&&O.duration>B&&B>O.currentTime&&(d.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+B.toFixed(3)),O.currentTime=B),this.nextLoadPosition=B}if(t.PTSKnown&&e>f&&O&&O.readyState)return null;if(this.startFragRequested&&!t.PTSKnown&&p)if(t.hasProgramDateTime)d.b.log("live playlist, switching playlist, load frag with same PDT: "+p.programDateTime),b=It(v,p.endProgramDateTime,L.maxFragLookUpTolerance);else{var z=p.sn+1;if(z>=t.startSN&&z<=t.endSN){var $=v[z-t.startSN];p.cc===$.cc&&(b=$,d.b.log("live playlist, switching playlist, load frag with next SN: "+b.sn))}b||(b=y.search(v,function(ut){return p.cc-ut.cc}))&&d.b.log("live playlist, switching playlist, load frag with same CC: "+b.sn)}return b},s._findFragment=function(t,e,o,f,p,v,b){var L,O=this.hls.config;if(p<v?L=gt(e,f,p,p>v-O.maxFragLookUpTolerance?0:O.maxFragLookUpTolerance):L=f[o-1],L){var M=L.sn-b.startSN,B=e&&L.level===e.level,z=f[M-1],$=f[M+1];if(e&&L.sn===e.sn)if(B&&!L.backtracked)if(L.sn<b.endSN){var ut=e.deltaPTS;ut&&ut>O.maxBufferHole&&e.dropped&&M?(L=z,d.b.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(L=$,this.fragmentTracker.getState(L)!==te&&d.b.log("Re-loading fragment with SN: "+L.sn))}else L=null;else L.backtracked&&($&&$.backtracked?(d.b.warn("Already backtracked from fragment "+$.sn+", will not backtrack to fragment "+L.sn+". Loading fragment "+$.sn),L=$):(d.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),L.dropped=0,z?(L=z).backtracked=!0:M&&(L=null)))}return L},s._loadKey=function(t,e){d.b.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level),this.state=Ut,this.hls.trigger(h.a.KEY_LOADING,{frag:t})},s._loadFragment=function(t,e,o,f){var p=this.fragmentTracker.getState(t);this.fragCurrent=t,t.sn!=="initSegment"&&(this.startFragRequested=!0),Object(I.a)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||p===Lt||p===ae?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,d.b.log("Loading "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(o.toFixed(3))+", bufferEnd: "+parseFloat(f.toFixed(3))),this.hls.trigger(h.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new x(this.hls,"main")),this.state=wt):p===ie&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},s.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,Z.MAIN)},s.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},s._checkFragmentChanged=function(){var t,e,o=this.media;if(o&&o.readyState&&o.seeking===!1&&((e=o.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=e),T.isBuffered(o,e)?t=this.getBufferedFrag(e):T.isBuffered(o,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var f=t;if(f!==this.fragPlaying){this.hls.trigger(h.a.FRAG_CHANGED,{frag:f});var p=f.level;this.fragPlaying&&this.fragPlaying.level===p||this.hls.trigger(h.a.LEVEL_SWITCHED,{level:p}),this.fragPlaying=f}}},s.immediateLevelSwitch=function(){if(d.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t,e=this.media;e?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t}var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,t.currentTime>0&&T.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},s.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e,o=this.getBufferedFrag(t.currentTime);if(o&&o.startPTS>1&&this.flushMainBuffer(0,o.startPTS-1),t.paused)e=0;else{var f=this.hls.nextLoadLevel,p=this.levels[f],v=this.fragLastKbps;e=v&&this.fragCurrent?this.fragCurrent.duration*p.bitrate/(1e3*v)+1:0}var b=this.getBufferedFrag(t.currentTime+e);if(b){var L=this.followingBufferedFrag(b);if(L){var O=this.fragCurrent;O&&O.loader&&O.loader.abort(),this.fragCurrent=null;var M=Math.max(b.endPTS,L.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,L.duration));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},s.flushMainBuffer=function(t,e){this.state=Vt;var o={startOffset:t,endOffset:e};this.altAudio&&(o.type="video"),this.hls.trigger(h.a.BUFFER_FLUSHING,o)},s.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var o=this.config;this.levels&&o.autoStartLoad&&this.hls.startLoad(o.startPosition),this.gapController=new Pt(o,e,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(d.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(o){o.details&&o.details.fragments.forEach(function(f){f.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},s.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;Object(I.a)(e)&&d.b.log("media seeked to "+e.toFixed(3)),this.tick()},s.onManifestLoading=function(){d.b.log("trigger BUFFER_RESET"),this.hls.trigger(h.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},s.onManifestParsed=function(t){var e,o=!1,f=!1;t.levels.forEach(function(v){(e=v.audioCodec)&&(e.indexOf("mp4a.40.2")!==-1&&(o=!0),e.indexOf("mp4a.40.5")!==-1&&(f=!0))}),this.audioCodecSwitch=o&&f,this.audioCodecSwitch&&d.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=t.altAudio,this.levels=t.levels,this.startFragRequested=!1;var p=this.config;(p.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(p.startPosition)},s.onLevelLoaded=function(t){var e=t.details,o=t.level,f=this.levels[this.levelLastLoaded],p=this.levels[o],v=e.totalduration,b=0;if(d.b.log("level "+o+" loaded ["+e.startSN+","+e.endSN+"],duration:"+v),e.live||p.details&&p.details.live){var L=p.details;L&&e.fragments.length>0?(V(L,e),b=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(b,L),e.PTSKnown&&Object(I.a)(b)?d.b.log("live playlist sliding:"+b.toFixed(3)):(d.b.log("live playlist - outdated PTS, unknown sliding"),ht(this.fragPrevious,f,e))):(d.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,ht(this.fragPrevious,f,e))}else e.PTSKnown=!1;if(p.details=e,this.levelLastLoaded=o,this.hls.trigger(h.a.LEVEL_UPDATED,{details:e,level:o}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var O=e.startTimeOffset;Object(I.a)(O)?(O<0&&(d.b.log("negative start time offset "+O+", count from end of last fragment"),O=b+v+O),d.b.log("start time offset found in playlist, adjust startPosition to "+O),this.startPosition=O):e.live?(this.startPosition=this.computeLivePosition(b,e),d.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Xt&&(this.state=st),this.tick()},s.onKeyLoaded=function(){this.state===Ut&&(this.state=st,this.tick())},s.onFragLoaded=function(t){var e=this.fragCurrent,o=this.hls,f=this.levels,p=this.media,v=t.frag;if(this.state===wt&&e&&v.type==="main"&&v.level===e.level&&v.sn===e.sn){var b=t.stats,L=f[e.level],O=L.details;if(this.bitrateTest=!1,this.stats=b,d.b.log("Loaded "+e.sn+" of ["+O.startSN+" ,"+O.endSN+"],level "+e.level),v.bitrateTest&&o.nextLoadLevel)this.state=st,this.startFragRequested=!1,b.tparsed=b.tbuffered=window.performance.now(),o.trigger(h.a.FRAG_BUFFERED,{stats:b,frag:e,id:"main"}),this.tick();else if(v.sn==="initSegment")this.state=st,b.tparsed=b.tbuffered=window.performance.now(),O.initSegment.data=t.payload,o.trigger(h.a.FRAG_BUFFERED,{stats:b,frag:e,id:"main"}),this.tick();else{d.b.log("Parsing "+e.sn+" of ["+O.startSN+" ,"+O.endSN+"],level "+e.level+", cc "+e.cc),this.state=Nt,this.pendingBuffering=!0,this.appended=!1,v.bitrateTest&&(v.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:v}));var M=!(p&&p.seeking)&&(O.PTSKnown||!O.live),B=O.initSegment?O.initSegment.data:[],z=this._getAudioCodec(L);(this.demuxer=this.demuxer||new x(this.hls,"main")).push(t.payload,B,z,L.videoCodec,e,O.totalduration,M)}}this.fragLoadError=0},s.onFragParsingInitSegment=function(t){var e=this.fragCurrent,o=t.frag;if(e&&t.id==="main"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt){var f,p,v=t.tracks;if(this.audioOnly=v.audio&&!v.video,this.altAudio&&!this.audioOnly&&delete v.audio,p=v.audio){var b=this.levels[this.level].audioCodec,L=navigator.userAgent.toLowerCase();b&&this.audioCodecSwap&&(d.b.log("swapping playlist audio codec"),b=b.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&p.metadata.channelCount!==1&&L.indexOf("firefox")===-1&&(b="mp4a.40.5"),L.indexOf("android")!==-1&&p.container!=="audio/mpeg"&&(b="mp4a.40.2",d.b.log("Android: force audio codec to "+b)),p.levelCodec=b,p.id=t.id}for(f in(p=v.video)&&(p.levelCodec=this.levels[this.level].videoCodec,p.id=t.id),this.hls.trigger(h.a.BUFFER_CODECS,v),v){p=v[f],d.b.log("main track:"+f+",container:"+p.container+",codecs[level/parsed]=["+p.levelCodec+"/"+p.codec+"]");var O=p.initSegment;O&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.a.BUFFER_APPENDING,{type:f,data:O,parent:"main",content:"initSegment"}))}this.tick()}},s.onFragParsingData=function(t){var e=this,o=this.fragCurrent,f=t.frag;if(o&&t.id==="main"&&f.sn===o.sn&&f.level===o.level&&(t.type!=="audio"||!this.altAudio)&&this.state===Nt){var p=this.levels[this.level],v=o;if(Object(I.a)(t.endPTS)||(t.endPTS=t.startPTS+o.duration,t.endDTS=t.startDTS+o.duration),t.hasAudio===!0&&v.addElementaryStream(D.AUDIO),t.hasVideo===!0&&v.addElementaryStream(D.VIDEO),d.b.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),t.type==="video")if(v.dropped=t.dropped,v.dropped)if(v.backtracked)d.b.warn("Already backtracked on this fragment, appending with the gap",v.sn);else{var b=p.details;if(!b||v.sn!==b.startSN)return d.b.warn("missing video frame(s), backtracking fragment",v.sn),this.fragmentTracker.removeFragment(v),v.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=st,this.fragPrevious=v,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();d.b.warn("missing video frame(s) on first frag, appending with gap",v.sn)}else v.backtracked=!1;var L=Q(p.details,v,t.startPTS,t.endPTS,t.startDTS,t.endDTS),O=this.hls;O.trigger(h.a.LEVEL_PTS_UPDATED,{details:p.details,level:this.level,drift:L,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(M){M&&M.length&&e.state===Nt&&(e.appended=!0,e.pendingBuffering=!0,O.trigger(h.a.BUFFER_APPENDING,{type:t.type,data:M,parent:"main",content:"data"}))}),this.tick()}},s.onFragParsed=function(t){var e=this.fragCurrent,o=t.frag;e&&t.id==="main"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt&&(this.stats.tparsed=window.performance.now(),this.state=Kt,this._checkAppendedParsed())},s.onAudioTrackSwitching=function(t){var e=this.altAudio,o=!!t.url,f=t.id;if(!o){if(this.mediaBuffer!==this.media){d.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var p=this.fragCurrent;p.loader&&(d.b.log("switching to main audio track, cancel main fragment load"),p.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=st}var v=this.hls;e&&v.trigger(h.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),v.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:f})}},s.onAudioTrackSwitched=function(t){var e=t.id,o=!!this.hls.audioTracks[e].url;if(o){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(d.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=o,this.tick()},s.onBufferCreated=function(t){var e,o,f=t.tracks,p=!1;for(var v in f){var b=f[v];b.id==="main"?(o=v,e=b,v==="video"&&(this.videoBuffer=f[v].buffer)):p=!0}p&&e?(d.b.log("alternate track found, use "+o+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},s.onBufferAppended=function(t){if(t.parent==="main"){var e=this.state;e!==Nt&&e!==Kt||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},s._checkAppendedParsed=function(){if(!(this.state!==Kt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;d.b.log("main buffered : "+it.toString(e.buffered)),this.fragPrevious=t;var o=this.stats;o.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*o.total/(o.tbuffered-o.tfirst)),this.hls.trigger(h.a.FRAG_BUFFERED,{stats:o,frag:t,id:"main"}),this.state=st}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},s.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||e.type==="main"){var o=!!this.media&&T.isBuffered(this.media,this.media.currentTime)&&T.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case _.a.FRAG_LOAD_ERROR:case _.a.FRAG_LOAD_TIMEOUT:case _.a.KEY_LOAD_ERROR:case _.a.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var f=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);d.b.warn("mediaController: frag loading failed, retry in "+f+" ms"),this.retryDate=window.performance.now()+f,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=re}else d.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Yt;break;case _.a.LEVEL_LOAD_ERROR:case _.a.LEVEL_LOAD_TIMEOUT:this.state!==Yt&&(t.fatal?(this.state=Yt,d.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==Xt||(this.state=st));break;case _.a.BUFFER_FULL_ERROR:t.parent!=="main"||this.state!==Nt&&this.state!==Kt||(o?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=st):(d.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},s._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,d.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},s._checkBuffer=function(){var t=this.media;if(t&&t.readyState!==0){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e)}},s.onFragLoadEmergencyAborted=function(){this.state=st,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},s.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;if(t){var e=this.audioOnly?D.AUDIO:D.VIDEO;this.fragmentTracker.detectEvictedFragments(e,t.buffered)}this.state=st,this.fragPrevious=null},s.onLevelsUpdated=function(t){this.levels=t.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s._seekToStartPos=function(){var t=this.media,e=t.currentTime,o=this.startPosition;if(e!==o&&o>=0){if(t.seeking)return void d.b.log("could not seek to "+o+", already seeking at "+e);var f=(t.buffered.length?t.buffered.start(0):0)-o;f>0&&f<this.config.maxBufferHole&&(d.b.log("adjusting start position by "+f+" to match buffer start"),o+=f,this.startPosition=o),d.b.log("seek to target start position "+o+" from current time "+e+". ready state "+t.readyState),t.currentTime=o}},s._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(d.b.log("swapping playlist audio codec"),e&&(e=e.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),e},c=a,(r=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,d.b.log("main stream-controller: "+e+"->"+t),this.hls.trigger(h.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}])&&Zt(c.prototype,r),i&&Zt(c,i),a}(ne);function ee(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Fe=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,h.a.MANIFEST_LOADED,h.a.LEVEL_LOADED,h.a.AUDIO_TRACK_SWITCHED,h.a.FRAG_LOADED,h.a.ERROR)||this).canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,he=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},s.clearTimer=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},s.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(e){e.loadError=0;var o=e.details;o&&o.live&&(e.details=void 0)}),this.timer!==null&&this.loadLevel()},s.stopLoad=function(){this.canload=!1},s.onManifestLoaded=function(t){var e,o=[],f=[],p={},v=null,b=!1,L=!1;if(t.levels.forEach(function(B){var z=B.attrs;B.loadError=0,B.fragmentError=!1,b=b||!!B.videoCodec,L=L||!!B.audioCodec,he&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0),(v=p[B.bitrate])?v.url.push(B.url):(B.url=[B.url],B.urlId=0,p[B.bitrate]=B,o.push(B)),z&&(z.AUDIO&&W(v||B,"audio",z.AUDIO),z.SUBTITLES&&W(v||B,"text",z.SUBTITLES))}),b&&L&&(o=o.filter(function(B){return!!B.videoCodec})),o=o.filter(function(B){var z=B.audioCodec,$=B.videoCodec;return(!z||St(z,"audio"))&&(!$||St($,"video"))}),t.audioTracks&&(f=t.audioTracks.filter(function(B){return!B.audioCodec||St(B.audioCodec,"audio")})).forEach(function(B,z){B.id=z}),o.length>0){e=o[0].bitrate,o.sort(function(B,z){return B.bitrate-z.bitrate}),this._levels=o;for(var O=0;O<o.length;O++)if(o[O].bitrate===e){this._firstLevel=O,d.b.log("manifest loaded,"+o.length+" level(s) found, first bitrate:"+e);break}var M=L&&!b;this.hls.trigger(h.a.MANIFEST_PARSED,{levels:o,audioTracks:f,firstLevel:this._firstLevel,stats:t.stats,audio:L,video:b,altAudio:!M&&f.some(function(B){return!!B.url})})}else this.hls.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},s.setLevelInternal=function(t){var e=this._levels,o=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){d.b.log("switching to level "+t),this.currentLevelIndex=t;var f=e[t];f.level=t,o.trigger(h.a.LEVEL_SWITCHING,f)}var p=e[t],v=p.details;if(!v||v.live){var b=p.urlId;o.trigger(h.a.LEVEL_LOADING,{url:p.url[b],level:t,id:b})}}else o.trigger(h.a.ERROR,{type:_.b.OTHER_ERROR,details:_.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},s.onError=function(t){if(t.fatal)t.type===_.b.NETWORK_ERROR&&this.clearTimer();else{var e,o=!1,f=!1;switch(t.details){case _.a.FRAG_LOAD_ERROR:case _.a.FRAG_LOAD_TIMEOUT:case _.a.KEY_LOAD_ERROR:case _.a.KEY_LOAD_TIMEOUT:e=t.frag.level,f=!0;break;case _.a.LEVEL_LOAD_ERROR:case _.a.LEVEL_LOAD_TIMEOUT:e=t.context.level,o=!0;break;case _.a.REMUX_ALLOC_ERROR:e=t.level,o=!0}e!==void 0&&this.recoverLevel(t,e,o,f)}},s.recoverLevel=function(t,e,o,f){var p,v,b,L=this,O=this.hls.config,M=t.details,B=this._levels[e];if(B.loadError++,B.fragmentError=f,o){if(!(this.levelRetryCount+1<=O.levelLoadingMaxRetry))return d.b.error("level controller, cannot recover from "+M+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);v=Math.min(Math.pow(2,this.levelRetryCount)*O.levelLoadingRetryDelay,O.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return L.loadLevel()},v),t.levelRetry=!0,this.levelRetryCount++,d.b.warn("level controller, "+M+", retry in "+v+" ms, current retry count is "+this.levelRetryCount)}(o||f)&&((p=B.url.length)>1&&B.loadError<p?(B.urlId=(B.urlId+1)%p,B.details=void 0,d.b.warn("level controller, "+M+" for level "+e+": switching to redundant URL-id "+B.urlId)):this.manualLevelIndex===-1?(b=e===0?this._levels.length-1:e-1,d.b.warn("level controller, "+M+": switch to "+b),this.hls.nextAutoLevel=this.currentLevelIndex=b):f&&(d.b.warn("level controller, "+M+": reload a fragment"),this.currentLevelIndex=null))},s.onFragLoaded=function(t){var e=t.frag;if(e!==void 0&&e.type==="main"){var o=this._levels[e.level];o!==void 0&&(o.fragmentError=!1,o.loadError=0,this.levelRetryCount=0)}},s.onLevelLoaded=function(t){var e=this,o=t.level,f=t.details;if(o===this.currentLevelIndex){var p=this._levels[o];if(p.fragmentError||(p.loadError=0,this.levelRetryCount=0),f.live){var v=tt(p.details,f,t.stats.trequest);d.b.log("live playlist, reload in "+Math.round(v)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},v)}else this.clearTimer()}},s.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,o=this.hls.levels[this.currentLevelIndex];if(o&&o.audioGroupIds){for(var f=-1,p=0;p<o.audioGroupIds.length;p++)if(o.audioGroupIds[p]===e){f=p;break}f!==o.urlId&&(o.urlId=f,this.startLoad())}},s.loadLevel=function(){if(d.b.debug("call to loadLevel"),this.currentLevelIndex!==null&&this.canload){var t=this._levels[this.currentLevelIndex];if(typeof t=="object"&&t.url.length>0){var e=this.currentLevelIndex,o=t.urlId,f=t.url[o];d.b.log("Attempt loading level index "+e+" with URL-id "+o),this.hls.trigger(h.a.LEVEL_LOADING,{url:f,level:e,id:o})}}},s.removeLevel=function(t,e){var o=this.levels.filter(function(f,p){return p!==t||f.url.length>1&&e!==void 0&&(f.url=f.url.filter(function(v,b){return b!==e}),f.urlId=0,!0)}).map(function(f,p){var v=f.details;return v&&v.fragments&&v.fragments.forEach(function(b){b.level=p}),f});this._levels=o,this.hls.trigger(h.a.LEVELS_UPDATED,{levels:o})},c=a,(r=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}])&&ee(c.prototype,r),i&&ee(c,i),a}(k),ye=J(4);function we(g,l){var n;try{n=new Event("addtrack")}catch(a){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=g,l.dispatchEvent(n)}function oe(g){if(g!=null&&g.cues)for(;g.cues.length>0;)g.removeCue(g.cues[0])}var De=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,h.a.MEDIA_ATTACHED,h.a.MEDIA_DETACHING,h.a.FRAG_PARSING_METADATA,h.a.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,i.media=void 0,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.destroy=function(){k.prototype.destroy.call(this)},c.onMediaAttached=function(r){this.media=r.media,this.media},c.onMediaDetaching=function(){oe(this.id3Track),this.id3Track=void 0,this.media=void 0},c.getID3Track=function(r){for(var i=0;i<r.length;i++){var s=r[i];if(s.kind==="metadata"&&s.label==="id3")return we(s,this.media),s}return this.media.addTextTrack("metadata","id3")},c.onFragParsingMetadata=function(r){var i=r.frag,s=r.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var t=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<s.length;e++){var o=ye.a.getID3Frames(s[e].data);if(o){var f=Math.max(s[e].pts,0),p=e<s.length-1?s[e+1].pts:i.endPTS;p||(p=i.start+i.duration),p-f<=0&&(p=f+.25);for(var v=0;v<o.length;v++){var b=o[v];if(!ye.a.isTimeStampFrame(b)){var L=new t(f,p,"");L.value=b,this.id3Track.addCue(L)}}}}},c.onLiveBackBufferReached=function(r){var i=r.bufferEnd,s=this.id3Track;if(s&&s.cues&&s.cues.length){var t=function(e,o){if(o<e[0].endTime)return e[0];if(o>e[e.length-1].endTime)return e[e.length-1];for(var f=0,p=e.length-1;f<=p;){var v=Math.floor((p+f)/2);if(o<e[v].endTime)p=v-1;else{if(!(o>e[v].endTime))return e[v];f=v+1}}return e[f].endTime-o<o-e[p].endTime?e[f]:e[p]}(s.cues,i);if(t)for(;s.cues[0]!==t;)s.removeCue(s.cues[0])}},a}(k),pe=function(){function g(n){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=n?Math.exp(Math.log(.5)/n):0,this.estimate_=0,this.totalWeight_=0}var l=g.prototype;return l.sample=function(n,a){var c=Math.pow(this.alpha_,n);this.estimate_=a*(1-c)+c*this.estimate_,this.totalWeight_+=n},l.getTotalWeight=function(){return this.totalWeight_},l.getEstimate=function(){if(this.alpha_){var n=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/n}return this.estimate_},g}(),Ue=function(){function g(n,a,c,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=n,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new pe(a),this.fast_=new pe(c)}var l=g.prototype;return l.sample=function(n,a){var c=(n=Math.max(n,this.minDelayMs_))/1e3,r=8*a/c;this.fast_.sample(c,r),this.slow_.sample(c,r)},l.canEstimate=function(){var n=this.fast_;return n&&n.getTotalWeight()>=this.minWeight_},l.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},l.destroy=function(){},g}();function Ce(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Se=window.performance,Ne=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,h.a.FRAG_LOADING,h.a.FRAG_LOADED,h.a.FRAG_BUFFERED,h.a.ERROR)||this).lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=t,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(function(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}(e)),e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.destroy=function(){this.clearTimer(),k.prototype.destroy.call(this)},s.onFragLoading=function(t){var e=t.frag;if(e.type==="main"&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var o,f,p=this.hls,v=p.config,b=e.level;p.levels[b].details.live?(o=v.abrEwmaFastLive,f=v.abrEwmaSlowLive):(o=v.abrEwmaFastVoD,f=v.abrEwmaSlowVoD),this._bwEstimator=new Ue(p,f,o,v.abrEwmaDefaultEstimate)}},s._abandonRulesCheck=function(){var t=this.hls,e=t.media,o=this.fragCurrent;if(o){var f=o.loader;if(!f||f.stats&&f.stats.aborted)return d.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var p=f.stats;if(e&&p&&(!e.paused&&e.playbackRate!==0||!e.readyState)&&o.autoLevel&&o.level){var v=Se.now()-p.trequest,b=Math.abs(e.playbackRate);if(v>500*o.duration/b){var L=t.levels,O=Math.max(1,p.bw?p.bw/8:1e3*p.loaded/v),M=L[o.level];if(!M)return;var B=M.realBitrate?Math.max(M.realBitrate,M.bitrate):M.bitrate,z=p.total?p.total:Math.max(p.loaded,Math.round(o.duration*B/8)),$=e.currentTime,ut=(z-p.loaded)/O,vt=(T.bufferInfo(e,$,t.config.maxBufferHole).end-$)/b;if(vt<2*o.duration/b&&ut>vt){var mt,at=t.minAutoLevel;for(mt=o.level-1;mt>at;mt--){var Bt=L[mt].realBitrate?Math.max(L[mt].realBitrate,L[mt].bitrate):L[mt].bitrate;if(o.duration*Bt/(6.4*O)<vt)break}void 0<ut&&(d.b.warn("loading too slow, abort fragment loading and switch to level "+mt+":fragLoadedDelay["+mt+"]<fragLoadedDelay["+(o.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+ut.toFixed(1)+":"+vt.toFixed(1)),t.nextLoadLevel=mt,this._bwEstimator.sample(v,p.loaded),f.abort(),this.clearTimer(),t.trigger(h.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:o,stats:p}))}}}}},s.onFragLoaded=function(t){var e=t.frag;if(e.type==="main"&&Object(I.a)(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[e.level],f=(o.loaded?o.loaded.bytes:0)+t.stats.loaded,p=(o.loaded?o.loaded.duration:0)+t.frag.duration;o.loaded={bytes:f,duration:p},o.realBitrate=Math.round(8*f/p)}if(t.frag.bitrateTest){var v=t.stats;v.tparsed=v.tbuffered=v.tload,this.onFragBuffered(t)}}},s.onFragBuffered=function(t){var e=t.stats,o=t.frag;if(e.aborted!==!0&&o.type==="main"&&Object(I.a)(o.sn)&&(!o.bitrateTest||e.tload===e.tbuffered)){var f=e.tparsed-e.trequest;d.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(f,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),o.bitrateTest?this.bitrateTestDelay=f/1e3:this.bitrateTestDelay=0}},s.onError=function(t){switch(t.details){case _.a.FRAG_LOAD_ERROR:case _.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},s.clearTimer=function(){clearInterval(this.timer),this.timer=null},s._findBestLevel=function(t,e,o,f,p,v,b,L,O){for(var M=p;M>=f;M--){var B=O[M];if(B){var z=B.details,$=z?z.totalduration/z.fragments.length:e,ut=!!z&&z.live,vt=void 0;vt=M<=t?b*o:L*o;var mt=O[M].realBitrate?Math.max(O[M].realBitrate,O[M].bitrate):O[M].bitrate,at=mt*$/vt;if(d.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+M+"/"+Math.round(vt)+"/"+mt+"/"+$+"/"+v+"/"+at),vt>mt&&(!at||ut&&!this.bitrateTestDelay||at<v))return M}}return-1},c=a,(r=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(t===-1||e&&e.canEstimate()))return t;var o=this._nextABRAutoLevel;return t!==-1&&(o=Math.min(t,o)),o},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,o=t.levels,f=t.config,p=t.minAutoLevel,v=t.media,b=this.lastLoadedFragLevel,L=this.fragCurrent?this.fragCurrent.duration:0,O=v?v.currentTime:0,M=v&&v.playbackRate!==0?Math.abs(v.playbackRate):1,B=this._bwEstimator?this._bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,z=(T.bufferInfo(v,O,f.maxBufferHole).end-O)/M,$=this._findBestLevel(b,L,B,p,e,z,f.abrBandWidthFactor,f.abrBandWidthUpFactor,o);if($>=0)return $;d.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var ut=L?Math.min(L,f.maxStarvationDelay):f.maxStarvationDelay,vt=f.abrBandWidthFactor,mt=f.abrBandWidthUpFactor;if(z===0){var at=this.bitrateTestDelay;at&&(ut=(L?Math.min(L,f.maxLoadingDelay):f.maxLoadingDelay)-at,d.b.trace("bitrate test took "+Math.round(1e3*at)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*ut)+" ms"),vt=mt=1)}return $=this._findBestLevel(b,L,B,p,e,z+ut,vt,mt,o),Math.max($,0)}}])&&Ce(c.prototype,r),i&&Ce(c,i),a}(k),_e=S(),Oe=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,h.a.MEDIA_ATTACHING,h.a.MEDIA_DETACHING,h.a.MANIFEST_PARSED,h.a.BUFFER_RESET,h.a.BUFFER_APPENDING,h.a.BUFFER_CODECS,h.a.BUFFER_EOS,h.a.BUFFER_FLUSHING,h.a.LEVEL_PTS_UPDATED,h.a.LEVEL_UPDATED)||this)._msDuration=null,i._levelDuration=null,i._levelTargetDuration=10,i._live=null,i._objectUrl=null,i._needsFlush=!1,i._needsEos=!1,i.config=void 0,i.audioTimestampOffset=void 0,i.bufferCodecEventsExpected=0,i._bufferCodecEventsTotal=0,i.media=null,i.mediaSource=null,i.segments=[],i.parent=void 0,i.appending=!1,i.appended=0,i.appendError=0,i.flushBufferCounter=0,i.tracks={},i.pendingTracks={},i.sourceBuffer={},i.flushRange=[],i._onMediaSourceOpen=function(){d.b.log("media source opened"),i.hls.trigger(h.a.MEDIA_ATTACHED,{media:i.media});var s=i.mediaSource;s&&s.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},i._onMediaSourceClose=function(){d.b.log("media source closed")},i._onMediaSourceEnded=function(){d.b.log("media source ended")},i._onSBUpdateEnd=function(){if(i.audioTimestampOffset&&i.sourceBuffer.audio){var s=i.sourceBuffer.audio;d.b.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+i.audioTimestampOffset),s.timestampOffset=i.audioTimestampOffset,delete i.audioTimestampOffset}i._needsFlush&&i.doFlush(),i._needsEos&&i.checkEos(),i.appending=!1;var t=i.parent,e=i.segments.reduce(function(b,L){return L.parent===t?b+1:b},0),o={},f=i.sourceBuffer;for(var p in f){var v=f[p];if(!v)throw Error("handling source buffer update end error: source buffer for "+p+" uninitilized and unable to update buffered TimeRanges.");o[p]=v.buffered}i.hls.trigger(h.a.BUFFER_APPENDED,{parent:t,pending:e,timeRanges:o}),i._needsFlush||i.doAppending(),i.updateMediaElementDuration(),e===0&&i.flushLiveBackBuffer()},i._onSBUpdateError=function(s){d.b.error("sourceBuffer error:",s),i.hls.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.BUFFER_APPENDING_ERROR,fatal:!1})},i.config=r.config,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.destroy=function(){k.prototype.destroy.call(this)},c.onLevelPtsUpdated=function(r){var i=r.type,s=this.tracks.audio;if(i==="audio"&&s&&s.container==="audio/mpeg"){var t=this.sourceBuffer.audio;if(!t)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(t.timestampOffset-r.start)>.1){var e=t.updating;try{t.abort()}catch(o){d.b.warn("can not abort audio buffer: "+o)}e?this.audioTimestampOffset=r.start:(d.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+r.start),t.timestampOffset=r.start)}}},c.onManifestParsed=function(r){var i=2;(r.audio&&!r.video||!r.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,d.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.onMediaAttaching=function(r){var i=this.media=r.media;if(i&&_e){var s=this.mediaSource=new _e;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),i.src=window.URL.createObjectURL(s),this._objectUrl=i.src}},c.onMediaDetaching=function(){d.b.log("media source detaching");var r=this.mediaSource;if(r){if(r.readyState==="open")try{r.endOfStream()}catch(i){d.b.warn("onMediaDetaching:"+i.message+" while calling endOfStream")}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):d.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(h.a.MEDIA_DETACHED)},c.checkPendingTracks=function(){var r=this.bufferCodecEventsExpected,i=this.pendingTracks,s=Object.keys(i).length;(s&&!r||s===2)&&(this.createSourceBuffers(i),this.pendingTracks={},this.doAppending())},c.onBufferReset=function(){var r=this.sourceBuffer;for(var i in r){var s=r[i];try{s&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(s),s.removeEventListener("updateend",this._onSBUpdateEnd),s.removeEventListener("error",this._onSBUpdateError))}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},c.onBufferCodecs=function(r){var i=this;Object.keys(this.sourceBuffer).length||(Object.keys(r).forEach(function(s){i.pendingTracks[s]=r[s]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},c.createSourceBuffers=function(r){var i=this.sourceBuffer,s=this.mediaSource;if(!s)throw Error("createSourceBuffers called when mediaSource was null");for(var t in r)if(!i[t]){var e=r[t];if(!e)throw Error("source buffer exists for track "+t+", however track does not");var o=e.levelCodec||e.codec,f=e.container+";codecs="+o;d.b.log("creating sourceBuffer("+f+")");try{var p=i[t]=s.addSourceBuffer(f);p.addEventListener("updateend",this._onSBUpdateEnd),p.addEventListener("error",this._onSBUpdateError),this.tracks[t]={buffer:p,codec:o,id:e.id,container:e.container,levelCodec:e.levelCodec}}catch(v){d.b.error("error while trying to add sourceBuffer:"+v.message),this.hls.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:v,mimeType:f})}}this.hls.trigger(h.a.BUFFER_CREATED,{tracks:this.tracks})},c.onBufferAppending=function(r){this._needsFlush||(this.segments?this.segments.push(r):this.segments=[r],this.doAppending())},c.onBufferEos=function(r){for(var i in this.sourceBuffer)if(!r.type||r.type===i){var s=this.sourceBuffer[i];s&&!s.ended&&(s.ended=!0,d.b.log(i+" sourceBuffer now EOS"))}this.checkEos()},c.checkEos=function(){var r=this.sourceBuffer,i=this.mediaSource;if(i&&i.readyState==="open"){for(var s in r){var t=r[s];if(t){if(!t.ended)return;if(t.updating)return void(this._needsEos=!0)}}d.b.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{i.endOfStream()}catch(e){d.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},c.onBufferFlushing=function(r){r.type?this.flushRange.push({start:r.startOffset,end:r.endOffset,type:r.type}):(this.flushRange.push({start:r.startOffset,end:r.endOffset,type:"video"}),this.flushRange.push({start:r.startOffset,end:r.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},c.flushLiveBackBuffer=function(){if(this._live){var r=this.config.liveBackBufferLength;if(isFinite(r)&&!(r<0))if(this.media)for(var i=this.media.currentTime,s=this.sourceBuffer,t=Object.keys(s),e=i-Math.max(r,this._levelTargetDuration),o=t.length-1;o>=0;o--){var f=t[o],p=s[f];if(p){var v=p.buffered;v.length>0&&e>v.start(0)&&this.removeBufferRange(f,p,0,e)&&this.hls.trigger(h.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:e})}}else d.b.error("flushLiveBackBuffer called without attaching media")}},c.onLevelUpdated=function(r){var i=r.details;i.fragments.length>0&&(this._levelDuration=i.totalduration+i.fragments[0].start,this._levelTargetDuration=i.averagetargetduration||i.targetduration||10,this._live=i.live,this.updateMediaElementDuration())},c.updateMediaElementDuration=function(){var r,i=this.config;if(this._levelDuration!==null&&this.media&&this.mediaSource&&this.sourceBuffer&&this.media.readyState!==0&&this.mediaSource.readyState==="open"){for(var s in this.sourceBuffer){var t=this.sourceBuffer[s];if(t&&t.updating===!0)return}r=this.media.duration,this._msDuration===null&&(this._msDuration=this.mediaSource.duration),this._live===!0&&i.liveDurationInfinity===!0?(d.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>r||!Object(I.a)(r))&&(d.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},c.doFlush=function(){for(;this.flushRange.length;){var r=this.flushRange[0];if(!this.flushBuffer(r.start,r.end,r.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(this.flushRange.length===0){this._needsFlush=!1;var i=0,s=this.sourceBuffer;try{for(var t in s){var e=s[t];e&&(i+=e.buffered.length)}}catch(o){d.b.error("error while accessing sourceBuffer.buffered")}this.appended=i,this.hls.trigger(h.a.BUFFER_FLUSHED)}},c.doAppending=function(){var r=this.config,i=this.hls,s=this.segments,t=this.sourceBuffer;if(Object.keys(t).length){if(!this.media||this.media.error)return this.segments=[],void d.b.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var e=s.shift();if(e)try{var o=t[e.type];if(!o)return void this._onSBUpdateEnd();if(o.updating)return void s.unshift(e);o.ended=!1,this.parent=e.parent,o.appendBuffer(e.data),this.appendError=0,this.appended++,this.appending=!0}catch(p){d.b.error("error while trying to append buffer:"+p.message),s.unshift(e);var f={type:_.b.MEDIA_ERROR,parent:e.parent,details:"",fatal:!1};p.code===22?(this.segments=[],f.details=_.a.BUFFER_FULL_ERROR):(this.appendError++,f.details=_.a.BUFFER_APPEND_ERROR,this.appendError>r.appendErrorMaxRetry&&(d.b.log("fail "+r.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],f.fatal=!0)),i.trigger(h.a.ERROR,f)}}}},c.flushBuffer=function(r,i,s){var t=this.sourceBuffer;if(!Object.keys(t).length)return!0;var e="null";if(this.media&&(e=this.media.currentTime.toFixed(3)),d.b.log("flushBuffer,pos/start/end: "+e+"/"+r+"/"+i),this.flushBufferCounter>=this.appended)return d.b.warn("abort flushing too many retries"),!0;var o=t[s];if(o){if(o.ended=!1,o.updating)return d.b.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(s,o,r,i))return this.flushBufferCounter++,!1}return d.b.log("buffer flushed"),!0},c.removeBufferRange=function(r,i,s,t){try{for(var e=0;e<i.buffered.length;e++){var o=i.buffered.start(e),f=i.buffered.end(e),p=Math.max(o,s),v=Math.min(f,t);if(Math.min(v,f)-p>.5){var b="null";return this.media&&(b=this.media.currentTime.toString()),d.b.log("sb remove "+r+" ["+p+","+v+"], of ["+o+","+f+"], pos:"+b),i.remove(p,v),!0}}}catch(L){d.b.warn("removeBufferRange failed",L)}return!1},a}(k);function ve(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Re=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,h.a.FPS_DROP_LEVEL_CAPPING,h.a.MEDIA_ATTACHING,h.a.MANIFEST_PARSED,h.a.LEVELS_UPDATED,h.a.BUFFER_CODECS,h.a.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e.clientRect=null,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},s.onFpsDropLevelCapping=function(t){a.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},s.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},s.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onLevelsUpdated=function(t){this.levels=t.levels},s.onMediaDetaching=function(){this.stopCapping()},s.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},s.getMaxLevel=function(t){var e=this;if(!this.levels)return-1;var o=this.levels.filter(function(f,p){return a.isLevelAllowed(p,e.restrictedLevels)&&p<=t});return this.clientRect=null,a.getMaxLevelByMediaSize(o,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var o=t.getBoundingClientRect();e.width=o.width,e.height=o.height,e.width||e.height||(e.width=o.right-o.left||t.width||0,e.height=o.bottom-o.top||t.height||0)}return this.clientRect=e,e},a.isLevelAllowed=function(t,e){return e===void 0&&(e=[]),e.indexOf(t)===-1},a.getMaxLevelByMediaSize=function(t,e,o){if(!t||t&&!t.length)return-1;for(var f,p,v=t.length-1,b=0;b<t.length;b+=1){var L=t[b];if((L.width>=e||L.height>=o)&&(f=L,!(p=t[b+1])||f.width!==p.width||f.height!==p.height)){v=b;break}}return v},c=a,i=[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(e){}return t}}],(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*a.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*a.contentScaleFactor}}])&&ve(c.prototype,r),i&&ve(c,i),a}(k),Be=window.performance,Ge=function(g){var l,n;function a(r){return g.call(this,r,h.a.MEDIA_ATTACHING)||this}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},c.onMediaAttaching=function(r){var i=this.hls.config;i.capLevelOnFPSDrop&&(typeof(this.video=r.media instanceof window.HTMLVideoElement?r.media:null).getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod))},c.checkFPS=function(r,i,s){var t=Be.now();if(i){if(this.lastTime){var e=t-this.lastTime,o=s-this.lastDroppedFrames,f=i-this.lastDecodedFrames,p=1e3*o/e,v=this.hls;if(v.trigger(h.a.FPS_DROP,{currentDropped:o,currentDecoded:f,totalDroppedFrames:s}),p>0&&o>v.config.fpsDroppedMonitoringThreshold*f){var b=v.currentLevel;d.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+b),b>0&&(v.autoLevelCapping===-1||v.autoLevelCapping>=b)&&(b-=1,v.trigger(h.a.FPS_DROP_LEVEL_CAPPING,{level:b,droppedLevel:v.currentLevel}),v.autoLevelCapping=b,v.streamController.nextLevelSwitch())}}this.lastTime=t,this.lastDroppedFrames=s,this.lastDecodedFrames=i}},c.checkFPSInterval=function(){var r=this.video;if(r)if(this.isVideoPlaybackQualityAvailable){var i=r.getVideoPlaybackQuality();this.checkFPS(r,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},a}(k),_r=function(){function g(n){n&&n.xhrSetup&&(this.xhrSetup=n.xhrSetup)}var l=g.prototype;return l.destroy=function(){this.abort(),this.loader=null},l.abort=function(){var n=this.loader;n&&n.readyState!==4&&(this.stats.aborted=!0,n.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},l.load=function(n,a,c){this.context=n,this.config=a,this.callbacks=c,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=a.retryDelay,this.loadInternal()},l.loadInternal=function(){var n,a=this.context;n=this.loader=new window.XMLHttpRequest;var c=this.stats;c.tfirst=0,c.loaded=0;var r=this.xhrSetup;try{if(r)try{r(n,a.url)}catch(i){n.open("GET",a.url,!0),r(n,a.url)}n.readyState||n.open("GET",a.url,!0)}catch(i){return void this.callbacks.onError({code:n.status,text:i.message},a,n)}a.rangeEnd&&n.setRequestHeader("Range","bytes="+a.rangeStart+"-"+(a.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=a.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),n.send()},l.readystatechange=function(n){var a=n.currentTarget,c=a.readyState,r=this.stats,i=this.context,s=this.config;if(!r.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),r.tfirst===0&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),c===4){var t=a.status;if(t>=200&&t<300){var e,o;r.tload=Math.max(r.tfirst,window.performance.now()),o=i.responseType==="arraybuffer"?(e=a.response).byteLength:(e=a.responseText).length,r.loaded=r.total=o;var f={url:a.responseURL,data:e};this.callbacks.onSuccess(f,r,i,a)}else r.retry>=s.maxRetry||t>=400&&t<499?(d.b.error(t+" while loading "+i.url),this.callbacks.onError({code:t,text:a.statusText},i,a)):(d.b.warn(t+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)},l.loadtimeout=function(){d.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},l.loadprogress=function(n){var a=n.currentTarget,c=this.stats;c.loaded=n.loaded,n.lengthComputable&&(c.total=n.total);var r=this.callbacks.onProgress;r&&r(c,this.context,null,a)},g}();function Qe(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Rr=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,h.a.MANIFEST_LOADING,h.a.MANIFEST_PARSED,h.a.AUDIO_TRACK_LOADED,h.a.AUDIO_TRACK_SWITCHED,h.a.LEVEL_LOADED,h.a.ERROR)||this)._trackId=-1,e._selectDefaultTrack=!0,e.tracks=[],e.trackIdBlacklist=Object.create(null),e.audioGroupId=null,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},s.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(h.a.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this._selectAudioGroup(this.hls.nextLoadLevel)},s.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)d.b.warn("Invalid audio track id:",t.id);else{if(d.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()}},s.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},s.onLevelLoaded=function(t){this._selectAudioGroup(t.level)},s.onError=function(t){t.type===_.b.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===_.a.AUDIO_TRACK_LOAD_ERROR&&(d.b.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},s._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)d.b.debug("Same id as current audio-track passed, and track details available -> no-op");else if(t<0||t>=this.tracks.length)d.b.warn("Invalid id passed to audio-track controller");else{var e=this.tracks[t];d.b.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var o=e.url,f=e.type,p=e.id;this.hls.trigger(h.a.AUDIO_TRACK_SWITCHING,{id:p,type:f,url:o}),this._loadTrackDetailsIfNeeded(e)}},s.doTick=function(){this._updateTrack(this._trackId)},s._selectAudioGroup=function(t){var e=this.hls.levels[t];if(e&&e.audioGroupIds){var o=e.audioGroupIds[e.urlId];this.audioGroupId!==o&&(this.audioGroupId=o,this._selectInitialAudioTrack())}},s._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var o=this.tracks[this._trackId],f=null;if(o&&(f=o.name),this._selectDefaultTrack){var p=e.filter(function(L){return L.default});p.length?e=p:d.b.warn("No default audio tracks defined")}var v=!1,b=function(){e.forEach(function(L){v||t.audioGroupId&&L.groupId!==t.audioGroupId||f&&f!==L.name||(t._setAudioTrack(L.id),v=!0)})};b(),v||(f=null,b()),v||(d.b.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:_.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},s._needsTrackLoading=function(t){var e=t.details,o=t.url;return!(e&&!e.live)&&!!o},s._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,o=t.id;d.b.log("loading audio-track playlist for id: "+o),this.hls.trigger(h.a.AUDIO_TRACK_LOADING,{url:e,id:o})}},s._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,d.b.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},s._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],o=e.name,f=e.language,p=e.groupId;d.b.warn("Loading failed on audio track id: "+t+", group-id: "+p+', name/language: "'+o+'" / "'+f+'"');for(var v=t,b=0;b<this.tracks.length;b++)if(!this.trackIdBlacklist[b]&&this.tracks[b].name===o){v=b;break}v!==t?(d.b.log("Attempting audio-track fallback id:",v,"group-id:",this.tracks[v].groupId),this._setAudioTrack(v)):d.b.warn('No fallback audio-track found for name/language: "'+o+'" / "'+f+'"')},c=a,(r=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1}}])&&Qe(c.prototype,r),i&&Qe(c,i),a}(xt);function $e(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Ae=window.performance,Ar=function(g){var l,n;function a(t,e){var o;return(o=g.call(this,t,h.a.MEDIA_ATTACHED,h.a.MEDIA_DETACHING,h.a.AUDIO_TRACKS_UPDATED,h.a.AUDIO_TRACK_SWITCHING,h.a.AUDIO_TRACK_LOADED,h.a.KEY_LOADED,h.a.FRAG_LOADED,h.a.FRAG_PARSING_INIT_SEGMENT,h.a.FRAG_PARSING_DATA,h.a.FRAG_PARSED,h.a.ERROR,h.a.BUFFER_RESET,h.a.BUFFER_CREATED,h.a.BUFFER_APPENDED,h.a.BUFFER_FLUSHED,h.a.INIT_PTS_FOUND)||this).fragmentTracker=e,o.config=t.config,o.audioCodecSwap=!1,o._state=kt,o.initPTS=[],o.waitingFragment=null,o.videoTrackCC=null,o.waitingVideoCC=null,o}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.onInitPtsFound=function(t){var e=t.id,o=t.frag.cc,f=t.initPTS;e==="main"&&(this.initPTS[o]=f,this.videoTrackCC=o,d.b.log("InitPTS for cc: "+o+" found from main: "+f),this.state===se&&this.tick())},s.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&t===-1?(d.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=st):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=Gt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=kt},s.doTick=function(){var t,e,o,f=this.hls,p=f.config;switch(this.state){case Yt:case Wt:case Vt:break;case Gt:this.state=qt,this.loadedmetadata=!1;break;case st:var v=this.tracks;if(!v||!this.media&&(this.startFragRequested||!p.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if((t=this.nextLoadPosition)===void 0)break;var b=this.mediaBuffer?this.mediaBuffer:this.media,L=this.videoBuffer?this.videoBuffer:this.media,O=t<p.maxBufferHole?Math.max(2,p.maxBufferHole):p.maxBufferHole,M=T.bufferInfo(b,t,O),B=T.bufferInfo(L,t,O),z=M.len,$=M.end,ut=this.fragPrevious,vt=Math.min(p.maxBufferLength,p.maxMaxBufferLength),mt=Math.max(vt,B.len),at=this.audioSwitch,Bt=this.trackId;if((z<mt||at)&&Bt<v.length){if((o=v[Bt].details)===void 0){this.state=qt;break}if(!at&&this._streamEnded(M,o))return this.hls.trigger(h.a.BUFFER_EOS,{type:"audio"}),void(this.state=$t);var bt,Qt=o.fragments,fe=Qt.length,le=Qt[0].start,ke=Qt[fe-1].start+Qt[fe-1].duration;if(at){if(o.live&&!o.PTSKnown)d.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),$=0;else if($=t,o.PTSKnown&&t<le){if(!(M.end>le||M.nextStart))return;d.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=le+.05}}if(o.initSegment&&!o.initSegment.data)bt=o.initSegment;else if($<=le){if(bt=Qt[0],this.videoTrackCC!==null&&bt.cc!==this.videoTrackCC&&(bt=function(Xe,Er){return y.search(Xe,function(Sr){return Sr.cc<Er?1:Sr.cc>Er?-1:0})}(Qt,this.videoTrackCC)),o.live&&bt.loadIdx&&bt.loadIdx===this.fragLoadIdx){var Ee=M.nextStart?M.nextStart:le;return d.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(Ee+.05)),void(this.media.currentTime=Ee+.05)}}else{var ue,Me=p.maxFragLookUpTolerance,We=ut?Qt[ut.sn-Qt[0].sn+1]:void 0;$<ke?($>ke-Me&&(Me=0),ue=We&&!Tt($,Me,We)?We:y.search(Qt,function(Xe){return Tt($,Me,Xe)})):ue=Qt[fe-1],ue&&(bt=ue,le=ue.start,ut&&bt.level===ut.level&&bt.sn===ut.sn&&(bt.sn<o.endSN?(bt=Qt[bt.sn+1-o.startSN],this.fragmentTracker.getState(bt)!==te&&d.b.log("SN just loaded, load next one: "+bt.sn)):bt=null))}bt&&(bt.encrypted?(d.b.log("Loading key for "+bt.sn+" of ["+o.startSN+" ,"+o.endSN+"],track "+Bt),this.state=Ut,f.trigger(h.a.KEY_LOADING,{frag:bt})):(this.fragCurrent=bt,(at||this.fragmentTracker.getState(bt)===Lt)&&(d.b.log("Loading "+bt.sn+", cc: "+bt.cc+" of ["+o.startSN+" ,"+o.endSN+"],track "+Bt+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+t+", bufferEnd: "+$.toFixed(3)),bt.sn!=="initSegment"&&(this.startFragRequested=!0),Object(I.a)(bt.sn)&&(this.nextLoadPosition=bt.start+bt.duration),f.trigger(h.a.FRAG_LOADING,{frag:bt}),this.state=wt)))}break;case qt:(e=this.tracks[this.trackId])&&e.details&&(this.state=st);break;case re:var zr=Ae.now(),br=this.retryDate,Qr=(b=this.media)&&b.seeking;(!br||zr>=br||Qr)&&(d.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=st);break;case se:var Le=this.waitingFragment;if(Le){var qe=Le.frag.cc;if(this.initPTS[qe]!==void 0)this.waitingFragment=null,this.state=wt,this.onFragLoaded(Le);else if(this.videoTrackCC!==this.waitingVideoCC)d.b.log("Waiting fragment cc ("+qe+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Tr=T.bufferInfo(this.mediaBuffer,this.media.currentTime,p.maxBufferHole);Tt(Tr.end,p.maxFragLookUpTolerance,Le.frag)<0&&(d.b.log("Waiting fragment cc ("+qe+") @ "+Le.frag.start+" cancelled because another fragment at "+Tr.end+" is needed"),this.clearWaitingFragment())}}else this.state=st}},s.clearWaitingFragment=function(){var t=this.waitingFragment;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=st)},s.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var o=this.config;this.tracks&&o.autoStartLoad&&this.startLoad(o.startPosition)},s.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(d.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onAudioTracksUpdated=function(t){d.b.log("audio tracks updated"),this.tracks=t.audioTracks},s.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=Wt,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=st),this.tick()},s.onAudioTrackLoaded=function(t){var e=t.details,o=t.id,f=this.tracks[o],p=f.details,v=e.totalduration,b=0;if(d.b.log("track "+o+" loaded ["+e.startSN+","+e.endSN+"],duration:"+v),e.live||p&&p.live?p&&e.fragments.length>0?(V(p,e),b=e.fragments[0].start,e.PTSKnown?d.b.log("live audio playlist sliding:"+b.toFixed(3)):d.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,d.b.log("live audio playlist - first load, unknown sliding")):e.PTSKnown=!1,f.details=e,!this.startFragRequested){if(this.startPosition===-1){var L=e.startTimeOffset;Object(I.a)(L)?(d.b.log("start time offset found in playlist, adjust startPosition to "+L),this.startPosition=L):e.live?(this.startPosition=this.computeLivePosition(b,e),d.b.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===qt&&(this.state=st),this.tick()},s.onKeyLoaded=function(){this.state===Ut&&(this.state=st,this.tick())},s.onFragLoaded=function(t){var e=this.fragCurrent,o=t.frag;if(this.state===wt&&e&&o.type==="audio"&&o.level===e.level&&o.sn===e.sn){var f=this.tracks[this.trackId],p=f.details,v=p.totalduration,b=e.level,L=e.sn,O=e.cc,M=this.config.defaultAudioCodec||f.audioCodec||"mp4a.40.2",B=this.stats=t.stats;if(L==="initSegment")this.state=st,B.tparsed=B.tbuffered=Ae.now(),p.initSegment.data=t.payload,this.hls.trigger(h.a.FRAG_BUFFERED,{stats:B,frag:e,id:"audio"}),this.tick();else{this.state=Nt,this.appended=!1,this.demuxer||(this.demuxer=new x(this.hls,"audio"));var z=this.initPTS[O],$=p.initSegment?p.initSegment.data:[];z!==void 0?(this.pendingBuffering=!0,d.b.log("Demuxing "+L+" of ["+p.startSN+" ,"+p.endSN+"],track "+b),this.demuxer.push(t.payload,$,M,null,e,v,!1,z)):(d.b.log("Unknown video PTS for cc "+O+", waiting for video PTS before demuxing audio frag "+L+" of ["+p.startSN+" ,"+p.endSN+"],track "+b),this.waitingFragment=t,this.waitingVideoCC=this.videoTrackCC,this.state=se)}}this.fragLoadError=0},s.onFragParsingInitSegment=function(t){var e=this.fragCurrent,o=t.frag;if(e&&t.id==="audio"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt){var f,p=t.tracks;if(p.video&&delete p.video,f=p.audio){f.levelCodec=f.codec,f.id=t.id,this.hls.trigger(h.a.BUFFER_CODECS,p),d.b.log("audio track:audio,container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]");var v=f.initSegment;if(v){var b={type:"audio",data:v,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[b]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.a.BUFFER_APPENDING,b))}this.tick()}}},s.onFragParsingData=function(t){var e=this,o=this.fragCurrent,f=t.frag;if(o&&t.id==="audio"&&t.type==="audio"&&f.sn===o.sn&&f.level===o.level&&this.state===Nt){var p=this.trackId,v=this.tracks[p],b=this.hls;Object(I.a)(t.endPTS)||(t.endPTS=t.startPTS+o.duration,t.endDTS=t.startDTS+o.duration),o.addElementaryStream(D.AUDIO),d.b.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),Q(v.details,o,t.startPTS,t.endPTS);var L=this.media,O=!1;if(this.audioSwitch)if(L&&L.readyState){var M=L.currentTime;d.b.log("switching audio track : currentTime:"+M),M>=t.startPTS&&(d.b.log("switching audio track : flushing all audio"),this.state=Vt,b.trigger(h.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O=!0,this.audioSwitch=!1,b.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:p}))}else this.audioSwitch=!1,b.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:p});var B=this.pendingData;if(!B)return d.b.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void b.trigger(h.a.ERROR,{type:_.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(z){z&&z.length&&B.push({type:t.type,data:z,parent:"audio",content:"data"})}),!O&&B.length&&(B.forEach(function(z){e.state===Nt&&(e.pendingBuffering=!0,e.hls.trigger(h.a.BUFFER_APPENDING,z))}),this.pendingData=[],this.appended=!0)),this.tick()}},s.onFragParsed=function(t){var e=this.fragCurrent,o=t.frag;e&&t.id==="audio"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt&&(this.stats.tparsed=Ae.now(),this.state=Kt,this._checkAppendedParsed())},s.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},s.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},s.onBufferAppended=function(t){if(t.parent==="audio"){var e=this.state;e!==Nt&&e!==Kt||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},s._checkAppendedParsed=function(){if(!(this.state!==Kt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,o=this.hls;if(t){this.fragPrevious=t,e.tbuffered=Ae.now(),o.trigger(h.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var f=this.mediaBuffer?this.mediaBuffer:this.media;f&&d.b.log("audio buffered : "+it.toString(f.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,o.trigger(h.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=st}this.tick()}},s.onError=function(t){var e=t.frag;if(!e||e.type==="audio")switch(t.details){case _.a.FRAG_LOAD_ERROR:case _.a.FRAG_LOAD_TIMEOUT:var o=t.frag;if(o&&o.type!=="audio")break;if(!t.fatal){var f=this.fragLoadError;f?f++:f=1;var p=this.config;if(f<=p.fragLoadingMaxRetry){this.fragLoadError=f;var v=Math.min(Math.pow(2,f-1)*p.fragLoadingRetryDelay,p.fragLoadingMaxRetryTimeout);d.b.warn("AudioStreamController: frag loading failed, retry in "+v+" ms"),this.retryDate=Ae.now()+v,this.state=re}else d.b.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Yt}break;case _.a.AUDIO_TRACK_LOAD_ERROR:case _.a.AUDIO_TRACK_LOAD_TIMEOUT:case _.a.KEY_LOAD_ERROR:case _.a.KEY_LOAD_TIMEOUT:this.state!==Yt&&(this.state=t.fatal?Yt:st,d.b.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case _.a.BUFFER_FULL_ERROR:if(t.parent==="audio"&&(this.state===Nt||this.state===Kt)){var b=this.mediaBuffer,L=this.media.currentTime;if(b&&T.isBuffered(b,L)&&T.isBuffered(b,L+.5)){var O=this.config;O.maxMaxBufferLength>=O.maxBufferLength&&(O.maxMaxBufferLength/=2,d.b.warn("AudioStreamController: reduce max buffer length to "+O.maxMaxBufferLength+"s")),this.state=st}else d.b.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Vt,this.hls.trigger(h.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},s.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(d.b.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(o){t.hls.trigger(h.a.BUFFER_APPENDING,o)}),this.appended=!0,this.pendingData=[],this.state=Kt):(this.state=st,this.fragPrevious=null,this.tick())},c=a,(r=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,d.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}])&&$e(c.prototype,r),i&&$e(c,i),a}(ne),Ze=function(){if(typeof window!="undefined"&&window.VTTCue)return window.VTTCue;var g={"":!0,lr:!0,rl:!0},l={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(r){return typeof r=="string"&&!!l[r.toLowerCase()]&&r.toLowerCase()}function a(r){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var t in s)r[t]=s[t]}return r}function c(r,i,s){var t=this,e={enumerable:!0};t.hasBeenReset=!1;var o="",f=!1,p=r,v=i,b=s,L=null,O="",M=!0,B="auto",z="start",$=50,ut="middle",vt=50,mt="middle";Object.defineProperty(t,"id",a({},e,{get:function(){return o},set:function(at){o=""+at}})),Object.defineProperty(t,"pauseOnExit",a({},e,{get:function(){return f},set:function(at){f=!!at}})),Object.defineProperty(t,"startTime",a({},e,{get:function(){return p},set:function(at){if(typeof at!="number")throw new TypeError("Start time must be set to a number.");p=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"endTime",a({},e,{get:function(){return v},set:function(at){if(typeof at!="number")throw new TypeError("End time must be set to a number.");v=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"text",a({},e,{get:function(){return b},set:function(at){b=""+at,this.hasBeenReset=!0}})),Object.defineProperty(t,"region",a({},e,{get:function(){return L},set:function(at){L=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"vertical",a({},e,{get:function(){return O},set:function(at){var Bt=function(bt){return typeof bt=="string"&&!!g[bt.toLowerCase()]&&bt.toLowerCase()}(at);if(Bt===!1)throw new SyntaxError("An invalid or illegal string was specified.");O=Bt,this.hasBeenReset=!0}})),Object.defineProperty(t,"snapToLines",a({},e,{get:function(){return M},set:function(at){M=!!at,this.hasBeenReset=!0}})),Object.defineProperty(t,"line",a({},e,{get:function(){return B},set:function(at){if(typeof at!="number"&&at!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");B=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"lineAlign",a({},e,{get:function(){return z},set:function(at){var Bt=n(at);if(!Bt)throw new SyntaxError("An invalid or illegal string was specified.");z=Bt,this.hasBeenReset=!0}})),Object.defineProperty(t,"position",a({},e,{get:function(){return $},set:function(at){if(at<0||at>100)throw new Error("Position must be between 0 and 100.");$=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"positionAlign",a({},e,{get:function(){return ut},set:function(at){var Bt=n(at);if(!Bt)throw new SyntaxError("An invalid or illegal string was specified.");ut=Bt,this.hasBeenReset=!0}})),Object.defineProperty(t,"size",a({},e,{get:function(){return vt},set:function(at){if(at<0||at>100)throw new Error("Size must be between 0 and 100.");vt=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"align",a({},e,{get:function(){return mt},set:function(at){var Bt=n(at);if(!Bt)throw new SyntaxError("An invalid or illegal string was specified.");mt=Bt,this.hasBeenReset=!0}})),t.displayState=void 0}return c.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},c}(),kr=function(){return{decode:function(g){if(!g)return"";if(typeof g!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(g))}}};function Je(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new kr,this.regionList=[]}function tr(){this.values=Object.create(null)}function er(g,l,n,a){var c=a?g.split(a):[g];for(var r in c)if(typeof c[r]=="string"){var i=c[r].split(n);i.length===2&&l(i[0],i[1])}}tr.prototype={set:function(g,l){this.get(g)||l===""||(this.values[g]=l)},get:function(g,l,n){return n?this.has(g)?this.values[g]:l[n]:this.has(g)?this.values[g]:l},has:function(g){return g in this.values},alt:function(g,l,n){for(var a=0;a<n.length;++a)if(l===n[a]){this.set(g,l);break}},integer:function(g,l){/^-?\d+$/.test(l)&&this.set(g,parseInt(l,10))},percent:function(g,l){return!!(l.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(l=parseFloat(l))>=0&&l<=100)&&(this.set(g,l),!0)}};var Ke=new Ze(0,0,0),Ie=Ke.align==="middle"?"middle":"center";function Lr(g,l,n){var a=g;function c(){var i=function(s){function t(o,f,p,v){return 3600*(0|o)+60*(0|f)+(0|p)+(0|v)/1e3}var e=s.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return e?e[3]?t(e[1],e[2],e[3].replace(":",""),e[4]):e[1]>59?t(e[1],e[2],0,e[4]):t(0,e[1],e[2],e[4]):null}(g);if(i===null)throw new Error("Malformed timestamp: "+a);return g=g.replace(/^[^\sa-zA-Z-]+/,""),i}function r(){g=g.replace(/^\s+/,"")}if(r(),l.startTime=c(),r(),g.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+a);g=g.substr(3),r(),l.endTime=c(),r(),function(i,s){var t=new tr;er(i,function(f,p){switch(f){case"region":for(var v=n.length-1;v>=0;v--)if(n[v].id===p){t.set(f,n[v].region);break}break;case"vertical":t.alt(f,p,["rl","lr"]);break;case"line":var b=p.split(","),L=b[0];t.integer(f,L),t.percent(f,L)&&t.set("snapToLines",!1),t.alt(f,L,["auto"]),b.length===2&&t.alt("lineAlign",b[1],["start",Ie,"end"]);break;case"position":b=p.split(","),t.percent(f,b[0]),b.length===2&&t.alt("positionAlign",b[1],["start",Ie,"end","line-left","line-right","auto"]);break;case"size":t.percent(f,p);break;case"align":t.alt(f,p,["start",Ie,"end","left","right"])}},/:/,/\s/),s.region=t.get("region",null),s.vertical=t.get("vertical","");var e=t.get("line","auto");e==="auto"&&Ke.line===-1&&(e=-1),s.line=e,s.lineAlign=t.get("lineAlign","start"),s.snapToLines=t.get("snapToLines",!0),s.size=t.get("size",100),s.align=t.get("align",Ie);var o=t.get("position","auto");o==="auto"&&Ke.position===50&&(o=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=o}(g,l)}function rr(g){return g.replace(/<br(?: \/)?>/gi,`
`)}Je.prototype={parse:function(g){var l=this;function n(){var s=l.buffer,t=0;for(s=rr(s);t<s.length&&s[t]!=="\r"&&s[t]!==`
`;)++t;var e=s.substr(0,t);return s[t]==="\r"&&++t,s[t]===`
`&&++t,l.buffer=s.substr(t),e}g&&(l.buffer+=l.decoder.decode(g,{stream:!0}));try{var a;if(l.state==="INITIAL"){if(!/\r\n|\n/.test(l.buffer))return this;var c=(a=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!c||!c[0])throw new Error("Malformed WebVTT signature.");l.state="HEADER"}for(var r=!1;l.buffer;){if(!/\r\n|\n/.test(l.buffer))return this;switch(r?r=!1:a=n(),l.state){case"HEADER":/:/.test(a)?er(a,function(s,t){},/:/):a||(l.state="ID");continue;case"NOTE":a||(l.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){l.state="NOTE";break}if(!a)continue;if(l.cue=new Ze(0,0,""),l.state="CUE",a.indexOf("-->")===-1){l.cue.id=a;continue}case"CUE":try{Lr(a,l.cue,l.regionList)}catch(s){l.cue=null,l.state="BADCUE";continue}l.state="CUETEXT";continue;case"CUETEXT":var i=a.indexOf("-->")!==-1;if(!a||i&&(r=!0)){l.oncue&&l.oncue(l.cue),l.cue=null,l.state="ID";continue}l.cue.text&&(l.cue.text+=`
`),l.cue.text+=a;continue;case"BADCUE":a||(l.state="ID");continue}}}catch(s){l.state==="CUETEXT"&&l.cue&&l.oncue&&l.oncue(l.cue),l.cue=null,l.state=l.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||this.state==="HEADER")&&(this.buffer+=`

`,this.parse()),this.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(g){throw g}return this.onflush&&this.onflush(),this}};var wr=Je;function Dr(g,l,n,a){for(var c,r,i,s,t,e=[],o=window.VTTCue||TextTrackCue,f=0;f<a.rows.length;f++)if(i=!0,s=0,t="",!(c=a.rows[f]).isEmpty()){for(var p=0;p<c.chars.length;p++)c.chars[p].uchar.match(/\s/)&&i?s++:(t+=c.chars[p].uchar,i=!1);c.cueStartTime=l,l===n&&(n+=1e-4),r=new o(l,n,rr(t.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?r.line=f+1:r.line=f>7?f-2:f+1,r.align="left",r.position=Math.max(0,Math.min(100,s/32*100)),e.push(r),g&&g.addCue(r)}return e}var pt,ir={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ar=function(g){var l=g;return ir.hasOwnProperty(g)&&(l=ir[g]),String.fromCharCode(l)},Cr={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Or={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ir={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Pr={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xr=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(g){g[g.ERROR=0]="ERROR",g[g.TEXT=1]="TEXT",g[g.WARNING=2]="WARNING",g[g.INFO=2]="INFO",g[g.DEBUG=3]="DEBUG",g[g.DATA=3]="DATA"})(pt||(pt={}));var Mr=function(){function g(){this.time=null,this.verboseLevel=pt.ERROR}return g.prototype.log=function(l,n){this.verboseLevel>=l&&d.b.log(this.time+" ["+l+"] "+n)},g}(),me=function(g){for(var l=[],n=0;n<g.length;n++)l.push(g[n].toString(16));return l},nr=function(){function g(n,a,c,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=n||"white",this.underline=a||!1,this.italics=c||!1,this.background=r||"black",this.flash=i||!1}var l=g.prototype;return l.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},l.setStyles=function(n){for(var a=["foreground","underline","italics","background","flash"],c=0;c<a.length;c++){var r=a[c];n.hasOwnProperty(r)&&(this[r]=n[r])}},l.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},l.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},l.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},l.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),Fr=function(){function g(n,a,c,r,i,s){this.uchar=void 0,this.penState=void 0,this.uchar=n||" ",this.penState=new nr(a,c,r,i,s)}var l=g.prototype;return l.reset=function(){this.uchar=" ",this.penState.reset()},l.setChar=function(n,a){this.uchar=n,this.penState.copy(a)},l.setPenState=function(n){this.penState.copy(n)},l.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},l.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},l.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),Ur=function(){function g(n){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<100;a++)this.chars.push(new Fr);this.logger=n,this.pos=0,this.currPenState=new nr}var l=g.prototype;return l.equals=function(n){for(var a=!0,c=0;c<100;c++)if(!this.chars[c].equals(n.chars[c])){a=!1;break}return a},l.copy=function(n){for(var a=0;a<100;a++)this.chars[a].copy(n.chars[a])},l.isEmpty=function(){for(var n=!0,a=0;a<100;a++)if(!this.chars[a].isEmpty()){n=!1;break}return n},l.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(pt.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(pt.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},l.moveCursor=function(n){var a=this.pos+n;if(n>1)for(var c=this.pos+1;c<a+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(a)},l.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},l.insertChar=function(n){n>=144&&this.backSpace();var a=ar(n);this.pos>=100?this.logger.log(pt.ERROR,"Cannot insert "+n.toString(16)+" ("+a+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1))},l.clearFromPos=function(n){var a;for(a=n;a<100;a++)this.chars[a].reset()},l.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},l.clearToEndOfRow=function(){this.clearFromPos(this.pos)},l.getTextString=function(){for(var n=[],a=!0,c=0;c<100;c++){var r=this.chars[c].uchar;r!==" "&&(a=!1),n.push(r)}return a?"":n.join("")},l.setPenStyles=function(n){this.currPenState.setStyles(n),this.chars[this.pos].setPenState(this.currPenState)},g}(),je=function(){function g(n){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var a=0;a<15;a++)this.rows.push(new Ur(n));this.logger=n,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var l=g.prototype;return l.reset=function(){for(var n=0;n<15;n++)this.rows[n].clear();this.currRow=14},l.equals=function(n){for(var a=!0,c=0;c<15;c++)if(!this.rows[c].equals(n.rows[c])){a=!1;break}return a},l.copy=function(n){for(var a=0;a<15;a++)this.rows[a].copy(n.rows[a])},l.isEmpty=function(){for(var n=!0,a=0;a<15;a++)if(!this.rows[a].isEmpty()){n=!1;break}return n},l.backSpace=function(){this.rows[this.currRow].backSpace()},l.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},l.insertChar=function(n){this.rows[this.currRow].insertChar(n)},l.setPen=function(n){this.rows[this.currRow].setPenStyles(n)},l.moveCursor=function(n){this.rows[this.currRow].moveCursor(n)},l.setCursor=function(n){this.logger.log(pt.INFO,"setCursor: "+n),this.rows[this.currRow].setCursor(n)},l.setPAC=function(n){this.logger.log(pt.INFO,"pacData = "+JSON.stringify(n));var a=n.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(var c=0;c<15;c++)this.rows[c].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var s=i.rows[r].cueStartTime,t=this.logger.time;if(s&&t!==null&&s<t)for(var e=0;e<this.nrRollUpRows;e++)this.rows[a-this.nrRollUpRows+e+1].copy(i.rows[r+e])}}this.currRow=a;var o=this.rows[this.currRow];if(n.indent!==null){var f=n.indent,p=Math.max(f-1,0);o.setCursor(n.indent),n.color=o.chars[p].penState.foreground}var v={foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1};this.setPen(v)},l.setBkgData=function(n){this.logger.log(pt.INFO,"bkgData = "+JSON.stringify(n)),this.backSpace(),this.setPen(n),this.insertChar(32)},l.setRollUpRows=function(n){this.nrRollUpRows=n},l.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(pt.TEXT,this.getDisplayText());var n=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(n,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(pt.INFO,"Rolling up")}else this.logger.log(pt.DEBUG,"roll_up but nrRollUpRows not set yet")},l.getDisplayText=function(n){n=n||!1;for(var a=[],c="",r=-1,i=0;i<15;i++){var s=this.rows[i].getTextString();s&&(r=i+1,n?a.push("Row "+r+": '"+s+"'"):a.push(s.trim()))}return a.length>0&&(c=n?"["+a.join(" | ")+"]":a.join(`
`)),c},l.getTextAndFormat=function(){return this.rows},g}(),sr=function(){function g(n,a,c){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new je(c),this.nonDisplayedMemory=new je(c),this.lastOutputScreen=new je(c),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=c}var l=g.prototype;return l.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},l.getHandler=function(){return this.outputFilter},l.setHandler=function(n){this.outputFilter=n},l.setPAC=function(n){this.writeScreen.setPAC(n)},l.setBkgData=function(n){this.writeScreen.setBkgData(n)},l.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(pt.INFO,"MODE="+n),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},l.insertChars=function(n){for(var a=0;a<n.length;a++)this.writeScreen.insertChar(n[a]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(pt.INFO,c+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(pt.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},l.ccRCL=function(){this.logger.log(pt.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},l.ccBS=function(){this.logger.log(pt.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},l.ccAOF=function(){},l.ccAON=function(){},l.ccDER=function(){this.logger.log(pt.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},l.ccRU=function(n){this.logger.log(pt.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},l.ccFON=function(){this.logger.log(pt.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},l.ccRDC=function(){this.logger.log(pt.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},l.ccTR=function(){this.logger.log(pt.INFO,"TR"),this.setMode("MODE_TEXT")},l.ccRTD=function(){this.logger.log(pt.INFO,"RTD"),this.setMode("MODE_TEXT")},l.ccEDM=function(){this.logger.log(pt.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},l.ccCR=function(){this.logger.log(pt.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},l.ccENM=function(){this.logger.log(pt.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},l.ccEOC=function(){if(this.logger.log(pt.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=n,this.writeScreen=this.nonDisplayedMemory,this.logger.log(pt.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},l.ccTO=function(n){this.logger.log(pt.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},l.ccMIDROW=function(n){var a={flash:!1};if(a.underline=n%2==1,a.italics=n>=46,a.italics)a.foreground="white";else{var c=Math.floor(n/2)-16;a.foreground=["white","green","blue","cyan","red","yellow","magenta"][c]}this.logger.log(pt.INFO,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)},l.outputDataUpdate=function(n){n===void 0&&(n=!1);var a=this.logger.time;a!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))},l.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},g}();function be(g,l,n){n.a=g,n.b=l}function or(g,l,n){return n.a===g&&n.b===l}var lr=function(){function g(n,a,c){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Mr;this.channels=[null,new sr(n,a,r),new sr(n+1,c,r)],this.cmdHistory={a:null,b:null},this.logger=r}var l=g.prototype;return l.getHandler=function(n){return this.channels[n].getHandler()},l.setHandler=function(n,a){this.channels[n].setHandler(a)},l.addData=function(n,a){var c,r,i,s=!1;this.logger.time=n;for(var t=0;t<a.length;t+=2)if(r=127&a[t],i=127&a[t+1],r!==0||i!==0){if(this.logger.log(pt.DATA,"["+me([a[t],a[t+1]])+"] -> ("+me([r,i])+")"),(c=this.parseCmd(r,i))||(c=this.parseMidrow(r,i)),c||(c=this.parsePAC(r,i)),c||(c=this.parseBackgroundAttributes(r,i)),!c&&(s=this.parseChars(r,i))){var e=this.currentChannel;e&&e>0?this.channels[e].insertChars(s):this.logger.log(pt.WARNING,"No channel found yet. TEXT-MODE?")}c||s||this.logger.log(pt.WARNING,"Couldn't parse cleaned data "+me([r,i])+" orig: "+me([a[t],a[t+1]]))}},l.parseCmd=function(n,a){var c=this.cmdHistory;if(!((n===20||n===28||n===21||n===29)&&a>=32&&a<=47)&&!((n===23||n===31)&&a>=33&&a<=35))return!1;if(or(n,a,c))return be(null,null,c),this.logger.log(pt.DEBUG,"Repeated command ("+me([n,a])+") is dropped"),!0;var r=n===20||n===21||n===23?1:2,i=this.channels[r];return n===20||n===21||n===28||n===29?a===32?i.ccRCL():a===33?i.ccBS():a===34?i.ccAOF():a===35?i.ccAON():a===36?i.ccDER():a===37?i.ccRU(2):a===38?i.ccRU(3):a===39?i.ccRU(4):a===40?i.ccFON():a===41?i.ccRDC():a===42?i.ccTR():a===43?i.ccRTD():a===44?i.ccEDM():a===45?i.ccCR():a===46?i.ccENM():a===47&&i.ccEOC():i.ccTO(a-32),be(n,a,c),this.currentChannel=r,!0},l.parseMidrow=function(n,a){var c=0;if((n===17||n===25)&&a>=32&&a<=47){if((c=n===17?1:2)!==this.currentChannel)return this.logger.log(pt.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[c];return!!r&&(r.ccMIDROW(a),this.logger.log(pt.DEBUG,"MIDROW ("+me([n,a])+")"),!0)}return!1},l.parsePAC=function(n,a){var c,r=this.cmdHistory;if(!((n>=17&&n<=23||n>=25&&n<=31)&&a>=64&&a<=127)&&!((n===16||n===24)&&a>=64&&a<=95))return!1;if(or(n,a,r))return be(null,null,r),!0;var i=n<=23?1:2;c=a>=64&&a<=95?i===1?Cr[n]:Ir[n]:i===1?Or[n]:Pr[n];var s=this.channels[i];return!!s&&(s.setPAC(this.interpretPAC(c,a)),be(n,a,r),this.currentChannel=i,!0)},l.interpretPAC=function(n,a){var c=a,r={color:null,italics:!1,indent:null,underline:!1,row:n};return c=a>95?a-96:a-64,r.underline=(1&c)==1,c<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((c-16)/2),r},l.parseChars=function(n,a){var c,r=null,i=null;if(n>=25?(c=2,i=n-8):(c=1,i=n),i>=17&&i<=19){var s=a;s=i===17?a+80:i===18?a+112:a+144,this.logger.log(pt.INFO,"Special char '"+ar(s)+"' in channel "+c),r=[s]}else n>=32&&n<=127&&(r=a===0?[n]:[n,a]);if(r){var t=me(r);this.logger.log(pt.DEBUG,"Char codes =  "+t.join(",")),be(n,a,this.cmdHistory)}return r},l.parseBackgroundAttributes=function(n,a){var c;if(!((n===16||n===24)&&a>=32&&a<=47)&&!((n===23||n===31)&&a>=45&&a<=47))return!1;var r={};n===16||n===24?(c=Math.floor((a-32)/2),r.background=xr[c],a%2==1&&(r.background=r.background+"_semi")):a===45?r.background="transparent":(r.foreground="black",a===47&&(r.underline=!0));var i=n<=23?1:2;return this.channels[i].setBkgData(r),be(n,a,this.cmdHistory),!0},l.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var a=this.channels[n];a&&a.reset()}this.cmdHistory={a:null,b:null}},l.cueSplitAtTime=function(n){for(var a=0;a<this.channels.length;a++){var c=this.channels[a];c&&c.cueSplitAtTime(n)}},g}(),Pe=function(){function g(n,a){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=n,this.trackName=a}var l=g.prototype;return l.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},l.newCue=function(n,a,c){(this.startTime===null||this.startTime>n)&&(this.startTime=n),this.endTime=a,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},l.reset=function(){this.cueRanges=[]},g}(),He=function(g,l,n){return g.substr(n||0,l.length)===l},Ve=function(g){for(var l=5381,n=g.length;n;)l=33*l^g.charCodeAt(--n);return(l>>>0).toString()},Nr={parse:function(g,l,n,a,c,r){var i,s=Object(ye.b)(new Uint8Array(g)).trim().replace(/\r\n|\n\r|\n|\r/g,`
`).split(`
`),t="00:00.000",e=0,o=0,f=0,p=[],v=!0,b=!1,L=new wr;L.oncue=function(O){var M=n[a],B=n.ccOffset;M&&M.new&&(o!==void 0?B=n.ccOffset=M.start:function(z,$,ut){var vt=z[$],mt=z[vt.prevCC];if(!mt||!mt.new&&vt.new)return z.ccOffset=z.presentationOffset=vt.start,void(vt.new=!1);for(;mt&&mt.new;)z.ccOffset+=vt.start-mt.start,vt.new=!1,mt=z[(vt=mt).prevCC];z.presentationOffset=ut}(n,a,f)),f&&(B=f-n.presentationOffset),b&&(O.startTime+=B-o,O.endTime+=B-o),O.id=Ve(O.startTime.toString())+Ve(O.endTime.toString())+Ve(O.text),O.text=decodeURIComponent(encodeURIComponent(O.text)),O.endTime>0&&p.push(O)},L.onparsingerror=function(O){i=O},L.onflush=function(){i&&r?r(i):c(p)},s.forEach(function(O){if(v){if(He(O,"X-TIMESTAMP-MAP=")){v=!1,b=!0,O.substr(16).split(",").forEach(function(M){He(M,"LOCAL:")?t=M.substr(6):He(M,"MPEGTS:")&&(e=parseInt(M.substr(7)))});try{l+(9e4*n[a].start||0)<0&&(l+=8589934592),e-=l,o=function(M){var B=parseInt(M.substr(-3)),z=parseInt(M.substr(-6,2)),$=parseInt(M.substr(-9,2)),ut=M.length>9?parseInt(M.substr(0,M.indexOf(":"))):0;if(!(Object(I.a)(B)&&Object(I.a)(z)&&Object(I.a)($)&&Object(I.a)(ut)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+M);return B+=1e3*z,B+=6e4*$,B+=36e5*ut}(t)/1e3,f=e/9e4}catch(M){b=!1,i=M}return}O===""&&(v=!1)}L.parse(O+`
`)}),L.flush()}};function xe(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function Br(g,l){return g&&g.label===l.name&&!(g.textTrack1||g.textTrack2)}var Gr=function(g){var l,n;function a(r){var i;if((i=g.call(this,r,h.a.MEDIA_ATTACHING,h.a.MEDIA_DETACHING,h.a.FRAG_PARSING_USERDATA,h.a.FRAG_DECRYPTED,h.a.MANIFEST_LOADING,h.a.MANIFEST_LOADED,h.a.FRAG_LOADED,h.a.INIT_PTS_FOUND)||this).media=null,i.config=void 0,i.enabled=!0,i.Cues=void 0,i.textTracks=[],i.tracks=[],i.initPTS=[],i.unparsedVttFrags=[],i.captionsTracks={},i.nonNativeCaptionsTracks={},i.captionsProperties=void 0,i.cea608Parser1=void 0,i.cea608Parser2=void 0,i.lastSn=-1,i.prevCC=-1,i.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},i.hls=r,i.config=r.config,i.Cues=r.config.cueHandler,i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode},textTrack3:{label:i.config.captionsTextTrack3Label,languageCode:i.config.captionsTextTrack3LanguageCode},textTrack4:{label:i.config.captionsTextTrack4Label,languageCode:i.config.captionsTextTrack4LanguageCode}},i.config.enableCEA708Captions){var s=new Pe(xe(i),"textTrack1"),t=new Pe(xe(i),"textTrack2"),e=new Pe(xe(i),"textTrack3"),o=new Pe(xe(i),"textTrack4");i.cea608Parser1=new lr(1,s,t),i.cea608Parser2=new lr(3,e,o)}return i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.addCues=function(r,i,s,t,e){for(var o,f,p,v,b=!1,L=e.length;L--;){var O=e[L],M=(o=O[0],f=O[1],p=i,v=s,Math.min(f,v)-Math.max(o,p));if(M>=0&&(O[0]=Math.min(O[0],i),O[1]=Math.max(O[1],s),b=!0,M/(s-i)>.5))return}if(b||e.push([i,s]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[r],i,s,t);else{var B=this.Cues.newCue(null,i,s,t);this.hls.trigger(h.a.CUES_PARSED,{type:"captions",cues:B,track:r})}},c.onInitPtsFound=function(r){var i=this,s=r.frag,t=r.id,e=r.initPTS,o=this.unparsedVttFrags;t==="main"&&(this.initPTS[s.cc]=e),o.length&&(this.unparsedVttFrags=[],o.forEach(function(f){i.onFragLoaded(f)}))},c.getExistingTrack=function(r){var i=this.media;if(i)for(var s=0;s<i.textTracks.length;s++){var t=i.textTracks[s];if(t[r])return t}return null},c.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},c.createNativeTrack=function(r){if(!this.captionsTracks[r]){var i=this.captionsProperties,s=this.captionsTracks,t=this.media,e=i[r],o=e.label,f=e.languageCode,p=this.getExistingTrack(r);if(p)s[r]=p,oe(s[r]),we(s[r],t);else{var v=this.createTextTrack("captions",o,f);v&&(v[r]=!0,s[r]=v)}}},c.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var i=this.captionsProperties[r];if(i){var s={_id:r,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[r]=s,this.hls.trigger(h.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}}},c.createTextTrack=function(r,i,s){var t=this.media;if(t)return t.addTextTrack(r,i,s)},c.destroy=function(){g.prototype.destroy.call(this)},c.onMediaAttaching=function(r){this.media=r.media,this._cleanTracks()},c.onMediaDetaching=function(){var r=this.captionsTracks;Object.keys(r).forEach(function(i){oe(r[i]),delete r[i]}),this.nonNativeCaptionsTracks={}},c.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},c._cleanTracks=function(){var r=this.media;if(r){var i=r.textTracks;if(i)for(var s=0;s<i.length;s++)oe(i[s])}},c.onManifestLoaded=function(r){var i=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var s=r.subtitles||[],t=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=r.subtitles||[],this.config.renderTextTracksNatively){var e=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,p){var v;if(p<e.length){for(var b=null,L=0;L<e.length;L++)if(Br(e[L],f)){b=e[L];break}b&&(v=b)}v||(v=i.createTextTrack("subtitles",f.name,f.lang)),f.default?v.mode=i.hls.subtitleDisplay?"showing":"hidden":v.mode="disabled",i.textTracks.push(v)})}else if(!t&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(h.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}this.config.enableCEA708Captions&&r.captions&&r.captions.forEach(function(f){var p=/(?:CC|SERVICE)([1-4])/.exec(f.instreamId);if(p){var v="textTrack"+p[1],b=i.captionsProperties[v];b&&(b.label=f.name,f.lang&&(b.languageCode=f.lang),b.media=f)}})},c.onFragLoaded=function(r){var i=r.frag,s=r.payload,t=this.cea608Parser1,e=this.cea608Parser2,o=this.initPTS,f=this.lastSn,p=this.unparsedVttFrags;if(i.type==="main"){var v=i.sn;i.sn!==f+1&&t&&e&&(t.reset(),e.reset()),this.lastSn=v}else if(i.type==="subtitle")if(s.byteLength){if(!Object(I.a)(o[i.cc]))return p.push(r),void(o.length&&this.hls.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}));var b=i.decryptdata;b!=null&&b.key!=null&&b.method==="AES-128"||this._parseVTTs(i,s)}else this.hls.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i})},c._parseVTTs=function(r,i){var s=this,t=this.hls,e=this.prevCC,o=this.textTracks,f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:e,new:!0},this.prevCC=r.cc),Nr.parse(i,this.initPTS[r.cc],f,r.cc,function(p){if(s.config.renderTextTracksNatively){var v=o[r.level];if(v.mode==="disabled")return void t.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r});p.forEach(function(L){if(!v.cues.getCueById(L.id))try{if(v.addCue(L),!v.cues.getCueById(L.id))throw new Error("addCue is failed for: "+L)}catch(M){d.b.debug("Failed occurred on adding cues: "+M);var O=new window.TextTrackCue(L.startTime,L.endTime,L.text);O.id=L.id,v.addCue(O)}})}else{var b=s.tracks[r.level].default?"default":"subtitles"+r.level;t.trigger(h.a.CUES_PARSED,{type:"subtitles",cues:p,track:b})}t.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(p){d.b.log("Failed to parse VTT cue: "+p),t.trigger(h.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r})})},c.onFragDecrypted=function(r){var i=r.frag,s=r.payload;if(i.type==="subtitle"){if(!Object(I.a)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(r);this._parseVTTs(i,s)}},c.onFragParsingUserdata=function(r){var i=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&i&&s)for(var t=0;t<r.samples.length;t++){var e=r.samples[t].bytes;if(e){var o=this.extractCea608Data(e);i.addData(r.samples[t].pts,o[0]),s.addData(r.samples[t].pts,o[1])}}},c.extractCea608Data=function(r){for(var i=31&r[0],s=2,t=[[],[]],e=0;e<i;e++){var o=r[s++],f=127&r[s++],p=127&r[s++],v=3&o;f===0&&p===0||4&o&&(v!==0&&v!==1||(t[v].push(f),t[v].push(p)))}return t},a}(k);function ur(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}function Ye(g){for(var l=[],n=0;n<g.length;n++){var a=g[n];a.kind==="subtitles"&&a.label&&l.push(g[n])}return l}var Kr=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,h.a.MEDIA_ATTACHED,h.a.MEDIA_DETACHING,h.a.MANIFEST_LOADED,h.a.SUBTITLE_TRACK_LOADED)||this).tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=!0,e.queuedDefaultTrack=null,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.destroy=function(){k.prototype.destroy.call(this)},s.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(Object(I.a)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(I.a)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Ye(this.media.textTracks).forEach(function(t){oe(t)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoaded=function(t){var e=this,o=t.subtitles||[];this.tracks=o,this.hls.trigger(h.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:o}),o.forEach(function(f){f.default&&(e.media?e.subtitleTrack=f.id:e.queuedDefaultTrack=f.id)})},s.onSubtitleTrackLoaded=function(t){var e=this,o=t.id,f=t.details,p=this.trackId,v=this.tracks,b=v[p];if(o>=v.length||o!==p||!b||this.stopped)this._clearReloadTimer();else if(d.b.log("subtitle track "+o+" loaded"),f.live){var L=tt(b.details,f,t.stats.trequest);d.b.log("Reloading live subtitle playlist in "+L+"ms"),this.timer=setTimeout(function(){e._loadCurrentTrack()},L)}else this._clearReloadTimer()},s.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},s._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s._loadCurrentTrack=function(){var t=this.trackId,e=this.tracks,o=this.hls,f=e[t];t<0||!f||f.details&&!f.details.live||(d.b.log("Loading subtitle track "+t),o.trigger(h.a.SUBTITLE_TRACK_LOADING,{url:f.url,id:t}))},s._toggleTrackModes=function(t){var e=this.media,o=this.subtitleDisplay,f=this.trackId;if(e){var p=Ye(e.textTracks);if(t===-1)[].slice.call(p).forEach(function(L){L.mode="disabled"});else{var v=p[f];v&&(v.mode="disabled")}var b=p[t];b&&(b.mode=o?"showing":"hidden")}},s._setSubtitleTrackInternal=function(t){var e=this.hls,o=this.tracks;!Object(I.a)(t)||t<-1||t>=o.length||(this.trackId=t,d.b.log("Switching to subtitle track "+t),e.trigger(h.a.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},s._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=Ye(this.media.textTracks),o=0;o<e.length;o++)if(e[o].mode==="hidden")t=o;else if(e[o].mode==="showing"){t=o;break}this.subtitleTrack=t}},c=a,(r=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this._setSubtitleTrackInternal(t))}}])&&ur(c.prototype,r),i&&ur(c,i),a}(k),jr=J(7),Te,dr=window.performance,Hr=function(g){var l,n;function a(r,i){var s;return(s=g.call(this,r,h.a.MEDIA_ATTACHED,h.a.MEDIA_DETACHING,h.a.ERROR,h.a.KEY_LOADED,h.a.FRAG_LOADED,h.a.SUBTITLE_TRACKS_UPDATED,h.a.SUBTITLE_TRACK_SWITCH,h.a.SUBTITLE_TRACK_LOADED,h.a.SUBTITLE_FRAG_PROCESSED,h.a.LEVEL_UPDATED)||this).fragmentTracker=i,s.config=r.config,s.state=kt,s.tracks=[],s.tracksBuffered=[],s.currentTrackId=-1,s.decrypter=new jr.a(r,r.config),s.lastAVStart=0,s._onMediaSeeking=s.onMediaSeeking.bind(function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s)),s}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c=a.prototype;return c.startLoad=function(){this.stopLoad(),this.state=st;var r=this.tracks[this.currentTrackId];r&&r.details&&(this.setInterval(500),this.tick())},c.onSubtitleFragProcessed=function(r){var i=r.frag,s=r.success;if(this.fragPrevious=i,this.state=st,s){var t=this.tracksBuffered[this.currentTrackId];if(t){for(var e,o=i.start,f=0;f<t.length;f++)if(o>=t[f].start&&o<=t[f].end){e=t[f];break}var p=i.start+i.duration;e?e.end=p:(e={start:o,end:p},t.push(e))}}},c.onMediaAttached=function(r){var i=r.media;this.media=i,i.addEventListener("seeking",this._onMediaSeeking),this.state=st},c.onMediaDetaching=function(){var r=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(i){r.tracksBuffered[i.id]=[]}),this.media=null,this.state=kt)},c.onError=function(r){var i=r.frag;i&&i.type==="subtitle"&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=st)},c.onSubtitleTracksUpdated=function(r){var i=this;d.b.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=r.subtitleTracks,this.tracks.forEach(function(s){i.tracksBuffered[s.id]=[]})},c.onSubtitleTrackSwitch=function(r){if(this.currentTrackId=r.id,this.tracks&&this.tracks.length&&this.currentTrackId!==-1){var i=this.tracks[this.currentTrackId];i&&i.details&&this.setInterval(500)}else this.clearInterval()},c.onSubtitleTrackLoaded=function(r){var i=r.id,s=r.details,t=this.currentTrackId,e=this.tracks,o=e[t];i>=e.length||i!==t||!o||(s.live&&function(f,p,v){v===void 0&&(v=0);var b=-1;q(f,p,function(M,B,z){B.start=M.start,b=z});var L=p.fragments;if(b<0)L.forEach(function(M){M.start+=v});else for(var O=b+1;O<L.length;O++)L[O].start=L[O-1].start+L[O-1].duration}(o.details,s,this.lastAVStart),o.details=s,this.setInterval(500))},c.onKeyLoaded=function(){this.state===Ut&&(this.state=st)},c.onFragLoaded=function(r){var i=this.fragCurrent,s=r.frag.decryptdata,t=r.frag,e=this.hls;if(this.state===wt&&i&&r.frag.type==="subtitle"&&i.sn===r.frag.sn&&r.payload.byteLength>0&&s&&s.key&&s.method==="AES-128"){var o=dr.now();this.decrypter.decrypt(r.payload,s.key.buffer,s.iv.buffer,function(f){var p=dr.now();e.trigger(h.a.FRAG_DECRYPTED,{frag:t,payload:f,stats:{tstart:o,tdecrypt:p}})})}},c.onLevelUpdated=function(r){var i=r.details.fragments;this.lastAVStart=i.length?i[0].start:0},c.doTick=function(){if(this.media)switch(this.state){case st:var r=this.config,i=this.currentTrackId,s=this.fragmentTracker,t=this.media,e=this.tracks;if(!e||!e[i]||!e[i].details)break;var o,f=r.maxBufferHole,p=r.maxFragLookUpTolerance,v=Math.min(r.maxBufferLength,r.maxMaxBufferLength),b=T.bufferedInfo(this._getBuffered(),t.currentTime,f),L=b.end,O=b.len,M=e[i].details,B=M.fragments,z=B.length,$=B[z-1].start+B[z-1].duration;if(O>v)return;var ut=this.fragPrevious;L<$?(ut&&M.hasProgramDateTime&&(o=It(B,ut.endProgramDateTime,p)),o||(o=gt(ut,B,L,p))):o=B[z-1],o&&o.encrypted?(d.b.log("Loading key for "+o.sn),this.state=Ut,this.hls.trigger(h.a.KEY_LOADING,{frag:o})):o&&s.getState(o)===Lt&&(this.fragCurrent=o,this.state=wt,this.hls.trigger(h.a.FRAG_LOADING,{frag:o}))}else this.state=st},c.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,g.prototype.stopLoad.call(this)},c._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},c.onMediaSeeking=function(){if(this.fragCurrent){var r=this.media?this.media.currentTime:0,i=this.config.maxFragLookUpTolerance,s=this.fragCurrent.start-i,t=this.fragCurrent.start+this.fragCurrent.duration+i;(r<s||r>t)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=st,this.tick())}},a}(ne);(function(g){g.WIDEVINE="com.widevine.alpha",g.PLAYREADY="com.microsoft.playready"})(Te||(Te={}));var Vr=typeof window!="undefined"&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function cr(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Yr=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,h.a.MEDIA_ATTACHED,h.a.MEDIA_DETACHED,h.a.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,e._licenseXhrSetup=void 0,e._emeEnabled=void 0,e._requestMediaKeySystemAccess=void 0,e._drmSystemOptions=void 0,e._config=void 0,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._requestLicenseFailureCount=0,e.mediaKeysPromise=null,e._onMediaEncrypted=function(o){if(d.b.log('Media is encrypted using "'+o.initDataType+'" init data type'),!e.mediaKeysPromise)return d.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void e.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var f=function(p){e._media&&(e._attemptSetMediaKeys(p),e._generateRequestWithPreferredKeySession(o.initDataType,o.initData))};e.mediaKeysPromise.then(f).catch(f)},e._config=t.config,e._widevineLicenseUrl=e._config.widevineLicenseUrl,e._licenseXhrSetup=e._config.licenseXhrSetup,e._emeEnabled=e._config.emeEnabled,e._requestMediaKeySystemAccess=e._config.requestMediaKeySystemAccessFunc,e._drmSystemOptions=t.config.drmSystemOptions,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var c,r,i,s=a.prototype;return s.getLicenseServerUrl=function(t){switch(t){case Te.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},s._attemptKeySystemAccess=function(t,e,o){var f=this,p=function(b,L,O,M){switch(b){case Te.WIDEVINE:return function(B,z,$){var ut={audioCapabilities:[],videoCapabilities:[]};return B.forEach(function(vt){ut.audioCapabilities.push({contentType:'audio/mp4; codecs="'+vt+'"',robustness:$.audioRobustness||""})}),z.forEach(function(vt){ut.videoCapabilities.push({contentType:'video/mp4; codecs="'+vt+'"',robustness:$.videoRobustness||""})}),[ut]}(L,O,M);default:throw new Error("Unknown key-system: "+b)}}(t,e,o,this._drmSystemOptions);d.b.log("Requesting encrypted media key-system access");var v=this.requestMediaKeySystemAccess(t,p);this.mediaKeysPromise=v.then(function(b){return f._onMediaKeySystemAccessObtained(t,b)}),v.catch(function(b){d.b.error('Failed to obtain key-system "'+t+'" access:',b)})},s._onMediaKeySystemAccessObtained=function(t,e){var o=this;d.b.log('Access for key-system "'+t+'" obtained');var f={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(f);var p=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(v){return f.mediaKeys=v,d.b.log('Media-keys created for key-system "'+t+'"'),o._onMediaKeysCreated(),v});return p.catch(function(v){d.b.error("Failed to create media-keys:",v)}),p},s._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},s._onNewMediaKeySession=function(t){var e=this;d.b.log("New key-system session "+t.sessionId),t.addEventListener("message",function(o){e._onKeySessionMessage(t,o.message)},!1)},s._onKeySessionMessage=function(t,e){d.b.log("Got EME message event, creating license request"),this._requestLicense(e,function(o){d.b.log("Received license data (length: "+(o&&o.byteLength)+"), updating key-session"),t.update(o)})},s._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return d.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_KEYS,fatal:!0});d.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},s._generateRequestWithPreferredKeySession=function(t,e){var o=this,f=this._mediaKeysList[0];if(!f)return d.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(f.mediaKeysSessionInitialized)d.b.warn("Key-Session already initialized but requested again");else{var p=f.mediaKeysSession;if(!p)return d.b.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return d.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});d.b.log('Generating key-session request for "'+t+'" init data type'),f.mediaKeysSessionInitialized=!0,p.generateRequest(t,e).then(function(){d.b.debug("Key-session generation succeeded")}).catch(function(v){d.b.error("Error generating key-session request:",v),o.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},s._createLicenseXhr=function(t,e,o){var f=new XMLHttpRequest,p=this._licenseXhrSetup;try{if(p)try{p(f,t)}catch(v){f.open("POST",t,!0),p(f,t)}f.readyState||f.open("POST",t,!0)}catch(v){throw new Error("issue setting up KeySystem license XHR "+v)}return f.responseType="arraybuffer",f.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,f,t,e,o),f},s._onLicenseRequestReadyStageChange=function(t,e,o,f){switch(t.readyState){case 4:if(t.status===200)this._requestLicenseFailureCount=0,d.b.log("License request succeeded"),t.responseType!=="arraybuffer"&&d.b.warn("xhr response type was not set to the expected arraybuffer for license request"),f(t.response);else{if(d.b.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var p=3-this._requestLicenseFailureCount+1;d.b.warn("Retrying license request, "+p+" attempts left"),this._requestLicense(o,f)}}},s._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case Te.WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},s._requestLicense=function(t,e){d.b.log("Requesting content license for key-system");var o=this._mediaKeysList[0];if(!o)return d.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var f=this.getLicenseServerUrl(o.mediaKeySystemDomain),p=this._createLicenseXhr(f,t,e);d.b.log("Sending license request to URL: "+f);var v=this._generateLicenseRequestChallenge(o,t);p.send(v)}catch(b){d.b.error("Failure requesting DRM license: "+b),this.hls.trigger(h.a.ERROR,{type:_.b.KEY_SYSTEM_ERROR,details:_.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},s.onMediaAttached=function(t){if(this._emeEnabled){var e=t.media;this._media=e,e.addEventListener("encrypted",this._onMediaEncrypted)}},s.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(o){if(o.mediaKeysSession)return o.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},s.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map(function(f){return f.audioCodec}),o=t.levels.map(function(f){return f.videoCodec});this._attemptKeySystemAccess(Te.WIDEVINE,e,o)}},c=a,(r=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&cr(c.prototype,r),i&&cr(c,i),a}(k);function hr(g,l){var n=Object.keys(g);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(g);l&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(g,c).enumerable})),n.push.apply(n,a)}return n}function fr(g){for(var l=1;l<arguments.length;l++){var n=arguments[l]!=null?arguments[l]:{};l%2?hr(Object(n),!0).forEach(function(a){Wr(g,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(n)):hr(Object(n)).forEach(function(a){Object.defineProperty(g,a,Object.getOwnPropertyDescriptor(n,a))})}return g}function Wr(g,l,n){return l in g?Object.defineProperty(g,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):g[l]=n,g}var qr=fr(fr({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_r,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Ne,bufferController:Oe,capLevelController:Re,fpsController:Ge,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Vr,testBandwidth:!0},{cueHandler:X,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Hr,subtitleTrackController:Kr,timelineController:Gr,audioStreamController:Ar,audioTrackController:Rr,emeController:Yr});function gr(g,l){var n=Object.keys(g);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(g);l&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(g,c).enumerable})),n.push.apply(n,a)}return n}function pr(g){for(var l=1;l<arguments.length;l++){var n=arguments[l]!=null?arguments[l]:{};l%2?gr(Object(n),!0).forEach(function(a){Xr(g,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(n)):gr(Object(n)).forEach(function(a){Object.defineProperty(g,a,Object.getOwnPropertyDescriptor(n,a))})}return g}function Xr(g,l,n){return l in g?Object.defineProperty(g,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):g[l]=n,g}function jt(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function vr(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}function mr(g,l,n){return l&&vr(g.prototype,l),n&&vr(g,n),g}var yr=function(g){var l,n;function a(r){var i;r===void 0&&(r={}),(i=g.call(this)||this).config=void 0,i._autoLevelCapping=void 0,i.abrController=void 0,i.capLevelController=void 0,i.levelController=void 0,i.streamController=void 0,i.networkControllers=void 0,i.audioTrackController=void 0,i.subtitleTrackController=void 0,i.emeController=void 0,i.coreComponents=void 0,i.media=null,i.url=null;var s=a.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");i.config=pr(pr({},s),r);var t=jt(i).config;if(t.liveMaxLatencyDurationCount!==void 0&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(d.a)(t.debug),i._autoLevelCapping=-1;var e=i.abrController=new t.abrController(jt(i)),o=new t.bufferController(jt(i)),f=i.capLevelController=new t.capLevelController(jt(i)),p=new t.fpsController(jt(i)),v=new Ft(jt(i)),b=new de(jt(i)),L=new Ot(jt(i)),O=new De(jt(i)),M=i.levelController=new Fe(jt(i)),B=new ce(jt(i)),z=[M,i.streamController=new ge(jt(i),B)],$=t.audioStreamController;$&&z.push(new $(jt(i),B)),i.networkControllers=z;var ut=[v,b,L,e,o,f,p,O,B];if($=t.audioTrackController){var vt=new $(jt(i));i.audioTrackController=vt,ut.push(vt)}if($=t.subtitleTrackController){var mt=new $(jt(i));i.subtitleTrackController=mt,z.push(mt)}if($=t.emeController){var at=new $(jt(i));i.emeController=at,ut.push(at)}return($=t.subtitleStreamController)&&z.push(new $(jt(i),B)),($=t.timelineController)&&ut.push(new $(jt(i))),i.coreComponents=ut,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n,a.isSupported=function(){return function(){var r=S();if(!r)return!1;var i=self.SourceBuffer||self.WebKitSourceBuffer,s=r&&typeof r.isTypeSupported=="function"&&r.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!i||i.prototype&&typeof i.prototype.appendBuffer=="function"&&typeof i.prototype.remove=="function";return!!s&&!!t}()},mr(a,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return h.a}},{key:"ErrorTypes",get:function(){return _.b}},{key:"ErrorDetails",get:function(){return _.a}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:qr},set:function(r){a.defaultConfig=r}}]);var c=a.prototype;return c.destroy=function(){d.b.log("destroy"),this.trigger(h.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(r){r.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},c.attachMedia=function(r){d.b.log("attachMedia"),this.media=r,this.trigger(h.a.MEDIA_ATTACHING,{media:r})},c.detachMedia=function(){d.b.log("detachMedia"),this.trigger(h.a.MEDIA_DETACHING),this.media=null},c.loadSource=function(r){r=ot.buildAbsoluteURL(window.location.href,r,{alwaysNormalize:!0}),d.b.log("loadSource:"+r),this.url=r,this.trigger(h.a.MANIFEST_LOADING,{url:r})},c.startLoad=function(r){r===void 0&&(r=-1),d.b.log("startLoad("+r+")"),this.networkControllers.forEach(function(i){i.startLoad(r)})},c.stopLoad=function(){d.b.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},c.swapAudioCodec=function(){d.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},c.recoverMediaError=function(){d.b.log("recoverMediaError");var r=this.media;this.detachMedia(),r&&this.attachMedia(r)},c.removeLevel=function(r,i){i===void 0&&(i=0),this.levelController.removeLevel(r,i)},mr(a,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){d.b.log("set currentLevel:"+r),this.loadLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){d.b.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){d.b.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){d.b.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){d.b.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",set:function(r){var i=!!r;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){d.b.log("set autoLevelCapping:"+r),this._autoLevelCapping=r}},{key:"bandwidthEstimate",get:function(){var r=this.abrController._bwEstimator;return r?r.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var r=this.levels,i=this.config.minAutoBitrate,s=r?r.length:0,t=0;t<s;t++)if((r[t].realBitrate?Math.max(r[t].realBitrate,r[t].bitrate):r[t].bitrate)>i)return t;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,i=this.autoLevelCapping;return i===-1&&r&&r.length?r.length-1:i}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var i=this.audioTrackController;i&&(i.audioTrack=r)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var i=this.subtitleTrackController;i&&(i.subtitleTrack=r)}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return!!r&&r.subtitleDisplay},set:function(r){var i=this.subtitleTrackController;i&&(i.subtitleDisplay=r)}}]),a}(w);yr.defaultConfig=void 0}]).default})},6758:(ze,Mt,ft)=>{"use strict";ft.d(Mt,{A:()=>_});var J=(d,E,k)=>new Promise((C,F)=>{var D=N=>{try{j(k.next(N))}catch(K){F(K)}},U=N=>{try{j(k.throw(N))}catch(K){F(K)}},j=N=>N.done?C(N.value):Promise.resolve(N.value).then(D,U);j((k=k.apply(d,E)).next())});const X="oplayer-plugin-hls",Y=(d,E,k)=>E.format==="hls"||E.format==="m3u8"||(E.format==="auto"||typeof E.format=="undefined")&&/m3u8(#|\?|$)/i.test(E.src)&&(k||!(d.canPlayType("application/x-mpegURL")||d.canPlayType("application/vnd.apple.mpegURL"))),Z=(d,E)=>{if(E.fatal){const k=E.type,C=E.details;d.hasError=!0,d.emit("error",Object.assign({},E,{pluginName:X,message:k+": "+C}))}};class ot{constructor(E){this.key="hls",this.name=X,this.version="1.2.24",this.options={config:{},forceHLS:!1,textControl:!0,audioControl:!0,qualityControl:!0,withBitrate:!1,qualitySwitch:"immediate",matcher:Y,errorHandler:Z},Object.assign(this.options,E)}apply(E){return this.player=E,this}load(E,k){return J(this,null,function*(){var C,F;let D=E.$video;const U=this.options,j=U.matcher,N=U.forceHLS;if(!j(D,k,N)||((F=ot.library)!==null&&F!==void 0||(ot.library=(yield ft.e(458).then(ft.t.bind(ft,9302,19))).default),!ot.library.isSupported()))return!1;const K=this.options,et=K.config,lt=K.active,rt=K.errorHandler;this.instance=new ot.library(et);const dt=this.instance,Rt=this.player;return lt&&lt(dt,ot.library),dt.loadSource(k.src),dt.attachMedia(D),dt.on(ot.library.Events.ERROR,function(St,ct){rt(Rt,ct,Z)}),(C=Rt.context.ui)!=null&&C.setting&&I(Rt,dt,this.options),this})}unload(){var E;(E=this.instance)==null||E.stopLoad()}destroy(){var E;if(this.instance){const k=this.player,C=this.instance,F=this.options.inactive;F&&F(C,ot.library),(E=k.context.ui)!=null&&E.setting&&h(k),C.destroy()}}}ot.library=globalThis.Hls;function _(d){return new ot(d)}const I=function(d,E){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const C=d.context.ui;k.qualityControl&&(E.once(ot.library.Events.MANIFEST_PARSED,()=>{F({icon:C.icons.quality,name:"Quality",settings(){return E.levels.length>1?E.levels.reduce((D,U,j)=>{let N=(U.name||U.height).toString();if(isFinite(+N)&&(N+="p"),k.withBitrate){const K=U.bitrate/1e3,et=K>1e3,lt=et?(K/1e3).toFixed(2):Math.floor(K);N+=" ("+lt+(et?"m":"k")+"bps)"}return D.push({name:N,default:E.currentLevel==j,value:j}),D},[{name:d.locales.get("Auto"),default:E.autoLevelEnabled,value:-1}]):[]},onChange(D){k.qualitySwitch=="immediate"?(E.currentLevel=D.value,D.value!==-1&&(E.loadLevel=D.value)):(E.nextLevel=D.value,D.value!==-1&&(E.nextLoadLevel=D.value))}})}),E.on(ot.library.Events.LEVEL_SWITCHED,function(U,j){let N=j.level;if(E.autoLevelEnabled){const K=E.levels[N].height,et=d.locales.get("Auto")+(K?" ("+K+"p)":"");C.setting.updateLabel(X+"-Quality",et)}else C.setting.select(X+"-Quality",N+1,!1)})),k.audioControl&&E.on(ot.library.Events.AUDIO_TRACK_LOADED,()=>{F({icon:C.icons.lang,name:"Language",settings(){return E.audioTracks.length>1?E.audioTracks.map(D=>{let U=D.name,j=D.lang,N=D.id;return{name:j||U,default:E.audioTrack==N,value:N}}):[]},onChange(D){E.audioTrack=D.value}})}),k.textControl&&E.on(ot.library.Events.SUBTITLE_TRACK_LOADED,()=>{F({icon:C.icons.subtitle,name:"Subtitle",settings(){return E.subtitleTracks.length>1?E.subtitleTracks.reduce((D,U)=>{let j=U.name,N=U.lang,K=U.id;return D.push({name:N||j,default:E.subtitleTrack==K,value:K}),D},[{name:d.locales.get("Off"),default:!E.subtitleDisplay,value:-1}]):[]},onChange(D){let U=D.value;(E.subtitleDisplay=U!=-1)&&(E.subtitleTrack=U)}})});function F(D){const U=D.settings();if(U&&U.length<2)return;const j=D.name,N=D.icon,K=D.onChange;d.context.ui.setting.unregister(X+"-"+j),d.context.ui.setting.register({name:d.locales.get(j),icon:N,onChange:K,type:"selector",key:X+"-"+j,children:U})}},h=d=>{["Quality","Language","Subtitle"].forEach(E=>d.context.ui.setting.unregister(X+"-"+E))}}}]);
