(self.webpackChunk_web_index=self.webpackChunk_web_index||[]).push([[817],{9013:function(ri){typeof window!="undefined"&&function(tr,Ot){ri.exports=Ot()}(this,()=>(()=>{var tr={21:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{default:()=>ce});var oe=function(){function M(X,$){this.subtle=void 0,this.aesIV=void 0,this.subtle=X,this.aesIV=$}return M.prototype.decrypt=function(X,$){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},$,X)},M}(),Q=function(){function M(X,$){this.subtle=void 0,this.key=void 0,this.subtle=X,this.key=$}return M.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},M}(),F=q(145),c=function(){function M(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var X=M.prototype;return X.uint8ArrayToUint32Array_=function($){for(var O=new DataView($),V=new Uint32Array(4),U=0;U<4;U++)V[U]=O.getUint32(4*U);return V},X.initTable=function(){var $=this.sBox,O=this.invSBox,V=this.subMix,U=V[0],G=V[1],N=V[2],le=V[3],ue=this.invSubMix,Re=ue[0],B=ue[1],y=ue[2],C=ue[3],b=new Uint32Array(256),W=0,se=0,ie=0;for(ie=0;ie<256;ie++)b[ie]=ie<128?ie<<1:ie<<1^283;for(ie=0;ie<256;ie++){var te=se^se<<1^se<<2^se<<3^se<<4;te=te>>>8^255&te^99,$[W]=te,O[te]=W;var be=b[W],Ae=b[be],De=b[Ae],Le=257*b[te]^16843008*te;U[W]=Le<<24|Le>>>8,G[W]=Le<<16|Le>>>16,N[W]=Le<<8|Le>>>24,le[W]=Le,Le=16843009*De^65537*Ae^257*be^16843008*W,Re[te]=Le<<24|Le>>>8,B[te]=Le<<16|Le>>>16,y[te]=Le<<8|Le>>>24,C[te]=Le,W?(W=be^b[b[b[De^be]]],se^=b[b[se]]):W=se=1}},X.expandKey=function($){for(var O=this.uint8ArrayToUint32Array_($),V=!0,U=0;U<O.length&&V;)V=O[U]===this.key[U],U++;if(!V){this.key=O;var G=this.keySize=O.length;if(G!==4&&G!==6&&G!==8)throw new Error("Invalid aes key size="+G);var N,le,ue,Re,B=this.ksRows=4*(G+6+1),y=this.keySchedule=new Uint32Array(B),C=this.invKeySchedule=new Uint32Array(B),b=this.sBox,W=this.rcon,se=this.invSubMix,ie=se[0],te=se[1],be=se[2],Ae=se[3];for(N=0;N<B;N++)N<G?ue=y[N]=O[N]:(Re=ue,N%G==0?(Re=b[(Re=Re<<8|Re>>>24)>>>24]<<24|b[Re>>>16&255]<<16|b[Re>>>8&255]<<8|b[255&Re],Re^=W[N/G|0]<<24):G>6&&N%G==4&&(Re=b[Re>>>24]<<24|b[Re>>>16&255]<<16|b[Re>>>8&255]<<8|b[255&Re]),y[N]=ue=(y[N-G]^Re)>>>0);for(le=0;le<B;le++)N=B-le,Re=3&le?y[N]:y[N-4],C[le]=le<4||N<=4?Re:ie[b[Re>>>24]]^te[b[Re>>>16&255]]^be[b[Re>>>8&255]]^Ae[b[255&Re]],C[le]=C[le]>>>0}},X.networkToHostOrderSwap=function($){return $<<24|(65280&$)<<8|(16711680&$)>>8|$>>>24},X.decrypt=function($,O,V){for(var U,G,N,le,ue,Re,B,y,C,b,W,se,ie,te,be=this.keySize+6,Ae=this.invKeySchedule,De=this.invSBox,Le=this.invSubMix,Me=Le[0],Ze=Le[1],j=Le[2],Z=Le[3],H=this.uint8ArrayToUint32Array_(V),de=H[0],he=H[1],pe=H[2],ve=H[3],Te=new Int32Array($),Ce=new Int32Array(Te.length),x=this.networkToHostOrderSwap;O<Te.length;){for(C=x(Te[O]),b=x(Te[O+1]),W=x(Te[O+2]),se=x(Te[O+3]),ue=C^Ae[0],Re=se^Ae[1],B=W^Ae[2],y=b^Ae[3],ie=4,te=1;te<be;te++)U=Me[ue>>>24]^Ze[Re>>16&255]^j[B>>8&255]^Z[255&y]^Ae[ie],G=Me[Re>>>24]^Ze[B>>16&255]^j[y>>8&255]^Z[255&ue]^Ae[ie+1],N=Me[B>>>24]^Ze[y>>16&255]^j[ue>>8&255]^Z[255&Re]^Ae[ie+2],le=Me[y>>>24]^Ze[ue>>16&255]^j[Re>>8&255]^Z[255&B]^Ae[ie+3],ue=U,Re=G,B=N,y=le,ie+=4;U=De[ue>>>24]<<24^De[Re>>16&255]<<16^De[B>>8&255]<<8^De[255&y]^Ae[ie],G=De[Re>>>24]<<24^De[B>>16&255]<<16^De[y>>8&255]<<8^De[255&ue]^Ae[ie+1],N=De[B>>>24]<<24^De[y>>16&255]<<16^De[ue>>8&255]<<8^De[255&Re]^Ae[ie+2],le=De[y>>>24]<<24^De[ue>>16&255]<<16^De[Re>>8&255]<<8^De[255&B]^Ae[ie+3],Ce[O]=x(U^de),Ce[O+1]=x(le^he),Ce[O+2]=x(N^pe),Ce[O+3]=x(G^ve),de=C,he=b,pe=W,ve=se,O+=4}return Ce.buffer},M}(),E=q(93),k=q(63),ce=function(){function M($,O){var V=(O===void 0?{}:O).removePKCS7Padding,U=V===void 0||V;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=$.enableSoftwareAES,this.removePKCS7Padding=U,U)try{var G=self.crypto;G&&(this.subtle=G.subtle||G.webkitSubtle)}catch(N){}this.subtle===null&&(this.useSoftware=!0)}var X=M.prototype;return X.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},X.isSync=function(){return this.useSoftware},X.flush=function(){var $=this.currentResult,O=this.remainderData;if(!$||O)return this.reset(),null;var V,U,G,N=new Uint8Array($);return this.reset(),this.removePKCS7Padding?(G=(U=(V=N).byteLength)&&new DataView(V.buffer).getUint8(U-1))?(0,F.sliceUint8)(V,0,U-G):V:N},X.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},X.decrypt=function($,O,V){var U=this;return this.useSoftware?new Promise(function(G,N){U.softwareDecrypt(new Uint8Array($),O,V);var le=U.flush();le?G(le.buffer):N(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array($),O,V)},X.softwareDecrypt=function($,O,V){var U=this.currentIV,G=this.currentResult,N=this.remainderData;this.logOnce("JS AES decrypt"),N&&($=(0,k.appendUint8Array)(N,$),this.remainderData=null);var le=this.getValidChunk($);if(!le.length)return null;U&&(V=U);var ue=this.softwareDecrypter;ue||(ue=this.softwareDecrypter=new c),ue.expandKey(O);var Re=G;return this.currentResult=ue.decrypt(le.buffer,0,V),this.currentIV=(0,F.sliceUint8)(le,-16).buffer,Re||null},X.webCryptoDecrypt=function($,O,V){var U=this,G=this.subtle;return this.key===O&&this.fastAesKey||(this.key=O,this.fastAesKey=new Q(G,O)),this.fastAesKey.expandKey().then(function(N){return G?(U.logOnce("WebCrypto AES decrypt"),new oe(G,new Uint8Array(V)).decrypt($.buffer,N)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(N){return E.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+N.name+": "+N.message),U.onWebCryptoError($,O,V)})},X.onWebCryptoError=function($,O,V){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt($,O,V);var U=this.flush();if(U)return U.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},X.getValidChunk=function($){var O=$,V=$.length-$.length%16;return V!==$.length&&(O=(0,F.sliceUint8)($,0,V),this.remainderData=(0,F.sliceUint8)($,V)),O},X.logOnce=function($){this.logEnabled&&(E.logger.log("[decrypter]: "+$),this.logEnabled=!1)},M}()},181:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{canParse:()=>k,decodeFrame:()=>O,getID3Data:()=>c,getID3Frames:()=>$,getTimeStamp:()=>ce,isFooter:()=>F,isHeader:()=>Q,isTimeStampFrame:()=>M,testables:()=>ue,utf8ArrayToStr:()=>le});var oe,Q=function(B,y){return y+10<=B.length&&B[y]===73&&B[y+1]===68&&B[y+2]===51&&B[y+3]<255&&B[y+4]<255&&B[y+6]<128&&B[y+7]<128&&B[y+8]<128&&B[y+9]<128},F=function(B,y){return y+10<=B.length&&B[y]===51&&B[y+1]===68&&B[y+2]===73&&B[y+3]<255&&B[y+4]<255&&B[y+6]<128&&B[y+7]<128&&B[y+8]<128&&B[y+9]<128},c=function(B,y){for(var C=y,b=0;Q(B,y);)b+=10,b+=E(B,y+6),F(B,y+10)&&(b+=10),y+=b;if(b>0)return B.subarray(C,C+b)},E=function(B,y){var C=0;return C=(127&B[y])<<21,C|=(127&B[y+1])<<14,(C|=(127&B[y+2])<<7)|127&B[y+3]},k=function(B,y){return Q(B,y)&&E(B,y+6)+10<=B.length-y},ce=function(B){for(var y=$(B),C=0;C<y.length;C++){var b=y[C];if(M(b))return N(b)}},M=function(B){return B&&B.key==="PRIV"&&B.info==="com.apple.streaming.transportStreamTimestamp"},X=function(B){var y=String.fromCharCode(B[0],B[1],B[2],B[3]),C=E(B,4);return{type:y,size:C,data:B.subarray(10,10+C)}},$=function(B){for(var y=0,C=[];Q(B,y);){for(var b=E(B,y+6),W=(y+=10)+b;y+8<W;){var se=X(B.subarray(y)),ie=O(se);ie&&C.push(ie),y+=se.size+10}F(B,y)&&(y+=10)}return C},O=function(B){return B.type==="PRIV"?V(B):B.type[0]==="W"?G(B):U(B)},V=function(B){if(!(B.size<2)){var y=le(B.data,!0),C=new Uint8Array(B.data.subarray(y.length+1));return{key:B.type,info:y,data:C.buffer}}},U=function(B){if(!(B.size<2)){if(B.type==="TXXX"){var y=1,C=le(B.data.subarray(y),!0);y+=C.length+1;var b=le(B.data.subarray(y));return{key:B.type,info:C,data:b}}var W=le(B.data.subarray(1));return{key:B.type,data:W}}},G=function(B){if(B.type==="WXXX"){if(B.size<2)return;var y=1,C=le(B.data.subarray(y),!0);y+=C.length+1;var b=le(B.data.subarray(y));return{key:B.type,info:C,data:b}}var W=le(B.data);return{key:B.type,data:W}},N=function(B){if(B.data.byteLength===8){var y=new Uint8Array(B.data),C=1&y[3],b=(y[4]<<23)+(y[5]<<15)+(y[6]<<7)+y[7];return b/=45,C&&(b+=4772185884e-2),Math.round(b)}},le=function(B,y){y===void 0&&(y=!1);var C=Re();if(C){var b=C.decode(B);if(y){var W=b.indexOf("\0");return W!==-1?b.substring(0,W):b}return b.replace(/\0/g,"")}for(var se,ie,te,be=B.length,Ae="",De=0;De<be;){if((se=B[De++])===0&&y)return Ae;if(se!==0&&se!==3)switch(se>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Ae+=String.fromCharCode(se);break;case 12:case 13:ie=B[De++],Ae+=String.fromCharCode((31&se)<<6|63&ie);break;case 14:ie=B[De++],te=B[De++],Ae+=String.fromCharCode((15&se)<<12|(63&ie)<<6|(63&te)<<0)}}return Ae},ue={decodeTextFrame:U};function Re(){return oe||self.TextDecoder===void 0||(oe=new self.TextDecoder("utf-8")),oe}},182:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{default:()=>k});var oe=q(544),Q=q(851),F=q(93),c=q(729),E=q(973);function k($){var O=new c.EventEmitter,V=function(U,G){$.postMessage({event:U,data:G})};O.on(Q.Events.FRAG_DECRYPTED,V),O.on(Q.Events.ERROR,V),$.addEventListener("message",function(U){var G=U.data;switch(G.cmd){case"init":var N=JSON.parse(G.config);$.transmuxer=new oe.default(O,G.typeSupported,N,G.vendor,G.id),(0,F.enableLogs)(N.debug,G.id),function(){var B=function(C){F.logger[C]=function(b){V("workerLog",{logType:C,message:b})}};for(var y in F.logger)B(y)}(),V("init",null);break;case"configure":$.transmuxer.configure(G.config);break;case"demux":var le=$.transmuxer.push(G.data,G.decryptdata,G.chunkMeta,G.state);(0,oe.isPromise)(le)?($.transmuxer.async=!0,le.then(function(B){ce($,B)}).catch(function(B){V(Q.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:G.chunkMeta,fatal:!1,error:B,err:B,reason:"transmuxer-worker push error"})})):($.transmuxer.async=!1,ce($,le));break;case"flush":var ue=G.chunkMeta,Re=$.transmuxer.flush(ue);(0,oe.isPromise)(Re)||$.transmuxer.async?((0,oe.isPromise)(Re)||(Re=Promise.resolve(Re)),Re.then(function(B){X($,B,ue)}).catch(function(B){V(Q.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:G.chunkMeta,fatal:!1,error:B,err:B,reason:"transmuxer-worker flush error"})})):X($,Re,ue)}})}function ce($,O){if(!((V=O.remuxResult).audio||V.video||V.text||V.id3||V.initSegment))return!1;var V,U=[],G=O.remuxResult,N=G.audio,le=G.video;return N&&M(U,N),le&&M(U,le),$.postMessage({event:"transmuxComplete",data:O},U),!0}function M($,O){O.data1&&$.push(O.data1.buffer),O.data2&&$.push(O.data2.buffer)}function X($,O,V){O.reduce(function(U,G){return ce($,G)||U},!1)||$.postMessage({event:"transmuxComplete",data:O[0]}),$.postMessage({event:"flush",data:V})}},544:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{TransmuxConfig:()=>Et,TransmuxState:()=>vt,default:()=>ct,isPromise:()=>St});var oe=q(851),Q=q(973),F=q(21),c=q(965),E=q(181),k=q(856);function ce(P,D){return P===void 0&&(P=""),D===void 0&&(D=9e4),{type:P,id:-1,pid:-1,inputTimeScale:D,sequenceNumber:-1,samples:[],dropped:0}}var M=q(63),X=q(145),$=function(){function P(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var D=P.prototype;return D.resetInitSegment=function(v,T,S,R){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},D.resetTimeStamp=function(v){this.initPTS=v,this.resetContiguity()},D.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},D.canParse=function(v,T){return!1},D.appendFrame=function(v,T,S){},D.demux=function(v,T){this.cachedData&&(v=(0,M.appendUint8Array)(this.cachedData,v),this.cachedData=null);var S,R=E.getID3Data(v,0),I=R?R.length:0,w=this._audioTrack,J=this._id3Track,re=R?E.getTimeStamp(R):void 0,ne=v.length;for((this.basePTS===null||this.frameIndex===0&&(0,c.isFiniteNumber)(re))&&(this.basePTS=O(re,T,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),R&&R.length>0&&J.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:R,type:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});I<ne;){if(this.canParse(v,I)){var ge=this.appendFrame(w,v,I);ge?(this.frameIndex++,this.lastPTS=ge.sample.pts,S=I+=ge.length):I=ne}else E.canParse(v,I)?(R=E.getID3Data(v,I),J.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:R,type:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),S=I+=R.length):I++;if(I===ne&&S!==ne){var Ie=(0,X.sliceUint8)(v,S);this.cachedData?this.cachedData=(0,M.appendUint8Array)(this.cachedData,Ie):this.cachedData=Ie}}return{audioTrack:w,videoTrack:ce(),id3Track:J,textTrack:ce()}},D.demuxSampleAes=function(v,T,S){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},D.flush=function(v){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),{audioTrack:this._audioTrack,videoTrack:ce(),id3Track:this._id3Track,textTrack:ce()}},D.destroy=function(){},P}(),O=function(P,D,v){return(0,c.isFiniteNumber)(P)?90*P:9e4*D+(v||0)};const V=$;var U=q(93);function G(P,D){return P[D]===255&&(246&P[D+1])==240}function N(P,D){return 1&P[D+1]?7:9}function le(P,D){return(3&P[D+3])<<11|P[D+4]<<3|(224&P[D+5])>>>5}function ue(P,D){return D+1<P.length&&G(P,D)}function Re(P,D){if(ue(P,D)){var v=N(P,D);if(D+v>=P.length)return!1;var T=le(P,D);if(T<=v)return!1;var S=D+T;return S===P.length||ue(P,S)}return!1}function B(P,D,v,T,S){if(!P.samplerate){var R=function(I,w,J,re){var ne,ge,Ie,me,we=navigator.userAgent.toLowerCase(),Be=re,Qe=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ne=1+((192&w[J+2])>>>6);var _e=(60&w[J+2])>>>2;if(!(_e>Qe.length-1))return Ie=(1&w[J+2])<<2,Ie|=(192&w[J+3])>>>6,U.logger.log("manifest codec:"+re+", ADTS type:"+ne+", samplingIndex:"+_e),/firefox/i.test(we)?_e>=6?(ne=5,me=new Array(4),ge=_e-3):(ne=2,me=new Array(2),ge=_e):we.indexOf("android")!==-1?(ne=2,me=new Array(2),ge=_e):(ne=5,me=new Array(4),re&&(re.indexOf("mp4a.40.29")!==-1||re.indexOf("mp4a.40.5")!==-1)||!re&&_e>=6?ge=_e-3:((re&&re.indexOf("mp4a.40.2")!==-1&&(_e>=6&&Ie===1||/vivaldi/i.test(we))||!re&&Ie===1)&&(ne=2,me=new Array(2)),ge=_e)),me[0]=ne<<3,me[0]|=(14&_e)>>1,me[1]|=(1&_e)<<7,me[1]|=Ie<<3,ne===5&&(me[1]|=(14&ge)>>1,me[2]=(1&ge)<<7,me[2]|=8,me[3]=0),{config:me,samplerate:Qe[_e],channelCount:Ie,codec:"mp4a.40."+ne,manifestCodec:Be};I.trigger(oe.Events.ERROR,{type:Q.ErrorTypes.MEDIA_ERROR,details:Q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+_e})}(D,v,T,S);if(!R)return;P.config=R.config,P.samplerate=R.samplerate,P.channelCount=R.channelCount,P.codec=R.codec,P.manifestCodec=R.manifestCodec,U.logger.log("parsed codec:"+P.codec+", rate:"+R.samplerate+", channels:"+R.channelCount)}}function y(P){return 9216e4/P}function C(P,D,v,T,S){var R,I=T+S*y(P.samplerate),w=function(we,Be){var Qe=N(we,Be);if(Be+Qe<=we.length){var _e=le(we,Be)-Qe;if(_e>0)return{headerLength:Qe,frameLength:_e}}}(D,v);if(w){var J=w.frameLength,re=w.headerLength,ne=re+J,ge=Math.max(0,v+ne-D.length);ge?(R=new Uint8Array(ne-re)).set(D.subarray(v+re,D.length),0):R=D.subarray(v+re,v+ne);var Ie={unit:R,pts:I};return ge||P.samples.push(Ie),{sample:Ie,length:ne,missing:ge}}var me=D.length-v;return(R=new Uint8Array(me)).set(D.subarray(v,D.length),0),{sample:{unit:R,pts:I},length:me,missing:-1}}function b(P,D){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,T){return v.__proto__=T,v},b(P,D)}const W=function(P){var D,v;function T(R,I){var w;return(w=P.call(this)||this).observer=void 0,w.config=void 0,w.observer=R,w.config=I,w}v=P,(D=T).prototype=Object.create(v.prototype),D.prototype.constructor=D,b(D,v);var S=T.prototype;return S.resetInitSegment=function(R,I,w,J){P.prototype.resetInitSegment.call(this,R,I,w,J),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:I,duration:J,inputTimeScale:9e4,dropped:0}},T.probe=function(R){if(!R)return!1;for(var I=(E.getID3Data(R,0)||[]).length,w=R.length;I<w;I++)if(Re(R,I))return U.logger.log("ADTS sync word found !"),!0;return!1},S.canParse=function(R,I){return function(w,J){return function(re,ne){return ne+5<re.length}(w,J)&&G(w,J)&&le(w,J)<=w.length-J}(R,I)},S.appendFrame=function(R,I,w){B(R,this.observer,I,w,R.manifestCodec);var J=C(R,I,w,this.basePTS,this.frameIndex);if(J&&J.missing===0)return J},T}(V);var se=/\/emsg[-/]ID3/i;const ie=function(){function P(v,T){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=T}var D=P.prototype;return D.resetTimeStamp=function(){},D.resetInitSegment=function(v,T,S,R){var I=this.videoTrack=ce("video",1),w=this.audioTrack=ce("audio",1),J=this.txtTrack=ce("text",1);if(this.id3Track=ce("id3",1),this.timeOffset=0,v&&v.byteLength){var re=(0,M.parseInitSegment)(v);if(re.video){var ne=re.video,ge=ne.id,Ie=ne.timescale,me=ne.codec;I.id=ge,I.timescale=J.timescale=Ie,I.codec=me}if(re.audio){var we=re.audio,Be=we.id,Qe=we.timescale,_e=we.codec;w.id=Be,w.timescale=Qe,w.codec=_e}J.id=M.RemuxerTrackIdConfig.text,I.sampleDuration=0,I.duration=w.duration=R}},D.resetContiguity=function(){},P.probe=function(v){return v=v.length>16384?v.subarray(0,16384):v,(0,M.findBox)(v,["moof"]).length>0},D.demux=function(v,T){this.timeOffset=T;var S=v,R=this.videoTrack,I=this.txtTrack;if(this.config.progressive){this.remainderData&&(S=(0,M.appendUint8Array)(this.remainderData,v));var w=(0,M.segmentValidRange)(S);this.remainderData=w.remainder,R.samples=w.valid||new Uint8Array}else R.samples=S;var J=this.extractID3Track(R,T);return I.samples=(0,M.parseSamples)(T,R),{videoTrack:R,audioTrack:this.audioTrack,id3Track:J,textTrack:this.txtTrack}},D.flush=function(){var v=this.timeOffset,T=this.videoTrack,S=this.txtTrack;T.samples=this.remainderData||new Uint8Array,this.remainderData=null;var R=this.extractID3Track(T,this.timeOffset);return S.samples=(0,M.parseSamples)(v,T),{videoTrack:T,audioTrack:ce(),id3Track:R,textTrack:ce()}},D.extractID3Track=function(v,T){var S=this.id3Track;if(v.samples.length){var R=(0,M.findBox)(v.samples,["emsg"]);R&&R.forEach(function(I){var w=(0,M.parseEmsg)(I);if(se.test(w.schemeIdUri)){var J=(0,c.isFiniteNumber)(w.presentationTime)?w.presentationTime/w.timeScale:T+w.presentationTimeDelta/w.timeScale,re=w.eventDuration===4294967295?Number.POSITIVE_INFINITY:w.eventDuration/w.timeScale;re<=.001&&(re=Number.POSITIVE_INFINITY);var ne=w.payload;S.samples.push({data:ne,len:ne.byteLength,dts:J,pts:J,type:k.MetadataSchema.emsg,duration:re})}})}return S},D.demuxSampleAes=function(v,T,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},D.destroy=function(){},P}();var te=null,be=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ae=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],De=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Le=[0,1,1,4];function Me(P,D,v,T,S){if(!(v+24>D.length)){var R=Ze(D,v);if(R&&v+R.frameLength<=D.length){var I=T+S*(9e4*R.samplesPerFrame/R.sampleRate),w={unit:D.subarray(v,v+R.frameLength),pts:I,dts:I};return P.config=[],P.channelCount=R.channelCount,P.samplerate=R.sampleRate,P.samples.push(w),{sample:w,length:R.frameLength,missing:0}}}}function Ze(P,D){var v=P[D+1]>>3&3,T=P[D+1]>>1&3,S=P[D+2]>>4&15,R=P[D+2]>>2&3;if(v!==1&&S!==0&&S!==15&&R!==3){var I=P[D+2]>>1&1,w=P[D+3]>>6,J=1e3*be[14*(v===3?3-T:T===3?3:4)+S-1],re=Ae[3*(v===3?0:v===2?1:2)+R],ne=w===3?1:2,ge=De[v][T],Ie=Le[T],me=8*ge*Ie,we=Math.floor(ge*J/re+I)*Ie;if(te===null){var Be=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);te=Be?parseInt(Be[1]):0}return te&&te<=87&&T===2&&J>=224e3&&w===0&&(P[D+3]=128|P[D+3]),{sampleRate:re,channelCount:ne,frameLength:we,samplesPerFrame:me}}}function j(P,D){return P[D]===255&&(224&P[D+1])==224&&(6&P[D+1])!=0}function Z(P,D){return D+1<P.length&&j(P,D)}function H(P,D){if(D+1<P.length&&j(P,D)){var v=Ze(P,D),T=4;v!=null&&v.frameLength&&(T=v.frameLength);var S=D+T;return S===P.length||Z(P,S)}return!1}const de=function(){function P(v){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=v,this.bytesAvailable=v.byteLength,this.word=0,this.bitsAvailable=0}var D=P.prototype;return D.loadWord=function(){var v=this.data,T=this.bytesAvailable,S=v.byteLength-T,R=new Uint8Array(4),I=Math.min(4,T);if(I===0)throw new Error("no bytes available");R.set(v.subarray(S,S+I)),this.word=new DataView(R.buffer).getUint32(0),this.bitsAvailable=8*I,this.bytesAvailable-=I},D.skipBits=function(v){var T;v=Math.min(v,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>v?(this.word<<=v,this.bitsAvailable-=v):(v-=this.bitsAvailable,v-=(T=v>>3)<<3,this.bytesAvailable-=T,this.loadWord(),this.word<<=v,this.bitsAvailable-=v)},D.readBits=function(v){var T=Math.min(this.bitsAvailable,v),S=this.word>>>32-T;if(v>32&&U.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=T,this.bitsAvailable>0)this.word<<=T;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(T=v-T)>0&&this.bitsAvailable?S<<T|this.readBits(T):S},D.skipLZ=function(){var v;for(v=0;v<this.bitsAvailable;++v)if(this.word&2147483648>>>v)return this.word<<=v,this.bitsAvailable-=v,v;return this.loadWord(),v+this.skipLZ()},D.skipUEG=function(){this.skipBits(1+this.skipLZ())},D.skipEG=function(){this.skipBits(1+this.skipLZ())},D.readUEG=function(){var v=this.skipLZ();return this.readBits(v+1)-1},D.readEG=function(){var v=this.readUEG();return 1&v?1+v>>>1:-1*(v>>>1)},D.readBoolean=function(){return this.readBits(1)===1},D.readUByte=function(){return this.readBits(8)},D.readUShort=function(){return this.readBits(16)},D.readUInt=function(){return this.readBits(32)},D.skipScalingList=function(v){for(var T=8,S=8,R=0;R<v;R++)S!==0&&(S=(T+this.readEG()+256)%256),T=S===0?T:S},D.readSPS=function(){var v,T,S,R=0,I=0,w=0,J=0,re=this.readUByte.bind(this),ne=this.readBits.bind(this),ge=this.readUEG.bind(this),Ie=this.readBoolean.bind(this),me=this.skipBits.bind(this),we=this.skipEG.bind(this),Be=this.skipUEG.bind(this),Qe=this.skipScalingList.bind(this);re();var _e=re();if(ne(5),me(3),re(),Be(),_e===100||_e===110||_e===122||_e===244||_e===44||_e===83||_e===86||_e===118||_e===128){var rt=ge();if(rt===3&&me(1),Be(),Be(),me(1),Ie())for(T=rt!==3?8:12,S=0;S<T;S++)Ie()&&Qe(S<6?16:64)}Be();var pt=ge();if(pt===0)ge();else if(pt===1)for(me(1),we(),we(),v=ge(),S=0;S<v;S++)we();Be(),me(1);var it=ge(),mt=ge(),dt=ne(1);dt===0&&me(1),me(1),Ie()&&(R=ge(),I=ge(),w=ge(),J=ge());var xe=[1,1];if(Ie()&&Ie())switch(re()){case 1:xe=[1,1];break;case 2:xe=[12,11];break;case 3:xe=[10,11];break;case 4:xe=[16,11];break;case 5:xe=[40,33];break;case 6:xe=[24,11];break;case 7:xe=[20,11];break;case 8:xe=[32,11];break;case 9:xe=[80,33];break;case 10:xe=[18,11];break;case 11:xe=[15,11];break;case 12:xe=[64,33];break;case 13:xe=[160,99];break;case 14:xe=[4,3];break;case 15:xe=[3,2];break;case 16:xe=[2,1];break;case 255:xe=[re()<<8|re(),re()<<8|re()]}return{width:Math.ceil(16*(it+1)-2*R-2*I),height:(2-dt)*(mt+1)*16-(dt?2:4)*(w+J),pixelRatio:xe}},D.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},P}(),he=function(){function P(v,T,S){this.keyData=void 0,this.decrypter=void 0,this.keyData=S,this.decrypter=new F.default(T,{removePKCS7Padding:!1})}var D=P.prototype;return D.decryptBuffer=function(v){return this.decrypter.decrypt(v,this.keyData.key.buffer,this.keyData.iv.buffer)},D.decryptAacSample=function(v,T,S){var R=this,I=v[T].unit;if(!(I.length<=16)){var w=I.subarray(16,I.length-I.length%16),J=w.buffer.slice(w.byteOffset,w.byteOffset+w.length);this.decryptBuffer(J).then(function(re){var ne=new Uint8Array(re);I.set(ne,16),R.decrypter.isSync()||R.decryptAacSamples(v,T+1,S)})}},D.decryptAacSamples=function(v,T,S){for(;;T++){if(T>=v.length)return void S();if(!(v[T].unit.length<32||(this.decryptAacSample(v,T,S),this.decrypter.isSync())))return}},D.getAvcEncryptedData=function(v){for(var T=16*Math.floor((v.length-48)/160)+16,S=new Int8Array(T),R=0,I=32;I<v.length-16;I+=160,R+=16)S.set(v.subarray(I,I+16),R);return S},D.getAvcDecryptedUnit=function(v,T){for(var S=new Uint8Array(T),R=0,I=32;I<v.length-16;I+=160,R+=16)v.set(S.subarray(R,R+16),I);return v},D.decryptAvcSample=function(v,T,S,R,I){var w=this,J=(0,M.discardEPB)(I.data),re=this.getAvcEncryptedData(J);this.decryptBuffer(re.buffer).then(function(ne){I.data=w.getAvcDecryptedUnit(J,ne),w.decrypter.isSync()||w.decryptAvcSamples(v,T,S+1,R)})},D.decryptAvcSamples=function(v,T,S,R){if(v instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,S=0){if(T>=v.length)return void R();for(var I=v[T].units;!(S>=I.length);S++){var w=I[S];if(!(w.data.length<=48||w.type!==1&&w.type!==5||(this.decryptAvcSample(v,T,S,R,w),this.decrypter.isSync())))return}}},P}();function pe(){return pe=Object.assign?Object.assign.bind():function(P){for(var D=1;D<arguments.length;D++){var v=arguments[D];for(var T in v)Object.prototype.hasOwnProperty.call(v,T)&&(P[T]=v[T])}return P},pe.apply(this,arguments)}var ve=188;function Te(P,D,v,T){return{key:P,frame:!1,pts:D,dts:v,units:[],debug:T,length:0}}function Ce(P,D){return((31&P[D+1])<<8)+P[D+2]}function x(P,D){return(31&P[D+10])<<8|P[D+11]}function Oe(P,D,v,T){var S={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},R=D+3+((15&P[D+1])<<8|P[D+2])-4;for(D+=12+((15&P[D+10])<<8|P[D+11]);D<R;){var I=Ce(P,D);switch(P[D]){case 207:if(!T){U.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:S.audio===-1&&(S.audio=I);break;case 21:S.id3===-1&&(S.id3=I);break;case 219:if(!T){U.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:S.avc===-1&&(S.avc=I);break;case 3:case 4:v.mpeg!==!0&&v.mp3!==!0?U.logger.log("MPEG audio found, not supported in this browser"):S.audio===-1&&(S.audio=I,S.segmentCodec="mp3");break;case 36:U.logger.warn("Unsupported HEVC stream type found")}D+=5+((15&P[D+3])<<8|P[D+4])}return S}function Pe(P){var D,v,T,S,R,I=0,w=P.data;if(!P||P.size===0)return null;for(;w[0].length<19&&w.length>1;){var J=new Uint8Array(w[0].length+w[1].length);J.set(w[0]),J.set(w[1],w[0].length),w[0]=J,w.splice(1,1)}if(((D=w[0])[0]<<16)+(D[1]<<8)+D[2]===1){if((v=(D[4]<<8)+D[5])&&v>P.size-6)return null;var re=D[7];192&re&&(S=536870912*(14&D[9])+4194304*(255&D[10])+16384*(254&D[11])+128*(255&D[12])+(254&D[13])/2,64&re?S-(R=536870912*(14&D[14])+4194304*(255&D[15])+16384*(254&D[16])+128*(255&D[17])+(254&D[18])/2)>54e5&&(U.logger.warn(Math.round((S-R)/9e4)+"s delta between PTS and DTS, align them"),S=R):R=S);var ne=(T=D[8])+9;if(P.size<=ne)return null;P.size-=ne;for(var ge=new Uint8Array(P.size),Ie=0,me=w.length;Ie<me;Ie++){var we=(D=w[Ie]).byteLength;if(ne){if(ne>we){ne-=we;continue}D=D.subarray(ne),we-=ne,ne=0}ge.set(D,I),I+=we}return v&&(v-=T+3),{data:ge,pts:S,dts:R,len:v}}return null}function je(P,D){if(P.units.length&&P.frame){if(P.pts===void 0){var v=D.samples,T=v.length;if(!T)return void D.dropped++;var S=v[T-1];P.pts=S.pts,P.dts=S.dts}D.samples.push(P)}P.debug.length&&U.logger.log(P.pts+"/"+P.dts+":"+P.debug)}const Je=function(){function P(v,T,S){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=v,this.config=T,this.typeSupported=S}P.probe=function(v){var T=P.syncOffset(v);return T>0&&U.logger.warn("MPEG2-TS detected but first sync word found @ offset "+T),T!==-1},P.syncOffset=function(v){for(var T=v.length,S=Math.min(940,v.length-ve)+1,R=0;R<S;){for(var I=!1,w=R;w<T&&v[w]===71;w+=ve)if(I||Ce(v,w)!==0||(I=!0),I&&w+ve>S)return R;R++}return-1},P.createTrack=function(v,T){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:M.RemuxerTrackIdConfig[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?T:void 0}};var D=P.prototype;return D.resetInitSegment=function(v,T,S,R){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=P.createTrack("video"),this._audioTrack=P.createTrack("audio",R),this._id3Track=P.createTrack("id3"),this._txtTrack=P.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=T,this.videoCodec=S,this._duration=R},D.resetTimeStamp=function(){},D.resetContiguity=function(){var v=this._audioTrack,T=this._avcTrack,S=this._id3Track;v&&(v.pesData=null),T&&(T.pesData=null),S&&(S.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},D.demux=function(v,T,S,R){var I;S===void 0&&(S=!1),R===void 0&&(R=!1),S||(this.sampleAes=null);var w=this._avcTrack,J=this._audioTrack,re=this._id3Track,ne=this._txtTrack,ge=w.pid,Ie=w.pesData,me=J.pid,we=re.pid,Be=J.pesData,Qe=re.pesData,_e=null,rt=this.pmtParsed,pt=this._pmtId,it=v.length;if(this.remainderData&&(it=(v=(0,M.appendUint8Array)(this.remainderData,v)).length,this.remainderData=null),it<ve&&!R)return this.remainderData=v,{audioTrack:J,videoTrack:w,id3Track:re,textTrack:ne};var mt=Math.max(0,P.syncOffset(v));(it-=(it-mt)%ve)<v.byteLength&&!R&&(this.remainderData=new Uint8Array(v.buffer,it,v.buffer.byteLength-it));for(var dt=0,xe=mt;xe<it;xe+=ve)if(v[xe]===71){var Lt=!!(64&v[xe+1]),It=Ce(v,xe),ot=void 0;if((48&v[xe+3])>>4>1){if((ot=xe+5+v[xe+4])===xe+ve)continue}else ot=xe+4;switch(It){case ge:Lt&&(Ie&&(I=Pe(Ie))&&this.parseAVCPES(w,ne,I,!1),Ie={data:[],size:0}),Ie&&(Ie.data.push(v.subarray(ot,xe+ve)),Ie.size+=xe+ve-ot);break;case me:if(Lt){if(Be&&(I=Pe(Be)))switch(J.segmentCodec){case"aac":this.parseAACPES(J,I);break;case"mp3":this.parseMPEGPES(J,I)}Be={data:[],size:0}}Be&&(Be.data.push(v.subarray(ot,xe+ve)),Be.size+=xe+ve-ot);break;case we:Lt&&(Qe&&(I=Pe(Qe))&&this.parseID3PES(re,I),Qe={data:[],size:0}),Qe&&(Qe.data.push(v.subarray(ot,xe+ve)),Qe.size+=xe+ve-ot);break;case 0:Lt&&(ot+=v[ot]+1),pt=this._pmtId=x(v,ot);break;case pt:Lt&&(ot+=v[ot]+1);var yt=Oe(v,ot,this.typeSupported,S);(ge=yt.avc)>0&&(w.pid=ge),(me=yt.audio)>0&&(J.pid=me,J.segmentCodec=yt.segmentCodec),(we=yt.id3)>0&&(re.pid=we),_e===null||rt||(U.logger.warn("MPEG-TS PMT found at "+xe+" after unknown PID '"+_e+"'. Backtracking to sync byte @"+mt+" to parse all TS packets."),_e=null,xe=mt-188),rt=this.pmtParsed=!0;break;case 17:case 8191:break;default:_e=It}}else dt++;dt>0&&this.observer.emit(oe.Events.ERROR,oe.Events.ERROR,{type:Q.ErrorTypes.MEDIA_ERROR,details:Q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+dt+" TS packet/s that do not start with 0x47"}),w.pesData=Ie,J.pesData=Be,re.pesData=Qe;var Ct={audioTrack:J,videoTrack:w,id3Track:re,textTrack:ne};return R&&this.extractRemainingSamples(Ct),Ct},D.flush=function(){var v,T=this.remainderData;return this.remainderData=null,v=T?this.demux(T,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},D.extractRemainingSamples=function(v){var T,S=v.audioTrack,R=v.videoTrack,I=v.id3Track,w=v.textTrack,J=R.pesData,re=S.pesData,ne=I.pesData;if(J&&(T=Pe(J))?(this.parseAVCPES(R,w,T,!0),R.pesData=null):R.pesData=J,re&&(T=Pe(re))){switch(S.segmentCodec){case"aac":this.parseAACPES(S,T);break;case"mp3":this.parseMPEGPES(S,T)}S.pesData=null}else re!=null&&re.size&&U.logger.log("last AAC PES packet truncated,might overlap between fragments"),S.pesData=re;ne&&(T=Pe(ne))?(this.parseID3PES(I,T),I.pesData=null):I.pesData=ne},D.demuxSampleAes=function(v,T,S){var R=this.demux(v,S,!0,!this.config.progressive),I=this.sampleAes=new he(this.observer,this.config,T);return this.decrypt(R,I)},D.decrypt=function(v,T){return new Promise(function(S){var R=v.audioTrack,I=v.videoTrack;R.samples&&R.segmentCodec==="aac"?T.decryptAacSamples(R.samples,0,function(){I.samples?T.decryptAvcSamples(I.samples,0,0,function(){S(v)}):S(v)}):I.samples&&T.decryptAvcSamples(I.samples,0,0,function(){S(v)})})},D.destroy=function(){this._duration=0},D.parseAVCPES=function(v,T,S,R){var I,w=this,J=this.parseAVCNALu(v,S.data),re=this.avcSample,ne=!1;S.data=null,re&&J.length&&!v.audFound&&(je(re,v),re=this.avcSample=Te(!1,S.pts,S.dts,"")),J.forEach(function(ge){switch(ge.type){case 1:I=!0,re||(re=w.avcSample=Te(!0,S.pts,S.dts,"")),re.frame=!0;var Ie=ge.data;if(ne&&Ie.length>4){var me=new de(Ie).readSliceType();me!==2&&me!==4&&me!==7&&me!==9||(re.key=!0)}break;case 5:I=!0,re||(re=w.avcSample=Te(!0,S.pts,S.dts,"")),re.key=!0,re.frame=!0;break;case 6:I=!0,(0,M.parseSEIMessageFromNALu)(ge.data,1,S.pts,T.samples);break;case 7:if(I=!0,ne=!0,!v.sps){var we=new de(ge.data).readSPS();v.width=we.width,v.height=we.height,v.pixelRatio=we.pixelRatio,v.sps=[ge.data],v.duration=w._duration;for(var Be=ge.data.subarray(1,4),Qe="avc1.",_e=0;_e<3;_e++){var rt=Be[_e].toString(16);rt.length<2&&(rt="0"+rt),Qe+=rt}v.codec=Qe}break;case 8:I=!0,v.pps||(v.pps=[ge.data]);break;case 9:I=!1,v.audFound=!0,re&&je(re,v),re=w.avcSample=Te(!1,S.pts,S.dts,"");break;case 12:I=!0;break;default:I=!1,re&&(re.debug+="unknown NAL "+ge.type+" ")}re&&I&&re.units.push(ge)}),R&&re&&(je(re,v),this.avcSample=null)},D.getLastNalUnit=function(v){var T,S,R=this.avcSample;if(R&&R.units.length!==0||(R=v[v.length-1]),(T=R)!==null&&T!==void 0&&T.units){var I=R.units;S=I[I.length-1]}return S},D.parseAVCNALu=function(v,T){var S,R,I=T.byteLength,w=v.naluState||0,J=w,re=[],ne=0,ge=-1,Ie=0;for(w===-1&&(ge=0,Ie=31&T[0],w=0,ne=1);ne<I;)if(S=T[ne++],w)if(w!==1)if(S)if(S===1){if(ge>=0){var me={data:T.subarray(ge,ne-w-1),type:Ie};re.push(me)}else{var we=this.getLastNalUnit(v.samples);if(we&&(J&&ne<=4-J&&we.state&&(we.data=we.data.subarray(0,we.data.byteLength-J)),(R=ne-w-1)>0)){var Be=new Uint8Array(we.data.byteLength+R);Be.set(we.data,0),Be.set(T.subarray(0,R),we.data.byteLength),we.data=Be,we.state=0}}ne<I?(ge=ne,Ie=31&T[ne],w=0):w=-1}else w=0;else w=3;else w=S?0:2;else w=S?0:1;if(ge>=0&&w>=0){var Qe={data:T.subarray(ge,I),type:Ie,state:w};re.push(Qe)}if(re.length===0){var _e=this.getLastNalUnit(v.samples);if(_e){var rt=new Uint8Array(_e.data.byteLength+T.byteLength);rt.set(_e.data,0),rt.set(T,_e.data.byteLength),_e.data=rt}}return v.naluState=w,re},D.parseAACPES=function(v,T){var S,R,I,w,J,re=0,ne=this.aacOverFlow,ge=T.data;if(ne){this.aacOverFlow=null;var Ie=ne.missing,me=ne.sample.unit.byteLength;if(Ie===-1){var we=new Uint8Array(me+ge.byteLength);we.set(ne.sample.unit,0),we.set(ge,me),ge=we}else{var Be=me-Ie;ne.sample.unit.set(ge.subarray(0,Ie),Be),v.samples.push(ne.sample),re=ne.missing}}for(S=re,R=ge.length;S<R-1&&!ue(ge,S);S++);if(S===re||(S<R-1?(I="AAC PES did not start with ADTS header,offset:"+S,w=!1):(I="no ADTS header found in AAC PES",w=!0),U.logger.warn("parsing error:"+I),this.observer.emit(oe.Events.ERROR,oe.Events.ERROR,{type:Q.ErrorTypes.MEDIA_ERROR,details:Q.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:I}),!w)){if(B(v,this.observer,ge,S,this.audioCodec),T.pts!==void 0)J=T.pts;else{if(!ne)return void U.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var Qe=y(v.samplerate);J=ne.sample.pts+Qe}for(var _e,rt=0;S<R;){if(S+=(_e=C(v,ge,S,J,rt)).length,_e.missing){this.aacOverFlow=_e;break}for(rt++;S<R-1&&!ue(ge,S);S++);}}},D.parseMPEGPES=function(v,T){var S=T.data,R=S.length,I=0,w=0,J=T.pts;if(J!==void 0)for(;w<R;)if(Z(S,w)){var re=Me(v,S,w,J,I);if(!re)break;w+=re.length,I++}else w++;else U.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},D.parseID3PES=function(v,T){if(T.pts!==void 0){var S=pe({},T,{type:this._avcTrack?k.MetadataSchema.emsg:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});v.samples.push(S)}else U.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},P}();function et(P,D){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,T){return v.__proto__=T,v},et(P,D)}const st=function(P){var D,v;function T(){return P.apply(this,arguments)||this}v=P,(D=T).prototype=Object.create(v.prototype),D.prototype.constructor=D,et(D,v);var S=T.prototype;return S.resetInitSegment=function(R,I,w,J){P.prototype.resetInitSegment.call(this,R,I,w,J),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:I,duration:J,inputTimeScale:9e4,dropped:0}},T.probe=function(R){if(!R)return!1;for(var I=(E.getID3Data(R,0)||[]).length,w=R.length;I<w;I++)if(H(R,I))return U.logger.log("MPEG Audio sync word found !"),!0;return!1},S.canParse=function(R,I){return function(w,J){return j(w,J)&&4<=w.length-J}(R,I)},S.appendFrame=function(R,I,w){if(this.basePTS!==null)return Me(R,I,w,this.basePTS,this.frameIndex)},T}(V);var tt=q(524),qe=q(923);function Xe(P,D){var v=P==null?void 0:P.codec;return v&&v.length>4?v:v==="hvc1"||v==="hev1"?"hvc1.1.c.L120.90":v==="av01"?"av01.0.04M.08":v==="avc1"||D===qe.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const ze=function(){function P(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var D=P.prototype;return D.destroy=function(){},D.resetTimeStamp=function(v){this.initPTS=v,this.lastEndTime=null},D.resetNextTimestamp=function(){this.lastEndTime=null},D.resetInitSegment=function(v,T,S,R){this.audioCodec=T,this.videoCodec=S,this.generateInitSegment((0,M.patchEncyptionData)(v,R)),this.emitInitSegment=!0},D.generateInitSegment=function(v){var T=this.audioCodec,S=this.videoCodec;if(!v||!v.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var R=this.initData=(0,M.parseInitSegment)(v);T||(T=Xe(R.audio,qe.ElementaryStreamTypes.AUDIO)),S||(S=Xe(R.video,qe.ElementaryStreamTypes.VIDEO));var I={};R.audio&&R.video?I.audiovideo={container:"video/mp4",codec:T+","+S,initSegment:v,id:"main"}:R.audio?I.audio={container:"audio/mp4",codec:T,initSegment:v,id:"audio"}:R.video?I.video={container:"video/mp4",codec:S,initSegment:v,id:"main"}:U.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=I},D.remux=function(v,T,S,R,I){var w,J=this.initPTS,re=this.lastEndTime,ne={audio:void 0,video:void 0,text:R,id3:S,initSegment:void 0};(0,c.isFiniteNumber)(re)||(re=this.lastEndTime=I||0);var ge=T.samples;if(!ge||!ge.length)return ne;var Ie={initPTS:void 0,timescale:1},me=this.initData;if(me&&me.length||(this.generateInitSegment(ge),me=this.initData),!me||!me.length)return U.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ne;this.emitInitSegment&&(Ie.tracks=this.initTracks,this.emitInitSegment=!1);var we=(0,M.getStartDTS)(me,ge);(0,c.isFiniteNumber)(J)||(this.initPTS=Ie.initPTS=J=we-I);var Be=(0,M.getDuration)(ge,me),Qe=v?we-J:re,_e=Qe+Be;(0,M.offsetStartDTS)(me,ge,J),Be>0?this.lastEndTime=_e:(U.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var rt=!!me.audio,pt=!!me.video,it="";rt&&(it+="audio"),pt&&(it+="video");var mt={data1:ge,startPTS:Qe,startDTS:Qe,endPTS:_e,endDTS:_e,type:it,hasAudio:rt,hasVideo:pt,nb:1,dropped:0};ne.audio=mt.type==="audio"?mt:void 0,ne.video=mt.type!=="audio"?mt:void 0,ne.initSegment=Ie;var dt=(w=this.initPTS)!=null?w:0;return ne.id3=(0,tt.flushTextTrackMetadataCueSamples)(S,I,dt,dt),R.samples.length&&(ne.text=(0,tt.flushTextTrackUserdataCueSamples)(R,I,dt)),ne},P}();var Ve;try{Ve=self.performance.now.bind(self.performance)}catch(P){U.logger.debug("Unable to use Performance API on this environment"),Ve=self.Date.now}var at=[{demux:ie,remux:ze},{demux:Je,remux:tt.default},{demux:W,remux:tt.default},{demux:st,remux:tt.default}],ct=function(){function P(v,T,S,R,I){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=v,this.typeSupported=T,this.config=S,this.vendor=R,this.id=I}var D=P.prototype;return D.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},D.push=function(v,T,S,R){var I=this,w=S.transmuxing;w.executeStart=Ve();var J=new Uint8Array(v),re=this.currentTransmuxState,ne=this.transmuxConfig;R&&(this.currentTransmuxState=R);var ge=R||re,Ie=ge.contiguous,me=ge.discontinuity,we=ge.trackSwitch,Be=ge.accurateTimeOffset,Qe=ge.timeOffset,_e=ge.initSegmentChange,rt=ne.audioCodec,pt=ne.videoCodec,it=ne.defaultInitPts,mt=ne.duration,dt=ne.initSegmentData,xe=function(Ht,xt){var lt=null;return Ht.byteLength>0&&xt!=null&&xt.key!=null&&xt.iv!==null&&xt.method!=null&&(lt=xt),lt}(J,T);if(xe&&xe.method==="AES-128"){var Lt=this.getDecrypter();if(!Lt.isSync())return this.decryptionPromise=Lt.webCryptoDecrypt(J,xe.key.buffer,xe.iv.buffer).then(function(Ht){var xt=I.push(Ht,null,S);return I.decryptionPromise=null,xt}),this.decryptionPromise;var It=Lt.softwareDecrypt(J,xe.key.buffer,xe.iv.buffer);if(S.part>-1&&(It=Lt.flush()),!It)return w.executeEnd=Ve(),gt(S);J=new Uint8Array(It)}var ot=this.needsProbing(me,we);ot&&this.configureTransmuxer(J),(me||we||_e||ot)&&this.resetInitSegment(dt,rt,pt,mt,T),(me||_e||ot)&&this.resetInitialTimestamp(it),Ie||this.resetContiguity();var yt=this.transmux(J,xe,Qe,Be,S),Ct=this.currentTransmuxState;return Ct.contiguous=!0,Ct.discontinuity=!1,Ct.trackSwitch=!1,w.executeEnd=Ve(),yt},D.flush=function(v){var T=this,S=v.transmuxing;S.executeStart=Ve();var R=this.decrypter,I=this.currentTransmuxState,w=this.decryptionPromise;if(w)return w.then(function(){return T.flush(v)});var J=[],re=I.timeOffset;if(R){var ne=R.flush();ne&&J.push(this.push(ne,null,v))}var ge=this.demuxer,Ie=this.remuxer;if(!ge||!Ie)return this.observer.emit(oe.Events.ERROR,oe.Events.ERROR,{type:Q.ErrorTypes.MEDIA_ERROR,details:Q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),S.executeEnd=Ve(),[gt(v)];var me=ge.flush(re);return St(me)?me.then(function(we){return T.flushRemux(J,we,v),J}):(this.flushRemux(J,me,v),J)},D.flushRemux=function(v,T,S){var R=T.audioTrack,I=T.videoTrack,w=T.id3Track,J=T.textTrack,re=this.currentTransmuxState,ne=re.accurateTimeOffset,ge=re.timeOffset;U.logger.log("[transmuxer.ts]: Flushed fragment "+S.sn+(S.part>-1?" p: "+S.part:"")+" of level "+S.level);var Ie=this.remuxer.remux(R,I,w,J,ge,ne,!0,this.id);v.push({remuxResult:Ie,chunkMeta:S}),S.transmuxing.executeEnd=Ve()},D.resetInitialTimestamp=function(v){var T=this.demuxer,S=this.remuxer;T&&S&&(T.resetTimeStamp(v),S.resetTimeStamp(v))},D.resetContiguity=function(){var v=this.demuxer,T=this.remuxer;v&&T&&(v.resetContiguity(),T.resetNextTimestamp())},D.resetInitSegment=function(v,T,S,R,I){var w=this.demuxer,J=this.remuxer;w&&J&&(w.resetInitSegment(v,T,S,R),J.resetInitSegment(v,T,S,I))},D.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},D.transmux=function(v,T,S,R,I){return T&&T.method==="SAMPLE-AES"?this.transmuxSampleAes(v,T,S,R,I):this.transmuxUnencrypted(v,S,R,I)},D.transmuxUnencrypted=function(v,T,S,R){var I=this.demuxer.demux(v,T,!1,!this.config.progressive),w=I.audioTrack,J=I.videoTrack,re=I.id3Track,ne=I.textTrack;return{remuxResult:this.remuxer.remux(w,J,re,ne,T,S,!1,this.id),chunkMeta:R}},D.transmuxSampleAes=function(v,T,S,R,I){var w=this;return this.demuxer.demuxSampleAes(v,T,S).then(function(J){return{remuxResult:w.remuxer.remux(J.audioTrack,J.videoTrack,J.id3Track,J.textTrack,S,R,!1,w.id),chunkMeta:I}})},D.configureTransmuxer=function(v){for(var T,S=this.config,R=this.observer,I=this.typeSupported,w=this.vendor,J=0,re=at.length;J<re;J++)if(at[J].demux.probe(v)){T=at[J];break}T||(U.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),T={demux:ie,remux:ze});var ne=this.demuxer,ge=this.remuxer,Ie=T.remux,me=T.demux;ge&&ge instanceof Ie||(this.remuxer=new Ie(R,S,I,w)),ne&&ne instanceof me||(this.demuxer=new me(R,S,I),this.probe=me.probe)},D.needsProbing=function(v,T){return!this.demuxer||!this.remuxer||v||T},D.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new F.default(this.config)),v},P}(),gt=function(P){return{remuxResult:{},chunkMeta:P}};function St(P){return"then"in P&&P.then instanceof Function}var Et=function(P,D,v,T,S){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=P,this.videoCodec=D,this.initSegmentData=v,this.duration=T,this.defaultInitPts=S},vt=function(P,D,v,T,S,R){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=P,this.contiguous=D,this.accurateTimeOffset=v,this.trackSwitch=T,this.timeOffset=S,this.initSegmentChange=R}},973:(Ke,ke,q)=>{"use strict";var oe,Q;q.r(ke),q.d(ke,{ErrorDetails:()=>Q,ErrorTypes:()=>oe}),function(F){F.NETWORK_ERROR="networkError",F.MEDIA_ERROR="mediaError",F.KEY_SYSTEM_ERROR="keySystemError",F.MUX_ERROR="muxError",F.OTHER_ERROR="otherError"}(oe||(oe={})),function(F){F.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",F.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",F.KEY_SYSTEM_NO_SESSION="keySystemNoSession",F.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",F.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",F.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",F.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",F.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",F.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",F.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",F.MANIFEST_LOAD_ERROR="manifestLoadError",F.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",F.MANIFEST_PARSING_ERROR="manifestParsingError",F.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",F.LEVEL_EMPTY_ERROR="levelEmptyError",F.LEVEL_LOAD_ERROR="levelLoadError",F.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",F.LEVEL_SWITCH_ERROR="levelSwitchError",F.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",F.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",F.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",F.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",F.FRAG_LOAD_ERROR="fragLoadError",F.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",F.FRAG_DECRYPT_ERROR="fragDecryptError",F.FRAG_PARSING_ERROR="fragParsingError",F.REMUX_ALLOC_ERROR="remuxAllocError",F.KEY_LOAD_ERROR="keyLoadError",F.KEY_LOAD_TIMEOUT="keyLoadTimeOut",F.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",F.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",F.BUFFER_APPEND_ERROR="bufferAppendError",F.BUFFER_APPENDING_ERROR="bufferAppendingError",F.BUFFER_STALLED_ERROR="bufferStalledError",F.BUFFER_FULL_ERROR="bufferFullError",F.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",F.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",F.INTERNAL_EXCEPTION="internalException",F.INTERNAL_ABORTED="aborted",F.UNKNOWN="unknown"}(Q||(Q={}))},851:(Ke,ke,q)=>{"use strict";var oe;q.r(ke),q.d(ke,{Events:()=>oe}),function(Q){Q.MEDIA_ATTACHING="hlsMediaAttaching",Q.MEDIA_ATTACHED="hlsMediaAttached",Q.MEDIA_DETACHING="hlsMediaDetaching",Q.MEDIA_DETACHED="hlsMediaDetached",Q.BUFFER_RESET="hlsBufferReset",Q.BUFFER_CODECS="hlsBufferCodecs",Q.BUFFER_CREATED="hlsBufferCreated",Q.BUFFER_APPENDING="hlsBufferAppending",Q.BUFFER_APPENDED="hlsBufferAppended",Q.BUFFER_EOS="hlsBufferEos",Q.BUFFER_FLUSHING="hlsBufferFlushing",Q.BUFFER_FLUSHED="hlsBufferFlushed",Q.MANIFEST_LOADING="hlsManifestLoading",Q.MANIFEST_LOADED="hlsManifestLoaded",Q.MANIFEST_PARSED="hlsManifestParsed",Q.LEVEL_SWITCHING="hlsLevelSwitching",Q.LEVEL_SWITCHED="hlsLevelSwitched",Q.LEVEL_LOADING="hlsLevelLoading",Q.LEVEL_LOADED="hlsLevelLoaded",Q.LEVEL_UPDATED="hlsLevelUpdated",Q.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",Q.LEVELS_UPDATED="hlsLevelsUpdated",Q.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",Q.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",Q.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",Q.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",Q.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",Q.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",Q.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",Q.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",Q.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",Q.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",Q.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",Q.CUES_PARSED="hlsCuesParsed",Q.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",Q.INIT_PTS_FOUND="hlsInitPtsFound",Q.FRAG_LOADING="hlsFragLoading",Q.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",Q.FRAG_LOADED="hlsFragLoaded",Q.FRAG_DECRYPTED="hlsFragDecrypted",Q.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",Q.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",Q.FRAG_PARSING_METADATA="hlsFragParsingMetadata",Q.FRAG_PARSED="hlsFragParsed",Q.FRAG_BUFFERED="hlsFragBuffered",Q.FRAG_CHANGED="hlsFragChanged",Q.FPS_DROP="hlsFpsDrop",Q.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",Q.ERROR="hlsError",Q.DESTROYING="hlsDestroying",Q.KEY_LOADING="hlsKeyLoading",Q.KEY_LOADED="hlsKeyLoaded",Q.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",Q.BACK_BUFFER_REACHED="hlsBackBufferReached"}(oe||(oe={}))},76:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{default:()=>ji});var oe,Q=q(945),F=q(965),c=q(851),E=q(973),k=q(93),ce=/^(\d+)x(\d+)$/,M=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,X=function(){function h(e){for(var t in typeof e=="string"&&(e=h.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var o=h.prototype;return o.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},o.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},o.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},o.decimalFloatingPoint=function(e){return parseFloat(this[e])},o.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},o.enumeratedString=function(e){return this[e]},o.bool=function(e){return this[e]==="YES"},o.decimalResolution=function(e){var t=ce.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},h.parseAttrList=function(e){var t,i={};for(M.lastIndex=0;(t=M.exec(e))!==null;){var n=t[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},h}();function $(){return $=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},$.apply(this,arguments)}function O(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}(function(h){h.ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN"})(oe||(oe={}));var V=function(){function h(t,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var a in n)if(Object.prototype.hasOwnProperty.call(t,a)&&t[a]!==n[a]){k.logger.warn('DATERANGE tag attribute: "'+a+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=a;break}t=$(new X({}),n,t)}if(this.attr=t,this._startDate=new Date(t[oe.START_DATE]),oe.END_DATE in this.attr){var r=new Date(this.attr[oe.END_DATE]);(0,F.isFiniteNumber)(r.getTime())&&(this._endDate=r)}}var o,e;return o=h,(e=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return t!==null?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(oe.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(oe.DURATION);if((0,F.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return oe.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(oe.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(oe.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,F.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&O(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),h}(),U=q(923);function G(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}var N,le,ue,Re=function(){function h(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}var o,e;return h.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},o=h,(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,F.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!==null&&t!==void 0&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&G(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),h}();function B(h){return Uint8Array.from(atob(h),function(o){return o.charCodeAt(0)})}function y(h){return Uint8Array.from(unescape(encodeURIComponent(h)),function(o){return o.charCodeAt(0)})}function C(h){switch(h){case le.FAIRPLAY:return N.FAIRPLAY;case le.PLAYREADY:return N.PLAYREADY;case le.WIDEVINE:return N.WIDEVINE;case le.CLEARKEY:return N.CLEARKEY}}function b(h){switch(h){case N.FAIRPLAY:return le.FAIRPLAY;case N.PLAYREADY:return le.PLAYREADY;case N.WIDEVINE:return le.WIDEVINE;case N.CLEARKEY:return le.CLEARKEY}}function W(h){var o=h.drmSystems,e=h.widevineLicenseUrl,t=o?[N.FAIRPLAY,N.WIDEVINE,N.PLAYREADY,N.CLEARKEY].filter(function(i){return!!o[i]}):[];return!t[N.WIDEVINE]&&e&&t.push(N.WIDEVINE),t}(function(h){h.CLEARKEY="org.w3.clearkey",h.FAIRPLAY="com.apple.fps",h.PLAYREADY="com.microsoft.playready",h.WIDEVINE="com.widevine.alpha"})(N||(N={})),function(h){h.CLEARKEY="org.w3.clearkey",h.FAIRPLAY="com.apple.streamingkeydelivery",h.PLAYREADY="com.microsoft.playready",h.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(le||(le={})),function(h){h.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"}(ue||(ue={}));var se=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null,ie=q(63),te={},be=function(){function h(e,t,i,n,a){n===void 0&&(n=[1]),a===void 0&&(a=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=n,this.iv=a,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&e!=="AES-128"}h.clearKeyUriToKeyIdMap=function(){te={}};var o=h.prototype;return o.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case le.FAIRPLAY:case le.WIDEVINE:case le.PLAYREADY:case le.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},o.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method!=="AES-128"||this.iv||k.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(A){for(var L=new Uint8Array(16),_=12;_<16;_++)L[_]=A>>8*(15-_)&255;return L}(e);return new h(this.method,this.uri,"identity",this.keyFormatVersions,t)}var i=function(A){var L,_,K=A.split(":"),z=null;if(K[0]==="data"&&K.length===2){var Y=K[1].split(";"),ee=Y[Y.length-1].split(",");if(ee.length===2){var Ee=ee[0]==="base64",Se=ee[1];Ee?(Y.splice(-1,1),z=B(Se)):(L=y(Se).subarray(0,16),(_=new Uint8Array(16)).set(L,16-L.length),z=_)}}return z}(this.uri);if(i)switch(this.keyFormat){case le.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case le.PLAYREADY:var n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,ie.mp4pssh)(n,null,i);var a=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),r=String.fromCharCode.apply(null,Array.from(a)),s=r.substring(r.indexOf("<"),r.length),l=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){var u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){var d=B(u).subarray(0,16);(function(A){var L=function(_,K,z){var Y=_[K];_[K]=_[z],_[z]=Y};L(A,0,3),L(A,1,2),L(A,4,5),L(A,6,7)})(d),this.keyId=d}}break;default:var f=i.subarray(0,16);if(f.length!==16){var g=new Uint8Array(16);g.set(f,16-f.length),f=g}this.keyId=f}if(!this.keyId||this.keyId.byteLength!==16){var p=te[this.uri];if(!p){var m=Object.keys(te).length%Number.MAX_SAFE_INTEGER;p=new Uint8Array(16),new DataView(p.buffer,12,4).setUint32(0,m),te[this.uri]=p}this.keyId=p}return this},h}(),Ae={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function De(h,o){return MediaSource.isTypeSupported((o||"video")+'/mp4;codecs="'+h+'"')}function Le(){return Le=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Le.apply(this,arguments)}var Me=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,Ze=/#EXT-X-MEDIA:(.*)/g,j=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Z=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),H=function(){function h(){}return h.findGroup=function(o,e){for(var t=0;t<o.length;t++){var i=o[t];if(i.id===e)return i}},h.convertAVC1ToAVCOTI=function(o){var e=o.split(".");if(e.length>2){var t=e.shift()+".";return(t+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return o},h.resolve=function(o,e){return(0,Q.buildAbsoluteURL)(e,o,{alwaysNormalize:!0})},h.parseMasterPlaylist=function(o,e){var t,i=[],n=[],a={},r=[],s=!1;for(Me.lastIndex=0;(t=Me.exec(o))!=null;)if(t[1]){var l,u=new X(t[1]),d={attrs:u,bitrate:u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),name:u.NAME,url:h.resolve(t[2],e)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),he((u.CODECS||"").split(/[ ,]+/).filter(function(A){return A}),d),d.videoCodec&&d.videoCodec.indexOf("avc1")!==-1&&(d.videoCodec=h.convertAVC1ToAVCOTI(d.videoCodec)),(l=d.unknownCodecs)!==null&&l!==void 0&&l.length||n.push(d),i.push(d)}else if(t[3]){var g=new X(t[3]);g["DATA-ID"]&&(s=!0,a[g["DATA-ID"]]=g)}else if(t[4]){var p=t[4],m=de(p,e);m.encrypted&&m.isSupported()?r.push(m):k.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+p+'"')}return{levels:n.length>0&&n.length<i.length?n:i,sessionData:s?a:null,sessionKeys:r.length?r:null}},h.parseMasterPlaylistMedia=function(o,e,t,i){var n;i===void 0&&(i=[]);var a=[],r=0;for(Ze.lastIndex=0;(n=Ze.exec(o))!==null;){var s=new X(n[1]);if(s.TYPE===t){var l={attrs:s,bitrate:0,id:r++,groupId:s["GROUP-ID"],instreamId:s["INSTREAM-ID"],name:s.NAME||s.LANGUAGE||"",type:t,default:s.bool("DEFAULT"),autoselect:s.bool("AUTOSELECT"),forced:s.bool("FORCED"),lang:s.LANGUAGE,url:s.URI?h.resolve(s.URI,e):""};if(i.length){var u=h.findGroup(i,l.groupId)||i[0];pe(l,u,"audioCodec"),pe(l,u,"textCodec")}a.push(l)}}return a},h.parseLevelPlaylist=function(o,e,t,i,n){var a,r,s,l=new Re(e),u=l.fragments,d=null,f=0,g=0,p=0,m=0,A=null,L=new U.Fragment(i,e),_=-1,K=!1;for(j.lastIndex=0,l.m3u8=o;(a=j.exec(o))!==null;){K&&(K=!1,(L=new U.Fragment(i,e)).start=p,L.sn=f,L.cc=m,L.level=t,d&&(L.initSegment=d,L.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var z=a[1];if(z){L.duration=parseFloat(z);var Y=(" "+a[2]).slice(1);L.title=Y||null,L.tagList.push(Y?["INF",z,Y]:["INF",z])}else if(a[3])(0,F.isFiniteNumber)(L.duration)&&(L.start=p,s&&Ce(L,s,l),L.sn=f,L.level=t,L.cc=m,L.urlId=n,u.push(L),L.relurl=(" "+a[3]).slice(1),ve(L,A),A=L,p+=L.duration,f++,g=0,K=!0);else if(a[4]){var ee=(" "+a[4]).slice(1);A?L.setByteRange(ee,A):L.setByteRange(ee)}else if(a[5])L.rawProgramDateTime=(" "+a[5]).slice(1),L.tagList.push(["PROGRAM-DATE-TIME",L.rawProgramDateTime]),_===-1&&(_=u.length);else{if(!(a=a[0].match(Z))){k.logger.warn("No matches on slow regex match for level playlist!");continue}for(r=1;r<a.length&&a[r]===void 0;r++);var Ee=(" "+a[r]).slice(1),Se=(" "+a[r+1]).slice(1),ae=a[r+2]?(" "+a[r+2]).slice(1):"";switch(Ee){case"PLAYLIST-TYPE":l.type=Se.toUpperCase();break;case"MEDIA-SEQUENCE":f=l.startSN=parseInt(Se);break;case"SKIP":var ye=new X(Se),fe=ye.decimalInteger("SKIPPED-SEGMENTS");if((0,F.isFiniteNumber)(fe)){l.skippedSegments=fe;for(var Ge=fe;Ge--;)u.unshift(null);f+=fe}var nt=ye.enumeratedString("RECENTLY-REMOVED-DATERANGES");nt&&(l.recentlyRemovedDateranges=nt.split("	"));break;case"TARGETDURATION":l.targetduration=parseFloat(Se);break;case"VERSION":l.version=parseInt(Se);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(Se||ae)&&L.tagList.push(ae?[Se,ae]:[Se]);break;case"DISCONTINUITY":m++,L.tagList.push(["DIS"]);break;case"GAP":L.tagList.push([Ee]);break;case"BITRATE":L.tagList.push([Ee,Se]);break;case"DATERANGE":var Ue=new X(Se),He=new V(Ue,l.dateRanges[Ue.ID]);He.isValid||l.skippedSegments?l.dateRanges[He.id]=He:k.logger.warn('Ignoring invalid DATERANGE tag: "'+Se+'"'),L.tagList.push(["EXT-X-DATERANGE",Se]);break;case"DISCONTINUITY-SEQUENCE":m=parseInt(Se);break;case"KEY":var $e=de(Se,e);if($e.isSupported()){if($e.method==="NONE"){s=void 0;break}s||(s={}),s[$e.keyFormat]&&(s=Le({},s)),s[$e.keyFormat]=$e}else k.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Se+'"');break;case"START":var Tt=new X(Se).decimalFloatingPoint("TIME-OFFSET");(0,F.isFiniteNumber)(Tt)&&(l.startTimeOffset=Tt);break;case"MAP":var ft=new X(Se);if(L.duration){var ut=new U.Fragment(i,e);Te(ut,ft,t,s),d=ut,L.initSegment=d,d.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=d.rawProgramDateTime)}else Te(L,ft,t,s),d=L,K=!0;break;case"SERVER-CONTROL":var ht=new X(Se);l.canBlockReload=ht.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=ht.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&ht.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=ht.optionalFloat("PART-HOLD-BACK",0),l.holdBack=ht.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Nt=new X(Se);l.partTarget=Nt.decimalFloatingPoint("PART-TARGET");break;case"PART":var qt=l.partList;qt||(qt=l.partList=[]);var Zt=g>0?qt[qt.length-1]:void 0,or=g++,Jt=new U.Part(new X(Se),L,e,or,Zt);qt.push(Jt),L.duration+=Jt.duration;break;case"PRELOAD-HINT":var pr=new X(Se);l.preloadHint=pr;break;case"RENDITION-REPORT":var Fe=new X(Se);l.renditionReports=l.renditionReports||[],l.renditionReports.push(Fe);break;default:k.logger.warn("line parsed but not handled: "+a)}}}A&&!A.relurl?(u.pop(),p-=A.duration,l.partList&&(l.fragmentHint=A)):l.partList&&(ve(L,A),L.cc=m,l.fragmentHint=L,s&&Ce(L,s,l));var Ne=u.length,lr=u[0],wt=u[Ne-1];if((p+=l.skippedSegments*l.targetduration)>0&&Ne&&wt){l.averagetargetduration=p/Ne;var Ut=wt.sn;l.endSN=Ut!=="initSegment"?Ut:0,l.live||(wt.endList=!0),lr&&(l.startCC=lr.cc)}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(p+=l.fragmentHint.duration),l.totalduration=p,l.endCC=m,_>0&&function(er,Bt){for(var Gt=er[Bt],Kt=Bt;Kt--;){var Dt=er[Kt];if(!Dt)return;Dt.programDateTime=Gt.programDateTime-1e3*Dt.duration,Gt=Dt}}(u,_),l},h}();function de(h,o){var e,t,i=new X(h),n=(e=i.enumeratedString("METHOD"))!=null?e:"",a=i.URI,r=i.hexadecimalInteger("IV"),s=i.enumeratedString("KEYFORMATVERSIONS"),l=(t=i.enumeratedString("KEYFORMAT"))!=null?t:"identity";a&&i.IV&&!r&&k.logger.error("Invalid IV: "+i.IV);var u=a?H.resolve(a,o):"",d=(s||"1").split("/").map(Number).filter(Number.isFinite);return new be(n,u,l,d,r)}function he(h,o){["video","audio","text"].forEach(function(e){var t=h.filter(function(n){return function(a,r){var s=Ae[r];return!!s&&s[a.slice(0,4)]===!0}(n,e)});if(t.length){var i=t.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});o[e+"Codec"]=i.length>0?i[0]:t[0],h=h.filter(function(n){return t.indexOf(n)===-1})}}),o.unknownCodecs=h}function pe(h,o,e){var t=o[e];t&&(h[e]=t)}function ve(h,o){h.rawProgramDateTime?h.programDateTime=Date.parse(h.rawProgramDateTime):o!=null&&o.programDateTime&&(h.programDateTime=o.endProgramDateTime),(0,F.isFiniteNumber)(h.programDateTime)||(h.programDateTime=null,h.rawProgramDateTime=null)}function Te(h,o,e,t){h.relurl=o.URI,o.BYTERANGE&&h.setByteRange(o.BYTERANGE),h.level=e,h.sn="initSegment",t&&(h.levelkeys=t),h.initSegment=null}function Ce(h,o,e){h.levelkeys=o;var t=e.encryptedFragments;t.length&&t[t.length-1].levelkeys===o||!Object.keys(o).some(function(i){return o[i].isCommonEncryption})||t.push(h)}var x=q(308);function Oe(h,o){var e=h.url;return e!==void 0&&e.indexOf("data:")!==0||(e=o.url),e}const Pe=function(){function h(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var o=h.prototype;return o.startLoad=function(e){},o.stopLoad=function(){this.destroyInternalLoaders()},o.registerListeners=function(){var e=this.hls;e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},o.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},o.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,a=new(i||n)(t);return e.loader=a,this.loaders[e.type]=a,a},o.getInternalLoader=function(e){return this.loaders[e.type]},o.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},o.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},o.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},o.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:x.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},o.onLevelLoading=function(e,t){var i=t.id,n=t.level,a=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:x.PlaylistContextType.LEVEL,url:a,deliveryDirectives:r})},o.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,a=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:x.PlaylistContextType.AUDIO_TRACK,url:a,deliveryDirectives:r})},o.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,a=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:x.PlaylistContextType.SUBTITLE_TRACK,url:a,deliveryDirectives:r})},o.load=function(e){var t,i,n,a,r,s,l=this.hls.config,u=this.getInternalLoader(e);if(u){var d=u.context;if(d&&d.url===e.url)return void k.logger.trace("[playlist-loader]: playlist request ongoing");k.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),u.abort()}switch(e.type){case x.PlaylistContextType.MANIFEST:i=l.manifestLoadingMaxRetry,n=l.manifestLoadingTimeOut,a=l.manifestLoadingRetryDelay,r=l.manifestLoadingMaxRetryTimeout;break;case x.PlaylistContextType.LEVEL:case x.PlaylistContextType.AUDIO_TRACK:case x.PlaylistContextType.SUBTITLE_TRACK:i=0,n=l.levelLoadingTimeOut;break;default:i=l.levelLoadingMaxRetry,n=l.levelLoadingTimeOut,a=l.levelLoadingRetryDelay,r=l.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part&&(e.type===x.PlaylistContextType.LEVEL&&e.level!==null?s=this.hls.levels[e.level].details:e.type===x.PlaylistContextType.AUDIO_TRACK&&e.id!==null?s=this.hls.audioTracks[e.id].details:e.type===x.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(s=this.hls.subtitleTracks[e.id].details),s)){var f=s.partTarget,g=s.targetduration;f&&g&&(n=Math.min(1e3*Math.max(3*f,.8*g),n))}var p={timeout:n,maxRetry:i,retryDelay:a,maxRetryDelay:r,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(e,p,m)},o.loadsuccess=function(e,t,i,n){n===void 0&&(n=null),this.resetInternalLoader(i.type);var a=e.data;a.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,n):this.handleMasterPlaylist(e,t,i,n)):this.handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},o.loaderror=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,e)},o.loadtimeout=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},o.handleMasterPlaylist=function(e,t,i,n){var a=this.hls,r=e.data,s=Oe(e,i),l=H.parseMasterPlaylist(r,s),u=l.levels,d=l.sessionData,f=l.sessionKeys;if(u.length){var g=u.map(function(_){return{id:_.attrs.AUDIO,audioCodec:_.audioCodec}}),p=u.map(function(_){return{id:_.attrs.SUBTITLES,textCodec:_.textCodec}}),m=H.parseMasterPlaylistMedia(r,s,"AUDIO",g),A=H.parseMasterPlaylistMedia(r,s,"SUBTITLES",p),L=H.parseMasterPlaylistMedia(r,s,"CLOSED-CAPTIONS");m.length&&(m.some(function(_){return!_.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(k.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new X({}),bitrate:0,url:""}))),a.trigger(c.Events.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:A,captions:L,url:s,stats:t,networkDetails:n,sessionData:d,sessionKeys:f})}else this.handleManifestParsingError(e,i,"no level found in manifest",n)},o.handleTrackOrLevelPlaylist=function(e,t,i,n){var a=this.hls,r=i.id,s=i.level,l=i.type,u=Oe(e,i),d=(0,F.isFiniteNumber)(r)?r:0,f=(0,F.isFiniteNumber)(s)?s:d,g=function(A){switch(A.type){case x.PlaylistContextType.AUDIO_TRACK:return x.PlaylistLevelType.AUDIO;case x.PlaylistContextType.SUBTITLE_TRACK:return x.PlaylistLevelType.SUBTITLE;default:return x.PlaylistLevelType.MAIN}}(i),p=H.parseLevelPlaylist(e.data,u,f,g,d);if(p.fragments.length){if(l===x.PlaylistContextType.MANIFEST){var m={attrs:new X({}),bitrate:0,details:p,name:"",url:u};a.trigger(c.Events.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null})}t.parsing.end=performance.now(),i.levelDetails=p,this.handlePlaylistLoaded(e,t,i,n)}else a.trigger(c.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},o.handleManifestParsingError=function(e,t,i,n){this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===x.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:n})},o.handleNetworkError=function(e,t,i,n){i===void 0&&(i=!1),k.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var a=E.ErrorDetails.UNKNOWN,r=!1,s=this.getInternalLoader(e);switch(e.type){case x.PlaylistContextType.MANIFEST:a=i?E.ErrorDetails.MANIFEST_LOAD_TIMEOUT:E.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case x.PlaylistContextType.LEVEL:a=i?E.ErrorDetails.LEVEL_LOAD_TIMEOUT:E.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case x.PlaylistContextType.AUDIO_TRACK:a=i?E.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case x.PlaylistContextType.SUBTITLE_TRACK:a=i?E.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:E.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1}s&&this.resetInternalLoader(e.type);var l={type:E.ErrorTypes.NETWORK_ERROR,details:a,fatal:r,url:e.url,loader:s,context:e,networkDetails:t};n&&(l.response=n),this.hls.trigger(c.Events.ERROR,l)},o.handlePlaylistLoaded=function(e,t,i,n){var a=i.type,r=i.level,s=i.id,l=i.groupId,u=i.loader,d=i.levelDetails,f=i.deliveryDirectives;if(d!=null&&d.targetduration){if(u)switch(d.live&&(u.getCacheAge&&(d.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),a){case x.PlaylistContextType.MANIFEST:case x.PlaylistContextType.LEVEL:this.hls.trigger(c.Events.LEVEL_LOADED,{details:d,level:r||0,id:s||0,stats:t,networkDetails:n,deliveryDirectives:f});break;case x.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,{details:d,id:s||0,groupId:l||"",stats:t,networkDetails:n,deliveryDirectives:f});break;case x.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADED,{details:d,id:s||0,groupId:l||"",stats:t,networkDetails:n,deliveryDirectives:f})}}else this.handleManifestParsingError(e,i,"invalid target duration",n)},h}();function je(h,o){var e;try{e=new Event("addtrack")}catch(t){(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=h,o.dispatchEvent(e)}function Je(h,o){var e=h.mode;if(e==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(o.id))try{if(h.addCue(o),!h.cues.getCueById(o.id))throw new Error("addCue is failed for: "+o)}catch(i){k.logger.debug("[texttrack-utils]: "+i);var t=new self.TextTrackCue(o.startTime,o.endTime,o.text);t.id=o.id,h.addCue(t)}e==="disabled"&&(h.mode=e)}function et(h){var o=h.mode;if(o==="disabled"&&(h.mode="hidden"),h.cues)for(var e=h.cues.length;e--;)h.removeCue(h.cues[e]);o==="disabled"&&(h.mode=o)}function st(h,o,e,t){var i=h.mode;if(i==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0)for(var n=function(r,s,l){var u=[],d=function(m,A){if(A<m[0].startTime)return 0;var L=m.length-1;if(A>m[L].endTime)return-1;for(var _=0,K=L;_<=K;){var z=Math.floor((K+_)/2);if(A<m[z].startTime)K=z-1;else{if(!(A>m[z].startTime&&_<L))return z;_=z+1}}return m[_].startTime-A<A-m[K].startTime?_:K}(r,s);if(d>-1)for(var f=d,g=r.length;f<g;f++){var p=r[f];if(p.startTime>=s&&p.endTime<=l)u.push(p);else if(p.startTime>l)return u}return u}(h.cues,o,e),a=0;a<n.length;a++)t&&!t(n[a])||h.removeCue(n[a]);i==="disabled"&&(h.mode=i)}var tt=q(181),qe=q(856);function Xe(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var ze=function(){var h=Xe();try{new h(0,Number.POSITIVE_INFINITY,"")}catch(o){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Ve(h,o){return h.getTime()/1e3-o}const at=function(){function h(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var o=h.prototype;return o.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},o._registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},o._unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},o.onMediaAttached=function(e,t){this.media=t.media},o.onMediaDetaching=function(){this.id3Track&&(et(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},o.onManifestLoading=function(){this.dateRangeCuesAppended={}},o.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},o.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if(i.kind==="metadata"&&i.label==="id3")return je(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},o.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,a=i.enableID3MetadataCues;if(n||a){var r=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=Xe(),l=0;l<r.length;l++){var u=r[l].type;if((u!==qe.MetadataSchema.emsg||n)&&a){var d=tt.getID3Frames(r[l].data);if(d){var f=r[l].pts,g=f+r[l].duration;g>ze&&(g=ze),g-f<=0&&(g=f+.25);for(var p=0;p<d.length;p++){var m=d[p];if(!tt.isTimeStampFrame(m)){this.updateId3CueEnds(f);var A=new s(f,g,"");A.value=m,u&&(A.type=u),this.id3Track.addCue(A)}}}}}}}},o.updateId3CueEnds=function(e){var t,i=(t=this.id3Track)===null||t===void 0?void 0:t.cues;if(i)for(var n=i.length;n--;){var a=i[n];a.startTime<e&&a.endTime===ze&&(a.endTime=e)}},o.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,a=t.type,r=this.id3Track,s=this.hls;if(s){var l=s.config,u=l.enableEmsgMetadataCues,d=l.enableID3MetadataCues;r&&(u||d)&&st(r,i,n,a==="audio"?function(f){return f.type===qe.MetadataSchema.audioId3&&d}:a==="video"?function(f){return f.type===qe.MetadataSchema.emsg&&u}:function(f){return f.type===qe.MetadataSchema.audioId3&&d||f.type===qe.MetadataSchema.emsg&&u})}},o.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,r=this.id3Track,s=n.dateRanges,l=Object.keys(s);if(r)for(var u=Object.keys(a).filter(function(_){return!l.includes(_)}),d=function(_){var K=u[_];Object.keys(a[K].cues).forEach(function(z){r.removeCue(a[K].cues[z])}),delete a[K]},f=u.length;f--;)d(f);var g=n.fragments[n.fragments.length-1];if(l.length!==0&&(0,F.isFiniteNumber)(g==null?void 0:g.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var p=g.programDateTime/1e3-g.start,m=Xe(),A=function(_){var K=l[_],z=s[K],Y=a[K],ee=(Y==null?void 0:Y.cues)||{},Ee=(Y==null?void 0:Y.durationKnown)||!1,Se=Ve(z.startDate,p),ae=ze,ye=z.endDate;if(ye)ae=Ve(ye,p),Ee=!0;else if(z.endOnNext&&!Ee){var fe=l.reduce(function(ft,ut){var ht=s[ut];return ht.class===z.class&&ht.id!==ut&&ht.startDate>z.startDate&&ft.push(ht),ft},[]).sort(function(ft,ut){return ft.startDate.getTime()-ut.startDate.getTime()})[0];fe&&(ae=Ve(fe.startDate,p),Ee=!0)}for(var Ge,nt=Object.keys(z.attr),Ue=0;Ue<nt.length;Ue++){var He=nt[Ue];if(He!==oe.ID&&He!==oe.CLASS&&He!==oe.START_DATE&&He!==oe.DURATION&&He!==oe.END_DATE&&He!==oe.END_ON_NEXT){var $e=ee[He];if($e)Ee&&!Y.durationKnown&&($e.endTime=ae);else{var Tt=z.attr[He];$e=new m(Se,ae,""),He!==oe.SCTE35_OUT&&He!==oe.SCTE35_IN||(Ge=Tt,Tt=Uint8Array.from(Ge.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),$e.value={key:He,data:Tt},$e.type=qe.MetadataSchema.dateRange,i.id3Track.addCue($e),ee[He]=$e}}}a[K]={cues:ee,dateRange:z,durationKnown:Ee}},L=0;L<l.length;L++)A(L)}}},h}();function ct(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}var gt=function(){function h(i){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=i,this.config=i.config,this.registerListeners()}var o,e,t=h.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.Events.ERROR,this.onError)},t.onMediaAttached=function(i,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(i,n){var a=n.details;this.levelDetails=a,a.advanced&&this.timeupdate(),!a.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(i,n){n.details===E.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,k.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var i=this.media,n=this.levelDetails;if(i&&n){this.currentTime=i.currentTime;var a=this.computeLatency();if(a!==null){this._latency=a;var r=this.config,s=r.lowLatencyMode,l=r.maxLiveSyncPlaybackRate;if(s&&l!==1){var u=this.targetLatency;if(u!==null){var d=a-u,f=d<Math.min(this.maxLatency,u+n.targetduration);if(n.live&&f&&d>.05&&this.forwardBufferLength>1){var g=Math.min(2,Math.max(1,l)),p=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20;i.playbackRate=Math.min(g,Math.max(1,p))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var i=this.levelDetails;return i===null?null:i.edge+i.age},t.computeLatency=function(){var i=this.estimateLiveEdge();return i===null?null:i-this.currentTime},o=h,(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var i=this.config,n=this.levelDetails;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:n?i.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var i=this.levelDetails;if(i===null)return null;var n=i.holdBack,a=i.partHoldBack,r=i.targetduration,s=this.config,l=s.liveSyncDuration,u=s.liveSyncDurationCount,d=s.lowLatencyMode,f=this.hls.userConfig,g=d&&a||n;(f.liveSyncDuration||f.liveSyncDurationCount||g===0)&&(g=l!==void 0?l:u*r);var p=r;return g+Math.min(1*this.stallCount,p)}},{key:"liveSyncPosition",get:function(){var i=this.estimateLiveEdge(),n=this.targetLatency,a=this.levelDetails;if(i===null||n===null||a===null)return null;var r=a.edge,s=i-n-this.edgeStalled,l=r-a.totalduration,u=r-(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.min(Math.max(l,s),u)}},{key:"drift",get:function(){var i=this.levelDetails;return i===null?1:i.drift}},{key:"edgeStalled",get:function(){var i=this.levelDetails;if(i===null)return 0;var n=3*(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.max(i.age-n,0)}},{key:"forwardBufferLength",get:function(){var i=this.media,n=this.levelDetails;if(!i||!n)return 0;var a=i.buffered.length;return(a?i.buffered.end(a-1):n.edge)-this.currentTime}}])&&ct(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),h}();function St(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}var Et,vt=["NONE","TYPE-0","TYPE-1","TYPE-2",null];(function(h){h.No="",h.Yes="YES",h.v2="v2"})(Et||(Et={}));var P=function(){function h(o,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=o,this.part=e,this.skip=t}return h.prototype.addDirectives=function(o){var e=new self.URL(o);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},h}(),D=function(){function h(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(i){return i}).join(",").replace(/\.[^.,]+/g,"")}var o,e;return o=h,(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&St(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),h}();function v(){return v=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},v.apply(this,arguments)}function T(h,o,e){switch(o){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(e);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(e)}}function S(h){var o={};h.forEach(function(e){var t=e.groupId||"";e.id=o[t]=o[t]||0,o[t]++})}function R(h,o){var e=o.startPTS;if((0,F.isFiniteNumber)(e)){var t,i=0;o.sn>h.sn?(i=e-h.start,t=h):(i=h.start-e,t=o),t.duration!==i&&(t.duration=i)}else o.sn>h.sn?h.cc===o.cc&&h.minEndPTS?o.start=h.start+(h.minEndPTS-h.start):o.start=h.start+h.duration:o.start=Math.max(h.start-o.duration,0)}function I(h,o,e,t,i,n){t-e<=0&&(k.logger.warn("Fragment should have a positive duration",o),t=e+o.duration,n=i+o.duration);var a=e,r=t,s=o.startPTS,l=o.endPTS;if((0,F.isFiniteNumber)(s)){var u=Math.abs(s-e);(0,F.isFiniteNumber)(o.deltaPTS)?o.deltaPTS=Math.max(u,o.deltaPTS):o.deltaPTS=u,a=Math.max(e,s),e=Math.min(e,s),i=Math.min(i,o.startDTS),r=Math.min(t,l),t=Math.max(t,l),n=Math.max(n,o.endDTS)}o.duration=t-e;var d=e-o.start;o.start=o.startPTS=e,o.maxStartPTS=a,o.startDTS=i,o.endPTS=t,o.minEndPTS=r,o.endDTS=n;var f,g=o.sn;if(!h||g<h.startSN||g>h.endSN)return 0;var p=g-h.startSN,m=h.fragments;for(m[p]=o,f=p;f>0;f--)R(m[f],m[f-1]);for(f=p;f<m.length-1;f++)R(m[f],m[f+1]);return h.fragmentHint&&R(m[m.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,d}function w(h,o){var e=o.startSN+o.skippedSegments-h.startSN,t=h.fragments;e<0||e>=t.length||J(o,t[e].start)}function J(h,o){if(o){for(var e=h.fragments,t=h.skippedSegments;t<e.length;t++)e[t].start+=o;h.fragmentHint&&(h.fragmentHint.start+=o)}}var re=function(){function h(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,t+":"),this.warn=k.logger.warn.bind(k.logger,t+":"),this.hls=e}var o=h.prototype;return o.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},o.onError=function(e,t){!t.fatal||t.type!==E.ErrorTypes.NETWORK_ERROR&&t.type!==E.ErrorTypes.KEY_SYSTEM_ERROR||this.stopLoad()},o.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},o.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},o.stopLoad=function(){this.canLoad=!1,this.clearTimer()},o.switchParams=function(e,t){var i=t==null?void 0:t.renditionReports;if(i)for(var n=0;n<i.length;n++){var a=i[n],r=void 0;try{r=new self.URL(a.URI,t.url).href}catch(d){k.logger.warn("Could not construct new URL for Rendition Report: "+d),r=a.URI||""}if(r===e.slice(-r.length)){var s=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn),l=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}return new P(s,l>=0?l:void 0,Et.No)}}},o.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},o.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},o.playlistLoaded=function(e,t,i){var n=this,a=t.details,r=t.stats,s=self.performance.now(),l=r.loading.first?Math.max(0,s-r.loading.first):0;if(a.advancedDateTime=Date.now()-l,a.live||i!=null&&i.live){if(a.reloaded(i),i&&this.log("live playlist "+e+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),i&&a.fragments.length>0&&function(ye,fe){for(var Ge=null,nt=ye.fragments,Ue=nt.length-1;Ue>=0;Ue--){var He=nt[Ue].initSegment;if(He){Ge=He;break}}ye.fragmentHint&&delete ye.fragmentHint.endPTS;var $e,Tt,ft,ut,ht,Nt=0;if(function(Fe,Ne,lr){for(var wt=Ne.skippedSegments,Ut=Math.max(Fe.startSN,Ne.startSN)-Ne.startSN,er=(Fe.fragmentHint?1:0)+(wt?Ne.endSN:Math.min(Fe.endSN,Ne.endSN))-Ne.startSN,Bt=Ne.startSN-Fe.startSN,Gt=Ne.fragmentHint?Ne.fragments.concat(Ne.fragmentHint):Ne.fragments,Kt=Fe.fragmentHint?Fe.fragments.concat(Fe.fragmentHint):Fe.fragments,Dt=Ut;Dt<=er;Dt++){var ti=Kt[Bt+Dt],mr=Gt[Dt];wt&&!mr&&Dt<wt&&(mr=Ne.fragments[Dt]=ti),ti&&mr&&lr(ti,mr)}}(ye,fe,function(Fe,Ne){Fe.relurl&&(Nt=Fe.cc-Ne.cc),(0,F.isFiniteNumber)(Fe.startPTS)&&(0,F.isFiniteNumber)(Fe.endPTS)&&(Ne.start=Ne.startPTS=Fe.startPTS,Ne.startDTS=Fe.startDTS,Ne.appendedPTS=Fe.appendedPTS,Ne.maxStartPTS=Fe.maxStartPTS,Ne.endPTS=Fe.endPTS,Ne.endDTS=Fe.endDTS,Ne.minEndPTS=Fe.minEndPTS,Ne.duration=Fe.endPTS-Fe.startPTS,Ne.duration&&($e=Ne),fe.PTSKnown=fe.alignedSliding=!0),Ne.elementaryStreams=Fe.elementaryStreams,Ne.loader=Fe.loader,Ne.stats=Fe.stats,Ne.urlId=Fe.urlId,Fe.initSegment&&(Ne.initSegment=Fe.initSegment,Ge=Fe.initSegment)}),Ge&&(fe.fragmentHint?fe.fragments.concat(fe.fragmentHint):fe.fragments).forEach(function(Fe){var Ne;Fe.initSegment&&Fe.initSegment.relurl!==((Ne=Ge)===null||Ne===void 0?void 0:Ne.relurl)||(Fe.initSegment=Ge)}),fe.skippedSegments)if(fe.deltaUpdateFailed=fe.fragments.some(function(Fe){return!Fe}),fe.deltaUpdateFailed){k.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var qt=fe.skippedSegments;qt--;)fe.fragments.shift();fe.startSN=fe.fragments[0].sn,fe.startCC=fe.fragments[0].cc}else fe.canSkipDateRanges&&(fe.dateRanges=(Tt=ye.dateRanges,ft=fe.dateRanges,ut=fe.recentlyRemovedDateranges,ht=v({},Tt),ut&&ut.forEach(function(Fe){delete ht[Fe]}),Object.keys(ft).forEach(function(Fe){var Ne=new V(ft[Fe].attr,ht[Fe]);Ne.isValid?ht[Fe]=Ne:k.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(ft[Fe].attr)+'"')}),ht));var Zt=fe.fragments;if(Nt){k.logger.warn("discontinuity sliding from playlist, take drift into account");for(var or=0;or<Zt.length;or++)Zt[or].cc+=Nt}fe.skippedSegments&&(fe.startCC=fe.fragments[0].cc),function(Fe,Ne,lr){if(Fe&&Ne)for(var wt=0,Ut=0,er=Fe.length;Ut<=er;Ut++){var Bt=Fe[Ut],Gt=Ne[Ut+wt];Bt&&Gt&&Bt.index===Gt.index&&Bt.fragment.sn===Gt.fragment.sn?(Kt=Bt,(Dt=Gt).elementaryStreams=Kt.elementaryStreams,Dt.stats=Kt.stats):wt--}var Kt,Dt}(ye.partList,fe.partList),$e?I(fe,$e,$e.startPTS,$e.endPTS,$e.startDTS,$e.endDTS):w(ye,fe),Zt.length&&(fe.totalduration=fe.edge-Zt[0].start),fe.driftStartTime=ye.driftStartTime,fe.driftStart=ye.driftStart;var Jt=fe.advancedDateTime;if(fe.advanced&&Jt){var pr=fe.edge;fe.driftStart||(fe.driftStartTime=Jt,fe.driftStart=pr),fe.driftEndTime=Jt,fe.driftEnd=pr}else fe.driftEndTime=ye.driftEndTime,fe.driftEnd=ye.driftEnd,fe.advancedDateTime=ye.advancedDateTime}(i,a),!this.canLoad||!a.live)return;var u,d=void 0,f=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var g=this.hls.config.lowLatencyMode,p=a.lastPartSn,m=a.endSN,A=a.lastPartIndex,L=p===m;A!==-1?(d=L?m+1:p,f=L?g?0:A:A+1):d=m+1;var _=a.age,K=_+a.ageHeader,z=Math.min(K-a.partTarget,1.5*a.targetduration);if(z>0){if(i&&z>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+z+" with playlist age: "+a.age),z=0;else{var Y=Math.floor(z/a.targetduration);d+=Y,f!==void 0&&(f+=Math.round(z%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+_.toFixed(2)+"s goal: "+z+" skip sn "+Y+" to part "+f)}a.tuneInGoal=z}if(u=this.getDeliveryDirectives(a,t.deliveryDirectives,d,f),g||!L)return void this.loadPlaylist(u)}else u=this.getDeliveryDirectives(a,t.deliveryDirectives,d,f);var ee=this.hls.mainForwardBufferInfo,Ee=ee?ee.end-ee.len:0,Se=function(ye,fe){fe===void 0&&(fe=1/0);var Ge=1e3*ye.targetduration;if(ye.updated){var nt=ye.fragments;if(nt.length&&4*Ge>fe){var Ue=1e3*nt[nt.length-1].duration;Ue<Ge&&(Ge=Ue)}}else Ge/=2;return Math.round(Ge)}(a,1e3*(a.edge-Ee));a.updated?s>this.requestScheduled+Se&&(this.requestScheduled=r.loading.start):this.requestScheduled=-1,d!==void 0&&a.canBlockReload?this.requestScheduled=r.loading.first+Se-(1e3*a.partTarget||1e3):this.requestScheduled=(this.requestScheduled===-1?s:this.requestScheduled)+Se;var ae=this.requestScheduled-s;ae=Math.max(0,ae),this.log("reload live playlist "+e+" in "+Math.round(ae)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(u)},ae)}else this.clearTimer()},o.getDeliveryDirectives=function(e,t,i,n){var a=function(r,s){var l=r.canSkipUntil,u=r.canSkipDateRanges,d=r.endSN;return l&&(s!==void 0?s-d:0)<l?u?Et.v2:Et.Yes:Et.No}(e,i);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,a=Et.No),new P(i,n,a)},o.retryLoadingOrFail=function(e){var t,i=this,n=this.hls.config,a=this.retryCount<n.levelLoadingMaxRetry;if(a)if(this.requestScheduled=-1,this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&(t=e.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return i.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return a},h}();function ne(){return ne=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},ne.apply(this,arguments)}function ge(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function Ie(h,o){return Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ie(h,o)}var me,we=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),Be=function(h){var o,e;function t(r){var s;return(s=h.call(this,r,"[level-controller]")||this)._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,Ie(o,e);var i,n,a=t.prototype;return a._registerListeners=function(){var r=this.hls;r.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(c.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(c.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,h.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),h.prototype.startLoad.call(this)},a.onManifestLoaded=function(r,s){var l,u,d=[],f=[],g=[],p={},m=!1,A=!1,L=!1;if(s.levels.forEach(function(Y){var ee=Y.attrs;m=m||!(!Y.width||!Y.height),A=A||!!Y.videoCodec,L=L||!!Y.audioCodec,we&&Y.audioCodec&&Y.audioCodec.indexOf("mp4a.40.34")!==-1&&(Y.audioCodec=void 0);var Ee=Y.bitrate+"-"+Y.attrs.RESOLUTION+"-"+Y.attrs.CODECS;(u=p[Ee])?u.url.push(Y.url):(u=new D(Y),p[Ee]=u,d.push(u)),ee&&(ee.AUDIO&&T(u,"audio",ee.AUDIO),ee.SUBTITLES&&T(u,"text",ee.SUBTITLES))}),(m||A)&&L&&(d=d.filter(function(Y){var ee=Y.videoCodec,Ee=Y.width,Se=Y.height;return!!ee||!(!Ee||!Se)})),d=d.filter(function(Y){var ee=Y.audioCodec,Ee=Y.videoCodec;return(!ee||De(ee,"audio"))&&(!Ee||De(Ee,"video"))}),s.audioTracks&&S(f=s.audioTracks.filter(function(Y){return!Y.audioCodec||De(Y.audioCodec,"audio")})),s.subtitles&&S(g=s.subtitles),d.length>0){l=d[0].bitrate,d.sort(function(Y,ee){return Y.attrs["HDCP-LEVEL"]!==ee.attrs["HDCP-LEVEL"]?(Y.attrs["HDCP-LEVEL"]||"")>(ee.attrs["HDCP-LEVEL"]||"")?1:-1:Y.bitrate!==ee.bitrate?Y.bitrate-ee.bitrate:Y.attrs.SCORE!==ee.attrs.SCORE?Y.attrs.decimalFloatingPoint("SCORE")-ee.attrs.decimalFloatingPoint("SCORE"):m&&Y.height!==ee.height?Y.height-ee.height:0}),this._levels=d;for(var _=0;_<d.length;_++)if(d[_].bitrate===l){this._firstLevel=_,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+l);break}var K=L&&!A,z={levels:d,audioTracks:f,subtitleTracks:g,sessionData:s.sessionData,sessionKeys:s.sessionKeys,firstLevel:this._firstLevel,stats:s.stats,audio:L,video:A,altAudio:!K&&f.some(function(Y){return!!Y.url})};this.hls.trigger(c.Events.MANIFEST_PARSED,z),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(r,s){var l,u;if(h.prototype.onError.call(this,r,s),!s.fatal){var d=s.context,f=this._levels[this.currentLevelIndex];if(d&&(d.type===x.PlaylistContextType.AUDIO_TRACK&&f.audioGroupIds&&d.groupId===f.audioGroupIds[f.urlId]||d.type===x.PlaylistContextType.SUBTITLE_TRACK&&f.textGroupIds&&d.groupId===f.textGroupIds[f.urlId]))this.redundantFailover(this.currentLevelIndex);else{var g,p=!1,m=!0;switch(s.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:if(s.frag){var A=s.frag.type===x.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,L=this._levels[A];L?(L.fragmentError++,L.fragmentError>this.hls.config.fragLoadingMaxRetry&&(g=A)):g=A}break;case E.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var _=f.attrs["HDCP-LEVEL"];_&&(this.hls.maxHdcpLevel=vt[vt.indexOf(_)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case E.ErrorDetails.FRAG_PARSING_ERROR:case E.ErrorDetails.KEY_SYSTEM_NO_SESSION:g=((l=s.frag)===null||l===void 0?void 0:l.type)===x.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,s.levelRetry=!1;break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:d&&(d.deliveryDirectives&&(m=!1),g=d.level),p=!0;break;case E.ErrorDetails.REMUX_ALLOC_ERROR:g=(u=s.level)!=null?u:this.currentLevelIndex,p=!0}g!==void 0&&this.recoverLevel(s,g,p,m)}}},a.recoverLevel=function(r,s,l,u){var d=r.details,f=this._levels[s];if(f.loadError++,l){if(!this.retryLoadingOrFail(r))return void(this.currentLevelIndex=-1);r.levelRetry=!0}if(u){var g=f.url.length;if(g>1&&f.loadError<g)r.levelRetry=!0,this.redundantFailover(s);else if(this.manualLevelIndex===-1){for(var p=-1,m=this._levels,A=m.length;A--;){var L=(A+this.currentLevelIndex)%m.length;if(L!==this.currentLevelIndex&&m[L].loadError===0){p=L;break}}p>-1&&this.currentLevelIndex!==p?(this.warn(d+": switch to "+p),r.levelRetry=!0,this.hls.nextAutoLevel=p):r.levelRetry===!1&&(r.fatal=!0)}}},a.redundantFailover=function(r){var s=this._levels[r],l=s.url.length;if(l>1){var u=(s.urlId+1)%l;this.warn("Switching to redundant URL-id "+u),this._levels.forEach(function(d){d.urlId=u}),this.level=r}},a.onFragLoaded=function(r,s){var l=s.frag;if(l!==void 0&&l.type===x.PlaylistLevelType.MAIN){var u=this._levels[l.level];u!==void 0&&(u.fragmentError=0,u.loadError=0)}},a.onLevelLoaded=function(r,s){var l,u,d=s.level,f=s.details,g=this._levels[d];if(!g)return this.warn("Invalid level index "+d),void((u=s.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(f.deltaUpdateFailed=!0));d===this.currentLevelIndex?(g.fragmentError===0&&(g.loadError=0,this.retryCount=0),this.playlistLoaded(d,s,g.details)):(l=s.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(f.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(r,s){var l=this.hls.levels[this.currentLevelIndex];if(l&&l.audioGroupIds){for(var u=-1,d=this.hls.audioTracks[s.id].groupId,f=0;f<l.audioGroupIds.length;f++)if(l.audioGroupIds[f]===d){u=f;break}u!==l.urlId&&(l.urlId=u,this.startLoad())}},a.loadPlaylist=function(r){h.prototype.loadPlaylist.call(this);var s=this.currentLevelIndex,l=this._levels[s];if(this.canLoad&&l&&l.url.length>0){var u=l.urlId,d=l.url[u];if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+s+((r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:"")+" with URL-id "+u+" "+d),this.clearTimer(),this.hls.trigger(c.Events.LEVEL_LOADING,{url:d,level:s,id:u,deliveryDirectives:r||null})}},a.removeLevel=function(r,s){var l=function(d,f){return f!==s},u=this._levels.filter(function(d,f){return f!==r||d.url.length>1&&s!==void 0&&(d.url=d.url.filter(l),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(l)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(l)),d.urlId=0,!0)}).map(function(d,f){var g=d.details;return g!=null&&g.fragments&&g.fragments.forEach(function(p){p.level=f}),d});this._levels=u,this.hls.trigger(c.Events.LEVELS_UPDATED,{levels:u})},i=t,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var s,l=this._levels;if(l.length!==0&&(this.currentLevelIndex!==r||(s=l[r])===null||s===void 0||!s.details)){if(r<0||r>=l.length){var u=r<0;if(this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.LEVEL_SWITCH_ERROR,level:r,fatal:u,reason:"invalid level idx"}),u)return;r=Math.min(r,l.length-1)}this.clearTimer();var d=this.currentLevelIndex,f=l[d],g=l[r];this.log("switching to level "+r+" from "+d),this.currentLevelIndex=r;var p=ne({},g,{level:r,maxBitrate:g.maxBitrate,uri:g.uri,urlId:g.urlId});delete p._urlId,this.hls.trigger(c.Events.LEVEL_SWITCHING,p);var m=g.details;if(!m||m.live){var A=this.switchParams(g.uri,f==null?void 0:f.details);this.loadPlaylist(A)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this._firstLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}])&&ge(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(re);(function(h){h.NOT_LOADED="NOT_LOADED",h.APPENDING="APPENDING",h.PARTIAL="PARTIAL",h.OK="OK"})(me||(me={}));var Qe=function(){function h(e){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var o=h.prototype;return o._registerListeners=function(){var e=this.hls;e.on(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(c.Events.FRAG_LOADED,this.onFragLoaded,this)},o._unregisterListeners=function(){var e=this.hls;e.off(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(c.Events.FRAG_LOADED,this.onFragLoaded,this)},o.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},o.getAppendedFrag=function(e,t){if(t===x.PlaylistLevelType.MAIN){var i=this.activeFragment,n=this.activeParts;if(!i)return null;if(n)for(var a=n.length;a--;){var r=n[a],s=r?r.end:i.appendedPTS;if(r.start<=e&&s!==void 0&&e<=s)return a>9&&(this.activeParts=n.slice(a-9)),r}else if(i.start<=e&&i.appendedPTS!==void 0&&e<=i.appendedPTS)return i}return this.getBufferedFrag(e,t)},o.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),a=n.length;a--;){var r=i[n[a]];if((r==null?void 0:r.body.type)===t&&r.buffered){var s=r.body;if(s.start<=e&&e<=s.end)return s}}return null},o.detectEvictedFragments=function(e,t,i){var n=this;this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(function(a){var r=n.fragments[a];if(r)if(r.buffered||r.loaded){var s=r.range[e];s&&s.time.some(function(l){var u=!n.isTimeBuffered(l.startPTS,l.endPTS,t);return u&&n.removeFragment(r.body),u})}else r.body.type===i&&n.removeFragment(r.body)})},o.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,a=e.part;if(i&&n.sn!=="initSegment"){var r=rt(n),s=this.fragments[r];s&&(Object.keys(i).forEach(function(l){var u=n.elementaryStreams[l];if(u){var d=i[l],f=a!==null||u.partial===!0;s.range[l]=t.getBufferedTimes(n,a,f,d)}}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,s.body.endList&&(this.endListFragments[s.body.type]=s)):this.removeFragment(s.body))}},o.fragBuffered=function(e){var t=rt(e),i=this.fragments[t];i&&(i.loaded=null,i.buffered=!0)},o.getBufferedTimes=function(e,t,i,n){for(var a={time:[],partial:i},r=t?t.start:e.start,s=t?t.end:e.end,l=e.minEndPTS||s,u=e.maxStartPTS||r,d=0;d<n.length;d++){var f=n.start(d)-this.bufferPadding,g=n.end(d)+this.bufferPadding;if(u>=f&&l<=g){a.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(s,n.end(d))});break}if(r<g&&s>f)a.partial=!0,a.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(s,n.end(d))});else if(s<=f)break}return a},o.getPartialFragment=function(e){var t,i,n,a=null,r=0,s=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(u){var d=l[u];d&&_e(d)&&(i=d.body.start-s,n=d.body.end+s,e>=i&&e<=n&&(t=Math.min(e-i,n-e),r<=t&&(a=d.body,r=t)))}),a},o.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||_e(t))},o.getState=function(e){var t=rt(e),i=this.fragments[t];return i?i.buffered?_e(i)?me.PARTIAL:me.OK:me.APPENDING:me.NOT_LOADED},o.isTimeBuffered=function(e,t,i){for(var n,a,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,a=i.end(r)+this.bufferPadding,e>=n&&t<=a)return!0;if(t<=n)return!1}return!1},o.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if(i.sn!=="initSegment"&&!i.bitrateTest&&!n){var a=rt(i);this.fragments[a]={body:i,loaded:t,buffered:!1,range:Object.create(null)}}},o.onBufferAppended=function(e,t){var i=this,n=t.frag,a=t.part,r=t.timeRanges;if(n.type===x.PlaylistLevelType.MAIN)if(this.activeFragment!==n&&(this.activeFragment=n,n.appendedPTS=void 0),a){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(a)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(l){var u=r[l];if(i.detectEvictedFragments(l,u),!a&&n.type===x.PlaylistLevelType.MAIN){var d=n.elementaryStreams[l];if(!d)return;for(var f=0;f<u.length;f++){var g=u.end(f);g<=d.endPTS&&g>d.startPTS?n.appendedPTS=Math.max(g,n.appendedPTS||0):n.appendedPTS=d.endPTS}}})},o.onFragBuffered=function(e,t){this.detectPartialFragments(t)},o.hasFragment=function(e){var t=rt(e);return!!this.fragments[t]},o.removeFragmentsInRange=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(a){var r=n.fragments[a];if(r&&r.buffered){var s=r.body;s.type===i&&s.start<t&&s.end>e&&n.removeFragment(s)}})},o.removeFragment=function(e){var t=rt(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),e.appendedPTS=void 0,delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},o.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},h}();function _e(h){var o,e;return h.buffered&&(((o=h.range.video)===null||o===void 0?void 0:o.partial)||((e=h.range.audio)===null||e===void 0?void 0:e.partial))}function rt(h){return h.type+"_"+h.level+"_"+h.urlId+"_"+h.sn}function pt(h){var o=typeof Map=="function"?new Map:void 0;return pt=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(e))return o.get(e);o.set(e,i)}function i(){return it(e,arguments,xe(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),dt(i,e)},pt(h)}function it(h,o,e){return it=mt()?Reflect.construct.bind():function(t,i,n){var a=[null];a.push.apply(a,i);var r=new(Function.bind.apply(t,a));return n&&dt(r,n.prototype),r},it.apply(null,arguments)}function mt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(h){return!1}}function dt(h,o){return dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dt(h,o)}function xe(h){return xe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},xe(h)}var Lt=Math.pow(2,17),It=function(){function h(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var o=h.prototype;return o.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},o.abort=function(){this.loader&&this.loader.abort()},o.load=function(e,t){var i=this,n=e.url;if(!n)return Promise.reject(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var a=this.config,r=a.fLoader,s=a.loader;return new Promise(function(l,u){i.loader&&i.loader.destroy();var d=i.loader=e.loader=r?new r(a):new s(a),f=ot(e),g={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:e.sn==="initSegment"?1/0:Lt};e.stats=d.stats,d.load(f,g,{onSuccess:function(p,m,A,L){i.resetLoader(e,d);var _=p.data;A.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),l({frag:e,part:null,payload:_,networkDetails:L})},onError:function(p,m,A){i.resetLoader(e,d),u(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:p,networkDetails:A}))},onAbort:function(p,m,A){i.resetLoader(e,d),u(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:A}))},onTimeout:function(p,m,A){i.resetLoader(e,d),u(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:A}))},onProgress:function(p,m,A,L){t&&t({frag:e,part:null,payload:A,networkDetails:L})}})})},o.loadPart=function(e,t,i){var n=this;this.abort();var a=this.config,r=a.fLoader,s=a.loader;return new Promise(function(l,u){n.loader&&n.loader.destroy();var d=n.loader=e.loader=r?new r(a):new s(a),f=ot(e,t),g={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:Lt};t.stats=d.stats,d.load(f,g,{onSuccess:function(p,m,A,L){n.resetLoader(e,d),n.updateStatsFromPart(e,t);var _={frag:e,part:t,payload:p.data,networkDetails:L};i(_),l(_)},onError:function(p,m,A){n.resetLoader(e,d),u(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:p,networkDetails:A}))},onAbort:function(p,m,A){e.stats.aborted=t.stats.aborted,n.resetLoader(e,d),u(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:A}))},onTimeout:function(p,m,A){n.resetLoader(e,d),u(new yt({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:A}))}})})},o.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,a=n.total;if(i.loaded+=n.loaded,a){var r=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/a),r),l=(r-s)*Math.round(i.loaded/s);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var u=i.loading,d=n.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},o.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},h}();function ot(h,o){o===void 0&&(o=null);var e=o||h,t={frag:h,part:o,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;if((0,F.isFiniteNumber)(i)&&(0,F.isFiniteNumber)(n)){var a,r=i,s=n;if(h.sn==="initSegment"&&((a=h.decryptdata)===null||a===void 0?void 0:a.method)==="AES-128"){var l=n-i;l%16&&(s=n+(16-l%16)),i!==0&&(t.resetIV=!0,r=i-16)}t.rangeStart=r,t.rangeEnd=s}return t}var yt=function(h){var o,e;function t(i){for(var n,a=arguments.length,r=new Array(a>1?a-1:0),s=1;s<a;s++)r[s-1]=arguments[s];return(n=h.call.apply(h,[this].concat(r))||this).data=void 0,n.data=i,n}return e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,dt(o,e),t}(pt(Error)),Ct=function(){function h(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var o=h.prototype;return o.abort=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}},o.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},o.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},o.createKeyLoadError=function(e,t,i,n){return t===void 0&&(t=E.ErrorDetails.KEY_LOAD_ERROR),new yt({type:E.ErrorTypes.NETWORK_ERROR,details:t,fatal:!1,frag:e,networkDetails:i})},o.loadClear=function(e,t){var i=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,a=e.cc,r=function(l){var u=t[l];if(a<=u.cc&&(n==="initSegment"||n<u.sn))return i.emeController.selectKeySystemFormat(u).then(function(d){u.setKeyFormat(d)}),"break"},s=0;s<t.length&&r(s)!=="break";s++);},o.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(i){return t.loadInternal(e,i)}):this.loadInternal(e)},o.loadInternal=function(e,t){var i,n;t&&e.setKeyFormat(t);var a=e.decryptdata;if(!a){var r=t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(e,E.ErrorDetails.KEY_LOAD_ERROR,null,r))}var s=a.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,E.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+s+'"'));var l,u=this.keyUriToKeyInfo[s];if((i=u)!==null&&i!==void 0&&i.decryptdata.key)return a.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if((n=u)!==null&&n!==void 0&&n.keyLoadPromise)switch((l=u.mediaKeySessionContext)===null||l===void 0?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(function(d){return a.key=d.keyInfo.decryptdata.key,{frag:e,keyInfo:u}})}switch(u=this.keyUriToKeyInfo[s]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,E.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+a.method+'"'))}},o.loadKeyEME=function(e,t){var i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(i);if(n)return(e.keyLoadPromise=n.then(function(a){return e.mediaKeySessionContext=a,i})).catch(function(a){throw e.keyLoadPromise=null,a})}return Promise.resolve(i)},o.loadKeyHTTP=function(e,t){var i=this,n=this.config,a=new n.loader(n);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise(function(r,s){var l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},d={onSuccess:function(f,g,p,m){var A=p.frag,L=p.keyInfo,_=p.url;if(!A.decryptdata||L!==i.keyUriToKeyInfo[_])return s(i.createKeyLoadError(A,E.ErrorDetails.KEY_LOAD_ERROR,m,"after key load, decryptdata unset or changed"));L.decryptdata.key=A.decryptdata.key=new Uint8Array(f.data),A.keyLoader=null,L.loader=null,r({frag:A,keyInfo:L})},onError:function(f,g,p){i.resetLoader(g),s(i.createKeyLoadError(t,E.ErrorDetails.KEY_LOAD_ERROR,p))},onTimeout:function(f,g,p){i.resetLoader(g),s(i.createKeyLoadError(t,E.ErrorDetails.KEY_LOAD_TIMEOUT,p))},onAbort:function(f,g,p){i.resetLoader(g),s(i.createKeyLoadError(t,E.ErrorDetails.INTERNAL_ABORTED,p))}};a.load(l,u,d)})},o.resetLoader=function(e){var t=e.frag,i=e.keyInfo,n=e.url,a=i.loader;t.keyLoader===a&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[n],a&&a.destroy()},h}(),Ht=function(){function h(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var o=h.prototype;return o.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},o.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},o.onHandlerDestroyed=function(){},o.hasInterval=function(){return!!this._tickInterval},o.hasNextTick=function(){return!!this._tickTimer},o.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},o.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},o.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},o.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},o.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},o.doTick=function(){},h}(),xt={length:0,start:function(){return 0},end:function(){return 0}},lt=function(){function h(){}return h.isBuffered=function(o,e){try{if(o){for(var t=h.getBuffered(o),i=0;i<t.length;i++)if(e>=t.start(i)&&e<=t.end(i))return!0}}catch(n){}return!1},h.bufferInfo=function(o,e,t){try{if(o){var i,n=h.getBuffered(o),a=[];for(i=0;i<n.length;i++)a.push({start:n.start(i),end:n.end(i)});return this.bufferedInfo(a,e,t)}}catch(r){}return{len:0,start:e,end:e,nextStart:void 0}},h.bufferedInfo=function(o,e,t){e=Math.max(0,e),o.sort(function(m,A){return m.start-A.start||A.end-m.end});var i=[];if(t)for(var n=0;n<o.length;n++){var a=i.length;if(a){var r=i[a-1].end;o[n].start-r<t?o[n].end>r&&(i[a-1].end=o[n].end):i.push(o[n])}else i.push(o[n])}else i=o;for(var s,l=0,u=e,d=e,f=0;f<i.length;f++){var g=i[f].start,p=i[f].end;if(e+t>=g&&e<p)u=g,l=(d=p)-e;else if(e+t<g){s=g;break}}return{len:l,start:u||0,end:d||0,nextStart:s}},h.getBuffered=function(o){try{return o.buffered}catch(e){return k.logger.log("failed to get media.buffered",e),xt}},h}(),yr=function(h,o,e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=h,this.sn=o,this.id=e,this.size=t,this.part=i,this.partial=n};function ii(h,o){for(var e=null,t=0,i=h.length;t<i;t++){var n=h[t];if(n&&n.cc===o){e=n;break}}return e}function ni(h,o){if(h){var e=h.start+o;h.start=h.startPTS=e,h.endPTS=e+h.duration}}function Er(h,o){for(var e=o.fragments,t=0,i=e.length;t<i;t++)ni(e[t],h);o.fragmentHint&&ni(o.fragmentHint,h),o.alignedSliding=!0}function ai(h,o){if(h.hasProgramDateTime&&o.hasProgramDateTime){var e=h.fragments,t=o.fragments;if(e.length&&t.length){var i=t[Math.round(t.length/2)-1],n=ii(e,i.cc)||e[Math.round(e.length/2)-1],a=i.programDateTime,r=n.programDateTime;a!==null&&r!==null&&Er((r-a)/1e3-(n.start-i.start),h)}}}const si=function(h,o){for(var e=0,t=h.length-1,i=null,n=null;e<=t;){var a=o(n=h[i=(e+t)/2|0]);if(a>0)e=i+1;else{if(!(a<0))return n;t=i-1}}return null};function Tr(h,o,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var i=null;if(h?i=o[h.sn-o[0].sn+1]||null:e===0&&o[0].start===0&&(i=o[0]),i&&Sr(e,t,i)===0)return i;var n=si(o,Sr.bind(null,e,t));return!n||n===h&&i?i:n}function Sr(h,o,e){if(h===void 0&&(h=0),o===void 0&&(o=0),e.start<=h&&e.start+e.duration>h)return 0;var t=Math.min(o,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=h?1:e.start-t>h&&e.start?-1:0}function Vi(h,o,e){var t=1e3*Math.min(o,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>h}var Yi=q(21);const Wi=function(h){for(var o="",e=h.length,t=0;t<e;t++)o+="["+h.start(t).toFixed(3)+"-"+h.end(t).toFixed(3)+"]";return o};function qi(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function br(h,o){return br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},br(h,o)}var kt="STOPPED",Ye="IDLE",Lr="KEY_LOADING",Xt="FRAG_LOADING",zt="FRAG_LOADING_WAITING_RETRY",ur="WAITING_TRACK",_t="PARSING",rr="PARSED",ir="ENDED",Ft="ERROR",nr="WAITING_INIT_PTS",Qt="WAITING_LEVEL",Ar=function(h){var o,e;function t(r,s,l,u){var d;return(d=h.call(this)||this).hls=void 0,d.fragPrevious=null,d.fragCurrent=null,d.fragmentTracker=void 0,d.transmuxer=null,d._state=kt,d.media=null,d.mediaBuffer=null,d.config=void 0,d.bitrateTest=!1,d.lastCurrentTime=0,d.nextLoadPosition=0,d.startPosition=0,d.loadedmetadata=!1,d.fragLoadError=0,d.retryDate=0,d.levels=null,d.fragmentLoader=void 0,d.keyLoader=void 0,d.levelLastLoaded=null,d.startFragRequested=!1,d.decrypter=void 0,d.initPTS=[],d.onvseeking=null,d.onvended=null,d.logPrefix="",d.log=void 0,d.warn=void 0,d.logPrefix=u,d.log=k.logger.log.bind(k.logger,u+":"),d.warn=k.logger.warn.bind(k.logger,u+":"),d.hls=r,d.fragmentLoader=new It(r.config),d.keyLoader=l,d.fragmentTracker=s,d.config=r.config,d.decrypter=new Yi.default(r.config),r.on(c.Events.LEVEL_SWITCHING,d.onLevelSwitching,function(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}(d)),d}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,br(o,e);var i,n,a=t.prototype;return a.doTick=function(){this.onTickEnd()},a.onTickEnd=function(){},a.startLoad=function(r){},a.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var r=this.fragCurrent;r&&(r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=kt},a._streamEnded=function(r,s){if(s.live||r.nextStart||!r.end||!this.media)return!1;var l=s.partList;if(l!=null&&l.length){var u=l[l.length-1];return lt.isBuffered(this.media,u.start+u.duration/2)}var d=s.fragments[s.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)},a.getLevelDetails=function(){var r;if(this.levels&&this.levelLastLoaded!==null)return(r=this.levels[this.levelLastLoaded])===null||r===void 0?void 0:r.details},a.onMediaAttached=function(r,s){var l=this.media=this.mediaBuffer=s.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),l.addEventListener("seeking",this.onvseeking),l.addEventListener("ended",this.onvended);var u=this.config;this.levels&&u.autoStartLoad&&this.state===kt&&this.startLoad(u.startPosition)},a.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},a.onMediaSeeking=function(){var r=this.config,s=this.fragCurrent,l=this.media,u=this.mediaBuffer,d=this.state,f=l?l.currentTime:0,g=lt.bufferInfo(u||l,f,r.maxBufferHole);if(this.log("media seeking to "+((0,F.isFiniteNumber)(f)?f.toFixed(3):f)+", state: "+d),this.state===ir)this.resetLoadingState();else if(s){var p=r.maxFragLookUpTolerance,m=s.start-p,A=s.start+s.duration+p;if(!g.len||A<g.start||m>g.end){var L=f>A;(f<m||L)&&(L&&s.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.abortRequests()),this.resetLoadingState())}}l&&(this.lastCurrentTime=f),this.loadedmetadata||g.len||(this.nextLoadPosition=this.startPosition=f),this.tickImmediate()},a.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},a.onLevelSwitching=function(r,s){this.fragLoadError=0},a.onHandlerDestroying=function(){this.stopLoad(),h.prototype.onHandlerDestroying.call(this)},a.onHandlerDestroyed=function(){this.state=kt,this.hls.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,h.prototype.onHandlerDestroyed.call(this)},a.loadFragment=function(r,s,l){this._loadFragForPlayback(r,s,l)},a._loadFragForPlayback=function(r,s,l){var u=this;this._doFragLoad(r,s,l,function(d){if(u.fragContextChanged(r))return u.warn("Fragment "+r.sn+(d.part?" p: "+d.part.index:"")+" of level "+r.level+" was dropped during download."),void u.fragmentTracker.removeFragment(r);r.stats.chunkCount++,u._handleFragmentLoadProgress(d)}).then(function(d){if(d){u.fragLoadError=0;var f=u.state;u.fragContextChanged(r)?(f===Xt||!u.fragCurrent&&f===_t)&&(u.fragmentTracker.removeFragment(r),u.state=Ye):("payload"in d&&(u.log("Loaded fragment "+r.sn+" of level "+r.level),u.hls.trigger(c.Events.FRAG_LOADED,d)),u._handleFragmentLoadComplete(d))}}).catch(function(d){u.state!==kt&&u.state!==Ft&&(u.warn(d),u.resetFragmentLoading(r))})},a.flushMainBuffer=function(r,s,l){if(l===void 0&&(l=null),r-s){var u={startOffset:r,endOffset:s,type:l};this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,u)}},a._loadInitSegment=function(r,s){var l=this;this._doFragLoad(r,s).then(function(u){if(!u||l.fragContextChanged(r)||!l.levels)throw new Error("init load aborted");return u}).then(function(u){var d=l.hls,f=u.payload,g=r.decryptdata;if(f&&f.byteLength>0&&g&&g.key&&g.iv&&g.method==="AES-128"){var p=self.performance.now();return l.decrypter.decrypt(new Uint8Array(f),g.key.buffer,g.iv.buffer).then(function(m){var A=self.performance.now();return d.trigger(c.Events.FRAG_DECRYPTED,{frag:r,payload:m,stats:{tstart:p,tdecrypt:A}}),u.payload=m,u})}return u}).then(function(u){var d=l.fragCurrent,f=l.hls,g=l.levels;if(!g)throw new Error("init load aborted, missing levels");g[r.level].details;var p=r.stats;l.state=Ye,l.fragLoadError=0,r.data=new Uint8Array(u.payload),p.parsing.start=p.buffering.start=self.performance.now(),p.parsing.end=p.buffering.end=self.performance.now(),u.frag===d&&f.trigger(c.Events.FRAG_BUFFERED,{stats:p,frag:d,part:null,id:r.type}),l.tick()}).catch(function(u){l.state!==kt&&l.state!==Ft&&(l.warn(u),l.resetFragmentLoading(r))})},a.fragContextChanged=function(r){var s=this.fragCurrent;return!r||!s||r.level!==s.level||r.sn!==s.sn||r.urlId!==s.urlId},a.fragBufferedComplete=function(r,s){var l,u,d,f,g=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+r.type+" sn: "+r.sn+(s?" part: "+s.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level+" (frag:["+((l=r.startPTS)!=null?l:NaN).toFixed(3)+"-"+((u=r.endPTS)!=null?u:NaN).toFixed(3)+"] > buffer:"+(g?Wi(lt.getBuffered(g)):"(detached)")+")"),this.state=Ye,g&&(!this.loadedmetadata&&r.type==x.PlaylistLevelType.MAIN&&g.buffered.length&&((d=this.fragCurrent)===null||d===void 0?void 0:d.sn)===((f=this.fragPrevious)===null||f===void 0?void 0:f.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},a.seekToStartPos=function(){},a._handleFragmentLoadComplete=function(r){var s=this.transmuxer;if(s){var l=r.frag,u=r.part,d=r.partsLoaded,f=!d||d.length===0||d.some(function(p){return!p}),g=new yr(l.level,l.sn,l.stats.chunkCount+1,0,u?u.index:-1,!f);s.flush(g)}},a._handleFragmentLoadProgress=function(r){},a._doFragLoad=function(r,s,l,u){var d,f=this;if(l===void 0&&(l=null),!this.levels)throw new Error("frag load aborted, missing levels");var g=null;if(!r.encrypted||(d=r.decryptdata)!==null&&d!==void 0&&d.key?!r.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(r,s.encryptedFragments):(this.log("Loading key for "+r.sn+" of ["+s.startSN+"-"+s.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=Lr,this.fragCurrent=r,g=this.keyLoader.load(r).then(function(_){if(!f.fragContextChanged(_.frag))return f.hls.trigger(c.Events.KEY_LOADED,_),f.state===Lr&&(f.state=Ye),_}),this.hls.trigger(c.Events.KEY_LOADING,{frag:r}),this.throwIfFragContextChanged("KEY_LOADING")),l=Math.max(r.start,l||0),this.config.lowLatencyMode&&s){var p=s.partList;if(p&&u){l>r.end&&s.fragmentHint&&(r=s.fragmentHint);var m=this.getNextPart(p,r,l);if(m>-1){var A=p[m];return this.log("Loading part sn: "+r.sn+" p: "+A.index+" cc: "+r.cc+" of playlist ["+s.startSN+"-"+s.endSN+"] parts [0-"+m+"-"+(p.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(l.toFixed(3))),this.nextLoadPosition=A.start+A.duration,this.state=Xt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:r,part:p[m],targetBufferTime:l}),this.throwIfFragContextChanged("FRAG_LOADING parts"),g?g.then(function(_){return!_||f.fragContextChanged(_.frag)?null:f.doFragPartsLoad(r,p,m,u)}).catch(function(_){return f.handleFragLoadError(_)}):this.doFragPartsLoad(r,p,m,u).catch(function(_){return f.handleFragLoadError(_)})}if(!r.url||this.loadedEndOfParts(p,l))return Promise.resolve(null)}}this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(s?"of ["+s.startSN+"-"+s.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(l.toFixed(3))),(0,F.isFiniteNumber)(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=Xt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:r,targetBufferTime:l}),this.throwIfFragContextChanged("FRAG_LOADING");var L=this.config.progressive;return L&&g?g.then(function(_){return!_||f.fragContextChanged(_==null?void 0:_.frag)?null:f.fragmentLoader.load(r,u)}).catch(function(_){return f.handleFragLoadError(_)}):Promise.all([this.fragmentLoader.load(r,L?u:void 0),g]).then(function(_){var K=_[0];return!L&&K&&u&&u(K),K}).catch(function(_){return f.handleFragLoadError(_)})},a.throwIfFragContextChanged=function(r){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+r)},a.doFragPartsLoad=function(r,s,l,u){var d=this;return new Promise(function(f,g){var p=[];(function m(A){var L=s[A];d.fragmentLoader.loadPart(r,L,u).then(function(_){p[L.index]=_;var K=_.part;d.hls.trigger(c.Events.FRAG_LOADED,_);var z=s[A+1];if(!z||z.fragment!==r)return f({frag:r,part:K,partsLoaded:p});m(A+1)}).catch(g)})(l)})},a.handleFragLoadError=function(r){if("data"in r){var s=r.data;r.data&&s.details===E.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(s.frag,s.part):this.hls.trigger(c.Events.ERROR,s)}else this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.INTERNAL_EXCEPTION,err:r,fatal:!0});return null},a._handleTransmuxerFlush=function(r){var s=this.getCurrentContext(r);if(s&&this.state===_t){var l=s.frag,u=s.part,d=s.level,f=self.performance.now();l.stats.parsing.end=f,u&&(u.stats.parsing.end=f),this.updateLevelTiming(l,u,d,r.partial)}else this.fragCurrent||this.state===kt||this.state===Ft||(this.state=Ye)},a.getCurrentContext=function(r){var s=this.levels,l=r.level,u=r.sn,d=r.part;if(!s||!s[l])return this.warn("Levels object was unset while buffering fragment "+u+" of level "+l+". The current chunk will not be buffered."),null;var f=s[l],g=d>-1?function(m,A,L){if(!m||!m.details)return null;var _=m.details.partList;if(_)for(var K=_.length;K--;){var z=_[K];if(z.index===L&&z.fragment.sn===A)return z}return null}(f,u,d):null,p=g?g.fragment:function(m,A,L){if(!m||!m.details)return null;var _=m.details,K=_.fragments[A-_.startSN];return K||((K=_.fragmentHint)&&K.sn===A?K:A<_.startSN&&L&&L.sn===A?L:null)}(f,u,this.fragCurrent);return p?{frag:p,part:g,level:f}:null},a.bufferFragmentData=function(r,s,l,u){if(r&&this.state===_t){var d=r.data1,f=r.data2,g=d;if(d&&f&&(g=(0,ie.appendUint8Array)(d,f)),g&&g.length){var p={type:r.type,frag:s,part:l,chunkMeta:u,parent:s.type,data:g};this.hls.trigger(c.Events.BUFFER_APPENDING,p),r.dropped&&r.independent&&!l&&this.flushBufferGap(s)}}},a.flushBufferGap=function(r){var s=this.media;if(s)if(lt.isBuffered(s,s.currentTime)){var l=s.currentTime,u=lt.bufferInfo(s,l,0),d=r.duration,f=Math.min(2*this.config.maxFragLookUpTolerance,.25*d),g=Math.max(Math.min(r.start-f,u.end-f),l+f);r.start-g>f&&this.flushMainBuffer(g,r.start)}else this.flushMainBuffer(0,r.start)},a.getFwdBufferInfo=function(r,s){var l=this.config,u=this.getLoadPosition();if(!(0,F.isFiniteNumber)(u))return null;var d=lt.bufferInfo(r,u,l.maxBufferHole);if(d.len===0&&d.nextStart!==void 0){var f=this.fragmentTracker.getBufferedFrag(u,s);if(f&&d.nextStart<f.end)return lt.bufferInfo(r,u,Math.max(d.nextStart,l.maxBufferHole))}return d},a.getMaxBufferLength=function(r){var s,l=this.config;return s=r?Math.max(8*l.maxBufferSize/r,l.maxBufferLength):l.maxBufferLength,Math.min(s,l.maxMaxBufferLength)},a.reduceMaxBufferLength=function(r){var s=this.config,l=r||s.maxBufferLength;return s.maxMaxBufferLength>=l&&(s.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+s.maxMaxBufferLength+"s"),!0)},a.getNextFragment=function(r,s){var l=s.fragments,u=l.length;if(!u)return null;var d,f=this.config,g=l[0].start;if(s.live){var p=f.initialLiveManifestSize;if(u<p)return this.warn("Not enough fragments to start playback (have: "+u+", need: "+p+")"),null;s.PTSKnown||this.startFragRequested||this.startPosition!==-1||(d=this.getInitialLiveFragment(s,l),this.startPosition=d?this.hls.liveSyncPosition||d.start:r)}else r<=g&&(d=l[0]);if(!d){var m=f.lowLatencyMode?s.partEnd:s.fragmentEnd;d=this.getFragmentAtPosition(r,m,s)}return this.mapToInitFragWhenRequired(d)},a.mapToInitFragWhenRequired=function(r){return r==null||!r.initSegment||r!=null&&r.initSegment.data||this.bitrateTest?r:r.initSegment},a.getNextPart=function(r,s,l){for(var u=-1,d=!1,f=!0,g=0,p=r.length;g<p;g++){var m=r[g];if(f=f&&!m.independent,u>-1&&l<m.start)break;var A=m.loaded;A?u=-1:(d||m.independent||f)&&m.fragment===s&&(u=g),d=A}return u},a.loadedEndOfParts=function(r,s){var l=r[r.length-1];return l&&s>l.start&&l.loaded},a.getInitialLiveFragment=function(r,s){var l=this.fragPrevious,u=null;if(l){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),u=function(p,m,A){if(m===null||!Array.isArray(p)||!p.length||!(0,F.isFiniteNumber)(m)||m<(p[0].programDateTime||0)||m>=(p[p.length-1].endProgramDateTime||0))return null;A=A||0;for(var L=0;L<p.length;++L){var _=p[L];if(Vi(m,A,_))return _}return null}(s,l.endProgramDateTime,this.config.maxFragLookUpTolerance)),!u){var d=l.sn+1;if(d>=r.startSN&&d<=r.endSN){var f=s[d-r.startSN];l.cc===f.cc&&(u=f,this.log("Live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=function(p,m){return si(p,function(A){return A.cc<m?1:A.cc>m?-1:0})}(s,l.cc),u&&this.log("Live playlist, switching playlist, load frag with same CC: "+u.sn))}}else{var g=this.hls.liveSyncPosition;g!==null&&(u=this.getFragmentAtPosition(g,this.bitrateTest?r.fragmentEnd:r.edge,r))}return u},a.getFragmentAtPosition=function(r,s,l){var u,d=this.config,f=this.fragPrevious,g=l.fragments,p=l.endSN,m=l.fragmentHint,A=d.maxFragLookUpTolerance,L=!!(d.lowLatencyMode&&l.partList&&m);if(L&&m&&!this.bitrateTest&&(g=g.concat(m),p=m.sn),u=r<s?Tr(f,g,r,r>s-A?0:A):g[g.length-1]){var _=u.sn-l.startSN;if(this.fragmentTracker.getState(u)===me.OK&&(f=u),f&&u.sn===f.sn&&!L&&f&&u.level===f.level){var K=g[_+1];u.sn<p&&this.fragmentTracker.getState(K)!==me.OK?(this.log("SN "+u.sn+" just loaded, load next one: "+K.sn),u=K):u=null}}return u},a.synchronizeToLiveEdge=function(r){var s=this.config,l=this.media;if(l){var u=this.hls.liveSyncPosition,d=l.currentTime,f=r.fragments[0].start,g=r.edge,p=d>=f-s.maxFragLookUpTolerance&&d<=g;if(u!==null&&l.duration>u&&(d<u||!p)){var m=s.liveMaxLatencyDuration!==void 0?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*r.targetduration;(!p&&l.readyState<4||d<g-m)&&(this.loadedmetadata||(this.nextLoadPosition=u),l.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+g+", reset currentTime to : "+u.toFixed(3)),l.currentTime=u))}}},a.alignPlaylists=function(r,s){var l=this.levels,u=this.levelLastLoaded,d=this.fragPrevious,f=u!==null?l[u]:null,g=r.fragments.length;if(!g)return this.warn("No fragments in live playlist"),0;var p=r.fragments[0].start,m=!s,A=r.alignedSliding&&(0,F.isFiniteNumber)(p);if(m||!A&&!p){(function(_,K,z){K&&(function(Y,ee,Ee){if(function(ae,ye,fe){return!(!ye.details||!(fe.endCC>fe.startCC||ae&&ae.cc<fe.startCC))}(Y,Ee,ee)){var Se=function(ae,ye,fe){fe===void 0&&(fe=0);var Ge=ae.fragments,nt=ye.fragments;if(nt.length&&Ge.length){var Ue=ii(Ge,nt[0].cc);if(Ue&&(!Ue||Ue.startPTS))return Ue;k.logger.log("No frag in previous level to align on")}else k.logger.log("No fragments to align")}(Ee.details,ee);Se&&(0,F.isFiniteNumber)(Se.start)&&(k.logger.log("Adjusting PTS using last level due to CC increase within current level "+ee.url),Er(Se.start,ee))}}(_,z,K),!z.alignedSliding&&K.details&&function(Y,ee){if(ee.fragments.length&&Y.hasProgramDateTime&&ee.hasProgramDateTime){var Ee=ee.fragments[0].programDateTime,Se=Y.fragments[0].programDateTime,ae=(Se-Ee)/1e3+ee.fragments[0].start;ae&&(0,F.isFiniteNumber)(ae)&&(k.logger.log("Adjusting PTS using programDateTime delta "+(Se-Ee)+"ms, sliding:"+ae.toFixed(3)+" "+Y.url+" "),Er(ae,Y))}}(z,K.details),z.alignedSliding||!K.details||z.skippedSegments||w(K.details,z))})(d,f,r);var L=r.fragments[0].start;return this.log("Live playlist sliding: "+L.toFixed(2)+" start-sn: "+(s?s.startSN:"na")+"->"+r.startSN+" prev-sn: "+(d?d.sn:"na")+" fragments: "+g),L}return p},a.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,3*r.partTarget)},a.setStartPosition=function(r,s){var l=this.startPosition;if(l<s&&(l=-1),l===-1||this.lastCurrentTime===-1){var u=r.startTimeOffset;(0,F.isFiniteNumber)(u)?(l=s+u,u<0&&(l+=r.totalduration),l=Math.min(Math.max(s,l),s+r.totalduration),this.log("Start time offset "+u+" found in playlist, adjust startPosition to "+l),this.startPosition=l):r.live?l=this.hls.liveSyncPosition||s:this.startPosition=l=0,this.lastCurrentTime=l}this.nextLoadPosition=l},a.getLoadPosition=function(){var r=this.media,s=0;return this.loadedmetadata&&r?s=r.currentTime:this.nextLoadPosition&&(s=this.nextLoadPosition),s},a.handleFragLoadAborted=function(r,s){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(s?" part"+s.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},a.resetFragmentLoading=function(r){this.fragCurrent&&(this.fragContextChanged(r)||this.state===zt)||(this.state=Ye)},a.onFragmentOrKeyLoadError=function(r,s){if(s.fatal)return this.stopLoad(),void(this.state=Ft);var l=this.config;if(s.chunkMeta){var u=this.getCurrentContext(s.chunkMeta);u&&(s.frag=u.frag,s.levelRetry=!0,this.fragLoadError=l.fragLoadingMaxRetry)}var d=s.frag;if(d&&d.type===r)if(this.fragCurrent,this.fragLoadError+1<=l.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var f=Math.min(Math.pow(2,this.fragLoadError)*l.fragLoadingRetryDelay,l.fragLoadingMaxRetryTimeout);this.warn("Fragment "+d.sn+" of "+r+" "+d.level+" failed to load, retrying in "+f+"ms"),this.retryDate=self.performance.now()+f,this.fragLoadError++,this.state=zt}else s.levelRetry?(r===x.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Ye):(k.logger.error(s.details+" reaches max retry, redispatch as fatal ..."),s.fatal=!0,this.hls.stopLoad(),this.state=Ft)},a.afterBufferFlushed=function(r,s,l){if(r){var u=lt.getBuffered(r);this.fragmentTracker.detectEvictedFragments(s,u,l),this.state===ir&&this.resetLoadingState()}},a.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Ye},a.resetStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var s=this.levels?this.levels[r].details:null;s!=null&&s.live?(this.startPosition=-1,this.setStartPosition(s,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},a.updateLevelTiming=function(r,s,l,u){var d=this,f=l.details;Object.keys(r.elementaryStreams).reduce(function(g,p){var m=r.elementaryStreams[p];if(m){var A=m.endPTS-m.startPTS;if(A<=0)return d.warn("Could not parse fragment "+r.sn+" "+p+" duration reliably ("+A+")"),g||!1;var L=u?0:I(f,r,m.startPTS,m.endPTS,m.startDTS,m.endDTS);return d.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:f,level:l,drift:L,type:p,frag:r,start:m.startPTS,end:m.endPTS}),!0}return g},!1)||(this.warn("Found no media in fragment "+r.sn+" of level "+l.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=rr,this.hls.trigger(c.Events.FRAG_PARSED,{frag:r,part:s})},a.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=t,(n=[{key:"state",get:function(){return this._state},set:function(r){var s=this._state;s!==r&&(this._state=r,this.log(s+"->"+r))}}])&&qi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ht);function Dr(){return self.MediaSource||self.WebKitMediaSource}function oi(){return self.SourceBuffer||self.WebKitSourceBuffer}var kr=function(){var h=ENTRY_MODULE,o={},e=function i(n){var a=o[n];if(a!==void 0)return a.exports;var r=o[n]={exports:{}};return h[n].call(r.exports,r,r.exports,i),r.exports};e.m=h,e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,{a:n}),n},e.d=function(i,n){for(var a in n)e.o(n,a)&&!e.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:n[a]})},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var t=e(ENTRY_MODULE);return t.default||t}.toString().split("ENTRY_MODULE"),li="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function ui(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Xi(h,o,e){var t={};t[e]=[];var i=o.toString().replace(/^"[^"]+"/,"function"),n=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return t;for(var a,r=n[1],s=new RegExp("(\\\\n|\\W)"+ui(r)+li,"g");a=s.exec(i);)a[3]!=="dll-reference"&&t[e].push(a[3]);for(s=new RegExp("\\("+ui(r)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+li,"g");a=s.exec(i);)h[a[2]]||(t[e].push(a[1]),h[a[2]]=q(a[1]).m),t[a[2]]=t[a[2]]||[],t[a[2]].push(a[4]);for(var l,u=Object.keys(t),d=0;d<u.length;d++)for(var f=0;f<t[u[d]].length;f++)l=t[u[d]][f],isNaN(1*l)||(t[u[d]][f]=1*t[u[d]][f]);return t}function zi(h){return Object.keys(h).reduce(function(o,e){return o||h[e].length>0},!1)}function hi(h,o,e,t){var i=h[t].map(function(n){return'"'+n+'": '+o[t][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return kr[0]+"{"+i+"}"+kr[1]+'"'+e+'"'+kr[2]}var jt=q(544),Rr=q(729),Qi=q.n(Rr),Ir=Dr()||{isTypeSupported:function(){return!1}},di=function(){function h(e,t,i,n){var a=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var s=function(f,g){(g=g||{}).frag=a.frag,g.id=a.id,a.hls.trigger(f,g)};this.observer=new Rr.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,s),this.observer.on(c.Events.ERROR,s);var l={mp4:Ir.isTypeSupported("video/mp4"),mpeg:Ir.isTypeSupported("audio/mpeg"),mp3:Ir.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){var d;k.logger.log("demuxing in webworker");try{d=this.worker=function(f,g){g=g||{};var p={main:q.m},m=g.all?{main:Object.keys(p.main)}:function(z,Y){for(var ee={main:[Y]},Ee={main:[]},Se={main:{}};zi(ee);)for(var ae=Object.keys(ee),ye=0;ye<ae.length;ye++){var fe=ae[ye],Ge=ee[fe].pop();if(Se[fe]=Se[fe]||{},!Se[fe][Ge]&&z[fe][Ge]){Se[fe][Ge]=!0,Ee[fe]=Ee[fe]||[],Ee[fe].push(Ge);for(var nt=Xi(z,z[fe][Ge],fe),Ue=Object.keys(nt),He=0;He<Ue.length;He++)ee[Ue[He]]=ee[Ue[He]]||[],ee[Ue[He]]=ee[Ue[He]].concat(nt[Ue[He]])}}return Ee}(p,f),A="";Object.keys(m).filter(function(z){return z!=="main"}).forEach(function(z){for(var Y=0;m[z][Y];)Y++;m[z].push(Y),p[z][Y]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",A=A+"var "+z+" = ("+hi(m,p,Y,modules)+`)();
`}),A=A+"new (("+hi(m,p,f,"main")+")())(self);";var L=new window.Blob([A],{type:"text/javascript"}),_=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(L),K=new window.Worker(_);return K.objectURL=_,K}(182),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(f){a.useWorker=!1,k.logger.warn("Exception in webworker, fallback to inline"),a.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(f.message+"  ("+f.filename+":"+f.lineno+")")})},d.postMessage({cmd:"init",typeSupported:l,vendor:u,id:t,config:JSON.stringify(r)})}catch(f){k.logger.warn("Error in worker:",f),k.logger.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new jt.default(this.observer,l,r,u,t),this.worker=null}}else this.transmuxer=new jt.default(this.observer,l,r,u,t)}var o=h.prototype;return o.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},o.push=function(e,t,i,n,a,r,s,l,u,d){var f,g,p=this;u.transmuxing.start=self.performance.now();var m=this.transmuxer,A=this.worker,L=r?r.start:a.start,_=a.decryptdata,K=this.frag,z=!(K&&a.cc===K.cc),Y=!(K&&u.level===K.level),ee=K?u.sn-K.sn:-1,Ee=this.part?u.part-this.part.index:-1,Se=ee===0&&u.id>1&&u.id===(K==null?void 0:K.stats.chunkCount),ae=!Y&&(ee===1||ee===0&&(Ee===1||Se&&Ee<=0)),ye=self.performance.now();(Y||ee||a.stats.parsing.start===0)&&(a.stats.parsing.start=ye),!r||!Ee&&ae||(r.stats.parsing.start=ye);var fe=!(K&&((f=a.initSegment)===null||f===void 0?void 0:f.url)===((g=K.initSegment)===null||g===void 0?void 0:g.url)),Ge=new jt.TransmuxState(z,ae,l,Y,L,fe);if(!ae||z||fe){k.logger.log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+z+`
        trackSwitch: `+Y+`
        contiguous: `+ae+`
        accurateTimeOffset: `+l+`
        timeOffset: `+L+`
        initSegmentChange: `+fe);var nt=new jt.TransmuxConfig(i,n,t,s,d);this.configureTransmuxer(nt)}if(this.frag=a,this.part=r,A)A.postMessage({cmd:"demux",data:e,decryptdata:_,chunkMeta:u,state:Ge},e instanceof ArrayBuffer?[e]:[]);else if(m){var Ue=m.push(e,_,u,Ge);(0,jt.isPromise)(Ue)?(m.async=!0,Ue.then(function(He){p.handleTransmuxComplete(He)}).catch(function(He){p.transmuxerError(He,u,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(Ue))}},o.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(i){var a=i.flush(e);(0,jt.isPromise)(a)||i.async?((0,jt.isPromise)(a)||(a=Promise.resolve(a)),a.then(function(r){t.handleFlushResult(r,e)}).catch(function(r){t.transmuxerError(r,e,"transmuxer-interface flush error")})):this.handleFlushResult(a,e)}},o.transmuxerError=function(e,t,i){this.hls&&this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i})},o.handleFlushResult=function(e,t){var i=this;e.forEach(function(n){i.handleTransmuxComplete(n)}),this.onFlush(t)},o.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":k.logger[t.data.logType]&&k.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},o.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},o.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},h}(),$i=function(){function h(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var o=h.prototype;return o.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},o.poll=function(e,t){var i=this.config,n=this.media,a=this.stalled;if(n!==null){var r=n.currentTime,s=n.seeking,l=this.seeking&&!s,u=!this.seeking&&s;if(this.seeking=s,r===e){if((u||l)&&(this.stalled=null),!(n.paused&&!s||n.ended||n.playbackRate===0)&&lt.getBuffered(n).length){var d=lt.bufferInfo(n,r,0),f=d.len>0,g=d.nextStart||0;if(f||g){if(s){var p=d.len>2,m=!g||t&&t.start<=r||g-r>2&&!this.fragmentTracker.getPartialFragment(r);if(p||m)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var A,L=Math.max(g,d.start||0)-r,_=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,K=!(_==null||(A=_.details)===null||A===void 0)&&A.live?2*_.details.targetduration:2;if(L>0&&L<=K)return void this._trySkipBufferHole(null)}var z=self.performance.now();if(a!==null){var Y=z-a;if(s||!(Y>=250)||(this._reportStall(d),this.media)){var ee=lt.bufferInfo(n,r,i.maxBufferHole);this._tryFixBufferStall(ee,Y)}}else this.stalled=z}}}else if(this.moved=!0,a!==null){if(this.stallReported){var Ee=self.performance.now()-a;k.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(Ee)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},o._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,a=this.media;if(a!==null){var r=a.currentTime,s=n.getPartialFragment(r);if(s&&(this._trySkipBufferHole(s)||!this.media))return;e.len>i.maxBufferHole&&t>1e3*i.highBufferWatchdogPeriod&&(k.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},o._reportStall=function(e){var t=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,k.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},o._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(n===null)return 0;for(var a=n.currentTime,r=0,s=lt.getBuffered(n),l=0;l<s.length;l++){var u=s.start(l);if(a+t.maxBufferHole>=r&&a<u){var d=Math.max(u+.05,n.currentTime+.1);return k.logger.warn("skipping hole, adjusting currentTime from "+a+" to "+d),this.moved=!0,this.stalled=null,n.currentTime=d,e&&i.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+d,frag:e}),d}r=s.end(l)}return 0},o._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(i!==null){var a=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var r=a+(n+1)*e.nudgeOffset;k.logger.warn("Nudging 'currentTime' from "+a+" to "+r),i.currentTime=r,t.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else k.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},h}();function Zi(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function Cr(h,o){return Cr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Cr(h,o)}var Ji=function(h){var o,e;function t(r,s,l){var u;return(u=h.call(this,r,s,l,"[stream-controller]")||this).audioCodecSwap=!1,u.gapController=null,u.level=-1,u._forceStartLoad=!1,u.altAudio=!1,u.audioOnly=!1,u.fragPlaying=null,u.onvplaying=null,u.onvseeked=null,u.fragLastKbps=0,u.couldBacktrack=!1,u.backtrackFragment=null,u.audioCodecSwitch=!1,u.videoBuffer=null,u._registerListeners(),u}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,Cr(o,e);var i,n,a=t.prototype;return a._registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(c.Events.ERROR,this.onError,this),r.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(c.Events.ERROR,this.onError,this),r.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},a.startLoad=function(r){if(this.levels){var s=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=l.startLevel;u===-1&&(l.config.testBandwidth&&this.levels.length>1?(u=0,this.bitrateTest=!0):u=l.nextAutoLevel),this.level=l.nextLoadLevel=u,this.loadedmetadata=!1}s>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),r=s),this.state=Ye,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=kt},a.stopLoad=function(){this._forceStartLoad=!1,h.prototype.stopLoad.call(this)},a.doTick=function(){switch(this.state){case Ye:this.doTickIdle();break;case Qt:var r,s=this.levels,l=this.level,u=s==null||(r=s[l])===null||r===void 0?void 0:r.details;if(u&&(!u.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(u))break;this.state=Ye;break}break;case zt:var d,f=self.performance.now(),g=this.retryDate;(!g||f>=g||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=Ye)}this.onTickEnd()},a.onTickEnd=function(){h.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},a.doTickIdle=function(){var r=this.hls,s=this.levelLastLoaded,l=this.levels,u=this.media,d=r.config,f=r.nextLoadLevel;if(s!==null&&(u||!this.startFragRequested&&d.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&l&&l[f]){var g=l[f],p=this.getMainFwdBufferInfo();if(p!==null){var m=this.getLevelDetails();if(m&&this._streamEnded(p,m)){var A={};return this.altAudio&&(A.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,A),void(this.state=ir)}this.level=r.nextLoadLevel=f;var L=g.details;if(!L||this.state===Qt||L.live&&this.levelLastLoaded!==f)return this.level=f,void(this.state=Qt);if(!(p.len>=this.getMaxBufferLength(g.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>p.end&&(this.backtrackFragment=null);var _=this.backtrackFragment?this.backtrackFragment.start:p.end,K=this.getNextFragment(_,L);if(this.couldBacktrack&&!this.fragPrevious&&K&&K.sn!=="initSegment"&&this.fragmentTracker.getState(K)!==me.OK){var z,Y=((z=this.backtrackFragment)!=null?z:K).sn-L.startSN,ee=L.fragments[Y-1];ee&&K.cc===ee.cc&&(K=ee,this.fragmentTracker.removeFragment(ee))}else this.backtrackFragment&&p.len&&(this.backtrackFragment=null);if(K&&this.fragmentTracker.getState(K)===me.OK&&this.nextLoadPosition>_){var Ee=this.audioOnly&&!this.altAudio?U.ElementaryStreamTypes.AUDIO:U.ElementaryStreamTypes.VIDEO,Se=(Ee===U.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Se&&this.afterBufferFlushed(Se,Ee,x.PlaylistLevelType.MAIN),K=this.getNextFragment(this.nextLoadPosition,L)}K&&(!K.initSegment||K.initSegment.data||this.bitrateTest||(K=K.initSegment),this.loadFragment(K,L,_))}}}},a.loadFragment=function(r,s,l){var u,d=this.fragmentTracker.getState(r);this.fragCurrent=r,d===me.NOT_LOADED?r.sn==="initSegment"?this._loadInitSegment(r,s):this.bitrateTest?(this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r,s)):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,s,l)):d===me.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((u=this.media)===null||u===void 0?void 0:u.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},a.getAppendedFrag=function(r){var s=this.fragmentTracker.getAppendedFrag(r,x.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},a.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,x.PlaylistLevelType.MAIN)},a.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},a.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function(){var r=this.levels,s=this.media;if(s!=null&&s.readyState){var l,u=this.getAppendedFrag(s.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!s.paused&&r){var d=r[this.hls.nextLoadLevel],f=this.fragLastKbps;l=f&&this.fragCurrent?this.fragCurrent.duration*d.maxBitrate/(1e3*f)+1:0}else l=0;var g=this.getBufferedFrag(s.currentTime+l);if(g){var p=this.followingBufferedFrag(g);if(p){this.abortCurrentFrag();var m=p.maxStartPTS?p.maxStartPTS:p.start,A=p.duration,L=Math.max(g.end,m+Math.min(Math.max(A-this.config.maxFragLookUpTolerance,.5*A),.75*A));this.flushMainBuffer(L,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r&&r.abortRequests(),this.state){case Lr:case Xt:case zt:case _t:case rr:this.state=Ye}this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function(r,s){h.prototype.flushMainBuffer.call(this,r,s,this.altAudio?"video":null)},a.onMediaAttached=function(r,s){h.prototype.onMediaAttached.call(this,r,s);var l=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),l.addEventListener("playing",this.onvplaying),l.addEventListener("seeked",this.onvseeked),this.gapController=new $i(this.config,l,this.fragmentTracker,this.hls)},a.onMediaDetaching=function(){var r=this.media;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),h.prototype.onMediaDetaching.call(this)},a.onMediaPlaying=function(){this.tick()},a.onMediaSeeked=function(){var r=this.media,s=r?r.currentTime:null;(0,F.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},a.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},a.onManifestParsed=function(r,s){var l,u,d,f=!1,g=!1;s.levels.forEach(function(p){(l=p.audioCodec)&&(l.indexOf("mp4a.40.2")!==-1&&(f=!0),l.indexOf("mp4a.40.5")!==-1&&(g=!0))}),this.audioCodecSwitch=f&&g&&typeof((d=oi())==null||(u=d.prototype)===null||u===void 0?void 0:u.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},a.onLevelLoading=function(r,s){var l=this.levels;if(l&&this.state===Ye){var u=l[s.level];(!u.details||u.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(u.details))&&(this.state=Qt)}},a.onLevelLoaded=function(r,s){var l,u=this.levels,d=s.level,f=s.details,g=f.totalduration;if(u){this.log("Level "+d+" loaded ["+f.startSN+","+f.endSN+"], cc ["+f.startCC+", "+f.endCC+"] duration:"+g);var p=this.fragCurrent;!p||this.state!==Xt&&this.state!==zt||p.level!==s.level&&p.loader&&(this.state=Ye,this.backtrackFragment=null,p.abortRequests());var m=u[d],A=0;if(f.live||(l=m.details)!==null&&l!==void 0&&l.live){if(f.fragments[0]||(f.deltaUpdateFailed=!0),f.deltaUpdateFailed)return;A=this.alignPlaylists(f,m.details)}if(m.details=f,this.levelLastLoaded=d,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:f,level:d}),this.state===Qt){if(this.waitForCdnTuneIn(f))return;this.state=Ye}this.startFragRequested?f.live&&this.synchronizeToLiveEdge(f):this.setStartPosition(f,A),this.tick()}else this.warn("Levels were reset while loading level "+d)},a._handleFragmentLoadProgress=function(r){var s,l=r.frag,u=r.part,d=r.payload,f=this.levels;if(f){var g=f[l.level],p=g.details;if(p){var m=g.videoCodec,A=p.PTSKnown||!p.live,L=(s=l.initSegment)===null||s===void 0?void 0:s.data,_=this._getAudioCodec(g),K=this.transmuxer=this.transmuxer||new di(this.hls,x.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),z=u?u.index:-1,Y=z!==-1,ee=new yr(l.level,l.sn,l.stats.chunkCount,d.byteLength,z,Y),Ee=this.initPTS[l.cc];K.push(d,L,_,m,l,u,p.totalduration,A,ee,Ee)}else this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered")},a.onAudioTrackSwitching=function(r,s){var l=this.altAudio,u=!!s.url,d=s.id;if(!u){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;f&&(this.log("Switching to main audio track, cancel main fragment load"),f.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var g=this.hls;l&&g.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),g.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:d})}},a.onAudioTrackSwitched=function(r,s){var l=s.id,u=!!this.hls.audioTracks[l].url;if(u){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=u,this.tick()},a.onBufferCreated=function(r,s){var l,u,d=s.tracks,f=!1;for(var g in d){var p=d[g];if(p.id==="main"){if(u=g,l=p,g==="video"){var m=d[g];m&&(this.videoBuffer=m.buffer)}}else f=!0}f&&l?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=l.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function(r,s){var l=s.frag,u=s.part;if(!l||l.type===x.PlaylistLevelType.MAIN){if(this.fragContextChanged(l))return this.warn("Fragment "+l.sn+(u?" p: "+u.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===rr&&(this.state=Ye));var d=u?u.stats:l.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),l.sn!=="initSegment"&&(this.fragPrevious=l),this.fragBufferedComplete(l,u)}},a.onError=function(r,s){if(s.type!==E.ErrorTypes.KEY_SYSTEM_ERROR)switch(s.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.FRAG_PARSING_ERROR:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x.PlaylistLevelType.MAIN,s);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Ft&&(s.fatal?(this.warn(""+s.details),this.state=Ft):s.levelRetry||this.state!==Qt||(this.state=Ye));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===_t||this.state===rr)){var l=!0,u=this.getFwdBufferInfo(this.media,x.PlaylistLevelType.MAIN);u&&u.len>.5&&(l=!this.reduceMaxBufferLength(u.len)),l&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(x.PlaylistLevelType.MAIN,s)},a.checkBuffer=function(){var r=this.media,s=this.gapController;if(r&&s&&r.readyState){if(this.loadedmetadata||!lt.getBuffered(r).length){var l=this.state!==Ye?this.fragCurrent:null;s.poll(this.lastCurrentTime,l)}this.lastCurrentTime=r.currentTime}},a.onFragLoadEmergencyAborted=function(){this.state=Ye,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},a.onBufferFlushed=function(r,s){var l=s.type;if(l!==U.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var u=(l===U.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(u,l,x.PlaylistLevelType.MAIN)}},a.onLevelsUpdated=function(r,s){this.levels=s.levels},a.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function(){var r=this.media;if(r){var s=r.currentTime,l=this.startPosition;if(l>=0&&s<l){if(r.seeking)return void this.log("could not seek to "+l+", already seeking at "+s);var u=lt.getBuffered(r),d=(u.length?u.start(0):0)-l;d>0&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+d+" to match buffer start"),l+=d,this.startPosition=l),this.log("seek to target start position "+l+" from current time "+s),r.currentTime=l}}},a._getAudioCodec=function(r){var s=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s=s.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),s},a._loadBitrateTestFrag=function(r,s){var l=this;r.bitrateTest=!0,this._doFragLoad(r,s).then(function(u){var d=l.hls;if(u&&!l.fragContextChanged(r)){l.fragLoadError=0,l.state=Ye,l.startFragRequested=!1,l.bitrateTest=!1;var f=r.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),d.trigger(c.Events.FRAG_LOADED,u),r.bitrateTest=!1}})},a._handleTransmuxComplete=function(r){var s,l="main",u=this.hls,d=r.remuxResult,f=r.chunkMeta,g=this.getCurrentContext(f);if(!g)return this.warn("The loading context changed while buffering fragment "+f.sn+" of level "+f.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(f.level);var p=g.frag,m=g.part,A=g.level,L=d.video,_=d.text,K=d.id3,z=d.initSegment,Y=A.details,ee=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(p)){if(this.state=_t,z){z.tracks&&(this._bufferInitSegment(A,z.tracks,p,f),u.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:l,tracks:z.tracks}));var Ee=z.initPTS,Se=z.timescale;(0,F.isFiniteNumber)(Ee)&&(this.initPTS[p.cc]=Ee,u.trigger(c.Events.INIT_PTS_FOUND,{frag:p,id:l,initPTS:Ee,timescale:Se}))}if(L&&d.independent!==!1){if(Y){var ae=L.startPTS,ye=L.endPTS,fe=L.startDTS,Ge=L.endDTS;if(m)m.elementaryStreams[L.type]={startPTS:ae,endPTS:ye,startDTS:fe,endDTS:Ge};else if(L.firstKeyFrame&&L.independent&&f.id===1&&(this.couldBacktrack=!0),L.dropped&&L.independent){var nt=this.getMainFwdBufferInfo();if((nt?nt.end:this.getLoadPosition())+this.config.maxBufferHole<(L.firstKeyFramePTS?L.firstKeyFramePTS:ae)-this.config.maxBufferHole)return void this.backtrack(p);p.setElementaryStreamInfo(L.type,p.start,ye,p.start,Ge,!0)}p.setElementaryStreamInfo(L.type,ae,ye,fe,Ge),this.backtrackFragment&&(this.backtrackFragment=p),this.bufferFragmentData(L,p,m,f)}}else if(d.independent===!1)return void this.backtrack(p);if(ee){var Ue=ee.startPTS,He=ee.endPTS,$e=ee.startDTS,Tt=ee.endDTS;m&&(m.elementaryStreams[U.ElementaryStreamTypes.AUDIO]={startPTS:Ue,endPTS:He,startDTS:$e,endDTS:Tt}),p.setElementaryStreamInfo(U.ElementaryStreamTypes.AUDIO,Ue,He,$e,Tt),this.bufferFragmentData(ee,p,m,f)}if(Y&&K!=null&&(s=K.samples)!==null&&s!==void 0&&s.length){var ft={id:l,frag:p,details:Y,samples:K.samples};u.trigger(c.Events.FRAG_PARSING_METADATA,ft)}if(Y&&_){var ut={id:l,frag:p,details:Y,samples:_.samples};u.trigger(c.Events.FRAG_PARSING_USERDATA,ut)}}},a._bufferInitSegment=function(r,s,l,u){var d=this;if(this.state===_t){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var f=s.audio,g=s.video,p=s.audiovideo;if(f){var m=r.audioCodec,A=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(m&&(m=m.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),f.metadata.channelCount!==1&&A.indexOf("firefox")===-1&&(m="mp4a.40.5")),A.indexOf("android")!==-1&&f.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log("Android: force audio codec to "+m)),r.audioCodec&&r.audioCodec!==m&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+m+'"'),f.levelCodec=m,f.id="main",this.log("Init audio buffer, container:"+f.container+", codecs[selected/level/parsed]=["+(m||"")+"/"+(r.audioCodec||"")+"/"+f.codec+"]")}g&&(g.levelCodec=r.videoCodec,g.id="main",this.log("Init video buffer, container:"+g.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+g.codec+"]")),p&&this.log("Init audiovideo buffer, container:"+p.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+p.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(L){var _=s[L].initSegment;_!=null&&_.byteLength&&d.hls.trigger(c.Events.BUFFER_APPENDING,{type:L,data:_,frag:l,part:null,chunkMeta:u,parent:l.type})}),this.tick()}},a.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,x.PlaylistLevelType.MAIN)},a.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=Ye},a.checkFragmentChanged=function(){var r=this.media,s=null;if(r&&r.readyState>1&&r.seeking===!1){var l=r.currentTime;if(lt.isBuffered(r,l)?s=this.getAppendedFrag(l):lt.isBuffered(r,l+.1)&&(s=this.getAppendedFrag(l+.1)),s){this.backtrackFragment=null;var u=this.fragPlaying,d=s.level;u&&s.sn===u.sn&&u.level===d&&s.urlId===u.urlId||(this.fragPlaying=s,this.hls.trigger(c.Events.FRAG_CHANGED,{frag:s}),u&&u.level===d||this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:d}))}}},i=t,(n=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var s=r.currentTime,l=this.currentFrag;if(l&&(0,F.isFiniteNumber)(s)&&(0,F.isFiniteNumber)(l.programDateTime)){var u=l.programDateTime+1e3*(s-l.start);return new Date(u)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&Zi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ar);const hr=function(){function h(e,t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var o=h.prototype;return o.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},h}(),en=function(){function h(e,t,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new hr(e),this.fast_=new hr(t)}var o=h.prototype;return o.update=function(e,t){var i=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new hr(e,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new hr(t,n.getEstimate(),n.getTotalWeight()))},o.sample=function(e,t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},o.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},o.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},o.destroy=function(){},h}();function tn(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}const rn=function(){function h(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var n=i.config;this.bwEstimator=new en(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var o,e,t=h.prototype;return t.registerListeners=function(){var i=this.hls;i.on(c.Events.FRAG_LOADING,this.onFragLoading,this),i.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(c.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var i=this.hls;i.off(c.Events.FRAG_LOADING,this.onFragLoading,this),i.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(c.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(i,n){var a,r=n.frag;r.type===x.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=(a=n.part)!=null?a:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(i,n){var a=this.hls.config;n.details.live?this.bwEstimator.update(a.abrEwmaSlowLive,a.abrEwmaFastLive):this.bwEstimator.update(a.abrEwmaSlowVoD,a.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var i=this.fragCurrent,n=this.partCurrent,a=this.hls,r=a.autoLevelEnabled,s=a.media;if(i&&s){var l=n?n.stats:i.stats,u=n?n.duration:i.duration;if(l.aborted||l.loaded&&l.loaded===l.total||i.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!s.paused&&s.playbackRate&&s.readyState){var d=a.mainForwardBufferInfo;if(d!==null){var f=performance.now()-l.loading.start,g=Math.abs(s.playbackRate);if(!(f<=500*u/g)){var p=l.loaded&&l.loading.first,m=this.bwEstimator.getEstimate(),A=a.levels,L=a.minAutoLevel,_=A[i.level],K=l.total||Math.max(l.loaded,Math.round(u*_.maxBitrate/8)),z=p?1e3*l.loaded/f:0,Y=z?(K-l.loaded)/z:8*K/m,ee=d.len/g;if(!(Y<=ee)){var Ee,Se=Number.POSITIVE_INFINITY;for(Ee=i.level-1;Ee>L;Ee--){var ae=A[Ee].maxBitrate;if((Se=z?u*ae/(6.4*z):u*ae/m)<ee)break}Se>=Y||(k.logger.warn("Fragment "+i.sn+(n?" part "+n.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Ee+`
      Current BW estimate: `+((0,F.isFiniteNumber)(m)?(m/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+Y.toFixed(3)+` s
      Estimated load time for the next fragment: `+Se.toFixed(3)+` s
      Time to underbuffer: `+ee.toFixed(3)+" s"),a.nextLoadLevel=Ee,p&&this.bwEstimator.sample(f,l.loaded),this.clearTimer(),(i.loader||i.keyLoader)&&(this.fragCurrent=this.partCurrent=null,i.abortRequests()),a.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:l}))}}}}}},t.onFragLoaded=function(i,n){var a=n.frag,r=n.part;if(a.type===x.PlaylistLevelType.MAIN&&(0,F.isFiniteNumber)(a.sn)){var s=r?r.stats:a.stats,l=r?r.duration:a.duration;if(this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[a.level],d=(u.loaded?u.loaded.bytes:0)+s.loaded,f=(u.loaded?u.loaded.duration:0)+l;u.loaded={bytes:d,duration:f},u.realBitrate=Math.round(8*d/f)}if(a.bitrateTest){var g={stats:s,frag:a,part:r,id:a.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,g)}}},t.onFragBuffered=function(i,n){var a=n.frag,r=n.part,s=r?r.stats:a.stats;if(!s.aborted&&a.type===x.PlaylistLevelType.MAIN&&a.sn!=="initSegment"){var l=s.parsing.end-s.loading.start;this.bwEstimator.sample(l,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),a.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},t.onError=function(i,n){var a;if(((a=n.frag)===null||a===void 0?void 0:a.type)===x.PlaylistLevelType.MAIN){if(n.type===E.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(n.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var i=this.fragCurrent,n=this.partCurrent,a=this.hls,r=a.maxAutoLevel,s=a.config,l=a.minAutoLevel,u=a.media,d=n?n.duration:i?i.duration:0,f=u&&u.playbackRate!==0?Math.abs(u.playbackRate):1,g=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,p=a.mainForwardBufferInfo,m=(p?p.len:0)/f,A=this.findBestLevel(g,l,r,m,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(A>=0)return A;k.logger.trace((m?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var L=d?Math.min(d,s.maxStarvationDelay):s.maxStarvationDelay,_=s.abrBandWidthFactor,K=s.abrBandWidthUpFactor;if(!m){var z=this.bitrateTestDelay;z&&(L=(d?Math.min(d,s.maxLoadingDelay):s.maxLoadingDelay)-z,k.logger.trace("bitrate test took "+Math.round(1e3*z)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*L)+" ms"),_=K=1)}return A=this.findBestLevel(g,l,r,m+L,_,K),Math.max(A,0)},t.findBestLevel=function(i,n,a,r,s,l){for(var u,d=this.fragCurrent,f=this.partCurrent,g=this.lastLoadedFragLevel,p=this.hls.levels,m=p[g],A=!(m==null||(u=m.details)===null||u===void 0||!u.live),L=m==null?void 0:m.codecSet,_=f?f.duration:d?d.duration:0,K=a;K>=n;K--){var z=p[K];if(z&&(!L||z.codecSet===L)){var Y,ee=z.details,Ee=(f?ee==null?void 0:ee.partTarget:ee==null?void 0:ee.averagetargetduration)||_;Y=K<=g?s*i:l*i;var Se=p[K].maxBitrate,ae=Se*Ee/Y;if(k.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+K+"/"+Math.round(Y)+"/"+Se+"/"+Ee+"/"+r+"/"+ae),Y>Se&&(ae===0||!(0,F.isFiniteNumber)(ae)||A&&!this.bitrateTestDelay||ae<r))return K}}return-1},o=h,(e=[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,n=this.bwEstimator;if(i!==-1&&!n.canEstimate())return i;var a=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[a].loadError?i:(i!==-1&&(a=Math.min(i,a)),a)},set:function(i){this._nextAutoLevel=i}}])&&tn(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),h}();var fi=function(){function h(){this.chunks=[],this.dataLength=0}var o=h.prototype;return o.push=function(e){this.chunks.push(e),this.dataLength+=e.length},o.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=t.length===1?t[0]:function(n,a){for(var r=new Uint8Array(a),s=0,l=0;l<n.length;l++){var u=n[l];r.set(u,s),s+=u.length}return r}(t,i),this.reset(),e):new Uint8Array(0)},o.reset=function(){this.chunks.length=0,this.dataLength=0},h}();function dr(){return dr=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},dr.apply(this,arguments)}function _r(h,o){return _r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_r(h,o)}var nn=function(h){var o,e;function t(n,a,r){var s;return(s=h.call(this,n,a,r,"[audio-stream-controller]")||this).videoBuffer=null,s.videoTrackCC=-1,s.waitingVideoCC=-1,s.audioSwitch=!1,s.trackId=-1,s.waitingData=null,s.mainDetails=null,s.bufferFlushed=!1,s.cachedTrackLoadedData=null,s._registerListeners(),s}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,_r(o,e);var i=t.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var n=this.hls;n.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(c.Events.ERROR,this.onError,this),n.on(c.Events.BUFFER_RESET,this.onBufferReset,this),n.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var n=this.hls;n.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(c.Events.ERROR,this.onError,this),n.off(c.Events.BUFFER_RESET,this.onBufferReset,this),n.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(n,a){var r=a.frag,s=a.id,l=a.initPTS;if(s==="main"){var u=r.cc;this.initPTS[r.cc]=l,this.log("InitPTS for cc: "+u+" found from main: "+l),this.videoTrackCC=u,this.state===nr&&this.tick()}},i.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=kt);var a=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,a>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),n=a,this.state=Ye):(this.loadedmetadata=!1,this.state=ur),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},i.doTick=function(){switch(this.state){case Ye:this.doTickIdle();break;case ur:var n,a=this.levels,r=this.trackId,s=a==null||(n=a[r])===null||n===void 0?void 0:n.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=nr}break;case zt:var l,u=performance.now(),d=this.retryDate;(!d||u>=d||(l=this.media)!==null&&l!==void 0&&l.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Ye);break;case nr:var f=this.waitingData;if(f){var g=f.frag,p=f.part,m=f.cache,A=f.complete;if(this.initPTS[g.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Xt;var L={frag:g,part:p,payload:m.flush(),networkDetails:null};this._handleFragmentLoadProgress(L),A&&h.prototype._handleFragmentLoadComplete.call(this,L)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+g.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var _=this.getLoadPosition(),K=lt.bufferInfo(this.mediaBuffer,_,this.config.maxBufferHole);Sr(K.end,this.config.maxFragLookUpTolerance,g)<0&&(this.log("Waiting fragment cc ("+g.cc+") @ "+g.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=Ye}this.onTickEnd()},i.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Ye)},i.resetLoadingState=function(){this.clearWaitingFragment(),h.prototype.resetLoadingState.call(this)},i.onTickEnd=function(){var n=this.media;n&&n.readyState&&(this.lastCurrentTime=n.currentTime)},i.doTickIdle=function(){var n=this.hls,a=this.levels,r=this.media,s=this.trackId,l=n.config;if(a&&a[s]&&(r||!this.startFragRequested&&l.startFragPrefetch)){var u=a[s].details;if(!u||u.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(u))this.state=ur;else{var d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,U.ElementaryStreamTypes.AUDIO,x.PlaylistLevelType.AUDIO));var f=this.getFwdBufferInfo(d,x.PlaylistLevelType.AUDIO);if(f!==null){var g=this.audioSwitch;if(!g&&this._streamEnded(f,u))return n.trigger(c.Events.BUFFER_EOS,{type:"audio"}),void(this.state=ir);var p=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,x.PlaylistLevelType.MAIN);if(!(f.len>=this.getMaxBufferLength(p==null?void 0:p.len))||g){var m=u.fragments[0].start,A=f.end;if(g&&r){var L=this.getLoadPosition();A=L,u.PTSKnown&&L<m&&(f.end>m||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(!(p&&A>p.end+u.targetduration)&&(p&&p.len||!f.len)){var _=this.getNextFragment(A,u);_?this.loadFragment(_,u,A):this.bufferFlushed=!0}}}}}},i.getMaxBufferLength=function(n){var a=h.prototype.getMaxBufferLength.call(this);return n?Math.max(a,n):a},i.onMediaDetaching=function(){this.videoBuffer=null,h.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(n,a){var r=a.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(s){return new D(s)})},i.onAudioTrackSwitching=function(n,a){var r=!!a.url;this.trackId=a.id;var s=this.fragCurrent;s&&s.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=Ye):this.state=kt,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(n,a){this.mainDetails=a.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(n,a){var r;if(this.mainDetails!=null){var s=this.levels,l=a.details,u=a.id;if(s){this.log("Track "+u+" loaded ["+l.startSN+","+l.endSN+"],duration:"+l.totalduration);var d=s[u],f=0;if(l.live||(r=d.details)!==null&&r!==void 0&&r.live){var g=this.mainDetails;if(l.fragments[0]||(l.deltaUpdateFailed=!0),l.deltaUpdateFailed||!g)return;!d.details&&l.hasProgramDateTime&&g.hasProgramDateTime?(ai(l,g),f=l.fragments[0].start):f=this.alignPlaylists(l,d.details)}d.details=l,this.levelLastLoaded=u,this.startFragRequested||!this.mainDetails&&l.live||this.setStartPosition(d.details,f),this.state!==ur||this.waitForCdnTuneIn(l)||(this.state=Ye),this.tick()}else this.warn("Audio tracks were reset while loading level "+u)}else this.cachedTrackLoadedData=a},i._handleFragmentLoadProgress=function(n){var a,r=n.frag,s=n.part,l=n.payload,u=this.config,d=this.trackId,f=this.levels;if(f){var g=f[d],p=g.details,m=u.defaultAudioCodec||g.audioCodec||"mp4a.40.2",A=this.transmuxer;A||(A=this.transmuxer=new di(this.hls,x.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var L=this.initPTS[r.cc],_=(a=r.initSegment)===null||a===void 0?void 0:a.data;if(L!==void 0){var K=s?s.index:-1,z=K!==-1,Y=new yr(r.level,r.sn,r.stats.chunkCount,l.byteLength,K,z);A.push(l,_,m,"",r,s,p.totalduration,!1,Y,L)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+d),(this.waitingData=this.waitingData||{frag:r,part:s,cache:new fi,complete:!1}).cache.push(new Uint8Array(l)),this.waitingVideoCC=this.videoTrackCC,this.state=nr}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:h.prototype._handleFragmentLoadComplete.call(this,n)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(n,a){var r=a.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer||null)},i.onFragBuffered=function(n,a){var r,s=a.frag,l=a.part;s.type===x.PlaylistLevelType.AUDIO?this.fragContextChanged(s)?this.warn("Fragment "+s.sn+(l?" p: "+l.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(s.sn!=="initSegment"&&(this.fragPrevious=s,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(s,l)):this.loadedmetadata||s.type!==x.PlaylistLevelType.MAIN||(r=this.videoBuffer||this.media)!==null&&r!==void 0&&r.buffered.length&&(this.loadedmetadata=!0)},i.onError=function(n,a){if(a.type!==E.ErrorTypes.KEY_SYSTEM_ERROR)switch(a.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.FRAG_PARSING_ERROR:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x.PlaylistLevelType.AUDIO,a);break;case E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case E.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Ft&&this.state!==kt&&(this.state=a.fatal?Ft:Ye,this.warn(a.details+" while loading frag, switching to "+this.state+" state"));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="audio"&&(this.state===_t||this.state===rr)){var r=!0,s=this.getFwdBufferInfo(this.mediaBuffer,x.PlaylistLevelType.AUDIO);s&&s.len>.5&&(r=!this.reduceMaxBufferLength(s.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(x.PlaylistLevelType.AUDIO,a)},i.onBufferFlushed=function(n,a){a.type===U.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===ir&&(this.state=Ye))},i._handleTransmuxComplete=function(n){var a,r="audio",s=this.hls,l=n.remuxResult,u=n.chunkMeta,d=this.getCurrentContext(u);if(!d)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(u.level);var f=d.frag,g=d.part,p=d.level.details,m=l.audio,A=l.text,L=l.id3,_=l.initSegment;if(!this.fragContextChanged(f)&&p){if(this.state=_t,this.audioSwitch&&m&&this.completeAudioSwitch(),_!=null&&_.tracks&&(this._bufferInitSegment(_.tracks,f,u),s.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:f,id:r,tracks:_.tracks})),m){var K=m.startPTS,z=m.endPTS,Y=m.startDTS,ee=m.endDTS;g&&(g.elementaryStreams[U.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:z,startDTS:Y,endDTS:ee}),f.setElementaryStreamInfo(U.ElementaryStreamTypes.AUDIO,K,z,Y,ee),this.bufferFragmentData(m,f,g,u)}if(L!=null&&(a=L.samples)!==null&&a!==void 0&&a.length){var Ee=dr({id:r,frag:f,details:p},L);s.trigger(c.Events.FRAG_PARSING_METADATA,Ee)}if(A){var Se=dr({id:r,frag:f,details:p},A);s.trigger(c.Events.FRAG_PARSING_USERDATA,Se)}}},i._bufferInitSegment=function(n,a,r){if(this.state===_t){n.video&&delete n.video;var s=n.audio;if(s){s.levelCodec=s.codec,s.id="audio",this.log("Init audio buffer, container:"+s.container+", codecs[parsed]=["+s.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,n);var l=s.initSegment;if(l!=null&&l.byteLength){var u={type:"audio",frag:a,part:null,chunkMeta:r,parent:a.type,data:l};this.hls.trigger(c.Events.BUFFER_APPENDING,u)}this.tick()}}},i.loadFragment=function(n,a,r){var s=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||s===me.NOT_LOADED||s===me.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n,a):a.live&&!(0,F.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=nr):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,n,a,r)))},i.completeAudioSwitch=function(){var n=this.hls,a=this.media,r=this.trackId;a&&(this.log("Switching audio track : flushing all audio"),h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:r})},t}(Ar);const an=nn;function sn(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function wr(h,o){return wr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wr(h,o)}const on=function(h){var o,e;function t(r){var s;return(s=h.call(this,r,"[audio-track-controller]")||this).tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.trackName="",s.selectDefaultTrack=!0,s.registerListeners(),s}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,wr(o,e);var i,n,a=t.prototype;return a.registerListeners=function(){var r=this.hls;r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(c.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var r=this.hls;r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(c.Events.ERROR,this.onError,this)},a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,h.prototype.destroy.call(this)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},a.onManifestParsed=function(r,s){this.tracks=s.audioTracks||[]},a.onAudioTrackLoaded=function(r,s){var l=s.id,u=s.details,d=this.tracksInGroup[l];if(d){var f=d.details;d.details=s.details,this.log("audioTrack "+l+" loaded ["+u.startSN+"-"+u.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,s,f))}else this.warn("Invalid audio track id "+l)},a.onLevelLoading=function(r,s){this.switchLevel(s.level)},a.onLevelSwitching=function(r,s){this.switchLevel(s.level)},a.switchLevel=function(r){var s=this.hls.levels[r];if(s!=null&&s.audioGroupIds){var l=s.audioGroupIds[s.urlId];if(this.groupId!==l){this.groupId=l;var u=this.tracks.filter(function(f){return!l||f.groupId===l});this.selectDefaultTrack&&!u.some(function(f){return f.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var d={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(c.Events.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}}},a.onError=function(r,s){h.prototype.onError.call(this,r,s),!s.fatal&&s.context&&s.context.type===x.PlaylistContextType.AUDIO_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},a.setAudioTrack=function(r){var s=this.tracksInGroup;if(r<0||r>=s.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var l=s[this.trackId];this.log("Now switching to audio-track index "+r);var u=s[r],d=u.id,f=u.groupId,g=f===void 0?"":f,p=u.name,m=u.type,A=u.url;if(this.trackId=r,this.trackName=p,this.selectDefaultTrack=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHING,{id:d,groupId:g,name:p,type:m,url:A}),!u.details||u.details.live){var L=this.switchParams(u.url,l==null?void 0:l.details);this.loadPlaylist(L)}}},a.selectInitialTrack=function(){this.tracksInGroup;var r=this.trackName,s=this.findTrackId(r)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},a.findTrackId=function(r){for(var s=this.tracksInGroup,l=0;l<s.length;l++){var u=s[l];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},a.loadPlaylist=function(r){h.prototype.loadPlaylist.call(this);var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var l=s.id,u=s.groupId,d=s.url;if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("loading audio-track playlist for id: "+l),this.clearTimer(),this.hls.trigger(c.Events.AUDIO_TRACK_LOADING,{url:d,id:l,groupId:u,deliveryDirectives:r||null})}},i=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}])&&sn(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(re);function ln(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function Or(h,o){return Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Or(h,o)}var un=function(h){var o,e;function t(r,s,l){var u;return(u=h.call(this,r,s,l,"[subtitle-stream-controller]")||this).levels=[],u.currentTrackId=-1,u.tracksBuffered=[],u.mainDetails=null,u._registerListeners(),u}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,Or(o,e);var i,n,a=t.prototype;return a.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},a._registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.ERROR,this.onError,this),r.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(c.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.ERROR,this.onError,this),r.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(c.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.startLoad=function(r){this.stopLoad(),this.state=Ye,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},a.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},a.onLevelLoaded=function(r,s){this.mainDetails=s.details},a.onSubtitleFragProcessed=function(r,s){var l=s.frag,u=s.success;if(this.fragPrevious=l,this.state=Ye,u){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var f,g=l.start,p=0;p<d.length;p++)if(g>=d[p].start&&g<=d[p].end){f=d[p];break}var m=l.start+l.duration;f?f.end=m:(f={start:g,end:m},d.push(f)),this.fragmentTracker.fragBuffered(l)}}},a.onBufferFlushing=function(r,s){var l=s.startOffset,u=s.endOffset;if(l===0&&u!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,f=this.levels;if(!f.length||!f[d]||!f[d].details)return;var g=u-f[d].details.targetduration;if(g<=0)return;s.endOffsetSubtitles=Math.max(0,g),this.tracksBuffered.forEach(function(p){for(var m=0;m<p.length;)if(p[m].end<=g)p.shift();else{if(!(p[m].start<g))break;p[m].start=g,m++}}),this.fragmentTracker.removeFragmentsInRange(l,g,x.PlaylistLevelType.SUBTITLE)}},a.onFragBuffered=function(r,s){var l;this.loadedmetadata||s.frag.type!==x.PlaylistLevelType.MAIN||(l=this.media)!==null&&l!==void 0&&l.buffered.length&&(this.loadedmetadata=!0)},a.onError=function(r,s){var l=s.frag;l&&l.type===x.PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=Ye)},a.onSubtitleTracksUpdated=function(r,s){var l=this,u=s.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(d){return new D(d)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(d){l.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},a.onSubtitleTrackSwitch=function(r,s){if(this.currentTrackId=s.id,this.levels.length&&this.currentTrackId!==-1){var l=this.levels[this.currentTrackId];l!=null&&l.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,l&&this.setInterval(500)}else this.clearInterval()},a.onSubtitleTrackLoaded=function(r,s){var l,u=s.details,d=s.id,f=this.currentTrackId,g=this.levels;if(g.length){var p=g[f];if(!(d>=g.length||d!==f)&&p){this.mediaBuffer=this.mediaBufferTimeRanges;var m=0;if(u.live||(l=p.details)!==null&&l!==void 0&&l.live){var A=this.mainDetails;if(u.deltaUpdateFailed||!A)return;var L=A.fragments[0];p.details?(m=this.alignPlaylists(u,p.details))===0&&L&&J(u,m=L.start):u.hasProgramDateTime&&A.hasProgramDateTime?(ai(u,A),m=u.fragments[0].start):L&&J(u,m=L.start)}p.details=u,this.levelLastLoaded=d,this.startFragRequested||!this.mainDetails&&u.live||this.setStartPosition(p.details,m),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===Ye&&(Tr(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),p.details=void 0))}}},a._handleFragmentLoadComplete=function(r){var s=this,l=r.frag,u=r.payload,d=l.decryptdata,f=this.hls;if(!this.fragContextChanged(l)&&u&&u.byteLength>0&&d&&d.key&&d.iv&&d.method==="AES-128"){var g=performance.now();this.decrypter.decrypt(new Uint8Array(u),d.key.buffer,d.iv.buffer).then(function(p){var m=performance.now();f.trigger(c.Events.FRAG_DECRYPTED,{frag:l,payload:p,stats:{tstart:g,tdecrypt:m}})}).catch(function(p){s.warn(p.name+": "+p.message),s.state=Ye})}},a.doTick=function(){if(this.media){if(this.state===Ye){var r=this.currentTrackId,s=this.levels;if(!s.length||!s[r]||!s[r].details)return;var l=s[r].details,u=l.targetduration,d=this.config,f=this.getLoadPosition(),g=lt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],f-u,d.maxBufferHole),p=g.end,m=g.len,A=this.getFwdBufferInfo(this.media,x.PlaylistLevelType.MAIN);if(m>this.getMaxBufferLength(A==null?void 0:A.len)+u)return;var L=l.fragments,_=L.length,K=l.edge,z=null,Y=this.fragPrevious;if(p<K){var ee=d.maxFragLookUpTolerance;!(z=Tr(Y,L,Math.max(L[0].start,p),ee))&&Y&&Y.start<L[0].start&&(z=L[0])}else z=L[_-1];if(!z)return;z=this.mapToInitFragWhenRequired(z),this.fragmentTracker.getState(z)===me.NOT_LOADED&&this.loadFragment(z,l,p)}}else this.state=Ye},a.getMaxBufferLength=function(r){var s=h.prototype.getMaxBufferLength.call(this);return r?Math.max(s,r):s},a.loadFragment=function(r,s,l){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r,s):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,s,l))},i=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return new hn(this.tracksBuffered[this.currentTrackId]||[])}}])&&ln(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ar),hn=function(h){this.buffered=void 0;var o=function(e,t,i){if((t>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return h[t][e]};this.buffered={get length(){return h.length},end:function(e){return o("end",e,h.length)},start:function(e){return o("start",e,h.length)}}};function dn(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function Pr(h,o){return Pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pr(h,o)}function xr(h){for(var o=[],e=0;e<h.length;e++){var t=h[e];t.kind!=="subtitles"&&t.kind!=="captions"||!t.label||o.push(h[e])}return o}const fn=function(h){var o,e;function t(r){var s;return(s=h.call(this,r,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s._subtitleDisplay=!0,s.registerListeners(),s}e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,Pr(o,e);var i,n,a=t.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,h.prototype.destroy.call(this)},a.registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.Events.ERROR,this.onError,this)},a.onMediaAttached=function(r,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},a.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),xr(this.media.textTracks).forEach(function(r){et(r)}),this.subtitleTrack=-1,this.media=null)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(r,s){this.tracks=s.subtitleTracks},a.onSubtitleTrackLoaded=function(r,s){var l=s.id,u=s.details,d=this.trackId,f=this.tracksInGroup[d];if(f){var g=f.details;f.details=s.details,this.log("subtitle track "+l+" loaded ["+u.startSN+"-"+u.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,s,g))}else this.warn("Invalid subtitle track id "+l)},a.onLevelLoading=function(r,s){this.switchLevel(s.level)},a.onLevelSwitching=function(r,s){this.switchLevel(s.level)},a.switchLevel=function(r){var s=this.hls.levels[r];if(s!=null&&s.textGroupIds){var l=s.textGroupIds[s.urlId];if(this.groupId!==l){var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(p){return!l||p.groupId===l});this.tracksInGroup=d;var f=this.findTrackId(u==null?void 0:u.name)||this.findTrackId();this.groupId=l;var g={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(c.Events.SUBTITLE_TRACKS_UPDATED,g),f!==-1&&this.setSubtitleTrack(f,u)}}},a.findTrackId=function(r){for(var s=this.tracksInGroup,l=0;l<s.length;l++){var u=s[l];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},a.onError=function(r,s){h.prototype.onError.call(this,r,s),!s.fatal&&s.context&&s.context.type===x.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},a.loadPlaylist=function(r){h.prototype.loadPlaylist.call(this);var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var l=s.id,u=s.groupId,d=s.url;if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADING,{url:d,id:l,groupId:u,deliveryDirectives:r||null})}},a.toggleTrackModes=function(r){var s=this,l=this.media,u=this.trackId;if(l){var d=xr(l.textTracks),f=d.filter(function(m){return m.groupId===s.groupId});if(r===-1)[].slice.call(d).forEach(function(m){m.mode="disabled"});else{var g=f[u];g&&(g.mode="disabled")}var p=f[r];p&&(p.mode=this.subtitleDisplay?"showing":"hidden")}},a.setSubtitleTrack=function(r,s){var l,u=this.tracksInGroup;if(this.media){if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(l=u[r])!==null&&l!==void 0&&l.details)||r<-1||r>=u.length)){this.clearTimer();var d=u[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,d){var f=d.id,g=d.groupId,p=g===void 0?"":g,m=d.name,A=d.type,L=d.url;this.hls.trigger(c.Events.SUBTITLE_TRACK_SWITCH,{id:f,groupId:p,name:m,type:A,url:L});var _=this.switchParams(d.url,s==null?void 0:s.details);this.loadPlaylist(_)}else this.hls.trigger(c.Events.SUBTITLE_TRACK_SWITCH,{id:r})}}else this.queuedDefaultTrack=r},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var r=-1,s=xr(this.media.textTracks),l=0;l<s.length;l++)if(s[l].mode==="hidden")r=l;else if(s[l].mode==="showing"){r=l;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},i=t,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,s)}}])&&dn(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(re);var We,cn=function(){function h(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var o=h.prototype;return o.append=function(e,t){var i=this.queues[t];i.push(e),i.length===1&&this.buffers[t]&&this.executeNext(t)},o.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},o.appendBlocker=function(e){var t,i=new Promise(function(a){t=a}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},o.executeNext=function(e){var t=this.buffers,i=this.queues,n=t[e],a=i[e];if(a.length){var r=a[0];try{r.execute()}catch(s){k.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(s),n&&n.updating||(a.shift(),this.executeNext(e))}}},o.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},o.current=function(e){return this.queues[e][0]},h}(),ci=Dr(),gi=/([ha]vc.)(?:\.[^.,]+)+/,gn=function(){function h(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=t.media,n=t.mediaSource;k.logger.log("[buffer-controller]: Media source opened"),i&&(i.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(c.Events.MEDIA_ATTACHED,{media:i})),n&&n.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){k.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){k.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var i=t.media,n=t._objectUrl;i&&i.src!==n&&k.logger.error("Media element src was set while attaching MediaSource ("+n+" > "+i.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var o=h.prototype;return o.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},o.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},o.registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(c.Events.BUFFER_RESET,this.onBufferReset,this),e.on(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(c.Events.BUFFER_EOS,this.onBufferEos,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(c.Events.FRAG_PARSED,this.onFragParsed,this),e.on(c.Events.FRAG_CHANGED,this.onFragChanged,this)},o.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(c.Events.BUFFER_RESET,this.onBufferReset,this),e.off(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(c.Events.BUFFER_EOS,this.onBufferEos,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(c.Events.FRAG_PARSED,this.onFragParsed,this),e.off(c.Events.FRAG_CHANGED,this.onFragChanged,this)},o._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new cn(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},o.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,k.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},o.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&ci){var n=this.mediaSource=new ci;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}},o.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(k.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(n){k.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):k.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.Events.MEDIA_DETACHED,void 0)},o.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(n){k.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",n)}}),this._initSourceBuffer()},o.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(a){if(n){var r=i.tracks[a];if(r&&typeof r.buffer.changeType=="function"){var s=t[a],l=s.id,u=s.codec,d=s.levelCodec,f=s.container,g=s.metadata,p=(r.levelCodec||r.codec).replace(gi,"$1"),m=(d||u).replace(gi,"$1");if(p!==m){var A=f+";codecs="+(d||u);i.appendChangeType(a,A),k.logger.log("[buffer-controller]: switching codec "+p+" to "+m),i.tracks[a]={buffer:r.buffer,codec:u,container:f,levelCodec:d,metadata:g,id:l}}}}else i.pendingTracks[a]=t[a]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},o.appendChangeType=function(e,t){var i=this,n=this.operationQueue,a={execute:function(){var r=i.sourceBuffer[e];r&&(k.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(r){k.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",r)}};n.append(a,e)},o.onBufferAppending=function(e,t){var i=this,n=this.hls,a=this.operationQueue,r=this.tracks,s=t.data,l=t.type,u=t.frag,d=t.part,f=t.chunkMeta,g=f.buffering[l],p=self.performance.now();g.start=p;var m=u.stats.buffering,A=d?d.stats.buffering:null;m.start===0&&(m.start=p),A&&A.start===0&&(A.start=p);var L=r.audio,_=!1;l==="audio"&&(L==null?void 0:L.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);var K=u.start,z={execute:function(){if(g.executeStart=self.performance.now(),_){var Y=i.sourceBuffer[l];if(Y){var ee=K-Y.timestampOffset;Math.abs(ee)>=.1&&(k.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+K+" (delta: "+ee+") sn: "+u.sn+")"),Y.timestampOffset=K)}}i.appendExecutor(s,l)},onStart:function(){},onComplete:function(){var Y=self.performance.now();g.executeEnd=g.end=Y,m.first===0&&(m.first=Y),A&&A.first===0&&(A.first=Y);var ee=i.sourceBuffer,Ee={};for(var Se in ee)Ee[Se]=lt.getBuffered(ee[Se]);i.appendError=0,i.hls.trigger(c.Events.BUFFER_APPENDED,{type:l,frag:u,part:d,chunkMeta:f,parent:u.type,timeRanges:Ee})},onError:function(Y){k.logger.error("[buffer-controller]: Error encountered while trying to append to the "+l+" SourceBuffer",Y);var ee={type:E.ErrorTypes.MEDIA_ERROR,parent:u.type,details:E.ErrorDetails.BUFFER_APPEND_ERROR,err:Y,fatal:!1};Y.code===DOMException.QUOTA_EXCEEDED_ERR?ee.details=E.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,ee.details=E.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(k.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),ee.fatal=!0,n.stopLoad())),n.trigger(c.Events.ERROR,ee)}};a.append(z,l)},o.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,a=function(r){return{execute:i.removeExecutor.bind(i,r,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(c.Events.BUFFER_FLUSHED,{type:r})},onError:function(s){k.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",s)}}};t.type?n.append(a(t.type),t.type):this.getSourceBufferTypes().forEach(function(r){n.append(a(r),r)})},o.onFragParsed=function(e,t){var i=this,n=t.frag,a=t.part,r=[],s=a?a.elementaryStreams:n.elementaryStreams;s[U.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(s[U.ElementaryStreamTypes.AUDIO]&&r.push("audio"),s[U.ElementaryStreamTypes.VIDEO]&&r.push("video")),r.length===0&&k.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var l=self.performance.now();n.stats.buffering.end=l,a&&(a.stats.buffering.end=l);var u=a?a.stats:n.stats;i.hls.trigger(c.Events.FRAG_BUFFERED,{frag:n,part:a,stats:u,id:n.type})},r)},o.onFragChanged=function(e,t){this.flushBackBuffer()},o.onBufferEos=function(e,t){var i=this;this.getSourceBufferTypes().reduce(function(n,a){var r=i.sourceBuffer[a];return!r||t.type&&t.type!==a||(r.ending=!0,r.ended||(r.ended=!0,k.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS"))),n&&!(r&&!r.ended)},!0)&&(k.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){i.getSourceBufferTypes().forEach(function(a){var r=i.sourceBuffer[a];r&&(r.ending=!1)});var n=i.mediaSource;n&&n.readyState==="open"?(k.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),n.endOfStream()):n&&k.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+n.readyState)}))},o.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},o.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,n=this.sourceBuffer;if(i&&t!==null){var a=this.getSourceBufferTypes();if(a.length){var r=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,F.isFiniteNumber)(r)&&!(r<0)){var s=i.currentTime,l=t.levelTargetDuration,u=Math.max(r,l),d=Math.floor(s/l)*l-u;a.forEach(function(f){var g=n[f];if(g){var p=lt.getBuffered(g);if(p.length>0&&d>p.start(0)){if(e.trigger(c.Events.BACK_BUFFER_REACHED,{bufferEnd:d}),t.live)e.trigger(c.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d});else if(g.ended&&p.end(p.length-1)-s<2*l)return void k.logger.info("[buffer-controller]: Cannot flush "+f+" back buffer while SourceBuffer is in ended state");e.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:f})}}})}}}},o.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,a=e.fragments[0].start+e.totalduration,r=i.duration,s=(0,F.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(k.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(a>s&&a>r||!(0,F.isFiniteNumber)(r))&&(k.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),n.duration=a)}},o.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){var n=Math.max(0,i[0].start),a=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,a)}},o.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!e||n===2){this.createSourceBuffers(i),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length===0)return void this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach(function(r){t.executeNext(r)})}},o.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var a in e)if(!t[a]){var r=e[a];if(!r)throw Error("source buffer exists for track "+a+", however track does not");var s=r.levelCodec||r.codec,l=r.container+";codecs="+s;k.logger.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var u=t[a]=i.addSourceBuffer(l),d=a;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[a]={buffer:u,codec:s,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},n++}catch(f){k.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+f.message),this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,mimeType:l})}}n&&this.hls.trigger(c.Events.BUFFER_CREATED,{tracks:this.tracks})},o._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},o._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},o._onSBUpdateError=function(e,t){k.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},o.removeExecutor=function(e,t,i){var n=this.media,a=this.mediaSource,r=this.operationQueue,s=this.sourceBuffer[e];if(!n||!a||!s)return k.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);var l=(0,F.isFiniteNumber)(n.duration)?n.duration:1/0,u=(0,F.isFiniteNumber)(a.duration)?a.duration:1/0,d=Math.max(0,t),f=Math.min(i,l,u);f>d&&!s.ending?(s.ended=!1,k.logger.log("[buffer-controller]: Removing ["+d+","+f+"] from the "+e+" SourceBuffer"),s.remove(d,f)):r.shiftAndExecuteNext(e)},o.appendExecutor=function(e,t){var i=this.operationQueue,n=this.sourceBuffer[t];if(!n)return k.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)},o.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return k.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,a=t.map(function(r){return n.appendBlocker(r)});Promise.all(a).then(function(){e(),t.forEach(function(r){var s=i.sourceBuffer[r];s&&s.updating||n.shiftAndExecuteNext(r)})})},o.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},o.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var a=i.bind(this,e);this.listeners[e].push({event:t,listener:a}),n.addEventListener(t,a)}},o.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(i){t.removeEventListener(i.event,i.listener)})},h}(),vi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},pi=function(h){var o=h;return vi.hasOwnProperty(h)&&(o=vi[h]),String.fromCharCode(o)},Vt=15,Mt=100,vn={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},pn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},mn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},yn={25:2,26:4,29:6,30:8,31:10,27:13,28:15},En=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(We||(We={}));var Tn=function(){function h(){this.time=null,this.verboseLevel=We.ERROR}return h.prototype.log=function(o,e){if(this.verboseLevel>=o){var t=typeof e=="function"?e():e;k.logger.log(this.time+" ["+o+"] "+t)}},h}(),Yt=function(h){for(var o=[],e=0;e<h.length;e++)o.push(h[e].toString(16));return o},mi=function(){function h(e,t,i,n,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=n||"black",this.flash=a||!1}var o=h.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},o.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),Sn=function(){function h(e,t,i,n,a,r){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new mi(t,i,n,a,r)}var o=h.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},o.setPenState=function(e){this.penState.copy(e)},o.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},o.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),bn=function(){function h(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<Mt;t++)this.chars.push(new Sn);this.logger=e,this.pos=0,this.currPenState=new mi}var o=h.prototype;return o.equals=function(e){for(var t=!0,i=0;i<Mt;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},o.copy=function(e){for(var t=0;t<Mt;t++)this.chars[t].copy(e.chars[t])},o.isEmpty=function(){for(var e=!0,t=0;t<Mt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},o.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(We.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Mt&&(this.logger.log(We.DEBUG,"Too large cursor position "+this.pos),this.pos=Mt)},o.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(e){var t=this;e>=144&&this.backSpace();var i=pi(e);this.pos>=Mt?this.logger.log(We.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+i+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1))},o.clearFromPos=function(e){var t;for(t=e;t<Mt;t++)this.chars[t].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var e=[],t=!0,i=0;i<Mt;i++){var n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")},o.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},h}(),Fr=function(){function h(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Vt;t++)this.rows.push(new bn(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var o=h.prototype;return o.reset=function(){for(var e=0;e<Vt;e++)this.rows[e].clear();this.currRow=14},o.equals=function(e){for(var t=!0,i=0;i<Vt;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},o.copy=function(e){for(var t=0;t<Vt;t++)this.rows[t].copy(e.rows[t])},o.isEmpty=function(){for(var e=!0,t=0;t<Vt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},o.backSpace=function(){this.rows[this.currRow].backSpace()},o.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},o.insertChar=function(e){this.rows[this.currRow].insertChar(e)},o.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},o.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},o.setCursor=function(e){this.logger.log(We.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},o.setPAC=function(e){this.logger.log(We.INFO,function(){return"pacData = "+JSON.stringify(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<Vt;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var r=a.rows[n].cueStartTime,s=this.logger.time;if(r&&s!==null&&r<s)for(var l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(a.rows[n+l])}}this.currRow=t;var u=this.rows[this.currRow];if(e.indent!==null){var d=e.indent,f=Math.max(d-1,0);u.setCursor(e.indent),e.color=u.chars[f].penState.foreground}var g={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(g)},o.setBkgData=function(e){this.logger.log(We.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},o.setRollUpRows=function(e){this.nrRollUpRows=e},o.rollUp=function(){var e=this;if(this.nrRollUpRows!==null){this.logger.log(We.TEXT,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(t,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),this.logger.log(We.INFO,"Rolling up")}else this.logger.log(We.DEBUG,"roll_up but nrRollUpRows not set yet")},o.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,a=0;a<Vt;a++){var r=this.rows[a].getTextString();r&&(n=a+1,e?t.push("Row "+n+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join(`
`)),i},o.getTextAndFormat=function(){return this.rows},h}(),yi=function(){function h(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Fr(i),this.nonDisplayedMemory=new Fr(i),this.lastOutputScreen=new Fr(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var o=h.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(e){this.outputFilter=e},o.setPAC=function(e){this.writeScreen.setPAC(e)},o.setBkgData=function(e){this.writeScreen.setBkgData(e)},o.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(We.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},o.insertChars=function(e){for(var t=this,i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(We.INFO,function(){return n+": "+t.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(We.TEXT,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(We.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(We.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(We.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(e){this.logger.log(We.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},o.ccFON=function(){this.logger.log(We.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(We.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(We.INFO,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(We.INFO,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(We.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(We.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(We.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){var e=this;if(this.logger.log(We.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(We.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},o.ccTO=function(e){this.logger.log(We.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},o.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(We.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},o.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},h}(),Ln=function(){function h(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new Tn;this.channels=[null,new yi(e,t,n),new yi(e+1,i,n)],this.cmdHistory={a:null,b:null},this.logger=n}var o=h.prototype;return o.getHandler=function(e){return this.channels[e].getHandler()},o.setHandler=function(e,t){this.channels[e].setHandler(t)},o.addData=function(e,t){var i,n,a,r=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(n=127&t[s],a=127&t[s+1],n!==0||a!==0){if(this.logger.log(We.DATA,"["+Yt([t[s],t[s+1]])+"] -> ("+Yt([n,a])+")"),(i=this.parseCmd(n,a))||(i=this.parseMidrow(n,a)),i||(i=this.parsePAC(n,a)),i||(i=this.parseBackgroundAttributes(n,a)),!i&&(r=this.parseChars(n,a))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(r):this.logger.log(We.WARNING,"No channel found yet. TEXT-MODE?")}i||r||this.logger.log(We.WARNING,"Couldn't parse cleaned data "+Yt([n,a])+" orig: "+Yt([t[s],t[s+1]]))}},o.parseCmd=function(e,t){var i=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Ei(e,t,i))return $t(null,null,i),this.logger.log(We.DEBUG,"Repeated command ("+Yt([e,t])+") is dropped"),!0;var n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),$t(e,t,i),this.currentChannel=n,!0},o.parseMidrow=function(e,t){var i=0;if((e===17||e===25)&&t>=32&&t<=47){if((i=e===17?1:2)!==this.currentChannel)return this.logger.log(We.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[i];return!!n&&(n.ccMIDROW(t),this.logger.log(We.DEBUG,"MIDROW ("+Yt([e,t])+")"),!0)}return!1},o.parsePAC=function(e,t){var i,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Ei(e,t,n))return $t(null,null,n),!0;var a=e<=23?1:2;i=t>=64&&t<=95?a===1?vn[e]:mn[e]:a===1?pn[e]:yn[e];var r=this.channels[a];return!!r&&(r.setPAC(this.interpretPAC(i,t)),$t(e,t,n),this.currentChannel=a,!0)},o.interpretPAC=function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=(1&i)==1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},o.parseChars=function(e,t){var i,n,a=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19?(n=r===17?t+80:r===18?t+112:t+144,this.logger.log(We.INFO,"Special char '"+pi(n)+"' in channel "+i),a=[n]):e>=32&&e<=127&&(a=t===0?[e]:[e,t]),a){var s=Yt(a);this.logger.log(We.DEBUG,"Char codes =  "+s.join(",")),$t(e,t,this.cmdHistory)}return a},o.parseBackgroundAttributes=function(e,t){var i;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var n={};e===16||e===24?(i=Math.floor((t-32)/2),n.background=En[i],t%2==1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));var a=e<=23?1:2;return this.channels[a].setBkgData(n),$t(e,t,this.cmdHistory),!0},o.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},o.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t];i&&i.cueSplitAtTime(e)}},h}();function $t(h,o,e){e.a=h,e.b=o}function Ei(h,o,e){return e.a===h&&e.b===o}const Ti=Ln;var fr=function(){function h(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var o=h.prototype;return o.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null},h}();const Mr=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var h=["","lr","rl"],o=["start","middle","end","left","right"];function e(a,r){if(typeof r!="string"||!Array.isArray(a))return!1;var s=r.toLowerCase();return!!~a.indexOf(s)&&s}function t(a){return e(o,a)}function i(a){for(var r=arguments.length,s=new Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var f in d)a[f]=d[f]}return a}function n(a,r,s){var l=this,u={enumerable:!0};l.hasBeenReset=!1;var d="",f=!1,g=a,p=r,m=s,A=null,L="",_=!0,K="auto",z="start",Y=50,ee="middle",Ee=50,Se="middle";Object.defineProperty(l,"id",i({},u,{get:function(){return d},set:function(ae){d=""+ae}})),Object.defineProperty(l,"pauseOnExit",i({},u,{get:function(){return f},set:function(ae){f=!!ae}})),Object.defineProperty(l,"startTime",i({},u,{get:function(){return g},set:function(ae){if(typeof ae!="number")throw new TypeError("Start time must be set to a number.");g=ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"endTime",i({},u,{get:function(){return p},set:function(ae){if(typeof ae!="number")throw new TypeError("End time must be set to a number.");p=ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"text",i({},u,{get:function(){return m},set:function(ae){m=""+ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"region",i({},u,{get:function(){return A},set:function(ae){A=ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"vertical",i({},u,{get:function(){return L},set:function(ae){var ye=function(fe){return e(h,fe)}(ae);if(ye===!1)throw new SyntaxError("An invalid or illegal string was specified.");L=ye,this.hasBeenReset=!0}})),Object.defineProperty(l,"snapToLines",i({},u,{get:function(){return _},set:function(ae){_=!!ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"line",i({},u,{get:function(){return K},set:function(ae){if(typeof ae!="number"&&ae!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");K=ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"lineAlign",i({},u,{get:function(){return z},set:function(ae){var ye=t(ae);if(!ye)throw new SyntaxError("An invalid or illegal string was specified.");z=ye,this.hasBeenReset=!0}})),Object.defineProperty(l,"position",i({},u,{get:function(){return Y},set:function(ae){if(ae<0||ae>100)throw new Error("Position must be between 0 and 100.");Y=ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"positionAlign",i({},u,{get:function(){return ee},set:function(ae){var ye=t(ae);if(!ye)throw new SyntaxError("An invalid or illegal string was specified.");ee=ye,this.hasBeenReset=!0}})),Object.defineProperty(l,"size",i({},u,{get:function(){return Ee},set:function(ae){if(ae<0||ae>100)throw new Error("Size must be between 0 and 100.");Ee=ae,this.hasBeenReset=!0}})),Object.defineProperty(l,"align",i({},u,{get:function(){return Se},set:function(ae){var ye=t(ae);if(!ye)throw new SyntaxError("An invalid or illegal string was specified.");Se=ye,this.hasBeenReset=!0}})),l.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();var An=function(){function h(){}return h.prototype.decode=function(o,e){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))},h}();function Si(h){function o(t,i,n,a){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(a||0)}var e=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?o(e[2],e[3],0,e[4]):o(e[1],e[2],e[3],e[4]):null}var Dn=function(){function h(){this.values=Object.create(null)}var o=h.prototype;return o.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},o.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},o.has=function(e){return e in this.values},o.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},o.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},o.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},h}();function bi(h,o,e,t){var i=t?h.split(t):[h];for(var n in i)if(typeof i[n]=="string"){var a=i[n].split(e);a.length===2&&o(a[0],a[1])}}var Nr=new Mr(0,0,""),cr=Nr.align==="middle"?"middle":"center";function kn(h,o,e){var t=h;function i(){var a=Si(h);if(a===null)throw new Error("Malformed timestamp: "+t);return h=h.replace(/^[^\sa-zA-Z-]+/,""),a}function n(){h=h.replace(/^\s+/,"")}if(n(),o.startTime=i(),n(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);h=h.slice(3),n(),o.endTime=i(),n(),function(a,r){var s=new Dn;bi(a,function(d,f){var g;switch(d){case"region":for(var p=e.length-1;p>=0;p--)if(e[p].id===f){s.set(d,e[p].region);break}break;case"vertical":s.alt(d,f,["rl","lr"]);break;case"line":g=f.split(","),s.integer(d,g[0]),s.percent(d,g[0])&&s.set("snapToLines",!1),s.alt(d,g[0],["auto"]),g.length===2&&s.alt("lineAlign",g[1],["start",cr,"end"]);break;case"position":g=f.split(","),s.percent(d,g[0]),g.length===2&&s.alt("positionAlign",g[1],["start",cr,"end","line-left","line-right","auto"]);break;case"size":s.percent(d,f);break;case"align":s.alt(d,f,["start",cr,"end","left","right"])}},/:/,/\s/),r.region=s.get("region",null),r.vertical=s.get("vertical","");var l=s.get("line","auto");l==="auto"&&Nr.line===-1&&(l=-1),r.line=l,r.lineAlign=s.get("lineAlign","start"),r.snapToLines=s.get("snapToLines",!0),r.size=s.get("size",100),r.align=s.get("align",cr);var u=s.get("position","auto");u==="auto"&&Nr.position===50&&(u=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=u}(h,o)}function Li(h){return h.replace(/<br(?: \/)?>/gi,`
`)}var Rn=function(){function h(){this.state="INITIAL",this.buffer="",this.decoder=new An,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var o=h.prototype;return o.parse=function(e){var t=this;function i(){var l=t.buffer,u=0;for(l=Li(l);u<l.length&&l[u]!=="\r"&&l[u]!==`
`;)++u;var d=l.slice(0,u);return l[u]==="\r"&&++u,l[u]===`
`&&++u,t.buffer=l.slice(u),d}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var a=(n=i()).match(/^()?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?bi(n,function(l,u){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Mr(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{kn(n,t.cue,t.regionList)}catch(l){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=n.indexOf("-->")!==-1;if(!n||s&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(l){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},o.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},h}(),Ai=q(673),In=q(524),Cn=/\r\n|\n\r|\n|\r/g,Ur=function(h,o,e){return e===void 0&&(e=0),h.slice(e,e+o.length)===o},Br=function(h){for(var o=5381,e=h.length;e;)o=33*o^h.charCodeAt(--e);return(o>>>0).toString()};function Gr(h,o,e){return Br(h.toString())+Br(o.toString())+Br(e)}function Kr(){return Kr=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Kr.apply(this,arguments)}var Hr="stpp.ttml.im1t",Di=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ki=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_n={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ri(h,o,e,t,i){var n=(0,ie.findBox)(new Uint8Array(h),["mdat"]);if(n.length!==0){var a=n.map(function(s){return(0,tt.utf8ArrayToStr)(s)}),r=(0,Ai.toTimescaleFromScale)(o,1,e);try{a.forEach(function(s){return t(function(l,u){var d=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var f={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(f).reduce(function(_,K){return _[K]=d.getAttribute("ttp:"+K)||f[K],_},{}),p=d.getAttribute("xml:space")!=="preserve",m=Ii(jr(d,"styling","style")),A=Ii(jr(d,"layout","region")),L=jr(d,"body","[begin]");return[].map.call(L,function(_){var K=Ci(_,p);if(!K||!_.hasAttribute("begin"))return null;var z=Yr(_.getAttribute("begin"),g),Y=Yr(_.getAttribute("dur"),g),ee=Yr(_.getAttribute("end"),g);if(z===null)throw _i(_);if(ee===null){if(Y===null)throw _i(_);ee=z+Y}var Ee=new Mr(z-u,ee-u,K);Ee.id=Gr(Ee.startTime,Ee.endTime,Ee.text);var Se=function(fe,Ge,nt){var Ue="http://www.w3.org/ns/ttml#styling",He=null,$e=fe!=null&&fe.hasAttribute("style")?fe.getAttribute("style"):null;return $e&&nt.hasOwnProperty($e)&&(He=nt[$e]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(Tt,ft){var ut=Vr(Ge,Ue,ft)||Vr(fe,Ue,ft)||Vr(He,Ue,ft);return ut&&(Tt[ft]=ut),Tt},{})}(A[_.getAttribute("region")],m[_.getAttribute("style")],m),ae=Se.textAlign;if(ae){var ye=_n[ae];ye&&(Ee.lineAlign=ye),Ee.align=ae}return Kr(Ee,Se),Ee}).filter(function(_){return _!==null})}(s,r))})}catch(s){i(s)}}else i(new Error("Could not parse IMSC1 mdat"))}function jr(h,o,e){var t=h.getElementsByTagName(o)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Ii(h){return h.reduce(function(o,e){var t=e.getAttribute("xml:id");return t&&(o[t]=e),o},{})}function Ci(h,o){return[].slice.call(h.childNodes).reduce(function(e,t,i){var n;return t.nodeName==="br"&&i?e+`
`:(n=t.childNodes)!==null&&n!==void 0&&n.length?Ci(t,o):o?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function Vr(h,o,e){return h&&h.hasAttributeNS(o,e)?h.getAttributeNS(o,e):null}function _i(h){return new Error("Could not parse ttml timestamp "+h)}function Yr(h,o){if(!h)return null;var e=Si(h);return e===null&&(Di.test(h)?e=function(t,i){var n=Di.exec(t),a=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+a/i.frameRate}(h,o):ki.test(h)&&(e=function(t,i){var n=ki.exec(t),a=Number(n[1]);switch(n[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/i.frameRate;case"t":return a/i.tickRate}return a}(h,o))),e}var wn=function(){function h(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new fr(this,"textTrack1"),i=new fr(this,"textTrack2"),n=new fr(this,"textTrack3"),a=new fr(this,"textTrack4");this.cea608Parser1=new Ti(1,t,i),this.cea608Parser2=new Ti(3,n,a)}e.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(c.Events.FRAG_LOADING,this.onFragLoading,this),e.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=h.prototype;return o.destroy=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(c.Events.FRAG_LOADING,this.onFragLoading,this),e.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},o.addCues=function(e,t,i,n,a){for(var r,s,l,u,d=!1,f=a.length;f--;){var g=a[f],p=(r=g[0],s=g[1],l=t,u=i,Math.min(s,u)-Math.max(r,l));if(p>=0&&(g[0]=Math.min(g[0],t),g[1]=Math.max(g[1],i),d=!0,p/(i-t)>.5))return}if(d||a.push([t,i]),this.config.renderTextTracksNatively){var m=this.captionsTracks[e];this.Cues.newCue(m,t,i,n)}else{var A=this.Cues.newCue(null,t,i,n);this.hls.trigger(c.Events.CUES_PARSED,{type:"captions",cues:A,track:e})}},o.onInitPtsFound=function(e,t){var i=this,n=t.frag,a=t.id,r=t.initPTS,s=t.timescale,l=this.unparsedVttFrags;a==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=s),l.length&&(this.unparsedVttFrags=[],l.forEach(function(u){i.onFragLoaded(c.Events.FRAG_LOADED,u)}))},o.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null},o.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},o.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,i=this.captionsTracks,n=this.media,a=t[e],r=a.label,s=a.languageCode,l=this.getExistingTrack(e);if(l)i[e]=l,et(i[e]),je(i[e],n);else{var u=this.createTextTrack("captions",r,s);u&&(u[e]=!0,i[e]=u)}}},o.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},o.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},o.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},o.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){et(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},o.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)et(t[i])}},o.onSubtitleTracksUpdated=function(e,t){var i=this;this.textTracks=[];var n=t.subtitleTracks||[],a=n.some(function(u){return u.textCodec===Hr});if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,d){var f;if(d<s.length){for(var g=null,p=0;p<s.length;p++)if(On(s[p],u)){g=s[p];break}g&&(f=g)}if(f)et(f);else{var m=i._captionsOrSubtitlesFromCharacteristics(u);(f=i.createTextTrack(m,u.name,u.lang))&&(f.mode="disabled")}f&&(f.groupId=u.groupId,i.textTracks.push(f))})}else if(!r&&this.tracks&&this.tracks.length){var l=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},o._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!==null&&t!==void 0&&t.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"},o.onManifestLoaded=function(e,t){var i=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(n){var a=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(a){var r="textTrack"+a[1],s=i.captionsProperties[r];s&&(s.label=n.name,n.lang&&(s.languageCode=n.lang),s.media=n)}})},o.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},o.onFragLoading=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2,a=this.lastSn,r=this.lastPartIndex;if(this.enabled&&i&&n&&t.frag.type===x.PlaylistLevelType.MAIN){var s,l,u=t.frag.sn,d=(s=t==null||(l=t.part)===null||l===void 0?void 0:l.index)!=null?s:-1;u===a+1||u===a&&d===r+1||(i.reset(),n.reset()),this.lastSn=u,this.lastPartIndex=d}},o.onFragLoaded=function(e,t){var i=t.frag,n=t.payload,a=this.initPTS,r=this.unparsedVttFrags;if(i.type===x.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,F.isFiniteNumber)(a[i.cc]))return r.push(t),void(a.length&&this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var s=i.decryptdata,l="stats"in t;if(s==null||!s.encrypted||l){var u=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===Hr?this._parseIMSC1(i,n):this._parseVTTs(i,n,d)}}else this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(e,t){var i=this,n=this.hls;Ri(t,this.initPTS[e.cc],this.timescale[e.cc],function(a){i._appendCues(a,e.level),n.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){k.logger.log("Failed to parse IMSC1: "+a),n.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},o._parseVTTs=function(e,t,i){var n,a=this,r=this.hls;(function(s,l,u,d,f,g,p,m){var A,L=new Rn,_=(0,tt.utf8ArrayToStr)(new Uint8Array(s)).trim().replace(Cn,`
`).split(`
`),K=[],z=(0,Ai.toMpegTsClockFromTimescale)(l,u),Y="00:00.000",ee=0,Ee=0,Se=!0;L.oncue=function(ae){var ye=d[f],fe=d.ccOffset,Ge=(ee-z)/9e4;ye!=null&&ye.new&&(Ee!==void 0?fe=d.ccOffset=ye.start:function($e,Tt,ft){var ut=$e[Tt],ht=$e[ut.prevCC];if(!ht||!ht.new&&ut.new)return $e.ccOffset=$e.presentationOffset=ut.start,void(ut.new=!1);for(;(Nt=ht)!==null&&Nt!==void 0&&Nt.new;){var Nt;$e.ccOffset+=ut.start-ht.start,ut.new=!1,ht=$e[(ut=ht).prevCC]}$e.presentationOffset=ft}(d,f,Ge)),Ge&&(fe=Ge-d.presentationOffset);var nt=ae.endTime-ae.startTime,Ue=(0,In.normalizePts)(9e4*(ae.startTime+fe-Ee),9e4*g)/9e4;ae.startTime=Math.max(Ue,0),ae.endTime=Math.max(Ue+nt,0);var He=ae.text.trim();ae.text=decodeURIComponent(encodeURIComponent(He)),ae.id||(ae.id=Gr(ae.startTime,ae.endTime,He)),ae.endTime>0&&K.push(ae)},L.onparsingerror=function(ae){A=ae},L.onflush=function(){A?m(A):p(K)},_.forEach(function(ae){if(Se){if(Ur(ae,"X-TIMESTAMP-MAP=")){Se=!1,ae.slice(16).split(",").forEach(function(ye){Ur(ye,"LOCAL:")?Y=ye.slice(6):Ur(ye,"MPEGTS:")&&(ee=parseInt(ye.slice(7)))});try{Ee=function(ye){var fe=parseInt(ye.slice(-3)),Ge=parseInt(ye.slice(-6,-4)),nt=parseInt(ye.slice(-9,-7)),Ue=ye.length>9?parseInt(ye.substring(0,ye.indexOf(":"))):0;if(!((0,F.isFiniteNumber)(fe)&&(0,F.isFiniteNumber)(Ge)&&(0,F.isFiniteNumber)(nt)&&(0,F.isFiniteNumber)(Ue)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+ye);return fe+=1e3*Ge,(fe+=6e4*nt)+36e5*Ue}(Y)/1e3}catch(ye){A=ye}return}ae===""&&(Se=!1)}L.parse(ae+`
`)}),L.flush()})((n=e.initSegment)!==null&&n!==void 0&&n.data?(0,ie.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],this.timescale[e.cc],i,e.cc,e.start,function(s){a._appendCues(s,e.level),r.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){a._fallbackToIMSC1(e,t),k.logger.log("Failed to parse VTT cue: "+s),r.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},o._fallbackToIMSC1=function(e,t){var i=this,n=this.tracks[e.level];n.textCodec||Ri(t,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=Hr,i._parseIMSC1(e,t)},function(){n.textCodec="wvtt"})},o._appendCues=function(e,t){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(function(s){return Je(n,s)})}else{var a=this.tracks[t];if(!a)return;var r=a.default?"default":"subtitles"+t;i.trigger(c.Events.CUES_PARSED,{type:"subtitles",cues:e,track:r})}},o.onFragDecrypted=function(e,t){var i=t.frag;if(i.type===x.PlaylistLevelType.SUBTITLE){if(!(0,F.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(c.Events.FRAG_LOADED,t)}},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&i&&n){var a=t.frag,r=t.samples;if(a.type!==x.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(a)!=="NONE")for(var s=0;s<r.length;s++){var l=r[s].bytes;if(l){var u=this.extractCea608Data(l);i.addData(r[s].pts,u[0]),n.addData(r[s].pts,u[1])}}}},o.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,a=t.endOffsetSubtitles,r=t.type,s=this.media;if(s&&!(s.currentTime<n)){if(!r||r==="video"){var l=this.captionsTracks;Object.keys(l).forEach(function(d){return st(l[d],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&a!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return st(u[d],i,a)})}}},o.extractCea608Data=function(e){for(var t=[[],[]],i=31&e[0],n=2,a=0;a<i;a++){var r=e[n++],s=127&e[n++],l=127&e[n++];if((s!==0||l!==0)&&4&r){var u=3&r;u!==0&&u!==1||(t[u].push(s),t[u].push(l))}}return t},h}();function On(h,o){return h&&h.label===o.name&&!(h.textTrack1||h.textTrack2)}function Pn(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}const xn=function(){function h(i){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var o,e,t=h.prototype;return t.setStreamController=function(i){this.streamController=i},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var i=this.hls;i.on(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var i=this.hls;i.off(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(i,n){h.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},t.onMediaAttaching=function(i,n){this.media=n.media instanceof HTMLVideoElement?n.media:null,this.clientRect=null},t.onManifestParsed=function(i,n){var a=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,a.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onBufferCodecs=function(i,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(i.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},t.getMaxLevel=function(i){var n=this,a=this.hls.levels;if(!a.length)return-1;var r=a.filter(function(s,l){return h.isLevelAllowed(l,n.restrictedLevels)&&l<=i});return this.clientRect=null,h.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,n={width:0,height:0};if(i){var a=i.getBoundingClientRect();n.width=a.width,n.height=a.height,n.width||n.height||(n.width=a.right-a.left||i.width||0,n.height=a.bottom-a.top||i.height||0)}return this.clientRect=n,n},h.isLevelAllowed=function(i,n){return n===void 0&&(n=[]),n.indexOf(i)===-1},h.getMaxLevelByMediaSize=function(i,n,a){if(!i||!i.length)return-1;for(var r,s,l=i.length-1,u=0;u<i.length;u+=1){var d=i[u];if((d.width>=n||d.height>=a)&&(r=d,!(s=i[u+1])||r.width!==s.width||r.height!==s.height)){l=u;break}}return l},o=h,(e=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch(n){}return i}}])&&Pn(o.prototype,e),Object.defineProperty(o,"prototype",{writable:!1}),h}(),Fn=function(){function h(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var o=h.prototype;return o.setStreamController=function(e){this.streamController=e},o.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},o.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching)},o.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},o.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},o.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var a=n-this.lastTime,r=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,l=1e3*r/a,u=this.hls;if(u.trigger(c.Events.FPS_DROP,{currentDropped:r,currentDecoded:s,totalDroppedFrames:i}),l>0&&r>u.config.fpsDroppedMonitoringThreshold*s){var d=u.currentLevel;k.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d-=1,u.trigger(c.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},o.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},h}();var Wt=q(300);function Wr(h){var o=typeof Map=="function"?new Map:void 0;return Wr=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(e))return o.get(e);o.set(e,i)}function i(){return qr(e,arguments,Xr(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),ar(i,e)},Wr(h)}function qr(h,o,e){return qr=Mn()?Reflect.construct.bind():function(t,i,n){var a=[null];a.push.apply(a,i);var r=new(Function.bind.apply(t,a));return n&&ar(r,n.prototype),r},qr.apply(null,arguments)}function Mn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(h){return!1}}function ar(h,o){return ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ar(h,o)}function Xr(h){return Xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Xr(h)}var gr="[eme]",wi=function(){function h(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=h.CDMCleanupPromise?[h.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=k.logger.debug.bind(k.logger,gr),this.log=k.logger.log.bind(k.logger,gr),this.warn=k.logger.warn.bind(k.logger,gr),this.error=k.logger.error.bind(k.logger,gr),this.hls=e,this.config=e.config,this.registerListeners()}var o=h.prototype;return o.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},o.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},o.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},o.getLicenseServerUrl=function(e){var t=this.config,i=t.drmSystems,n=t.widevineLicenseUrl,a=i[e];if(a)return a.licenseUrl;if(e===N.WIDEVINE&&n)return n;throw new Error('no license server URL configured for key-system "'+e+'"')},o.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},o.attemptKeySystemAccess=function(e){var t=this,i=this.hls.levels,n=function(s,l,u){return!!s&&u.indexOf(s)===l},a=i.map(function(s){return s.audioCodec}).filter(n),r=i.map(function(s){return s.videoCodec}).filter(n);return a.length+r.length===0&&r.push("avc1.42e01e"),new Promise(function(s,l){(function u(d){var f=d.shift();t.getMediaKeysPromise(f,a,r).then(function(g){return s({keySystem:f,mediaKeys:g})}).catch(function(g){d.length?u(d):l(g instanceof Rt?g:new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})})(e)})},o.requestMediaKeySystemAccess=function(e,t){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var n="Configured requestMediaKeySystemAccess is not a function "+i;return se===null&&self.location.protocol==="http:"&&(n="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(n))}return i(e,t)},o.getMediaKeysPromise=function(e,t,i){var n=this,a=function(u,d,f,g){var p;switch(u){case N.FAIRPLAY:p=["cenc","sinf"];break;case N.WIDEVINE:case N.PLAYREADY:p=["cenc"];break;case N.CLEARKEY:p=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+u)}return function(m,A,L,_){return[{initDataTypes:m,persistentState:_.persistentState||"not-allowed",distinctiveIdentifier:_.distinctiveIdentifier||"not-allowed",sessionTypes:_.sessionTypes||[_.sessionType||"temporary"],audioCapabilities:A.map(function(K){return{contentType:'audio/mp4; codecs="'+K+'"',robustness:_.audioRobustness||"",encryptionScheme:_.audioEncryptionScheme||null}}),videoCapabilities:L.map(function(K){return{contentType:'video/mp4; codecs="'+K+'"',robustness:_.videoRobustness||"",encryptionScheme:_.videoEncryptionScheme||null}})}]}(p,d,f,g)}(e,t,i,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e],s=r==null?void 0:r.keySystemAccess;if(!s){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(a)),s=this.requestMediaKeySystemAccess(e,a);var l=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(function(u){n.log('Failed to obtain access to key-system "'+e+'": '+u)}),s.then(function(u){n.log('Access for key-system "'+u.keySystem+'" obtained');var d=n.fetchServerCertificate(e);return n.log('Create media-keys for "'+e+'"'),l.mediaKeys=u.createMediaKeys().then(function(f){return n.log('Media-keys created for "'+e+'"'),d.then(function(g){return g?n.setMediaKeysServerCertificate(f,e,g):f})}),l.mediaKeys.catch(function(f){n.error('Failed to create media-keys for "'+e+'"}: '+f)}),l.mediaKeys})}return s.then(function(){return r.mediaKeys})},o.createMediaKeySessionContext=function(e){var t=e.decryptdata,i=e.keySystem,n=e.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+Wt.default.hexDump(t.keyId||[]));var a=n.createSession(),r={decryptdata:t,keySystem:i,mediaKeys:n,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r},o.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var i=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t);this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(i,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},o.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Wt.default.hexDump(e.keyId)},o.updateKeySession=function(e,t){var i,n=e.mediaKeysSession;return this.log('Updating key-session "'+n.sessionId+'" for keyID '+Wt.default.hexDump(((i=e.decryptdata)===null||i===void 0?void 0:i.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),n.update(t)},o.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},o.getKeyFormatPromise=function(e){var t=this;return new Promise(function(i,n){var a=W(t.config),r=e.map(C).filter(function(s){return!!s&&a.indexOf(s)!==-1});return t.getKeySystemSelectionPromise(r).then(function(s){var l=s.keySystem,u=b(l);u?i(u):n(new Error('Unable to find format for key-system "'+l+'"'))}).catch(n)})},o.loadKey=function(e){var t=this,i=e.keyInfo.decryptdata,n=this.getKeyIdString(i),a="(keyId: "+n+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+a);var r=this.keyIdToKeySessionPromise[n];return r||(r=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(i).then(function(s){var l=s.keySystem,u=s.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+a),t.attemptSetMediaKeys(l,u).then(function(){t.throwIfDestroyed();var d=t.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:i});return t.generateRequestWithPreferredKeySession(d,"cenc",i.pssh,"playlist-key")})})).catch(function(s){return t.handleError(s)}),r},o.throwIfDestroyed=function(e){if(e===void 0&&(e="Invalid state"),!this.hls)throw new Error("invalid state")},o.handleError=function(e){this.hls&&(this.error(e.message),e instanceof Rt?this.hls.trigger(c.Events.ERROR,e.data):this.hls.trigger(c.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},o.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){var n=C(e.keyFormat),a=n?[n]:W(this.config);return this.attemptKeySystemAccess(a)}return i},o.getKeySystemSelectionPromise=function(e){if(e.length||(e=W(this.config)),e.length===0)throw new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},o._onMediaEncrypted=function(e){var t=this,i=e.initDataType,n=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+i+'"'),n!==null){var a,r;if(i==="sinf"&&this.config.drmSystems[N.FAIRPLAY]){var s=(0,ie.bin2str)(new Uint8Array(n));try{var l=B(JSON.parse(s).sinf),u=(0,ie.parseSinf)(new Uint8Array(l));if(!u)return;a=u.subarray(8,24),r=N.FAIRPLAY}catch(K){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var d=(0,ie.parsePssh)(n);if(d===null)return;d.version===0&&d.systemId===ue.WIDEVINE&&d.data&&(a=d.data.subarray(8,24)),r=function(K){if(K===ue.WIDEVINE)return N.WIDEVINE}(d.systemId)}if(r&&a){for(var f=Wt.default.hexDump(a),g=this.keyIdToKeySessionPromise,p=this.mediaKeySessions,m=g[f],A=function(K){var z=p[K],Y=z.decryptdata;if(Y.pssh||!Y.keyId)return"continue";var ee=Wt.default.hexDump(Y.keyId);return f===ee||Y.uri.replace(/-/g,"").indexOf(f)!==-1?(m=g[ee],delete g[ee],Y.pssh=new Uint8Array(n),Y.keyId=a,m=g[f]=m.then(function(){return t.generateRequestWithPreferredKeySession(z,i,n,"encrypted-event-key-match")}),"break"):void 0},L=0;L<p.length;L++){var _=A(L);if(_!=="continue"&&_==="break")break}m||(m=g[f]=this.getKeySystemSelectionPromise([r]).then(function(K){var z,Y=K.keySystem,ee=K.mediaKeys;t.throwIfDestroyed();var Ee=new be("ISO-23001-7",f,(z=b(Y))!=null?z:"");return Ee.pssh=new Uint8Array(n),Ee.keyId=a,t.attemptSetMediaKeys(Y,ee).then(function(){t.throwIfDestroyed();var Se=t.createMediaKeySessionContext({decryptdata:Ee,keySystem:Y,mediaKeys:ee});return t.generateRequestWithPreferredKeySession(Se,i,n,"encrypted-event-no-match")})})),m.catch(function(K){return t.handleError(K)})}}},o._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},o.attemptSetMediaKeys=function(e,t){var i=this,n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var a=Promise.all(n).then(function(){if(!i.media)throw new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(a),a.then(function(){i.log('Media-keys set for "'+e+'"'),n.push(a),i.setMediaKeysQueue=i.setMediaKeysQueue.filter(function(r){return n.indexOf(r)===-1})})},o.generateRequestWithPreferredKeySession=function(e,t,i,n){var a,r,s=this,l=(a=this.config.drmSystems)===null||a===void 0||(r=a[e.keySystem])===null||r===void 0?void 0:r.generateRequest;if(l)try{var u=l.call(this.hls,t,i,e);if(!u)throw new Error("Invalid response from configured generateRequest filter");t=u.initDataType,i=e.decryptdata.pssh=u.initData?new Uint8Array(u.initData):null}catch(m){var d;if(this.warn(m.message),(d=this.hls)!==null&&d!==void 0&&d.config.debug)throw m}if(i===null)return this.log('Skipping key-session request for "'+n+'" (no initData)'),Promise.resolve(e);var f=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+n+'": '+f+" (init data type: "+t+" length: "+(i?i.byteLength:null)+")");var g=new(Qi());e.mediaKeysSession.onmessage=function(m){var A=e.mediaKeysSession;if(A){var L=m.messageType,_=m.message;s.log('"'+L+'" message event for session "'+A.sessionId+'" message size: '+_.byteLength),L==="license-request"||L==="license-renewal"?s.renewLicense(e,_).catch(function(K){s.handleError(K),g.emit("error",K)}):L==="license-release"?e.keySystem===N.FAIRPLAY&&(s.updateKeySession(e,y("acknowledged")),s.removeSession(e)):s.warn('unhandled media key message type "'+L+'"')}else g.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(m){if(e.mediaKeysSession){s.onKeyStatusChange(e);var A=e.keyStatus;g.emit("keyStatus",A),A==="expired"&&(s.warn(e.keySystem+" expired for key "+f),s.renewKeySession(e))}else g.emit("error",new Error("invalid state"))};var p=new Promise(function(m,A){g.on("error",A),g.on("keyStatus",function(L){L.startsWith("usable")?m():L==="output-restricted"?A(new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):L==="internal-error"?A(new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+L+'"')):L==="expired"?A(new Error("key expired while generating request")):s.warn('unhandled key status change "'+L+'"')})});return e.mediaKeysSession.generateRequest(t,i).then(function(){var m;s.log('Request generated for key-session "'+((m=e.mediaKeysSession)===null||m===void 0?void 0:m.sessionId)+'" keyId: '+f)}).catch(function(m){throw new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},"Error generating key-session request: "+m)}).then(function(){return p}).catch(function(m){throw g.removeAllListeners(),s.removeSession(e),m}).then(function(){return g.removeAllListeners(),e})},o.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(i,n){t.log('key status change "'+i+'" for keyStatuses keyId: '+Wt.default.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))+" session keyId: "+Wt.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=i})},o.fetchServerCertificate=function(e){var t=this;return new Promise(function(i,n){var a=t.getServerCertificateUrl(e);if(!a)return i();t.log('Fetching serverCertificate for "'+e+'"');var r=new XMLHttpRequest;r.open("GET",a,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(r.status===200?i(r.response):n(new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r},'"'+e+'" certificate request XHR failed ('+a+"). Status: "+r.status+" ("+r.statusText+")")))},r.send()})},o.setMediaKeysServerCertificate=function(e,t,i){var n=this;return new Promise(function(a,r){e.setServerCertificate(i).then(function(s){n.log("setServerCertificate "+(s?"success":"not supported by CDM")+" ("+(i==null?void 0:i.byteLength)+') on "'+t+'"'),a(e)}).catch(function(s){r(new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:s,fatal:!0},s.message))})})},o.renewLicense=function(e,t){var i=this;return this.requestLicense(e,new Uint8Array(t)).then(function(n){return i.updateKeySession(e,new Uint8Array(n)).catch(function(a){throw new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:a,fatal:!0},a.message)})})},o.setupLicenseXHR=function(e,t,i,n){var a=this,r=this.config.licenseXhrSetup;return r?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return r.call(a.hls,e,t,i,n)}).catch(function(s){if(!i.decryptdata)throw s;return e.open("POST",t,!0),r.call(a.hls,e,t,i,n)}).then(function(s){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:s||n}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))},o.requestLicense=function(e,t){var i=this;return new Promise(function(n,a){var r=i.getLicenseServerUrl(e.keySystem);i.log("Sending license request to URL: "+r);var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=function(){if(!i.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(s.readyState===4)if(s.status===200){i._requestLicenseFailureCount=0;var l=s.response;i.log("License received "+(l instanceof ArrayBuffer?l.byteLength:l));var u=i.config.licenseResponseCallback;if(u)try{l=u.call(i.hls,s,r,e)}catch(f){i.error(f)}n(l)}else if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>3||s.status>=400&&s.status<500)a(new Rt({type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:s},"License Request XHR failed ("+r+"). Status: "+s.status+" ("+s.statusText+")"));else{var d=3-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+d+" attempts left"),i.requestLicense(e,t).then(n,a)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,i.setupLicenseXHR(s,r,e,t).then(function(l){var u=l.xhr,d=l.licenseChallenge;u.send(d)})})},o.onMediaAttached=function(e,t){if(this.config.emeEnabled){var i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}},o.onMediaDetached=function(){var e=this,t=this.media,i=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},be.clearKeyUriToKeyIdMap();var n=i.length;h.CDMCleanupPromise=Promise.all(i.map(function(a){return e.removeSession(a)}).concat(t==null?void 0:t.setMediaKeys(null).catch(function(a){e.log("Could not clear media keys: "+a+". media.src: "+(t==null?void 0:t.src))}))).then(function(){n&&(e.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(function(a){e.log("Could not close sessions and clear media keys: "+a+". media.src: "+(t==null?void 0:t.src))})},o.onManifestLoaded=function(e,t){var i=t.sessionKeys;if(i&&this.config.emeEnabled&&!this.keyFormatPromise){var n=i.reduce(function(a,r){return a.indexOf(r.keyFormat)===-1&&a.push(r.keyFormat),a},[]);this.log("Selecting key-system from session-keys "+n.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(n)}},o.removeSession=function(e){var t=this,i=e.mediaKeysSession,n=e.licenseXhr;if(i){this.log("Remove licenses and keys and close session "+i.sessionId),i.onmessage=null,i.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var a=this.mediaKeySessions.indexOf(e);return a>-1&&this.mediaKeySessions.splice(a,1),i.remove().catch(function(r){t.log("Could not remove session: "+r)}).then(function(){return i.close()}).catch(function(r){t.log("Could not close session: "+r)})}},h}();wi.CDMCleanupPromise=void 0;var Rt=function(h){var o,e;function t(i,n){var a;return(a=h.call(this,n)||this).data=void 0,a.data=i,i.err=i.error,a}return e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,ar(o,e),t}(Wr(Error));const Nn=wi;var bt,zr,Oi;function Pi(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}function xi(h,o,e){return o&&Pi(h.prototype,o),e&&Pi(h,e),Object.defineProperty(h,"prototype",{writable:!1}),h}function Fi(h,o){var e=typeof Symbol!="undefined"&&h[Symbol.iterator]||h["@@iterator"];if(e)return(e=e.call(h)).next.bind(e);if(Array.isArray(h)||(e=function(i,n){if(i){if(typeof i=="string")return Mi(i,n);var a=Object.prototype.toString.call(i).slice(8,-1);return a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set"?Array.from(i):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Mi(i,n):void 0}}(h))||o&&h&&typeof h.length=="number"){e&&(h=e);var t=0;return function(){return t>=h.length?{done:!0}:{done:!1,value:h[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mi(h,o){(o==null||o>h.length)&&(o=h.length);for(var e=0,t=new Array(o);e<o;e++)t[e]=h[e];return t}function vr(){return vr=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},vr.apply(this,arguments)}(function(h){h.MANIFEST="m",h.AUDIO="a",h.VIDEO="v",h.MUXED="av",h.INIT="i",h.CAPTION="c",h.TIMED_TEXT="tt",h.KEY="k",h.OTHER="o"})(bt||(bt={})),function(h){h.DASH="d",h.HLS="h",h.SMOOTH="s",h.OTHER="o"}(zr||(zr={})),function(h){h.VOD="v",h.LIVE="l"}(Oi||(Oi={}));var Un=function(){function h(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(a){try{t.apply(a,{ot:bt.MANIFEST,su:!t.initialized})}catch(r){k.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=function(a){try{var r=a.frag,s=t.hls.levels[r.level],l=t.getObjectType(r),u={d:1e3*r.duration,ot:l};l!==bt.VIDEO&&l!==bt.AUDIO&&l!=bt.MUXED||(u.br=s.bitrate/1e3,u.tb=t.getTopBandwidth(l)/1e3,u.bl=t.getBufferLength(l)),t.apply(a,u)}catch(d){k.logger.warn("Could not generate segment CMCD data.",d)}},this.hls=e;var i=this.config=e.config,n=i.cmcd;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||h.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var o=h.prototype;return o.registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this)},o.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},o.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},o.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},o.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},o.onBufferCreated=function(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)===null||n===void 0?void 0:n.buffer},o.createData=function(){var e;return{v:1,sf:zr.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},o.apply=function(e,t){t===void 0&&(t={}),vr(t,this.createData());var i=t.ot===bt.INIT||t.ot===bt.VIDEO||t.ot===bt.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var n=h.toHeaders(t);if(!Object.keys(n).length)return;e.headers||(e.headers={}),vr(e.headers,n)}else{var a=h.toQuery(t);if(!a)return;e.url=h.appendQueryToUri(e.url,a)}},o.getObjectType=function(e){var t=e.type;return t==="subtitle"?bt.TIMED_TEXT:e.sn==="initSegment"?bt.INIT:t==="audio"?bt.AUDIO:t==="main"?this.hls.audioTracks.length?bt.VIDEO:bt.MUXED:void 0},o.getTopBandwidth=function(e){var t,i=0,n=this.hls;if(e===bt.AUDIO)t=n.audioTracks;else{var a=n.maxAutoLevel,r=a>-1?a+1:n.levels.length;t=n.levels.slice(0,r)}for(var s,l=Fi(t);!(s=l()).done;){var u=s.value;u.bitrate>i&&(i=u.bitrate)}return i>0?i:NaN},o.getBufferLength=function(e){var t=this.hls.media,i=e===bt.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*lt.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN},o.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var a=n.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(r,s,l){t(r),this.loader.load(r,s,l)},xi(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},o.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var a=n.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(r,s,l){t(r),this.loader.load(r,s,l)},xi(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},h.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},h.serialize=function(e){for(var t,i=[],n=function(m){return!Number.isNaN(m)&&m!=null&&m!==""&&m!==!1},a=function(m){return Math.round(m)},r=function(m){return 100*a(m/100)},s={br:a,d:a,bl:r,dl:r,mtp:r,nor:function(m){return encodeURIComponent(m)},rtp:r,tb:a},l=Fi(Object.keys(e||{}).sort());!(t=l()).done;){var u=t.value,d=e[u];if(n(d)&&!(u==="v"&&d===1||u=="pr"&&d===1)){var f=s[u];f&&(d=f(d));var g,p=typeof d;g=u==="ot"||u==="sf"||u==="st"?u+"="+d:p==="boolean"?u:p==="number"?u+"="+d:u+"="+JSON.stringify(d),i.push(g)}}return i.join(",")},h.toHeaders=function(e){for(var t={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,s=Object.keys(e);r<s.length;r++){var l=s[r];n[a[l]!=null?a[l]:1][l]=e[l]}for(var u=0;u<n.length;u++){var d=h.serialize(n[u]);d&&(t["CMCD-"+i[u]]=d)}return t},h.toQuery=function(e){return"CMCD="+encodeURIComponent(h.serialize(e))},h.appendQueryToUri=function(e,t){if(!t)return e;var i=e.includes("?")?"&":"?";return""+e+i+t},h}(),Ni=q(408),Bn=/^age:\s*[\d.]+\s*$/m;const Ui=function(){function h(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new Ni.LoadStats,this.retryDelay=0}var o=h.prototype;return o.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},o.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},o.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},o.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.retryDelay=t.retryDelay,this.loadInternal()},o.loadInternal=function(){var e=this.config,t=this.context;if(e){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var a=this.xhrSetup;try{if(a)try{a(i,t.url)}catch(l){i.open("GET",t.url,!0),a(i,t.url)}i.readyState||i.open("GET",t.url,!0);var r=this.context.headers;if(r)for(var s in r)i.setRequestHeader(s,r[s])}catch(l){return void this.callbacks.onError({code:i.status,text:l.message},t,i)}t.rangeEnd&&i.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),i.send()}},o.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,a=this.config;if(!i.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),n===4){t.onreadystatechange=null,t.onprogress=null;var r=t.status,s=t.responseType==="arraybuffer";if(r>=200&&r<300&&(s&&t.response||t.responseText!==null)){var l,u;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),u=s?(l=t.response).byteLength:(l=t.responseText).length,i.loaded=i.total=u,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(i,e,l,t),!this.callbacks)return;var f={url:t.responseURL,data:l};this.callbacks.onSuccess(f,i,e,t)}else i.retry>=a.maxRetry||r>=400&&r<499?(k.logger.error(r+" while loading "+e.url),this.callbacks.onError({code:r,text:t.statusText},e,t)):(k.logger.warn(r+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},o.loadtimeout=function(){k.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},o.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},o.getCacheAge=function(){var e=null;if(this.loader&&Bn.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},h}();function Qr(h){var o=typeof Map=="function"?new Map:void 0;return Qr=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(e))return o.get(e);o.set(e,i)}function i(){return $r(e,arguments,Zr(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),sr(i,e)},Qr(h)}function $r(h,o,e){return $r=Gn()?Reflect.construct.bind():function(t,i,n){var a=[null];a.push.apply(a,i);var r=new(Function.bind.apply(t,a));return n&&sr(r,n.prototype),r},$r.apply(null,arguments)}function Gn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(h){return!1}}function sr(h,o){return sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sr(h,o)}function Zr(h){return Zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Zr(h)}function Jr(){return Jr=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Jr.apply(this,arguments)}var Kn=function(){function h(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Hn,this.controller=new self.AbortController,this.stats=new Ni.LoadStats}var o=h.prototype;return o.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},o.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},o.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},o.load=function(e,t,i){var n=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var r=function(d,f){var g={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(Jr({},d.headers))};return d.rangeEnd&&g.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),g}(e,this.controller.signal),s=i.onProgress,l=e.responseType==="arraybuffer",u=l?"byteLength":"length";this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),i.onTimeout(a,e,n.response)},t.timeout),self.fetch(this.request).then(function(d){if(n.response=n.loader=d,!d.ok){var f=d.status,g=d.statusText;throw new jn(g||"fetch, bad network response",f,d)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(d.headers.get("Content-Length")||"0"),s&&(0,F.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(d,a,e,t.highWaterMark,s):l?d.arrayBuffer():d.text()}).then(function(d){var f=n.response;self.clearTimeout(n.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var g=d[u];g&&(a.loaded=a.total=g);var p={url:f.url,data:d};s&&!(0,F.isFiniteNumber)(t.highWaterMark)&&s(a,e,d,f),i.onSuccess(p,a,e,f)}).catch(function(d){if(self.clearTimeout(n.requestTimeout),!a.aborted){var f=d&&d.code||0,g=d?d.message:null;i.onError({code:f,text:g},e,d?d.details:null)}})},o.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},o.loadProgressively=function(e,t,i,n,a){n===void 0&&(n=0);var r=new fi,s=e.body.getReader();return function l(){return s.read().then(function(u){if(u.done)return r.dataLength&&a(t,i,r.flush(),e),Promise.resolve(new ArrayBuffer(0));var d=u.value,f=d.length;return t.loaded+=f,f<n||r.dataLength?(r.push(d),r.dataLength>=n&&a(t,i,r.flush(),e)):a(t,i,d,e),l()}).catch(function(){return Promise.reject()})}()},h}();function Hn(h,o){return new self.Request(h.url,o)}var jn=function(h){var o,e;function t(i,n,a){var r;return(r=h.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=a,r}return e=h,(o=t).prototype=Object.create(e.prototype),o.prototype.constructor=o,sr(o,e),t}(Qr(Error));const Bi=Kn;var Vn=/\s/;function ei(){return ei=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},ei.apply(this,arguments)}function Gi(h,o){var e=Object.keys(h);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(h);o&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(h,i).enumerable})),e.push.apply(e,t)}return e}function Ki(h){for(var o=1;o<arguments.length;o++){var e=arguments[o]!=null?arguments[o]:{};o%2?Gi(Object(e),!0).forEach(function(t){Yn(h,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(e)):Gi(Object(e)).forEach(function(t){Object.defineProperty(h,t,Object.getOwnPropertyDescriptor(e,t))})}return h}function Yn(h,o,e){return(o=function(t){var i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t,"string");return typeof i=="symbol"?i:String(i)}(o))in h?Object.defineProperty(h,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):h[o]=e,h}var Wn=Ki(Ki({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ui,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:rn,bufferController:gn,capLevelController:xn,fpsController:Fn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:se,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(h,o,e,t){for(var i,n,a,r,s,l=[],u=self.VTTCue||self.TextTrackCue,d=0;d<t.rows.length;d++)if(a=!0,r=0,s="",!(i=t.rows[d]).isEmpty()){for(var f=0;f<i.chars.length;f++)Vn.test(i.chars[f].uchar)&&a?r++:(s+=i.chars[f].uchar,a=!1);i.cueStartTime=o,o===e&&(e+=1e-4),r>=16?r--:r++;var g=Li(s.trim()),p=Gr(o,e,g);h&&h.cues&&h.cues.getCueById(p)||((n=new u(o,e,g)).id=p,n.line=d+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*r/32)),l.push(n))}return h&&l.length&&(l.sort(function(m,A){return m.line==="auto"||A.line==="auto"?0:m.line>8&&A.line>8?A.line-m.line:m.line-A.line}),l.forEach(function(m){return Je(h,m)})),l}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:un,subtitleTrackController:fn,timelineController:wn,audioStreamController:an,audioTrackController:on,emeController:Nn,cmcdController:Un});function Hi(h,o){for(var e=0;e<o.length;e++){var t=o[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,typeof(i=function(n,a){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var s=r.call(n,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?i:String(i),t)}var i}var ji=function(){function h(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Rr.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var a=this.config=function(ae,ye){if((ye.liveSyncDurationCount||ye.liveMaxLatencyDurationCount)&&(ye.liveSyncDuration||ye.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(ye.liveMaxLatencyDurationCount!==void 0&&(ye.liveSyncDurationCount===void 0||ye.liveMaxLatencyDurationCount<=ye.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(ye.liveMaxLatencyDuration!==void 0&&(ye.liveSyncDuration===void 0||ye.liveMaxLatencyDuration<=ye.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return ei({},ae,ye)}(h.DefaultConfig,n);this.userConfig=n,(0,k.enableLogs)(a.debug,"Hls instance"),this._autoLevelCapping=-1,a.progressive&&function(ae){var ye=ae.loader;ye!==Bi&&ye!==Ui?(k.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),ae.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(fe){}return!1}()&&(ae.loader=Bi,ae.progressive=!0,ae.enableSoftwareAES=!0,k.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(a);var r=a.abrController,s=a.bufferController,l=a.capLevelController,u=a.fpsController,d=this.abrController=new r(this),f=this.bufferController=new s(this),g=this.capLevelController=new l(this),p=new u(this),m=new Pe(this),A=new at(this),L=this.levelController=new Be(this),_=new Qe(this),K=new Ct(this.config),z=this.streamController=new Ji(this,_,K);g.setStreamController(z),p.setStreamController(z);var Y=[m,L,z];this.networkControllers=Y;var ee=[d,f,g,p,A,_];this.audioTrackController=this.createController(a.audioTrackController,Y);var Ee=a.audioStreamController;Ee&&Y.push(new Ee(this,_,K)),this.subtitleTrackController=this.createController(a.subtitleTrackController,Y);var Se=a.subtitleStreamController;Se&&Y.push(new Se(this,_,K)),this.createController(a.timelineController,ee),K.emeController=this.emeController=this.createController(a.emeController,ee),this.cmcdController=this.createController(a.cmcdController,ee),this.latencyController=this.createController(gt,ee),this.coreComponents=ee}h.isSupported=function(){return function(){var n=Dr();if(!n)return!1;var a=oi(),r=n&&typeof n.isTypeSupported=="function"&&n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!a||a.prototype&&typeof a.prototype.appendBuffer=="function"&&typeof a.prototype.remove=="function";return!!r&&!!s}()};var o,e,t,i=h.prototype;return i.createController=function(n,a){if(n){var r=new n(this);return a&&a.push(r),r}return null},i.on=function(n,a,r){r===void 0&&(r=this),this._emitter.on(n,a,r)},i.once=function(n,a,r){r===void 0&&(r=this),this._emitter.once(n,a,r)},i.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},i.off=function(n,a,r,s){r===void 0&&(r=this),this._emitter.off(n,a,r,s)},i.listeners=function(n){return this._emitter.listeners(n)},i.emit=function(n,a,r){return this._emitter.emit(n,a,r)},i.trigger=function(n,a){if(this.config.debug)return this.emit(n,n,a);try{return this.emit(n,n,a)}catch(r){k.logger.error("An internal error happened while handling event "+n+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(c.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:r})}return!1},i.listenerCount=function(n){return this._emitter.listenerCount(n)},i.destroy=function(){k.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},i.attachMedia=function(n){k.logger.log("attachMedia"),this._media=n,this.trigger(c.Events.MEDIA_ATTACHING,{media:n})},i.detachMedia=function(){k.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(n){this.stopLoad();var a=this.media,r=this.url,s=this.url=Q.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});k.logger.log("loadSource:"+s),a&&r&&r!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(a)),this.trigger(c.Events.MANIFEST_LOADING,{url:n})},i.startLoad=function(n){n===void 0&&(n=-1),k.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(a){a.startLoad(n)})},i.stopLoad=function(){k.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},i.swapAudioCodec=function(){k.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){k.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},i.removeLevel=function(n,a){a===void 0&&(a=0),this.levelController.removeLevel(n,a)},o=h,t=[{key:"version",get:function(){return"1.3.5"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return E.ErrorTypes}},{key:"ErrorDetails",get:function(){return E.ErrorDetails}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:Wn},set:function(n){h.defaultConfig=n}}],(e=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){k.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){k.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){k.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){k.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){k.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var a=!!n;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(k.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(n){vt.indexOf(n)>-1&&(this._maxHdcpLevel=n)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,a=this.config.minAutoBitrate;if(!n)return 0;for(var r=n.length,s=0;s<r;s++)if(n[s].maxBitrate>=a)return s;return 0}},{key:"maxAutoLevel",get:function(){var n,a=this.levels,r=this.autoLevelCapping,s=this.maxHdcpLevel;if(n=r===-1&&a&&a.length?a.length-1:r,s)for(var l=n;l--;){var u=a[l].attrs["HDCP-LEVEL"];if(u&&u<=s)return l}return n}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var a=this.audioTrackController;a&&(a.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var a=this.subtitleTrackController;a&&(a.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Hi(o.prototype,e),t&&Hi(o,t),Object.defineProperty(o,"prototype",{writable:!1}),h}();ji.defaultConfig=void 0},923:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{BaseSegment:()=>X,ElementaryStreamTypes:()=>oe,Fragment:()=>$,Part:()=>O});var oe,Q=q(965),F=q(945),c=q(408);function E(V,U){V.prototype=Object.create(U.prototype),V.prototype.constructor=V,k(V,U)}function k(V,U){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(G,N){return G.__proto__=N,G},k(V,U)}function ce(V,U){for(var G=0;G<U.length;G++){var N=U[G];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(V,typeof(le=function(ue,Re){if(typeof ue!="object"||ue===null)return ue;var B=ue[Symbol.toPrimitive];if(B!==void 0){var y=B.call(ue,Re);if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ue)}(N.key,"string"))=="symbol"?le:String(le),N)}var le}function M(V,U,G){return U&&ce(V.prototype,U),G&&ce(V,G),Object.defineProperty(V,"prototype",{writable:!1}),V}(function(V){V.AUDIO="audio",V.VIDEO="video",V.AUDIOVIDEO="audiovideo"})(oe||(oe={}));var X=function(){function V(U){var G;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((G={})[oe.AUDIO]=null,G[oe.VIDEO]=null,G[oe.AUDIOVIDEO]=null,G),this.baseurl=U}return V.prototype.setByteRange=function(U,G){var N=U.split("@",2),le=[];N.length===1?le[0]=G?G.byteRangeEndOffset:0:le[0]=parseInt(N[1]),le[1]=parseInt(N[0])+le[0],this._byteRange=le},M(V,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,F.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(U){this._url=U}}]),V}(),$=function(V){function U(N,le){var ue;return(ue=V.call(this,le)||this)._decryptdata=null,ue.rawProgramDateTime=null,ue.programDateTime=null,ue.tagList=[],ue.duration=0,ue.sn=0,ue.levelkeys=void 0,ue.type=void 0,ue.loader=null,ue.keyLoader=null,ue.level=-1,ue.cc=0,ue.startPTS=void 0,ue.endPTS=void 0,ue.appendedPTS=void 0,ue.startDTS=void 0,ue.endDTS=void 0,ue.start=0,ue.deltaPTS=void 0,ue.maxStartPTS=void 0,ue.minEndPTS=void 0,ue.stats=new c.LoadStats,ue.urlId=0,ue.data=void 0,ue.bitrateTest=!1,ue.title=null,ue.initSegment=null,ue.endList=void 0,ue.type=N,ue}E(U,V);var G=U.prototype;return G.setKeyFormat=function(N){if(this.levelkeys){var le=this.levelkeys[N];le&&!this._decryptdata&&(this._decryptdata=le.getDecryptData(this.sn))}},G.abortRequests=function(){var N,le;(N=this.loader)===null||N===void 0||N.abort(),(le=this.keyLoader)===null||le===void 0||le.abort()},G.setElementaryStreamInfo=function(N,le,ue,Re,B,y){y===void 0&&(y=!1);var C=this.elementaryStreams,b=C[N];b?(b.startPTS=Math.min(b.startPTS,le),b.endPTS=Math.max(b.endPTS,ue),b.startDTS=Math.min(b.startDTS,Re),b.endDTS=Math.max(b.endDTS,B)):C[N]={startPTS:le,endPTS:ue,startDTS:Re,endDTS:B,partial:y}},G.clearElementaryStreamInfo=function(){var N=this.elementaryStreams;N[oe.AUDIO]=null,N[oe.VIDEO]=null,N[oe.AUDIOVIDEO]=null},M(U,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var N=this.levelkeys.identity;if(N)this._decryptdata=N.getDecryptData(this.sn);else{var le=Object.keys(this.levelkeys);if(le.length===1)return this._decryptdata=this.levelkeys[le[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,Q.isFiniteNumber)(this.programDateTime))return null;var N=(0,Q.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*N}},{key:"encrypted",get:function(){var N;if((N=this._decryptdata)!==null&&N!==void 0&&N.encrypted)return!0;if(this.levelkeys){var le=Object.keys(this.levelkeys),ue=le.length;if(ue>1||ue===1&&this.levelkeys[le[0]].encrypted)return!0}return!1}}]),U}(X),O=function(V){function U(G,N,le,ue,Re){var B;(B=V.call(this,le)||this).fragOffset=0,B.duration=0,B.gap=!1,B.independent=!1,B.relurl=void 0,B.fragment=void 0,B.index=void 0,B.stats=new c.LoadStats,B.duration=G.decimalFloatingPoint("DURATION"),B.gap=G.bool("GAP"),B.independent=G.bool("INDEPENDENT"),B.relurl=G.enumeratedString("URI"),B.fragment=N,B.index=ue;var y=G.enumeratedString("BYTERANGE");return y&&B.setByteRange(y,Re),Re&&(B.fragOffset=Re.fragOffset+Re.duration),B}return E(U,V),M(U,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var G=this.elementaryStreams;return!!(G.audio||G.video||G.audiovideo)}}]),U}(X)},408:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{LoadStats:()=>oe});var oe=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{MAX_SAFE_INTEGER:()=>Q,isFiniteNumber:()=>oe});var oe=Number.isFinite||function(F){return typeof F=="number"&&isFinite(F)},Q=Number.MAX_SAFE_INTEGER||9007199254740991},524:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{default:()=>G,flushTextTrackMetadataCueSamples:()=>le,flushTextTrackUserdataCueSamples:()=>ue,normalizePts:()=>N});var oe=q(965);const Q=function(){function y(){}return y.getSilentFrame=function(C,b){if(C==="mp4a.40.2"){if(b===1)return new Uint8Array([0,200,0,128,35,128]);if(b===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(b===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(b===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(b===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(b===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(b===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},y}();var F=Math.pow(2,32)-1,c=function(){function y(){}return y.init=function(){var C;for(C in y.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},y.types)y.types.hasOwnProperty(C)&&(y.types[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);var b=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),W=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);y.HDLR_TYPES={video:b,audio:W};var se=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),ie=new Uint8Array([0,0,0,0,0,0,0,0]);y.STTS=y.STSC=y.STCO=ie,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var te=new Uint8Array([105,115,111,109]),be=new Uint8Array([97,118,99,49]),Ae=new Uint8Array([0,0,0,1]);y.FTYP=y.box(y.types.ftyp,te,Ae,te,be),y.DINF=y.box(y.types.dinf,y.box(y.types.dref,se))},y.box=function(C){for(var b=8,W=arguments.length,se=new Array(W>1?W-1:0),ie=1;ie<W;ie++)se[ie-1]=arguments[ie];for(var te=se.length,be=te;te--;)b+=se[te].byteLength;var Ae=new Uint8Array(b);for(Ae[0]=b>>24&255,Ae[1]=b>>16&255,Ae[2]=b>>8&255,Ae[3]=255&b,Ae.set(C,4),te=0,b=8;te<be;te++)Ae.set(se[te],b),b+=se[te].byteLength;return Ae},y.hdlr=function(C){return y.box(y.types.hdlr,y.HDLR_TYPES[C])},y.mdat=function(C){return y.box(y.types.mdat,C)},y.mdhd=function(C,b){b*=C;var W=Math.floor(b/(F+1)),se=Math.floor(b%(F+1));return y.box(y.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,255&C,W>>24,W>>16&255,W>>8&255,255&W,se>>24,se>>16&255,se>>8&255,255&se,85,196,0,0]))},y.mdia=function(C){return y.box(y.types.mdia,y.mdhd(C.timescale,C.duration),y.hdlr(C.type),y.minf(C))},y.mfhd=function(C){return y.box(y.types.mfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,255&C]))},y.minf=function(C){return C.type==="audio"?y.box(y.types.minf,y.box(y.types.smhd,y.SMHD),y.DINF,y.stbl(C)):y.box(y.types.minf,y.box(y.types.vmhd,y.VMHD),y.DINF,y.stbl(C))},y.moof=function(C,b,W){return y.box(y.types.moof,y.mfhd(C),y.traf(W,b))},y.moov=function(C){for(var b=C.length,W=[];b--;)W[b]=y.trak(C[b]);return y.box.apply(null,[y.types.moov,y.mvhd(C[0].timescale,C[0].duration)].concat(W).concat(y.mvex(C)))},y.mvex=function(C){for(var b=C.length,W=[];b--;)W[b]=y.trex(C[b]);return y.box.apply(null,[y.types.mvex].concat(W))},y.mvhd=function(C,b){b*=C;var W=Math.floor(b/(F+1)),se=Math.floor(b%(F+1)),ie=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,255&C,W>>24,W>>16&255,W>>8&255,255&W,se>>24,se>>16&255,se>>8&255,255&se,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return y.box(y.types.mvhd,ie)},y.sdtp=function(C){var b,W,se=C.samples||[],ie=new Uint8Array(4+se.length);for(b=0;b<se.length;b++)W=se[b].flags,ie[b+4]=W.dependsOn<<4|W.isDependedOn<<2|W.hasRedundancy;return y.box(y.types.sdtp,ie)},y.stbl=function(C){return y.box(y.types.stbl,y.stsd(C),y.box(y.types.stts,y.STTS),y.box(y.types.stsc,y.STSC),y.box(y.types.stsz,y.STSZ),y.box(y.types.stco,y.STCO))},y.avc1=function(C){var b,W,se,ie=[],te=[];for(b=0;b<C.sps.length;b++)se=(W=C.sps[b]).byteLength,ie.push(se>>>8&255),ie.push(255&se),ie=ie.concat(Array.prototype.slice.call(W));for(b=0;b<C.pps.length;b++)se=(W=C.pps[b]).byteLength,te.push(se>>>8&255),te.push(255&se),te=te.concat(Array.prototype.slice.call(W));var be=y.box(y.types.avcC,new Uint8Array([1,ie[3],ie[4],ie[5],255,224|C.sps.length].concat(ie).concat([C.pps.length]).concat(te))),Ae=C.width,De=C.height,Le=C.pixelRatio[0],Me=C.pixelRatio[1];return y.box(y.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Ae>>8&255,255&Ae,De>>8&255,255&De,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),be,y.box(y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),y.box(y.types.pasp,new Uint8Array([Le>>24,Le>>16&255,Le>>8&255,255&Le,Me>>24,Me>>16&255,Me>>8&255,255&Me])))},y.esds=function(C){var b=C.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(C.config).concat([6,1,2]))},y.mp4a=function(C){var b=C.samplerate;return y.box(y.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,b>>8&255,255&b,0,0]),y.box(y.types.esds,y.esds(C)))},y.mp3=function(C){var b=C.samplerate;return y.box(y.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,b>>8&255,255&b,0,0]))},y.stsd=function(C){return C.type==="audio"?C.segmentCodec==="mp3"&&C.codec==="mp3"?y.box(y.types.stsd,y.STSD,y.mp3(C)):y.box(y.types.stsd,y.STSD,y.mp4a(C)):y.box(y.types.stsd,y.STSD,y.avc1(C))},y.tkhd=function(C){var b=C.id,W=C.duration*C.timescale,se=C.width,ie=C.height,te=Math.floor(W/(F+1)),be=Math.floor(W%(F+1));return y.box(y.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,0,0,0,0,te>>24,te>>16&255,te>>8&255,255&te,be>>24,be>>16&255,be>>8&255,255&be,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,se>>8&255,255&se,0,0,ie>>8&255,255&ie,0,0]))},y.traf=function(C,b){var W=y.sdtp(C),se=C.id,ie=Math.floor(b/(F+1)),te=Math.floor(b%(F+1));return y.box(y.types.traf,y.box(y.types.tfhd,new Uint8Array([0,0,0,0,se>>24,se>>16&255,se>>8&255,255&se])),y.box(y.types.tfdt,new Uint8Array([1,0,0,0,ie>>24,ie>>16&255,ie>>8&255,255&ie,te>>24,te>>16&255,te>>8&255,255&te])),y.trun(C,W.length+16+20+8+16+8+8),W)},y.trak=function(C){return C.duration=C.duration||4294967295,y.box(y.types.trak,y.tkhd(C),y.mdia(C))},y.trex=function(C){var b=C.id;return y.box(y.types.trex,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},y.trun=function(C,b){var W,se,ie,te,be,Ae,De=C.samples||[],Le=De.length,Me=12+16*Le,Ze=new Uint8Array(Me);for(b+=8+Me,Ze.set([C.type==="video"?1:0,0,15,1,Le>>>24&255,Le>>>16&255,Le>>>8&255,255&Le,b>>>24&255,b>>>16&255,b>>>8&255,255&b],0),W=0;W<Le;W++)ie=(se=De[W]).duration,te=se.size,be=se.flags,Ae=se.cts,Ze.set([ie>>>24&255,ie>>>16&255,ie>>>8&255,255&ie,te>>>24&255,te>>>16&255,te>>>8&255,255&te,be.isLeading<<2|be.dependsOn,be.isDependedOn<<6|be.hasRedundancy<<4|be.paddingValue<<1|be.isNonSync,61440&be.degradPrio,15&be.degradPrio,Ae>>>24&255,Ae>>>16&255,Ae>>>8&255,255&Ae],12+16*W);return y.box(y.types.trun,Ze)},y.initSegment=function(C){y.types||y.init();var b=y.moov(C),W=new Uint8Array(y.FTYP.byteLength+b.byteLength);return W.set(y.FTYP),W.set(b,y.FTYP.byteLength),W},y}();c.types=void 0,c.HDLR_TYPES=void 0,c.STTS=void 0,c.STSC=void 0,c.STCO=void 0,c.STSZ=void 0,c.VMHD=void 0,c.SMHD=void 0,c.STSD=void 0,c.FTYP=void 0,c.DINF=void 0;const E=c;var k=q(851),ce=q(973),M=q(93),X=q(308),$=q(673);function O(){return O=Object.assign?Object.assign.bind():function(y){for(var C=1;C<arguments.length;C++){var b=arguments[C];for(var W in b)Object.prototype.hasOwnProperty.call(b,W)&&(y[W]=b[W])}return y},O.apply(this,arguments)}var V=null,U=null,G=function(){function y(b,W,se,ie){if(ie===void 0&&(ie=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=b,this.config=W,this.typeSupported=se,this.ISGenerated=!1,V===null){var te=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);V=te?parseInt(te[1]):0}if(U===null){var be=navigator.userAgent.match(/Safari\/(\d+)/i);U=be?parseInt(be[1]):0}}var C=y.prototype;return C.destroy=function(){},C.resetTimeStamp=function(b){M.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=b},C.resetNextTimestamp=function(){M.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},C.resetInitSegment=function(){M.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},C.getVideoStartPts=function(b){var W=!1,se=b.reduce(function(ie,te){var be=te.pts-ie;return be<-4294967296?(W=!0,N(ie,te.pts)):be>0?ie:te.pts},b[0].pts);return W&&M.logger.debug("PTS rollover detected"),se},C.remux=function(b,W,se,ie,te,be,Ae,De){var Le,Me,Ze,j,Z,H,de=te,he=te,pe=b.pid>-1,ve=W.pid>-1,Te=W.samples.length,Ce=b.samples.length>0,x=Ae&&Te>0||Te>1;if((!pe||Ce)&&(!ve||x)||this.ISGenerated||Ae){this.ISGenerated||(Ze=this.generateIS(b,W,te));var Oe,Pe=this.isVideoContiguous,je=-1;if(x&&(je=function(qe){for(var Xe=0;Xe<qe.length;Xe++)if(qe[Xe].key)return Xe;return-1}(W.samples),!Pe&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,je>0){M.logger.warn("[mp4-remuxer]: Dropped "+je+" out of "+Te+" video samples due to a missing keyframe");var Je=this.getVideoStartPts(W.samples);W.samples=W.samples.slice(je),W.dropped+=je,Oe=he+=(W.samples[0].pts-Je)/W.inputTimeScale}else je===-1&&(M.logger.warn("[mp4-remuxer]: No keyframe found out of "+Te+" video samples"),H=!1);if(this.ISGenerated){if(Ce&&x){var et=this.getVideoStartPts(W.samples),st=(N(b.samples[0].pts,et)-et)/W.inputTimeScale;de+=Math.max(0,st),he+=Math.max(0,-st)}if(Ce){if(b.samplerate||(M.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Ze=this.generateIS(b,W,te)),Me=this.remuxAudio(b,de,this.isAudioContiguous,be,ve||x||De===X.PlaylistLevelType.AUDIO?he:void 0),x){var tt=Me?Me.endPTS-Me.startPTS:0;W.inputTimeScale||(M.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Ze=this.generateIS(b,W,te)),Le=this.remuxVideo(W,he,Pe,tt)}}else x&&(Le=this.remuxVideo(W,he,Pe,0));Le&&(Le.firstKeyFrame=je,Le.independent=je!==-1,Le.firstKeyFramePTS=Oe)}}return this.ISGenerated&&(se.samples.length&&(Z=le(se,te,this._initPTS,this._initDTS)),ie.samples.length&&(j=ue(ie,te,this._initPTS))),{audio:Me,video:Le,initSegment:Ze,independent:H,text:j,id3:Z}},C.generateIS=function(b,W,se){var ie,te,be,Ae=b.samples,De=W.samples,Le=this.typeSupported,Me={},Ze=!(0,oe.isFiniteNumber)(this._initPTS),j="audio/mp4";if(Ze&&(ie=te=1/0),b.config&&Ae.length&&(b.timescale=b.samplerate,b.segmentCodec==="mp3"&&(Le.mpeg?(j="audio/mpeg",b.codec=""):Le.mp3&&(b.codec="mp3")),Me.audio={id:"audio",container:j,codec:b.codec,initSegment:b.segmentCodec==="mp3"&&Le.mpeg?new Uint8Array(0):E.initSegment([b]),metadata:{channelCount:b.channelCount}},Ze&&(be=b.inputTimeScale,ie=te=Ae[0].pts-Math.round(be*se))),W.sps&&W.pps&&De.length&&(W.timescale=W.inputTimeScale,Me.video={id:"main",container:"video/mp4",codec:W.codec,initSegment:E.initSegment([W]),metadata:{width:W.width,height:W.height}},Ze)){be=W.inputTimeScale;var Z=this.getVideoStartPts(De),H=Math.round(be*se);te=Math.min(te,N(De[0].dts,Z)-H),ie=Math.min(ie,Z-H)}if(Object.keys(Me).length)return this.ISGenerated=!0,Ze&&(this._initPTS=ie,this._initDTS=te),{tracks:Me,initPTS:ie,timescale:be}},C.remuxVideo=function(b,W,se,ie){var te,be,Ae=b.inputTimeScale,De=b.samples,Le=[],Me=De.length,Ze=this._initPTS,j=this.nextAvcDts,Z=8,H=this.videoSampleDuration,de=Number.POSITIVE_INFINITY,he=Number.NEGATIVE_INFINITY,pe=!1;se&&j!==null||(j=W*Ae-(De[0].pts-N(De[0].dts,De[0].pts)));for(var ve=0;ve<Me;ve++){var Te=De[ve];Te.pts=N(Te.pts-Ze,j),Te.dts=N(Te.dts-Ze,j),Te.dts<De[ve>0?ve-1:ve].dts&&(pe=!0)}pe&&De.sort(function(ot,yt){var Ct=ot.dts-yt.dts,Ht=ot.pts-yt.pts;return Ct||Ht}),te=De[0].dts;var Ce=De[De.length-1].dts-te,x=Ce?Math.round(Ce/(Me-1)):H||b.inputTimeScale/30;if(se){var Oe=te-j,Pe=Oe>x,je=Oe<-1;if((Pe||je)&&(Pe?M.logger.warn("AVC: "+(0,$.toMsFromMpegTsClock)(Oe,!0)+" ms ("+Oe+"dts) hole between fragments detected, filling it"):M.logger.warn("AVC: "+(0,$.toMsFromMpegTsClock)(-Oe,!0)+" ms ("+Oe+"dts) overlapping between fragments detected"),!je||j>De[0].pts)){te=j;var Je=De[0].pts-Oe;De[0].dts=te,De[0].pts=Je,M.logger.log("Video: First PTS/DTS adjusted: "+(0,$.toMsFromMpegTsClock)(Je,!0)+"/"+(0,$.toMsFromMpegTsClock)(te,!0)+", delta: "+(0,$.toMsFromMpegTsClock)(Oe,!0)+" ms")}}te=Math.max(0,te);for(var et=0,st=0,tt=0;tt<Me;tt++){for(var qe=De[tt],Xe=qe.units,ze=Xe.length,Ve=0,at=0;at<ze;at++)Ve+=Xe[at].data.length;st+=Ve,et+=ze,qe.length=Ve,qe.dts=Math.max(qe.dts,te),de=Math.min(qe.pts,de),he=Math.max(qe.pts,he)}be=De[Me-1].dts;var ct,gt=st+4*et+8;try{ct=new Uint8Array(gt)}catch(ot){return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:ce.ErrorTypes.MUX_ERROR,details:ce.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:gt,reason:"fail allocating video mdat "+gt})}var St=new DataView(ct.buffer);St.setUint32(0,gt),ct.set(E.types.mdat,4);for(var Et=!1,vt=Number.POSITIVE_INFINITY,P=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,v=Number.NEGATIVE_INFINITY,T=0;T<Me;T++){for(var S=De[T],R=S.units,I=0,w=0,J=R.length;w<J;w++){var re=R[w],ne=re.data,ge=re.data.byteLength;St.setUint32(Z,ge),Z+=4,ct.set(ne,Z),Z+=ge,I+=4+ge}var Ie=void 0;if(T<Me-1)H=De[T+1].dts-S.dts,Ie=De[T+1].pts-S.pts;else{var me=this.config,we=T>0?S.dts-De[T-1].dts:x;if(Ie=T>0?S.pts-De[T-1].pts:x,me.stretchShortVideoTrack&&this.nextAudioPts!==null){var Be=Math.floor(me.maxBufferHole*Ae),Qe=(ie?de+ie*Ae:this.nextAudioPts)-S.pts;Qe>Be?((H=Qe-we)<0?H=we:Et=!0,M.logger.log("[mp4-remuxer]: It is approximately "+Qe/90+" ms to the next segment; using duration "+H/90+" ms for the last video frame.")):H=we}else H=we}var _e=Math.round(S.pts-S.dts);vt=Math.min(vt,H),D=Math.max(D,H),P=Math.min(P,Ie),v=Math.max(v,Ie),Le.push(new Re(S.key,H,I,_e))}if(Le.length){if(V){if(V<70){var rt=Le[0].flags;rt.dependsOn=2,rt.isNonSync=0}}else if(U&&v-P<D-vt&&x/D<.025&&Le[0].cts===0){M.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var pt=te,it=0,mt=Le.length;it<mt;it++){var dt=pt+Le[it].duration,xe=pt+Le[it].cts;if(it<mt-1){var Lt=dt+Le[it+1].cts;Le[it].duration=Lt-xe}else Le[it].duration=it?Le[it-1].duration:x;Le[it].cts=0,pt=dt}}}H=Et||!H?x:H,this.nextAvcDts=j=be+H,this.videoSampleDuration=H,this.isVideoContiguous=!0;var It={data1:E.moof(b.sequenceNumber++,te,O({},b,{samples:Le})),data2:ct,startPTS:de/Ae,endPTS:(he+H)/Ae,startDTS:te/Ae,endDTS:j/Ae,type:"video",hasAudio:!1,hasVideo:!0,nb:Le.length,dropped:b.dropped};return b.samples=[],b.dropped=0,It},C.remuxAudio=function(b,W,se,ie,te){var be=b.inputTimeScale,Ae=be/(b.samplerate?b.samplerate:be),De=b.segmentCodec==="aac"?1024:1152,Le=De*Ae,Me=this._initPTS,Ze=b.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],Z=te!==void 0,H=b.samples,de=Ze?0:8,he=this.nextAudioPts||-1,pe=W*be;if(this.isAudioContiguous=se=se||H.length&&he>0&&(ie&&Math.abs(pe-he)<9e3||Math.abs(N(H[0].pts-Me,pe)-he)<20*Le),H.forEach(function(w){w.pts=N(w.pts-Me,pe)}),!se||he<0){if(H=H.filter(function(w){return w.pts>=0}),!H.length)return;he=te===0?0:ie&&!Z?Math.max(0,pe):H[0].pts}if(b.segmentCodec==="aac")for(var ve=this.config.maxAudioFramesDrift,Te=0,Ce=he;Te<H.length;Te++){var x=H[Te],Oe=x.pts,Pe=Oe-Ce,je=Math.abs(1e3*Pe/be);if(Pe<=-ve*Le&&Z)Te===0&&(M.logger.warn("Audio frame @ "+(Oe/be).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Pe/be)+" ms."),this.nextAudioPts=he=Ce=Oe);else if(Pe>=ve*Le&&je<1e4&&Z){var Je=Math.round(Pe/Le);(Ce=Oe-Je*Le)<0&&(Je--,Ce+=Le),Te===0&&(this.nextAudioPts=he=Ce),M.logger.warn("[mp4-remuxer]: Injecting "+Je+" audio frame @ "+(Ce/be).toFixed(3)+"s due to "+Math.round(1e3*Pe/be)+" ms gap.");for(var et=0;et<Je;et++){var st=Math.max(Ce,0),tt=Q.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);tt||(M.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),tt=x.unit.subarray()),H.splice(Te,0,{unit:tt,pts:st}),Ce+=Le,Te++}}x.pts=Ce,Ce+=Le}for(var qe,Xe=null,ze=null,Ve=0,at=H.length;at--;)Ve+=H[at].unit.byteLength;for(var ct=0,gt=H.length;ct<gt;ct++){var St=H[ct],Et=St.unit,vt=St.pts;if(ze!==null)j[ct-1].duration=Math.round((vt-ze)/Ae);else{if(se&&b.segmentCodec==="aac"&&(vt=he),Xe=vt,!(Ve>0))return;Ve+=de;try{qe=new Uint8Array(Ve)}catch(w){return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:ce.ErrorTypes.MUX_ERROR,details:ce.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ve,reason:"fail allocating audio mdat "+Ve})}Ze||(new DataView(qe.buffer).setUint32(0,Ve),qe.set(E.types.mdat,4))}qe.set(Et,de);var P=Et.byteLength;de+=P,j.push(new Re(!0,De,P,0)),ze=vt}var D=j.length;if(D){var v=j[j.length-1];this.nextAudioPts=he=ze+Ae*v.duration;var T=Ze?new Uint8Array(0):E.moof(b.sequenceNumber++,Xe/Ae,O({},b,{samples:j}));b.samples=[];var S=Xe/be,R=he/be,I={data1:T,data2:qe,startPTS:S,endPTS:R,startDTS:S,endDTS:R,type:"audio",hasAudio:!0,hasVideo:!1,nb:D};return this.isAudioContiguous=!0,I}},C.remuxEmptyAudio=function(b,W,se,ie){var te=b.inputTimeScale,be=te/(b.samplerate?b.samplerate:te),Ae=this.nextAudioPts,De=(Ae!==null?Ae:ie.startDTS*te)+this._initDTS,Le=ie.endDTS*te+this._initDTS,Me=1024*be,Ze=Math.ceil((Le-De)/Me),j=Q.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);if(M.logger.warn("[mp4-remuxer]: remux empty Audio"),j){for(var Z=[],H=0;H<Ze;H++){var de=De+H*Me;Z.push({unit:j,pts:de,dts:de})}return b.samples=Z,this.remuxAudio(b,W,se,!1)}M.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},y}();function N(y,C){var b;if(C===null)return y;for(b=C<y?-8589934592:8589934592;Math.abs(y-C)>4294967296;)y+=b;return y}function le(y,C,b,W){var se=y.samples.length;if(se){for(var ie=y.inputTimeScale,te=0;te<se;te++){var be=y.samples[te];be.pts=N(be.pts-b,C*ie)/ie,be.dts=N(be.dts-W,C*ie)/ie}var Ae=y.samples;return y.samples=[],{samples:Ae}}}function ue(y,C,b){var W=y.samples.length;if(W){for(var se=y.inputTimeScale,ie=0;ie<W;ie++){var te=y.samples[ie];te.pts=N(te.pts-b,C*se)/se}y.samples.sort(function(Ae,De){return Ae.pts-De.pts});var be=y.samples;return y.samples=[],{samples:be}}}var Re=function(y,C,b,W){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=C,this.size=b,this.cts=W,this.flags=new B(y)},B=function(y){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=y?2:1,this.isNonSync=y?0:1}},856:(Ke,ke,q)=>{"use strict";var oe;q.r(ke),q.d(ke,{MetadataSchema:()=>oe}),function(Q){Q.audioId3="org.id3",Q.dateRange="com.apple.quicktime.HLS",Q.emsg="https://aomedia.org/emsg/ID3"}(oe||(oe={}))},308:(Ke,ke,q)=>{"use strict";var oe,Q;q.r(ke),q.d(ke,{PlaylistContextType:()=>oe,PlaylistLevelType:()=>Q}),function(F){F.MANIFEST="manifest",F.LEVEL="level",F.AUDIO_TRACK="audioTrack",F.SUBTITLE_TRACK="subtitleTrack"}(oe||(oe={})),function(F){F.MAIN="main",F.AUDIO="audio",F.SUBTITLE="subtitle"}(Q||(Q={}))},300:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{default:()=>oe});const oe={hexDump:function(Q){for(var F="",c=0;c<Q.length;c++){var E=Q[c].toString(16);E.length<2&&(E="0"+E),F+=E}return F}}},93:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{enableLogs:()=>E,logger:()=>k});var oe=function(){},Q={trace:oe,debug:oe,log:oe,warn:oe,info:oe,error:oe},F=Q;function c(ce){var M=self.console[ce];return M?M.bind(self.console,"["+ce+"] >"):oe}function E(ce,M){if(self.console&&ce===!0||typeof ce=="object"){(function(X){for(var $=arguments.length,O=new Array($>1?$-1:0),V=1;V<$;V++)O[V-1]=arguments[V];O.forEach(function(U){F[U]=X[U]?X[U].bind(X):c(U)})})(ce,"debug","log","info","warn","error");try{F.log('Debug logs enabled for "'+M+'"')}catch(X){F=Q}}else F=Q}var k=Q},63:(Ke,ke,q)=>{"use strict";q.r(ke),q.d(ke,{RemuxerTrackIdConfig:()=>M,appendUint8Array:()=>se,bin2str:()=>X,computeRawDurationFromSamples:()=>C,discardEPB:()=>Ae,findBox:()=>G,getDuration:()=>y,getStartDTS:()=>B,mp4Box:()=>Le,mp4pssh:()=>Me,offsetStartDTS:()=>b,parseEmsg:()=>De,parseInitSegment:()=>le,parsePssh:()=>Ze,parseSEIMessageFromNALu:()=>be,parseSamples:()=>ie,parseSegmentIndex:()=>N,parseSinf:()=>Re,patchEncyptionData:()=>ue,readSint32:()=>V,readUint16:()=>$,readUint32:()=>O,segmentValidRange:()=>W,writeUint32:()=>U});var oe=q(923),Q=q(145),F=q(181),c=q(93),E=q(300),k=Math.pow(2,32)-1,ce=[].push,M={video:1,audio:2,id3:3,text:4};function X(j){return String.fromCharCode.apply(null,j)}function $(j,Z){var H=j[Z]<<8|j[Z+1];return H<0?65536+H:H}function O(j,Z){var H=V(j,Z);return H<0?4294967296+H:H}function V(j,Z){return j[Z]<<24|j[Z+1]<<16|j[Z+2]<<8|j[Z+3]}function U(j,Z,H){j[Z]=H>>24,j[Z+1]=H>>16&255,j[Z+2]=H>>8&255,j[Z+3]=255&H}function G(j,Z){var H=[];if(!Z.length)return H;for(var de=j.byteLength,he=0;he<de;){var pe=O(j,he),ve=pe>1?he+pe:de;if(X(j.subarray(he+4,he+8))===Z[0])if(Z.length===1)H.push(j.subarray(he+8,ve));else{var Te=G(j.subarray(he+8,ve),Z.slice(1));Te.length&&ce.apply(H,Te)}he=ve}return H}function N(j){var Z=[],H=j[0],de=8,he=O(j,de);de+=4,de+=H===0?8:16,de+=2;var pe=j.length+0,ve=$(j,de);de+=2;for(var Te=0;Te<ve;Te++){var Ce=de,x=O(j,Ce);Ce+=4;var Oe=2147483647&x;if((2147483648&x)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Pe=O(j,Ce);Ce+=4,Z.push({referenceSize:Oe,subsegmentDuration:Pe,info:{duration:Pe/he,start:pe,end:pe+Oe-1}}),pe+=Oe,de=Ce+=4}return{earliestPresentationTime:0,timescale:he,version:H,referencesCount:ve,references:Z}}function le(j){for(var Z=[],H=G(j,["moov","trak"]),de=0;de<H.length;de++){var he=H[de],pe=G(he,["tkhd"])[0];if(pe){var ve=pe[0],Te=ve===0?12:20,Ce=O(pe,Te),x=G(he,["mdia","mdhd"])[0];if(x){var Oe=O(x,Te=(ve=x[0])===0?12:20),Pe=G(he,["mdia","hdlr"])[0];if(Pe){var je=X(Pe.subarray(8,12)),Je={soun:oe.ElementaryStreamTypes.AUDIO,vide:oe.ElementaryStreamTypes.VIDEO}[je];if(Je){var et=G(he,["mdia","minf","stbl","stsd"])[0],st=void 0;et&&(st=X(et.subarray(12,16))),Z[Ce]={timescale:Oe,type:Je},Z[Je]={timescale:Oe,id:Ce,codec:st}}}}}}return G(j,["moov","mvex","trex"]).forEach(function(tt){var qe=O(tt,4),Xe=Z[qe];Xe&&(Xe.default={duration:O(tt,12),flags:O(tt,20)})}),Z}function ue(j,Z){if(!j||!Z)return j;var H=Z.keyId;return H&&Z.isCommonEncryption&&G(j,["moov","trak"]).forEach(function(de){var he=G(de,["mdia","minf","stbl","stsd"])[0].subarray(8),pe=G(he,["enca"]),ve=pe.length>0;ve||(pe=G(he,["encv"])),pe.forEach(function(Te){G(ve?Te.subarray(28):Te.subarray(78),["sinf"]).forEach(function(Ce){var x=Re(Ce);if(x){var Oe=x.subarray(8,24);Oe.some(function(Pe){return Pe!==0})||(c.logger.log("[eme] Patching keyId in 'enc"+(ve?"a":"v")+">sinf>>tenc' box: "+E.default.hexDump(Oe)+" -> "+E.default.hexDump(H)),x.set(H,8))}})})}),j}function Re(j){var Z=G(j,["schm"])[0];if(Z){var H=X(Z.subarray(4,8));if(H==="cbcs"||H==="cenc")return G(j,["schi","tenc"])[0]}return c.logger.error("[eme] missing 'schm' box"),null}function B(j,Z){return G(Z,["moof","traf"]).reduce(function(H,de){var he=G(de,["tfdt"])[0],pe=he[0],ve=G(de,["tfhd"]).reduce(function(Te,Ce){var x=O(Ce,4),Oe=j[x];if(Oe){var Pe=O(he,4);pe===1&&(Pe*=Math.pow(2,32),Pe+=O(he,8));var je=Pe/(Oe.timescale||9e4);if(isFinite(je)&&(Te===null||je<Te))return je}return Te},null);return ve!==null&&isFinite(ve)&&(H===null||ve<H)?ve:H},null)||0}function y(j,Z){for(var H=0,de=0,he=0,pe=G(j,["moof","traf"]),ve=0;ve<pe.length;ve++){var Te=pe[ve],Ce=G(Te,["tfhd"])[0],x=Z[O(Ce,4)];if(x){var Oe=x.default,Pe=O(Ce,0)|(Oe==null?void 0:Oe.flags),je=Oe==null?void 0:Oe.duration;8&Pe&&(je=O(Ce,2&Pe?12:8));for(var Je=x.timescale||9e4,et=G(Te,["trun"]),st=0;st<et.length;st++)!(H=C(et[st]))&&je&&(H=je*O(et[st],4)),x.type===oe.ElementaryStreamTypes.VIDEO?de+=H/Je:x.type===oe.ElementaryStreamTypes.AUDIO&&(he+=H/Je)}}if(de===0&&he===0){for(var tt=0,qe=G(j,["sidx"]),Xe=0;Xe<qe.length;Xe++){var ze=N(qe[Xe]);ze!=null&&ze.references&&(tt+=ze.references.reduce(function(Ve,at){return Ve+at.info.duration||0},0))}return tt}return de||he}function C(j){var Z=O(j,0),H=8;1&Z&&(H+=4),4&Z&&(H+=4);for(var de=0,he=O(j,4),pe=0;pe<he;pe++)256&Z&&(de+=O(j,H),H+=4),512&Z&&(H+=4),1024&Z&&(H+=4),2048&Z&&(H+=4);return de}function b(j,Z,H){G(Z,["moof","traf"]).forEach(function(de){G(de,["tfhd"]).forEach(function(he){var pe=O(he,4),ve=j[pe];if(ve){var Te=ve.timescale||9e4;G(de,["tfdt"]).forEach(function(Ce){var x=Ce[0],Oe=O(Ce,4);if(x===0)Oe-=H*Te,U(Ce,4,Oe=Math.max(Oe,0));else{Oe*=Math.pow(2,32),Oe+=O(Ce,8),Oe-=H*Te,Oe=Math.max(Oe,0);var Pe=Math.floor(Oe/(k+1)),je=Math.floor(Oe%(k+1));U(Ce,4,Pe),U(Ce,8,je)}})}})})}function W(j){var Z={valid:null,remainder:null},H=G(j,["moof"]);if(!H)return Z;if(H.length<2)return Z.remainder=j,Z;var de=H[H.length-1];return Z.valid=(0,Q.sliceUint8)(j,0,de.byteOffset-8),Z.remainder=(0,Q.sliceUint8)(j,de.byteOffset-8),Z}function se(j,Z){var H=new Uint8Array(j.length+Z.length);return H.set(j),H.set(Z,j.length),H}function ie(j,Z){var H=[],de=Z.samples,he=Z.timescale,pe=Z.id,ve=!1;return G(de,["moof"]).map(function(Te){var Ce=Te.byteOffset-8;G(Te,["traf"]).map(function(x){var Oe=G(x,["tfdt"]).map(function(Pe){var je=Pe[0],Je=O(Pe,4);return je===1&&(Je*=Math.pow(2,32),Je+=O(Pe,8)),Je/he})[0];return Oe!==void 0&&(j=Oe),G(x,["tfhd"]).map(function(Pe){var je=O(Pe,4),Je=16777215&O(Pe,0),et=0,st=(16&Je)!=0,tt=0,qe=(32&Je)!=0,Xe=8;je===pe&&(1&Je&&(Xe+=8),2&Je&&(Xe+=4),8&Je&&(et=O(Pe,Xe),Xe+=4),st&&(tt=O(Pe,Xe),Xe+=4),qe&&(Xe+=4),Z.type==="video"&&(ve=function(ze){if(!ze)return!1;var Ve=ze.indexOf("."),at=Ve<0?ze:ze.substring(0,Ve);return at==="hvc1"||at==="hev1"||at==="dvh1"||at==="dvhe"}(Z.codec)),G(x,["trun"]).map(function(ze){var Ve=ze[0],at=16777215&O(ze,0),ct=(1&at)!=0,gt=0,St=(4&at)!=0,Et=(256&at)!=0,vt=0,P=(512&at)!=0,D=0,v=(1024&at)!=0,T=(2048&at)!=0,S=0,R=O(ze,4),I=8;ct&&(gt=O(ze,I),I+=4),St&&(I+=4);for(var w=gt+Ce,J=0;J<R;J++){if(Et?(vt=O(ze,I),I+=4):vt=et,P?(D=O(ze,I),I+=4):D=tt,v&&(I+=4),T&&(S=Ve===0?O(ze,I):V(ze,I),I+=4),Z.type===oe.ElementaryStreamTypes.VIDEO)for(var re=0;re<D;){var ne=O(de,w);te(ve,de[w+=4])&&be(de.subarray(w,w+ne),ve?2:1,j+S/he,H),w+=ne,re+=ne+4}j+=vt/he}}))})})}),H}function te(j,Z){if(j){var H=Z>>1&63;return H===39||H===40}return(31&Z)==6}function be(j,Z,H,de){var he=Ae(j),pe=0;pe+=Z;for(var ve=0,Te=0,Ce=!1,x=0;pe<he.length;){ve=0;do{if(pe>=he.length)break;ve+=x=he[pe++]}while(x===255);Te=0;do{if(pe>=he.length)break;Te+=x=he[pe++]}while(x===255);var Oe=he.length-pe;if(!Ce&&ve===4&&pe<he.length){if(Ce=!0,he[pe++]===181){var Pe=$(he,pe);if(pe+=2,Pe===49){var je=O(he,pe);if(pe+=4,je===1195456820){var Je=he[pe++];if(Je===3){var et=he[pe++],st=64&et,tt=st?2+3*(31&et):0,qe=new Uint8Array(tt);if(st){qe[0]=et;for(var Xe=1;Xe<tt;Xe++)qe[Xe]=he[pe++]}de.push({type:Je,payloadType:ve,pts:H,bytes:qe})}}}}}else if(ve===5&&Te<Oe){if(Ce=!0,Te>16){for(var ze=[],Ve=0;Ve<16;Ve++){var at=he[pe++].toString(16);ze.push(at.length==1?"0"+at:at),Ve!==3&&Ve!==5&&Ve!==7&&Ve!==9||ze.push("-")}for(var ct=Te-16,gt=new Uint8Array(ct),St=0;St<ct;St++)gt[St]=he[pe++];de.push({payloadType:ve,pts:H,uuid:ze.join(""),userData:(0,F.utf8ArrayToStr)(gt),userDataBytes:gt})}}else if(Te<Oe)pe+=Te;else if(Te>Oe)break}}function Ae(j){for(var Z=j.byteLength,H=[],de=1;de<Z-2;)j[de]===0&&j[de+1]===0&&j[de+2]===3?(H.push(de+2),de+=2):de++;if(H.length===0)return j;var he=Z-H.length,pe=new Uint8Array(he),ve=0;for(de=0;de<he;ve++,de++)ve===H[0]&&(ve++,H.shift()),pe[de]=j[ve];return pe}function De(j){var Z=j[0],H="",de="",he=0,pe=0,ve=0,Te=0,Ce=0,x=0;if(Z===0){for(;X(j.subarray(x,x+1))!=="\0";)H+=X(j.subarray(x,x+1)),x+=1;for(H+=X(j.subarray(x,x+1)),x+=1;X(j.subarray(x,x+1))!=="\0";)de+=X(j.subarray(x,x+1)),x+=1;de+=X(j.subarray(x,x+1)),x+=1,he=O(j,12),pe=O(j,16),Te=O(j,20),Ce=O(j,24),x=28}else if(Z===1){he=O(j,x+=4);var Oe=O(j,x+=4),Pe=O(j,x+=4);for(x+=4,ve=Math.pow(2,32)*Oe+Pe,Number.isSafeInteger(ve)||(ve=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Te=O(j,x),Ce=O(j,x+=4),x+=4;X(j.subarray(x,x+1))!=="\0";)H+=X(j.subarray(x,x+1)),x+=1;for(H+=X(j.subarray(x,x+1)),x+=1;X(j.subarray(x,x+1))!=="\0";)de+=X(j.subarray(x,x+1)),x+=1;de+=X(j.subarray(x,x+1)),x+=1}return{schemeIdUri:H,value:de,timeScale:he,presentationTime:ve,presentationTimeDelta:pe,eventDuration:Te,id:Ce,payload:j.subarray(x,j.byteLength)}}function Le(j){for(var Z=arguments.length,H=new Array(Z>1?Z-1:0),de=1;de<Z;de++)H[de-1]=arguments[de];for(var he=H.length,pe=8,ve=he;ve--;)pe+=H[ve].byteLength;var Te=new Uint8Array(pe);for(Te[0]=pe>>24&255,Te[1]=pe>>16&255,Te[2]=pe>>8&255,Te[3]=255&pe,Te.set(j,4),ve=0,pe=8;ve<he;ve++)Te.set(H[ve],pe),pe+=H[ve].byteLength;return Te}function Me(j,Z,H){if(j.byteLength!==16)throw new RangeError("Invalid system id");var de,he,pe;if(Z){de=1,he=new Uint8Array(16*Z.length);for(var ve=0;ve<Z.length;ve++){var Te=Z[ve];if(Te.byteLength!==16)throw new RangeError("Invalid key");he.set(Te,16*ve)}}else de=0,he=new Uint8Array;de>0?(pe=new Uint8Array(4),Z.length>0&&new DataView(pe.buffer).setUint32(0,Z.length,!1)):pe=new Uint8Array;var Ce=new Uint8Array(4);return H&&H.byteLength>0&&new DataView(Ce.buffer).setUint32(0,H.byteLength,!1),Le([112,115,115,104],new Uint8Array([de,0,0,0]),j,pe,he,Ce,H||new Uint8Array)}function Ze(j){if(!(j instanceof ArrayBuffer)||j.byteLength<32)return null;var Z={version:0,systemId:"",kids:null,data:null},H=new DataView(j),de=H.getUint32(0);if(j.byteLength!==de&&de>44||H.getUint32(4)!==1886614376||(Z.version=H.getUint32(8)>>>24,Z.version>1))return null;Z.systemId=E.default.hexDump(new Uint8Array(j,12,16));var he=H.getUint32(28);if(Z.version===0){if(de-32<he)return null;Z.data=new Uint8Array(j,32,he)}else if(Z.version===1){Z.kids=[];for(var pe=0;pe<he;pe++)Z.kids.push(new Uint8Array(j,32+16*pe,16))}return Z}},673:(Ke,ke,q)=>{"use strict";function oe(E,k,ce,M){ce===void 0&&(ce=1),M===void 0&&(M=!1);var X=E*k*ce;return M?Math.round(X):X}function Q(E,k,ce,M){return ce===void 0&&(ce=1),M===void 0&&(M=!1),oe(E,k,1/ce,M)}function F(E,k){return k===void 0&&(k=!1),oe(E,1e3,11111111111111112e-21,k)}function c(E,k){return k===void 0&&(k=1),oe(E,9e4,1/k)}q.r(ke),q.d(ke,{toMpegTsClockFromTimescale:()=>c,toMsFromMpegTsClock:()=>F,toTimescaleFromBase:()=>oe,toTimescaleFromScale:()=>Q})},145:(Ke,ke,q)=>{"use strict";function oe(Q,F,c){return Uint8Array.prototype.slice?Q.slice(F,c):new Uint8Array(Array.prototype.slice.call(Q,F,c))}q.r(ke),q.d(ke,{sliceUint8:()=>oe})},729:Ke=>{"use strict";var ke=Object.prototype.hasOwnProperty,q="~";function oe(){}function Q(k,ce,M){this.fn=k,this.context=ce,this.once=M||!1}function F(k,ce,M,X,$){if(typeof M!="function")throw new TypeError("The listener must be a function");var O=new Q(M,X||k,$),V=q?q+ce:ce;return k._events[V]?k._events[V].fn?k._events[V]=[k._events[V],O]:k._events[V].push(O):(k._events[V]=O,k._eventsCount++),k}function c(k,ce){--k._eventsCount==0?k._events=new oe:delete k._events[ce]}function E(){this._events=new oe,this._eventsCount=0}Object.create&&(oe.prototype=Object.create(null),new oe().__proto__||(q=!1)),E.prototype.eventNames=function(){var k,ce,M=[];if(this._eventsCount===0)return M;for(ce in k=this._events)ke.call(k,ce)&&M.push(q?ce.slice(1):ce);return Object.getOwnPropertySymbols?M.concat(Object.getOwnPropertySymbols(k)):M},E.prototype.listeners=function(k){var ce=q?q+k:k,M=this._events[ce];if(!M)return[];if(M.fn)return[M.fn];for(var X=0,$=M.length,O=new Array($);X<$;X++)O[X]=M[X].fn;return O},E.prototype.listenerCount=function(k){var ce=q?q+k:k,M=this._events[ce];return M?M.fn?1:M.length:0},E.prototype.emit=function(k,ce,M,X,$,O){var V=q?q+k:k;if(!this._events[V])return!1;var U,G,N=this._events[V],le=arguments.length;if(N.fn){switch(N.once&&this.removeListener(k,N.fn,void 0,!0),le){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,ce),!0;case 3:return N.fn.call(N.context,ce,M),!0;case 4:return N.fn.call(N.context,ce,M,X),!0;case 5:return N.fn.call(N.context,ce,M,X,$),!0;case 6:return N.fn.call(N.context,ce,M,X,$,O),!0}for(G=1,U=new Array(le-1);G<le;G++)U[G-1]=arguments[G];N.fn.apply(N.context,U)}else{var ue,Re=N.length;for(G=0;G<Re;G++)switch(N[G].once&&this.removeListener(k,N[G].fn,void 0,!0),le){case 1:N[G].fn.call(N[G].context);break;case 2:N[G].fn.call(N[G].context,ce);break;case 3:N[G].fn.call(N[G].context,ce,M);break;case 4:N[G].fn.call(N[G].context,ce,M,X);break;default:if(!U)for(ue=1,U=new Array(le-1);ue<le;ue++)U[ue-1]=arguments[ue];N[G].fn.apply(N[G].context,U)}}return!0},E.prototype.on=function(k,ce,M){return F(this,k,ce,M,!1)},E.prototype.once=function(k,ce,M){return F(this,k,ce,M,!0)},E.prototype.removeListener=function(k,ce,M,X){var $=q?q+k:k;if(!this._events[$])return this;if(!ce)return c(this,$),this;var O=this._events[$];if(O.fn)O.fn!==ce||X&&!O.once||M&&O.context!==M||c(this,$);else{for(var V=0,U=[],G=O.length;V<G;V++)(O[V].fn!==ce||X&&!O[V].once||M&&O[V].context!==M)&&U.push(O[V]);U.length?this._events[$]=U.length===1?U[0]:U:c(this,$)}return this},E.prototype.removeAllListeners=function(k){var ce;return k?(ce=q?q+k:k,this._events[ce]&&c(this,ce)):(this._events=new oe,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=q,E.EventEmitter=E,Ke.exports=E},945:function(Ke){var ke,q,oe,Q,F;ke=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,q=/^(?=([^\/?#]*))\1([^]*)$/,oe=/(?:\/|^)\.(?=\/)/g,Q=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,F={buildAbsoluteURL:function(c,E,k){if(k=k||{},c=c.trim(),!(E=E.trim())){if(!k.alwaysNormalize)return c;var ce=F.parseURL(c);if(!ce)throw new Error("Error trying to parse base URL.");return ce.path=F.normalizePath(ce.path),F.buildURLFromParts(ce)}var M=F.parseURL(E);if(!M)throw new Error("Error trying to parse relative URL.");if(M.scheme)return k.alwaysNormalize?(M.path=F.normalizePath(M.path),F.buildURLFromParts(M)):E;var X=F.parseURL(c);if(!X)throw new Error("Error trying to parse base URL.");if(!X.netLoc&&X.path&&X.path[0]!=="/"){var $=q.exec(X.path);X.netLoc=$[1],X.path=$[2]}X.netLoc&&!X.path&&(X.path="/");var O={scheme:X.scheme,netLoc:M.netLoc,path:null,params:M.params,query:M.query,fragment:M.fragment};if(!M.netLoc&&(O.netLoc=X.netLoc,M.path[0]!=="/"))if(M.path){var V=X.path,U=V.substring(0,V.lastIndexOf("/")+1)+M.path;O.path=F.normalizePath(U)}else O.path=X.path,M.params||(O.params=X.params,M.query||(O.query=X.query));return O.path===null&&(O.path=k.alwaysNormalize?F.normalizePath(M.path):M.path),F.buildURLFromParts(O)},parseURL:function(c){var E=ke.exec(c);return E?{scheme:E[1]||"",netLoc:E[2]||"",path:E[3]||"",params:E[4]||"",query:E[5]||"",fragment:E[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(oe,"");c.length!==(c=c.replace(Q,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}},Ke.exports=F}},Ot={};function At(Ke){var ke=Ot[Ke];if(ke!==void 0)return ke.exports;var q=Ot[Ke]={exports:{}};return tr[Ke].call(q.exports,q,q.exports,At),q.exports}At.m=tr,At.n=Ke=>{var ke=Ke&&Ke.__esModule?()=>Ke.default:()=>Ke;return At.d(ke,{a:ke}),ke},At.d=(Ke,ke)=>{for(var q in ke)At.o(ke,q)&&!At.o(Ke,q)&&Object.defineProperty(Ke,q,{enumerable:!0,get:ke[q]})},At.o=(Ke,ke)=>Object.prototype.hasOwnProperty.call(Ke,ke),At.r=Ke=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(Ke,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Ke,"__esModule",{value:!0})};var Pt=At(76);return Pt.default})())},6780:function(ri,tr,Ot){"use strict";Ot.d(tr,{Z:function(){return F}});var At=(c,E,k)=>new Promise((ce,M)=>{var X=V=>{try{O(k.next(V))}catch(U){M(U)}},$=V=>{try{O(k.throw(V))}catch(U){M(U)}},O=V=>V.done?ce(V.value):Promise.resolve(V.value).then(X,$);O((k=k.apply(c,E)).next())});const Pt="oplayer-plugin-hls",Ke=(c,E)=>!(Boolean(c.canPlayType("application/x-mpegURL"))||Boolean(c.canPlayType("application/vnd.apple.mpegURL")))&&(E.format==="hls"||E.format==="m3u8"||(E.format==="auto"||typeof E.format=="undefined")&&/m3u8(#|\?|$)/i.test(E.src)),ke=function(c,E){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};k.qualityControl&&(E.once(Q.library.Events.MANIFEST_PARSED,()=>{ce({icon:c.plugins.ui.icons.quality,name:"Quality",settings(){return E.levels.length>1?E.levels.reduce((M,X,$)=>{let O=(X.name||X.height).toString();if(isFinite(+O)&&(O+="p"),k.withBitrate){const V=X.bitrate/1e3,U=V>1e3,G=U?~~(V/1e3):Math.floor(V);O+=" ("+G+(U?"m":"k")+"bps)"}return M.push({name:O,default:E.currentLevel==$,value:$}),M},[{name:c.locales.get("Auto"),default:E.autoLevelEnabled,value:-1}]):[]},onChange(M){k.qualitySwitch=="immediate"?(E.currentLevel=M.value,M.value!==-1&&(E.loadLevel=M.value)):(E.nextLevel=M.value,M.value!==-1&&(E.nextLoadLevel=M.value))}})}),E.on(Q.library.Events.LEVEL_SWITCHED,function(X,$){let O=$.level;if(E.autoLevelEnabled){const V=E.levels[O].height,U=c.locales.get("Auto")+(V?" ("+V+"p)":"");c.plugins.ui.setting.updateLabel(Pt+"-Quality",U)}else c.plugins.ui.setting.select(Pt+"-Quality",O+1,!1)})),k.audioControl&&E.on(Q.library.Events.AUDIO_TRACK_LOADED,()=>{ce({icon:c.plugins.ui.icons.lang,name:"Language",settings(){return E.audioTracks.length>1?E.audioTracks.map(M=>{let X=M.name,$=M.lang,O=M.id;return{name:$||X,default:E.audioTrack==O,value:O}}):[]},onChange(M){E.audioTrack=M.value}})}),k.textControl&&E.on(Q.library.Events.SUBTITLE_TRACK_LOADED,()=>{ce({icon:c.plugins.ui.icons.subtitle,name:"Subtitle",settings(){return E.subtitleTracks.length>1?E.subtitleTracks.reduce((M,X)=>{let $=X.name,O=X.lang,V=X.id;return M.push({name:O||$,default:E.subtitleTrack==V,value:V}),M},[{name:c.locales.get("Off"),default:!E.subtitleDisplay,value:-1}]):[]},onChange(M){let X=M.value;(E.subtitleDisplay=X!=-1)&&(E.subtitleTrack=X)}})});function ce(M){const X=M.settings();if(X&&X.length<2)return;const $=M.name,O=M.icon,V=M.onChange;c.plugins.ui.setting.unregister(Pt+"-"+$),c.plugins.ui.setting.register({name:c.locales.get($),icon:O,onChange:V,type:"selector",key:Pt+"-"+$,children:X})}},q=c=>{["Quality","Language","Subtitle"].forEach(E=>{var k;return(k=c.plugins.ui)==null?void 0:k.setting.unregister(Pt+"-"+E)})},oe=class{constructor(c){this.options=c,this.key="hls",this.name=Pt,this.version="1.2.20-alpha.0"}apply(c){this.player=c}load(c,E){return At(this,null,function*(){var k,ce;let M=c.$video;const X=this.options.matcher;if(!(X===void 0?oe.defaultMatcher:X)(M,E))return!1;const O=this.options,V=O.config,U=O.withBitrate,G=U===void 0?!1:U,N=O.qualityControl,le=N===void 0?!0:N,ue=O.qualitySwitch,Re=ue===void 0?"immediate":ue,B=O.audioControl,y=B===void 0?!0:B,C=O.textControl,b=C===void 0?!0:C;if((k=oe.library)!=null||(oe.library=(yield Ot.e(817).then(Ot.t.bind(Ot,9013,19))).default),!oe.library.isSupported())return!1;this.instance=new oe.library(V);const W=this.instance,se=this.player;return this.instance.loadSource(E.src),this.instance.attachMedia(se.$video),!se.isNativeUI&&((ce=se.plugins.ui)!=null&&ce.setting)&&ke(se,W,{qualityControl:le,qualitySwitch:Re,withBitrate:G,audioControl:y,textControl:b}),W.on(oe.library.Events.ERROR,function(ie,te){const be=te.type,Ae=te.details;te.fatal&&(se.hasError=!0,se.emit("error",Object.assign({},te,{pluginName:Pt,message:be+": "+Ae})))}),this})}unload(){return At(this,null,function*(){q(this.player),this.instance.destroy()})}destroy(){return At(this,null,function*(){yield this.unload()})}};let Q=oe;Q.defaultMatcher=Ke,Q.library=globalThis.Hls;function F(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Q(c)}}}]);
