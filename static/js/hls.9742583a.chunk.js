(self.webpackChunk_web_index=self.webpackChunk_web_index||[]).push([[817],{1527:function($i){typeof window!="undefined"&&function(ti,Cr){$i.exports=Cr()}(this,()=>(()=>{var ti={21:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>se});var Ee=function(){function z(K,te){this.subtle=void 0,this.aesIV=void 0,this.subtle=K,this.aesIV=te}return z.prototype.decrypt=function(K,te){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},te,K)},z}(),ie=function(){function z(K,te){this.subtle=void 0,this.key=void 0,this.subtle=K,this.key=te}return z.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},z}(),B=X(145),c=function(){function z(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=z.prototype;return K.uint8ArrayToUint32Array_=function(te){for(var re=new DataView(te),de=new Uint32Array(4),Q=0;Q<4;Q++)de[Q]=re.getUint32(4*Q);return de},K.initTable=function(){var te=this.sBox,re=this.invSBox,de=this.subMix,Q=de[0],ne=de[1],le=de[2],Re=de[3],Te=this.invSubMix,Pe=Te[0],F=Te[1],k=Te[2],W=Te[3],H=new Uint32Array(256),Ae=0,_e=0,we=0;for(we=0;we<256;we++)H[we]=we<128?we<<1:we<<1^283;for(we=0;we<256;we++){var U=_e^_e<<1^_e<<2^_e<<3^_e<<4;U=U>>>8^255&U^99,te[Ae]=U,re[U]=Ae;var ue=H[Ae],Z=H[ue],he=H[Z],G=257*H[U]^16843008*U;Q[Ae]=G<<24|G>>>8,ne[Ae]=G<<16|G>>>16,le[Ae]=G<<8|G>>>24,Re[Ae]=G,G=16843009*he^65537*Z^257*ue^16843008*Ae,Pe[U]=G<<24|G>>>8,F[U]=G<<16|G>>>16,k[U]=G<<8|G>>>24,W[U]=G,Ae?(Ae=ue^H[H[H[he^ue]]],_e^=H[H[_e]]):Ae=_e=1}},K.expandKey=function(te){for(var re=this.uint8ArrayToUint32Array_(te),de=!0,Q=0;Q<re.length&&de;)de=re[Q]===this.key[Q],Q++;if(!de){this.key=re;var ne=this.keySize=re.length;if(ne!==4&&ne!==6&&ne!==8)throw new Error("Invalid aes key size="+ne);var le,Re,Te,Pe,F=this.ksRows=4*(ne+6+1),k=this.keySchedule=new Uint32Array(F),W=this.invKeySchedule=new Uint32Array(F),H=this.sBox,Ae=this.rcon,_e=this.invSubMix,we=_e[0],U=_e[1],ue=_e[2],Z=_e[3];for(le=0;le<F;le++)le<ne?Te=k[le]=re[le]:(Pe=Te,le%ne==0?(Pe=H[(Pe=Pe<<8|Pe>>>24)>>>24]<<24|H[Pe>>>16&255]<<16|H[Pe>>>8&255]<<8|H[255&Pe],Pe^=Ae[le/ne|0]<<24):ne>6&&le%ne==4&&(Pe=H[Pe>>>24]<<24|H[Pe>>>16&255]<<16|H[Pe>>>8&255]<<8|H[255&Pe]),k[le]=Te=(k[le-ne]^Pe)>>>0);for(Re=0;Re<F;Re++)le=F-Re,Pe=3&Re?k[le]:k[le-4],W[Re]=Re<4||le<=4?Pe:we[H[Pe>>>24]]^U[H[Pe>>>16&255]]^ue[H[Pe>>>8&255]]^Z[H[255&Pe]],W[Re]=W[Re]>>>0}},K.networkToHostOrderSwap=function(te){return te<<24|(65280&te)<<8|(16711680&te)>>8|te>>>24},K.decrypt=function(te,re,de){for(var Q,ne,le,Re,Te,Pe,F,k,W,H,Ae,_e,we,U,ue=this.keySize+6,Z=this.invKeySchedule,he=this.invSBox,G=this.invSubMix,xe=G[0],Ge=G[1],qe=G[2],it=G[3],me=this.uint8ArrayToUint32Array_(de),Ze=me[0],st=me[1],Et=me[2],lt=me[3],vt=new Int32Array(te),St=new Int32Array(vt.length),gt=this.networkToHostOrderSwap;re<vt.length;){for(W=gt(vt[re]),H=gt(vt[re+1]),Ae=gt(vt[re+2]),_e=gt(vt[re+3]),Te=W^Z[0],Pe=_e^Z[1],F=Ae^Z[2],k=H^Z[3],we=4,U=1;U<ue;U++)Q=xe[Te>>>24]^Ge[Pe>>16&255]^qe[F>>8&255]^it[255&k]^Z[we],ne=xe[Pe>>>24]^Ge[F>>16&255]^qe[k>>8&255]^it[255&Te]^Z[we+1],le=xe[F>>>24]^Ge[k>>16&255]^qe[Te>>8&255]^it[255&Pe]^Z[we+2],Re=xe[k>>>24]^Ge[Te>>16&255]^qe[Pe>>8&255]^it[255&F]^Z[we+3],Te=Q,Pe=ne,F=le,k=Re,we+=4;Q=he[Te>>>24]<<24^he[Pe>>16&255]<<16^he[F>>8&255]<<8^he[255&k]^Z[we],ne=he[Pe>>>24]<<24^he[F>>16&255]<<16^he[k>>8&255]<<8^he[255&Te]^Z[we+1],le=he[F>>>24]<<24^he[k>>16&255]<<16^he[Te>>8&255]<<8^he[255&Pe]^Z[we+2],Re=he[k>>>24]<<24^he[Te>>16&255]<<16^he[Pe>>8&255]<<8^he[255&F]^Z[we+3],St[re]=gt(Q^Ze),St[re+1]=gt(Re^st),St[re+2]=gt(le^Et),St[re+3]=gt(ne^lt),Ze=W,st=H,Et=Ae,lt=_e,re+=4}return St.buffer},z}(),P=X(93),_=X(63),se=function(){function z(te,re,de){var Q=(de===void 0?{}:de).removePKCS7Padding,ne=Q===void 0||Q;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=te,this.config=re,this.removePKCS7Padding=ne,ne)try{var le=self.crypto;le&&(this.subtle=le.subtle||le.webkitSubtle)}catch(Re){}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var K=z.prototype;return K.destroy=function(){this.observer=null},K.isSync=function(){return this.config.enableSoftwareAES},K.flush=function(){var te=this.currentResult;if(te){var re,de,Q,ne=new Uint8Array(te);return this.reset(),this.removePKCS7Padding?(Q=(de=(re=ne).byteLength)&&new DataView(re.buffer).getUint8(de-1))?(0,B.sliceUint8)(re,0,de-Q):re:ne}this.reset()},K.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},K.decrypt=function(te,re,de,Q){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(te),re,de);var ne=this.flush();ne&&Q(ne.buffer)}else this.webCryptoDecrypt(new Uint8Array(te),re,de).then(Q)},K.softwareDecrypt=function(te,re,de){var Q=this.currentIV,ne=this.currentResult,le=this.remainderData;this.logOnce("JS AES decrypt"),le&&(te=(0,_.appendUint8Array)(le,te),this.remainderData=null);var Re=this.getValidChunk(te);if(!Re.length)return null;Q&&(de=Q);var Te=this.softwareDecrypter;Te||(Te=this.softwareDecrypter=new c),Te.expandKey(re);var Pe=ne;return this.currentResult=Te.decrypt(Re.buffer,0,de),this.currentIV=(0,B.sliceUint8)(Re,-16).buffer,Pe||null},K.webCryptoDecrypt=function(te,re,de){var Q=this,ne=this.subtle;return this.key===re&&this.fastAesKey||(this.key=re,this.fastAesKey=new ie(ne,re)),this.fastAesKey.expandKey().then(function(le){return ne?new Ee(ne,de).decrypt(te.buffer,le):Promise.reject(new Error("web crypto not initialized"))}).catch(function(le){return Q.onWebCryptoError(le,te,re,de)})},K.onWebCryptoError=function(te,re,de,Q){return P.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",te),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(re,de,Q)},K.getValidChunk=function(te){var re=te,de=te.length-te.length%16;return de!==te.length&&(re=(0,B.sliceUint8)(te,0,de),this.remainderData=(0,B.sliceUint8)(te,de)),re},K.logOnce=function(te){this.logEnabled&&(P.logger.log("[decrypter.ts]: "+te),this.logEnabled=!1)},z}()},181:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{canParse:()=>_,decodeFrame:()=>re,getID3Data:()=>c,getID3Frames:()=>te,getTimeStamp:()=>se,isFooter:()=>B,isHeader:()=>ie,isTimeStampFrame:()=>z,testables:()=>Te,utf8ArrayToStr:()=>Re});var Ee,ie=function(F,k){return k+10<=F.length&&F[k]===73&&F[k+1]===68&&F[k+2]===51&&F[k+3]<255&&F[k+4]<255&&F[k+6]<128&&F[k+7]<128&&F[k+8]<128&&F[k+9]<128},B=function(F,k){return k+10<=F.length&&F[k]===51&&F[k+1]===68&&F[k+2]===73&&F[k+3]<255&&F[k+4]<255&&F[k+6]<128&&F[k+7]<128&&F[k+8]<128&&F[k+9]<128},c=function(F,k){for(var W=k,H=0;ie(F,k);)H+=10,H+=P(F,k+6),B(F,k+10)&&(H+=10),k+=H;if(H>0)return F.subarray(W,W+H)},P=function(F,k){var W=0;return W=(127&F[k])<<21,W|=(127&F[k+1])<<14,(W|=(127&F[k+2])<<7)|127&F[k+3]},_=function(F,k){return ie(F,k)&&P(F,k+6)+10<=F.length-k},se=function(F){for(var k=te(F),W=0;W<k.length;W++){var H=k[W];if(z(H))return le(H)}},z=function(F){return F&&F.key==="PRIV"&&F.info==="com.apple.streaming.transportStreamTimestamp"},K=function(F){var k=String.fromCharCode(F[0],F[1],F[2],F[3]),W=P(F,4);return{type:k,size:W,data:F.subarray(10,10+W)}},te=function(F){for(var k=0,W=[];ie(F,k);){for(var H=P(F,k+6),Ae=(k+=10)+H;k+8<Ae;){var _e=K(F.subarray(k)),we=re(_e);we&&W.push(we),k+=_e.size+10}B(F,k)&&(k+=10)}return W},re=function(F){return F.type==="PRIV"?de(F):F.type[0]==="W"?ne(F):Q(F)},de=function(F){if(!(F.size<2)){var k=Re(F.data,!0),W=new Uint8Array(F.data.subarray(k.length+1));return{key:F.type,info:k,data:W.buffer}}},Q=function(F){if(!(F.size<2)){if(F.type==="TXXX"){var k=1,W=Re(F.data.subarray(k),!0);k+=W.length+1;var H=Re(F.data.subarray(k));return{key:F.type,info:W,data:H}}var Ae=Re(F.data.subarray(1));return{key:F.type,data:Ae}}},ne=function(F){if(F.type==="WXXX"){if(F.size<2)return;var k=1,W=Re(F.data.subarray(k),!0);k+=W.length+1;var H=Re(F.data.subarray(k));return{key:F.type,info:W,data:H}}var Ae=Re(F.data);return{key:F.type,data:Ae}},le=function(F){if(F.data.byteLength===8){var k=new Uint8Array(F.data),W=1&k[3],H=(k[4]<<23)+(k[5]<<15)+(k[6]<<7)+k[7];return H/=45,W&&(H+=4772185884e-2),Math.round(H)}},Re=function(F,k){k===void 0&&(k=!1);var W=Pe();if(W){var H=W.decode(F);if(k){var Ae=H.indexOf("\0");return Ae!==-1?H.substring(0,Ae):H}return H.replace(/\0/g,"")}for(var _e,we,U,ue=F.length,Z="",he=0;he<ue;){if((_e=F[he++])===0&&k)return Z;if(_e!==0&&_e!==3)switch(_e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Z+=String.fromCharCode(_e);break;case 12:case 13:we=F[he++],Z+=String.fromCharCode((31&_e)<<6|63&we);break;case 14:we=F[he++],U=F[he++],Z+=String.fromCharCode((15&_e)<<12|(63&we)<<6|(63&U)<<0)}}return Z},Te={decodeTextFrame:Q};function Pe(){return Ee||self.TextDecoder===void 0||(Ee=new self.TextDecoder("utf-8")),Ee}},182:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>P});var Ee=X(764),ie=X(851),B=X(93),c=X(729);function P(K){var te=new c.EventEmitter,re=function(de,Q){K.postMessage({event:de,data:Q})};te.on(ie.Events.FRAG_DECRYPTED,re),te.on(ie.Events.ERROR,re),K.addEventListener("message",function(de){var Q=de.data;switch(Q.cmd){case"init":var ne=JSON.parse(Q.config);K.transmuxer=new Ee.default(te,Q.typeSupported,ne,Q.vendor,Q.id),(0,B.enableLogs)(ne.debug,Q.id),function(){var Pe=function(k){B.logger[k]=function(W){re("workerLog",{logType:k,message:W})}};for(var F in B.logger)Pe(F)}(),re("init",null);break;case"configure":K.transmuxer.configure(Q.config);break;case"demux":var le=K.transmuxer.push(Q.data,Q.decryptdata,Q.chunkMeta,Q.state);(0,Ee.isPromise)(le)?le.then(function(Pe){_(K,Pe)}):_(K,le);break;case"flush":var Re=Q.chunkMeta,Te=K.transmuxer.flush(Re);(0,Ee.isPromise)(Te)?Te.then(function(Pe){z(K,Pe,Re)}):z(K,Te,Re)}})}function _(K,te){if(!((re=te.remuxResult).audio||re.video||re.text||re.id3||re.initSegment))return!1;var re,de=[],Q=te.remuxResult,ne=Q.audio,le=Q.video;return ne&&se(de,ne),le&&se(de,le),K.postMessage({event:"transmuxComplete",data:te},de),!0}function se(K,te){te.data1&&K.push(te.data1.buffer),te.data2&&K.push(te.data2.buffer)}function z(K,te,re){te.reduce(function(de,Q){return _(K,Q)||de},!1)||K.postMessage({event:"transmuxComplete",data:te[0]}),K.postMessage({event:"flush",data:re})}},764:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{TransmuxConfig:()=>pt,TransmuxState:()=>ct,default:()=>ze,isPromise:()=>rt});var Ee=X(851),ie=X(973),B=X(21),c=X(965),P=X(181),_=X(856);function se(R,I){return R===void 0&&(R=""),I===void 0&&(I=9e4),{type:R,id:-1,pid:-1,inputTimeScale:I,sequenceNumber:-1,samples:[],dropped:0}}var z=X(63),K=X(145),te=function(){function R(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var I=R.prototype;return I.resetInitSegment=function(S,C,O,Y){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},I.resetTimeStamp=function(S){this.initPTS=S,this.resetContiguity()},I.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},I.canParse=function(S,C){return!1},I.appendFrame=function(S,C,O){},I.demux=function(S,C){this.cachedData&&(S=(0,z.appendUint8Array)(this.cachedData,S),this.cachedData=null);var O,Y=P.getID3Data(S,0),j=Y?Y.length:0,J=this._audioTrack,De=this._id3Track,pe=Y?P.getTimeStamp(Y):void 0,ke=S.length;for((this.basePTS===null||this.frameIndex===0&&(0,c.isFiniteNumber)(pe))&&(this.basePTS=re(pe,C,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),Y&&Y.length>0&&De.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:Y,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});j<ke;){if(this.canParse(S,j)){var Fe=this.appendFrame(J,S,j);Fe?(this.frameIndex++,this.lastPTS=Fe.sample.pts,O=j+=Fe.length):j=ke}else P.canParse(S,j)?(Y=P.getID3Data(S,j),De.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:Y,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),O=j+=Y.length):j++;if(j===ke&&O!==ke){var Qe=(0,K.sliceUint8)(S,O);this.cachedData?this.cachedData=(0,z.appendUint8Array)(this.cachedData,Qe):this.cachedData=Qe}}return{audioTrack:J,videoTrack:se(),id3Track:De,textTrack:se()}},I.demuxSampleAes=function(S,C,O){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},I.flush=function(S){var C=this.cachedData;return C&&(this.cachedData=null,this.demux(C,0)),{audioTrack:this._audioTrack,videoTrack:se(),id3Track:this._id3Track,textTrack:se()}},I.destroy=function(){},R}(),re=function(R,I,S){return(0,c.isFiniteNumber)(R)?90*R:9e4*I+(S||0)};const de=te;var Q=X(93);function ne(R,I){return R[I]===255&&(246&R[I+1])==240}function le(R,I){return 1&R[I+1]?7:9}function Re(R,I){return(3&R[I+3])<<11|R[I+4]<<3|(224&R[I+5])>>>5}function Te(R,I){return I+1<R.length&&ne(R,I)}function Pe(R,I){if(Te(R,I)){var S=le(R,I);if(I+S>=R.length)return!1;var C=Re(R,I);if(C<=S)return!1;var O=I+C;return O===R.length||Te(R,O)}return!1}function F(R,I,S,C,O){if(!R.samplerate){var Y=function(j,J,De,pe){var ke,Fe,Qe,$e,je=navigator.userAgent.toLowerCase(),ot=pe,Tt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ke=1+((192&J[De+2])>>>6);var dt=(60&J[De+2])>>>2;if(!(dt>Tt.length-1))return Qe=(1&J[De+2])<<2,Qe|=(192&J[De+3])>>>6,Q.logger.log("manifest codec:"+pe+", ADTS type:"+ke+", samplingIndex:"+dt),/firefox/i.test(je)?dt>=6?(ke=5,$e=new Array(4),Fe=dt-3):(ke=2,$e=new Array(2),Fe=dt):je.indexOf("android")!==-1?(ke=2,$e=new Array(2),Fe=dt):(ke=5,$e=new Array(4),pe&&(pe.indexOf("mp4a.40.29")!==-1||pe.indexOf("mp4a.40.5")!==-1)||!pe&&dt>=6?Fe=dt-3:((pe&&pe.indexOf("mp4a.40.2")!==-1&&(dt>=6&&Qe===1||/vivaldi/i.test(je))||!pe&&Qe===1)&&(ke=2,$e=new Array(2)),Fe=dt)),$e[0]=ke<<3,$e[0]|=(14&dt)>>1,$e[1]|=(1&dt)<<7,$e[1]|=Qe<<3,ke===5&&($e[1]|=(14&Fe)>>1,$e[2]=(1&Fe)<<7,$e[2]|=8,$e[3]=0),{config:$e,samplerate:Tt[dt],channelCount:Qe,codec:"mp4a.40."+ke,manifestCodec:ot};j.trigger(Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+dt})}(I,S,C,O);if(!Y)return;R.config=Y.config,R.samplerate=Y.samplerate,R.channelCount=Y.channelCount,R.codec=Y.codec,R.manifestCodec=Y.manifestCodec,Q.logger.log("parsed codec:"+R.codec+", rate:"+Y.samplerate+", channels:"+Y.channelCount)}}function k(R){return 9216e4/R}function W(R,I,S,C,O){var Y,j=C+O*k(R.samplerate),J=function(je,ot){var Tt=le(je,ot);if(ot+Tt<=je.length){var dt=Re(je,ot)-Tt;if(dt>0)return{headerLength:Tt,frameLength:dt}}}(I,S);if(J){var De=J.frameLength,pe=J.headerLength,ke=pe+De,Fe=Math.max(0,S+ke-I.length);Fe?(Y=new Uint8Array(ke-pe)).set(I.subarray(S+pe,I.length),0):Y=I.subarray(S+pe,S+ke);var Qe={unit:Y,pts:j};return Fe||R.samples.push(Qe),{sample:Qe,length:ke,missing:Fe}}var $e=I.length-S;return(Y=new Uint8Array($e)).set(I.subarray(S,I.length),0),{sample:{unit:Y,pts:j},length:$e,missing:-1}}function H(R,I){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,C){return S.__proto__=C,S},H(R,I)}const Ae=function(R){var I,S;function C(Y,j){var J;return(J=R.call(this)||this).observer=void 0,J.config=void 0,J.observer=Y,J.config=j,J}S=R,(I=C).prototype=Object.create(S.prototype),I.prototype.constructor=I,H(I,S);var O=C.prototype;return O.resetInitSegment=function(Y,j,J,De){R.prototype.resetInitSegment.call(this,Y,j,J,De),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:j,duration:De,inputTimeScale:9e4,dropped:0}},C.probe=function(Y){if(!Y)return!1;for(var j=(P.getID3Data(Y,0)||[]).length,J=Y.length;j<J;j++)if(Pe(Y,j))return Q.logger.log("ADTS sync word found !"),!0;return!1},O.canParse=function(Y,j){return function(J,De){return function(pe,ke){return ke+5<pe.length}(J,De)&&ne(J,De)&&Re(J,De)<=J.length-De}(Y,j)},O.appendFrame=function(Y,j,J){F(Y,this.observer,j,J,Y.manifestCodec);var De=W(Y,j,J,this.basePTS,this.frameIndex);if(De&&De.missing===0)return De},C}(de);var _e=/\/emsg[-/]ID3/i;const we=function(){function R(S,C){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=C}var I=R.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(S,C,O,Y){var j=(0,z.parseInitSegment)(S),J=this.videoTrack=se("video",1),De=this.audioTrack=se("audio",1),pe=this.txtTrack=se("text",1);if(this.id3Track=se("id3",1),this.timeOffset=0,j.video){var ke=j.video,Fe=ke.id,Qe=ke.timescale,$e=ke.codec;J.id=Fe,J.timescale=pe.timescale=Qe,J.codec=$e}if(j.audio){var je=j.audio,ot=je.id,Tt=je.timescale,dt=je.codec;De.id=ot,De.timescale=Tt,De.codec=dt}pe.id=z.RemuxerTrackIdConfig.text,J.sampleDuration=0,J.duration=De.duration=Y},I.resetContiguity=function(){},R.probe=function(S){return S=S.length>16384?S.subarray(0,16384):S,(0,z.findBox)(S,["moof"]).length>0},I.demux=function(S,C){this.timeOffset=C;var O=S,Y=this.videoTrack,j=this.txtTrack;if(this.config.progressive){this.remainderData&&(O=(0,z.appendUint8Array)(this.remainderData,S));var J=(0,z.segmentValidRange)(O);this.remainderData=J.remainder,Y.samples=J.valid||new Uint8Array}else Y.samples=O;var De=this.extractID3Track(Y,C);return j.samples=(0,z.parseSamples)(C,Y),{videoTrack:Y,audioTrack:this.audioTrack,id3Track:De,textTrack:this.txtTrack}},I.flush=function(){var S=this.timeOffset,C=this.videoTrack,O=this.txtTrack;C.samples=this.remainderData||new Uint8Array,this.remainderData=null;var Y=this.extractID3Track(C,this.timeOffset);return O.samples=(0,z.parseSamples)(S,C),{videoTrack:C,audioTrack:se(),id3Track:Y,textTrack:se()}},I.extractID3Track=function(S,C){var O=this.id3Track;if(S.samples.length){var Y=(0,z.findBox)(S.samples,["emsg"]);Y&&Y.forEach(function(j){var J=(0,z.parseEmsg)(j);if(_e.test(J.schemeIdUri)){var De=(0,c.isFiniteNumber)(J.presentationTime)?J.presentationTime/J.timeScale:C+J.presentationTimeDelta/J.timeScale,pe=J.eventDuration===4294967295?Number.POSITIVE_INFINITY:J.eventDuration/J.timeScale;pe<=.001&&(pe=Number.POSITIVE_INFINITY);var ke=J.payload;O.samples.push({data:ke,len:ke.byteLength,dts:De,pts:De,type:_.MetadataSchema.emsg,duration:pe})}})}return O},I.demuxSampleAes=function(S,C,O){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},R}();var U=null,ue=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Z=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],he=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],G=[0,1,1,4];function xe(R,I,S,C,O){if(!(S+24>I.length)){var Y=Ge(I,S);if(Y&&S+Y.frameLength<=I.length){var j=C+O*(9e4*Y.samplesPerFrame/Y.sampleRate),J={unit:I.subarray(S,S+Y.frameLength),pts:j,dts:j};return R.config=[],R.channelCount=Y.channelCount,R.samplerate=Y.sampleRate,R.samples.push(J),{sample:J,length:Y.frameLength,missing:0}}}}function Ge(R,I){var S=R[I+1]>>3&3,C=R[I+1]>>1&3,O=R[I+2]>>4&15,Y=R[I+2]>>2&3;if(S!==1&&O!==0&&O!==15&&Y!==3){var j=R[I+2]>>1&1,J=R[I+3]>>6,De=1e3*ue[14*(S===3?3-C:C===3?3:4)+O-1],pe=Z[3*(S===3?0:S===2?1:2)+Y],ke=J===3?1:2,Fe=he[S][C],Qe=G[C],$e=8*Fe*Qe,je=Math.floor(Fe*De/pe+j)*Qe;if(U===null){var ot=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);U=ot?parseInt(ot[1]):0}return!!U&&U<=87&&C===2&&De>=224e3&&J===0&&(R[I+3]=128|R[I+3]),{sampleRate:pe,channelCount:ke,frameLength:je,samplesPerFrame:$e}}}function qe(R,I){return R[I]===255&&(224&R[I+1])==224&&(6&R[I+1])!=0}function it(R,I){return I+1<R.length&&qe(R,I)}function me(R,I){if(I+1<R.length&&qe(R,I)){var S=Ge(R,I),C=4;S!=null&&S.frameLength&&(C=S.frameLength);var O=I+C;return O===R.length||it(R,O)}return!1}const Ze=function(){function R(S){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=S,this.bytesAvailable=S.byteLength,this.word=0,this.bitsAvailable=0}var I=R.prototype;return I.loadWord=function(){var S=this.data,C=this.bytesAvailable,O=S.byteLength-C,Y=new Uint8Array(4),j=Math.min(4,C);if(j===0)throw new Error("no bytes available");Y.set(S.subarray(O,O+j)),this.word=new DataView(Y.buffer).getUint32(0),this.bitsAvailable=8*j,this.bytesAvailable-=j},I.skipBits=function(S){var C;this.bitsAvailable>S?(this.word<<=S,this.bitsAvailable-=S):(S-=this.bitsAvailable,S-=(C=S>>3)>>3,this.bytesAvailable-=C,this.loadWord(),this.word<<=S,this.bitsAvailable-=S)},I.readBits=function(S){var C=Math.min(this.bitsAvailable,S),O=this.word>>>32-C;return S>32&&Q.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0?this.word<<=C:this.bytesAvailable>0&&this.loadWord(),(C=S-C)>0&&this.bitsAvailable?O<<C|this.readBits(C):O},I.skipLZ=function(){var S;for(S=0;S<this.bitsAvailable;++S)if((this.word&2147483648>>>S)!=0)return this.word<<=S,this.bitsAvailable-=S,S;return this.loadWord(),S+this.skipLZ()},I.skipUEG=function(){this.skipBits(1+this.skipLZ())},I.skipEG=function(){this.skipBits(1+this.skipLZ())},I.readUEG=function(){var S=this.skipLZ();return this.readBits(S+1)-1},I.readEG=function(){var S=this.readUEG();return 1&S?1+S>>>1:-1*(S>>>1)},I.readBoolean=function(){return this.readBits(1)===1},I.readUByte=function(){return this.readBits(8)},I.readUShort=function(){return this.readBits(16)},I.readUInt=function(){return this.readBits(32)},I.skipScalingList=function(S){for(var C=8,O=8,Y=0;Y<S;Y++)O!==0&&(O=(C+this.readEG()+256)%256),C=O===0?C:O},I.readSPS=function(){var S,C,O,Y=0,j=0,J=0,De=0,pe=this.readUByte.bind(this),ke=this.readBits.bind(this),Fe=this.readUEG.bind(this),Qe=this.readBoolean.bind(this),$e=this.skipBits.bind(this),je=this.skipEG.bind(this),ot=this.skipUEG.bind(this),Tt=this.skipScalingList.bind(this);pe();var dt=pe();if(ke(5),$e(3),pe(),ot(),dt===100||dt===110||dt===122||dt===244||dt===44||dt===83||dt===86||dt===118||dt===128){var Ft=Fe();if(Ft===3&&$e(1),ot(),ot(),$e(1),Qe())for(C=Ft!==3?8:12,O=0;O<C;O++)Qe()&&Tt(O<6?16:64)}ot();var Qt=Fe();if(Qt===0)Fe();else if(Qt===1)for($e(1),je(),je(),S=Fe(),O=0;O<S;O++)je();ot(),$e(1);var Pt=Fe(),mt=Fe(),Vt=ke(1);Vt===0&&$e(1),$e(1),Qe()&&(Y=Fe(),j=Fe(),J=Fe(),De=Fe());var bt=[1,1];if(Qe()&&Qe())switch(pe()){case 1:bt=[1,1];break;case 2:bt=[12,11];break;case 3:bt=[10,11];break;case 4:bt=[16,11];break;case 5:bt=[40,33];break;case 6:bt=[24,11];break;case 7:bt=[20,11];break;case 8:bt=[32,11];break;case 9:bt=[80,33];break;case 10:bt=[18,11];break;case 11:bt=[15,11];break;case 12:bt=[64,33];break;case 13:bt=[160,99];break;case 14:bt=[4,3];break;case 15:bt=[3,2];break;case 16:bt=[2,1];break;case 255:bt=[pe()<<8|pe(),pe()<<8|pe()]}return{width:Math.ceil(16*(Pt+1)-2*Y-2*j),height:(2-Vt)*(mt+1)*16-(Vt?2:4)*(J+De),pixelRatio:bt}},I.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},R}(),st=function(){function R(S,C,O){this.keyData=void 0,this.decrypter=void 0,this.keyData=O,this.decrypter=new B.default(S,C,{removePKCS7Padding:!1})}var I=R.prototype;return I.decryptBuffer=function(S,C){this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer,C)},I.decryptAacSample=function(S,C,O,Y){var j=S[C].unit;if(!(j.length<=16)){var J=j.subarray(16,j.length-j.length%16),De=J.buffer.slice(J.byteOffset,J.byteOffset+J.length),pe=this;this.decryptBuffer(De,function(ke){var Fe=new Uint8Array(ke);j.set(Fe,16),Y||pe.decryptAacSamples(S,C+1,O)})}},I.decryptAacSamples=function(S,C,O){for(;;C++){if(C>=S.length)return void O();if(!(S[C].unit.length<32)){var Y=this.decrypter.isSync();if(this.decryptAacSample(S,C,O,Y),!Y)return}}},I.getAvcEncryptedData=function(S){for(var C=16*Math.floor((S.length-48)/160)+16,O=new Int8Array(C),Y=0,j=32;j<S.length-16;j+=160,Y+=16)O.set(S.subarray(j,j+16),Y);return O},I.getAvcDecryptedUnit=function(S,C){for(var O=new Uint8Array(C),Y=0,j=32;j<S.length-16;j+=160,Y+=16)S.set(O.subarray(Y,Y+16),j);return S},I.decryptAvcSample=function(S,C,O,Y,j,J){var De=(0,z.discardEPB)(j.data),pe=this.getAvcEncryptedData(De),ke=this;this.decryptBuffer(pe.buffer,function(Fe){j.data=ke.getAvcDecryptedUnit(De,Fe),J||ke.decryptAvcSamples(S,C,O+1,Y)})},I.decryptAvcSamples=function(S,C,O,Y){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;C++,O=0){if(C>=S.length)return void Y();for(var j=S[C].units;!(O>=j.length);O++){var J=j[O];if(!(J.data.length<=48||J.type!==1&&J.type!==5)){var De=this.decrypter.isSync();if(this.decryptAvcSample(S,C,O,Y,J,De),!De)return}}}},R}();function Et(){return Et=Object.assign?Object.assign.bind():function(R){for(var I=1;I<arguments.length;I++){var S=arguments[I];for(var C in S)Object.prototype.hasOwnProperty.call(S,C)&&(R[C]=S[C])}return R},Et.apply(this,arguments)}var lt=188;function vt(R,I,S,C){return{key:R,frame:!1,pts:I,dts:S,units:[],debug:C,length:0}}function St(R,I){return(31&R[I+10])<<8|R[I+11]}function gt(R,I,S,C){var O={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},Y=I+3+((15&R[I+1])<<8|R[I+2])-4;for(I+=12+((15&R[I+10])<<8|R[I+11]);I<Y;){var j=(31&R[I+1])<<8|R[I+2];switch(R[I]){case 207:if(!C){Q.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:O.audio===-1&&(O.audio=j);break;case 21:O.id3===-1&&(O.id3=j);break;case 219:if(!C){Q.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:O.avc===-1&&(O.avc=j);break;case 3:case 4:S.mpeg!==!0&&S.mp3!==!0?Q.logger.log("MPEG audio found, not supported in this browser"):O.audio===-1&&(O.audio=j,O.segmentCodec="mp3");break;case 36:Q.logger.warn("Unsupported HEVC stream type found")}I+=5+((15&R[I+3])<<8|R[I+4])}return O}function At(R){var I,S,C,O,Y,j=0,J=R.data;if(!R||R.size===0)return null;for(;J[0].length<19&&J.length>1;){var De=new Uint8Array(J[0].length+J[1].length);De.set(J[0]),De.set(J[1],J[0].length),J[0]=De,J.splice(1,1)}if(((I=J[0])[0]<<16)+(I[1]<<8)+I[2]===1){if((S=(I[4]<<8)+I[5])&&S>R.size-6)return null;var pe=I[7];192&pe&&(O=536870912*(14&I[9])+4194304*(255&I[10])+16384*(254&I[11])+128*(255&I[12])+(254&I[13])/2,64&pe?O-(Y=536870912*(14&I[14])+4194304*(255&I[15])+16384*(254&I[16])+128*(255&I[17])+(254&I[18])/2)>54e5&&(Q.logger.warn(Math.round((O-Y)/9e4)+"s delta between PTS and DTS, align them"),O=Y):Y=O);var ke=(C=I[8])+9;if(R.size<=ke)return null;R.size-=ke;for(var Fe=new Uint8Array(R.size),Qe=0,$e=J.length;Qe<$e;Qe++){var je=(I=J[Qe]).byteLength;if(ke){if(ke>je){ke-=je;continue}I=I.subarray(ke),je-=ke,ke=0}Fe.set(I,j),j+=je}return S&&(S-=C+3),{data:Fe,pts:O,dts:Y,len:S}}return null}function Lt(R,I){if(R.units.length&&R.frame){if(R.pts===void 0){var S=I.samples,C=S.length;if(!C)return void I.dropped++;var O=S[C-1];R.pts=O.pts,R.dts=O.dts}I.samples.push(R)}R.debug.length&&Q.logger.log(R.pts+"/"+R.dts+":"+R.debug)}const yt=function(){function R(S,C,O){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=S,this.config=C,this.typeSupported=O}R.probe=function(S){var C=R.syncOffset(S);return C>0&&Q.logger.warn("MPEG2-TS detected but first sync word found @ offset "+C),C!==-1},R.syncOffset=function(S){for(var C=Math.min(940,S.length-376)+1,O=0;O<C;){if(S[O]===71&&S[O+lt]===71)return O;O++}return-1},R.createTrack=function(S,C){return{container:S==="video"||S==="audio"?"video/mp2t":void 0,type:S,id:z.RemuxerTrackIdConfig[S],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:S==="audio"?C:void 0}};var I=R.prototype;return I.resetInitSegment=function(S,C,O,Y){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=R.createTrack("video"),this._audioTrack=R.createTrack("audio",Y),this._id3Track=R.createTrack("id3"),this._txtTrack=R.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=C,this.videoCodec=O,this._duration=Y},I.resetTimeStamp=function(){},I.resetContiguity=function(){var S=this._audioTrack,C=this._avcTrack,O=this._id3Track;S&&(S.pesData=null),C&&(C.pesData=null),O&&(O.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},I.demux=function(S,C,O,Y){var j;O===void 0&&(O=!1),Y===void 0&&(Y=!1),O||(this.sampleAes=null);var J=this._avcTrack,De=this._audioTrack,pe=this._id3Track,ke=this._txtTrack,Fe=J.pid,Qe=J.pesData,$e=De.pid,je=pe.pid,ot=De.pesData,Tt=pe.pesData,dt=null,Ft=this.pmtParsed,Qt=this._pmtId,Pt=S.length;if(this.remainderData&&(Pt=(S=(0,z.appendUint8Array)(this.remainderData,S)).length,this.remainderData=null),Pt<lt&&!Y)return this.remainderData=S,{audioTrack:De,videoTrack:J,id3Track:pe,textTrack:ke};var mt=Math.max(0,R.syncOffset(S));(Pt-=(Pt-mt)%lt)<S.byteLength&&!Y&&(this.remainderData=new Uint8Array(S.buffer,Pt,S.buffer.byteLength-Pt));for(var Vt=0,bt=mt;bt<Pt;bt+=lt)if(S[bt]===71){var zt=!!(64&S[bt+1]),dr=((31&S[bt+1])<<8)+S[bt+2],jt=void 0;if((48&S[bt+3])>>4>1){if((jt=bt+5+S[bt+4])===bt+lt)continue}else jt=bt+4;switch(dr){case Fe:zt&&(Qe&&(j=At(Qe))&&this.parseAVCPES(J,ke,j,!1),Qe={data:[],size:0}),Qe&&(Qe.data.push(S.subarray(jt,bt+lt)),Qe.size+=bt+lt-jt);break;case $e:if(zt){if(ot&&(j=At(ot)))switch(De.segmentCodec){case"aac":this.parseAACPES(De,j);break;case"mp3":this.parseMPEGPES(De,j)}ot={data:[],size:0}}ot&&(ot.data.push(S.subarray(jt,bt+lt)),ot.size+=bt+lt-jt);break;case je:zt&&(Tt&&(j=At(Tt))&&this.parseID3PES(pe,j),Tt={data:[],size:0}),Tt&&(Tt.data.push(S.subarray(jt,bt+lt)),Tt.size+=bt+lt-jt);break;case 0:zt&&(jt+=S[jt]+1),Qt=this._pmtId=St(S,jt);break;case Qt:zt&&(jt+=S[jt]+1);var gr=gt(S,jt,this.typeSupported,O);(Fe=gr.avc)>0&&(J.pid=Fe),($e=gr.audio)>0&&(De.pid=$e,De.segmentCodec=gr.segmentCodec),(je=gr.id3)>0&&(pe.pid=je),dt===null||Ft||(Q.logger.log("unknown PID '"+dt+"' in TS found"),dt=null,bt=mt-188),Ft=this.pmtParsed=!0;break;case 17:case 8191:break;default:dt=dr}}else Vt++;Vt>0&&this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Vt+" TS packet/s that do not start with 0x47"}),J.pesData=Qe,De.pesData=ot,pe.pesData=Tt;var yr={audioTrack:De,videoTrack:J,id3Track:pe,textTrack:ke};return Y&&this.extractRemainingSamples(yr),yr},I.flush=function(){var S,C=this.remainderData;return this.remainderData=null,S=C?this.demux(C,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(S),this.sampleAes?this.decrypt(S,this.sampleAes):S},I.extractRemainingSamples=function(S){var C,O=S.audioTrack,Y=S.videoTrack,j=S.id3Track,J=S.textTrack,De=Y.pesData,pe=O.pesData,ke=j.pesData;if(De&&(C=At(De))?(this.parseAVCPES(Y,J,C,!0),Y.pesData=null):Y.pesData=De,pe&&(C=At(pe))){switch(O.segmentCodec){case"aac":this.parseAACPES(O,C);break;case"mp3":this.parseMPEGPES(O,C)}O.pesData=null}else pe!=null&&pe.size&&Q.logger.log("last AAC PES packet truncated,might overlap between fragments"),O.pesData=pe;ke&&(C=At(ke))?(this.parseID3PES(j,C),j.pesData=null):j.pesData=ke},I.demuxSampleAes=function(S,C,O){var Y=this.demux(S,O,!0,!this.config.progressive),j=this.sampleAes=new st(this.observer,this.config,C);return this.decrypt(Y,j)},I.decrypt=function(S,C){return new Promise(function(O){var Y=S.audioTrack,j=S.videoTrack;Y.samples&&Y.segmentCodec==="aac"?C.decryptAacSamples(Y.samples,0,function(){j.samples?C.decryptAvcSamples(j.samples,0,0,function(){O(S)}):O(S)}):j.samples&&C.decryptAvcSamples(j.samples,0,0,function(){O(S)})})},I.destroy=function(){this._duration=0},I.parseAVCPES=function(S,C,O,Y){var j,J=this,De=this.parseAVCNALu(S,O.data),pe=this.avcSample,ke=!1;O.data=null,pe&&De.length&&!S.audFound&&(Lt(pe,S),pe=this.avcSample=vt(!1,O.pts,O.dts,"")),De.forEach(function(Fe){switch(Fe.type){case 1:j=!0,pe||(pe=J.avcSample=vt(!0,O.pts,O.dts,"")),pe.frame=!0;var Qe=Fe.data;if(ke&&Qe.length>4){var $e=new Ze(Qe).readSliceType();$e!==2&&$e!==4&&$e!==7&&$e!==9||(pe.key=!0)}break;case 5:j=!0,pe||(pe=J.avcSample=vt(!0,O.pts,O.dts,"")),pe.key=!0,pe.frame=!0;break;case 6:j=!0,(0,z.parseSEIMessageFromNALu)(Fe.data,1,O.pts,C.samples);break;case 7:if(j=!0,ke=!0,!S.sps){var je=new Ze(Fe.data).readSPS();S.width=je.width,S.height=je.height,S.pixelRatio=je.pixelRatio,S.sps=[Fe.data],S.duration=J._duration;for(var ot=Fe.data.subarray(1,4),Tt="avc1.",dt=0;dt<3;dt++){var Ft=ot[dt].toString(16);Ft.length<2&&(Ft="0"+Ft),Tt+=Ft}S.codec=Tt}break;case 8:j=!0,S.pps||(S.pps=[Fe.data]);break;case 9:j=!1,S.audFound=!0,pe&&Lt(pe,S),pe=J.avcSample=vt(!1,O.pts,O.dts,"");break;case 12:j=!0;break;default:j=!1,pe&&(pe.debug+="unknown NAL "+Fe.type+" ")}pe&&j&&pe.units.push(Fe)}),Y&&pe&&(Lt(pe,S),this.avcSample=null)},I.getLastNalUnit=function(S){var C,O,Y=this.avcSample;if(Y&&Y.units.length!==0||(Y=S[S.length-1]),(C=Y)!==null&&C!==void 0&&C.units){var j=Y.units;O=j[j.length-1]}return O},I.parseAVCNALu=function(S,C){var O,Y,j=C.byteLength,J=S.naluState||0,De=J,pe=[],ke=0,Fe=-1,Qe=0;for(J===-1&&(Fe=0,Qe=31&C[0],J=0,ke=1);ke<j;)if(O=C[ke++],J)if(J!==1)if(O)if(O===1){if(Fe>=0){var $e={data:C.subarray(Fe,ke-J-1),type:Qe};pe.push($e)}else{var je=this.getLastNalUnit(S.samples);if(je&&(De&&ke<=4-De&&je.state&&(je.data=je.data.subarray(0,je.data.byteLength-De)),(Y=ke-J-1)>0)){var ot=new Uint8Array(je.data.byteLength+Y);ot.set(je.data,0),ot.set(C.subarray(0,Y),je.data.byteLength),je.data=ot,je.state=0}}ke<j?(Fe=ke,Qe=31&C[ke],J=0):J=-1}else J=0;else J=3;else J=O?0:2;else J=O?0:1;if(Fe>=0&&J>=0){var Tt={data:C.subarray(Fe,j),type:Qe,state:J};pe.push(Tt)}if(pe.length===0){var dt=this.getLastNalUnit(S.samples);if(dt){var Ft=new Uint8Array(dt.data.byteLength+C.byteLength);Ft.set(dt.data,0),Ft.set(C,dt.data.byteLength),dt.data=Ft}}return S.naluState=J,pe},I.parseAACPES=function(S,C){var O,Y,j,J,De,pe=0,ke=this.aacOverFlow,Fe=C.data;if(ke){this.aacOverFlow=null;var Qe=ke.missing,$e=ke.sample.unit.byteLength;if(Qe===-1){var je=new Uint8Array($e+Fe.byteLength);je.set(ke.sample.unit,0),je.set(Fe,$e),Fe=je}else{var ot=$e-Qe;ke.sample.unit.set(Fe.subarray(0,Qe),ot),S.samples.push(ke.sample),pe=ke.missing}}for(O=pe,Y=Fe.length;O<Y-1&&!Te(Fe,O);O++);if(O===pe||(O<Y-1?(j="AAC PES did not start with ADTS header,offset:"+O,J=!1):(j="no ADTS header found in AAC PES",J=!0),Q.logger.warn("parsing error:"+j),this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:J,reason:j}),!J)){if(F(S,this.observer,Fe,O,this.audioCodec),C.pts!==void 0)De=C.pts;else{if(!ke)return void Q.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var Tt=k(S.samplerate);De=ke.sample.pts+Tt}for(var dt,Ft=0;O<Y;){if(O+=(dt=W(S,Fe,O,De,Ft)).length,dt.missing){this.aacOverFlow=dt;break}for(Ft++;O<Y-1&&!Te(Fe,O);O++);}}},I.parseMPEGPES=function(S,C){var O=C.data,Y=O.length,j=0,J=0,De=C.pts;if(De!==void 0)for(;J<Y;)if(it(O,J)){var pe=xe(S,O,J,De,j);if(!pe)break;J+=pe.length,j++}else J++;else Q.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},I.parseID3PES=function(S,C){if(C.pts!==void 0){var O=Et({},C,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});S.samples.push(O)}else Q.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},R}();function Ot(R,I){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,C){return S.__proto__=C,S},Ot(R,I)}const _t=function(R){var I,S;function C(){return R.apply(this,arguments)||this}S=R,(I=C).prototype=Object.create(S.prototype),I.prototype.constructor=I,Ot(I,S);var O=C.prototype;return O.resetInitSegment=function(Y,j,J,De){R.prototype.resetInitSegment.call(this,Y,j,J,De),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:j,duration:De,inputTimeScale:9e4,dropped:0}},C.probe=function(Y){if(!Y)return!1;for(var j=(P.getID3Data(Y,0)||[]).length,J=Y.length;j<J;j++)if(me(Y,j))return Q.logger.log("MPEG Audio sync word found !"),!0;return!1},O.canParse=function(Y,j){return function(J,De){return qe(J,De)&&4<=J.length-De}(Y,j)},O.appendFrame=function(Y,j,J){if(this.basePTS!==null)return xe(Y,j,J,this.basePTS,this.frameIndex)},C}(de),Jt=function(){function R(){}return R.getSilentFrame=function(I,S){if(I==="mp4a.40.2"){if(S===1)return new Uint8Array([0,200,0,128,35,128]);if(S===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(S===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(S===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(S===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(S===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(S===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},R}();var Gt=Math.pow(2,32)-1,wt=function(){function R(){}return R.init=function(){var I;for(I in R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},R.types)R.types.hasOwnProperty(I)&&(R.types[I]=[I.charCodeAt(0),I.charCodeAt(1),I.charCodeAt(2),I.charCodeAt(3)]);var S=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);R.HDLR_TYPES={video:S,audio:C};var O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Y=new Uint8Array([0,0,0,0,0,0,0,0]);R.STTS=R.STSC=R.STCO=Y,R.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),R.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),R.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var j=new Uint8Array([105,115,111,109]),J=new Uint8Array([97,118,99,49]),De=new Uint8Array([0,0,0,1]);R.FTYP=R.box(R.types.ftyp,j,De,j,J),R.DINF=R.box(R.types.dinf,R.box(R.types.dref,O))},R.box=function(I){for(var S=8,C=arguments.length,O=new Array(C>1?C-1:0),Y=1;Y<C;Y++)O[Y-1]=arguments[Y];for(var j=O.length,J=j;j--;)S+=O[j].byteLength;var De=new Uint8Array(S);for(De[0]=S>>24&255,De[1]=S>>16&255,De[2]=S>>8&255,De[3]=255&S,De.set(I,4),j=0,S=8;j<J;j++)De.set(O[j],S),S+=O[j].byteLength;return De},R.hdlr=function(I){return R.box(R.types.hdlr,R.HDLR_TYPES[I])},R.mdat=function(I){return R.box(R.types.mdat,I)},R.mdhd=function(I,S){S*=I;var C=Math.floor(S/(Gt+1)),O=Math.floor(S%(Gt+1));return R.box(R.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,C>>24,C>>16&255,C>>8&255,255&C,O>>24,O>>16&255,O>>8&255,255&O,85,196,0,0]))},R.mdia=function(I){return R.box(R.types.mdia,R.mdhd(I.timescale,I.duration),R.hdlr(I.type),R.minf(I))},R.mfhd=function(I){return R.box(R.types.mfhd,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I]))},R.minf=function(I){return I.type==="audio"?R.box(R.types.minf,R.box(R.types.smhd,R.SMHD),R.DINF,R.stbl(I)):R.box(R.types.minf,R.box(R.types.vmhd,R.VMHD),R.DINF,R.stbl(I))},R.moof=function(I,S,C){return R.box(R.types.moof,R.mfhd(I),R.traf(C,S))},R.moov=function(I){for(var S=I.length,C=[];S--;)C[S]=R.trak(I[S]);return R.box.apply(null,[R.types.moov,R.mvhd(I[0].timescale,I[0].duration)].concat(C).concat(R.mvex(I)))},R.mvex=function(I){for(var S=I.length,C=[];S--;)C[S]=R.trex(I[S]);return R.box.apply(null,[R.types.mvex].concat(C))},R.mvhd=function(I,S){S*=I;var C=Math.floor(S/(Gt+1)),O=Math.floor(S%(Gt+1)),Y=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,C>>24,C>>16&255,C>>8&255,255&C,O>>24,O>>16&255,O>>8&255,255&O,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return R.box(R.types.mvhd,Y)},R.sdtp=function(I){var S,C,O=I.samples||[],Y=new Uint8Array(4+O.length);for(S=0;S<O.length;S++)C=O[S].flags,Y[S+4]=C.dependsOn<<4|C.isDependedOn<<2|C.hasRedundancy;return R.box(R.types.sdtp,Y)},R.stbl=function(I){return R.box(R.types.stbl,R.stsd(I),R.box(R.types.stts,R.STTS),R.box(R.types.stsc,R.STSC),R.box(R.types.stsz,R.STSZ),R.box(R.types.stco,R.STCO))},R.avc1=function(I){var S,C,O,Y=[],j=[];for(S=0;S<I.sps.length;S++)O=(C=I.sps[S]).byteLength,Y.push(O>>>8&255),Y.push(255&O),Y=Y.concat(Array.prototype.slice.call(C));for(S=0;S<I.pps.length;S++)O=(C=I.pps[S]).byteLength,j.push(O>>>8&255),j.push(255&O),j=j.concat(Array.prototype.slice.call(C));var J=R.box(R.types.avcC,new Uint8Array([1,Y[3],Y[4],Y[5],255,224|I.sps.length].concat(Y).concat([I.pps.length]).concat(j))),De=I.width,pe=I.height,ke=I.pixelRatio[0],Fe=I.pixelRatio[1];return R.box(R.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,De>>8&255,255&De,pe>>8&255,255&pe,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),J,R.box(R.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),R.box(R.types.pasp,new Uint8Array([ke>>24,ke>>16&255,ke>>8&255,255&ke,Fe>>24,Fe>>16&255,Fe>>8&255,255&Fe])))},R.esds=function(I){var S=I.config.length;return new Uint8Array([0,0,0,0,3,23+S,0,1,0,4,15+S,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([S]).concat(I.config).concat([6,1,2]))},R.mp4a=function(I){var S=I.samplerate;return R.box(R.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,S>>8&255,255&S,0,0]),R.box(R.types.esds,R.esds(I)))},R.mp3=function(I){var S=I.samplerate;return R.box(R.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,S>>8&255,255&S,0,0]))},R.stsd=function(I){return I.type==="audio"?I.segmentCodec==="mp3"&&I.codec==="mp3"?R.box(R.types.stsd,R.STSD,R.mp3(I)):R.box(R.types.stsd,R.STSD,R.mp4a(I)):R.box(R.types.stsd,R.STSD,R.avc1(I))},R.tkhd=function(I){var S=I.id,C=I.duration*I.timescale,O=I.width,Y=I.height,j=Math.floor(C/(Gt+1)),J=Math.floor(C%(Gt+1));return R.box(R.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,255&S,0,0,0,0,j>>24,j>>16&255,j>>8&255,255&j,J>>24,J>>16&255,J>>8&255,255&J,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,O>>8&255,255&O,0,0,Y>>8&255,255&Y,0,0]))},R.traf=function(I,S){var C=R.sdtp(I),O=I.id,Y=Math.floor(S/(Gt+1)),j=Math.floor(S%(Gt+1));return R.box(R.types.traf,R.box(R.types.tfhd,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,255&O])),R.box(R.types.tfdt,new Uint8Array([1,0,0,0,Y>>24,Y>>16&255,Y>>8&255,255&Y,j>>24,j>>16&255,j>>8&255,255&j])),R.trun(I,C.length+16+20+8+16+8+8),C)},R.trak=function(I){return I.duration=I.duration||4294967295,R.box(R.types.trak,R.tkhd(I),R.mdia(I))},R.trex=function(I){var S=I.id;return R.box(R.types.trex,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},R.trun=function(I,S){var C,O,Y,j,J,De,pe=I.samples||[],ke=pe.length,Fe=12+16*ke,Qe=new Uint8Array(Fe);for(S+=8+Fe,Qe.set([I.type==="video"?1:0,0,15,1,ke>>>24&255,ke>>>16&255,ke>>>8&255,255&ke,S>>>24&255,S>>>16&255,S>>>8&255,255&S],0),C=0;C<ke;C++)Y=(O=pe[C]).duration,j=O.size,J=O.flags,De=O.cts,Qe.set([Y>>>24&255,Y>>>16&255,Y>>>8&255,255&Y,j>>>24&255,j>>>16&255,j>>>8&255,255&j,J.isLeading<<2|J.dependsOn,J.isDependedOn<<6|J.hasRedundancy<<4|J.paddingValue<<1|J.isNonSync,61440&J.degradPrio,15&J.degradPrio,De>>>24&255,De>>>16&255,De>>>8&255,255&De],12+16*C);return R.box(R.types.trun,Qe)},R.initSegment=function(I){R.types||R.init();var S=R.moov(I),C=new Uint8Array(R.FTYP.byteLength+S.byteLength);return C.set(R.FTYP),C.set(S,R.FTYP.byteLength),C},R}();wt.types=void 0,wt.HDLR_TYPES=void 0,wt.STTS=void 0,wt.STSC=void 0,wt.STCO=void 0,wt.STSZ=void 0,wt.VMHD=void 0,wt.SMHD=void 0,wt.STSD=void 0,wt.FTYP=void 0,wt.DINF=void 0;const tr=wt;var Zt=X(308);function rr(R,I){return I===void 0&&(I=!1),function(S,C,O,Y){O===void 0&&(O=1),Y===void 0&&(Y=!1);var j=S*C*O;return Y?Math.round(j):j}(R,1e3,11111111111111112e-21,I)}function lr(){return lr=Object.assign?Object.assign.bind():function(R){for(var I=1;I<arguments.length;I++){var S=arguments[I];for(var C in S)Object.prototype.hasOwnProperty.call(S,C)&&(R[C]=S[C])}return R},lr.apply(this,arguments)}var ur=null,hr=null,Xt=function(){function R(S,C,O,Y){if(Y===void 0&&(Y=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=S,this.config=C,this.typeSupported=O,this.ISGenerated=!1,ur===null){var j=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ur=j?parseInt(j[1]):0}if(hr===null){var J=navigator.userAgent.match(/Safari\/(\d+)/i);hr=J?parseInt(J[1]):0}}var I=R.prototype;return I.destroy=function(){},I.resetTimeStamp=function(S){Q.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=S},I.resetNextTimestamp=function(){Q.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},I.resetInitSegment=function(){Q.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},I.getVideoStartPts=function(S){var C=!1,O=S.reduce(function(Y,j){var J=j.pts-Y;return J<-4294967296?(C=!0,sr(Y,j.pts)):J>0?Y:j.pts},S[0].pts);return C&&Q.logger.debug("PTS rollover detected"),O},I.remux=function(S,C,O,Y,j,J,De,pe){var ke,Fe,Qe,$e,je,ot,Tt=j,dt=j,Ft=S.pid>-1,Qt=C.pid>-1,Pt=C.samples.length,mt=S.samples.length>0,Vt=De&&Pt>0||Pt>1;if((!Ft||mt)&&(!Qt||Vt)||this.ISGenerated||De){this.ISGenerated||(Qe=this.generateIS(S,C,j));var bt,zt=this.isVideoContiguous,dr=-1;if(Vt&&(dr=function(ir){for(var vr=0;vr<ir.length;vr++)if(ir[vr].key)return vr;return-1}(C.samples),!zt&&this.config.forceKeyFrameOnDiscontinuity))if(ot=!0,dr>0){Q.logger.warn("[mp4-remuxer]: Dropped "+dr+" out of "+Pt+" video samples due to a missing keyframe");var jt=this.getVideoStartPts(C.samples);C.samples=C.samples.slice(dr),C.dropped+=dr,bt=dt+=(C.samples[0].pts-jt)/C.inputTimeScale}else dr===-1&&(Q.logger.warn("[mp4-remuxer]: No keyframe found out of "+Pt+" video samples"),ot=!1);if(this.ISGenerated){if(mt&&Vt){var gr=this.getVideoStartPts(C.samples),yr=(sr(S.samples[0].pts,gr)-gr)/C.inputTimeScale;Tt+=Math.max(0,yr),dt+=Math.max(0,-yr)}if(mt){if(S.samplerate||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Qe=this.generateIS(S,C,j)),Fe=this.remuxAudio(S,Tt,this.isAudioContiguous,J,Qt||Vt||pe===Zt.PlaylistLevelType.AUDIO?dt:void 0),Vt){var mr=Fe?Fe.endPTS-Fe.startPTS:0;C.inputTimeScale||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Qe=this.generateIS(S,C,j)),ke=this.remuxVideo(C,dt,zt,mr)}}else Vt&&(ke=this.remuxVideo(C,dt,zt,0));ke&&(ke.firstKeyFrame=dr,ke.independent=dr!==-1,ke.firstKeyFramePTS=bt)}}return this.ISGenerated&&(O.samples.length&&(je=ye(O,j,this._initPTS,this._initDTS)),Y.samples.length&&($e=ae(Y,j,this._initPTS))),{audio:Fe,video:ke,initSegment:Qe,independent:ot,text:$e,id3:je}},I.generateIS=function(S,C,O){var Y,j,J,De=S.samples,pe=C.samples,ke=this.typeSupported,Fe={},Qe=!(0,c.isFiniteNumber)(this._initPTS),$e="audio/mp4";if(Qe&&(Y=j=1/0),S.config&&De.length&&(S.timescale=S.samplerate,S.segmentCodec==="mp3"&&(ke.mpeg?($e="audio/mpeg",S.codec=""):ke.mp3&&(S.codec="mp3")),Fe.audio={id:"audio",container:$e,codec:S.codec,initSegment:S.segmentCodec==="mp3"&&ke.mpeg?new Uint8Array(0):tr.initSegment([S]),metadata:{channelCount:S.channelCount}},Qe&&(J=S.inputTimeScale,Y=j=De[0].pts-Math.round(J*O))),C.sps&&C.pps&&pe.length&&(C.timescale=C.inputTimeScale,Fe.video={id:"main",container:"video/mp4",codec:C.codec,initSegment:tr.initSegment([C]),metadata:{width:C.width,height:C.height}},Qe)){J=C.inputTimeScale;var je=this.getVideoStartPts(pe),ot=Math.round(J*O);j=Math.min(j,sr(pe[0].dts,je)-ot),Y=Math.min(Y,je-ot)}if(Object.keys(Fe).length)return this.ISGenerated=!0,Qe&&(this._initPTS=Y,this._initDTS=j),{tracks:Fe,initPTS:Y,timescale:J}},I.remuxVideo=function(S,C,O,Y){var j,J,De=S.inputTimeScale,pe=S.samples,ke=[],Fe=pe.length,Qe=this._initPTS,$e=this.nextAvcDts,je=8,ot=this.videoSampleDuration,Tt=Number.POSITIVE_INFINITY,dt=Number.NEGATIVE_INFINITY,Ft=!1;O&&$e!==null||($e=C*De-(pe[0].pts-sr(pe[0].dts,pe[0].pts)));for(var Qt=0;Qt<Fe;Qt++){var Pt=pe[Qt];Pt.pts=sr(Pt.pts-Qe,$e),Pt.dts=sr(Pt.dts-Qe,$e),Pt.dts<pe[Qt>0?Qt-1:Qt].dts&&(Ft=!0)}Ft&&pe.sort(function(ei,ai){var Ni=ei.dts-ai.dts,Ut=ei.pts-ai.pts;return Ni||Ut}),j=pe[0].dts;var mt=pe[pe.length-1].dts-j,Vt=mt?Math.round(mt/(Fe-1)):ot||S.inputTimeScale/30;if(O){var bt=j-$e,zt=bt>Vt,dr=bt<-1;if((zt||dr)&&(zt?Q.logger.warn("AVC: "+rr(bt,!0)+" ms ("+bt+"dts) hole between fragments detected, filling it"):Q.logger.warn("AVC: "+rr(-bt,!0)+" ms ("+bt+"dts) overlapping between fragments detected"),!dr||$e>pe[0].pts)){j=$e;var jt=pe[0].pts-bt;pe[0].dts=j,pe[0].pts=jt,Q.logger.log("Video: First PTS/DTS adjusted: "+rr(jt,!0)+"/"+rr(j,!0)+", delta: "+rr(bt,!0)+" ms")}}j=Math.max(0,j);for(var gr=0,yr=0,mr=0;mr<Fe;mr++){for(var ir=pe[mr],vr=ir.units,Ar=vr.length,Rr=0,Br=0;Br<Ar;Br++)Rr+=vr[Br].data.length;yr+=Rr,gr+=Ar,ir.length=Rr,ir.dts=Math.max(ir.dts,j),Tt=Math.min(ir.pts,Tt),dt=Math.max(ir.pts,dt)}J=pe[Fe-1].dts;var Pr,qr=yr+4*gr+8;try{Pr=new Uint8Array(qr)}catch(ei){return void this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MUX_ERROR,details:ie.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:qr,reason:"fail allocating video mdat "+qr})}var $r=new DataView(Pr.buffer);$r.setUint32(0,qr),Pr.set(tr.types.mdat,4);for(var zr=!1,Kr=Number.POSITIVE_INFINITY,Nr=Number.POSITIVE_INFINITY,xr=Number.NEGATIVE_INFINITY,Jr=Number.NEGATIVE_INFINITY,kr=0;kr<Fe;kr++){for(var wr=pe[kr],ri=wr.units,ci=0,Or=0,Ii=ri.length;Or<Ii;Or++){var ii=ri[Or],Oi=ii.data,bi=ii.data.byteLength;$r.setUint32(je,bi),je+=4,Pr.set(Oi,je),je+=bi,ci+=4+bi}var gi=void 0;if(kr<Fe-1)ot=pe[kr+1].dts-wr.dts,gi=pe[kr+1].pts-wr.pts;else{var vi=this.config,Xr=kr>0?wr.dts-pe[kr-1].dts:Vt;if(gi=kr>0?wr.pts-pe[kr-1].pts:Vt,vi.stretchShortVideoTrack&&this.nextAudioPts!==null){var pi=Math.floor(vi.maxBufferHole*De),Li=(Y?Tt+Y*De:this.nextAudioPts)-wr.pts;Li>pi?((ot=Li-Xr)<0?ot=Xr:zr=!0,Q.logger.log("[mp4-remuxer]: It is approximately "+Li/90+" ms to the next segment; using duration "+ot/90+" ms for the last video frame.")):ot=Xr}else ot=Xr}var Di=Math.round(wr.pts-wr.dts);Kr=Math.min(Kr,ot),xr=Math.max(xr,ot),Nr=Math.min(Nr,gi),Jr=Math.max(Jr,gi),ke.push(new x(wr.key,ot,ci,Di))}if(ke.length){if(ur){if(ur<70){var mi=ke[0].flags;mi.dependsOn=2,mi.isNonSync=0}}else if(hr&&Jr-Nr<xr-Kr&&Vt/xr<.025&&ke[0].cts===0){Q.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ni=j,Dr=0,yi=ke.length;Dr<yi;Dr++){var Zr=ni+ke[Dr].duration,Pi=ni+ke[Dr].cts;if(Dr<yi-1){var Fi=Zr+ke[Dr+1].cts;ke[Dr].duration=Fi-Pi}else ke[Dr].duration=Dr?ke[Dr-1].duration:Vt;ke[Dr].cts=0,ni=Zr}}}ot=zr||!ot?Vt:ot,this.nextAvcDts=$e=J+ot,this.videoSampleDuration=ot,this.isVideoContiguous=!0;var Mi={data1:tr.moof(S.sequenceNumber++,j,lr({},S,{samples:ke})),data2:Pr,startPTS:Tt/De,endPTS:(dt+ot)/De,startDTS:j/De,endDTS:$e/De,type:"video",hasAudio:!1,hasVideo:!0,nb:ke.length,dropped:S.dropped};return S.samples=[],S.dropped=0,Mi},I.remuxAudio=function(S,C,O,Y,j){var J=S.inputTimeScale,De=J/(S.samplerate?S.samplerate:J),pe=S.segmentCodec==="aac"?1024:1152,ke=pe*De,Fe=this._initPTS,Qe=S.segmentCodec==="mp3"&&this.typeSupported.mpeg,$e=[],je=j!==void 0,ot=S.samples,Tt=Qe?0:8,dt=this.nextAudioPts||-1,Ft=C*J;if(this.isAudioContiguous=O=O||ot.length&&dt>0&&(Y&&Math.abs(Ft-dt)<9e3||Math.abs(sr(ot[0].pts-Fe,Ft)-dt)<20*ke),ot.forEach(function(Or){Or.pts=sr(Or.pts-Fe,Ft)}),!O||dt<0){if(ot=ot.filter(function(Or){return Or.pts>=0}),!ot.length)return;dt=j===0?0:Y&&!je?Math.max(0,Ft):ot[0].pts}if(S.segmentCodec==="aac")for(var Qt=this.config.maxAudioFramesDrift,Pt=0,mt=dt;Pt<ot.length;Pt++){var Vt=ot[Pt],bt=Vt.pts,zt=bt-mt,dr=Math.abs(1e3*zt/J);if(zt<=-Qt*ke&&je)Pt===0&&(Q.logger.warn("Audio frame @ "+(bt/J).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*zt/J)+" ms."),this.nextAudioPts=dt=mt=bt);else if(zt>=Qt*ke&&dr<1e4&&je){var jt=Math.round(zt/ke);(mt=bt-jt*ke)<0&&(jt--,mt+=ke),Pt===0&&(this.nextAudioPts=dt=mt),Q.logger.warn("[mp4-remuxer]: Injecting "+jt+" audio frame @ "+(mt/J).toFixed(3)+"s due to "+Math.round(1e3*zt/J)+" ms gap.");for(var gr=0;gr<jt;gr++){var yr=Math.max(mt,0),mr=Jt.getSilentFrame(S.manifestCodec||S.codec,S.channelCount);mr||(Q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),mr=Vt.unit.subarray()),ot.splice(Pt,0,{unit:mr,pts:yr}),mt+=ke,Pt++}}Vt.pts=mt,mt+=ke}for(var ir,vr=null,Ar=null,Rr=0,Br=ot.length;Br--;)Rr+=ot[Br].unit.byteLength;for(var Pr=0,qr=ot.length;Pr<qr;Pr++){var $r=ot[Pr],zr=$r.unit,Kr=$r.pts;if(Ar!==null)$e[Pr-1].duration=Math.round((Kr-Ar)/De);else{if(O&&S.segmentCodec==="aac"&&(Kr=dt),vr=Kr,!(Rr>0))return;Rr+=Tt;try{ir=new Uint8Array(Rr)}catch(Or){return void this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MUX_ERROR,details:ie.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Rr,reason:"fail allocating audio mdat "+Rr})}Qe||(new DataView(ir.buffer).setUint32(0,Rr),ir.set(tr.types.mdat,4))}ir.set(zr,Tt);var Nr=zr.byteLength;Tt+=Nr,$e.push(new x(!0,pe,Nr,0)),Ar=Kr}var xr=$e.length;if(xr){var Jr=$e[$e.length-1];this.nextAudioPts=dt=Ar+De*Jr.duration;var kr=Qe?new Uint8Array(0):tr.moof(S.sequenceNumber++,vr/De,lr({},S,{samples:$e}));S.samples=[];var wr=vr/J,ri=dt/J,ci={data1:kr,data2:ir,startPTS:wr,endPTS:ri,startDTS:wr,endDTS:ri,type:"audio",hasAudio:!0,hasVideo:!1,nb:xr};return this.isAudioContiguous=!0,ci}},I.remuxEmptyAudio=function(S,C,O,Y){var j=S.inputTimeScale,J=j/(S.samplerate?S.samplerate:j),De=this.nextAudioPts,pe=(De!==null?De:Y.startDTS*j)+this._initDTS,ke=Y.endDTS*j+this._initDTS,Fe=1024*J,Qe=Math.ceil((ke-pe)/Fe),$e=Jt.getSilentFrame(S.manifestCodec||S.codec,S.channelCount);if(Q.logger.warn("[mp4-remuxer]: remux empty Audio"),$e){for(var je=[],ot=0;ot<Qe;ot++){var Tt=pe+ot*Fe;je.push({unit:$e,pts:Tt,dts:Tt})}return S.samples=je,this.remuxAudio(S,C,O,!1)}Q.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},R}();function sr(R,I){var S;if(I===null)return R;for(S=I<R?-8589934592:8589934592;Math.abs(R-I)>4294967296;)R+=S;return R}function ye(R,I,S,C){var O=R.samples.length;if(O){for(var Y=R.inputTimeScale,j=0;j<O;j++){var J=R.samples[j];J.pts=sr(J.pts-S,I*Y)/Y,J.dts=sr(J.dts-C,I*Y)/Y}var De=R.samples;return R.samples=[],{samples:De}}}function ae(R,I,S){var C=R.samples.length;if(C){for(var O=R.inputTimeScale,Y=0;Y<C;Y++){var j=R.samples[Y];j.pts=sr(j.pts-S,I*O)/O}R.samples.sort(function(De,pe){return De.pts-pe.pts});var J=R.samples;return R.samples=[],{samples:J}}}var x=function(R,I,S,C){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=I,this.size=S,this.cts=C,this.flags=new ee(R)},ee=function(R){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=R?2:1,this.isNonSync=R?0:1},$=X(923);function ce(R,I){var S=R==null?void 0:R.codec;return S&&S.length>4?S:S==="hvc1"||S==="hev1"?"hvc1.1.c.L120.90":S==="av01"?"av01.0.04M.08":S==="avc1"||I===$.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const ve=function(){function R(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var I=R.prototype;return I.destroy=function(){},I.resetTimeStamp=function(S){this.initPTS=S,this.lastEndTime=null},I.resetNextTimestamp=function(){this.lastEndTime=null},I.resetInitSegment=function(S,C,O){this.audioCodec=C,this.videoCodec=O,this.generateInitSegment(S),this.emitInitSegment=!0},I.generateInitSegment=function(S){var C=this.audioCodec,O=this.videoCodec;if(!S||!S.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var Y=this.initData=(0,z.parseInitSegment)(S);C||(C=ce(Y.audio,$.ElementaryStreamTypes.AUDIO)),O||(O=ce(Y.video,$.ElementaryStreamTypes.VIDEO));var j={};Y.audio&&Y.video?j.audiovideo={container:"video/mp4",codec:C+","+O,initSegment:S,id:"main"}:Y.audio?j.audio={container:"audio/mp4",codec:C,initSegment:S,id:"audio"}:Y.video?j.video={container:"video/mp4",codec:O,initSegment:S,id:"main"}:Q.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=j},I.remux=function(S,C,O,Y,j){var J,De=this.initPTS,pe=this.lastEndTime,ke={audio:void 0,video:void 0,text:Y,id3:O,initSegment:void 0};(0,c.isFiniteNumber)(pe)||(pe=this.lastEndTime=j||0);var Fe=C.samples;if(!Fe||!Fe.length)return ke;var Qe={initPTS:void 0,timescale:1},$e=this.initData;if($e&&$e.length||(this.generateInitSegment(Fe),$e=this.initData),!$e||!$e.length)return Q.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ke;this.emitInitSegment&&(Qe.tracks=this.initTracks,this.emitInitSegment=!1);var je=(0,z.getStartDTS)($e,Fe);(0,c.isFiniteNumber)(De)||(this.initPTS=Qe.initPTS=De=je-j);var ot=(0,z.getDuration)(Fe,$e),Tt=S?je-De:pe,dt=Tt+ot;(0,z.offsetStartDTS)($e,Fe,De),ot>0?this.lastEndTime=dt:(Q.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var Ft=!!$e.audio,Qt=!!$e.video,Pt="";Ft&&(Pt+="audio"),Qt&&(Pt+="video");var mt={data1:Fe,startPTS:Tt,startDTS:Tt,endPTS:dt,endDTS:dt,type:Pt,hasAudio:Ft,hasVideo:Qt,nb:1,dropped:0};ke.audio=mt.type==="audio"?mt:void 0,ke.video=mt.type!=="audio"?mt:void 0,ke.initSegment=Qe;var Vt=(J=this.initPTS)!=null?J:0;return ke.id3=ye(O,j,Vt,Vt),Y.samples.length&&(ke.text=ae(Y,j,Vt)),ke},R}();var Le;try{Le=self.performance.now.bind(self.performance)}catch(R){Q.logger.debug("Unable to use Performance API on this environment"),Le=self.Date.now}var Ne=[{demux:yt,remux:Xt},{demux:we,remux:ve},{demux:Ae,remux:Xt},{demux:_t,remux:Xt}],ze=function(){function R(S,C,O,Y,j){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=S,this.typeSupported=C,this.config=O,this.vendor=Y,this.id=j}var I=R.prototype;return I.configure=function(S){this.transmuxConfig=S,this.decrypter&&this.decrypter.reset()},I.push=function(S,C,O,Y){var j=this,J=O.transmuxing;J.executeStart=Le();var De=new Uint8Array(S),pe=this.config,ke=this.currentTransmuxState,Fe=this.transmuxConfig;Y&&(this.currentTransmuxState=Y);var Qe=Y||ke,$e=Qe.contiguous,je=Qe.discontinuity,ot=Qe.trackSwitch,Tt=Qe.accurateTimeOffset,dt=Qe.timeOffset,Ft=Qe.initSegmentChange,Qt=Fe.audioCodec,Pt=Fe.videoCodec,mt=Fe.defaultInitPts,Vt=Fe.duration,bt=Fe.initSegmentData;(je||ot||Ft)&&this.resetInitSegment(bt,Qt,Pt,Vt),(je||Ft)&&this.resetInitialTimestamp(mt),$e||this.resetContiguity();var zt=function(mr,ir){var vr=null;return mr.byteLength>0&&ir!=null&&ir.key!=null&&ir.iv!==null&&ir.method!=null&&(vr=ir),vr}(De,C);if(zt&&zt.method==="AES-128"){var dr=this.getDecrypter();if(!pe.enableSoftwareAES)return this.decryptionPromise=dr.webCryptoDecrypt(De,zt.key.buffer,zt.iv.buffer).then(function(mr){var ir=j.push(mr,null,O);return j.decryptionPromise=null,ir}),this.decryptionPromise;var jt=dr.softwareDecrypt(De,zt.key.buffer,zt.iv.buffer);if(!jt)return J.executeEnd=Le(),Be(O);De=new Uint8Array(jt)}this.needsProbing(De,je,ot)&&this.configureTransmuxer(De,Fe);var gr=this.transmux(De,zt,dt,Tt,O),yr=this.currentTransmuxState;return yr.contiguous=!0,yr.discontinuity=!1,yr.trackSwitch=!1,J.executeEnd=Le(),gr},I.flush=function(S){var C=this,O=S.transmuxing;O.executeStart=Le();var Y=this.decrypter,j=this.currentTransmuxState,J=this.decryptionPromise;if(J)return J.then(function(){return C.flush(S)});var De=[],pe=j.timeOffset;if(Y){var ke=Y.flush();ke&&De.push(this.push(ke,null,S))}var Fe=this.demuxer,Qe=this.remuxer;if(!Fe||!Qe)return this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),O.executeEnd=Le(),[Be(S)];var $e=Fe.flush(pe);return rt($e)?$e.then(function(je){return C.flushRemux(De,je,S),De}):(this.flushRemux(De,$e,S),De)},I.flushRemux=function(S,C,O){var Y=C.audioTrack,j=C.videoTrack,J=C.id3Track,De=C.textTrack,pe=this.currentTransmuxState,ke=pe.accurateTimeOffset,Fe=pe.timeOffset;Q.logger.log("[transmuxer.ts]: Flushed fragment "+O.sn+(O.part>-1?" p: "+O.part:"")+" of level "+O.level);var Qe=this.remuxer.remux(Y,j,J,De,Fe,ke,!0,this.id);S.push({remuxResult:Qe,chunkMeta:O}),O.transmuxing.executeEnd=Le()},I.resetInitialTimestamp=function(S){var C=this.demuxer,O=this.remuxer;C&&O&&(C.resetTimeStamp(S),O.resetTimeStamp(S))},I.resetContiguity=function(){var S=this.demuxer,C=this.remuxer;S&&C&&(S.resetContiguity(),C.resetNextTimestamp())},I.resetInitSegment=function(S,C,O,Y){var j=this.demuxer,J=this.remuxer;j&&J&&(j.resetInitSegment(S,C,O,Y),J.resetInitSegment(S,C,O))},I.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},I.transmux=function(S,C,O,Y,j){return C&&C.method==="SAMPLE-AES"?this.transmuxSampleAes(S,C,O,Y,j):this.transmuxUnencrypted(S,O,Y,j)},I.transmuxUnencrypted=function(S,C,O,Y){var j=this.demuxer.demux(S,C,!1,!this.config.progressive),J=j.audioTrack,De=j.videoTrack,pe=j.id3Track,ke=j.textTrack;return{remuxResult:this.remuxer.remux(J,De,pe,ke,C,O,!1,this.id),chunkMeta:Y}},I.transmuxSampleAes=function(S,C,O,Y,j){var J=this;return this.demuxer.demuxSampleAes(S,C,O).then(function(De){return{remuxResult:J.remuxer.remux(De.audioTrack,De.videoTrack,De.id3Track,De.textTrack,O,Y,!1,J.id),chunkMeta:j}})},I.configureTransmuxer=function(S,C){for(var O,Y=this.config,j=this.observer,J=this.typeSupported,De=this.vendor,pe=C.audioCodec,ke=C.defaultInitPts,Fe=C.duration,Qe=C.initSegmentData,$e=C.videoCodec,je=0,ot=Ne.length;je<ot;je++)if(Ne[je].demux.probe(S)){O=Ne[je];break}O||(Q.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),O={demux:we,remux:ve});var Tt=this.demuxer,dt=this.remuxer,Ft=O.remux,Qt=O.demux;dt&&dt instanceof Ft||(this.remuxer=new Ft(j,Y,J,De)),Tt&&Tt instanceof Qt||(this.demuxer=new Qt(j,Y,J),this.probe=Qt.probe),this.resetInitSegment(Qe,pe,$e,Fe),this.resetInitialTimestamp(ke)},I.needsProbing=function(S,C,O){return!this.demuxer||!this.remuxer||C||O},I.getDecrypter=function(){var S=this.decrypter;return S||(S=this.decrypter=new B.default(this.observer,this.config)),S},R}(),Be=function(R){return{remuxResult:{},chunkMeta:R}};function rt(R){return"then"in R&&R.then instanceof Function}var pt=function(R,I,S,C,O){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=R,this.videoCodec=I,this.initSegmentData=S,this.duration=C,this.defaultInitPts=O},ct=function(R,I,S,C,O,Y){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=R,this.contiguous=I,this.accurateTimeOffset=S,this.trackSwitch=C,this.timeOffset=O,this.initSegmentChange=Y}},514:ht=>{ht.exports=void 0},973:(ht,Oe,X)=>{"use strict";var Ee,ie;X.r(Oe),X.d(Oe,{ErrorDetails:()=>ie,ErrorTypes:()=>Ee}),function(B){B.NETWORK_ERROR="networkError",B.MEDIA_ERROR="mediaError",B.KEY_SYSTEM_ERROR="keySystemError",B.MUX_ERROR="muxError",B.OTHER_ERROR="otherError"}(Ee||(Ee={})),function(B){B.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",B.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",B.KEY_SYSTEM_NO_SESSION="keySystemNoSession",B.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",B.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",B.MANIFEST_LOAD_ERROR="manifestLoadError",B.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",B.MANIFEST_PARSING_ERROR="manifestParsingError",B.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",B.LEVEL_EMPTY_ERROR="levelEmptyError",B.LEVEL_LOAD_ERROR="levelLoadError",B.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",B.LEVEL_SWITCH_ERROR="levelSwitchError",B.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",B.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",B.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",B.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",B.FRAG_LOAD_ERROR="fragLoadError",B.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",B.FRAG_DECRYPT_ERROR="fragDecryptError",B.FRAG_PARSING_ERROR="fragParsingError",B.REMUX_ALLOC_ERROR="remuxAllocError",B.KEY_LOAD_ERROR="keyLoadError",B.KEY_LOAD_TIMEOUT="keyLoadTimeOut",B.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",B.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",B.BUFFER_APPEND_ERROR="bufferAppendError",B.BUFFER_APPENDING_ERROR="bufferAppendingError",B.BUFFER_STALLED_ERROR="bufferStalledError",B.BUFFER_FULL_ERROR="bufferFullError",B.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",B.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",B.INTERNAL_EXCEPTION="internalException",B.INTERNAL_ABORTED="aborted",B.UNKNOWN="unknown"}(ie||(ie={}))},851:(ht,Oe,X)=>{"use strict";var Ee;X.r(Oe),X.d(Oe,{Events:()=>Ee}),function(ie){ie.MEDIA_ATTACHING="hlsMediaAttaching",ie.MEDIA_ATTACHED="hlsMediaAttached",ie.MEDIA_DETACHING="hlsMediaDetaching",ie.MEDIA_DETACHED="hlsMediaDetached",ie.BUFFER_RESET="hlsBufferReset",ie.BUFFER_CODECS="hlsBufferCodecs",ie.BUFFER_CREATED="hlsBufferCreated",ie.BUFFER_APPENDING="hlsBufferAppending",ie.BUFFER_APPENDED="hlsBufferAppended",ie.BUFFER_EOS="hlsBufferEos",ie.BUFFER_FLUSHING="hlsBufferFlushing",ie.BUFFER_FLUSHED="hlsBufferFlushed",ie.MANIFEST_LOADING="hlsManifestLoading",ie.MANIFEST_LOADED="hlsManifestLoaded",ie.MANIFEST_PARSED="hlsManifestParsed",ie.LEVEL_SWITCHING="hlsLevelSwitching",ie.LEVEL_SWITCHED="hlsLevelSwitched",ie.LEVEL_LOADING="hlsLevelLoading",ie.LEVEL_LOADED="hlsLevelLoaded",ie.LEVEL_UPDATED="hlsLevelUpdated",ie.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",ie.LEVELS_UPDATED="hlsLevelsUpdated",ie.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",ie.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",ie.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",ie.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",ie.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",ie.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",ie.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",ie.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",ie.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",ie.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",ie.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",ie.CUES_PARSED="hlsCuesParsed",ie.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",ie.INIT_PTS_FOUND="hlsInitPtsFound",ie.FRAG_LOADING="hlsFragLoading",ie.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",ie.FRAG_LOADED="hlsFragLoaded",ie.FRAG_DECRYPTED="hlsFragDecrypted",ie.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",ie.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",ie.FRAG_PARSING_METADATA="hlsFragParsingMetadata",ie.FRAG_PARSED="hlsFragParsed",ie.FRAG_BUFFERED="hlsFragBuffered",ie.FRAG_CHANGED="hlsFragChanged",ie.FPS_DROP="hlsFpsDrop",ie.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",ie.ERROR="hlsError",ie.DESTROYING="hlsDestroying",ie.KEY_LOADING="hlsKeyLoading",ie.KEY_LOADED="hlsKeyLoaded",ie.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",ie.BACK_BUFFER_REACHED="hlsBackBufferReached"}(Ee||(Ee={}))},392:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>Gi});var Ee,ie=X(945),B=X(965),c=X(851),P=X(973),_=X(93),se=X(63),z=/^(\d+)x(\d+)$/,K=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,te=function(){function w(o){for(var l in typeof o=="string"&&(o=w.parseAttrList(o)),o)o.hasOwnProperty(l)&&(this[l]=o[l])}var b=w.prototype;return b.decimalInteger=function(o){var l=parseInt(this[o],10);return l>Number.MAX_SAFE_INTEGER?1/0:l},b.hexadecimalInteger=function(o){if(this[o]){var l=(this[o]||"0x").slice(2);l=(1&l.length?"0":"")+l;for(var g=new Uint8Array(l.length/2),m=0;m<l.length/2;m++)g[m]=parseInt(l.slice(2*m,2*m+2),16);return g}return null},b.hexadecimalIntegerAsNumber=function(o){var l=parseInt(this[o],16);return l>Number.MAX_SAFE_INTEGER?1/0:l},b.decimalFloatingPoint=function(o){return parseFloat(this[o])},b.optionalFloat=function(o,l){var g=this[o];return g?parseFloat(g):l},b.enumeratedString=function(o){return this[o]},b.bool=function(o){return this[o]==="YES"},b.decimalResolution=function(o){var l=z.exec(this[o]);if(l!==null)return{width:parseInt(l[1],10),height:parseInt(l[2],10)}},w.parseAttrList=function(o){var l,g={};for(K.lastIndex=0;(l=K.exec(o))!==null;){var m=l[2];m.indexOf('"')===0&&m.lastIndexOf('"')===m.length-1&&(m=m.slice(1,-1)),g[l[1]]=m}return g},w}();function re(){return re=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(w[l]=o[l])}return w},re.apply(this,arguments)}function de(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}(function(w){w.ID="ID",w.CLASS="CLASS",w.START_DATE="START-DATE",w.DURATION="DURATION",w.END_DATE="END-DATE",w.END_ON_NEXT="END-ON-NEXT",w.PLANNED_DURATION="PLANNED-DURATION",w.SCTE35_OUT="SCTE35-OUT",w.SCTE35_IN="SCTE35-IN"})(Ee||(Ee={}));var Q=function(){function w(l,g){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,g){var m=g.attr;for(var p in m)if(Object.prototype.hasOwnProperty.call(l,p)&&l[p]!==m[p]){_.logger.warn('DATERANGE tag attribute: "'+p+'" does not match for tags with ID: "'+l.ID+'"'),this._badValueForSameId=p;break}l=re(new te({}),m,l)}if(this.attr=l,this._startDate=new Date(l[Ee.START_DATE]),Ee.END_DATE in this.attr){var h=new Date(this.attr[Ee.END_DATE]);(0,B.isFiniteNumber)(h.getTime())&&(this._endDate=h)}}var b,o;return b=w,(o=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var l=this.duration;return l!==null?new Date(this._startDate.getTime()+1e3*l):null}},{key:"duration",get:function(){if(Ee.DURATION in this.attr){var l=this.attr.decimalFloatingPoint(Ee.DURATION);if((0,B.isFiniteNumber)(l))return l}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return Ee.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(Ee.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(Ee.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,B.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&de(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}(),ne=X(923);function le(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}var Re=function(){function w(l){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=l}var b,o;return w.prototype.reloaded=function(l){if(!l)return this.advanced=!0,void(this.updated=!0);var g=this.lastPartSn-l.lastPartSn,m=this.lastPartIndex-l.lastPartIndex;this.updated=this.endSN!==l.endSN||!!m||!!g,this.advanced=this.endSN>l.endSN||g>0||g===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(.6*l.misses):this.misses=l.misses+1,this.availabilityDelay=l.availabilityDelay},b=w,(o=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,B.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var l=this.driftEndTime-this.driftStartTime;return l>0?1e3*(this.driftEnd-this.driftStart)/l:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var l;return(l=this.fragments)!==null&&l!==void 0&&l.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&le(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}(),Te=X(960),Pe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function F(w,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+w+'"')}var k=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,W=/#EXT-X-MEDIA:(.*)/g,H=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Ae=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),_e=/\.(mp4|m4s|m4v|m4a)$/i,we=function(){function w(){}return w.findGroup=function(b,o){for(var l=0;l<b.length;l++){var g=b[l];if(g.id===o)return g}},w.convertAVC1ToAVCOTI=function(b){var o=b.split(".");if(o.length>2){var l=o.shift()+".";return(l+=parseInt(o.shift()).toString(16))+("000"+parseInt(o.shift()).toString(16)).slice(-4)}return b},w.resolve=function(b,o){return ie.buildAbsoluteURL(o,b,{alwaysNormalize:!0})},w.parseMasterPlaylist=function(b,o){var l,g=[],m=[],p={},h=!1;for(k.lastIndex=0;(l=k.exec(b))!=null;)if(l[1]){var y,T=new te(l[1]),L={attrs:T,bitrate:T.decimalInteger("AVERAGE-BANDWIDTH")||T.decimalInteger("BANDWIDTH"),name:T.NAME,url:w.resolve(l[2],o)},A=T.decimalResolution("RESOLUTION");A&&(L.width=A.width,L.height=A.height),U((T.CODECS||"").split(/[ ,]+/).filter(function(oe){return oe}),L),L.videoCodec&&L.videoCodec.indexOf("avc1")!==-1&&(L.videoCodec=w.convertAVC1ToAVCOTI(L.videoCodec)),(y=L.unknownCodecs)!==null&&y!==void 0&&y.length||m.push(L),g.push(L)}else if(l[3]){var M=new te(l[3]);M["DATA-ID"]&&(h=!0,p[M["DATA-ID"]]=M)}return{levels:m.length>0&&m.length<g.length?m:g,sessionData:h?p:null}},w.parseMasterPlaylistMedia=function(b,o,l,g){var m;g===void 0&&(g=[]);var p=[],h=0;for(W.lastIndex=0;(m=W.exec(b))!==null;){var y=new te(m[1]);if(y.TYPE===l){var T={attrs:y,bitrate:0,id:h++,groupId:y["GROUP-ID"],instreamId:y["INSTREAM-ID"],name:y.NAME||y.LANGUAGE||"",type:l,default:y.bool("DEFAULT"),autoselect:y.bool("AUTOSELECT"),forced:y.bool("FORCED"),lang:y.LANGUAGE,url:y.URI?w.resolve(y.URI,o):""};if(g.length){var L=w.findGroup(g,T.groupId)||g[0];ue(T,L,"audioCodec"),ue(T,L,"textCodec")}p.push(T)}}return p},w.parseLevelPlaylist=function(b,o,l,g,m){var p,h,y,T=new Re(o),L=T.fragments,A=null,M=0,oe=0,fe=0,Se=0,Ce=null,Ie=new ne.Fragment(g,o),ft=-1,nt=!1;for(H.lastIndex=0,T.m3u8=b;(p=H.exec(b))!==null;){nt&&(nt=!1,(Ie=new ne.Fragment(g,o)).start=fe,Ie.sn=M,Ie.cc=Se,Ie.level=l,A&&(Ie.initSegment=A,Ie.rawProgramDateTime=A.rawProgramDateTime,A.rawProgramDateTime=null));var Ye=p[1];if(Ye){Ie.duration=parseFloat(Ye);var Je=(" "+p[2]).slice(1);Ie.title=Je||null,Ie.tagList.push(Je?["INF",Ye,Je]:["INF",Ye])}else if(p[3])(0,B.isFiniteNumber)(Ie.duration)&&(Ie.start=fe,y&&(Ie.levelkey=y),Ie.sn=M,Ie.level=l,Ie.cc=Se,Ie.urlId=m,L.push(Ie),Ie.relurl=(" "+p[3]).slice(1),Z(Ie,Ce),Ce=Ie,fe+=Ie.duration,M++,oe=0,nt=!0);else if(p[4]){var et=(" "+p[4]).slice(1);Ce?Ie.setByteRange(et,Ce):Ie.setByteRange(et)}else if(p[5])Ie.rawProgramDateTime=(" "+p[5]).slice(1),Ie.tagList.push(["PROGRAM-DATE-TIME",Ie.rawProgramDateTime]),ft===-1&&(ft=L.length);else{if(!(p=p[0].match(Ae))){_.logger.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<p.length&&p[h]===void 0;h++);var He=(" "+p[h]).slice(1),at=(" "+p[h+1]).slice(1),Rt=p[h+2]?(" "+p[h+2]).slice(1):"";switch(He){case"PLAYLIST-TYPE":T.type=at.toUpperCase();break;case"MEDIA-SEQUENCE":M=T.startSN=parseInt(at);break;case"SKIP":var $t=new te(at),Ct=$t.decimalInteger("SKIPPED-SEGMENTS");if((0,B.isFiniteNumber)(Ct)){T.skippedSegments=Ct;for(var qt=Ct;qt--;)L.unshift(null);M+=Ct}var or=$t.enumeratedString("RECENTLY-REMOVED-DATERANGES");or&&(T.recentlyRemovedDateranges=or.split("	"));break;case"TARGETDURATION":T.targetduration=parseFloat(at);break;case"VERSION":T.version=parseInt(at);break;case"EXTM3U":break;case"ENDLIST":T.live=!1;break;case"#":(at||Rt)&&Ie.tagList.push(Rt?[at,Rt]:[at]);break;case"DISCONTINUITY":Se++,Ie.tagList.push(["DIS"]);break;case"GAP":Ie.tagList.push([He]);break;case"BITRATE":Ie.tagList.push([He,at]);break;case"DATERANGE":var Bt=new te(at),Mt=new Q(Bt,T.dateRanges[Bt.ID]);Mt.isValid||T.skippedSegments?T.dateRanges[Mt.id]=Mt:_.logger.warn('Ignoring invalid DATERANGE tag: "'+at+'"'),Ie.tagList.push(["EXT-X-DATERANGE",at]);break;case"DISCONTINUITY-SEQUENCE":Se=parseInt(at);break;case"KEY":var nr,pr=new te(at),br=pr.enumeratedString("METHOD"),Lr=pr.URI,_r=pr.hexadecimalInteger("IV"),si=pr.enumeratedString("KEYFORMATVERSIONS"),Ei=pr.enumeratedString("KEYID"),It=(nr=pr.enumeratedString("KEYFORMAT"))!=null?nr:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(It)>-1){_.logger.warn("Keyformat "+It+" is not supported from the manifest");continue}if(It!=="identity")continue;br&&(y=Te.LevelKey.fromURL(o,Lr),Lr&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(br)>=0&&(y.method=br,y.keyFormat=It,Ei&&(y.keyID=Ei),si&&(y.keyFormatVersions=si),y.iv=_r));break;case"START":var Nt=new te(at).decimalFloatingPoint("TIME-OFFSET");(0,B.isFiniteNumber)(Nt)&&(T.startTimeOffset=Nt);break;case"MAP":var oi=new te(at);if(Ie.duration){var Hr=new ne.Fragment(g,o);he(Hr,oi,l,y),A=Hr,Ie.initSegment=A,A.rawProgramDateTime&&!Ie.rawProgramDateTime&&(Ie.rawProgramDateTime=A.rawProgramDateTime)}else he(Ie,oi,l,y),A=Ie,nt=!0;break;case"SERVER-CONTROL":var Fr=new te(at);T.canBlockReload=Fr.bool("CAN-BLOCK-RELOAD"),T.canSkipUntil=Fr.optionalFloat("CAN-SKIP-UNTIL",0),T.canSkipDateRanges=T.canSkipUntil>0&&Fr.bool("CAN-SKIP-DATERANGES"),T.partHoldBack=Fr.optionalFloat("PART-HOLD-BACK",0),T.holdBack=Fr.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var li=new te(at);T.partTarget=li.decimalFloatingPoint("PART-TARGET");break;case"PART":var Mr=T.partList;Mr||(Mr=T.partList=[]);var Vr=oe>0?Mr[Mr.length-1]:void 0,ui=oe++,Ur=new ne.Part(new te(at),Ie,o,ui,Vr);Mr.push(Ur),Ie.duration+=Ur.duration;break;case"PRELOAD-HINT":var Ai=new te(at);T.preloadHint=Ai;break;case"RENDITION-REPORT":var Ti=new te(at);T.renditionReports=T.renditionReports||[],T.renditionReports.push(Ti);break;default:_.logger.warn("line parsed but not handled: "+p)}}}Ce&&!Ce.relurl?(L.pop(),fe-=Ce.duration,T.partList&&(T.fragmentHint=Ce)):T.partList&&(Z(Ie,Ce),Ie.cc=Se,T.fragmentHint=Ie);var Ki=L.length,Qr=L[0],Hi=L[Ki-1];if((fe+=T.skippedSegments*T.targetduration)>0&&Ki&&Hi){T.averagetargetduration=fe/Ki;var en=Hi.sn;T.endSN=en!=="initSegment"?en:0,Qr&&(T.startCC=Qr.cc,Qr.initSegment||T.fragments.every(function(Ri){return Ri.relurl&&(Er=Ri.relurl,_e.test((di=(hi=ie.parseURL(Er))===null||hi===void 0?void 0:hi.path)!=null?di:""));var Er,di,hi})&&(_.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(Ie=new ne.Fragment(g,o)).relurl=Hi.relurl,Ie.level=l,Ie.sn="initSegment",Qr.initSegment=Ie,T.needSidxRanges=!0))}else T.endSN=0,T.startCC=0;return T.fragmentHint&&(fe+=T.fragmentHint.duration),T.totalduration=fe,T.endCC=Se,ft>0&&function(Ri,Er){for(var di=Ri[Er],hi=Er;hi--;){var ki=Ri[hi];if(!ki)return;ki.programDateTime=di.programDateTime-1e3*ki.duration,di=ki}}(L,ft),T},w}();function U(w,b){["video","audio","text"].forEach(function(o){var l=w.filter(function(m){return function(p,h){var y=Pe[h];return!!y&&y[p.slice(0,4)]===!0}(m,o)});if(l.length){var g=l.filter(function(m){return m.lastIndexOf("avc1",0)===0||m.lastIndexOf("mp4a",0)===0});b[o+"Codec"]=g.length>0?g[0]:l[0],w=w.filter(function(m){return l.indexOf(m)===-1})}}),b.unknownCodecs=w}function ue(w,b,o){var l=b[o];l&&(w[o]=l)}function Z(w,b){w.rawProgramDateTime?w.programDateTime=Date.parse(w.rawProgramDateTime):b!=null&&b.programDateTime&&(w.programDateTime=b.endProgramDateTime),(0,B.isFiniteNumber)(w.programDateTime)||(w.programDateTime=null,w.rawProgramDateTime=null)}function he(w,b,o,l){w.relurl=b.URI,b.BYTERANGE&&w.setByteRange(b.BYTERANGE),w.level=o,w.sn="initSegment",l&&(w.levelkey=l),w.initSegment=null}var G=X(308);function xe(w,b){var o=w.url;return o!==void 0&&o.indexOf("data:")!==0||(o=b.url),o}const Ge=function(){function w(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var b=w.prototype;return b.startLoad=function(o){},b.stopLoad=function(){this.destroyInternalLoaders()},b.registerListeners=function(){var o=this.hls;o.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.on(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.unregisterListeners=function(){var o=this.hls;o.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.off(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.createInternalLoader=function(o){var l=this.hls.config,g=l.pLoader,m=l.loader,p=new(g||m)(l);return o.loader=p,this.loaders[o.type]=p,p},b.getInternalLoader=function(o){return this.loaders[o.type]},b.resetInternalLoader=function(o){this.loaders[o]&&delete this.loaders[o]},b.destroyInternalLoaders=function(){for(var o in this.loaders){var l=this.loaders[o];l&&l.destroy(),this.resetInternalLoader(o)}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onManifestLoading=function(o,l){var g=l.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:G.PlaylistContextType.MANIFEST,url:g,deliveryDirectives:null})},b.onLevelLoading=function(o,l){var g=l.id,m=l.level,p=l.url,h=l.deliveryDirectives;this.load({id:g,groupId:null,level:m,responseType:"text",type:G.PlaylistContextType.LEVEL,url:p,deliveryDirectives:h})},b.onAudioTrackLoading=function(o,l){var g=l.id,m=l.groupId,p=l.url,h=l.deliveryDirectives;this.load({id:g,groupId:m,level:null,responseType:"text",type:G.PlaylistContextType.AUDIO_TRACK,url:p,deliveryDirectives:h})},b.onSubtitleTrackLoading=function(o,l){var g=l.id,m=l.groupId,p=l.url,h=l.deliveryDirectives;this.load({id:g,groupId:m,level:null,responseType:"text",type:G.PlaylistContextType.SUBTITLE_TRACK,url:p,deliveryDirectives:h})},b.load=function(o){var l,g,m,p,h,y,T=this.hls.config,L=this.getInternalLoader(o);if(L){var A=L.context;if(A&&A.url===o.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+o.type),L.abort()}switch(o.type){case G.PlaylistContextType.MANIFEST:g=T.manifestLoadingMaxRetry,m=T.manifestLoadingTimeOut,p=T.manifestLoadingRetryDelay,h=T.manifestLoadingMaxRetryTimeout;break;case G.PlaylistContextType.LEVEL:case G.PlaylistContextType.AUDIO_TRACK:case G.PlaylistContextType.SUBTITLE_TRACK:g=0,m=T.levelLoadingTimeOut;break;default:g=T.levelLoadingMaxRetry,m=T.levelLoadingTimeOut,p=T.levelLoadingRetryDelay,h=T.levelLoadingMaxRetryTimeout}if(L=this.createInternalLoader(o),(l=o.deliveryDirectives)!==null&&l!==void 0&&l.part&&(o.type===G.PlaylistContextType.LEVEL&&o.level!==null?y=this.hls.levels[o.level].details:o.type===G.PlaylistContextType.AUDIO_TRACK&&o.id!==null?y=this.hls.audioTracks[o.id].details:o.type===G.PlaylistContextType.SUBTITLE_TRACK&&o.id!==null&&(y=this.hls.subtitleTracks[o.id].details),y)){var M=y.partTarget,oe=y.targetduration;M&&oe&&(m=Math.min(1e3*Math.max(3*M,.8*oe),m))}var fe={timeout:m,maxRetry:g,retryDelay:p,maxRetryDelay:h,highWaterMark:0},Se={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};L.load(o,fe,Se)},b.loadsuccess=function(o,l,g,m){if(m===void 0&&(m=null),g.isSidxRequest)return this.handleSidxRequest(o,g),void this.handlePlaylistLoaded(o,l,g,m);this.resetInternalLoader(g.type);var p=o.data;p.indexOf("#EXTM3U")===0?(l.parsing.start=performance.now(),p.indexOf("#EXTINF:")>0||p.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(o,l,g,m):this.handleMasterPlaylist(o,l,g,m)):this.handleManifestParsingError(o,g,"no EXTM3U delimiter",m)},b.loaderror=function(o,l,g){g===void 0&&(g=null),this.handleNetworkError(l,g,!1,o)},b.loadtimeout=function(o,l,g){g===void 0&&(g=null),this.handleNetworkError(l,g,!0)},b.handleMasterPlaylist=function(o,l,g,m){var p=this.hls,h=o.data,y=xe(o,g),T=we.parseMasterPlaylist(h,y),L=T.levels,A=T.sessionData;if(L.length){var M=L.map(function(Ie){return{id:Ie.attrs.AUDIO,audioCodec:Ie.audioCodec}}),oe=L.map(function(Ie){return{id:Ie.attrs.SUBTITLES,textCodec:Ie.textCodec}}),fe=we.parseMasterPlaylistMedia(h,y,"AUDIO",M),Se=we.parseMasterPlaylistMedia(h,y,"SUBTITLES",oe),Ce=we.parseMasterPlaylistMedia(h,y,"CLOSED-CAPTIONS");fe.length&&(fe.some(function(Ie){return!Ie.url})||!L[0].audioCodec||L[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),fe.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new te({}),bitrate:0,url:""}))),p.trigger(c.Events.MANIFEST_LOADED,{levels:L,audioTracks:fe,subtitles:Se,captions:Ce,url:y,stats:l,networkDetails:m,sessionData:A})}else this.handleManifestParsingError(o,g,"no level found in manifest",m)},b.handleTrackOrLevelPlaylist=function(o,l,g,m){var p=this.hls,h=g.id,y=g.level,T=g.type,L=xe(o,g),A=(0,B.isFiniteNumber)(h)?h:0,M=(0,B.isFiniteNumber)(y)?y:A,oe=function(ft){switch(ft.type){case G.PlaylistContextType.AUDIO_TRACK:return G.PlaylistLevelType.AUDIO;case G.PlaylistContextType.SUBTITLE_TRACK:return G.PlaylistLevelType.SUBTITLE;default:return G.PlaylistLevelType.MAIN}}(g),fe=we.parseLevelPlaylist(o.data,L,M,oe,A);if(fe.fragments.length){if(T===G.PlaylistContextType.MANIFEST){var Se={attrs:new te({}),bitrate:0,details:fe,name:"",url:L};p.trigger(c.Events.MANIFEST_LOADED,{levels:[Se],audioTracks:[],url:L,stats:l,networkDetails:m,sessionData:null})}if(l.parsing.end=performance.now(),fe.needSidxRanges){var Ce,Ie=(Ce=fe.fragments[0].initSegment)===null||Ce===void 0?void 0:Ce.url;this.load({url:Ie,isSidxRequest:!0,type:T,level:y,levelDetails:fe,id:h,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else g.levelDetails=fe,this.handlePlaylistLoaded(o,l,g,m)}else p.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:L,reason:"no fragments found in level",level:typeof g.level=="number"?g.level:void 0})},b.handleSidxRequest=function(o,l){var g=new Uint8Array(o.data),m=(0,se.findBox)(g,["sidx"])[0];if(m){var p=(0,se.parseSegmentIndex)(m);if(p){var h=p.references,y=l.levelDetails;h.forEach(function(T,L){var A=T.info,M=y.fragments[L];if(M.byteRange.length===0&&M.setByteRange(String(1+A.end-A.start)+"@"+String(A.start)),M.initSegment){var oe=(0,se.findBox)(g,["moov"])[0],fe=oe?oe.length:null;M.initSegment.setByteRange(String(fe)+"@0")}})}}},b.handleManifestParsingError=function(o,l,g,m){this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:l.type===G.PlaylistContextType.MANIFEST,url:o.url,reason:g,response:o,context:l,networkDetails:m})},b.handleNetworkError=function(o,l,g,m){g===void 0&&(g=!1),_.logger.warn("[playlist-loader]: A network "+(g?"timeout":"error")+" occurred while loading "+o.type+" level: "+o.level+" id: "+o.id+' group-id: "'+o.groupId+'"');var p=P.ErrorDetails.UNKNOWN,h=!1,y=this.getInternalLoader(o);switch(o.type){case G.PlaylistContextType.MANIFEST:p=g?P.ErrorDetails.MANIFEST_LOAD_TIMEOUT:P.ErrorDetails.MANIFEST_LOAD_ERROR,h=!0;break;case G.PlaylistContextType.LEVEL:p=g?P.ErrorDetails.LEVEL_LOAD_TIMEOUT:P.ErrorDetails.LEVEL_LOAD_ERROR,h=!1;break;case G.PlaylistContextType.AUDIO_TRACK:p=g?P.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:P.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case G.PlaylistContextType.SUBTITLE_TRACK:p=g?P.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:P.ErrorDetails.SUBTITLE_LOAD_ERROR,h=!1}y&&this.resetInternalLoader(o.type);var T={type:P.ErrorTypes.NETWORK_ERROR,details:p,fatal:h,url:o.url,loader:y,context:o,networkDetails:l};m&&(T.response=m),this.hls.trigger(c.Events.ERROR,T)},b.handlePlaylistLoaded=function(o,l,g,m){var p=g.type,h=g.level,y=g.id,T=g.groupId,L=g.loader,A=g.levelDetails,M=g.deliveryDirectives;if(A!=null&&A.targetduration){if(L)switch(A.live&&(L.getCacheAge&&(A.ageHeader=L.getCacheAge()||0),L.getCacheAge&&!isNaN(A.ageHeader)||(A.ageHeader=0)),p){case G.PlaylistContextType.MANIFEST:case G.PlaylistContextType.LEVEL:this.hls.trigger(c.Events.LEVEL_LOADED,{details:A,level:h||0,id:y||0,stats:l,networkDetails:m,deliveryDirectives:M});break;case G.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,{details:A,id:y||0,groupId:T||"",stats:l,networkDetails:m,deliveryDirectives:M});break;case G.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADED,{details:A,id:y||0,groupId:T||"",stats:l,networkDetails:m,deliveryDirectives:M})}}else this.handleManifestParsingError(o,g,"invalid target duration",m)},w}();var qe=function(){function w(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this.registerListeners()}var b=w.prototype;return b.startLoad=function(o){},b.stopLoad=function(){this.destroyInternalLoaders()},b.registerListeners=function(){this.hls.on(c.Events.KEY_LOADING,this.onKeyLoading,this)},b.unregisterListeners=function(){this.hls.off(c.Events.KEY_LOADING,this.onKeyLoading)},b.destroyInternalLoaders=function(){for(var o in this.loaders){var l=this.loaders[o];l&&l.destroy()}this.loaders={}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onKeyLoading=function(o,l){var g=l.frag,m=g.type,p=this.loaders[m];if(g.decryptdata){var h=g.decryptdata.uri;if(h!==this.decrypturl||this.decryptkey===null){var y=this.hls.config;if(p&&(_.logger.warn("abort previous key loader for type:"+m),p.abort()),!h)return void _.logger.warn("key uri is falsy");var T=y.loader,L=g.loader=this.loaders[m]=new T(y);this.decrypturl=h,this.decryptkey=null;var A={url:h,frag:g,responseType:"arraybuffer"},M={timeout:y.fragLoadingTimeOut,maxRetry:0,retryDelay:y.fragLoadingRetryDelay,maxRetryDelay:y.fragLoadingMaxRetryTimeout,highWaterMark:0},oe={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};L.load(A,M,oe)}else this.decryptkey&&(g.decryptdata.key=this.decryptkey,this.hls.trigger(c.Events.KEY_LOADED,{frag:g}))}else _.logger.warn("Missing decryption data on fragment in onKeyLoading")},b.loadsuccess=function(o,l,g){var m=g.frag;m.decryptdata?(this.decryptkey=m.decryptdata.key=new Uint8Array(o.data),m.loader=null,delete this.loaders[m.type],this.hls.trigger(c.Events.KEY_LOADED,{frag:m})):_.logger.error("after key load, decryptdata unset")},b.loaderror=function(o,l){var g=l.frag,m=g.loader;m&&m.abort(),delete this.loaders[g.type],this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:g,response:o})},b.loadtimeout=function(o,l){var g=l.frag,m=g.loader;m&&m.abort(),delete this.loaders[g.type],this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:g})},w}();function it(w,b){var o;try{o=new Event("addtrack")}catch(l){(o=document.createEvent("Event")).initEvent("addtrack",!1,!1)}o.track=w,b.dispatchEvent(o)}var me=X(181),Ze=X(856);function st(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Et=function(){var w=st();try{new w(0,Number.POSITIVE_INFINITY,"")}catch(b){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function lt(w,b){return w.getTime()/1e3-b}const vt=function(){function w(o){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=o,this._registerListeners()}var b=w.prototype;return b.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},b._registerListeners=function(){var o=this.hls;o.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},b._unregisterListeners=function(){var o=this.hls;o.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},b.onMediaAttached=function(o,l){this.media=l.media},b.onMediaDetaching=function(){this.id3Track&&(function(o){var l=o.mode;if(l==="disabled"&&(o.mode="hidden"),o.cues)for(var g=o.cues.length;g--;)o.removeCue(o.cues[g]);l==="disabled"&&(o.mode=l)}(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},b.onManifestLoading=function(){this.dateRangeCuesAppended={}},b.createTrack=function(o){var l=this.getID3Track(o.textTracks);return l.mode="hidden",l},b.getID3Track=function(o){if(this.media){for(var l=0;l<o.length;l++){var g=o[l];if(g.kind==="metadata"&&g.label==="id3")return it(g,this.media),g}return this.media.addTextTrack("metadata","id3")}},b.onFragParsingMetadata=function(o,l){if(this.media){var g=this.hls.config,m=g.enableEmsgMetadataCues,p=g.enableID3MetadataCues;if(m||p){l.frag;var h=l.samples;l.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=st(),T=0;T<h.length;T++){var L=h[T].type;if((L!==Ze.MetadataSchema.emsg||m)&&p){var A=me.getID3Frames(h[T].data);if(A){var M=h[T].pts,oe=M+h[T].duration;oe>Et&&(oe=Et),oe-M<=0&&(oe=M+.25);for(var fe=0;fe<A.length;fe++){var Se=A[fe];if(!me.isTimeStampFrame(Se)){this.updateId3CueEnds(M);var Ce=new y(M,oe,"");Ce.value=Se,L&&(Ce.type=L),this.id3Track.addCue(Ce)}}}}}}}},b.updateId3CueEnds=function(o){var l,g=(l=this.id3Track)===null||l===void 0?void 0:l.cues;if(g)for(var m=g.length;m--;){var p=g[m];p.startTime<o&&p.endTime===Et&&(p.endTime=o)}},b.onBufferFlushing=function(o,l){var g=l.startOffset,m=l.endOffset,p=l.type,h=this.id3Track,y=this.hls;if(y){var T=y.config,L=T.enableEmsgMetadataCues,A=T.enableID3MetadataCues;h&&(L||A)&&function(M,oe,fe,Se){var Ce=M.mode;if(Ce==="disabled"&&(M.mode="hidden"),M.cues&&M.cues.length>0)for(var Ie=function(nt,Ye,Je){var et=[],He=function(Ct,qt){if(qt<Ct[0].startTime)return 0;var or=Ct.length-1;if(qt>Ct[or].endTime)return-1;for(var Bt=0,Mt=or;Bt<=Mt;){var nr=Math.floor((Mt+Bt)/2);if(qt<Ct[nr].startTime)Mt=nr-1;else{if(!(qt>Ct[nr].startTime&&Bt<or))return nr;Bt=nr+1}}return Ct[Bt].startTime-qt<qt-Ct[Mt].startTime?Bt:Mt}(nt,Ye);if(He>-1)for(var at=He,Rt=nt.length;at<Rt;at++){var $t=nt[at];if($t.startTime>=Ye&&$t.endTime<=Je)et.push($t);else if($t.startTime>Je)return et}return et}(M.cues,oe,fe),ft=0;ft<Ie.length;ft++)Se&&!Se(Ie[ft])||M.removeCue(Ie[ft]);Ce==="disabled"&&(M.mode=Ce)}(h,g,m,p==="audio"?function(M){return M.type===Ze.MetadataSchema.audioId3&&A}:p==="video"?function(M){return M.type===Ze.MetadataSchema.emsg&&L}:function(M){return M.type===Ze.MetadataSchema.audioId3&&A||M.type===Ze.MetadataSchema.emsg&&L})}},b.onLevelUpdated=function(o,l){var g=this,m=l.details;if(this.media&&m.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var p=this.dateRangeCuesAppended,h=this.id3Track,y=m.dateRanges,T=Object.keys(y);if(h)for(var L=Object.keys(p).filter(function(ft){return!T.includes(ft)}),A=function(ft){var nt=L[ft];Object.keys(p[nt].cues).forEach(function(Ye){h.removeCue(p[nt].cues[Ye])}),delete p[nt]},M=L.length;M--;)A(M);var oe=m.fragments[m.fragments.length-1];if(T.length!==0&&(0,B.isFiniteNumber)(oe==null?void 0:oe.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var fe=oe.programDateTime/1e3-oe.start,Se=st(),Ce=function(ft){var nt=T[ft],Ye=y[nt],Je=p[nt],et=(Je==null?void 0:Je.cues)||{},He=(Je==null?void 0:Je.durationKnown)||!1,at=lt(Ye.startDate,fe),Rt=Et,$t=Ye.endDate;if($t)Rt=lt($t,fe),He=!0;else if(Ye.endOnNext&&!He){var Ct=T.reduce(function(br,Lr){var _r=y[Lr];return _r.class===Ye.class&&_r.id!==Lr&&_r.startDate>Ye.startDate&&br.push(_r),br},[]).sort(function(br,Lr){return br.startDate.getTime()-Lr.startDate.getTime()})[0];Ct&&(Rt=lt(Ct.startDate,fe),He=!0)}for(var qt,or=Object.keys(Ye.attr),Bt=0;Bt<or.length;Bt++){var Mt=or[Bt];if(Mt!==Ee.ID&&Mt!==Ee.CLASS&&Mt!==Ee.START_DATE&&Mt!==Ee.DURATION&&Mt!==Ee.END_DATE&&Mt!==Ee.END_ON_NEXT){var nr=et[Mt];if(nr)He&&!Je.durationKnown&&(nr.endTime=Rt);else{var pr=Ye.attr[Mt];nr=new Se(at,Rt,""),Mt!==Ee.SCTE35_OUT&&Mt!==Ee.SCTE35_IN||(qt=pr,pr=Uint8Array.from(qt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),nr.value={key:Mt,data:pr},nr.type=Ze.MetadataSchema.dateRange,g.id3Track.addCue(nr),et[Mt]=nr}}}p[nt]={cues:et,dateRange:Ye,durationKnown:He}},Ie=0;Ie<T.length;Ie++)Ce(Ie)}}},w}();function St(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}var gt,At=function(){function w(g){var m=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return m.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var b,o,l=w.prototype;return l.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},l.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.Events.ERROR,this.onError)},l.onMediaAttached=function(g,m){this.media=m.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},l.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},l.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},l.onLevelUpdated=function(g,m){var p=m.details;this.levelDetails=p,p.advanced&&this.timeupdate(),!p.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},l.onError=function(g,m){m.details===P.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,_.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},l.timeupdate=function(){var g=this.media,m=this.levelDetails;if(g&&m){this.currentTime=g.currentTime;var p=this.computeLatency();if(p!==null){this._latency=p;var h=this.config,y=h.lowLatencyMode,T=h.maxLiveSyncPlaybackRate;if(y&&T!==1){var L=this.targetLatency;if(L!==null){var A=p-L,M=A<Math.min(this.maxLatency,L+m.targetduration);if(m.live&&M&&A>.05&&this.forwardBufferLength>1){var oe=Math.min(2,Math.max(1,T)),fe=Math.round(2/(1+Math.exp(-.75*A-this.edgeStalled))*20)/20;g.playbackRate=Math.min(oe,Math.max(1,fe))}else g.playbackRate!==1&&g.playbackRate!==0&&(g.playbackRate=1)}}}}},l.estimateLiveEdge=function(){var g=this.levelDetails;return g===null?null:g.edge+g.age},l.computeLatency=function(){var g=this.estimateLiveEdge();return g===null?null:g-this.currentTime},b=w,(o=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var g=this.config,m=this.levelDetails;return g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:m?g.liveMaxLatencyDurationCount*m.targetduration:0}},{key:"targetLatency",get:function(){var g=this.levelDetails;if(g===null)return null;var m=g.holdBack,p=g.partHoldBack,h=g.targetduration,y=this.config,T=y.liveSyncDuration,L=y.liveSyncDurationCount,A=y.lowLatencyMode,M=this.hls.userConfig,oe=A&&p||m;(M.liveSyncDuration||M.liveSyncDurationCount||oe===0)&&(oe=T!==void 0?T:L*h);var fe=h;return oe+Math.min(1*this.stallCount,fe)}},{key:"liveSyncPosition",get:function(){var g=this.estimateLiveEdge(),m=this.targetLatency,p=this.levelDetails;if(g===null||m===null||p===null)return null;var h=p.edge,y=g-m-this.edgeStalled,T=h-p.totalduration,L=h-(this.config.lowLatencyMode&&p.partTarget||p.targetduration);return Math.min(Math.max(T,y),L)}},{key:"drift",get:function(){var g=this.levelDetails;return g===null?1:g.drift}},{key:"edgeStalled",get:function(){var g=this.levelDetails;if(g===null)return 0;var m=3*(this.config.lowLatencyMode&&g.partTarget||g.targetduration);return Math.max(g.age-m,0)}},{key:"forwardBufferLength",get:function(){var g=this.media,m=this.levelDetails;if(!g||!m)return 0;var p=g.buffered.length;return(p?g.buffered.end(p-1):m.edge)-this.currentTime}}])&&St(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}();function Lt(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}(function(w){w.No="",w.Yes="YES",w.v2="v2"})(gt||(gt={}));var yt=function(){function w(b,o,l){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=b,this.part=o,this.skip=l}return w.prototype.addDirectives=function(b){var o=new self.URL(b);return this.msn!==void 0&&o.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&o.searchParams.set("_HLS_part",this.part.toString()),this.skip&&o.searchParams.set("_HLS_skip",this.skip),o.toString()},w}(),Ot=function(){function w(l){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[l.url],this.attrs=l.attrs,this.bitrate=l.bitrate,l.details&&(this.details=l.details),this.id=l.id||0,this.name=l.name,this.width=l.width||0,this.height=l.height||0,this.audioCodec=l.audioCodec,this.videoCodec=l.videoCodec,this.unknownCodecs=l.unknownCodecs,this.codecSet=[l.videoCodec,l.audioCodec].filter(function(g){return g}).join(",").replace(/\.[^.,]+/g,"")}var b,o;return b=w,(o=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(l){var g=l%this.url.length;this._urlId!==g&&(this.details=void 0,this._urlId=g)}}])&&Lt(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}();function _t(){return _t=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(w[l]=o[l])}return w},_t.apply(this,arguments)}function Jt(w,b,o){switch(b){case"audio":w.audioGroupIds||(w.audioGroupIds=[]),w.audioGroupIds.push(o);break;case"text":w.textGroupIds||(w.textGroupIds=[]),w.textGroupIds.push(o)}}function Gt(w){var b={};w.forEach(function(o){var l=o.groupId||"";o.id=b[l]=b[l]||0,b[l]++})}function wt(w,b){var o=b.startPTS;if((0,B.isFiniteNumber)(o)){var l,g=0;b.sn>w.sn?(g=o-w.start,l=w):(g=w.start-o,l=b),l.duration!==g&&(l.duration=g)}else b.sn>w.sn?w.cc===b.cc&&w.minEndPTS?b.start=w.start+(w.minEndPTS-w.start):b.start=w.start+w.duration:b.start=Math.max(w.start-b.duration,0)}function tr(w,b,o,l,g,m){l-o<=0&&(_.logger.warn("Fragment should have a positive duration",b),l=o+b.duration,m=g+b.duration);var p=o,h=l,y=b.startPTS,T=b.endPTS;if((0,B.isFiniteNumber)(y)){var L=Math.abs(y-o);(0,B.isFiniteNumber)(b.deltaPTS)?b.deltaPTS=Math.max(L,b.deltaPTS):b.deltaPTS=L,p=Math.max(o,y),o=Math.min(o,y),g=Math.min(g,b.startDTS),h=Math.min(l,T),l=Math.max(l,T),m=Math.max(m,b.endDTS)}b.duration=l-o;var A=o-b.start;b.appendedPTS=l,b.start=b.startPTS=o,b.maxStartPTS=p,b.startDTS=g,b.endPTS=l,b.minEndPTS=h,b.endDTS=m;var M,oe=b.sn;if(!w||oe<w.startSN||oe>w.endSN)return 0;var fe=oe-w.startSN,Se=w.fragments;for(Se[fe]=b,M=fe;M>0;M--)wt(Se[M],Se[M-1]);for(M=fe;M<Se.length-1;M++)wt(Se[M],Se[M+1]);return w.fragmentHint&&wt(Se[Se.length-1],w.fragmentHint),w.PTSKnown=w.alignedSliding=!0,A}function Zt(w,b){var o=b.startSN+b.skippedSegments-w.startSN,l=w.fragments;o<0||o>=l.length||function(g,m){if(m){for(var p=g.fragments,h=g.skippedSegments;h<p.length;h++)p[h].start+=m;g.fragmentHint&&(g.fragmentHint.start+=m)}}(b,l[o].start)}var rr=function(){function w(o,l){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,l+":"),this.warn=_.logger.warn.bind(_.logger,l+":"),this.hls=o}var b=w.prototype;return b.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},b.onError=function(o,l){l.fatal&&l.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},b.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},b.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},b.stopLoad=function(){this.canLoad=!1,this.clearTimer()},b.switchParams=function(o,l){var g=l==null?void 0:l.renditionReports;if(g)for(var m=0;m<g.length;m++){var p=g[m],h=""+p.URI;if(h===o.slice(-h.length)){var y=parseInt(p["LAST-MSN"]),T=parseInt(p["LAST-PART"]);if(l&&this.hls.config.lowLatencyMode){var L=Math.min(l.age-l.partTarget,l.targetduration);T!==void 0&&L>l.partTarget&&(T+=1)}if((0,B.isFiniteNumber)(y))return new yt(y,(0,B.isFiniteNumber)(T)?T:void 0,gt.No)}}},b.loadPlaylist=function(o){},b.shouldLoadTrack=function(o){return this.canLoad&&o&&!!o.url&&(!o.details||o.details.live)},b.playlistLoaded=function(o,l,g){var m=this,p=l.details,h=l.stats,y=h.loading.end?Math.max(0,self.performance.now()-h.loading.end):0;if(p.advancedDateTime=Date.now()-y,p.live||g!=null&&g.live){if(p.reloaded(g),g&&this.log("live playlist "+o+" "+(p.advanced?"REFRESHED "+p.lastPartSn+"-"+p.lastPartIndex:"MISSED")),g&&p.fragments.length>0&&function(et,He){for(var at=null,Rt=et.fragments,$t=Rt.length-1;$t>=0;$t--){var Ct=Rt[$t].initSegment;if(Ct){at=Ct;break}}et.fragmentHint&&delete et.fragmentHint.endPTS;var qt,or,Bt,Mt,nr,pr=0;if(function(It,Nt,oi){for(var Hr=Nt.skippedSegments,Fr=Math.max(It.startSN,Nt.startSN)-Nt.startSN,li=(It.fragmentHint?1:0)+(Hr?Nt.endSN:Math.min(It.endSN,Nt.endSN))-Nt.startSN,Mr=Nt.startSN-It.startSN,Vr=Nt.fragmentHint?Nt.fragments.concat(Nt.fragmentHint):Nt.fragments,ui=It.fragmentHint?It.fragments.concat(It.fragmentHint):It.fragments,Ur=Fr;Ur<=li;Ur++){var Ai=ui[Mr+Ur],Ti=Vr[Ur];Hr&&!Ti&&Ur<Hr&&(Ti=Nt.fragments[Ur]=Ai),Ai&&Ti&&oi(Ai,Ti)}}(et,He,function(It,Nt){It.relurl&&(pr=It.cc-Nt.cc),(0,B.isFiniteNumber)(It.startPTS)&&(0,B.isFiniteNumber)(It.endPTS)&&(Nt.start=Nt.startPTS=It.startPTS,Nt.startDTS=It.startDTS,Nt.appendedPTS=It.appendedPTS,Nt.maxStartPTS=It.maxStartPTS,Nt.endPTS=It.endPTS,Nt.endDTS=It.endDTS,Nt.minEndPTS=It.minEndPTS,Nt.duration=It.endPTS-It.startPTS,Nt.duration&&(qt=Nt),He.PTSKnown=He.alignedSliding=!0),Nt.elementaryStreams=It.elementaryStreams,Nt.loader=It.loader,Nt.stats=It.stats,Nt.urlId=It.urlId,It.initSegment&&(Nt.initSegment=It.initSegment,at=It.initSegment)}),at&&(He.fragmentHint?He.fragments.concat(He.fragmentHint):He.fragments).forEach(function(It){var Nt;It.initSegment&&It.initSegment.relurl!==((Nt=at)===null||Nt===void 0?void 0:Nt.relurl)||(It.initSegment=at)}),He.skippedSegments)if(He.deltaUpdateFailed=He.fragments.some(function(It){return!It}),He.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var br=He.skippedSegments;br--;)He.fragments.shift();He.startSN=He.fragments[0].sn,He.startCC=He.fragments[0].cc}else He.canSkipDateRanges&&(He.dateRanges=(or=et.dateRanges,Bt=He.dateRanges,Mt=He.recentlyRemovedDateranges,nr=_t({},or),Mt&&Mt.forEach(function(It){delete nr[It]}),Object.keys(Bt).forEach(function(It){var Nt=new Q(Bt[It].attr,nr[It]);Nt.isValid?nr[It]=Nt:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Bt[It].attr)+'"')}),nr));var Lr=He.fragments;if(pr){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var _r=0;_r<Lr.length;_r++)Lr[_r].cc+=pr}He.skippedSegments&&(He.startCC=He.fragments[0].cc),function(It,Nt,oi){if(It&&Nt)for(var Hr=0,Fr=0,li=It.length;Fr<=li;Fr++){var Mr=It[Fr],Vr=Nt[Fr+Hr];Mr&&Vr&&Mr.index===Vr.index&&Mr.fragment.sn===Vr.fragment.sn?(ui=Mr,(Ur=Vr).elementaryStreams=ui.elementaryStreams,Ur.stats=ui.stats):Hr--}var ui,Ur}(et.partList,He.partList),qt?tr(He,qt,qt.startPTS,qt.endPTS,qt.startDTS,qt.endDTS):Zt(et,He),Lr.length&&(He.totalduration=He.edge-Lr[0].start),He.driftStartTime=et.driftStartTime,He.driftStart=et.driftStart;var si=He.advancedDateTime;if(He.advanced&&si){var Ei=He.edge;He.driftStart||(He.driftStartTime=si,He.driftStart=Ei),He.driftEndTime=si,He.driftEnd=Ei}else He.driftEndTime=et.driftEndTime,He.driftEnd=et.driftEnd,He.advancedDateTime=et.advancedDateTime}(g,p),!this.canLoad||!p.live)return;var T,L=void 0,A=void 0;if(p.canBlockReload&&p.endSN&&p.advanced){var M=this.hls.config.lowLatencyMode,oe=p.lastPartSn,fe=p.endSN,Se=p.lastPartIndex,Ce=oe===fe;Se!==-1?(L=Ce?fe+1:oe,A=Ce?M?0:Se:Se+1):L=fe+1;var Ie=p.age,ft=Ie+p.ageHeader,nt=Math.min(ft-p.partTarget,1.5*p.targetduration);if(nt>0){if(g&&nt>g.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+g.tuneInGoal+" to: "+nt+" with playlist age: "+p.age),nt=0;else{var Ye=Math.floor(nt/p.targetduration);L+=Ye,A!==void 0&&(A+=Math.round(nt%p.targetduration/p.partTarget)),this.log("CDN Tune-in age: "+p.ageHeader+"s last advanced "+Ie.toFixed(2)+"s goal: "+nt+" skip sn "+Ye+" to part "+A)}p.tuneInGoal=nt}if(T=this.getDeliveryDirectives(p,l.deliveryDirectives,L,A),M||!Ce)return void this.loadPlaylist(T)}else T=this.getDeliveryDirectives(p,l.deliveryDirectives,L,A);var Je=function(et,He){var at,Rt=1e3*et.levelTargetDuration,$t=Rt/2,Ct=et.age,qt=Ct>0&&Ct<3*Rt,or=He.loading.end-He.loading.start,Bt=et.availabilityDelay;if(et.updated===!1)if(qt){var Mt=333*et.misses;at=Math.max(Math.min($t,2*or),Mt),et.availabilityDelay=(et.availabilityDelay||0)+at}else at=$t;else qt?(Bt=Math.min(Bt||Rt/2,Ct),et.availabilityDelay=Bt,at=Bt+Rt-Ct):at=Rt-or;return Math.round(at)}(p,h);L!==void 0&&p.canBlockReload&&(Je-=p.partTarget||1),this.log("reload live playlist "+o+" in "+Math.round(Je)+" ms"),this.timer=self.setTimeout(function(){return m.loadPlaylist(T)},Je)}else this.clearTimer()},b.getDeliveryDirectives=function(o,l,g,m){var p=function(h,y){var T=h.canSkipUntil,L=h.canSkipDateRanges,A=h.endSN;return T&&(y!==void 0?y-A:0)<T?L?gt.v2:gt.Yes:gt.No}(o,g);return l!=null&&l.skip&&o.deltaUpdateFailed&&(g=l.msn,m=l.part,p=gt.No),new yt(g,m,p)},b.retryLoadingOrFail=function(o){var l,g=this,m=this.hls.config,p=this.retryCount<m.levelLoadingMaxRetry;if(p)if(this.retryCount++,o.details.indexOf("LoadTimeOut")>-1&&(l=o.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+o.details+'"'),this.loadPlaylist();else{var h=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return g.loadPlaylist()},h),this.warn("retry playlist loading #"+this.retryCount+" in "+h+' ms after "'+o.details+'"')}else this.warn('cannot recover from error "'+o.details+'"'),this.clearTimer(),o.fatal=!0;return p},w}();function lr(){return lr=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(w[l]=o[l])}return w},lr.apply(this,arguments)}function ur(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}function hr(w,b){return hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},hr(w,b)}var Xt,sr=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),ye=function(w){var b,o;function l(h){var y;return(y=w.call(this,h,"[level-controller]")||this)._levels=[],y._firstLevel=-1,y._startLevel=void 0,y.currentLevelIndex=-1,y.manualLevelIndex=-1,y.onParsedComplete=void 0,y._registerListeners(),y}o=w,(b=l).prototype=Object.create(o.prototype),b.prototype.constructor=b,hr(b,o);var g,m,p=l.prototype;return p._registerListeners=function(){var h=this.hls;h.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(c.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var h=this.hls;h.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),h.off(c.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,w.prototype.destroy.call(this)},p.startLoad=function(){this._levels.forEach(function(h){h.loadError=0}),w.prototype.startLoad.call(this)},p.onManifestLoaded=function(h,y){var T,L,A=[],M=[],oe=[],fe={},Se=!1,Ce=!1,Ie=!1;if(y.levels.forEach(function(Je){var et=Je.attrs;Se=Se||!(!Je.width||!Je.height),Ce=Ce||!!Je.videoCodec,Ie=Ie||!!Je.audioCodec,sr&&Je.audioCodec&&Je.audioCodec.indexOf("mp4a.40.34")!==-1&&(Je.audioCodec=void 0);var He=Je.bitrate+"-"+Je.attrs.RESOLUTION+"-"+Je.attrs.CODECS;(L=fe[He])?L.url.push(Je.url):(L=new Ot(Je),fe[He]=L,A.push(L)),et&&(et.AUDIO&&Jt(L,"audio",et.AUDIO),et.SUBTITLES&&Jt(L,"text",et.SUBTITLES))}),(Se||Ce)&&Ie&&(A=A.filter(function(Je){var et=Je.videoCodec,He=Je.width,at=Je.height;return!!et||!(!He||!at)})),A=A.filter(function(Je){var et=Je.audioCodec,He=Je.videoCodec;return(!et||F(et,"audio"))&&(!He||F(He,"video"))}),y.audioTracks&&Gt(M=y.audioTracks.filter(function(Je){return!Je.audioCodec||F(Je.audioCodec,"audio")})),y.subtitles&&Gt(oe=y.subtitles),A.length>0){T=A[0].bitrate,A.sort(function(Je,et){return Je.bitrate-et.bitrate}),this._levels=A;for(var ft=0;ft<A.length;ft++)if(A[ft].bitrate===T){this._firstLevel=ft,this.log("manifest loaded, "+A.length+" level(s) found, first bitrate: "+T);break}var nt=Ie&&!Ce,Ye={levels:A,audioTracks:M,subtitleTracks:oe,firstLevel:this._firstLevel,stats:y.stats,audio:Ie,video:Ce,altAudio:!nt&&M.some(function(Je){return!!Je.url})};this.hls.trigger(c.Events.MANIFEST_PARSED,Ye),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:y.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(h,y){var T;if(w.prototype.onError.call(this,h,y),!y.fatal){var L=y.context,A=this._levels[this.currentLevelIndex];if(L&&(L.type===G.PlaylistContextType.AUDIO_TRACK&&A.audioGroupIds&&L.groupId===A.audioGroupIds[A.urlId]||L.type===G.PlaylistContextType.SUBTITLE_TRACK&&A.textGroupIds&&L.groupId===A.textGroupIds[A.urlId]))this.redundantFailover(this.currentLevelIndex);else{var M,oe=!1,fe=!0;switch(y.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:if(y.frag){var Se=y.frag.type===G.PlaylistLevelType.MAIN?y.frag.level:this.currentLevelIndex,Ce=this._levels[Se];Ce?(Ce.fragmentError++,Ce.fragmentError>this.hls.config.fragLoadingMaxRetry&&(M=Se)):M=Se}break;case P.ErrorDetails.LEVEL_LOAD_ERROR:case P.ErrorDetails.LEVEL_LOAD_TIMEOUT:L&&(L.deliveryDirectives&&(fe=!1),M=L.level),oe=!0;break;case P.ErrorDetails.REMUX_ALLOC_ERROR:M=(T=y.level)!=null?T:this.currentLevelIndex,oe=!0}M!==void 0&&this.recoverLevel(y,M,oe,fe)}}},p.recoverLevel=function(h,y,T,L){var A=h.details,M=this._levels[y];if(M.loadError++,T){if(!this.retryLoadingOrFail(h))return void(this.currentLevelIndex=-1);h.levelRetry=!0}if(L){var oe=M.url.length;if(oe>1&&M.loadError<oe)h.levelRetry=!0,this.redundantFailover(y);else if(this.manualLevelIndex===-1){for(var fe=-1,Se=this._levels,Ce=Se.length;Ce--;){var Ie=(Ce+this.currentLevelIndex)%Se.length;if(Ie!==this.currentLevelIndex&&Se[Ie].loadError===0){fe=Ie;break}}fe>-1&&this.currentLevelIndex!==fe&&(this.warn(A+": switch to "+fe),h.levelRetry=!0,this.hls.nextAutoLevel=fe)}}},p.redundantFailover=function(h){var y=this._levels[h],T=y.url.length;if(T>1){var L=(y.urlId+1)%T;this.warn("Switching to redundant URL-id "+L),this._levels.forEach(function(A){A.urlId=L}),this.level=h}},p.onFragLoaded=function(h,y){var T=y.frag;if(T!==void 0&&T.type===G.PlaylistLevelType.MAIN){var L=this._levels[T.level];L!==void 0&&(L.fragmentError=0,L.loadError=0)}},p.onLevelLoaded=function(h,y){var T,L,A=y.level,M=y.details,oe=this._levels[A];if(!oe)return this.warn("Invalid level index "+A),void((L=y.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(M.deltaUpdateFailed=!0));A===this.currentLevelIndex?(oe.fragmentError===0&&(oe.loadError=0,this.retryCount=0),this.playlistLoaded(A,y,oe.details)):(T=y.deliveryDirectives)!==null&&T!==void 0&&T.skip&&(M.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(h,y){var T=this.hls.levels[this.currentLevelIndex];if(T&&T.audioGroupIds){for(var L=-1,A=this.hls.audioTracks[y.id].groupId,M=0;M<T.audioGroupIds.length;M++)if(T.audioGroupIds[M]===A){L=M;break}L!==T.urlId&&(T.urlId=L,this.startLoad())}},p.loadPlaylist=function(h){var y=this.currentLevelIndex,T=this._levels[y];if(this.canLoad&&T&&T.url.length>0){var L=T.urlId,A=T.url[L];if(h)try{A=h.addDirectives(A)}catch(M){this.warn("Could not construct new URL with HLS Delivery Directives: "+M)}this.log("Attempt loading level index "+y+(h?" at sn "+h.msn+" part "+h.part:"")+" with URL-id "+L+" "+A),this.clearTimer(),this.hls.trigger(c.Events.LEVEL_LOADING,{url:A,level:y,id:L,deliveryDirectives:h||null})}},p.removeLevel=function(h,y){var T=function(A,M){return M!==y},L=this._levels.filter(function(A,M){return M!==h||A.url.length>1&&y!==void 0&&(A.url=A.url.filter(T),A.audioGroupIds&&(A.audioGroupIds=A.audioGroupIds.filter(T)),A.textGroupIds&&(A.textGroupIds=A.textGroupIds.filter(T)),A.urlId=0,!0)}).map(function(A,M){var oe=A.details;return oe!=null&&oe.fragments&&oe.fragments.forEach(function(fe){fe.level=M}),A});this._levels=L,this.hls.trigger(c.Events.LEVELS_UPDATED,{levels:L})},g=l,(m=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(h){var y,T=this._levels;if(T.length!==0&&(this.currentLevelIndex!==h||(y=T[h])===null||y===void 0||!y.details)){if(h<0||h>=T.length){var L=h<0;if(this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.LEVEL_SWITCH_ERROR,level:h,fatal:L,reason:"invalid level idx"}),L)return;h=Math.min(h,T.length-1)}this.clearTimer();var A=this.currentLevelIndex,M=T[A],oe=T[h];this.log("switching to level "+h+" from "+A),this.currentLevelIndex=h;var fe=lr({},oe,{level:h,maxBitrate:oe.maxBitrate,uri:oe.uri,urlId:oe.urlId});delete fe._urlId,this.hls.trigger(c.Events.LEVEL_SWITCHING,fe);var Se=oe.details;if(!Se||Se.live){var Ce=this.switchParams(oe.uri,M==null?void 0:M.details);this.loadPlaylist(Ce)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(h){this.manualLevelIndex=h,this._startLevel===void 0&&(this._startLevel=h),h!==-1&&(this.level=h)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(h){this._firstLevel=h}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var h=this.hls.config.startLevel;return h!==void 0?h:this._firstLevel}return this._startLevel},set:function(h){this._startLevel=h}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(h){this.level=h,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=h)}}])&&ur(g.prototype,m),Object.defineProperty(g,"prototype",{writable:!1}),l}(rr);(function(w){w.NOT_LOADED="NOT_LOADED",w.APPENDING="APPENDING",w.PARTIAL="PARTIAL",w.OK="OK"})(Xt||(Xt={}));var ae=function(){function w(o){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=o,this._registerListeners()}var b=w.prototype;return b._registerListeners=function(){var o=this.hls;o.on(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),o.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.on(c.Events.FRAG_LOADED,this.onFragLoaded,this)},b._unregisterListeners=function(){var o=this.hls;o.off(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),o.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.off(c.Events.FRAG_LOADED,this.onFragLoaded,this)},b.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},b.getAppendedFrag=function(o,l){if(l===G.PlaylistLevelType.MAIN){var g=this.activeFragment,m=this.activeParts;if(!g)return null;if(m)for(var p=m.length;p--;){var h=m[p],y=h?h.end:g.appendedPTS;if(h.start<=o&&y!==void 0&&o<=y)return p>9&&(this.activeParts=m.slice(p-9)),h}else if(g.start<=o&&g.appendedPTS!==void 0&&o<=g.appendedPTS)return g}return this.getBufferedFrag(o,l)},b.getBufferedFrag=function(o,l){for(var g=this.fragments,m=Object.keys(g),p=m.length;p--;){var h=g[m[p]];if((h==null?void 0:h.body.type)===l&&h.buffered){var y=h.body;if(y.start<=o&&o<=y.end)return y}}return null},b.detectEvictedFragments=function(o,l,g){var m=this;Object.keys(this.fragments).forEach(function(p){var h=m.fragments[p];if(h)if(h.buffered){var y=h.range[o];y&&y.time.some(function(T){var L=!m.isTimeBuffered(T.startPTS,T.endPTS,l);return L&&m.removeFragment(h.body),L})}else h.body.type===g&&m.removeFragment(h.body)})},b.detectPartialFragments=function(o){var l=this,g=this.timeRanges,m=o.frag,p=o.part;if(g&&m.sn!=="initSegment"){var h=ee(m),y=this.fragments[h];y&&(Object.keys(g).forEach(function(T){var L=m.elementaryStreams[T];if(L){var A=g[T],M=p!==null||L.partial===!0;y.range[T]=l.getBufferedTimes(m,p,M,A)}}),y.loaded=null,Object.keys(y.range).length?y.buffered=!0:this.removeFragment(y.body))}},b.fragBuffered=function(o){var l=ee(o),g=this.fragments[l];g&&(g.loaded=null,g.buffered=!0)},b.getBufferedTimes=function(o,l,g,m){for(var p={time:[],partial:g},h=l?l.start:o.start,y=l?l.end:o.end,T=o.minEndPTS||y,L=o.maxStartPTS||h,A=0;A<m.length;A++){var M=m.start(A)-this.bufferPadding,oe=m.end(A)+this.bufferPadding;if(L>=M&&T<=oe){p.time.push({startPTS:Math.max(h,m.start(A)),endPTS:Math.min(y,m.end(A))});break}if(h<oe&&y>M)p.partial=!0,p.time.push({startPTS:Math.max(h,m.start(A)),endPTS:Math.min(y,m.end(A))});else if(y<=M)break}return p},b.getPartialFragment=function(o){var l,g,m,p=null,h=0,y=this.bufferPadding,T=this.fragments;return Object.keys(T).forEach(function(L){var A=T[L];A&&x(A)&&(g=A.body.start-y,m=A.body.end+y,o>=g&&o<=m&&(l=Math.min(o-g,m-o),h<=l&&(p=A.body,h=l)))}),p},b.getState=function(o){var l=ee(o),g=this.fragments[l];return g?g.buffered?x(g)?Xt.PARTIAL:Xt.OK:Xt.APPENDING:Xt.NOT_LOADED},b.isTimeBuffered=function(o,l,g){for(var m,p,h=0;h<g.length;h++){if(m=g.start(h)-this.bufferPadding,p=g.end(h)+this.bufferPadding,o>=m&&l<=p)return!0;if(l<=m)return!1}return!1},b.onFragLoaded=function(o,l){var g=l.frag,m=l.part;if(g.sn!=="initSegment"&&!g.bitrateTest&&!m){var p=ee(g);this.fragments[p]={body:g,loaded:l,buffered:!1,range:Object.create(null)}}},b.onBufferAppended=function(o,l){var g=this,m=l.frag,p=l.part,h=l.timeRanges;if(m.type===G.PlaylistLevelType.MAIN)if(this.activeFragment=m,p){var y=this.activeParts;y||(this.activeParts=y=[]),y.push(p)}else this.activeParts=null;this.timeRanges=h,Object.keys(h).forEach(function(T){var L=h[T];if(g.detectEvictedFragments(T,L),!p)for(var A=0;A<L.length;A++)m.appendedPTS=Math.max(L.end(A),m.appendedPTS||0)})},b.onFragBuffered=function(o,l){this.detectPartialFragments(l)},b.hasFragment=function(o){var l=ee(o);return!!this.fragments[l]},b.removeFragmentsInRange=function(o,l,g){var m=this;Object.keys(this.fragments).forEach(function(p){var h=m.fragments[p];if(h&&h.buffered){var y=h.body;y.type===g&&y.start<l&&y.end>o&&m.removeFragment(y)}})},b.removeFragment=function(o){var l=ee(o);o.stats.loaded=0,o.clearElementaryStreamInfo(),delete this.fragments[l]},b.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},w}();function x(w){var b,o;return w.buffered&&(((b=w.range.video)===null||b===void 0?void 0:b.partial)||((o=w.range.audio)===null||o===void 0?void 0:o.partial))}function ee(w){return w.type+"_"+w.level+"_"+w.urlId+"_"+w.sn}var $=function(){function w(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=w.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(o){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,o),!0)},b.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},w}(),ce={length:0,start:function(){return 0},end:function(){return 0}},ve=function(){function w(){}return w.isBuffered=function(b,o){try{if(b){for(var l=w.getBuffered(b),g=0;g<l.length;g++)if(o>=l.start(g)&&o<=l.end(g))return!0}}catch(m){}return!1},w.bufferInfo=function(b,o,l){try{if(b){var g,m=w.getBuffered(b),p=[];for(g=0;g<m.length;g++)p.push({start:m.start(g),end:m.end(g)});return this.bufferedInfo(p,o,l)}}catch(h){}return{len:0,start:o,end:o,nextStart:void 0}},w.bufferedInfo=function(b,o,l){o=Math.max(0,o),b.sort(function(Se,Ce){return Se.start-Ce.start||Ce.end-Se.end});var g=[];if(l)for(var m=0;m<b.length;m++){var p=g.length;if(p){var h=g[p-1].end;b[m].start-h<l?b[m].end>h&&(g[p-1].end=b[m].end):g.push(b[m])}else g.push(b[m])}else g=b;for(var y,T=0,L=o,A=o,M=0;M<g.length;M++){var oe=g[M].start,fe=g[M].end;if(o+l>=oe&&o<fe)L=oe,T=(A=fe)-o;else if(o+l<oe){y=oe;break}}return{len:T,start:L||0,end:A||0,nextStart:y}},w.getBuffered=function(b){try{return b.buffered}catch(o){return _.logger.log("failed to get media.buffered",o),ce}},w}(),Le=function(w,b,o,l,g,m){l===void 0&&(l=0),g===void 0&&(g=-1),m===void 0&&(m=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=w,this.sn=b,this.id=o,this.size=l,this.part=g,this.partial=m};function Ne(w,b){if(w){var o=w.start+b;w.start=w.startPTS=o,w.endPTS=o+w.duration}}function ze(w,b){for(var o=b.fragments,l=0,g=o.length;l<g;l++)Ne(o[l],w);b.fragmentHint&&Ne(b.fragmentHint,w),b.alignedSliding=!0}const Be=function(w,b){for(var o=0,l=w.length-1,g=null,m=null;o<=l;){var p=b(m=w[g=(o+l)/2|0]);if(p>0)o=g+1;else{if(!(p<0))return m;l=g-1}}return null};function rt(w,b,o){w===void 0&&(w=0),b===void 0&&(b=0);var l=Math.min(b,o.duration+(o.deltaPTS?o.deltaPTS:0));return o.start+o.duration-l<=w?1:o.start-l>w&&o.start?-1:0}function pt(w,b,o){var l=1e3*Math.min(b,o.duration+(o.deltaPTS?o.deltaPTS:0));return(o.endProgramDateTime||0)-l>w}function ct(w){var b=typeof Map=="function"?new Map:void 0;return ct=function(o){if(o===null||(l=o,Function.toString.call(l).indexOf("[native code]")===-1))return o;var l;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(b!==void 0){if(b.has(o))return b.get(o);b.set(o,g)}function g(){return R(o,arguments,C(this).constructor)}return g.prototype=Object.create(o.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),S(g,o)},ct(w)}function R(w,b,o){return R=I()?Reflect.construct.bind():function(l,g,m){var p=[null];p.push.apply(p,g);var h=new(Function.bind.apply(l,p));return m&&S(h,m.prototype),h},R.apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(w){return!1}}function S(w,b){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},S(w,b)}function C(w){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(b){return b.__proto__||Object.getPrototypeOf(b)},C(w)}var O=Math.pow(2,17),Y=function(){function w(o){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=o}var b=w.prototype;return b.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},b.abort=function(){this.loader&&this.loader.abort()},b.load=function(o,l){var g=this,m=o.url;if(!m)return Promise.reject(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,networkDetails:null},"Fragment does not have a "+(m?"part list":"url")));this.abort();var p=this.config,h=p.fLoader,y=p.loader;return new Promise(function(T,L){g.loader&&g.loader.destroy();var A=g.loader=o.loader=h?new h(p):new y(p),M=j(o),oe={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:o.sn==="initSegment"?1/0:O};o.stats=A.stats,A.load(M,oe,{onSuccess:function(fe,Se,Ce,Ie){g.resetLoader(o,A),T({frag:o,part:null,payload:fe.data,networkDetails:Ie})},onError:function(fe,Se,Ce){g.resetLoader(o,A),L(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,response:fe,networkDetails:Ce}))},onAbort:function(fe,Se,Ce){g.resetLoader(o,A),L(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:o,networkDetails:Ce}))},onTimeout:function(fe,Se,Ce){g.resetLoader(o,A),L(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,networkDetails:Ce}))},onProgress:function(fe,Se,Ce,Ie){l&&l({frag:o,part:null,payload:Ce,networkDetails:Ie})}})})},b.loadPart=function(o,l,g){var m=this;this.abort();var p=this.config,h=p.fLoader,y=p.loader;return new Promise(function(T,L){m.loader&&m.loader.destroy();var A=m.loader=o.loader=h?new h(p):new y(p),M=j(o,l),oe={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:O};l.stats=A.stats,A.load(M,oe,{onSuccess:function(fe,Se,Ce,Ie){m.resetLoader(o,A),m.updateStatsFromPart(o,l);var ft={frag:o,part:l,payload:fe.data,networkDetails:Ie};g(ft),T(ft)},onError:function(fe,Se,Ce){m.resetLoader(o,A),L(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,part:l,response:fe,networkDetails:Ce}))},onAbort:function(fe,Se,Ce){o.stats.aborted=l.stats.aborted,m.resetLoader(o,A),L(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:o,part:l,networkDetails:Ce}))},onTimeout:function(fe,Se,Ce){m.resetLoader(o,A),L(new J({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,part:l,networkDetails:Ce}))}})})},b.updateStatsFromPart=function(o,l){var g=o.stats,m=l.stats,p=m.total;if(g.loaded+=m.loaded,p){var h=Math.round(o.duration/l.duration),y=Math.min(Math.round(g.loaded/p),h),T=(h-y)*Math.round(g.loaded/y);g.total=g.loaded+T}else g.total=Math.max(g.loaded,g.total);var L=g.loading,A=m.loading;L.start?L.first+=A.first-A.start:(L.start=A.start,L.first=A.first),L.end=A.end},b.resetLoader=function(o,l){o.loader=null,this.loader===l&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),l.destroy()},w}();function j(w,b){b===void 0&&(b=null);var o=b||w,l={frag:w,part:b,responseType:"arraybuffer",url:o.url,headers:{},rangeStart:0,rangeEnd:0},g=o.byteRangeStartOffset,m=o.byteRangeEndOffset;return(0,B.isFiniteNumber)(g)&&(0,B.isFiniteNumber)(m)&&(l.rangeStart=g,l.rangeEnd=m),l}var J=function(w){var b,o;function l(g){for(var m,p=arguments.length,h=new Array(p>1?p-1:0),y=1;y<p;y++)h[y-1]=arguments[y];return(m=w.call.apply(w,[this].concat(h))||this).data=void 0,m.data=g,m}return o=w,(b=l).prototype=Object.create(o.prototype),b.prototype.constructor=b,S(b,o),l}(ct(Error)),De=X(21);const pe=function(w){for(var b="",o=w.length,l=0;l<o;l++)b+="["+w.start(l).toFixed(3)+","+w.end(l).toFixed(3)+"]";return b};function ke(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}function Fe(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function Qe(w,b){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},Qe(w,b)}var $e="STOPPED",je="IDLE",ot="KEY_LOADING",Tt="FRAG_LOADING",dt="FRAG_LOADING_WAITING_RETRY",Ft="PARSING",Qt="PARSED",Pt="ENDED",mt="ERROR",Vt="WAITING_LEVEL",bt=function(w){var b,o;function l(h,y,T){var L;return(L=w.call(this)||this).hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=$e,L.media=null,L.mediaBuffer=null,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=T,L.log=_.logger.log.bind(_.logger,T+":"),L.warn=_.logger.warn.bind(_.logger,T+":"),L.hls=h,L.fragmentLoader=new Y(h.config),L.fragmentTracker=y,L.config=h.config,L.decrypter=new De.default(h,h.config),h.on(c.Events.KEY_LOADED,L.onKeyLoaded,Fe(L)),h.on(c.Events.LEVEL_SWITCHING,L.onLevelSwitching,Fe(L)),L}o=w,(b=l).prototype=Object.create(o.prototype),b.prototype.constructor=b,Qe(b,o);var g,m,p=l.prototype;return p.doTick=function(){this.onTickEnd()},p.onTickEnd=function(){},p.startLoad=function(h){},p.stopLoad=function(){this.fragmentLoader.abort();var h=this.fragCurrent;h&&this.fragmentTracker.removeFragment(h),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$e},p._streamEnded=function(h,y){var T=this.fragCurrent,L=this.fragmentTracker;if(!y.live&&T&&this.media&&T.sn>=y.endSN&&!h.nextStart){var A=y.partList;if(A!=null&&A.length){var M=A[A.length-1];return ve.isBuffered(this.media,M.start+M.duration/2)}var oe=L.getState(T);return oe===Xt.PARTIAL||oe===Xt.OK}return!1},p.onMediaAttached=function(h,y){var T=this.media=this.mediaBuffer=y.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),T.addEventListener("seeking",this.onvseeking),T.addEventListener("ended",this.onvended);var L=this.config;this.levels&&L.autoStartLoad&&this.state===$e&&this.startLoad(L.startPosition)},p.onMediaDetaching=function(){var h=this.media;h!=null&&h.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),h&&this.onvseeking&&this.onvended&&(h.removeEventListener("seeking",this.onvseeking),h.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},p.onMediaSeeking=function(){var h=this.config,y=this.fragCurrent,T=this.media,L=this.mediaBuffer,A=this.state,M=T?T.currentTime:0,oe=ve.bufferInfo(L||T,M,h.maxBufferHole);if(this.log("media seeking to "+((0,B.isFiniteNumber)(M)?M.toFixed(3):M)+", state: "+A),A===Pt)this.resetLoadingState();else if(y&&!oe.len){var fe=h.maxFragLookUpTolerance,Se=y.start-fe,Ce=M>y.start+y.duration+fe;(M<Se||Ce)&&(Ce&&y.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),y.loader.abort()),this.resetLoadingState())}T&&(this.lastCurrentTime=M),this.loadedmetadata||oe.len||(this.nextLoadPosition=this.startPosition=M),this.tickImmediate()},p.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},p.onKeyLoaded=function(h,y){if(this.state===ot&&y.frag===this.fragCurrent&&this.levels){this.state=je;var T=this.levels[y.frag.level].details;T&&this.loadFragment(y.frag,T,y.frag.start)}},p.onLevelSwitching=function(h,y){this.fragLoadError=0},p.onHandlerDestroying=function(){this.stopLoad(),w.prototype.onHandlerDestroying.call(this)},p.onHandlerDestroyed=function(){this.state=$e,this.hls.off(c.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,w.prototype.onHandlerDestroyed.call(this)},p.loadKey=function(h,y){this.log("Loading key for "+h.sn+" of ["+y.startSN+"-"+y.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+h.level),this.state=ot,this.fragCurrent=h,this.hls.trigger(c.Events.KEY_LOADING,{frag:h})},p.loadFragment=function(h,y,T){this._loadFragForPlayback(h,y,T)},p._loadFragForPlayback=function(h,y,T){var L=this;this._doFragLoad(h,y,T,function(A){if(L.fragContextChanged(h))return L.warn("Fragment "+h.sn+(A.part?" p: "+A.part.index:"")+" of level "+h.level+" was dropped during download."),void L.fragmentTracker.removeFragment(h);h.stats.chunkCount++,L._handleFragmentLoadProgress(A)}).then(function(A){if(A){L.fragLoadError=0;var M=L.state;L.fragContextChanged(h)?(M===Tt||!L.fragCurrent&&M===Ft)&&(L.fragmentTracker.removeFragment(h),L.state=je):("payload"in A&&(L.log("Loaded fragment "+h.sn+" of level "+h.level),L.hls.trigger(c.Events.FRAG_LOADED,A)),L._handleFragmentLoadComplete(A))}}).catch(function(A){L.state!==$e&&L.state!==mt&&(L.warn(A),L.resetFragmentLoading(h))})},p.flushMainBuffer=function(h,y,T){if(T===void 0&&(T=null),h-y){var L={startOffset:h,endOffset:y,type:T};this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,L)}},p._loadInitSegment=function(h){var y=this;this._doFragLoad(h).then(function(T){if(!T||y.fragContextChanged(h)||!y.levels)throw new Error("init load aborted");return T}).then(function(T){var L=y.hls,A=T.payload,M=h.decryptdata;if(A&&A.byteLength>0&&M&&M.key&&M.iv&&M.method==="AES-128"){var oe=self.performance.now();return y.decrypter.webCryptoDecrypt(new Uint8Array(A),M.key.buffer,M.iv.buffer).then(function(fe){var Se=self.performance.now();return L.trigger(c.Events.FRAG_DECRYPTED,{frag:h,payload:fe,stats:{tstart:oe,tdecrypt:Se}}),T.payload=fe,T})}return T}).then(function(T){var L=y.fragCurrent,A=y.hls,M=y.levels;if(!M)throw new Error("init load aborted, missing levels");M[h.level].details;var oe=h.stats;y.state=je,y.fragLoadError=0,h.data=new Uint8Array(T.payload),oe.parsing.start=oe.buffering.start=self.performance.now(),oe.parsing.end=oe.buffering.end=self.performance.now(),T.frag===L&&A.trigger(c.Events.FRAG_BUFFERED,{stats:oe,frag:L,part:null,id:h.type}),y.tick()}).catch(function(T){y.state!==$e&&y.state!==mt&&(y.warn(T),y.resetFragmentLoading(h))})},p.fragContextChanged=function(h){var y=this.fragCurrent;return!h||!y||h.level!==y.level||h.sn!==y.sn||h.urlId!==y.urlId},p.fragBufferedComplete=function(h,y){var T,L,A=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+h.type+" sn: "+h.sn+(y?" part: "+y.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+h.level+" "+(A?pe(ve.getBuffered(A)):"(detached)")),this.state=je,A&&(!this.loadedmetadata&&A.buffered.length&&((T=this.fragCurrent)===null||T===void 0?void 0:T.sn)===((L=this.fragPrevious)===null||L===void 0?void 0:L.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},p.seekToStartPos=function(){},p._handleFragmentLoadComplete=function(h){var y=this.transmuxer;if(y){var T=h.frag,L=h.part,A=h.partsLoaded,M=!A||A.length===0||A.some(function(fe){return!fe}),oe=new Le(T.level,T.sn,T.stats.chunkCount+1,0,L?L.index:-1,!M);y.flush(oe)}},p._handleFragmentLoadProgress=function(h){},p._doFragLoad=function(h,y,T,L){var A=this;if(T===void 0&&(T=null),!this.levels)throw new Error("frag load aborted, missing levels");if(T=Math.max(h.start,T||0),this.config.lowLatencyMode&&y){var M=y.partList;if(M&&L){T>h.end&&y.fragmentHint&&(h=y.fragmentHint);var oe=this.getNextPart(M,h,T);if(oe>-1){var fe=M[oe];return this.log("Loading part sn: "+h.sn+" p: "+fe.index+" cc: "+h.cc+" of playlist ["+y.startSN+"-"+y.endSN+"] parts [0-"+oe+"-"+(M.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+h.level+", target: "+parseFloat(T.toFixed(3))),this.nextLoadPosition=fe.start+fe.duration,this.state=Tt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:h,part:M[oe],targetBufferTime:T}),this.doFragPartsLoad(h,M,oe,L).catch(function(Se){return A.handleFragLoadError(Se)})}if(!h.url||this.loadedEndOfParts(M,T))return Promise.resolve(null)}}return this.log("Loading fragment "+h.sn+" cc: "+h.cc+" "+(y?"of ["+y.startSN+"-"+y.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+h.level+", target: "+parseFloat(T.toFixed(3))),(0,B.isFiniteNumber)(h.sn)&&!this.bitrateTest&&(this.nextLoadPosition=h.start+h.duration),this.state=Tt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:h,targetBufferTime:T}),this.fragmentLoader.load(h,L).catch(function(Se){return A.handleFragLoadError(Se)})},p.doFragPartsLoad=function(h,y,T,L){var A=this;return new Promise(function(M,oe){var fe=[];(function Se(Ce){var Ie=y[Ce];A.fragmentLoader.loadPart(h,Ie,L).then(function(ft){fe[Ie.index]=ft;var nt=ft.part;A.hls.trigger(c.Events.FRAG_LOADED,ft);var Ye=y[Ce+1];if(!Ye||Ye.fragment!==h)return M({frag:h,part:nt,partsLoaded:fe});Se(Ce+1)}).catch(oe)})(T)})},p.handleFragLoadError=function(h){var y=h.data;return y&&y.details===P.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(y.frag,y.part):this.hls.trigger(c.Events.ERROR,y),null},p._handleTransmuxerFlush=function(h){var y=this.getCurrentContext(h);if(y&&this.state===Ft){var T=y.frag,L=y.part,A=y.level,M=self.performance.now();T.stats.parsing.end=M,L&&(L.stats.parsing.end=M),this.updateLevelTiming(T,L,A,h.partial)}else this.fragCurrent||(this.state=je)},p.getCurrentContext=function(h){var y=this.levels,T=h.level,L=h.sn,A=h.part;if(!y||!y[T])return this.warn("Levels object was unset while buffering fragment "+L+" of level "+T+". The current chunk will not be buffered."),null;var M=y[T],oe=A>-1?function(Se,Ce,Ie){if(!Se||!Se.details)return null;var ft=Se.details.partList;if(ft)for(var nt=ft.length;nt--;){var Ye=ft[nt];if(Ye.index===Ie&&Ye.fragment.sn===Ce)return Ye}return null}(M,L,A):null,fe=oe?oe.fragment:function(Se,Ce,Ie){if(!Se||!Se.details)return null;var ft=Se.details,nt=ft.fragments[Ce-ft.startSN];return nt||((nt=ft.fragmentHint)&&nt.sn===Ce?nt:Ce<ft.startSN&&Ie&&Ie.sn===Ce?Ie:null)}(M,L,this.fragCurrent);return fe?{frag:fe,part:oe,level:M}:null},p.bufferFragmentData=function(h,y,T,L){if(h&&this.state===Ft){var A=h.data1,M=h.data2,oe=A;if(A&&M&&(oe=(0,se.appendUint8Array)(A,M)),oe&&oe.length){var fe={type:h.type,frag:y,part:T,chunkMeta:L,parent:y.type,data:oe};this.hls.trigger(c.Events.BUFFER_APPENDING,fe),h.dropped&&h.independent&&!T&&this.flushBufferGap(y)}}},p.flushBufferGap=function(h){var y=this.media;if(y)if(ve.isBuffered(y,y.currentTime)){var T=y.currentTime,L=ve.bufferInfo(y,T,0),A=h.duration,M=Math.min(2*this.config.maxFragLookUpTolerance,.25*A),oe=Math.max(Math.min(h.start-M,L.end-M),T+M);h.start-oe>M&&this.flushMainBuffer(oe,h.start)}else this.flushMainBuffer(0,h.start)},p.getFwdBufferInfo=function(h,y){var T=this.config,L=this.getLoadPosition();if(!(0,B.isFiniteNumber)(L))return null;var A=ve.bufferInfo(h,L,T.maxBufferHole);if(A.len===0&&A.nextStart!==void 0){var M=this.fragmentTracker.getBufferedFrag(L,y);if(M&&A.nextStart<M.end)return ve.bufferInfo(h,L,Math.max(A.nextStart,T.maxBufferHole))}return A},p.getMaxBufferLength=function(h){var y,T=this.config;return y=h?Math.max(8*T.maxBufferSize/h,T.maxBufferLength):T.maxBufferLength,Math.min(y,T.maxMaxBufferLength)},p.reduceMaxBufferLength=function(h){var y=this.config,T=h||y.maxBufferLength;return y.maxMaxBufferLength>=T&&(y.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+y.maxMaxBufferLength+"s"),!0)},p.getNextFragment=function(h,y){var T=y.fragments,L=T.length;if(!L)return null;var A,M=this.config,oe=T[0].start;if(y.live){var fe=M.initialLiveManifestSize;if(L<fe)return this.warn("Not enough fragments to start playback (have: "+L+", need: "+fe+")"),null;y.PTSKnown||this.startFragRequested||this.startPosition!==-1||(A=this.getInitialLiveFragment(y,T),this.startPosition=A?this.hls.liveSyncPosition||A.start:h)}else h<=oe&&(A=T[0]);if(!A){var Se=M.lowLatencyMode?y.partEnd:y.fragmentEnd;A=this.getFragmentAtPosition(h,Se,y)}return this.mapToInitFragWhenRequired(A)},p.mapToInitFragWhenRequired=function(h){return h==null||!h.initSegment||h!=null&&h.initSegment.data||this.bitrateTest?h:h.initSegment},p.getNextPart=function(h,y,T){for(var L=-1,A=!1,M=!0,oe=0,fe=h.length;oe<fe;oe++){var Se=h[oe];if(M=M&&!Se.independent,L>-1&&T<Se.start)break;var Ce=Se.loaded;!Ce&&(A||Se.independent||M)&&Se.fragment===y&&(L=oe),A=Ce}return L},p.loadedEndOfParts=function(h,y){var T=h[h.length-1];return T&&y>T.start&&T.loaded},p.getInitialLiveFragment=function(h,y){var T=this.fragPrevious,L=null;if(T){if(h.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+T.programDateTime),L=function(fe,Se,Ce){if(Se===null||!Array.isArray(fe)||!fe.length||!(0,B.isFiniteNumber)(Se)||Se<(fe[0].programDateTime||0)||Se>=(fe[fe.length-1].endProgramDateTime||0))return null;Ce=Ce||0;for(var Ie=0;Ie<fe.length;++Ie){var ft=fe[Ie];if(pt(Se,Ce,ft))return ft}return null}(y,T.endProgramDateTime,this.config.maxFragLookUpTolerance)),!L){var A=T.sn+1;if(A>=h.startSN&&A<=h.endSN){var M=y[A-h.startSN];T.cc===M.cc&&(L=M,this.log("Live playlist, switching playlist, load frag with next SN: "+L.sn))}L||(L=function(fe,Se){return Be(fe,function(Ce){return Ce.cc<Se?1:Ce.cc>Se?-1:0})}(y,T.cc),L&&this.log("Live playlist, switching playlist, load frag with same CC: "+L.sn))}}else{var oe=this.hls.liveSyncPosition;oe!==null&&(L=this.getFragmentAtPosition(oe,this.bitrateTest?h.fragmentEnd:h.edge,h))}return L},p.getFragmentAtPosition=function(h,y,T){var L,A=this.config,M=this.fragPrevious,oe=T.fragments,fe=T.endSN,Se=T.fragmentHint,Ce=A.maxFragLookUpTolerance,Ie=!!(A.lowLatencyMode&&T.partList&&Se);if(Ie&&Se&&!this.bitrateTest&&(oe=oe.concat(Se),fe=Se.sn),L=h<y?function(Ye,Je,et,He){et===void 0&&(et=0),He===void 0&&(He=0);var at=null;return Ye?at=Je[Ye.sn-Je[0].sn+1]||null:et===0&&Je[0].start===0&&(at=Je[0]),at&&rt(et,He,at)===0?at:Be(Je,rt.bind(null,et,He))||at}(M,oe,h,h>y-Ce?0:Ce):oe[oe.length-1],L){var ft=L.sn-T.startSN;if(this.fragmentTracker.getState(L)===Xt.OK&&(M=L),M&&L.sn===M.sn&&!Ie&&M&&L.level===M.level){var nt=oe[ft+1];L.sn<fe&&this.fragmentTracker.getState(nt)!==Xt.OK?(this.log("SN "+L.sn+" just loaded, load next one: "+nt.sn),L=nt):L=null}}return L},p.synchronizeToLiveEdge=function(h){var y=this.config,T=this.media;if(T){var L=this.hls.liveSyncPosition,A=T.currentTime,M=h.fragments[0].start,oe=h.edge,fe=A>=M-y.maxFragLookUpTolerance&&A<=oe;if(L!==null&&T.duration>L&&(A<L||!fe)){var Se=y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:y.liveMaxLatencyDurationCount*h.targetduration;(!fe&&T.readyState<4||A<oe-Se)&&(this.loadedmetadata||(this.nextLoadPosition=L),T.readyState&&(this.warn("Playback: "+A.toFixed(3)+" is located too far from the end of live sliding playlist: "+oe+", reset currentTime to : "+L.toFixed(3)),T.currentTime=L))}}},p.alignPlaylists=function(h,y){var T=this.levels,L=this.levelLastLoaded,A=this.fragPrevious,M=L!==null?T[L]:null,oe=h.fragments.length;if(!oe)return this.warn("No fragments in live playlist"),0;var fe=h.fragments[0].start,Se=!y,Ce=h.alignedSliding&&(0,B.isFiniteNumber)(fe);if(Se||!Ce&&!fe){(function(ft,nt,Ye){nt&&(function(Je,et,He){if(function(Rt,$t,Ct){return!(!$t.details||!(Ct.endCC>Ct.startCC||Rt&&Rt.cc<Ct.startCC))}(Je,He,et)){var at=function(Rt,$t,Ct){Ct===void 0&&(Ct=0);var qt=Rt.fragments,or=$t.fragments;if(or.length&&qt.length){var Bt=function(Mt,nr){for(var pr=null,br=0,Lr=Mt.length;br<Lr;br++){var _r=Mt[br];if(_r&&_r.cc===nr){pr=_r;break}}return pr}(qt,or[0].cc);if(Bt&&(!Bt||Bt.startPTS))return Bt;_.logger.log("No frag in previous level to align on")}else _.logger.log("No fragments to align")}(He.details,et);at&&(0,B.isFiniteNumber)(at.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+et.url),ze(at.start,et))}}(ft,Ye,nt),!Ye.alignedSliding&&nt.details&&function(Je,et){if(et.fragments.length&&Je.hasProgramDateTime&&et.hasProgramDateTime){var He=et.fragments[0].programDateTime,at=Je.fragments[0].programDateTime,Rt=(at-He)/1e3+et.fragments[0].start;Rt&&(0,B.isFiniteNumber)(Rt)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(at-He)+"ms, sliding:"+Rt.toFixed(3)+" "+Je.url+" "),ze(Rt,Je))}}(Ye,nt.details),Ye.alignedSliding||!nt.details||Ye.skippedSegments||Zt(nt.details,Ye))})(A,M,h);var Ie=h.fragments[0].start;return this.log("Live playlist sliding: "+Ie.toFixed(2)+" start-sn: "+(y?y.startSN:"na")+"->"+h.startSN+" prev-sn: "+(A?A.sn:"na")+" fragments: "+oe),Ie}return fe},p.waitForCdnTuneIn=function(h){return h.live&&h.canBlockReload&&h.partTarget&&h.tuneInGoal>Math.max(h.partHoldBack,3*h.partTarget)},p.setStartPosition=function(h,y){var T=this.startPosition;if(T<y&&(T=-1),T===-1||this.lastCurrentTime===-1){var L=h.startTimeOffset;(0,B.isFiniteNumber)(L)?(T=y+L,L<0&&(T+=h.totalduration),T=Math.min(Math.max(y,T),y+h.totalduration),this.log("Start time offset "+L+" found in playlist, adjust startPosition to "+T),this.startPosition=T):h.live?T=this.hls.liveSyncPosition||y:this.startPosition=T=0,this.lastCurrentTime=T}this.nextLoadPosition=T},p.getLoadPosition=function(){var h=this.media,y=0;return this.loadedmetadata&&h?y=h.currentTime:this.nextLoadPosition&&(y=this.nextLoadPosition),y},p.handleFragLoadAborted=function(h,y){this.transmuxer&&h.sn!=="initSegment"&&h.stats.aborted&&(this.warn("Fragment "+h.sn+(y?" part"+y.index:"")+" of level "+h.level+" was aborted"),this.resetFragmentLoading(h))},p.resetFragmentLoading=function(h){this.fragCurrent&&(this.fragContextChanged(h)||this.state===dt)||(this.state=je)},p.onFragmentOrKeyLoadError=function(h,y){if(!y.fatal){var T=y.frag;if(T&&T.type===h){this.fragCurrent;var L=this.config;if(this.fragLoadError+1<=L.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var A=Math.min(Math.pow(2,this.fragLoadError)*L.fragLoadingRetryDelay,L.fragLoadingMaxRetryTimeout);this.warn("Fragment "+T.sn+" of "+h+" "+T.level+" failed to load, retrying in "+A+"ms"),this.retryDate=self.performance.now()+A,this.fragLoadError++,this.state=dt}else y.levelRetry?(h===G.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=je):(_.logger.error(y.details+" reaches max retry, redispatch as fatal ..."),y.fatal=!0,this.hls.stopLoad(),this.state=mt)}}},p.afterBufferFlushed=function(h,y,T){if(h){var L=ve.getBuffered(h);this.fragmentTracker.detectEvictedFragments(y,L,T),this.state===Pt&&this.resetLoadingState()}},p.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=je},p.resetStartWhenNotLoaded=function(h){if(!this.loadedmetadata){this.startFragRequested=!1;var y=this.levels?this.levels[h].details:null;y!=null&&y.live?(this.startPosition=-1,this.setStartPosition(y,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},p.updateLevelTiming=function(h,y,T,L){var A=this,M=T.details;Object.keys(h.elementaryStreams).reduce(function(oe,fe){var Se=h.elementaryStreams[fe];if(Se){var Ce=Se.endPTS-Se.startPTS;if(Ce<=0)return A.warn("Could not parse fragment "+h.sn+" "+fe+" duration reliably ("+Ce+")"),oe||!1;var Ie=L?0:tr(M,h,Se.startPTS,Se.endPTS,Se.startDTS,Se.endDTS);return A.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:M,level:T,drift:Ie,type:fe,frag:h,start:Se.startPTS,end:Se.endPTS}),!0}return oe},!1)||(this.warn("Found no media in fragment "+h.sn+" of level "+T.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=Qt,this.hls.trigger(c.Events.FRAG_PARSED,{frag:h,part:y})},p.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},g=l,(m=[{key:"state",get:function(){return this._state},set:function(h){var y=this._state;y!==h&&(this._state=h,this.log(y+"->"+h))}}])&&ke(g.prototype,m),Object.defineProperty(g,"prototype",{writable:!1}),l}($);function zt(){return self.MediaSource||self.WebKitMediaSource}function dr(){return self.SourceBuffer||self.WebKitSourceBuffer}var jt=function(){var w=ENTRY_MODULE,b={};function o(g){var m=b[g];if(m!==void 0)return m.exports;var p=b[g]={exports:{}};return w[g].call(p.exports,p,p.exports,o),p.exports}o.m=w,o.n=function(g){var m=g&&g.__esModule?function(){return g.default}:function(){return g};return o.d(m,{a:m}),m},o.d=function(g,m){for(var p in m)o.o(m,p)&&!o.o(g,p)&&Object.defineProperty(g,p,{enumerable:!0,get:m[p]})},o.o=function(g,m){return Object.prototype.hasOwnProperty.call(g,m)},o.r=function(g){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var l=o(ENTRY_MODULE);return l.default||l};jt.toString();var gr="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function yr(w){return(w+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function mr(w,b,o){var l={};l[o]=[];var g=b.toString(),m=g.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||g.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!m)return l;for(var p,h=m[1],y=new RegExp("(\\\\n|\\W)"+yr(h)+gr,"g");p=y.exec(g);)p[3]!=="dll-reference"&&l[o].push(p[3]);for(y=new RegExp("\\("+yr(h)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+gr,"g");p=y.exec(g);)w[p[2]]||(l[o].push(p[1]),w[p[2]]=X(p[1]).m),l[p[2]]=l[p[2]]||[],l[p[2]].push(p[4]);for(var T,L=Object.keys(l),A=0;A<L.length;A++)for(var M=0;M<l[L[A]].length;M++)T=l[L[A]][M],isNaN(1*T)||(l[L[A]][M]=1*l[L[A]][M]);return l}function ir(w){return Object.keys(w).reduce(function(b,o){return b||w[o].length>0},!1)}function vr(w,b,o,l){var g=w[l].map(function(p){return'"'+p+'": '+b[l][p].toString()}).join(","),m=jt.toString().split("ENTRY_MODULE");return m[0]+"{"+g+"}"+m[1]+'"'+o+'"'+m[2]}var Ar=X(764),Rr=X(729),Br=zt()||{isTypeSupported:function(){return!1}},Pr=function(){function w(o,l,g,m){var p=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var h=o.config;this.hls=o,this.id=l,this.useWorker=!!h.enableWorker,this.onTransmuxComplete=g,this.onFlush=m;var y=function(M,oe){(oe=oe||{}).frag=p.frag,oe.id=p.id,p.hls.trigger(M,oe)};this.observer=new Rr.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,y),this.observer.on(c.Events.ERROR,y);var T={mp4:Br.isTypeSupported("video/mp4"),mpeg:Br.isTypeSupported("audio/mpeg"),mp3:Br.isTypeSupported('audio/mp4; codecs="mp3"')},L=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){var A;_.logger.log("demuxing in webworker");try{A=this.worker=function(M,oe){oe=oe||{};var fe={main:X.m},Se=oe.all?{main:Object.keys(fe.main)}:function(Ye,Je){for(var et={main:[Je]},He={main:[]},at={main:{}};ir(et);)for(var Rt=Object.keys(et),$t=0;$t<Rt.length;$t++){var Ct=Rt[$t],qt=et[Ct].pop();if(at[Ct]=at[Ct]||{},!at[Ct][qt]&&Ye[Ct][qt]){at[Ct][qt]=!0,He[Ct]=He[Ct]||[],He[Ct].push(qt);for(var or=mr(Ye,Ye[Ct][qt],Ct),Bt=Object.keys(or),Mt=0;Mt<Bt.length;Mt++)et[Bt[Mt]]=et[Bt[Mt]]||[],et[Bt[Mt]]=et[Bt[Mt]].concat(or[Bt[Mt]])}}return He}(fe,M),Ce="";Object.keys(Se).filter(function(Ye){return Ye!=="main"}).forEach(function(Ye){for(var Je=0;Se[Ye][Je];)Je++;Se[Ye].push(Je),fe[Ye][Je]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",Ce=Ce+"var "+Ye+" = ("+vr(Se,fe,Je,modules)+`)();
`}),Ce=Ce+"(("+vr(Se,fe,M,"main")+")())(self);";var Ie=new window.Blob([Ce],{type:"text/javascript"}),ft=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(Ie),nt=new window.Worker(ft);return nt.objectURL=ft,nt}(182),this.onwmsg=this.onWorkerMessage.bind(this),A.addEventListener("message",this.onwmsg),A.onerror=function(M){p.useWorker=!1,_.logger.warn("Exception in webworker, fallback to inline"),p.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(M.message+"  ("+M.filename+":"+M.lineno+")")})},A.postMessage({cmd:"init",typeSupported:T,vendor:L,id:l,config:JSON.stringify(h)})}catch(M){_.logger.warn("Error in worker:",M),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),A&&self.URL.revokeObjectURL(A.objectURL),this.transmuxer=new Ar.default(this.observer,T,h,L,l),this.worker=null}}else this.transmuxer=new Ar.default(this.observer,T,h,L,l)}var b=w.prototype;return b.destroy=function(){var o=this.worker;if(o)o.removeEventListener("message",this.onwmsg),o.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var g=this.observer;g&&g.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},b.push=function(o,l,g,m,p,h,y,T,L,A){var M,oe,fe=this;L.transmuxing.start=self.performance.now();var Se=this.transmuxer,Ce=this.worker,Ie=h?h.start:p.start,ft=p.decryptdata,nt=this.frag,Ye=!(nt&&p.cc===nt.cc),Je=!(nt&&L.level===nt.level),et=nt?L.sn-nt.sn:-1,He=this.part?L.part-this.part.index:-1,at=et===0&&L.id>1&&L.id===(nt==null?void 0:nt.stats.chunkCount),Rt=!Je&&(et===1||et===0&&(He===1||at&&He<=0)),$t=self.performance.now();(Je||et||p.stats.parsing.start===0)&&(p.stats.parsing.start=$t),!h||!He&&Rt||(h.stats.parsing.start=$t);var Ct=!(nt&&((M=p.initSegment)===null||M===void 0?void 0:M.url)===((oe=nt.initSegment)===null||oe===void 0?void 0:oe.url)),qt=new Ar.TransmuxState(Ye,Rt,T,Je,Ie,Ct);if(!Rt||Ye||Ct){_.logger.log("[transmuxer-interface, "+p.type+"]: Starting new transmux session for sn: "+L.sn+" p: "+L.part+" level: "+L.level+" id: "+L.id+`
        discontinuity: `+Ye+`
        trackSwitch: `+Je+`
        contiguous: `+Rt+`
        accurateTimeOffset: `+T+`
        timeOffset: `+Ie+`
        initSegmentChange: `+Ct);var or=new Ar.TransmuxConfig(g,m,l,y,A);this.configureTransmuxer(or)}if(this.frag=p,this.part=h,Ce)Ce.postMessage({cmd:"demux",data:o,decryptdata:ft,chunkMeta:L,state:qt},o instanceof ArrayBuffer?[o]:[]);else if(Se){var Bt=Se.push(o,ft,L,qt);(0,Ar.isPromise)(Bt)?Bt.then(function(Mt){fe.handleTransmuxComplete(Mt)}):this.handleTransmuxComplete(Bt)}},b.flush=function(o){var l=this;o.transmuxing.start=self.performance.now();var g=this.transmuxer,m=this.worker;if(m)m.postMessage({cmd:"flush",chunkMeta:o});else if(g){var p=g.flush(o);(0,Ar.isPromise)(p)?p.then(function(h){l.handleFlushResult(h,o)}):this.handleFlushResult(p,o)}},b.handleFlushResult=function(o,l){var g=this;o.forEach(function(m){g.handleTransmuxComplete(m)}),this.onFlush(l)},b.onWorkerMessage=function(o){var l=o.data,g=this.hls;switch(l.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(l.data);break;case"flush":this.onFlush(l.data);break;case"workerLog":_.logger[l.data.logType]&&_.logger[l.data.logType](l.data.message);break;default:l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,g.trigger(l.event,l.data)}},b.configureTransmuxer=function(o){var l=this.worker,g=this.transmuxer;l?l.postMessage({cmd:"configure",config:o}):g&&g.configure(o)},b.handleTransmuxComplete=function(o){o.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(o)},w}(),qr=function(){function w(o,l,g,m){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=o,this.media=l,this.fragmentTracker=g,this.hls=m}var b=w.prototype;return b.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},b.poll=function(o,l){var g=this.config,m=this.media,p=this.stalled;if(m!==null){var h=m.currentTime,y=m.seeking,T=this.seeking&&!y,L=!this.seeking&&y;if(this.seeking=y,h===o){if((L||T)&&(this.stalled=null),!(m.paused&&!y||m.ended||m.playbackRate===0)&&ve.getBuffered(m).length){var A=ve.bufferInfo(m,h,0),M=A.len>0,oe=A.nextStart||0;if(M||oe){if(y){var fe=A.len>2,Se=!oe||l&&l.start<=h||oe-h>2&&!this.fragmentTracker.getPartialFragment(h);if(fe||Se)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var Ce,Ie=Math.max(oe,A.start||0)-h,ft=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,nt=!(ft==null||(Ce=ft.details)===null||Ce===void 0)&&Ce.live?2*ft.details.targetduration:2;if(Ie>0&&Ie<=nt)return void this._trySkipBufferHole(null)}var Ye=self.performance.now();if(p!==null){var Je=Ye-p;if(y||!(Je>=250)||(this._reportStall(A),this.media)){var et=ve.bufferInfo(m,h,g.maxBufferHole);this._tryFixBufferStall(et,Je)}}else this.stalled=Ye}}}else if(this.moved=!0,p!==null){if(this.stallReported){var He=self.performance.now()-p;_.logger.warn("playback not stuck anymore @"+h+", after "+Math.round(He)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},b._tryFixBufferStall=function(o,l){var g=this.config,m=this.fragmentTracker,p=this.media;if(p!==null){var h=p.currentTime,y=m.getPartialFragment(h);if(y&&(this._trySkipBufferHole(y)||!this.media))return;o.len>g.maxBufferHole&&l>1e3*g.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},b._reportStall=function(o){var l=this.hls,g=this.media;!this.stallReported&&g&&(this.stallReported=!0,_.logger.warn("Playback stalling at @"+g.currentTime+" due to low buffer ("+JSON.stringify(o)+")"),l.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:o.len}))},b._trySkipBufferHole=function(o){var l=this.config,g=this.hls,m=this.media;if(m===null)return 0;for(var p=m.currentTime,h=0,y=ve.getBuffered(m),T=0;T<y.length;T++){var L=y.start(T);if(p+l.maxBufferHole>=h&&p<L){var A=Math.max(L+.05,m.currentTime+.1);return _.logger.warn("skipping hole, adjusting currentTime from "+p+" to "+A),this.moved=!0,this.stalled=null,m.currentTime=A,o&&g.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+p+" to "+A,frag:o}),A}h=y.end(T)}return 0},b._tryNudgeBuffer=function(){var o=this.config,l=this.hls,g=this.media,m=this.nudgeRetry;if(g!==null){var p=g.currentTime;if(this.nudgeRetry++,m<o.nudgeMaxRetry){var h=p+(m+1)*o.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+p+" to "+h),g.currentTime=h,l.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+p+" after "+o.nudgeMaxRetry+" nudges"),l.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},w}();function $r(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}function zr(w,b){return zr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},zr(w,b)}var Kr=function(w){var b,o;function l(h,y){var T;return(T=w.call(this,h,y,"[stream-controller]")||this).audioCodecSwap=!1,T.gapController=null,T.level=-1,T._forceStartLoad=!1,T.altAudio=!1,T.audioOnly=!1,T.fragPlaying=null,T.onvplaying=null,T.onvseeked=null,T.fragLastKbps=0,T.couldBacktrack=!1,T.backtrackFragment=null,T.audioCodecSwitch=!1,T.videoBuffer=null,T._registerListeners(),T}o=w,(b=l).prototype=Object.create(o.prototype),b.prototype.constructor=b,zr(b,o);var g,m,p=l.prototype;return p._registerListeners=function(){var h=this.hls;h.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),h.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),h.on(c.Events.ERROR,this.onError,this),h.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),h.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),h.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),h.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),h.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var h=this.hls;h.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),h.off(c.Events.ERROR,this.onError,this),h.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),h.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),h.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),h.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),h.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),h.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},p.startLoad=function(h){if(this.levels){var y=this.lastCurrentTime,T=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var L=T.startLevel;L===-1&&(T.config.testBandwidth&&this.levels.length>1?(L=0,this.bitrateTest=!0):L=T.nextAutoLevel),this.level=T.nextLoadLevel=L,this.loadedmetadata=!1}y>0&&h===-1&&(this.log("Override startPosition with lastCurrentTime @"+y.toFixed(3)),h=y),this.state=je,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=h,this.tick()}else this._forceStartLoad=!0,this.state=$e},p.stopLoad=function(){this._forceStartLoad=!1,w.prototype.stopLoad.call(this)},p.doTick=function(){switch(this.state){case je:this.doTickIdle();break;case Vt:var h,y=this.levels,T=this.level,L=y==null||(h=y[T])===null||h===void 0?void 0:h.details;if(L&&(!L.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(L))break;this.state=je;break}break;case dt:var A,M=self.performance.now(),oe=this.retryDate;(!oe||M>=oe||(A=this.media)!==null&&A!==void 0&&A.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=je)}this.onTickEnd()},p.onTickEnd=function(){w.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},p.doTickIdle=function(){var h,y,T=this.hls,L=this.levelLastLoaded,A=this.levels,M=this.media,oe=T.config,fe=T.nextLoadLevel;if(L!==null&&(M||!this.startFragRequested&&oe.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&A&&A[fe]){var Se=A[fe];this.level=T.nextLoadLevel=fe;var Ce=Se.details;if(!Ce||this.state===Vt||Ce.live&&this.levelLastLoaded!==fe)this.state=Vt;else{var Ie=this.getMainFwdBufferInfo();if(Ie!==null&&!(Ie.len>=this.getMaxBufferLength(Se.maxBitrate))){if(this._streamEnded(Ie,Ce)){var ft={};return this.altAudio&&(ft.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,ft),void(this.state=Pt)}this.backtrackFragment&&this.backtrackFragment.start>Ie.end&&(this.backtrackFragment=null);var nt=this.backtrackFragment?this.backtrackFragment.start:Ie.end,Ye=this.getNextFragment(nt,Ce);if(this.couldBacktrack&&!this.fragPrevious&&Ye&&Ye.sn!=="initSegment"&&this.fragmentTracker.getState(Ye)!==Xt.OK){var Je,et=((Je=this.backtrackFragment)!=null?Je:Ye).sn-Ce.startSN,He=Ce.fragments[et-1];He&&Ye.cc===He.cc&&(Ye=He,this.fragmentTracker.removeFragment(He))}else this.backtrackFragment&&Ie.len&&(this.backtrackFragment=null);if(Ye&&this.fragmentTracker.getState(Ye)===Xt.OK&&this.nextLoadPosition>nt){var at=this.audioOnly&&!this.altAudio?ne.ElementaryStreamTypes.AUDIO:ne.ElementaryStreamTypes.VIDEO;M&&this.afterBufferFlushed(M,at,G.PlaylistLevelType.MAIN),Ye=this.getNextFragment(this.nextLoadPosition,Ce)}Ye&&(!Ye.initSegment||Ye.initSegment.data||this.bitrateTest||(Ye=Ye.initSegment),((h=Ye.decryptdata)===null||h===void 0?void 0:h.keyFormat)!=="identity"||(y=Ye.decryptdata)!==null&&y!==void 0&&y.key?this.loadFragment(Ye,Ce,nt):this.loadKey(Ye,Ce))}}}},p.loadFragment=function(h,y,T){var L,A=this.fragmentTracker.getState(h);this.fragCurrent=h,A===Xt.NOT_LOADED?h.sn==="initSegment"?this._loadInitSegment(h):this.bitrateTest?(this.log("Fragment "+h.sn+" of level "+h.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(h)):(this.startFragRequested=!0,w.prototype.loadFragment.call(this,h,y,T)):A===Xt.APPENDING?this.reduceMaxBufferLength(h.duration)&&this.fragmentTracker.removeFragment(h):((L=this.media)===null||L===void 0?void 0:L.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},p.getAppendedFrag=function(h){var y=this.fragmentTracker.getAppendedFrag(h,G.PlaylistLevelType.MAIN);return y&&"fragment"in y?y.fragment:y},p.getBufferedFrag=function(h){return this.fragmentTracker.getBufferedFrag(h,G.PlaylistLevelType.MAIN)},p.followingBufferedFrag=function(h){return h?this.getBufferedFrag(h.end+.5):null},p.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},p.nextLevelSwitch=function(){var h=this.levels,y=this.media;if(y!=null&&y.readyState){var T,L=this.getAppendedFrag(y.currentTime);if(L&&L.start>1&&this.flushMainBuffer(0,L.start-1),!y.paused&&h){var A=h[this.hls.nextLoadLevel],M=this.fragLastKbps;T=M&&this.fragCurrent?this.fragCurrent.duration*A.maxBitrate/(1e3*M)+1:0}else T=0;var oe=this.getBufferedFrag(y.currentTime+T);if(oe){var fe=this.followingBufferedFrag(oe);if(fe){this.abortCurrentFrag();var Se=fe.maxStartPTS?fe.maxStartPTS:fe.start,Ce=fe.duration,Ie=Math.max(oe.end,Se+Math.min(Math.max(Ce-this.config.maxFragLookUpTolerance,.5*Ce),.75*Ce));this.flushMainBuffer(Ie,Number.POSITIVE_INFINITY)}}}},p.abortCurrentFrag=function(){var h=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,h!=null&&h.loader&&h.loader.abort(),this.state){case ot:case Tt:case dt:case Ft:case Qt:this.state=je}this.nextLoadPosition=this.getLoadPosition()},p.flushMainBuffer=function(h,y){w.prototype.flushMainBuffer.call(this,h,y,this.altAudio?"video":null)},p.onMediaAttached=function(h,y){w.prototype.onMediaAttached.call(this,h,y);var T=y.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),T.addEventListener("playing",this.onvplaying),T.addEventListener("seeked",this.onvseeked),this.gapController=new qr(this.config,T,this.fragmentTracker,this.hls)},p.onMediaDetaching=function(){var h=this.media;h&&this.onvplaying&&this.onvseeked&&(h.removeEventListener("playing",this.onvplaying),h.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),w.prototype.onMediaDetaching.call(this)},p.onMediaPlaying=function(){this.tick()},p.onMediaSeeked=function(){var h=this.media,y=h?h.currentTime:null;(0,B.isFiniteNumber)(y)&&this.log("Media seeked to "+y.toFixed(3)),this.tick()},p.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},p.onManifestParsed=function(h,y){var T,L,A,M=!1,oe=!1;y.levels.forEach(function(fe){(T=fe.audioCodec)&&(T.indexOf("mp4a.40.2")!==-1&&(M=!0),T.indexOf("mp4a.40.5")!==-1&&(oe=!0))}),this.audioCodecSwitch=M&&oe&&typeof((A=dr())==null||(L=A.prototype)===null||L===void 0?void 0:L.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=y.levels,this.startFragRequested=!1},p.onLevelLoading=function(h,y){var T=this.levels;if(T&&this.state===je){var L=T[y.level];(!L.details||L.details.live&&this.levelLastLoaded!==y.level||this.waitForCdnTuneIn(L.details))&&(this.state=Vt)}},p.onLevelLoaded=function(h,y){var T,L=this.levels,A=y.level,M=y.details,oe=M.totalduration;if(L){this.log("Level "+A+" loaded ["+M.startSN+","+M.endSN+"], cc ["+M.startCC+", "+M.endCC+"] duration:"+oe);var fe=this.fragCurrent;!fe||this.state!==Tt&&this.state!==dt||fe.level!==y.level&&fe.loader&&(this.state=je,this.backtrackFragment=null,fe.loader.abort());var Se=L[A],Ce=0;if(M.live||(T=Se.details)!==null&&T!==void 0&&T.live){if(M.fragments[0]||(M.deltaUpdateFailed=!0),M.deltaUpdateFailed)return;Ce=this.alignPlaylists(M,Se.details)}if(Se.details=M,this.levelLastLoaded=A,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:M,level:A}),this.state===Vt){if(this.waitForCdnTuneIn(M))return;this.state=je}this.startFragRequested?M.live&&this.synchronizeToLiveEdge(M):this.setStartPosition(M,Ce),this.tick()}else this.warn("Levels were reset while loading level "+A)},p._handleFragmentLoadProgress=function(h){var y,T=h.frag,L=h.part,A=h.payload,M=this.levels;if(M){var oe=M[T.level],fe=oe.details;if(fe){var Se=oe.videoCodec,Ce=fe.PTSKnown||!fe.live,Ie=(y=T.initSegment)===null||y===void 0?void 0:y.data,ft=this._getAudioCodec(oe),nt=this.transmuxer=this.transmuxer||new Pr(this.hls,G.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Ye=L?L.index:-1,Je=Ye!==-1,et=new Le(T.level,T.sn,T.stats.chunkCount,A.byteLength,Ye,Je),He=this.initPTS[T.cc];nt.push(A,Ie,ft,Se,T,L,fe.totalduration,Ce,et,He)}else this.warn("Dropping fragment "+T.sn+" of level "+T.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+T.sn+" of level "+T.level+" will not be buffered")},p.onAudioTrackSwitching=function(h,y){var T=this.altAudio,L=!!y.url,A=y.id;if(!L){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var M=this.fragCurrent;M!=null&&M.loader&&(this.log("Switching to main audio track, cancel main fragment load"),M.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var oe=this.hls;T&&oe.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),oe.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:A})}},p.onAudioTrackSwitched=function(h,y){var T=y.id,L=!!this.hls.audioTracks[T].url;if(L){var A=this.videoBuffer;A&&this.mediaBuffer!==A&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=A)}this.altAudio=L,this.tick()},p.onBufferCreated=function(h,y){var T,L,A=y.tracks,M=!1;for(var oe in A){var fe=A[oe];if(fe.id==="main"){if(L=oe,T=fe,oe==="video"){var Se=A[oe];Se&&(this.videoBuffer=Se.buffer)}}else M=!0}M&&T?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=T.buffer):this.mediaBuffer=this.media},p.onFragBuffered=function(h,y){var T=y.frag,L=y.part;if(!T||T.type===G.PlaylistLevelType.MAIN){if(this.fragContextChanged(T))return this.warn("Fragment "+T.sn+(L?" p: "+L.index:"")+" of level "+T.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Qt&&(this.state=je));var A=L?L.stats:T.stats;this.fragLastKbps=Math.round(8*A.total/(A.buffering.end-A.loading.first)),T.sn!=="initSegment"&&(this.fragPrevious=T),this.fragBufferedComplete(T,L)}},p.onError=function(h,y){switch(y.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.PlaylistLevelType.MAIN,y);break;case P.ErrorDetails.LEVEL_LOAD_ERROR:case P.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==mt&&(y.fatal?(this.warn(""+y.details),this.state=mt):y.levelRetry||this.state!==Vt||(this.state=je));break;case P.ErrorDetails.BUFFER_FULL_ERROR:if(y.parent==="main"&&(this.state===Ft||this.state===Qt)){var T=!0,L=this.getFwdBufferInfo(this.media,G.PlaylistLevelType.MAIN);L&&L.len>.5&&(T=!this.reduceMaxBufferLength(L.len)),T&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},p.checkBuffer=function(){var h=this.media,y=this.gapController;if(h&&y&&h.readyState){if(this.loadedmetadata||!ve.getBuffered(h).length){var T=this.state!==je?this.fragCurrent:null;y.poll(this.lastCurrentTime,T)}this.lastCurrentTime=h.currentTime}},p.onFragLoadEmergencyAborted=function(){this.state=je,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},p.onBufferFlushed=function(h,y){var T=y.type;if(T!==ne.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var L=(T===ne.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(L,T,G.PlaylistLevelType.MAIN)}},p.onLevelsUpdated=function(h,y){this.levels=y.levels},p.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},p.seekToStartPos=function(){var h=this.media;if(h){var y=h.currentTime,T=this.startPosition;if(T>=0&&y<T){if(h.seeking)return void this.log("could not seek to "+T+", already seeking at "+y);var L=ve.getBuffered(h),A=(L.length?L.start(0):0)-T;A>0&&(A<this.config.maxBufferHole||A<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+A+" to match buffer start"),T+=A,this.startPosition=T),this.log("seek to target start position "+T+" from current time "+y),h.currentTime=T}}},p._getAudioCodec=function(h){var y=this.config.defaultAudioCodec||h.audioCodec;return this.audioCodecSwap&&y&&(this.log("Swapping audio codec"),y=y.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),y},p._loadBitrateTestFrag=function(h){var y=this;h.bitrateTest=!0,this._doFragLoad(h).then(function(T){var L=y.hls;if(T&&!L.nextLoadLevel&&!y.fragContextChanged(h)){y.fragLoadError=0,y.state=je,y.startFragRequested=!1,y.bitrateTest=!1;var A=h.stats;A.parsing.start=A.parsing.end=A.buffering.start=A.buffering.end=self.performance.now(),L.trigger(c.Events.FRAG_LOADED,T),h.bitrateTest=!1}})},p._handleTransmuxComplete=function(h){var y,T="main",L=this.hls,A=h.remuxResult,M=h.chunkMeta,oe=this.getCurrentContext(M);if(!oe)return this.warn("The loading context changed while buffering fragment "+M.sn+" of level "+M.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(M.level);var fe=oe.frag,Se=oe.part,Ce=oe.level,Ie=A.video,ft=A.text,nt=A.id3,Ye=A.initSegment,Je=Ce.details,et=this.altAudio?void 0:A.audio;if(!this.fragContextChanged(fe)){if(this.state=Ft,Ye){Ye.tracks&&(this._bufferInitSegment(Ce,Ye.tracks,fe,M),L.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:fe,id:T,tracks:Ye.tracks}));var He=Ye.initPTS,at=Ye.timescale;(0,B.isFiniteNumber)(He)&&(this.initPTS[fe.cc]=He,L.trigger(c.Events.INIT_PTS_FOUND,{frag:fe,id:T,initPTS:He,timescale:at}))}if(Ie&&A.independent!==!1){if(Je){var Rt=Ie.startPTS,$t=Ie.endPTS,Ct=Ie.startDTS,qt=Ie.endDTS;if(Se)Se.elementaryStreams[Ie.type]={startPTS:Rt,endPTS:$t,startDTS:Ct,endDTS:qt};else if(Ie.firstKeyFrame&&Ie.independent&&(this.couldBacktrack=!0),Ie.dropped&&Ie.independent){var or=this.getMainFwdBufferInfo();if((or?or.end:this.getLoadPosition())+this.config.maxBufferHole<(Ie.firstKeyFramePTS?Ie.firstKeyFramePTS:Rt)-this.config.maxBufferHole)return void this.backtrack(fe);fe.setElementaryStreamInfo(Ie.type,fe.start,$t,fe.start,qt,!0)}fe.setElementaryStreamInfo(Ie.type,Rt,$t,Ct,qt),this.backtrackFragment&&(this.backtrackFragment=fe),this.bufferFragmentData(Ie,fe,Se,M)}}else if(A.independent===!1)return void this.backtrack(fe);if(et){var Bt=et.startPTS,Mt=et.endPTS,nr=et.startDTS,pr=et.endDTS;Se&&(Se.elementaryStreams[ne.ElementaryStreamTypes.AUDIO]={startPTS:Bt,endPTS:Mt,startDTS:nr,endDTS:pr}),fe.setElementaryStreamInfo(ne.ElementaryStreamTypes.AUDIO,Bt,Mt,nr,pr),this.bufferFragmentData(et,fe,Se,M)}if(Je&&nt!=null&&(y=nt.samples)!==null&&y!==void 0&&y.length){var br={id:T,frag:fe,details:Je,samples:nt.samples};L.trigger(c.Events.FRAG_PARSING_METADATA,br)}if(Je&&ft){var Lr={id:T,frag:fe,details:Je,samples:ft.samples};L.trigger(c.Events.FRAG_PARSING_USERDATA,Lr)}}},p._bufferInitSegment=function(h,y,T,L){var A=this;if(this.state===Ft){this.audioOnly=!!y.audio&&!y.video,this.altAudio&&!this.audioOnly&&delete y.audio;var M=y.audio,oe=y.video,fe=y.audiovideo;if(M){var Se=h.audioCodec,Ce=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(Se&&(Se=Se.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),M.metadata.channelCount!==1&&Ce.indexOf("firefox")===-1&&(Se="mp4a.40.5")),Ce.indexOf("android")!==-1&&M.container!=="audio/mpeg"&&(Se="mp4a.40.2",this.log("Android: force audio codec to "+Se)),h.audioCodec&&h.audioCodec!==Se&&this.log('Swapping manifest audio codec "'+h.audioCodec+'" for "'+Se+'"'),M.levelCodec=Se,M.id="main",this.log("Init audio buffer, container:"+M.container+", codecs[selected/level/parsed]=["+(Se||"")+"/"+(h.audioCodec||"")+"/"+M.codec+"]")}oe&&(oe.levelCodec=h.videoCodec,oe.id="main",this.log("Init video buffer, container:"+oe.container+", codecs[level/parsed]=["+(h.videoCodec||"")+"/"+oe.codec+"]")),fe&&this.log("Init audiovideo buffer, container:"+fe.container+", codecs[level/parsed]=["+(h.attrs.CODECS||"")+"/"+fe.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,y),Object.keys(y).forEach(function(Ie){var ft=y[Ie].initSegment;ft!=null&&ft.byteLength&&A.hls.trigger(c.Events.BUFFER_APPENDING,{type:Ie,data:ft,frag:T,part:null,chunkMeta:L,parent:T.type})}),this.tick()}},p.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.PlaylistLevelType.MAIN)},p.backtrack=function(h){this.couldBacktrack=!0,this.backtrackFragment=h,this.resetTransmuxer(),this.flushBufferGap(h),this.fragmentTracker.removeFragment(h),this.fragPrevious=null,this.nextLoadPosition=h.start,this.state=je},p.checkFragmentChanged=function(){var h=this.media,y=null;if(h&&h.readyState>1&&h.seeking===!1){var T=h.currentTime;if(ve.isBuffered(h,T)?y=this.getAppendedFrag(T):ve.isBuffered(h,T+.1)&&(y=this.getAppendedFrag(T+.1)),y){this.backtrackFragment=null;var L=this.fragPlaying,A=y.level;L&&y.sn===L.sn&&L.level===A&&y.urlId===L.urlId||(this.hls.trigger(c.Events.FRAG_CHANGED,{frag:y}),L&&L.level===A||this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:A}),this.fragPlaying=y)}}},g=l,(m=[{key:"nextLevel",get:function(){var h=this.nextBufferedFrag;return h?h.level:-1}},{key:"currentFrag",get:function(){var h=this.media;return h?this.fragPlaying||this.getAppendedFrag(h.currentTime):null}},{key:"currentProgramDateTime",get:function(){var h=this.media;if(h){var y=h.currentTime,T=this.currentFrag;if(T&&(0,B.isFiniteNumber)(y)&&(0,B.isFiniteNumber)(T.programDateTime)){var L=T.programDateTime+1e3*(y-T.start);return new Date(L)}}return null}},{key:"currentLevel",get:function(){var h=this.currentFrag;return h?h.level:-1}},{key:"nextBufferedFrag",get:function(){var h=this.currentFrag;return h?this.followingBufferedFrag(h):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&$r(g.prototype,m),Object.defineProperty(g,"prototype",{writable:!1}),l}(bt);const Nr=function(){function w(o,l,g){l===void 0&&(l=0),g===void 0&&(g=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=o,this.alpha_=o?Math.exp(Math.log(.5)/o):0,this.estimate_=l,this.totalWeight_=g}var b=w.prototype;return b.sample=function(o,l){var g=Math.pow(this.alpha_,o);this.estimate_=l*(1-g)+g*this.estimate_,this.totalWeight_+=o},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var o=1-Math.pow(this.alpha_,this.totalWeight_);if(o)return this.estimate_/o}return this.estimate_},w}(),xr=function(){function w(o,l,g){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=g,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Nr(o),this.fast_=new Nr(l)}var b=w.prototype;return b.update=function(o,l){var g=this.slow_,m=this.fast_;this.slow_.halfLife!==o&&(this.slow_=new Nr(o,g.getEstimate(),g.getTotalWeight())),this.fast_.halfLife!==l&&(this.fast_=new Nr(l,m.getEstimate(),m.getTotalWeight()))},b.sample=function(o,l){var g=(o=Math.max(o,this.minDelayMs_))/1e3,m=8*l/g;this.fast_.sample(g,m),this.slow_.sample(g,m)},b.canEstimate=function(){var o=this.fast_;return o&&o.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},w}();function Jr(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}const kr=function(){function w(g){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=g;var m=g.config;this.bwEstimator=new xr(m.abrEwmaSlowVoD,m.abrEwmaFastVoD,m.abrEwmaDefaultEstimate),this.registerListeners()}var b,o,l=w.prototype;return l.registerListeners=function(){var g=this.hls;g.on(c.Events.FRAG_LOADING,this.onFragLoading,this),g.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(c.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var g=this.hls;g.off(c.Events.FRAG_LOADING,this.onFragLoading,this),g.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(c.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(g,m){var p,h=m.frag;h.type===G.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=h,this.partCurrent=(p=m.part)!=null?p:null,this.timer=self.setInterval(this.onCheck,100)))},l.onLevelLoaded=function(g,m){var p=this.hls.config;m.details.live?this.bwEstimator.update(p.abrEwmaSlowLive,p.abrEwmaFastLive):this.bwEstimator.update(p.abrEwmaSlowVoD,p.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var g=this.fragCurrent,m=this.partCurrent,p=this.hls,h=p.autoLevelEnabled,y=(p.config,p.media);if(g&&y){var T=m?m.stats:g.stats,L=m?m.duration:g.duration;if(T.aborted||T.loaded&&T.loaded===T.total||g.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(h&&!y.paused&&y.playbackRate&&y.readyState){var A=p.mainForwardBufferInfo;if(A!==null){var M=performance.now()-T.loading.start,oe=Math.abs(y.playbackRate);if(!(M<=500*L/oe)){var fe=T.loaded&&T.loading.first,Se=this.bwEstimator.getEstimate(),Ce=p.levels,Ie=p.minAutoLevel,ft=Ce[g.level],nt=T.total||Math.max(T.loaded,Math.round(L*ft.maxBitrate/8)),Ye=fe?1e3*T.loaded/M:0,Je=Ye?(nt-T.loaded)/Ye:8*nt/Se,et=A.len/oe;if(!(Je<=et)){var He,at=Number.POSITIVE_INFINITY;for(He=g.level-1;He>Ie;He--){var Rt=Ce[He].maxBitrate;if((at=Ye?L*Rt/(6.4*Ye):L*Rt/Se)<et)break}at>=Je||(_.logger.warn("Fragment "+g.sn+(m?" part "+m.index:"")+" of level "+g.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+He+`
      Current BW estimate: `+((0,B.isFiniteNumber)(Se)?(Se/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+Je.toFixed(3)+` s
      Estimated load time for the next fragment: `+at.toFixed(3)+` s
      Time to underbuffer: `+et.toFixed(3)+" s"),p.nextLoadLevel=He,fe&&this.bwEstimator.sample(M,T.loaded),this.clearTimer(),g.loader&&(this.fragCurrent=this.partCurrent=null,g.loader.abort()),p.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:g,part:m,stats:T}))}}}}}},l.onFragLoaded=function(g,m){var p=m.frag,h=m.part;if(p.type===G.PlaylistLevelType.MAIN&&(0,B.isFiniteNumber)(p.sn)){var y=h?h.stats:p.stats,T=h?h.duration:p.duration;if(this.clearTimer(),this.lastLoadedFragLevel=p.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var L=this.hls.levels[p.level],A=(L.loaded?L.loaded.bytes:0)+y.loaded,M=(L.loaded?L.loaded.duration:0)+T;L.loaded={bytes:A,duration:M},L.realBitrate=Math.round(8*A/M)}if(p.bitrateTest){var oe={stats:y,frag:p,part:h,id:p.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,oe)}}},l.onFragBuffered=function(g,m){var p=m.frag,h=m.part,y=h?h.stats:p.stats;if(!y.aborted&&p.type===G.PlaylistLevelType.MAIN&&p.sn!=="initSegment"){var T=y.parsing.end-y.loading.start;this.bwEstimator.sample(T,y.loaded),y.bwEstimate=this.bwEstimator.getEstimate(),p.bitrateTest?this.bitrateTestDelay=T/1e3:this.bitrateTestDelay=0}},l.onError=function(g,m){switch(m.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var g=this.fragCurrent,m=this.partCurrent,p=this.hls,h=p.maxAutoLevel,y=p.config,T=p.minAutoLevel,L=p.media,A=m?m.duration:g?g.duration:0,M=(L&&L.currentTime,L&&L.playbackRate!==0?Math.abs(L.playbackRate):1),oe=this.bwEstimator?this.bwEstimator.getEstimate():y.abrEwmaDefaultEstimate,fe=p.mainForwardBufferInfo,Se=(fe?fe.len:0)/M,Ce=this.findBestLevel(oe,T,h,Se,y.abrBandWidthFactor,y.abrBandWidthUpFactor);if(Ce>=0)return Ce;_.logger.trace((Se?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var Ie=A?Math.min(A,y.maxStarvationDelay):y.maxStarvationDelay,ft=y.abrBandWidthFactor,nt=y.abrBandWidthUpFactor;if(!Se){var Ye=this.bitrateTestDelay;Ye&&(Ie=(A?Math.min(A,y.maxLoadingDelay):y.maxLoadingDelay)-Ye,_.logger.trace("bitrate test took "+Math.round(1e3*Ye)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*Ie)+" ms"),ft=nt=1)}return Ce=this.findBestLevel(oe,T,h,Se+Ie,ft,nt),Math.max(Ce,0)},l.findBestLevel=function(g,m,p,h,y,T){for(var L,A=this.fragCurrent,M=this.partCurrent,oe=this.lastLoadedFragLevel,fe=this.hls.levels,Se=fe[oe],Ce=!(Se==null||(L=Se.details)===null||L===void 0||!L.live),Ie=Se==null?void 0:Se.codecSet,ft=M?M.duration:A?A.duration:0,nt=p;nt>=m;nt--){var Ye=fe[nt];if(Ye&&(!Ie||Ye.codecSet===Ie)){var Je,et=Ye.details,He=(M?et==null?void 0:et.partTarget:et==null?void 0:et.averagetargetduration)||ft;Je=nt<=oe?y*g:T*g;var at=fe[nt].maxBitrate,Rt=at*He/Je;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+nt+"/"+Math.round(Je)+"/"+at+"/"+He+"/"+h+"/"+Rt),Je>at&&(Rt===0||!(0,B.isFiniteNumber)(Rt)||Ce&&!this.bitrateTestDelay||Rt<h))return nt}}return-1},b=w,(o=[{key:"nextAutoLevel",get:function(){var g=this._nextAutoLevel,m=this.bwEstimator;if(g!==-1&&!m.canEstimate())return g;var p=this.getNextABRAutoLevel();return g!==-1&&this.hls.levels[p].loadError?g:(g!==-1&&(p=Math.min(g,p)),p)},set:function(g){this._nextAutoLevel=g}}])&&Jr(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}();var wr=X(514),ri=X.n(wr),ci=function(){function w(o){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=o}var b=w.prototype;return b.append=function(o,l){var g=this.queues[l];g.push(o),g.length===1&&this.buffers[l]&&this.executeNext(l)},b.insertAbort=function(o,l){this.queues[l].unshift(o),this.executeNext(l)},b.appendBlocker=function(o){var l,g=new Promise(function(p){l=p}),m={execute:l,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(m,o),g},b.executeNext=function(o){var l=this.buffers,g=this.queues,m=l[o],p=g[o];if(p.length){var h=p[0];try{h.execute()}catch(y){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(y),m&&m.updating||(p.shift(),this.executeNext(o))}}},b.shiftAndExecuteNext=function(o){this.queues[o].shift(),this.executeNext(o)},b.current=function(o){return this.queues[o][0]},w}(),Or=zt(),Ii=/([ha]vc.)(?:\.[^.,]+)+/,ii=function(){function w(o){var l=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var g=l.hls,m=l.media,p=l.mediaSource;_.logger.log("[buffer-controller]: Media source opened"),m&&(l.updateMediaElementDuration(),g.trigger(c.Events.MEDIA_ATTACHED,{media:m})),p&&p.removeEventListener("sourceopen",l._onMediaSourceOpen),l.checkPendingTracks()},this._onMediaSourceClose=function(){_.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){_.logger.log("[buffer-controller]: Media source ended")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var b=w.prototype;return b.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},b.destroy=function(){this.unregisterListeners(),this.details=null},b.registerListeners=function(){var o=this.hls;o.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(c.Events.BUFFER_RESET,this.onBufferReset,this),o.on(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.on(c.Events.BUFFER_EOS,this.onBufferEos,this),o.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.on(c.Events.FRAG_PARSED,this.onFragParsed,this),o.on(c.Events.FRAG_CHANGED,this.onFragChanged,this)},b.unregisterListeners=function(){var o=this.hls;o.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(c.Events.BUFFER_RESET,this.onBufferReset,this),o.off(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.off(c.Events.BUFFER_EOS,this.onBufferEos,this),o.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.off(c.Events.FRAG_PARSED,this.onFragParsed,this),o.off(c.Events.FRAG_CHANGED,this.onFragChanged,this)},b._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new ci(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},b.onManifestParsed=function(o,l){var g=2;(l.audio&&!l.video||!l.altAudio)&&(g=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=g,this.details=null,_.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},b.onMediaAttaching=function(o,l){var g=this.media=l.media;if(g&&Or){var m=this.mediaSource=new Or;m.addEventListener("sourceopen",this._onMediaSourceOpen),m.addEventListener("sourceended",this._onMediaSourceEnded),m.addEventListener("sourceclose",this._onMediaSourceClose),g.src=self.URL.createObjectURL(m),this._objectUrl=g.src}},b.onMediaDetaching=function(){var o=this.media,l=this.mediaSource,g=this._objectUrl;if(l){if(_.logger.log("[buffer-controller]: media source detaching"),l.readyState==="open")try{l.endOfStream()}catch(m){_.logger.warn("[buffer-controller]: onMediaDetaching: "+m.message+" while calling endOfStream")}this.onBufferReset(),l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),o&&(g&&self.URL.revokeObjectURL(g),o.src===g?(o.removeAttribute("src"),o.load()):_.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.Events.MEDIA_DETACHED,void 0)},b.onBufferReset=function(){var o=this;this.getSourceBufferTypes().forEach(function(l){var g=o.sourceBuffer[l];try{g&&(o.removeBufferListeners(l),o.mediaSource&&o.mediaSource.removeSourceBuffer(g),o.sourceBuffer[l]=void 0)}catch(m){_.logger.warn("[buffer-controller]: Failed to reset the "+l+" buffer",m)}}),this._initSourceBuffer()},b.onBufferCodecs=function(o,l){var g=this,m=this.getSourceBufferTypes().length;Object.keys(l).forEach(function(p){if(m){var h=g.tracks[p];if(h&&typeof h.buffer.changeType=="function"){var y=l[p],T=y.id,L=y.codec,A=y.levelCodec,M=y.container,oe=y.metadata,fe=(h.levelCodec||h.codec).replace(Ii,"$1"),Se=(A||L).replace(Ii,"$1");if(fe!==Se){var Ce=M+";codecs="+(A||L);g.appendChangeType(p,Ce),_.logger.log("[buffer-controller]: switching codec "+fe+" to "+Se),g.tracks[p]={buffer:h.buffer,codec:L,container:M,levelCodec:A,metadata:oe,id:T}}}}else g.pendingTracks[p]=l[p]}),m||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},b.appendChangeType=function(o,l){var g=this,m=this.operationQueue,p={execute:function(){var h=g.sourceBuffer[o];h&&(_.logger.log("[buffer-controller]: changing "+o+" sourceBuffer type to "+l),h.changeType(l)),m.shiftAndExecuteNext(o)},onStart:function(){},onComplete:function(){},onError:function(h){_.logger.warn("[buffer-controller]: Failed to change "+o+" SourceBuffer type",h)}};m.append(p,o)},b.onBufferAppending=function(o,l){var g=this,m=this.hls,p=this.operationQueue,h=this.tracks,y=l.data,T=l.type,L=l.frag,A=l.part,M=l.chunkMeta,oe=M.buffering[T],fe=self.performance.now();oe.start=fe;var Se=L.stats.buffering,Ce=A?A.stats.buffering:null;Se.start===0&&(Se.start=fe),Ce&&Ce.start===0&&(Ce.start=fe);var Ie=h.audio,ft=T==="audio"&&M.id===1&&(Ie==null?void 0:Ie.container)==="audio/mpeg",nt={execute:function(){if(oe.executeStart=self.performance.now(),ft){var Ye=g.sourceBuffer[T];if(Ye){var Je=L.start-Ye.timestampOffset;Math.abs(Je)>=.1&&(_.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+L.start+" (delta: "+Je+") sn: "+L.sn+")"),Ye.timestampOffset=L.start)}}g.appendExecutor(y,T)},onStart:function(){},onComplete:function(){var Ye=self.performance.now();oe.executeEnd=oe.end=Ye,Se.first===0&&(Se.first=Ye),Ce&&Ce.first===0&&(Ce.first=Ye);var Je=g.sourceBuffer,et={};for(var He in Je)et[He]=ve.getBuffered(Je[He]);g.appendError=0,g.hls.trigger(c.Events.BUFFER_APPENDED,{type:T,frag:L,part:A,chunkMeta:M,parent:L.type,timeRanges:et})},onError:function(Ye){_.logger.error("[buffer-controller]: Error encountered while trying to append to the "+T+" SourceBuffer",Ye);var Je={type:P.ErrorTypes.MEDIA_ERROR,parent:L.type,details:P.ErrorDetails.BUFFER_APPEND_ERROR,err:Ye,fatal:!1};Ye.code===DOMException.QUOTA_EXCEEDED_ERR?Je.details=P.ErrorDetails.BUFFER_FULL_ERROR:(g.appendError++,Je.details=P.ErrorDetails.BUFFER_APPEND_ERROR,g.appendError>m.config.appendErrorMaxRetry&&(_.logger.error("[buffer-controller]: Failed "+m.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),Je.fatal=!0,m.stopLoad())),m.trigger(c.Events.ERROR,Je)}};p.append(nt,T)},b.onBufferFlushing=function(o,l){var g=this,m=this.operationQueue,p=function(h){return{execute:g.removeExecutor.bind(g,h,l.startOffset,l.endOffset),onStart:function(){},onComplete:function(){g.hls.trigger(c.Events.BUFFER_FLUSHED,{type:h})},onError:function(y){_.logger.warn("[buffer-controller]: Failed to remove from "+h+" SourceBuffer",y)}}};l.type?m.append(p(l.type),l.type):this.getSourceBufferTypes().forEach(function(h){m.append(p(h),h)})},b.onFragParsed=function(o,l){var g=this,m=l.frag,p=l.part,h=[],y=p?p.elementaryStreams:m.elementaryStreams;y[ne.ElementaryStreamTypes.AUDIOVIDEO]?h.push("audiovideo"):(y[ne.ElementaryStreamTypes.AUDIO]&&h.push("audio"),y[ne.ElementaryStreamTypes.VIDEO]&&h.push("video")),h.length===0&&_.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+m.type+" level: "+m.level+" sn: "+m.sn),this.blockBuffers(function(){var T=self.performance.now();m.stats.buffering.end=T,p&&(p.stats.buffering.end=T);var L=p?p.stats:m.stats;g.hls.trigger(c.Events.FRAG_BUFFERED,{frag:m,part:p,stats:L,id:m.type})},h)},b.onFragChanged=function(o,l){this.flushBackBuffer()},b.onBufferEos=function(o,l){var g=this;this.getSourceBufferTypes().reduce(function(m,p){var h=g.sourceBuffer[p];return l.type&&l.type!==p||h&&!h.ended&&(h.ended=!0,_.logger.log("[buffer-controller]: "+p+" sourceBuffer now EOS")),m&&!(h&&!h.ended)},!0)&&this.blockBuffers(function(){var m=g.mediaSource;m&&m.readyState==="open"&&m.endOfStream()})},b.onLevelUpdated=function(o,l){var g=l.details;g.fragments.length&&(this.details=g,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},b.flushBackBuffer=function(){var o=this.hls,l=this.details,g=this.media,m=this.sourceBuffer;if(g&&l!==null){var p=this.getSourceBufferTypes();if(p.length){var h=l.live&&o.config.liveBackBufferLength!==null?o.config.liveBackBufferLength:o.config.backBufferLength;if((0,B.isFiniteNumber)(h)&&!(h<0)){var y=g.currentTime,T=l.levelTargetDuration,L=Math.max(h,T),A=Math.floor(y/T)*T-L;p.forEach(function(M){var oe=m[M];if(oe){var fe=ve.getBuffered(oe);fe.length>0&&A>fe.start(0)&&(o.trigger(c.Events.BACK_BUFFER_REACHED,{bufferEnd:A}),l.live&&o.trigger(c.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:A}),o.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:A,type:M}))}})}}}},b.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var o=this.details,l=this.hls,g=this.media,m=this.mediaSource,p=o.fragments[0].start+o.totalduration,h=g.duration,y=(0,B.isFiniteNumber)(m.duration)?m.duration:0;o.live&&l.config.liveDurationInfinity?(_.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),m.duration=1/0,this.updateSeekableRange(o)):(p>y&&p>h||!(0,B.isFiniteNumber)(h))&&(_.logger.log("[buffer-controller]: Updating Media Source duration to "+p.toFixed(3)),m.duration=p)}},b.updateSeekableRange=function(o){var l=this.mediaSource,g=o.fragments;if(g.length&&o.live&&l!=null&&l.setLiveSeekableRange){var m=Math.max(0,g[0].start),p=Math.max(m,m+o.totalduration);l.setLiveSeekableRange(m,p)}},b.checkPendingTracks=function(){var o=this.bufferCodecEventsExpected,l=this.operationQueue,g=this.pendingTracks,m=Object.keys(g).length;if(m&&!o||m===2){this.createSourceBuffers(g),this.pendingTracks={};var p=this.getSourceBufferTypes();if(p.length===0)return void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});p.forEach(function(h){l.executeNext(h)})}},b.createSourceBuffers=function(o){var l=this.sourceBuffer,g=this.mediaSource;if(!g)throw Error("createSourceBuffers called when mediaSource was null");var m=0;for(var p in o)if(!l[p]){var h=o[p];if(!h)throw Error("source buffer exists for track "+p+", however track does not");var y=h.levelCodec||h.codec,T=h.container+";codecs="+y;_.logger.log("[buffer-controller]: creating sourceBuffer("+T+")");try{var L=l[p]=g.addSourceBuffer(T),A=p;this.addBufferListener(A,"updatestart",this._onSBUpdateStart),this.addBufferListener(A,"updateend",this._onSBUpdateEnd),this.addBufferListener(A,"error",this._onSBUpdateError),this.tracks[p]={buffer:L,codec:y,container:h.container,levelCodec:h.levelCodec,metadata:h.metadata,id:h.id},m++}catch(M){_.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+M.message),this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:M,mimeType:T})}}m&&this.hls.trigger(c.Events.BUFFER_CREATED,{tracks:this.tracks})},b._onSBUpdateStart=function(o){this.operationQueue.current(o).onStart()},b._onSBUpdateEnd=function(o){var l=this.operationQueue;l.current(o).onComplete(),l.shiftAndExecuteNext(o)},b._onSBUpdateError=function(o,l){_.logger.error("[buffer-controller]: "+o+" SourceBuffer error",l),this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var g=this.operationQueue.current(o);g&&g.onError(l)},b.removeExecutor=function(o,l,g){var m=this.media,p=this.mediaSource,h=this.operationQueue,y=this.sourceBuffer[o];if(!m||!p||!y)return _.logger.warn("[buffer-controller]: Attempting to remove from the "+o+" SourceBuffer, but it does not exist"),void h.shiftAndExecuteNext(o);var T=(0,B.isFiniteNumber)(m.duration)?m.duration:1/0,L=(0,B.isFiniteNumber)(p.duration)?p.duration:1/0,A=Math.max(0,l),M=Math.min(g,T,L);M>A?(_.logger.log("[buffer-controller]: Removing ["+A+","+M+"] from the "+o+" SourceBuffer"),y.remove(A,M)):h.shiftAndExecuteNext(o)},b.appendExecutor=function(o,l){var g=this.operationQueue,m=this.sourceBuffer[l];if(!m)return _.logger.warn("[buffer-controller]: Attempting to append to the "+l+" SourceBuffer, but it does not exist"),void g.shiftAndExecuteNext(l);m.ended=!1,m.appendBuffer(o)},b.blockBuffers=function(o,l){var g=this;if(l===void 0&&(l=this.getSourceBufferTypes()),!l.length)return _.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(o);var m=this.operationQueue,p=l.map(function(h){return m.appendBlocker(h)});Promise.all(p).then(function(){o(),l.forEach(function(h){var y=g.sourceBuffer[h];y&&y.updating||m.shiftAndExecuteNext(h)})})},b.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},b.addBufferListener=function(o,l,g){var m=this.sourceBuffer[o];if(m){var p=g.bind(this,o);this.listeners[o].push({event:l,listener:p}),m.addEventListener(l,p)}},b.removeBufferListeners=function(o){var l=this.sourceBuffer[o];l&&this.listeners[o].forEach(function(g){l.removeEventListener(g.event,g.listener)})},w}();function Oi(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}const bi=function(){function w(g){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=g,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b,o,l=w.prototype;return l.setStreamController=function(g){this.streamController=g},l.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},l.registerListeners=function(){var g=this.hls;g.on(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},l.unregisterListener=function(){var g=this.hls;g.off(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},l.onFpsDropLevelCapping=function(g,m){w.isLevelAllowed(m.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(m.droppedLevel)},l.onMediaAttaching=function(g,m){this.media=m.media instanceof HTMLVideoElement?m.media:null},l.onManifestParsed=function(g,m){var p=this.hls;this.restrictedLevels=[],this.firstLevel=m.firstLevel,p.config.capLevelToPlayerSize&&m.video&&this.startCapping()},l.onBufferCodecs=function(g,m){this.hls.config.capLevelToPlayerSize&&m.video&&this.startCapping()},l.onMediaDetaching=function(){this.stopCapping()},l.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var m=this.hls;m.autoLevelCapping=this.getMaxLevel(g.length-1),m.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=m.autoLevelCapping}}},l.getMaxLevel=function(g){var m=this,p=this.hls.levels;if(!p.length)return-1;var h=p.filter(function(y,T){return w.isLevelAllowed(T,m.restrictedLevels)&&T<=g});return this.clientRect=null,w.getMaxLevelByMediaSize(h,this.mediaWidth,this.mediaHeight)},l.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},l.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},l.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,m={width:0,height:0};if(g){var p=g.getBoundingClientRect();m.width=p.width,m.height=p.height,m.width||m.height||(m.width=p.right-p.left||g.width||0,m.height=p.bottom-p.top||g.height||0)}return this.clientRect=m,m},w.isLevelAllowed=function(g,m){return m===void 0&&(m=[]),m.indexOf(g)===-1},w.getMaxLevelByMediaSize=function(g,m,p){if(!g||!g.length)return-1;for(var h,y,T=g.length-1,L=0;L<g.length;L+=1){var A=g[L];if((A.width>=m||A.height>=p)&&(h=A,!(y=g[L+1])||h.width!==y.width||h.height!==y.height)){T=L;break}}return T},b=w,(o=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch(m){}return g}}])&&Oi(b.prototype,o),Object.defineProperty(b,"prototype",{writable:!1}),w}(),gi=function(){function w(o){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=o,this.registerListeners()}var b=w.prototype;return b.setStreamController=function(o){this.streamController=o},b.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(o,l){var g=this.hls.config;if(g.capLevelOnFPSDrop){var m=l.media instanceof self.HTMLVideoElement?l.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),g.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(o,l,g){var m=performance.now();if(l){if(this.lastTime){var p=m-this.lastTime,h=g-this.lastDroppedFrames,y=l-this.lastDecodedFrames,T=1e3*h/p,L=this.hls;if(L.trigger(c.Events.FPS_DROP,{currentDropped:h,currentDecoded:y,totalDroppedFrames:g}),T>0&&h>L.config.fpsDroppedMonitoringThreshold*y){var A=L.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+A),A>0&&(L.autoLevelCapping===-1||L.autoLevelCapping>=A)&&(A-=1,L.trigger(c.Events.FPS_DROP_LEVEL_CAPPING,{level:A,droppedLevel:L.currentLevel}),L.autoLevelCapping=A,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=g,this.lastDecodedFrames=l}},b.checkFPSInterval=function(){var o=this.media;if(o)if(this.isVideoPlaybackQualityAvailable){var l=o.getVideoPlaybackQuality();this.checkFPS(o,l.totalVideoFrames,l.droppedVideoFrames)}else this.checkFPS(o,o.webkitDecodedFrameCount,o.webkitDroppedFrameCount)},w}();var vi=X(408),Xr=/^age:\s*[\d.]+\s*$/m;const pi=function(){function w(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new vi.LoadStats,this.retryDelay=0}var b=w.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},b.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(o,l,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=l,this.callbacks=g,this.retryDelay=l.retryDelay,this.loadInternal()},b.loadInternal=function(){var o=this.config,l=this.context;if(o){var g=this.loader=new self.XMLHttpRequest,m=this.stats;m.loading.first=0,m.loaded=0;var p=this.xhrSetup;try{if(p)try{p(g,l.url)}catch(T){g.open("GET",l.url,!0),p(g,l.url)}g.readyState||g.open("GET",l.url,!0);var h=this.context.headers;if(h)for(var y in h)g.setRequestHeader(y,h[y])}catch(T){return void this.callbacks.onError({code:g.status,text:T.message},l,g)}l.rangeEnd&&g.setRequestHeader("Range","bytes="+l.rangeStart+"-"+(l.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=l.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),g.send()}},b.readystatechange=function(){var o=this.context,l=this.loader,g=this.stats;if(o&&l){var m=l.readyState,p=this.config;if(!g.aborted&&m>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),m===4){l.onreadystatechange=null,l.onprogress=null;var h=l.status,y=l.responseType==="arraybuffer";if(h>=200&&h<300&&(y&&l.response||l.responseText!==null)){var T,L;if(g.loading.end=Math.max(self.performance.now(),g.loading.first),L=y?(T=l.response).byteLength:(T=l.responseText).length,g.loaded=g.total=L,!this.callbacks)return;var A=this.callbacks.onProgress;if(A&&A(g,o,T,l),!this.callbacks)return;var M={url:l.responseURL,data:T};this.callbacks.onSuccess(M,g,o,l)}else g.retry>=p.maxRetry||h>=400&&h<499?(_.logger.error(h+" while loading "+o.url),this.callbacks.onError({code:h,text:l.statusText},o,l)):(_.logger.warn(h+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},b.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(o){var l=this.stats;l.loaded=o.loaded,o.lengthComputable&&(l.total=o.total)},b.getCacheAge=function(){var o=null;if(this.loader&&Xr.test(this.loader.getAllResponseHeaders())){var l=this.loader.getResponseHeader("age");o=l?parseFloat(l):null}return o},w}();var Li=function(){function w(){this.chunks=[],this.dataLength=0}var b=w.prototype;return b.push=function(o){this.chunks.push(o),this.dataLength+=o.length},b.flush=function(){var o,l=this.chunks,g=this.dataLength;return l.length?(o=l.length===1?l[0]:function(m,p){for(var h=new Uint8Array(p),y=0,T=0;T<m.length;T++){var L=m[T];h.set(L,y),y+=L.length}return h}(l,g),this.reset(),o):new Uint8Array(0)},b.reset=function(){this.chunks.length=0,this.dataLength=0},w}();function Di(w){var b=typeof Map=="function"?new Map:void 0;return Di=function(o){if(o===null||(l=o,Function.toString.call(l).indexOf("[native code]")===-1))return o;var l;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(b!==void 0){if(b.has(o))return b.get(o);b.set(o,g)}function g(){return mi(o,arguments,yi(this).constructor)}return g.prototype=Object.create(o.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),Dr(g,o)},Di(w)}function mi(w,b,o){return mi=ni()?Reflect.construct.bind():function(l,g,m){var p=[null];p.push.apply(p,g);var h=new(Function.bind.apply(l,p));return m&&Dr(h,m.prototype),h},mi.apply(null,arguments)}function ni(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(w){return!1}}function Dr(w,b){return Dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},Dr(w,b)}function yi(w){return yi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(b){return b.__proto__||Object.getPrototypeOf(b)},yi(w)}function Zr(){return Zr=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(w[l]=o[l])}return w},Zr.apply(this,arguments)}var Pi=function(){function w(o){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=o.fetchSetup||Fi,this.controller=new self.AbortController,this.stats=new vi.LoadStats}var b=w.prototype;return b.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},b.abortInternal=function(){var o=this.response;o&&o.ok||(this.stats.aborted=!0,this.controller.abort())},b.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},b.load=function(o,l,g){var m=this,p=this.stats;if(p.loading.start)throw new Error("Loader can only be used once.");p.loading.start=self.performance.now();var h=function(A,M){var oe={method:"GET",mode:"cors",credentials:"same-origin",signal:M,headers:new self.Headers(Zr({},A.headers))};return A.rangeEnd&&oe.headers.set("Range","bytes="+A.rangeStart+"-"+String(A.rangeEnd-1)),oe}(o,this.controller.signal),y=g.onProgress,T=o.responseType==="arraybuffer",L=T?"byteLength":"length";this.context=o,this.config=l,this.callbacks=g,this.request=this.fetchSetup(o,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){m.abortInternal(),g.onTimeout(p,o,m.response)},l.timeout),self.fetch(this.request).then(function(A){if(m.response=m.loader=A,!A.ok){var M=A.status,oe=A.statusText;throw new Mi(oe||"fetch, bad network response",M,A)}return p.loading.first=Math.max(self.performance.now(),p.loading.start),p.total=parseInt(A.headers.get("Content-Length")||"0"),y&&(0,B.isFiniteNumber)(l.highWaterMark)?m.loadProgressively(A,p,o,l.highWaterMark,y):T?A.arrayBuffer():A.text()}).then(function(A){var M=m.response;self.clearTimeout(m.requestTimeout),p.loading.end=Math.max(self.performance.now(),p.loading.first),p.loaded=p.total=A[L];var oe={url:M.url,data:A};y&&!(0,B.isFiniteNumber)(l.highWaterMark)&&y(p,o,A,M),g.onSuccess(oe,p,o,M)}).catch(function(A){if(self.clearTimeout(m.requestTimeout),!p.aborted){var M=A&&A.code||0,oe=A?A.message:null;g.onError({code:M,text:oe},o,A?A.details:null)}})},b.getCacheAge=function(){var o=null;if(this.response){var l=this.response.headers.get("age");o=l?parseFloat(l):null}return o},b.loadProgressively=function(o,l,g,m,p){m===void 0&&(m=0);var h=new Li,y=o.body.getReader();return function T(){return y.read().then(function(L){if(L.done)return h.dataLength&&p(l,g,h.flush(),o),Promise.resolve(new ArrayBuffer(0));var A=L.value,M=A.length;return l.loaded+=M,M<m||h.dataLength?(h.push(A),h.dataLength>=m&&p(l,g,h.flush(),o)):p(l,g,A,o),T()}).catch(function(){return Promise.reject()})}()},w}();function Fi(w,b){return new self.Request(w.url,b)}var Mi=function(w){var b,o;function l(g,m,p){var h;return(h=w.call(this,g)||this).code=void 0,h.details=void 0,h.code=m,h.details=p,h}return o=w,(b=l).prototype=Object.create(o.prototype),b.prototype.constructor=b,Dr(b,o),l}(Di(Error));const ei=Pi;var ai;(function(w){w.WIDEVINE="com.widevine.alpha",w.PLAYREADY="com.microsoft.playready"})(ai||(ai={}));var Ni=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Ut(){return Ut=Object.assign?Object.assign.bind():function(w){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(w[l]=o[l])}return w},Ut.apply(this,arguments)}function Ji(w,b){var o=Object.keys(w);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(w);b&&(l=l.filter(function(g){return Object.getOwnPropertyDescriptor(w,g).enumerable})),o.push.apply(o,l)}return o}function Ui(w){for(var b=1;b<arguments.length;b++){var o=arguments[b]!=null?arguments[b]:{};b%2?Ji(Object(o),!0).forEach(function(l){Zi(w,l,o[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(o)):Ji(Object(o)).forEach(function(l){Object.defineProperty(w,l,Object.getOwnPropertyDescriptor(o,l))})}return w}function Zi(w,b,o){return b in w?Object.defineProperty(w,b,{value:o,enumerable:!0,configurable:!0,writable:!0}):w[b]=o,w}var an=Ui(Ui({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:pi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:kr,bufferController:ii,capLevelController:bi,fpsController:gi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ni,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:ri(),enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0});function Bi(w,b){for(var o=0;o<b.length;o++){var l=b[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(w,l.key,l)}}var Gi=function(){function w(m){m===void 0&&(m={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Rr.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var p=this.config=function(He,at){if((at.liveSyncDurationCount||at.liveMaxLatencyDurationCount)&&(at.liveSyncDuration||at.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(at.liveMaxLatencyDurationCount!==void 0&&(at.liveSyncDurationCount===void 0||at.liveMaxLatencyDurationCount<=at.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(at.liveMaxLatencyDuration!==void 0&&(at.liveSyncDuration===void 0||at.liveMaxLatencyDuration<=at.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return Ut({},He,at)}(w.DefaultConfig,m);this.userConfig=m,(0,_.enableLogs)(p.debug,"Hls instance"),this._autoLevelCapping=-1,p.progressive&&function(He){var at=He.loader;at!==ei&&at!==pi?(_.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),He.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(Rt){}return!1}()&&(He.loader=ei,He.progressive=!0,He.enableSoftwareAES=!0,_.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(p);var h=p.abrController,y=p.bufferController,T=p.capLevelController,L=p.fpsController,A=this.abrController=new h(this),M=this.bufferController=new y(this),oe=this.capLevelController=new T(this),fe=new L(this),Se=new Ge(this),Ce=new qe(this),Ie=new vt(this),ft=this.levelController=new ye(this),nt=new ae(this),Ye=this.streamController=new Kr(this,nt);oe.setStreamController(Ye),fe.setStreamController(Ye);var Je=[Se,Ce,ft,Ye];this.networkControllers=Je;var et=[A,M,oe,fe,Ie,nt];this.audioTrackController=this.createController(p.audioTrackController,null,Je),this.createController(p.audioStreamController,nt,Je),this.subtitleTrackController=this.createController(p.subtitleTrackController,null,Je),this.createController(p.subtitleStreamController,nt,Je),this.createController(p.timelineController,null,et),this.emeController=this.createController(p.emeController,null,et),this.cmcdController=this.createController(p.cmcdController,null,et),this.latencyController=this.createController(At,null,et),this.coreComponents=et}w.isSupported=function(){return function(){var m=zt();if(!m)return!1;var p=dr(),h=m&&typeof m.isTypeSupported=="function"&&m.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),y=!p||p.prototype&&typeof p.prototype.appendBuffer=="function"&&typeof p.prototype.remove=="function";return!!h&&!!y}()};var b,o,l,g=w.prototype;return g.createController=function(m,p,h){if(m){var y=p?new m(this,p):new m(this);return h&&h.push(y),y}return null},g.on=function(m,p,h){h===void 0&&(h=this),this._emitter.on(m,p,h)},g.once=function(m,p,h){h===void 0&&(h=this),this._emitter.once(m,p,h)},g.removeAllListeners=function(m){this._emitter.removeAllListeners(m)},g.off=function(m,p,h,y){h===void 0&&(h=this),this._emitter.off(m,p,h,y)},g.listeners=function(m){return this._emitter.listeners(m)},g.emit=function(m,p,h){return this._emitter.emit(m,p,h)},g.trigger=function(m,p){if(this.config.debug)return this.emit(m,m,p);try{return this.emit(m,m,p)}catch(h){_.logger.error("An internal error happened while handling event "+m+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(c.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:m,error:h})}return!1},g.listenerCount=function(m){return this._emitter.listenerCount(m)},g.destroy=function(){_.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(m){return m.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(m){return m.destroy()}),this.coreComponents.length=0},g.attachMedia=function(m){_.logger.log("attachMedia"),this._media=m,this.trigger(c.Events.MEDIA_ATTACHING,{media:m})},g.detachMedia=function(){_.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},g.loadSource=function(m){this.stopLoad();var p=this.media,h=this.url,y=this.url=ie.buildAbsoluteURL(self.location.href,m,{alwaysNormalize:!0});_.logger.log("loadSource:"+y),p&&h&&h!==y&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(p)),this.trigger(c.Events.MANIFEST_LOADING,{url:m})},g.startLoad=function(m){m===void 0&&(m=-1),_.logger.log("startLoad("+m+")"),this.networkControllers.forEach(function(p){p.startLoad(m)})},g.stopLoad=function(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(m){m.stopLoad()})},g.swapAudioCodec=function(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},g.recoverMediaError=function(){_.logger.log("recoverMediaError");var m=this._media;this.detachMedia(),m&&this.attachMedia(m)},g.removeLevel=function(m,p){p===void 0&&(p=0),this.levelController.removeLevel(m,p)},b=w,l=[{key:"version",get:function(){return"1.2.7"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return P.ErrorTypes}},{key:"ErrorDetails",get:function(){return P.ErrorDetails}},{key:"DefaultConfig",get:function(){return w.defaultConfig?w.defaultConfig:an},set:function(m){w.defaultConfig=m}}],(o=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(m){_.logger.log("set currentLevel:"+m),this.loadLevel=m,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(m){_.logger.log("set nextLevel:"+m),this.levelController.manualLevel=m,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(m){_.logger.log("set loadLevel:"+m),this.levelController.manualLevel=m}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(m){this.levelController.nextLoadLevel=m}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(m){_.logger.log("set firstLevel:"+m),this.levelController.firstLevel=m}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(m){_.logger.log("set startLevel:"+m),m!==-1&&(m=Math.max(m,this.minAutoLevel)),this.levelController.startLevel=m}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(m){var p=!!m;p!==this.config.capLevelToPlayerSize&&(p?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=p)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(m){this._autoLevelCapping!==m&&(_.logger.log("set autoLevelCapping:"+m),this._autoLevelCapping=m)}},{key:"bandwidthEstimate",get:function(){var m=this.abrController.bwEstimator;return m?m.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var m=this.levels,p=this.config.minAutoBitrate;if(!m)return 0;for(var h=m.length,y=0;y<h;y++)if(m[y].maxBitrate>=p)return y;return 0}},{key:"maxAutoLevel",get:function(){var m=this.levels,p=this.autoLevelCapping;return p===-1&&m&&m.length?m.length-1:p}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(m){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,m)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var m=this.audioTrackController;return m?m.audioTracks:[]}},{key:"audioTrack",get:function(){var m=this.audioTrackController;return m?m.audioTrack:-1},set:function(m){var p=this.audioTrackController;p&&(p.audioTrack=m)}},{key:"subtitleTracks",get:function(){var m=this.subtitleTrackController;return m?m.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var m=this.subtitleTrackController;return m?m.subtitleTrack:-1},set:function(m){var p=this.subtitleTrackController;p&&(p.subtitleTrack=m)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var m=this.subtitleTrackController;return!!m&&m.subtitleDisplay},set:function(m){var p=this.subtitleTrackController;p&&(p.subtitleDisplay=m)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(m){this.config.lowLatencyMode=m}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Bi(b.prototype,o),l&&Bi(b,l),Object.defineProperty(b,"prototype",{writable:!1}),w}();Gi.defaultConfig=void 0},923:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{BaseSegment:()=>re,ElementaryStreamTypes:()=>Ee,Fragment:()=>de,Part:()=>Q});var Ee,ie=X(965),B=X(945),c=X(93),P=X(960),_=X(408);function se(ne,le){ne.prototype=Object.create(le.prototype),ne.prototype.constructor=ne,z(ne,le)}function z(ne,le){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Re,Te){return Re.__proto__=Te,Re},z(ne,le)}function K(ne,le){for(var Re=0;Re<le.length;Re++){var Te=le[Re];Te.enumerable=Te.enumerable||!1,Te.configurable=!0,"value"in Te&&(Te.writable=!0),Object.defineProperty(ne,Te.key,Te)}}function te(ne,le,Re){return le&&K(ne.prototype,le),Re&&K(ne,Re),Object.defineProperty(ne,"prototype",{writable:!1}),ne}(function(ne){ne.AUDIO="audio",ne.VIDEO="video",ne.AUDIOVIDEO="audiovideo"})(Ee||(Ee={}));var re=function(){function ne(le){var Re;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((Re={})[Ee.AUDIO]=null,Re[Ee.VIDEO]=null,Re[Ee.AUDIOVIDEO]=null,Re),this.baseurl=le}return ne.prototype.setByteRange=function(le,Re){var Te=le.split("@",2),Pe=[];Te.length===1?Pe[0]=Re?Re.byteRangeEndOffset:0:Pe[0]=parseInt(Te[1]),Pe[1]=parseInt(Te[0])+Pe[0],this._byteRange=Pe},te(ne,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,B.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(le){this._url=le}}]),ne}(),de=function(ne){function le(Te,Pe){var F;return(F=ne.call(this,Pe)||this)._decryptdata=null,F.rawProgramDateTime=null,F.programDateTime=null,F.tagList=[],F.duration=0,F.sn=0,F.levelkey=void 0,F.type=void 0,F.loader=null,F.level=-1,F.cc=0,F.startPTS=void 0,F.endPTS=void 0,F.appendedPTS=void 0,F.startDTS=void 0,F.endDTS=void 0,F.start=0,F.deltaPTS=void 0,F.maxStartPTS=void 0,F.minEndPTS=void 0,F.stats=new _.LoadStats,F.urlId=0,F.data=void 0,F.bitrateTest=!1,F.title=null,F.initSegment=null,F.type=Te,F}se(le,ne);var Re=le.prototype;return Re.createInitializationVector=function(Te){for(var Pe=new Uint8Array(16),F=12;F<16;F++)Pe[F]=Te>>8*(15-F)&255;return Pe},Re.setDecryptDataFromLevelKey=function(Te,Pe){var F=Te;return(Te==null?void 0:Te.method)==="AES-128"&&Te.uri&&!Te.iv&&((F=P.LevelKey.fromURI(Te.uri)).method=Te.method,F.iv=this.createInitializationVector(Pe),F.keyFormat="identity"),F},Re.setElementaryStreamInfo=function(Te,Pe,F,k,W,H){H===void 0&&(H=!1);var Ae=this.elementaryStreams,_e=Ae[Te];_e?(_e.startPTS=Math.min(_e.startPTS,Pe),_e.endPTS=Math.max(_e.endPTS,F),_e.startDTS=Math.min(_e.startDTS,k),_e.endDTS=Math.max(_e.endDTS,W)):Ae[Te]={startPTS:Pe,endPTS:F,startDTS:k,endDTS:W,partial:H}},Re.clearElementaryStreamInfo=function(){var Te=this.elementaryStreams;Te[Ee.AUDIO]=null,Te[Ee.VIDEO]=null,Te[Ee.AUDIOVIDEO]=null},te(le,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var Te=this.sn;typeof Te!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),Te=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,Te)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,ie.isFiniteNumber)(this.programDateTime))return null;var Te=(0,ie.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*Te}},{key:"encrypted",get:function(){var Te;return!((Te=this.decryptdata)===null||Te===void 0||!Te.keyFormat||!this.decryptdata.uri)}}]),le}(re),Q=function(ne){function le(Re,Te,Pe,F,k){var W;(W=ne.call(this,Pe)||this).fragOffset=0,W.duration=0,W.gap=!1,W.independent=!1,W.relurl=void 0,W.fragment=void 0,W.index=void 0,W.stats=new _.LoadStats,W.duration=Re.decimalFloatingPoint("DURATION"),W.gap=Re.bool("GAP"),W.independent=Re.bool("INDEPENDENT"),W.relurl=Re.enumeratedString("URI"),W.fragment=Te,W.index=F;var H=Re.enumeratedString("BYTERANGE");return H&&W.setByteRange(H,k),k&&(W.fragOffset=k.fragOffset+k.duration),W}return se(le,ne),te(le,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var Re=this.elementaryStreams;return!!(Re.audio||Re.video||Re.audiovideo)}}]),le}(re)},960:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{LevelKey:()=>B});var Ee=X(945);function ie(c,P){for(var _=0;_<P.length;_++){var se=P[_];se.enumerable=se.enumerable||!1,se.configurable=!0,"value"in se&&(se.writable=!0),Object.defineProperty(c,se.key,se)}}var B=function(){function c(se,z){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=z?(0,Ee.buildAbsoluteURL)(se,z,{alwaysNormalize:!0}):se}var P,_;return c.fromURL=function(se,z){return new c(se,z)},c.fromURI=function(se){return new c(se)},P=c,(_=[{key:"uri",get:function(){return this._uri}}])&&ie(P.prototype,_),Object.defineProperty(P,"prototype",{writable:!1}),c}()},408:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{LoadStats:()=>Ee});var Ee=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{MAX_SAFE_INTEGER:()=>ie,isFiniteNumber:()=>Ee});var Ee=Number.isFinite||function(B){return typeof B=="number"&&isFinite(B)},ie=Number.MAX_SAFE_INTEGER||9007199254740991},856:(ht,Oe,X)=>{"use strict";var Ee;X.r(Oe),X.d(Oe,{MetadataSchema:()=>Ee}),function(ie){ie.audioId3="org.id3",ie.dateRange="com.apple.quicktime.HLS",ie.emsg="https://aomedia.org/emsg/ID3"}(Ee||(Ee={}))},308:(ht,Oe,X)=>{"use strict";var Ee,ie;X.r(Oe),X.d(Oe,{PlaylistContextType:()=>Ee,PlaylistLevelType:()=>ie}),function(B){B.MANIFEST="manifest",B.LEVEL="level",B.AUDIO_TRACK="audioTrack",B.SUBTITLE_TRACK="subtitleTrack"}(Ee||(Ee={})),function(B){B.MAIN="main",B.AUDIO="audio",B.SUBTITLE="subtitle"}(ie||(ie={}))},93:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{enableLogs:()=>P,logger:()=>_});var Ee=function(){},ie={trace:Ee,debug:Ee,log:Ee,warn:Ee,info:Ee,error:Ee},B=ie;function c(se){var z=self.console[se];return z?z.bind(self.console,"["+se+"] >"):Ee}function P(se,z){if(self.console&&se===!0||typeof se=="object"){(function(K){for(var te=arguments.length,re=new Array(te>1?te-1:0),de=1;de<te;de++)re[de-1]=arguments[de];re.forEach(function(Q){B[Q]=K[Q]?K[Q].bind(K):c(Q)})})(se,"debug","log","info","warn","error");try{B.log('Debug logs enabled for "'+z+'"')}catch(K){B=ie}}else B=ie}var _=ie},63:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{RemuxerTrackIdConfig:()=>_,appendUint8Array:()=>k,bin2str:()=>se,computeRawDurationFromSamples:()=>Te,discardEPB:()=>_e,findBox:()=>de,getDuration:()=>Re,getStartDTS:()=>le,offsetStartDTS:()=>Pe,parseEmsg:()=>we,parseInitSegment:()=>ne,parseSEIMessageFromNALu:()=>Ae,parseSamples:()=>W,parseSegmentIndex:()=>Q,readSint32:()=>te,readUint16:()=>z,readUint32:()=>K,segmentValidRange:()=>F,writeUint32:()=>re});var Ee=X(145),ie=X(923),B=X(181),c=Math.pow(2,32)-1,P=[].push,_={video:1,audio:2,id3:3,text:4};function se(U){return String.fromCharCode.apply(null,U)}function z(U,ue){var Z=U[ue]<<8|U[ue+1];return Z<0?65536+Z:Z}function K(U,ue){var Z=te(U,ue);return Z<0?4294967296+Z:Z}function te(U,ue){return U[ue]<<24|U[ue+1]<<16|U[ue+2]<<8|U[ue+3]}function re(U,ue,Z){U[ue]=Z>>24,U[ue+1]=Z>>16&255,U[ue+2]=Z>>8&255,U[ue+3]=255&Z}function de(U,ue){var Z=[];if(!ue.length)return Z;for(var he=U.byteLength,G=0;G<he;){var xe=K(U,G),Ge=xe>1?G+xe:he;if(se(U.subarray(G+4,G+8))===ue[0])if(ue.length===1)Z.push(U.subarray(G+8,Ge));else{var qe=de(U.subarray(G+8,Ge),ue.slice(1));qe.length&&P.apply(Z,qe)}G=Ge}return Z}function Q(U){var ue=[],Z=U[0],he=8,G=K(U,he);he+=4,he+=Z===0?8:16,he+=2;var xe=U.length+0,Ge=z(U,he);he+=2;for(var qe=0;qe<Ge;qe++){var it=he,me=K(U,it);it+=4;var Ze=2147483647&me;if((2147483648&me)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var st=K(U,it);it+=4,ue.push({referenceSize:Ze,subsegmentDuration:st,info:{duration:st/G,start:xe,end:xe+Ze-1}}),xe+=Ze,he=it+=4}return{earliestPresentationTime:0,timescale:G,version:Z,referencesCount:Ge,references:ue}}function ne(U){for(var ue=[],Z=de(U,["moov","trak"]),he=0;he<Z.length;he++){var G=Z[he],xe=de(G,["tkhd"])[0];if(xe){var Ge=xe[0],qe=Ge===0?12:20,it=K(xe,qe),me=de(G,["mdia","mdhd"])[0];if(me){var Ze=K(me,qe=(Ge=me[0])===0?12:20),st=de(G,["mdia","hdlr"])[0];if(st){var Et=se(st.subarray(8,12)),lt={soun:ie.ElementaryStreamTypes.AUDIO,vide:ie.ElementaryStreamTypes.VIDEO}[Et];if(lt){var vt=de(G,["mdia","minf","stbl","stsd"])[0],St=void 0;vt&&(St=se(vt.subarray(12,16))),ue[it]={timescale:Ze,type:lt},ue[lt]={timescale:Ze,id:it,codec:St}}}}}}return de(U,["moov","mvex","trex"]).forEach(function(gt){var At=K(gt,4),Lt=ue[At];Lt&&(Lt.default={duration:K(gt,12),flags:K(gt,20)})}),ue}function le(U,ue){return de(ue,["moof","traf"]).reduce(function(Z,he){var G=de(he,["tfdt"])[0],xe=G[0],Ge=de(he,["tfhd"]).reduce(function(qe,it){var me=K(it,4),Ze=U[me];if(Ze){var st=K(G,4);xe===1&&(st*=Math.pow(2,32),st+=K(G,8));var Et=st/(Ze.timescale||9e4);if(isFinite(Et)&&(qe===null||Et<qe))return Et}return qe},null);return Ge!==null&&isFinite(Ge)&&(Z===null||Ge<Z)?Ge:Z},null)||0}function Re(U,ue){for(var Z=0,he=0,G=0,xe=de(U,["moof","traf"]),Ge=0;Ge<xe.length;Ge++){var qe=xe[Ge],it=de(qe,["tfhd"])[0],me=ue[K(it,4)];if(me){var Ze=me.default,st=K(it,0)|(Ze==null?void 0:Ze.flags),Et=Ze==null?void 0:Ze.duration;8&st&&(Et=K(it,2&st?12:8));for(var lt=me.timescale||9e4,vt=de(qe,["trun"]),St=0;St<vt.length;St++)!(Z=Te(vt[St]))&&Et&&(Z=Et*K(vt[St],4)),me.type===ie.ElementaryStreamTypes.VIDEO?he+=Z/lt:me.type===ie.ElementaryStreamTypes.AUDIO&&(G+=Z/lt)}}if(he===0&&G===0){for(var gt=0,At=de(U,["sidx"]),Lt=0;Lt<At.length;Lt++){var yt=Q(At[Lt]);yt!=null&&yt.references&&(gt+=yt.references.reduce(function(Ot,_t){return Ot+_t.info.duration||0},0))}return gt}return he||G}function Te(U){var ue=K(U,0),Z=8;1&ue&&(Z+=4),4&ue&&(Z+=4);for(var he=0,G=K(U,4),xe=0;xe<G;xe++)256&ue&&(he+=K(U,Z),Z+=4),512&ue&&(Z+=4),1024&ue&&(Z+=4),2048&ue&&(Z+=4);return he}function Pe(U,ue,Z){de(ue,["moof","traf"]).forEach(function(he){de(he,["tfhd"]).forEach(function(G){var xe=K(G,4),Ge=U[xe];if(Ge){var qe=Ge.timescale||9e4;de(he,["tfdt"]).forEach(function(it){var me=it[0],Ze=K(it,4);if(me===0)Ze-=Z*qe,re(it,4,Ze=Math.max(Ze,0));else{Ze*=Math.pow(2,32),Ze+=K(it,8),Ze-=Z*qe,Ze=Math.max(Ze,0);var st=Math.floor(Ze/(c+1)),Et=Math.floor(Ze%(c+1));re(it,4,st),re(it,8,Et)}})}})})}function F(U){var ue={valid:null,remainder:null},Z=de(U,["moof"]);if(!Z)return ue;if(Z.length<2)return ue.remainder=U,ue;var he=Z[Z.length-1];return ue.valid=(0,Ee.sliceUint8)(U,0,he.byteOffset-8),ue.remainder=(0,Ee.sliceUint8)(U,he.byteOffset-8),ue}function k(U,ue){var Z=new Uint8Array(U.length+ue.length);return Z.set(U),Z.set(ue,U.length),Z}function W(U,ue){var Z=[],he=ue.samples,G=ue.timescale,xe=ue.id,Ge=!1;return de(he,["moof"]).map(function(qe){var it=qe.byteOffset-8;de(qe,["traf"]).map(function(me){var Ze=de(me,["tfdt"]).map(function(st){var Et=st[0],lt=K(st,4);return Et===1&&(lt*=Math.pow(2,32),lt+=K(st,8)),lt/G})[0];return Ze!==void 0&&(U=Ze),de(me,["tfhd"]).map(function(st){var Et=K(st,4),lt=16777215&K(st,0),vt=0,St=(16&lt)!=0,gt=0,At=(32&lt)!=0,Lt=8;Et===xe&&((1&lt)!=0&&(Lt+=8),(2&lt)!=0&&(Lt+=4),(8&lt)!=0&&(vt=K(st,Lt),Lt+=4),St&&(gt=K(st,Lt),Lt+=4),At&&(Lt+=4),ue.type==="video"&&(Ge=function(yt){if(!yt)return!1;var Ot=yt.indexOf("."),_t=Ot<0?yt:yt.substring(0,Ot);return _t==="hvc1"||_t==="hev1"||_t==="dvh1"||_t==="dvhe"}(ue.codec)),de(me,["trun"]).map(function(yt){var Ot=yt[0],_t=16777215&K(yt,0),Jt=(1&_t)!=0,Gt=0,wt=(4&_t)!=0,tr=(256&_t)!=0,Zt=0,rr=(512&_t)!=0,lr=0,ur=(1024&_t)!=0,hr=(2048&_t)!=0,Xt=0,sr=K(yt,4),ye=8;Jt&&(Gt=K(yt,ye),ye+=4),wt&&(ye+=4);for(var ae=Gt+it,x=0;x<sr;x++){if(tr?(Zt=K(yt,ye),ye+=4):Zt=vt,rr?(lr=K(yt,ye),ye+=4):lr=gt,ur&&(ye+=4),hr&&(Xt=Ot===0?K(yt,ye):te(yt,ye),ye+=4),ue.type===ie.ElementaryStreamTypes.VIDEO)for(var ee=0;ee<lr;){var $=K(he,ae);H(Ge,he[ae+=4])&&Ae(he.subarray(ae,ae+$),Ge?2:1,U+Xt/G,Z),ae+=$,ee+=$+4}U+=Zt/G}}))})})}),Z}function H(U,ue){if(U){var Z=ue>>1&63;return Z===39||Z===40}return(31&ue)==6}function Ae(U,ue,Z,he){var G=_e(U),xe=0;xe+=ue;for(var Ge=0,qe=0,it=!1,me=0;xe<G.length;){Ge=0;do{if(xe>=G.length)break;Ge+=me=G[xe++]}while(me===255);qe=0;do{if(xe>=G.length)break;qe+=me=G[xe++]}while(me===255);var Ze=G.length-xe;if(!it&&Ge===4&&xe<G.length){if(it=!0,G[xe++]===181){var st=z(G,xe);if(xe+=2,st===49){var Et=K(G,xe);if(xe+=4,Et===1195456820){var lt=G[xe++];if(lt===3){var vt=G[xe++],St=64&vt,gt=St?2+3*(31&vt):0,At=new Uint8Array(gt);if(St){At[0]=vt;for(var Lt=1;Lt<gt;Lt++)At[Lt]=G[xe++]}he.push({type:lt,payloadType:Ge,pts:Z,bytes:At})}}}}}else if(Ge===5&&qe<Ze){if(it=!0,qe>16){for(var yt=[],Ot=0;Ot<16;Ot++){var _t=G[xe++].toString(16);yt.push(_t.length==1?"0"+_t:_t),Ot!==3&&Ot!==5&&Ot!==7&&Ot!==9||yt.push("-")}for(var Jt=qe-16,Gt=new Uint8Array(Jt),wt=0;wt<Jt;wt++)Gt[wt]=G[xe++];he.push({payloadType:Ge,pts:Z,uuid:yt.join(""),userData:(0,B.utf8ArrayToStr)(Gt),userDataBytes:Gt})}}else if(qe<Ze)xe+=qe;else if(qe>Ze)break}}function _e(U){for(var ue=U.byteLength,Z=[],he=1;he<ue-2;)U[he]===0&&U[he+1]===0&&U[he+2]===3?(Z.push(he+2),he+=2):he++;if(Z.length===0)return U;var G=ue-Z.length,xe=new Uint8Array(G),Ge=0;for(he=0;he<G;Ge++,he++)Ge===Z[0]&&(Ge++,Z.shift()),xe[he]=U[Ge];return xe}function we(U){var ue=U[0],Z="",he="",G=0,xe=0,Ge=0,qe=0,it=0,me=0;if(ue===0){for(;se(U.subarray(me,me+1))!=="\0";)Z+=se(U.subarray(me,me+1)),me+=1;for(Z+=se(U.subarray(me,me+1)),me+=1;se(U.subarray(me,me+1))!=="\0";)he+=se(U.subarray(me,me+1)),me+=1;he+=se(U.subarray(me,me+1)),me+=1,G=K(U,12),xe=K(U,16),qe=K(U,20),it=K(U,24),me=28}else if(ue===1){G=K(U,me+=4);var Ze=K(U,me+=4),st=K(U,me+=4);for(me+=4,Ge=Math.pow(2,32)*Ze+st,Number.isSafeInteger(Ge)||(Ge=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),qe=K(U,me),it=K(U,me+=4),me+=4;se(U.subarray(me,me+1))!=="\0";)Z+=se(U.subarray(me,me+1)),me+=1;for(Z+=se(U.subarray(me,me+1)),me+=1;se(U.subarray(me,me+1))!=="\0";)he+=se(U.subarray(me,me+1)),me+=1;he+=se(U.subarray(me,me+1)),me+=1}return{schemeIdUri:Z,value:he,timeScale:G,presentationTime:Ge,presentationTimeDelta:xe,eventDuration:qe,id:it,payload:U.subarray(me,U.byteLength)}}},145:(ht,Oe,X)=>{"use strict";function Ee(ie,B,c){return Uint8Array.prototype.slice?ie.slice(B,c):new Uint8Array(Array.prototype.slice.call(ie,B,c))}X.r(Oe),X.d(Oe,{sliceUint8:()=>Ee})},729:ht=>{"use strict";var Oe=Object.prototype.hasOwnProperty,X="~";function Ee(){}function ie(_,se,z){this.fn=_,this.context=se,this.once=z||!1}function B(_,se,z,K,te){if(typeof z!="function")throw new TypeError("The listener must be a function");var re=new ie(z,K||_,te),de=X?X+se:se;return _._events[de]?_._events[de].fn?_._events[de]=[_._events[de],re]:_._events[de].push(re):(_._events[de]=re,_._eventsCount++),_}function c(_,se){--_._eventsCount==0?_._events=new Ee:delete _._events[se]}function P(){this._events=new Ee,this._eventsCount=0}Object.create&&(Ee.prototype=Object.create(null),new Ee().__proto__||(X=!1)),P.prototype.eventNames=function(){var _,se,z=[];if(this._eventsCount===0)return z;for(se in _=this._events)Oe.call(_,se)&&z.push(X?se.slice(1):se);return Object.getOwnPropertySymbols?z.concat(Object.getOwnPropertySymbols(_)):z},P.prototype.listeners=function(_){var se=X?X+_:_,z=this._events[se];if(!z)return[];if(z.fn)return[z.fn];for(var K=0,te=z.length,re=new Array(te);K<te;K++)re[K]=z[K].fn;return re},P.prototype.listenerCount=function(_){var se=X?X+_:_,z=this._events[se];return z?z.fn?1:z.length:0},P.prototype.emit=function(_,se,z,K,te,re){var de=X?X+_:_;if(!this._events[de])return!1;var Q,ne,le=this._events[de],Re=arguments.length;if(le.fn){switch(le.once&&this.removeListener(_,le.fn,void 0,!0),Re){case 1:return le.fn.call(le.context),!0;case 2:return le.fn.call(le.context,se),!0;case 3:return le.fn.call(le.context,se,z),!0;case 4:return le.fn.call(le.context,se,z,K),!0;case 5:return le.fn.call(le.context,se,z,K,te),!0;case 6:return le.fn.call(le.context,se,z,K,te,re),!0}for(ne=1,Q=new Array(Re-1);ne<Re;ne++)Q[ne-1]=arguments[ne];le.fn.apply(le.context,Q)}else{var Te,Pe=le.length;for(ne=0;ne<Pe;ne++)switch(le[ne].once&&this.removeListener(_,le[ne].fn,void 0,!0),Re){case 1:le[ne].fn.call(le[ne].context);break;case 2:le[ne].fn.call(le[ne].context,se);break;case 3:le[ne].fn.call(le[ne].context,se,z);break;case 4:le[ne].fn.call(le[ne].context,se,z,K);break;default:if(!Q)for(Te=1,Q=new Array(Re-1);Te<Re;Te++)Q[Te-1]=arguments[Te];le[ne].fn.apply(le[ne].context,Q)}}return!0},P.prototype.on=function(_,se,z){return B(this,_,se,z,!1)},P.prototype.once=function(_,se,z){return B(this,_,se,z,!0)},P.prototype.removeListener=function(_,se,z,K){var te=X?X+_:_;if(!this._events[te])return this;if(!se)return c(this,te),this;var re=this._events[te];if(re.fn)re.fn!==se||K&&!re.once||z&&re.context!==z||c(this,te);else{for(var de=0,Q=[],ne=re.length;de<ne;de++)(re[de].fn!==se||K&&!re[de].once||z&&re[de].context!==z)&&Q.push(re[de]);Q.length?this._events[te]=Q.length===1?Q[0]:Q:c(this,te)}return this},P.prototype.removeAllListeners=function(_){var se;return _?(se=X?X+_:_,this._events[se]&&c(this,se)):(this._events=new Ee,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=X,P.EventEmitter=P,ht.exports=P},945:function(ht){var Oe,X,Ee,ie,B;Oe=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,X=/^(?=([^\/?#]*))\1([^]*)$/,Ee=/(?:\/|^)\.(?=\/)/g,ie=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,B={buildAbsoluteURL:function(c,P,_){if(_=_||{},c=c.trim(),!(P=P.trim())){if(!_.alwaysNormalize)return c;var se=B.parseURL(c);if(!se)throw new Error("Error trying to parse base URL.");return se.path=B.normalizePath(se.path),B.buildURLFromParts(se)}var z=B.parseURL(P);if(!z)throw new Error("Error trying to parse relative URL.");if(z.scheme)return _.alwaysNormalize?(z.path=B.normalizePath(z.path),B.buildURLFromParts(z)):P;var K=B.parseURL(c);if(!K)throw new Error("Error trying to parse base URL.");if(!K.netLoc&&K.path&&K.path[0]!=="/"){var te=X.exec(K.path);K.netLoc=te[1],K.path=te[2]}K.netLoc&&!K.path&&(K.path="/");var re={scheme:K.scheme,netLoc:z.netLoc,path:null,params:z.params,query:z.query,fragment:z.fragment};if(!z.netLoc&&(re.netLoc=K.netLoc,z.path[0]!=="/"))if(z.path){var de=K.path,Q=de.substring(0,de.lastIndexOf("/")+1)+z.path;re.path=B.normalizePath(Q)}else re.path=K.path,z.params||(re.params=K.params,z.query||(re.query=K.query));return re.path===null&&(re.path=_.alwaysNormalize?B.normalizePath(z.path):z.path),B.buildURLFromParts(re)},parseURL:function(c){var P=Oe.exec(c);return P?{scheme:P[1]||"",netLoc:P[2]||"",path:P[3]||"",params:P[4]||"",query:P[5]||"",fragment:P[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(Ee,"");c.length!==(c=c.replace(ie,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}},ht.exports=B}},Cr={};function cr(ht){var Oe=Cr[ht];if(Oe!==void 0)return Oe.exports;var X=Cr[ht]={exports:{}};return ti[ht].call(X.exports,X,X.exports,cr),X.exports}cr.m=ti,cr.n=ht=>{var Oe=ht&&ht.__esModule?()=>ht.default:()=>ht;return cr.d(Oe,{a:Oe}),Oe},cr.d=(ht,Oe)=>{for(var X in Oe)cr.o(Oe,X)&&!cr.o(ht,X)&&Object.defineProperty(ht,X,{enumerable:!0,get:Oe[X]})},cr.o=(ht,Oe)=>Object.prototype.hasOwnProperty.call(ht,Oe),cr.r=ht=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(ht,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ht,"__esModule",{value:!0})};var xi=cr(392);return xi.default})())},5025:function($i){typeof window!="undefined"&&function(ti,Cr){$i.exports=Cr()}(this,()=>(()=>{var ti={21:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>se});var Ee=function(){function z(K,te){this.subtle=void 0,this.aesIV=void 0,this.subtle=K,this.aesIV=te}return z.prototype.decrypt=function(K,te){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},te,K)},z}(),ie=function(){function z(K,te){this.subtle=void 0,this.key=void 0,this.subtle=K,this.key=te}return z.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},z}(),B=X(145),c=function(){function z(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=z.prototype;return K.uint8ArrayToUint32Array_=function(te){for(var re=new DataView(te),de=new Uint32Array(4),Q=0;Q<4;Q++)de[Q]=re.getUint32(4*Q);return de},K.initTable=function(){var te=this.sBox,re=this.invSBox,de=this.subMix,Q=de[0],ne=de[1],le=de[2],Re=de[3],Te=this.invSubMix,Pe=Te[0],F=Te[1],k=Te[2],W=Te[3],H=new Uint32Array(256),Ae=0,_e=0,we=0;for(we=0;we<256;we++)H[we]=we<128?we<<1:we<<1^283;for(we=0;we<256;we++){var U=_e^_e<<1^_e<<2^_e<<3^_e<<4;U=U>>>8^255&U^99,te[Ae]=U,re[U]=Ae;var ue=H[Ae],Z=H[ue],he=H[Z],G=257*H[U]^16843008*U;Q[Ae]=G<<24|G>>>8,ne[Ae]=G<<16|G>>>16,le[Ae]=G<<8|G>>>24,Re[Ae]=G,G=16843009*he^65537*Z^257*ue^16843008*Ae,Pe[U]=G<<24|G>>>8,F[U]=G<<16|G>>>16,k[U]=G<<8|G>>>24,W[U]=G,Ae?(Ae=ue^H[H[H[he^ue]]],_e^=H[H[_e]]):Ae=_e=1}},K.expandKey=function(te){for(var re=this.uint8ArrayToUint32Array_(te),de=!0,Q=0;Q<re.length&&de;)de=re[Q]===this.key[Q],Q++;if(!de){this.key=re;var ne=this.keySize=re.length;if(ne!==4&&ne!==6&&ne!==8)throw new Error("Invalid aes key size="+ne);var le,Re,Te,Pe,F=this.ksRows=4*(ne+6+1),k=this.keySchedule=new Uint32Array(F),W=this.invKeySchedule=new Uint32Array(F),H=this.sBox,Ae=this.rcon,_e=this.invSubMix,we=_e[0],U=_e[1],ue=_e[2],Z=_e[3];for(le=0;le<F;le++)le<ne?Te=k[le]=re[le]:(Pe=Te,le%ne==0?(Pe=H[(Pe=Pe<<8|Pe>>>24)>>>24]<<24|H[Pe>>>16&255]<<16|H[Pe>>>8&255]<<8|H[255&Pe],Pe^=Ae[le/ne|0]<<24):ne>6&&le%ne==4&&(Pe=H[Pe>>>24]<<24|H[Pe>>>16&255]<<16|H[Pe>>>8&255]<<8|H[255&Pe]),k[le]=Te=(k[le-ne]^Pe)>>>0);for(Re=0;Re<F;Re++)le=F-Re,Pe=3&Re?k[le]:k[le-4],W[Re]=Re<4||le<=4?Pe:we[H[Pe>>>24]]^U[H[Pe>>>16&255]]^ue[H[Pe>>>8&255]]^Z[H[255&Pe]],W[Re]=W[Re]>>>0}},K.networkToHostOrderSwap=function(te){return te<<24|(65280&te)<<8|(16711680&te)>>8|te>>>24},K.decrypt=function(te,re,de){for(var Q,ne,le,Re,Te,Pe,F,k,W,H,Ae,_e,we,U,ue=this.keySize+6,Z=this.invKeySchedule,he=this.invSBox,G=this.invSubMix,xe=G[0],Ge=G[1],qe=G[2],it=G[3],me=this.uint8ArrayToUint32Array_(de),Ze=me[0],st=me[1],Et=me[2],lt=me[3],vt=new Int32Array(te),St=new Int32Array(vt.length),gt=this.networkToHostOrderSwap;re<vt.length;){for(W=gt(vt[re]),H=gt(vt[re+1]),Ae=gt(vt[re+2]),_e=gt(vt[re+3]),Te=W^Z[0],Pe=_e^Z[1],F=Ae^Z[2],k=H^Z[3],we=4,U=1;U<ue;U++)Q=xe[Te>>>24]^Ge[Pe>>16&255]^qe[F>>8&255]^it[255&k]^Z[we],ne=xe[Pe>>>24]^Ge[F>>16&255]^qe[k>>8&255]^it[255&Te]^Z[we+1],le=xe[F>>>24]^Ge[k>>16&255]^qe[Te>>8&255]^it[255&Pe]^Z[we+2],Re=xe[k>>>24]^Ge[Te>>16&255]^qe[Pe>>8&255]^it[255&F]^Z[we+3],Te=Q,Pe=ne,F=le,k=Re,we+=4;Q=he[Te>>>24]<<24^he[Pe>>16&255]<<16^he[F>>8&255]<<8^he[255&k]^Z[we],ne=he[Pe>>>24]<<24^he[F>>16&255]<<16^he[k>>8&255]<<8^he[255&Te]^Z[we+1],le=he[F>>>24]<<24^he[k>>16&255]<<16^he[Te>>8&255]<<8^he[255&Pe]^Z[we+2],Re=he[k>>>24]<<24^he[Te>>16&255]<<16^he[Pe>>8&255]<<8^he[255&F]^Z[we+3],St[re]=gt(Q^Ze),St[re+1]=gt(Re^st),St[re+2]=gt(le^Et),St[re+3]=gt(ne^lt),Ze=W,st=H,Et=Ae,lt=_e,re+=4}return St.buffer},z}(),P=X(93),_=X(63),se=function(){function z(te,re,de){var Q=(de===void 0?{}:de).removePKCS7Padding,ne=Q===void 0||Q;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=te,this.config=re,this.removePKCS7Padding=ne,ne)try{var le=self.crypto;le&&(this.subtle=le.subtle||le.webkitSubtle)}catch(Re){}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var K=z.prototype;return K.destroy=function(){this.observer=null},K.isSync=function(){return this.config.enableSoftwareAES},K.flush=function(){var te=this.currentResult;if(te){var re,de,Q,ne=new Uint8Array(te);return this.reset(),this.removePKCS7Padding?(Q=(de=(re=ne).byteLength)&&new DataView(re.buffer).getUint8(de-1))?(0,B.sliceUint8)(re,0,de-Q):re:ne}this.reset()},K.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},K.decrypt=function(te,re,de,Q){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(te),re,de);var ne=this.flush();ne&&Q(ne.buffer)}else this.webCryptoDecrypt(new Uint8Array(te),re,de).then(Q)},K.softwareDecrypt=function(te,re,de){var Q=this.currentIV,ne=this.currentResult,le=this.remainderData;this.logOnce("JS AES decrypt"),le&&(te=(0,_.appendUint8Array)(le,te),this.remainderData=null);var Re=this.getValidChunk(te);if(!Re.length)return null;Q&&(de=Q);var Te=this.softwareDecrypter;Te||(Te=this.softwareDecrypter=new c),Te.expandKey(re);var Pe=ne;return this.currentResult=Te.decrypt(Re.buffer,0,de),this.currentIV=(0,B.sliceUint8)(Re,-16).buffer,Pe||null},K.webCryptoDecrypt=function(te,re,de){var Q=this,ne=this.subtle;return this.key===re&&this.fastAesKey||(this.key=re,this.fastAesKey=new ie(ne,re)),this.fastAesKey.expandKey().then(function(le){return ne?new Ee(ne,de).decrypt(te.buffer,le):Promise.reject(new Error("web crypto not initialized"))}).catch(function(le){return Q.onWebCryptoError(le,te,re,de)})},K.onWebCryptoError=function(te,re,de,Q){return P.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",te),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(re,de,Q)},K.getValidChunk=function(te){var re=te,de=te.length-te.length%16;return de!==te.length&&(re=(0,B.sliceUint8)(te,0,de),this.remainderData=(0,B.sliceUint8)(te,de)),re},K.logOnce=function(te){this.logEnabled&&(P.logger.log("[decrypter.ts]: "+te),this.logEnabled=!1)},z}()},181:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{canParse:()=>_,decodeFrame:()=>re,getID3Data:()=>c,getID3Frames:()=>te,getTimeStamp:()=>se,isFooter:()=>B,isHeader:()=>ie,isTimeStampFrame:()=>z,testables:()=>Te,utf8ArrayToStr:()=>Re});var Ee,ie=function(F,k){return k+10<=F.length&&F[k]===73&&F[k+1]===68&&F[k+2]===51&&F[k+3]<255&&F[k+4]<255&&F[k+6]<128&&F[k+7]<128&&F[k+8]<128&&F[k+9]<128},B=function(F,k){return k+10<=F.length&&F[k]===51&&F[k+1]===68&&F[k+2]===73&&F[k+3]<255&&F[k+4]<255&&F[k+6]<128&&F[k+7]<128&&F[k+8]<128&&F[k+9]<128},c=function(F,k){for(var W=k,H=0;ie(F,k);)H+=10,H+=P(F,k+6),B(F,k+10)&&(H+=10),k+=H;if(H>0)return F.subarray(W,W+H)},P=function(F,k){var W=0;return W=(127&F[k])<<21,W|=(127&F[k+1])<<14,(W|=(127&F[k+2])<<7)|127&F[k+3]},_=function(F,k){return ie(F,k)&&P(F,k+6)+10<=F.length-k},se=function(F){for(var k=te(F),W=0;W<k.length;W++){var H=k[W];if(z(H))return le(H)}},z=function(F){return F&&F.key==="PRIV"&&F.info==="com.apple.streaming.transportStreamTimestamp"},K=function(F){var k=String.fromCharCode(F[0],F[1],F[2],F[3]),W=P(F,4);return{type:k,size:W,data:F.subarray(10,10+W)}},te=function(F){for(var k=0,W=[];ie(F,k);){for(var H=P(F,k+6),Ae=(k+=10)+H;k+8<Ae;){var _e=K(F.subarray(k)),we=re(_e);we&&W.push(we),k+=_e.size+10}B(F,k)&&(k+=10)}return W},re=function(F){return F.type==="PRIV"?de(F):F.type[0]==="W"?ne(F):Q(F)},de=function(F){if(!(F.size<2)){var k=Re(F.data,!0),W=new Uint8Array(F.data.subarray(k.length+1));return{key:F.type,info:k,data:W.buffer}}},Q=function(F){if(!(F.size<2)){if(F.type==="TXXX"){var k=1,W=Re(F.data.subarray(k),!0);k+=W.length+1;var H=Re(F.data.subarray(k));return{key:F.type,info:W,data:H}}var Ae=Re(F.data.subarray(1));return{key:F.type,data:Ae}}},ne=function(F){if(F.type==="WXXX"){if(F.size<2)return;var k=1,W=Re(F.data.subarray(k),!0);k+=W.length+1;var H=Re(F.data.subarray(k));return{key:F.type,info:W,data:H}}var Ae=Re(F.data);return{key:F.type,data:Ae}},le=function(F){if(F.data.byteLength===8){var k=new Uint8Array(F.data),W=1&k[3],H=(k[4]<<23)+(k[5]<<15)+(k[6]<<7)+k[7];return H/=45,W&&(H+=4772185884e-2),Math.round(H)}},Re=function(F,k){k===void 0&&(k=!1);var W=Pe();if(W){var H=W.decode(F);if(k){var Ae=H.indexOf("\0");return Ae!==-1?H.substring(0,Ae):H}return H.replace(/\0/g,"")}for(var _e,we,U,ue=F.length,Z="",he=0;he<ue;){if((_e=F[he++])===0&&k)return Z;if(_e!==0&&_e!==3)switch(_e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Z+=String.fromCharCode(_e);break;case 12:case 13:we=F[he++],Z+=String.fromCharCode((31&_e)<<6|63&we);break;case 14:we=F[he++],U=F[he++],Z+=String.fromCharCode((15&_e)<<12|(63&we)<<6|(63&U)<<0)}}return Z},Te={decodeTextFrame:Q};function Pe(){return Ee||self.TextDecoder===void 0||(Ee=new self.TextDecoder("utf-8")),Ee}},182:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>P});var Ee=X(544),ie=X(851),B=X(93),c=X(729);function P(K){var te=new c.EventEmitter,re=function(de,Q){K.postMessage({event:de,data:Q})};te.on(ie.Events.FRAG_DECRYPTED,re),te.on(ie.Events.ERROR,re),K.addEventListener("message",function(de){var Q=de.data;switch(Q.cmd){case"init":var ne=JSON.parse(Q.config);K.transmuxer=new Ee.default(te,Q.typeSupported,ne,Q.vendor,Q.id),(0,B.enableLogs)(ne.debug,Q.id),function(){var Pe=function(k){B.logger[k]=function(W){re("workerLog",{logType:k,message:W})}};for(var F in B.logger)Pe(F)}(),re("init",null);break;case"configure":K.transmuxer.configure(Q.config);break;case"demux":var le=K.transmuxer.push(Q.data,Q.decryptdata,Q.chunkMeta,Q.state);(0,Ee.isPromise)(le)?le.then(function(Pe){_(K,Pe)}):_(K,le);break;case"flush":var Re=Q.chunkMeta,Te=K.transmuxer.flush(Re);(0,Ee.isPromise)(Te)?Te.then(function(Pe){z(K,Pe,Re)}):z(K,Te,Re)}})}function _(K,te){if(!((re=te.remuxResult).audio||re.video||re.text||re.id3||re.initSegment))return!1;var re,de=[],Q=te.remuxResult,ne=Q.audio,le=Q.video;return ne&&se(de,ne),le&&se(de,le),K.postMessage({event:"transmuxComplete",data:te},de),!0}function se(K,te){te.data1&&K.push(te.data1.buffer),te.data2&&K.push(te.data2.buffer)}function z(K,te,re){te.reduce(function(de,Q){return _(K,Q)||de},!1)||K.postMessage({event:"transmuxComplete",data:te[0]}),K.postMessage({event:"flush",data:re})}},544:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{TransmuxConfig:()=>Xt,TransmuxState:()=>sr,default:()=>lr,isPromise:()=>hr});var Ee=X(851),ie=X(973),B=X(21),c=X(965),P=X(181),_=X(856);function se(ye,ae){return ye===void 0&&(ye=""),ae===void 0&&(ae=9e4),{type:ye,id:-1,pid:-1,inputTimeScale:ae,sequenceNumber:-1,samples:[],dropped:0}}var z=X(63),K=X(145),te=function(){function ye(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var ae=ye.prototype;return ae.resetInitSegment=function(x,ee,$,ce){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},ae.resetTimeStamp=function(x){this.initPTS=x,this.resetContiguity()},ae.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},ae.canParse=function(x,ee){return!1},ae.appendFrame=function(x,ee,$){},ae.demux=function(x,ee){this.cachedData&&(x=(0,z.appendUint8Array)(this.cachedData,x),this.cachedData=null);var $,ce=P.getID3Data(x,0),ve=ce?ce.length:0,Le=this._audioTrack,Ne=this._id3Track,ze=ce?P.getTimeStamp(ce):void 0,Be=x.length;for((this.basePTS===null||this.frameIndex===0&&(0,c.isFiniteNumber)(ze))&&(this.basePTS=re(ze,ee,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),ce&&ce.length>0&&Ne.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ce,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});ve<Be;){if(this.canParse(x,ve)){var rt=this.appendFrame(Le,x,ve);rt?(this.frameIndex++,this.lastPTS=rt.sample.pts,$=ve+=rt.length):ve=Be}else P.canParse(x,ve)?(ce=P.getID3Data(x,ve),Ne.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ce,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),$=ve+=ce.length):ve++;if(ve===Be&&$!==Be){var pt=(0,K.sliceUint8)(x,$);this.cachedData?this.cachedData=(0,z.appendUint8Array)(this.cachedData,pt):this.cachedData=pt}}return{audioTrack:Le,videoTrack:se(),id3Track:Ne,textTrack:se()}},ae.demuxSampleAes=function(x,ee,$){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},ae.flush=function(x){var ee=this.cachedData;return ee&&(this.cachedData=null,this.demux(ee,0)),{audioTrack:this._audioTrack,videoTrack:se(),id3Track:this._id3Track,textTrack:se()}},ae.destroy=function(){},ye}(),re=function(ye,ae,x){return(0,c.isFiniteNumber)(ye)?90*ye:9e4*ae+(x||0)};const de=te;var Q=X(93);function ne(ye,ae){return ye[ae]===255&&(246&ye[ae+1])==240}function le(ye,ae){return 1&ye[ae+1]?7:9}function Re(ye,ae){return(3&ye[ae+3])<<11|ye[ae+4]<<3|(224&ye[ae+5])>>>5}function Te(ye,ae){return ae+1<ye.length&&ne(ye,ae)}function Pe(ye,ae){if(Te(ye,ae)){var x=le(ye,ae);if(ae+x>=ye.length)return!1;var ee=Re(ye,ae);if(ee<=x)return!1;var $=ae+ee;return $===ye.length||Te(ye,$)}return!1}function F(ye,ae,x,ee,$){if(!ye.samplerate){var ce=function(ve,Le,Ne,ze){var Be,rt,pt,ct,R=navigator.userAgent.toLowerCase(),I=ze,S=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Be=1+((192&Le[Ne+2])>>>6);var C=(60&Le[Ne+2])>>>2;if(!(C>S.length-1))return pt=(1&Le[Ne+2])<<2,pt|=(192&Le[Ne+3])>>>6,Q.logger.log("manifest codec:"+ze+", ADTS type:"+Be+", samplingIndex:"+C),/firefox/i.test(R)?C>=6?(Be=5,ct=new Array(4),rt=C-3):(Be=2,ct=new Array(2),rt=C):R.indexOf("android")!==-1?(Be=2,ct=new Array(2),rt=C):(Be=5,ct=new Array(4),ze&&(ze.indexOf("mp4a.40.29")!==-1||ze.indexOf("mp4a.40.5")!==-1)||!ze&&C>=6?rt=C-3:((ze&&ze.indexOf("mp4a.40.2")!==-1&&(C>=6&&pt===1||/vivaldi/i.test(R))||!ze&&pt===1)&&(Be=2,ct=new Array(2)),rt=C)),ct[0]=Be<<3,ct[0]|=(14&C)>>1,ct[1]|=(1&C)<<7,ct[1]|=pt<<3,Be===5&&(ct[1]|=(14&rt)>>1,ct[2]=(1&rt)<<7,ct[2]|=8,ct[3]=0),{config:ct,samplerate:S[C],channelCount:pt,codec:"mp4a.40."+Be,manifestCodec:I};ve.trigger(Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+C})}(ae,x,ee,$);if(!ce)return;ye.config=ce.config,ye.samplerate=ce.samplerate,ye.channelCount=ce.channelCount,ye.codec=ce.codec,ye.manifestCodec=ce.manifestCodec,Q.logger.log("parsed codec:"+ye.codec+", rate:"+ce.samplerate+", channels:"+ce.channelCount)}}function k(ye){return 9216e4/ye}function W(ye,ae,x,ee,$){var ce,ve=ee+$*k(ye.samplerate),Le=function(R,I){var S=le(R,I);if(I+S<=R.length){var C=Re(R,I)-S;if(C>0)return{headerLength:S,frameLength:C}}}(ae,x);if(Le){var Ne=Le.frameLength,ze=Le.headerLength,Be=ze+Ne,rt=Math.max(0,x+Be-ae.length);rt?(ce=new Uint8Array(Be-ze)).set(ae.subarray(x+ze,ae.length),0):ce=ae.subarray(x+ze,x+Be);var pt={unit:ce,pts:ve};return rt||ye.samples.push(pt),{sample:pt,length:Be,missing:rt}}var ct=ae.length-x;return(ce=new Uint8Array(ct)).set(ae.subarray(x,ae.length),0),{sample:{unit:ce,pts:ve},length:ct,missing:-1}}function H(ye,ae){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,ee){return x.__proto__=ee,x},H(ye,ae)}const Ae=function(ye){var ae,x;function ee(ce,ve){var Le;return(Le=ye.call(this)||this).observer=void 0,Le.config=void 0,Le.observer=ce,Le.config=ve,Le}x=ye,(ae=ee).prototype=Object.create(x.prototype),ae.prototype.constructor=ae,H(ae,x);var $=ee.prototype;return $.resetInitSegment=function(ce,ve,Le,Ne){ye.prototype.resetInitSegment.call(this,ce,ve,Le,Ne),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:ve,duration:Ne,inputTimeScale:9e4,dropped:0}},ee.probe=function(ce){if(!ce)return!1;for(var ve=(P.getID3Data(ce,0)||[]).length,Le=ce.length;ve<Le;ve++)if(Pe(ce,ve))return Q.logger.log("ADTS sync word found !"),!0;return!1},$.canParse=function(ce,ve){return function(Le,Ne){return function(ze,Be){return Be+5<ze.length}(Le,Ne)&&ne(Le,Ne)&&Re(Le,Ne)<=Le.length-Ne}(ce,ve)},$.appendFrame=function(ce,ve,Le){F(ce,this.observer,ve,Le,ce.manifestCodec);var Ne=W(ce,ve,Le,this.basePTS,this.frameIndex);if(Ne&&Ne.missing===0)return Ne},ee}(de);var _e=/\/emsg[-/]ID3/i;const we=function(){function ye(x,ee){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=ee}var ae=ye.prototype;return ae.resetTimeStamp=function(){},ae.resetInitSegment=function(x,ee,$,ce){var ve=(0,z.parseInitSegment)(x),Le=this.videoTrack=se("video",1),Ne=this.audioTrack=se("audio",1),ze=this.txtTrack=se("text",1);if(this.id3Track=se("id3",1),this.timeOffset=0,ve.video){var Be=ve.video,rt=Be.id,pt=Be.timescale,ct=Be.codec;Le.id=rt,Le.timescale=ze.timescale=pt,Le.codec=ct}if(ve.audio){var R=ve.audio,I=R.id,S=R.timescale,C=R.codec;Ne.id=I,Ne.timescale=S,Ne.codec=C}ze.id=z.RemuxerTrackIdConfig.text,Le.sampleDuration=0,Le.duration=Ne.duration=ce},ae.resetContiguity=function(){},ye.probe=function(x){return x=x.length>16384?x.subarray(0,16384):x,(0,z.findBox)(x,["moof"]).length>0},ae.demux=function(x,ee){this.timeOffset=ee;var $=x,ce=this.videoTrack,ve=this.txtTrack;if(this.config.progressive){this.remainderData&&($=(0,z.appendUint8Array)(this.remainderData,x));var Le=(0,z.segmentValidRange)($);this.remainderData=Le.remainder,ce.samples=Le.valid||new Uint8Array}else ce.samples=$;var Ne=this.extractID3Track(ce,ee);return ve.samples=(0,z.parseSamples)(ee,ce),{videoTrack:ce,audioTrack:this.audioTrack,id3Track:Ne,textTrack:this.txtTrack}},ae.flush=function(){var x=this.timeOffset,ee=this.videoTrack,$=this.txtTrack;ee.samples=this.remainderData||new Uint8Array,this.remainderData=null;var ce=this.extractID3Track(ee,this.timeOffset);return $.samples=(0,z.parseSamples)(x,ee),{videoTrack:ee,audioTrack:se(),id3Track:ce,textTrack:se()}},ae.extractID3Track=function(x,ee){var $=this.id3Track;if(x.samples.length){var ce=(0,z.findBox)(x.samples,["emsg"]);ce&&ce.forEach(function(ve){var Le=(0,z.parseEmsg)(ve);if(_e.test(Le.schemeIdUri)){var Ne=(0,c.isFiniteNumber)(Le.presentationTime)?Le.presentationTime/Le.timeScale:ee+Le.presentationTimeDelta/Le.timeScale,ze=Le.eventDuration===4294967295?Number.POSITIVE_INFINITY:Le.eventDuration/Le.timeScale;ze<=.001&&(ze=Number.POSITIVE_INFINITY);var Be=Le.payload;$.samples.push({data:Be,len:Be.byteLength,dts:Ne,pts:Ne,type:_.MetadataSchema.emsg,duration:ze})}})}return $},ae.demuxSampleAes=function(x,ee,$){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},ae.destroy=function(){},ye}();var U=null,ue=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Z=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],he=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],G=[0,1,1,4];function xe(ye,ae,x,ee,$){if(!(x+24>ae.length)){var ce=Ge(ae,x);if(ce&&x+ce.frameLength<=ae.length){var ve=ee+$*(9e4*ce.samplesPerFrame/ce.sampleRate),Le={unit:ae.subarray(x,x+ce.frameLength),pts:ve,dts:ve};return ye.config=[],ye.channelCount=ce.channelCount,ye.samplerate=ce.sampleRate,ye.samples.push(Le),{sample:Le,length:ce.frameLength,missing:0}}}}function Ge(ye,ae){var x=ye[ae+1]>>3&3,ee=ye[ae+1]>>1&3,$=ye[ae+2]>>4&15,ce=ye[ae+2]>>2&3;if(x!==1&&$!==0&&$!==15&&ce!==3){var ve=ye[ae+2]>>1&1,Le=ye[ae+3]>>6,Ne=1e3*ue[14*(x===3?3-ee:ee===3?3:4)+$-1],ze=Z[3*(x===3?0:x===2?1:2)+ce],Be=Le===3?1:2,rt=he[x][ee],pt=G[ee],ct=8*rt*pt,R=Math.floor(rt*Ne/ze+ve)*pt;if(U===null){var I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);U=I?parseInt(I[1]):0}return!!U&&U<=87&&ee===2&&Ne>=224e3&&Le===0&&(ye[ae+3]=128|ye[ae+3]),{sampleRate:ze,channelCount:Be,frameLength:R,samplesPerFrame:ct}}}function qe(ye,ae){return ye[ae]===255&&(224&ye[ae+1])==224&&(6&ye[ae+1])!=0}function it(ye,ae){return ae+1<ye.length&&qe(ye,ae)}function me(ye,ae){if(ae+1<ye.length&&qe(ye,ae)){var x=Ge(ye,ae),ee=4;x!=null&&x.frameLength&&(ee=x.frameLength);var $=ae+ee;return $===ye.length||it(ye,$)}return!1}const Ze=function(){function ye(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var ae=ye.prototype;return ae.loadWord=function(){var x=this.data,ee=this.bytesAvailable,$=x.byteLength-ee,ce=new Uint8Array(4),ve=Math.min(4,ee);if(ve===0)throw new Error("no bytes available");ce.set(x.subarray($,$+ve)),this.word=new DataView(ce.buffer).getUint32(0),this.bitsAvailable=8*ve,this.bytesAvailable-=ve},ae.skipBits=function(x){var ee;this.bitsAvailable>x?(this.word<<=x,this.bitsAvailable-=x):(x-=this.bitsAvailable,x-=(ee=x>>3)>>3,this.bytesAvailable-=ee,this.loadWord(),this.word<<=x,this.bitsAvailable-=x)},ae.readBits=function(x){var ee=Math.min(this.bitsAvailable,x),$=this.word>>>32-ee;return x>32&&Q.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=ee,this.bitsAvailable>0?this.word<<=ee:this.bytesAvailable>0&&this.loadWord(),(ee=x-ee)>0&&this.bitsAvailable?$<<ee|this.readBits(ee):$},ae.skipLZ=function(){var x;for(x=0;x<this.bitsAvailable;++x)if((this.word&2147483648>>>x)!=0)return this.word<<=x,this.bitsAvailable-=x,x;return this.loadWord(),x+this.skipLZ()},ae.skipUEG=function(){this.skipBits(1+this.skipLZ())},ae.skipEG=function(){this.skipBits(1+this.skipLZ())},ae.readUEG=function(){var x=this.skipLZ();return this.readBits(x+1)-1},ae.readEG=function(){var x=this.readUEG();return 1&x?1+x>>>1:-1*(x>>>1)},ae.readBoolean=function(){return this.readBits(1)===1},ae.readUByte=function(){return this.readBits(8)},ae.readUShort=function(){return this.readBits(16)},ae.readUInt=function(){return this.readBits(32)},ae.skipScalingList=function(x){for(var ee=8,$=8,ce=0;ce<x;ce++)$!==0&&($=(ee+this.readEG()+256)%256),ee=$===0?ee:$},ae.readSPS=function(){var x,ee,$,ce=0,ve=0,Le=0,Ne=0,ze=this.readUByte.bind(this),Be=this.readBits.bind(this),rt=this.readUEG.bind(this),pt=this.readBoolean.bind(this),ct=this.skipBits.bind(this),R=this.skipEG.bind(this),I=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);ze();var C=ze();if(Be(5),ct(3),ze(),I(),C===100||C===110||C===122||C===244||C===44||C===83||C===86||C===118||C===128){var O=rt();if(O===3&&ct(1),I(),I(),ct(1),pt())for(ee=O!==3?8:12,$=0;$<ee;$++)pt()&&S($<6?16:64)}I();var Y=rt();if(Y===0)rt();else if(Y===1)for(ct(1),R(),R(),x=rt(),$=0;$<x;$++)R();I(),ct(1);var j=rt(),J=rt(),De=Be(1);De===0&&ct(1),ct(1),pt()&&(ce=rt(),ve=rt(),Le=rt(),Ne=rt());var pe=[1,1];if(pt()&&pt())switch(ze()){case 1:pe=[1,1];break;case 2:pe=[12,11];break;case 3:pe=[10,11];break;case 4:pe=[16,11];break;case 5:pe=[40,33];break;case 6:pe=[24,11];break;case 7:pe=[20,11];break;case 8:pe=[32,11];break;case 9:pe=[80,33];break;case 10:pe=[18,11];break;case 11:pe=[15,11];break;case 12:pe=[64,33];break;case 13:pe=[160,99];break;case 14:pe=[4,3];break;case 15:pe=[3,2];break;case 16:pe=[2,1];break;case 255:pe=[ze()<<8|ze(),ze()<<8|ze()]}return{width:Math.ceil(16*(j+1)-2*ce-2*ve),height:(2-De)*(J+1)*16-(De?2:4)*(Le+Ne),pixelRatio:pe}},ae.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},ye}(),st=function(){function ye(x,ee,$){this.keyData=void 0,this.decrypter=void 0,this.keyData=$,this.decrypter=new B.default(x,ee,{removePKCS7Padding:!1})}var ae=ye.prototype;return ae.decryptBuffer=function(x,ee){this.decrypter.decrypt(x,this.keyData.key.buffer,this.keyData.iv.buffer,ee)},ae.decryptAacSample=function(x,ee,$,ce){var ve=x[ee].unit;if(!(ve.length<=16)){var Le=ve.subarray(16,ve.length-ve.length%16),Ne=Le.buffer.slice(Le.byteOffset,Le.byteOffset+Le.length),ze=this;this.decryptBuffer(Ne,function(Be){var rt=new Uint8Array(Be);ve.set(rt,16),ce||ze.decryptAacSamples(x,ee+1,$)})}},ae.decryptAacSamples=function(x,ee,$){for(;;ee++){if(ee>=x.length)return void $();if(!(x[ee].unit.length<32)){var ce=this.decrypter.isSync();if(this.decryptAacSample(x,ee,$,ce),!ce)return}}},ae.getAvcEncryptedData=function(x){for(var ee=16*Math.floor((x.length-48)/160)+16,$=new Int8Array(ee),ce=0,ve=32;ve<x.length-16;ve+=160,ce+=16)$.set(x.subarray(ve,ve+16),ce);return $},ae.getAvcDecryptedUnit=function(x,ee){for(var $=new Uint8Array(ee),ce=0,ve=32;ve<x.length-16;ve+=160,ce+=16)x.set($.subarray(ce,ce+16),ve);return x},ae.decryptAvcSample=function(x,ee,$,ce,ve,Le){var Ne=(0,z.discardEPB)(ve.data),ze=this.getAvcEncryptedData(Ne),Be=this;this.decryptBuffer(ze.buffer,function(rt){ve.data=Be.getAvcDecryptedUnit(Ne,rt),Le||Be.decryptAvcSamples(x,ee,$+1,ce)})},ae.decryptAvcSamples=function(x,ee,$,ce){if(x instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;ee++,$=0){if(ee>=x.length)return void ce();for(var ve=x[ee].units;!($>=ve.length);$++){var Le=ve[$];if(!(Le.data.length<=48||Le.type!==1&&Le.type!==5)){var Ne=this.decrypter.isSync();if(this.decryptAvcSample(x,ee,$,ce,Le,Ne),!Ne)return}}}},ye}();function Et(){return Et=Object.assign?Object.assign.bind():function(ye){for(var ae=1;ae<arguments.length;ae++){var x=arguments[ae];for(var ee in x)Object.prototype.hasOwnProperty.call(x,ee)&&(ye[ee]=x[ee])}return ye},Et.apply(this,arguments)}var lt=188;function vt(ye,ae,x,ee){return{key:ye,frame:!1,pts:ae,dts:x,units:[],debug:ee,length:0}}function St(ye,ae){return(31&ye[ae+10])<<8|ye[ae+11]}function gt(ye,ae,x,ee){var $={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},ce=ae+3+((15&ye[ae+1])<<8|ye[ae+2])-4;for(ae+=12+((15&ye[ae+10])<<8|ye[ae+11]);ae<ce;){var ve=(31&ye[ae+1])<<8|ye[ae+2];switch(ye[ae]){case 207:if(!ee){Q.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:$.audio===-1&&($.audio=ve);break;case 21:$.id3===-1&&($.id3=ve);break;case 219:if(!ee){Q.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:$.avc===-1&&($.avc=ve);break;case 3:case 4:x.mpeg!==!0&&x.mp3!==!0?Q.logger.log("MPEG audio found, not supported in this browser"):$.audio===-1&&($.audio=ve,$.segmentCodec="mp3");break;case 36:Q.logger.warn("Unsupported HEVC stream type found")}ae+=5+((15&ye[ae+3])<<8|ye[ae+4])}return $}function At(ye){var ae,x,ee,$,ce,ve=0,Le=ye.data;if(!ye||ye.size===0)return null;for(;Le[0].length<19&&Le.length>1;){var Ne=new Uint8Array(Le[0].length+Le[1].length);Ne.set(Le[0]),Ne.set(Le[1],Le[0].length),Le[0]=Ne,Le.splice(1,1)}if(((ae=Le[0])[0]<<16)+(ae[1]<<8)+ae[2]===1){if((x=(ae[4]<<8)+ae[5])&&x>ye.size-6)return null;var ze=ae[7];192&ze&&($=536870912*(14&ae[9])+4194304*(255&ae[10])+16384*(254&ae[11])+128*(255&ae[12])+(254&ae[13])/2,64&ze?$-(ce=536870912*(14&ae[14])+4194304*(255&ae[15])+16384*(254&ae[16])+128*(255&ae[17])+(254&ae[18])/2)>54e5&&(Q.logger.warn(Math.round(($-ce)/9e4)+"s delta between PTS and DTS, align them"),$=ce):ce=$);var Be=(ee=ae[8])+9;if(ye.size<=Be)return null;ye.size-=Be;for(var rt=new Uint8Array(ye.size),pt=0,ct=Le.length;pt<ct;pt++){var R=(ae=Le[pt]).byteLength;if(Be){if(Be>R){Be-=R;continue}ae=ae.subarray(Be),R-=Be,Be=0}rt.set(ae,ve),ve+=R}return x&&(x-=ee+3),{data:rt,pts:$,dts:ce,len:x}}return null}function Lt(ye,ae){if(ye.units.length&&ye.frame){if(ye.pts===void 0){var x=ae.samples,ee=x.length;if(!ee)return void ae.dropped++;var $=x[ee-1];ye.pts=$.pts,ye.dts=$.dts}ae.samples.push(ye)}ye.debug.length&&Q.logger.log(ye.pts+"/"+ye.dts+":"+ye.debug)}const yt=function(){function ye(x,ee,$){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=x,this.config=ee,this.typeSupported=$}ye.probe=function(x){var ee=ye.syncOffset(x);return ee>0&&Q.logger.warn("MPEG2-TS detected but first sync word found @ offset "+ee),ee!==-1},ye.syncOffset=function(x){for(var ee=Math.min(940,x.length-376)+1,$=0;$<ee;){if(x[$]===71&&x[$+lt]===71)return $;$++}return-1},ye.createTrack=function(x,ee){return{container:x==="video"||x==="audio"?"video/mp2t":void 0,type:x,id:z.RemuxerTrackIdConfig[x],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:x==="audio"?ee:void 0}};var ae=ye.prototype;return ae.resetInitSegment=function(x,ee,$,ce){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=ye.createTrack("video"),this._audioTrack=ye.createTrack("audio",ce),this._id3Track=ye.createTrack("id3"),this._txtTrack=ye.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=ee,this.videoCodec=$,this._duration=ce},ae.resetTimeStamp=function(){},ae.resetContiguity=function(){var x=this._audioTrack,ee=this._avcTrack,$=this._id3Track;x&&(x.pesData=null),ee&&(ee.pesData=null),$&&($.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},ae.demux=function(x,ee,$,ce){var ve;$===void 0&&($=!1),ce===void 0&&(ce=!1),$||(this.sampleAes=null);var Le=this._avcTrack,Ne=this._audioTrack,ze=this._id3Track,Be=this._txtTrack,rt=Le.pid,pt=Le.pesData,ct=Ne.pid,R=ze.pid,I=Ne.pesData,S=ze.pesData,C=null,O=this.pmtParsed,Y=this._pmtId,j=x.length;if(this.remainderData&&(j=(x=(0,z.appendUint8Array)(this.remainderData,x)).length,this.remainderData=null),j<lt&&!ce)return this.remainderData=x,{audioTrack:Ne,videoTrack:Le,id3Track:ze,textTrack:Be};var J=Math.max(0,ye.syncOffset(x));(j-=(j-J)%lt)<x.byteLength&&!ce&&(this.remainderData=new Uint8Array(x.buffer,j,x.buffer.byteLength-j));for(var De=0,pe=J;pe<j;pe+=lt)if(x[pe]===71){var ke=!!(64&x[pe+1]),Fe=((31&x[pe+1])<<8)+x[pe+2],Qe=void 0;if((48&x[pe+3])>>4>1){if((Qe=pe+5+x[pe+4])===pe+lt)continue}else Qe=pe+4;switch(Fe){case rt:ke&&(pt&&(ve=At(pt))&&this.parseAVCPES(Le,Be,ve,!1),pt={data:[],size:0}),pt&&(pt.data.push(x.subarray(Qe,pe+lt)),pt.size+=pe+lt-Qe);break;case ct:if(ke){if(I&&(ve=At(I)))switch(Ne.segmentCodec){case"aac":this.parseAACPES(Ne,ve);break;case"mp3":this.parseMPEGPES(Ne,ve)}I={data:[],size:0}}I&&(I.data.push(x.subarray(Qe,pe+lt)),I.size+=pe+lt-Qe);break;case R:ke&&(S&&(ve=At(S))&&this.parseID3PES(ze,ve),S={data:[],size:0}),S&&(S.data.push(x.subarray(Qe,pe+lt)),S.size+=pe+lt-Qe);break;case 0:ke&&(Qe+=x[Qe]+1),Y=this._pmtId=St(x,Qe);break;case Y:ke&&(Qe+=x[Qe]+1);var $e=gt(x,Qe,this.typeSupported,$);(rt=$e.avc)>0&&(Le.pid=rt),(ct=$e.audio)>0&&(Ne.pid=ct,Ne.segmentCodec=$e.segmentCodec),(R=$e.id3)>0&&(ze.pid=R),C===null||O||(Q.logger.log("unknown PID '"+C+"' in TS found"),C=null,pe=J-188),O=this.pmtParsed=!0;break;case 17:case 8191:break;default:C=Fe}}else De++;De>0&&this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+De+" TS packet/s that do not start with 0x47"}),Le.pesData=pt,Ne.pesData=I,ze.pesData=S;var je={audioTrack:Ne,videoTrack:Le,id3Track:ze,textTrack:Be};return ce&&this.extractRemainingSamples(je),je},ae.flush=function(){var x,ee=this.remainderData;return this.remainderData=null,x=ee?this.demux(ee,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(x),this.sampleAes?this.decrypt(x,this.sampleAes):x},ae.extractRemainingSamples=function(x){var ee,$=x.audioTrack,ce=x.videoTrack,ve=x.id3Track,Le=x.textTrack,Ne=ce.pesData,ze=$.pesData,Be=ve.pesData;if(Ne&&(ee=At(Ne))?(this.parseAVCPES(ce,Le,ee,!0),ce.pesData=null):ce.pesData=Ne,ze&&(ee=At(ze))){switch($.segmentCodec){case"aac":this.parseAACPES($,ee);break;case"mp3":this.parseMPEGPES($,ee)}$.pesData=null}else ze!=null&&ze.size&&Q.logger.log("last AAC PES packet truncated,might overlap between fragments"),$.pesData=ze;Be&&(ee=At(Be))?(this.parseID3PES(ve,ee),ve.pesData=null):ve.pesData=Be},ae.demuxSampleAes=function(x,ee,$){var ce=this.demux(x,$,!0,!this.config.progressive),ve=this.sampleAes=new st(this.observer,this.config,ee);return this.decrypt(ce,ve)},ae.decrypt=function(x,ee){return new Promise(function($){var ce=x.audioTrack,ve=x.videoTrack;ce.samples&&ce.segmentCodec==="aac"?ee.decryptAacSamples(ce.samples,0,function(){ve.samples?ee.decryptAvcSamples(ve.samples,0,0,function(){$(x)}):$(x)}):ve.samples&&ee.decryptAvcSamples(ve.samples,0,0,function(){$(x)})})},ae.destroy=function(){this._duration=0},ae.parseAVCPES=function(x,ee,$,ce){var ve,Le=this,Ne=this.parseAVCNALu(x,$.data),ze=this.avcSample,Be=!1;$.data=null,ze&&Ne.length&&!x.audFound&&(Lt(ze,x),ze=this.avcSample=vt(!1,$.pts,$.dts,"")),Ne.forEach(function(rt){switch(rt.type){case 1:ve=!0,ze||(ze=Le.avcSample=vt(!0,$.pts,$.dts,"")),ze.frame=!0;var pt=rt.data;if(Be&&pt.length>4){var ct=new Ze(pt).readSliceType();ct!==2&&ct!==4&&ct!==7&&ct!==9||(ze.key=!0)}break;case 5:ve=!0,ze||(ze=Le.avcSample=vt(!0,$.pts,$.dts,"")),ze.key=!0,ze.frame=!0;break;case 6:ve=!0,(0,z.parseSEIMessageFromNALu)(rt.data,1,$.pts,ee.samples);break;case 7:if(ve=!0,Be=!0,!x.sps){var R=new Ze(rt.data).readSPS();x.width=R.width,x.height=R.height,x.pixelRatio=R.pixelRatio,x.sps=[rt.data],x.duration=Le._duration;for(var I=rt.data.subarray(1,4),S="avc1.",C=0;C<3;C++){var O=I[C].toString(16);O.length<2&&(O="0"+O),S+=O}x.codec=S}break;case 8:ve=!0,x.pps||(x.pps=[rt.data]);break;case 9:ve=!1,x.audFound=!0,ze&&Lt(ze,x),ze=Le.avcSample=vt(!1,$.pts,$.dts,"");break;case 12:ve=!0;break;default:ve=!1,ze&&(ze.debug+="unknown NAL "+rt.type+" ")}ze&&ve&&ze.units.push(rt)}),ce&&ze&&(Lt(ze,x),this.avcSample=null)},ae.getLastNalUnit=function(x){var ee,$,ce=this.avcSample;if(ce&&ce.units.length!==0||(ce=x[x.length-1]),(ee=ce)!==null&&ee!==void 0&&ee.units){var ve=ce.units;$=ve[ve.length-1]}return $},ae.parseAVCNALu=function(x,ee){var $,ce,ve=ee.byteLength,Le=x.naluState||0,Ne=Le,ze=[],Be=0,rt=-1,pt=0;for(Le===-1&&(rt=0,pt=31&ee[0],Le=0,Be=1);Be<ve;)if($=ee[Be++],Le)if(Le!==1)if($)if($===1){if(rt>=0){var ct={data:ee.subarray(rt,Be-Le-1),type:pt};ze.push(ct)}else{var R=this.getLastNalUnit(x.samples);if(R&&(Ne&&Be<=4-Ne&&R.state&&(R.data=R.data.subarray(0,R.data.byteLength-Ne)),(ce=Be-Le-1)>0)){var I=new Uint8Array(R.data.byteLength+ce);I.set(R.data,0),I.set(ee.subarray(0,ce),R.data.byteLength),R.data=I,R.state=0}}Be<ve?(rt=Be,pt=31&ee[Be],Le=0):Le=-1}else Le=0;else Le=3;else Le=$?0:2;else Le=$?0:1;if(rt>=0&&Le>=0){var S={data:ee.subarray(rt,ve),type:pt,state:Le};ze.push(S)}if(ze.length===0){var C=this.getLastNalUnit(x.samples);if(C){var O=new Uint8Array(C.data.byteLength+ee.byteLength);O.set(C.data,0),O.set(ee,C.data.byteLength),C.data=O}}return x.naluState=Le,ze},ae.parseAACPES=function(x,ee){var $,ce,ve,Le,Ne,ze=0,Be=this.aacOverFlow,rt=ee.data;if(Be){this.aacOverFlow=null;var pt=Be.missing,ct=Be.sample.unit.byteLength;if(pt===-1){var R=new Uint8Array(ct+rt.byteLength);R.set(Be.sample.unit,0),R.set(rt,ct),rt=R}else{var I=ct-pt;Be.sample.unit.set(rt.subarray(0,pt),I),x.samples.push(Be.sample),ze=Be.missing}}for($=ze,ce=rt.length;$<ce-1&&!Te(rt,$);$++);if($===ze||($<ce-1?(ve="AAC PES did not start with ADTS header,offset:"+$,Le=!1):(ve="no ADTS header found in AAC PES",Le=!0),Q.logger.warn("parsing error:"+ve),this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:Le,reason:ve}),!Le)){if(F(x,this.observer,rt,$,this.audioCodec),ee.pts!==void 0)Ne=ee.pts;else{if(!Be)return void Q.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var S=k(x.samplerate);Ne=Be.sample.pts+S}for(var C,O=0;$<ce;){if($+=(C=W(x,rt,$,Ne,O)).length,C.missing){this.aacOverFlow=C;break}for(O++;$<ce-1&&!Te(rt,$);$++);}}},ae.parseMPEGPES=function(x,ee){var $=ee.data,ce=$.length,ve=0,Le=0,Ne=ee.pts;if(Ne!==void 0)for(;Le<ce;)if(it($,Le)){var ze=xe(x,$,Le,Ne,ve);if(!ze)break;Le+=ze.length,ve++}else Le++;else Q.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},ae.parseID3PES=function(x,ee){if(ee.pts!==void 0){var $=Et({},ee,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});x.samples.push($)}else Q.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},ye}();function Ot(ye,ae){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,ee){return x.__proto__=ee,x},Ot(ye,ae)}const _t=function(ye){var ae,x;function ee(){return ye.apply(this,arguments)||this}x=ye,(ae=ee).prototype=Object.create(x.prototype),ae.prototype.constructor=ae,Ot(ae,x);var $=ee.prototype;return $.resetInitSegment=function(ce,ve,Le,Ne){ye.prototype.resetInitSegment.call(this,ce,ve,Le,Ne),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:ve,duration:Ne,inputTimeScale:9e4,dropped:0}},ee.probe=function(ce){if(!ce)return!1;for(var ve=(P.getID3Data(ce,0)||[]).length,Le=ce.length;ve<Le;ve++)if(me(ce,ve))return Q.logger.log("MPEG Audio sync word found !"),!0;return!1},$.canParse=function(ce,ve){return function(Le,Ne){return qe(Le,Ne)&&4<=Le.length-Ne}(ce,ve)},$.appendFrame=function(ce,ve,Le){if(this.basePTS!==null)return xe(ce,ve,Le,this.basePTS,this.frameIndex)},ee}(de);var Jt=X(524),Gt=X(923);function wt(ye,ae){var x=ye==null?void 0:ye.codec;return x&&x.length>4?x:x==="hvc1"||x==="hev1"?"hvc1.1.c.L120.90":x==="av01"?"av01.0.04M.08":x==="avc1"||ae===Gt.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const tr=function(){function ye(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var ae=ye.prototype;return ae.destroy=function(){},ae.resetTimeStamp=function(x){this.initPTS=x,this.lastEndTime=null},ae.resetNextTimestamp=function(){this.lastEndTime=null},ae.resetInitSegment=function(x,ee,$){this.audioCodec=ee,this.videoCodec=$,this.generateInitSegment(x),this.emitInitSegment=!0},ae.generateInitSegment=function(x){var ee=this.audioCodec,$=this.videoCodec;if(!x||!x.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var ce=this.initData=(0,z.parseInitSegment)(x);ee||(ee=wt(ce.audio,Gt.ElementaryStreamTypes.AUDIO)),$||($=wt(ce.video,Gt.ElementaryStreamTypes.VIDEO));var ve={};ce.audio&&ce.video?ve.audiovideo={container:"video/mp4",codec:ee+","+$,initSegment:x,id:"main"}:ce.audio?ve.audio={container:"audio/mp4",codec:ee,initSegment:x,id:"audio"}:ce.video?ve.video={container:"video/mp4",codec:$,initSegment:x,id:"main"}:Q.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=ve},ae.remux=function(x,ee,$,ce,ve){var Le,Ne=this.initPTS,ze=this.lastEndTime,Be={audio:void 0,video:void 0,text:ce,id3:$,initSegment:void 0};(0,c.isFiniteNumber)(ze)||(ze=this.lastEndTime=ve||0);var rt=ee.samples;if(!rt||!rt.length)return Be;var pt={initPTS:void 0,timescale:1},ct=this.initData;if(ct&&ct.length||(this.generateInitSegment(rt),ct=this.initData),!ct||!ct.length)return Q.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),Be;this.emitInitSegment&&(pt.tracks=this.initTracks,this.emitInitSegment=!1);var R=(0,z.getStartDTS)(ct,rt);(0,c.isFiniteNumber)(Ne)||(this.initPTS=pt.initPTS=Ne=R-ve);var I=(0,z.getDuration)(rt,ct),S=x?R-Ne:ze,C=S+I;(0,z.offsetStartDTS)(ct,rt,Ne),I>0?this.lastEndTime=C:(Q.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var O=!!ct.audio,Y=!!ct.video,j="";O&&(j+="audio"),Y&&(j+="video");var J={data1:rt,startPTS:S,startDTS:S,endPTS:C,endDTS:C,type:j,hasAudio:O,hasVideo:Y,nb:1,dropped:0};Be.audio=J.type==="audio"?J:void 0,Be.video=J.type!=="audio"?J:void 0,Be.initSegment=pt;var De=(Le=this.initPTS)!=null?Le:0;return Be.id3=(0,Jt.flushTextTrackMetadataCueSamples)($,ve,De,De),ce.samples.length&&(Be.text=(0,Jt.flushTextTrackUserdataCueSamples)(ce,ve,De)),Be},ye}();var Zt;try{Zt=self.performance.now.bind(self.performance)}catch(ye){Q.logger.debug("Unable to use Performance API on this environment"),Zt=self.Date.now}var rr=[{demux:yt,remux:Jt.default},{demux:we,remux:tr},{demux:Ae,remux:Jt.default},{demux:_t,remux:Jt.default}],lr=function(){function ye(x,ee,$,ce,ve){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=x,this.typeSupported=ee,this.config=$,this.vendor=ce,this.id=ve}var ae=ye.prototype;return ae.configure=function(x){this.transmuxConfig=x,this.decrypter&&this.decrypter.reset()},ae.push=function(x,ee,$,ce){var ve=this,Le=$.transmuxing;Le.executeStart=Zt();var Ne=new Uint8Array(x),ze=this.config,Be=this.currentTransmuxState,rt=this.transmuxConfig;ce&&(this.currentTransmuxState=ce);var pt=ce||Be,ct=pt.contiguous,R=pt.discontinuity,I=pt.trackSwitch,S=pt.accurateTimeOffset,C=pt.timeOffset,O=pt.initSegmentChange,Y=rt.audioCodec,j=rt.videoCodec,J=rt.defaultInitPts,De=rt.duration,pe=rt.initSegmentData;(R||I||O)&&this.resetInitSegment(pe,Y,j,De),(R||O)&&this.resetInitialTimestamp(J),ct||this.resetContiguity();var ke=function(ot,Tt){var dt=null;return ot.byteLength>0&&Tt!=null&&Tt.key!=null&&Tt.iv!==null&&Tt.method!=null&&(dt=Tt),dt}(Ne,ee);if(ke&&ke.method==="AES-128"){var Fe=this.getDecrypter();if(!ze.enableSoftwareAES)return this.decryptionPromise=Fe.webCryptoDecrypt(Ne,ke.key.buffer,ke.iv.buffer).then(function(ot){var Tt=ve.push(ot,null,$);return ve.decryptionPromise=null,Tt}),this.decryptionPromise;var Qe=Fe.softwareDecrypt(Ne,ke.key.buffer,ke.iv.buffer);if(!Qe)return Le.executeEnd=Zt(),ur($);Ne=new Uint8Array(Qe)}this.needsProbing(Ne,R,I)&&this.configureTransmuxer(Ne,rt);var $e=this.transmux(Ne,ke,C,S,$),je=this.currentTransmuxState;return je.contiguous=!0,je.discontinuity=!1,je.trackSwitch=!1,Le.executeEnd=Zt(),$e},ae.flush=function(x){var ee=this,$=x.transmuxing;$.executeStart=Zt();var ce=this.decrypter,ve=this.currentTransmuxState,Le=this.decryptionPromise;if(Le)return Le.then(function(){return ee.flush(x)});var Ne=[],ze=ve.timeOffset;if(ce){var Be=ce.flush();Be&&Ne.push(this.push(Be,null,x))}var rt=this.demuxer,pt=this.remuxer;if(!rt||!pt)return this.observer.emit(Ee.Events.ERROR,Ee.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),$.executeEnd=Zt(),[ur(x)];var ct=rt.flush(ze);return hr(ct)?ct.then(function(R){return ee.flushRemux(Ne,R,x),Ne}):(this.flushRemux(Ne,ct,x),Ne)},ae.flushRemux=function(x,ee,$){var ce=ee.audioTrack,ve=ee.videoTrack,Le=ee.id3Track,Ne=ee.textTrack,ze=this.currentTransmuxState,Be=ze.accurateTimeOffset,rt=ze.timeOffset;Q.logger.log("[transmuxer.ts]: Flushed fragment "+$.sn+($.part>-1?" p: "+$.part:"")+" of level "+$.level);var pt=this.remuxer.remux(ce,ve,Le,Ne,rt,Be,!0,this.id);x.push({remuxResult:pt,chunkMeta:$}),$.transmuxing.executeEnd=Zt()},ae.resetInitialTimestamp=function(x){var ee=this.demuxer,$=this.remuxer;ee&&$&&(ee.resetTimeStamp(x),$.resetTimeStamp(x))},ae.resetContiguity=function(){var x=this.demuxer,ee=this.remuxer;x&&ee&&(x.resetContiguity(),ee.resetNextTimestamp())},ae.resetInitSegment=function(x,ee,$,ce){var ve=this.demuxer,Le=this.remuxer;ve&&Le&&(ve.resetInitSegment(x,ee,$,ce),Le.resetInitSegment(x,ee,$))},ae.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},ae.transmux=function(x,ee,$,ce,ve){return ee&&ee.method==="SAMPLE-AES"?this.transmuxSampleAes(x,ee,$,ce,ve):this.transmuxUnencrypted(x,$,ce,ve)},ae.transmuxUnencrypted=function(x,ee,$,ce){var ve=this.demuxer.demux(x,ee,!1,!this.config.progressive),Le=ve.audioTrack,Ne=ve.videoTrack,ze=ve.id3Track,Be=ve.textTrack;return{remuxResult:this.remuxer.remux(Le,Ne,ze,Be,ee,$,!1,this.id),chunkMeta:ce}},ae.transmuxSampleAes=function(x,ee,$,ce,ve){var Le=this;return this.demuxer.demuxSampleAes(x,ee,$).then(function(Ne){return{remuxResult:Le.remuxer.remux(Ne.audioTrack,Ne.videoTrack,Ne.id3Track,Ne.textTrack,$,ce,!1,Le.id),chunkMeta:ve}})},ae.configureTransmuxer=function(x,ee){for(var $,ce=this.config,ve=this.observer,Le=this.typeSupported,Ne=this.vendor,ze=ee.audioCodec,Be=ee.defaultInitPts,rt=ee.duration,pt=ee.initSegmentData,ct=ee.videoCodec,R=0,I=rr.length;R<I;R++)if(rr[R].demux.probe(x)){$=rr[R];break}$||(Q.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),$={demux:we,remux:tr});var S=this.demuxer,C=this.remuxer,O=$.remux,Y=$.demux;C&&C instanceof O||(this.remuxer=new O(ve,ce,Le,Ne)),S&&S instanceof Y||(this.demuxer=new Y(ve,ce,Le),this.probe=Y.probe),this.resetInitSegment(pt,ze,ct,rt),this.resetInitialTimestamp(Be)},ae.needsProbing=function(x,ee,$){return!this.demuxer||!this.remuxer||ee||$},ae.getDecrypter=function(){var x=this.decrypter;return x||(x=this.decrypter=new B.default(this.observer,this.config)),x},ye}(),ur=function(ye){return{remuxResult:{},chunkMeta:ye}};function hr(ye){return"then"in ye&&ye.then instanceof Function}var Xt=function(ye,ae,x,ee,$){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=ye,this.videoCodec=ae,this.initSegmentData=x,this.duration=ee,this.defaultInitPts=$},sr=function(ye,ae,x,ee,$,ce){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=ye,this.contiguous=ae,this.accurateTimeOffset=x,this.trackSwitch=ee,this.timeOffset=$,this.initSegmentChange=ce}},973:(ht,Oe,X)=>{"use strict";var Ee,ie;X.r(Oe),X.d(Oe,{ErrorDetails:()=>ie,ErrorTypes:()=>Ee}),function(B){B.NETWORK_ERROR="networkError",B.MEDIA_ERROR="mediaError",B.KEY_SYSTEM_ERROR="keySystemError",B.MUX_ERROR="muxError",B.OTHER_ERROR="otherError"}(Ee||(Ee={})),function(B){B.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",B.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",B.KEY_SYSTEM_NO_SESSION="keySystemNoSession",B.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",B.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",B.MANIFEST_LOAD_ERROR="manifestLoadError",B.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",B.MANIFEST_PARSING_ERROR="manifestParsingError",B.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",B.LEVEL_EMPTY_ERROR="levelEmptyError",B.LEVEL_LOAD_ERROR="levelLoadError",B.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",B.LEVEL_SWITCH_ERROR="levelSwitchError",B.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",B.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",B.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",B.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",B.FRAG_LOAD_ERROR="fragLoadError",B.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",B.FRAG_DECRYPT_ERROR="fragDecryptError",B.FRAG_PARSING_ERROR="fragParsingError",B.REMUX_ALLOC_ERROR="remuxAllocError",B.KEY_LOAD_ERROR="keyLoadError",B.KEY_LOAD_TIMEOUT="keyLoadTimeOut",B.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",B.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",B.BUFFER_APPEND_ERROR="bufferAppendError",B.BUFFER_APPENDING_ERROR="bufferAppendingError",B.BUFFER_STALLED_ERROR="bufferStalledError",B.BUFFER_FULL_ERROR="bufferFullError",B.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",B.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",B.INTERNAL_EXCEPTION="internalException",B.INTERNAL_ABORTED="aborted",B.UNKNOWN="unknown"}(ie||(ie={}))},851:(ht,Oe,X)=>{"use strict";var Ee;X.r(Oe),X.d(Oe,{Events:()=>Ee}),function(ie){ie.MEDIA_ATTACHING="hlsMediaAttaching",ie.MEDIA_ATTACHED="hlsMediaAttached",ie.MEDIA_DETACHING="hlsMediaDetaching",ie.MEDIA_DETACHED="hlsMediaDetached",ie.BUFFER_RESET="hlsBufferReset",ie.BUFFER_CODECS="hlsBufferCodecs",ie.BUFFER_CREATED="hlsBufferCreated",ie.BUFFER_APPENDING="hlsBufferAppending",ie.BUFFER_APPENDED="hlsBufferAppended",ie.BUFFER_EOS="hlsBufferEos",ie.BUFFER_FLUSHING="hlsBufferFlushing",ie.BUFFER_FLUSHED="hlsBufferFlushed",ie.MANIFEST_LOADING="hlsManifestLoading",ie.MANIFEST_LOADED="hlsManifestLoaded",ie.MANIFEST_PARSED="hlsManifestParsed",ie.LEVEL_SWITCHING="hlsLevelSwitching",ie.LEVEL_SWITCHED="hlsLevelSwitched",ie.LEVEL_LOADING="hlsLevelLoading",ie.LEVEL_LOADED="hlsLevelLoaded",ie.LEVEL_UPDATED="hlsLevelUpdated",ie.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",ie.LEVELS_UPDATED="hlsLevelsUpdated",ie.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",ie.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",ie.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",ie.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",ie.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",ie.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",ie.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",ie.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",ie.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",ie.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",ie.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",ie.CUES_PARSED="hlsCuesParsed",ie.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",ie.INIT_PTS_FOUND="hlsInitPtsFound",ie.FRAG_LOADING="hlsFragLoading",ie.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",ie.FRAG_LOADED="hlsFragLoaded",ie.FRAG_DECRYPTED="hlsFragDecrypted",ie.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",ie.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",ie.FRAG_PARSING_METADATA="hlsFragParsingMetadata",ie.FRAG_PARSED="hlsFragParsed",ie.FRAG_BUFFERED="hlsFragBuffered",ie.FRAG_CHANGED="hlsFragChanged",ie.FPS_DROP="hlsFpsDrop",ie.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",ie.ERROR="hlsError",ie.DESTROYING="hlsDestroying",ie.KEY_LOADING="hlsKeyLoading",ie.KEY_LOADED="hlsKeyLoaded",ie.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",ie.BACK_BUFFER_REACHED="hlsBackBufferReached"}(Ee||(Ee={}))},817:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>bn});var Ee,ie=X(945),B=X(965),c=X(851),P=X(973),_=X(93),se=X(63),z=/^(\d+)x(\d+)$/,K=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,te=function(){function v(e){for(var t in typeof e=="string"&&(e=v.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var d=v.prototype;return d.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},d.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},d.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},d.decimalFloatingPoint=function(e){return parseFloat(this[e])},d.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},d.enumeratedString=function(e){return this[e]},d.bool=function(e){return this[e]==="YES"},d.decimalResolution=function(e){var t=z.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},v.parseAttrList=function(e){var t,i={};for(K.lastIndex=0;(t=K.exec(e))!==null;){var n=t[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},v}();function re(){return re=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},re.apply(this,arguments)}function de(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}(function(v){v.ID="ID",v.CLASS="CLASS",v.START_DATE="START-DATE",v.DURATION="DURATION",v.END_DATE="END-DATE",v.END_ON_NEXT="END-ON-NEXT",v.PLANNED_DURATION="PLANNED-DURATION",v.SCTE35_OUT="SCTE35-OUT",v.SCTE35_IN="SCTE35-IN"})(Ee||(Ee={}));var Q=function(){function v(t,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var a in n)if(Object.prototype.hasOwnProperty.call(t,a)&&t[a]!==n[a]){_.logger.warn('DATERANGE tag attribute: "'+a+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=a;break}t=re(new te({}),n,t)}if(this.attr=t,this._startDate=new Date(t[Ee.START_DATE]),Ee.END_DATE in this.attr){var r=new Date(this.attr[Ee.END_DATE]);(0,B.isFiniteNumber)(r.getTime())&&(this._endDate=r)}}var d,e;return d=v,(e=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return t!==null?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(Ee.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(Ee.DURATION);if((0,B.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return Ee.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(Ee.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(Ee.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,B.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&de(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}(),ne=X(923);function le(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}var Re=function(){function v(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}var d,e;return v.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},d=v,(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,B.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!==null&&t!==void 0&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&le(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}(),Te=X(960),Pe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function F(v,d){return MediaSource.isTypeSupported((d||"video")+'/mp4;codecs="'+v+'"')}var k=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,W=/#EXT-X-MEDIA:(.*)/g,H=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Ae=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),_e=/\.(mp4|m4s|m4v|m4a)$/i,we=function(){function v(){}return v.findGroup=function(d,e){for(var t=0;t<d.length;t++){var i=d[t];if(i.id===e)return i}},v.convertAVC1ToAVCOTI=function(d){var e=d.split(".");if(e.length>2){var t=e.shift()+".";return(t+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return d},v.resolve=function(d,e){return ie.buildAbsoluteURL(e,d,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(d,e){var t,i=[],n=[],a={},r=!1;for(k.lastIndex=0;(t=k.exec(d))!=null;)if(t[1]){var s,u=new te(t[1]),f={attrs:u,bitrate:u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),name:u.NAME,url:v.resolve(t[2],e)},E=u.decimalResolution("RESOLUTION");E&&(f.width=E.width,f.height=E.height),U((u.CODECS||"").split(/[ ,]+/).filter(function(N){return N}),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=v.convertAVC1ToAVCOTI(f.videoCodec)),(s=f.unknownCodecs)!==null&&s!==void 0&&s.length||n.push(f),i.push(f)}else if(t[3]){var D=new te(t[3]);D["DATA-ID"]&&(r=!0,a[D["DATA-ID"]]=D)}return{levels:n.length>0&&n.length<i.length?n:i,sessionData:r?a:null}},v.parseMasterPlaylistMedia=function(d,e,t,i){var n;i===void 0&&(i=[]);var a=[],r=0;for(W.lastIndex=0;(n=W.exec(d))!==null;){var s=new te(n[1]);if(s.TYPE===t){var u={attrs:s,bitrate:0,id:r++,groupId:s["GROUP-ID"],instreamId:s["INSTREAM-ID"],name:s.NAME||s.LANGUAGE||"",type:t,default:s.bool("DEFAULT"),autoselect:s.bool("AUTOSELECT"),forced:s.bool("FORCED"),lang:s.LANGUAGE,url:s.URI?v.resolve(s.URI,e):""};if(i.length){var f=v.findGroup(i,u.groupId)||i[0];ue(u,f,"audioCodec"),ue(u,f,"textCodec")}a.push(u)}}return a},v.parseLevelPlaylist=function(d,e,t,i,n){var a,r,s,u=new Re(e),f=u.fragments,E=null,D=0,N=0,V=0,q=0,ge=null,be=new ne.Fragment(i,e),Ve=-1,Ke=!1;for(H.lastIndex=0,u.m3u8=d;(a=H.exec(d))!==null;){Ke&&(Ke=!1,(be=new ne.Fragment(i,e)).start=V,be.sn=D,be.cc=q,be.level=t,E&&(be.initSegment=E,be.rawProgramDateTime=E.rawProgramDateTime,E.rawProgramDateTime=null));var Me=a[1];if(Me){be.duration=parseFloat(Me);var We=(" "+a[2]).slice(1);be.title=We||null,be.tagList.push(We?["INF",Me,We]:["INF",Me])}else if(a[3])(0,B.isFiniteNumber)(be.duration)&&(be.start=V,s&&(be.levelkey=s),be.sn=D,be.level=t,be.cc=q,be.urlId=n,f.push(be),be.relurl=(" "+a[3]).slice(1),Z(be,ge),ge=be,V+=be.duration,D++,N=0,Ke=!0);else if(a[4]){var Xe=(" "+a[4]).slice(1);ge?be.setByteRange(Xe,ge):be.setByteRange(Xe)}else if(a[5])be.rawProgramDateTime=(" "+a[5]).slice(1),be.tagList.push(["PROGRAM-DATE-TIME",be.rawProgramDateTime]),Ve===-1&&(Ve=f.length);else{if(!(a=a[0].match(Ae))){_.logger.warn("No matches on slow regex match for level playlist!");continue}for(r=1;r<a.length&&a[r]===void 0;r++);var Ue=(" "+a[r]).slice(1),ut=(" "+a[r+1]).slice(1),tt=a[r+2]?(" "+a[r+2]).slice(1):"";switch(Ue){case"PLAYLIST-TYPE":u.type=ut.toUpperCase();break;case"MEDIA-SEQUENCE":D=u.startSN=parseInt(ut);break;case"SKIP":var Dt=new te(ut),kt=Dt.decimalInteger("SKIPPED-SEGMENTS");if((0,B.isFiniteNumber)(kt)){u.skippedSegments=kt;for(var Yt=kt;Yt--;)f.unshift(null);D+=kt}var er=Dt.enumeratedString("RECENTLY-REMOVED-DATERANGES");er&&(u.recentlyRemovedDateranges=er.split("	"));break;case"TARGETDURATION":u.targetduration=parseFloat(ut);break;case"VERSION":u.version=parseInt(ut);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(ut||tt)&&be.tagList.push(tt?[ut,tt]:[ut]);break;case"DISCONTINUITY":q++,be.tagList.push(["DIS"]);break;case"GAP":be.tagList.push([Ue]);break;case"BITRATE":be.tagList.push([Ue,ut]);break;case"DATERANGE":var Kt=new te(ut),Wt=new Q(Kt,u.dateRanges[Kt.ID]);Wt.isValid||u.skippedSegments?u.dateRanges[Wt.id]=Wt:_.logger.warn('Ignoring invalid DATERANGE tag: "'+ut+'"'),be.tagList.push(["EXT-X-DATERANGE",ut]);break;case"DISCONTINUITY-SEQUENCE":q=parseInt(ut);break;case"KEY":var ar,Tr=new te(ut),Ir=Tr.enumeratedString("METHOD"),fr=Tr.URI,Sr=Tr.hexadecimalInteger("IV"),Gr=Tr.enumeratedString("KEYFORMATVERSIONS"),ji=Tr.enumeratedString("KEYID"),xt=(ar=Tr.enumeratedString("KEYFORMAT"))!=null?ar:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(xt)>-1){_.logger.warn("Keyformat "+xt+" is not supported from the manifest");continue}if(xt!=="identity")continue;Ir&&(s=Te.LevelKey.fromURL(e,fr),fr&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Ir)>=0&&(s.method=Ir,s.keyFormat=xt,ji&&(s.keyID=ji),Gr&&(s.keyFormatVersions=Gr),s.iv=Sr));break;case"START":var Ht=new te(ut).decimalFloatingPoint("TIME-OFFSET");(0,B.isFiniteNumber)(Ht)&&(u.startTimeOffset=Ht);break;case"MAP":var Yi=new te(ut);if(be.duration){var fi=new ne.Fragment(i,e);he(fi,Yi,t,s),E=fi,be.initSegment=E,E.rawProgramDateTime&&!be.rawProgramDateTime&&(be.rawProgramDateTime=E.rawProgramDateTime)}else he(be,Yi,t,s),E=be,Ke=!0;break;case"SERVER-CONTROL":var jr=new te(ut);u.canBlockReload=jr.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=jr.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&jr.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=jr.optionalFloat("PART-HOLD-BACK",0),u.holdBack=jr.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Wi=new te(ut);u.partTarget=Wi.decimalFloatingPoint("PART-TARGET");break;case"PART":var Yr=u.partList;Yr||(Yr=u.partList=[]);var Si=N>0?Yr[Yr.length-1]:void 0,_i=N++,Wr=new ne.Part(new te(ut),be,e,_i,Si);Yr.push(Wr),be.duration+=Wr.duration;break;case"PRELOAD-HINT":var qi=new te(ut);u.preloadHint=qi;break;case"RENDITION-REPORT":var Ci=new te(ut);u.renditionReports=u.renditionReports||[],u.renditionReports.push(Ci);break;default:_.logger.warn("line parsed but not handled: "+a)}}}ge&&!ge.relurl?(f.pop(),V-=ge.duration,u.partList&&(u.fragmentHint=ge)):u.partList&&(Z(be,ge),be.cc=q,u.fragmentHint=be);var hn=f.length,rn=f[0],fn=f[hn-1];if((V+=u.skippedSegments*u.targetduration)>0&&hn&&fn){u.averagetargetduration=V/hn;var Ln=fn.sn;u.endSN=Ln!=="initSegment"?Ln:0,rn&&(u.startCC=rn.cc,rn.initSegment||u.fragments.every(function(zi){return zi.relurl&&(Xi=zi.relurl,_e.test((Qi=(wi=ie.parseURL(Xi))===null||wi===void 0?void 0:wi.path)!=null?Qi:""));var Xi,Qi,wi})&&(_.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(be=new ne.Fragment(i,e)).relurl=fn.relurl,be.level=t,be.sn="initSegment",rn.initSegment=be,u.needSidxRanges=!0))}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(V+=u.fragmentHint.duration),u.totalduration=V,u.endCC=q,Ve>0&&function(zi,Xi){for(var Qi=zi[Xi],wi=Xi;wi--;){var nn=zi[wi];if(!nn)return;nn.programDateTime=Qi.programDateTime-1e3*nn.duration,Qi=nn}}(f,Ve),u},v}();function U(v,d){["video","audio","text"].forEach(function(e){var t=v.filter(function(n){return function(a,r){var s=Pe[r];return!!s&&s[a.slice(0,4)]===!0}(n,e)});if(t.length){var i=t.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});d[e+"Codec"]=i.length>0?i[0]:t[0],v=v.filter(function(n){return t.indexOf(n)===-1})}}),d.unknownCodecs=v}function ue(v,d,e){var t=d[e];t&&(v[e]=t)}function Z(v,d){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):d!=null&&d.programDateTime&&(v.programDateTime=d.endProgramDateTime),(0,B.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function he(v,d,e,t){v.relurl=d.URI,d.BYTERANGE&&v.setByteRange(d.BYTERANGE),v.level=e,v.sn="initSegment",t&&(v.levelkey=t),v.initSegment=null}var G=X(308);function xe(v,d){var e=v.url;return e!==void 0&&e.indexOf("data:")!==0||(e=d.url),e}const Ge=function(){function v(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var d=v.prototype;return d.startLoad=function(e){},d.stopLoad=function(){this.destroyInternalLoaders()},d.registerListeners=function(){var e=this.hls;e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(c.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(c.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,a=new(i||n)(t);return e.loader=a,this.loaders[e.type]=a,a},d.getInternalLoader=function(e){return this.loaders[e.type]},d.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},d.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},d.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},d.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:G.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},d.onLevelLoading=function(e,t){var i=t.id,n=t.level,a=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:G.PlaylistContextType.LEVEL,url:a,deliveryDirectives:r})},d.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,a=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:G.PlaylistContextType.AUDIO_TRACK,url:a,deliveryDirectives:r})},d.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,a=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:G.PlaylistContextType.SUBTITLE_TRACK,url:a,deliveryDirectives:r})},d.load=function(e){var t,i,n,a,r,s,u=this.hls.config,f=this.getInternalLoader(e);if(f){var E=f.context;if(E&&E.url===e.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}switch(e.type){case G.PlaylistContextType.MANIFEST:i=u.manifestLoadingMaxRetry,n=u.manifestLoadingTimeOut,a=u.manifestLoadingRetryDelay,r=u.manifestLoadingMaxRetryTimeout;break;case G.PlaylistContextType.LEVEL:case G.PlaylistContextType.AUDIO_TRACK:case G.PlaylistContextType.SUBTITLE_TRACK:i=0,n=u.levelLoadingTimeOut;break;default:i=u.levelLoadingMaxRetry,n=u.levelLoadingTimeOut,a=u.levelLoadingRetryDelay,r=u.levelLoadingMaxRetryTimeout}if(f=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part&&(e.type===G.PlaylistContextType.LEVEL&&e.level!==null?s=this.hls.levels[e.level].details:e.type===G.PlaylistContextType.AUDIO_TRACK&&e.id!==null?s=this.hls.audioTracks[e.id].details:e.type===G.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(s=this.hls.subtitleTracks[e.id].details),s)){var D=s.partTarget,N=s.targetduration;D&&N&&(n=Math.min(1e3*Math.max(3*D,.8*N),n))}var V={timeout:n,maxRetry:i,retryDelay:a,maxRetryDelay:r,highWaterMark:0},q={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,V,q)},d.loadsuccess=function(e,t,i,n){if(n===void 0&&(n=null),i.isSidxRequest)return this.handleSidxRequest(e,i),void this.handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var a=e.data;a.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,n):this.handleMasterPlaylist(e,t,i,n)):this.handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},d.loaderror=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,e)},d.loadtimeout=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},d.handleMasterPlaylist=function(e,t,i,n){var a=this.hls,r=e.data,s=xe(e,i),u=we.parseMasterPlaylist(r,s),f=u.levels,E=u.sessionData;if(f.length){var D=f.map(function(be){return{id:be.attrs.AUDIO,audioCodec:be.audioCodec}}),N=f.map(function(be){return{id:be.attrs.SUBTITLES,textCodec:be.textCodec}}),V=we.parseMasterPlaylistMedia(r,s,"AUDIO",D),q=we.parseMasterPlaylistMedia(r,s,"SUBTITLES",N),ge=we.parseMasterPlaylistMedia(r,s,"CLOSED-CAPTIONS");V.length&&(V.some(function(be){return!be.url})||!f[0].audioCodec||f[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),V.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new te({}),bitrate:0,url:""}))),a.trigger(c.Events.MANIFEST_LOADED,{levels:f,audioTracks:V,subtitles:q,captions:ge,url:s,stats:t,networkDetails:n,sessionData:E})}else this.handleManifestParsingError(e,i,"no level found in manifest",n)},d.handleTrackOrLevelPlaylist=function(e,t,i,n){var a=this.hls,r=i.id,s=i.level,u=i.type,f=xe(e,i),E=(0,B.isFiniteNumber)(r)?r:0,D=(0,B.isFiniteNumber)(s)?s:E,N=function(Ve){switch(Ve.type){case G.PlaylistContextType.AUDIO_TRACK:return G.PlaylistLevelType.AUDIO;case G.PlaylistContextType.SUBTITLE_TRACK:return G.PlaylistLevelType.SUBTITLE;default:return G.PlaylistLevelType.MAIN}}(i),V=we.parseLevelPlaylist(e.data,f,D,N,E);if(V.fragments.length){if(u===G.PlaylistContextType.MANIFEST){var q={attrs:new te({}),bitrate:0,details:V,name:"",url:f};a.trigger(c.Events.MANIFEST_LOADED,{levels:[q],audioTracks:[],url:f,stats:t,networkDetails:n,sessionData:null})}if(t.parsing.end=performance.now(),V.needSidxRanges){var ge,be=(ge=V.fragments[0].initSegment)===null||ge===void 0?void 0:ge.url;this.load({url:be,isSidxRequest:!0,type:u,level:s,levelDetails:V,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=V,this.handlePlaylistLoaded(e,t,i,n)}else a.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},d.handleSidxRequest=function(e,t){var i=new Uint8Array(e.data),n=(0,se.findBox)(i,["sidx"])[0];if(n){var a=(0,se.parseSegmentIndex)(n);if(a){var r=a.references,s=t.levelDetails;r.forEach(function(u,f){var E=u.info,D=s.fragments[f];if(D.byteRange.length===0&&D.setByteRange(String(1+E.end-E.start)+"@"+String(E.start)),D.initSegment){var N=(0,se.findBox)(i,["moov"])[0],V=N?N.length:null;D.initSegment.setByteRange(String(V)+"@0")}})}}},d.handleManifestParsingError=function(e,t,i,n){this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===G.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:n})},d.handleNetworkError=function(e,t,i,n){i===void 0&&(i=!1),_.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var a=P.ErrorDetails.UNKNOWN,r=!1,s=this.getInternalLoader(e);switch(e.type){case G.PlaylistContextType.MANIFEST:a=i?P.ErrorDetails.MANIFEST_LOAD_TIMEOUT:P.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case G.PlaylistContextType.LEVEL:a=i?P.ErrorDetails.LEVEL_LOAD_TIMEOUT:P.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case G.PlaylistContextType.AUDIO_TRACK:a=i?P.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:P.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case G.PlaylistContextType.SUBTITLE_TRACK:a=i?P.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:P.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1}s&&this.resetInternalLoader(e.type);var u={type:P.ErrorTypes.NETWORK_ERROR,details:a,fatal:r,url:e.url,loader:s,context:e,networkDetails:t};n&&(u.response=n),this.hls.trigger(c.Events.ERROR,u)},d.handlePlaylistLoaded=function(e,t,i,n){var a=i.type,r=i.level,s=i.id,u=i.groupId,f=i.loader,E=i.levelDetails,D=i.deliveryDirectives;if(E!=null&&E.targetduration){if(f)switch(E.live&&(f.getCacheAge&&(E.ageHeader=f.getCacheAge()||0),f.getCacheAge&&!isNaN(E.ageHeader)||(E.ageHeader=0)),a){case G.PlaylistContextType.MANIFEST:case G.PlaylistContextType.LEVEL:this.hls.trigger(c.Events.LEVEL_LOADED,{details:E,level:r||0,id:s||0,stats:t,networkDetails:n,deliveryDirectives:D});break;case G.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,{details:E,id:s||0,groupId:u||"",stats:t,networkDetails:n,deliveryDirectives:D});break;case G.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADED,{details:E,id:s||0,groupId:u||"",stats:t,networkDetails:n,deliveryDirectives:D})}}else this.handleManifestParsingError(e,i,"invalid target duration",n)},v}();var qe=function(){function v(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this.registerListeners()}var d=v.prototype;return d.startLoad=function(e){},d.stopLoad=function(){this.destroyInternalLoaders()},d.registerListeners=function(){this.hls.on(c.Events.KEY_LOADING,this.onKeyLoading,this)},d.unregisterListeners=function(){this.hls.off(c.Events.KEY_LOADING,this.onKeyLoading)},d.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},d.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},d.onKeyLoading=function(e,t){var i=t.frag,n=i.type,a=this.loaders[n];if(i.decryptdata){var r=i.decryptdata.uri;if(r!==this.decrypturl||this.decryptkey===null){var s=this.hls.config;if(a&&(_.logger.warn("abort previous key loader for type:"+n),a.abort()),!r)return void _.logger.warn("key uri is falsy");var u=s.loader,f=i.loader=this.loaders[n]=new u(s);this.decrypturl=r,this.decryptkey=null;var E={url:r,frag:i,responseType:"arraybuffer"},D={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:0},N={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(E,D,N)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(c.Events.KEY_LOADED,{frag:i}))}else _.logger.warn("Missing decryption data on fragment in onKeyLoading")},d.loadsuccess=function(e,t,i){var n=i.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(c.Events.KEY_LOADED,{frag:n})):_.logger.error("after key load, decryptdata unset")},d.loaderror=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},d.loadtimeout=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},v}();function it(v,d){var e;try{e=new Event("addtrack")}catch(t){(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=v,d.dispatchEvent(e)}function me(v,d){var e=v.mode;if(e==="disabled"&&(v.mode="hidden"),v.cues&&!v.cues.getCueById(d.id))try{if(v.addCue(d),!v.cues.getCueById(d.id))throw new Error("addCue is failed for: "+d)}catch(i){_.logger.debug("[texttrack-utils]: "+i);var t=new self.TextTrackCue(d.startTime,d.endTime,d.text);t.id=d.id,v.addCue(t)}e==="disabled"&&(v.mode=e)}function Ze(v){var d=v.mode;if(d==="disabled"&&(v.mode="hidden"),v.cues)for(var e=v.cues.length;e--;)v.removeCue(v.cues[e]);d==="disabled"&&(v.mode=d)}function st(v,d,e,t){var i=v.mode;if(i==="disabled"&&(v.mode="hidden"),v.cues&&v.cues.length>0)for(var n=function(r,s,u){var f=[],E=function(q,ge){if(ge<q[0].startTime)return 0;var be=q.length-1;if(ge>q[be].endTime)return-1;for(var Ve=0,Ke=be;Ve<=Ke;){var Me=Math.floor((Ke+Ve)/2);if(ge<q[Me].startTime)Ke=Me-1;else{if(!(ge>q[Me].startTime&&Ve<be))return Me;Ve=Me+1}}return q[Ve].startTime-ge<ge-q[Ke].startTime?Ve:Ke}(r,s);if(E>-1)for(var D=E,N=r.length;D<N;D++){var V=r[D];if(V.startTime>=s&&V.endTime<=u)f.push(V);else if(V.startTime>u)return f}return f}(v.cues,d,e),a=0;a<n.length;a++)t&&!t(n[a])||v.removeCue(n[a]);i==="disabled"&&(v.mode=i)}var Et=X(181),lt=X(856);function vt(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var St=function(){var v=vt();try{new v(0,Number.POSITIVE_INFINITY,"")}catch(d){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function gt(v,d){return v.getTime()/1e3-d}const At=function(){function v(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var d=v.prototype;return d.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},d._registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},d._unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},d.onMediaAttached=function(e,t){this.media=t.media},d.onMediaDetaching=function(){this.id3Track&&(Ze(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},d.onManifestLoading=function(){this.dateRangeCuesAppended={}},d.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},d.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if(i.kind==="metadata"&&i.label==="id3")return it(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},d.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,a=i.enableID3MetadataCues;if(n||a){t.frag;var r=t.samples;t.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=vt(),u=0;u<r.length;u++){var f=r[u].type;if((f!==lt.MetadataSchema.emsg||n)&&a){var E=Et.getID3Frames(r[u].data);if(E){var D=r[u].pts,N=D+r[u].duration;N>St&&(N=St),N-D<=0&&(N=D+.25);for(var V=0;V<E.length;V++){var q=E[V];if(!Et.isTimeStampFrame(q)){this.updateId3CueEnds(D);var ge=new s(D,N,"");ge.value=q,f&&(ge.type=f),this.id3Track.addCue(ge)}}}}}}}},d.updateId3CueEnds=function(e){var t,i=(t=this.id3Track)===null||t===void 0?void 0:t.cues;if(i)for(var n=i.length;n--;){var a=i[n];a.startTime<e&&a.endTime===St&&(a.endTime=e)}},d.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,a=t.type,r=this.id3Track,s=this.hls;if(s){var u=s.config,f=u.enableEmsgMetadataCues,E=u.enableID3MetadataCues;r&&(f||E)&&st(r,i,n,a==="audio"?function(D){return D.type===lt.MetadataSchema.audioId3&&E}:a==="video"?function(D){return D.type===lt.MetadataSchema.emsg&&f}:function(D){return D.type===lt.MetadataSchema.audioId3&&E||D.type===lt.MetadataSchema.emsg&&f})}},d.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,r=this.id3Track,s=n.dateRanges,u=Object.keys(s);if(r)for(var f=Object.keys(a).filter(function(Ve){return!u.includes(Ve)}),E=function(Ve){var Ke=f[Ve];Object.keys(a[Ke].cues).forEach(function(Me){r.removeCue(a[Ke].cues[Me])}),delete a[Ke]},D=f.length;D--;)E(D);var N=n.fragments[n.fragments.length-1];if(u.length!==0&&(0,B.isFiniteNumber)(N==null?void 0:N.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var V=N.programDateTime/1e3-N.start,q=vt(),ge=function(Ve){var Ke=u[Ve],Me=s[Ke],We=a[Ke],Xe=(We==null?void 0:We.cues)||{},Ue=(We==null?void 0:We.durationKnown)||!1,ut=gt(Me.startDate,V),tt=St,Dt=Me.endDate;if(Dt)tt=gt(Dt,V),Ue=!0;else if(Me.endOnNext&&!Ue){var kt=u.reduce(function(Ir,fr){var Sr=s[fr];return Sr.class===Me.class&&Sr.id!==fr&&Sr.startDate>Me.startDate&&Ir.push(Sr),Ir},[]).sort(function(Ir,fr){return Ir.startDate.getTime()-fr.startDate.getTime()})[0];kt&&(tt=gt(kt.startDate,V),Ue=!0)}for(var Yt,er=Object.keys(Me.attr),Kt=0;Kt<er.length;Kt++){var Wt=er[Kt];if(Wt!==Ee.ID&&Wt!==Ee.CLASS&&Wt!==Ee.START_DATE&&Wt!==Ee.DURATION&&Wt!==Ee.END_DATE&&Wt!==Ee.END_ON_NEXT){var ar=Xe[Wt];if(ar)Ue&&!We.durationKnown&&(ar.endTime=tt);else{var Tr=Me.attr[Wt];ar=new q(ut,tt,""),Wt!==Ee.SCTE35_OUT&&Wt!==Ee.SCTE35_IN||(Yt=Tr,Tr=Uint8Array.from(Yt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),ar.value={key:Wt,data:Tr},ar.type=lt.MetadataSchema.dateRange,i.id3Track.addCue(ar),Xe[Wt]=ar}}}a[Ke]={cues:Xe,dateRange:Me,durationKnown:Ue}},be=0;be<u.length;be++)ge(be)}}},v}();function Lt(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}var yt,Ot=function(){function v(i){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=i,this.config=i.config,this.registerListeners()}var d,e,t=v.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.Events.ERROR,this.onError)},t.onMediaAttached=function(i,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(i,n){var a=n.details;this.levelDetails=a,a.advanced&&this.timeupdate(),!a.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(i,n){n.details===P.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,_.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var i=this.media,n=this.levelDetails;if(i&&n){this.currentTime=i.currentTime;var a=this.computeLatency();if(a!==null){this._latency=a;var r=this.config,s=r.lowLatencyMode,u=r.maxLiveSyncPlaybackRate;if(s&&u!==1){var f=this.targetLatency;if(f!==null){var E=a-f,D=E<Math.min(this.maxLatency,f+n.targetduration);if(n.live&&D&&E>.05&&this.forwardBufferLength>1){var N=Math.min(2,Math.max(1,u)),V=Math.round(2/(1+Math.exp(-.75*E-this.edgeStalled))*20)/20;i.playbackRate=Math.min(N,Math.max(1,V))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var i=this.levelDetails;return i===null?null:i.edge+i.age},t.computeLatency=function(){var i=this.estimateLiveEdge();return i===null?null:i-this.currentTime},d=v,(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var i=this.config,n=this.levelDetails;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:n?i.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var i=this.levelDetails;if(i===null)return null;var n=i.holdBack,a=i.partHoldBack,r=i.targetduration,s=this.config,u=s.liveSyncDuration,f=s.liveSyncDurationCount,E=s.lowLatencyMode,D=this.hls.userConfig,N=E&&a||n;(D.liveSyncDuration||D.liveSyncDurationCount||N===0)&&(N=u!==void 0?u:f*r);var V=r;return N+Math.min(1*this.stallCount,V)}},{key:"liveSyncPosition",get:function(){var i=this.estimateLiveEdge(),n=this.targetLatency,a=this.levelDetails;if(i===null||n===null||a===null)return null;var r=a.edge,s=i-n-this.edgeStalled,u=r-a.totalduration,f=r-(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.min(Math.max(u,s),f)}},{key:"drift",get:function(){var i=this.levelDetails;return i===null?1:i.drift}},{key:"edgeStalled",get:function(){var i=this.levelDetails;if(i===null)return 0;var n=3*(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.max(i.age-n,0)}},{key:"forwardBufferLength",get:function(){var i=this.media,n=this.levelDetails;if(!i||!n)return 0;var a=i.buffered.length;return(a?i.buffered.end(a-1):n.edge)-this.currentTime}}])&&Lt(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();function _t(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}(function(v){v.No="",v.Yes="YES",v.v2="v2"})(yt||(yt={}));var Jt=function(){function v(d,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=d,this.part=e,this.skip=t}return v.prototype.addDirectives=function(d){var e=new self.URL(d);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},v}(),Gt=function(){function v(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(i){return i}).join(",").replace(/\.[^.,]+/g,"")}var d,e;return d=v,(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&_t(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();function wt(){return wt=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},wt.apply(this,arguments)}function tr(v,d,e){switch(d){case"audio":v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds.push(e);break;case"text":v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds.push(e)}}function Zt(v){var d={};v.forEach(function(e){var t=e.groupId||"";e.id=d[t]=d[t]||0,d[t]++})}function rr(v,d){var e=d.startPTS;if((0,B.isFiniteNumber)(e)){var t,i=0;d.sn>v.sn?(i=e-v.start,t=v):(i=v.start-e,t=d),t.duration!==i&&(t.duration=i)}else d.sn>v.sn?v.cc===d.cc&&v.minEndPTS?d.start=v.start+(v.minEndPTS-v.start):d.start=v.start+v.duration:d.start=Math.max(v.start-d.duration,0)}function lr(v,d,e,t,i,n){t-e<=0&&(_.logger.warn("Fragment should have a positive duration",d),t=e+d.duration,n=i+d.duration);var a=e,r=t,s=d.startPTS,u=d.endPTS;if((0,B.isFiniteNumber)(s)){var f=Math.abs(s-e);(0,B.isFiniteNumber)(d.deltaPTS)?d.deltaPTS=Math.max(f,d.deltaPTS):d.deltaPTS=f,a=Math.max(e,s),e=Math.min(e,s),i=Math.min(i,d.startDTS),r=Math.min(t,u),t=Math.max(t,u),n=Math.max(n,d.endDTS)}d.duration=t-e;var E=e-d.start;d.appendedPTS=t,d.start=d.startPTS=e,d.maxStartPTS=a,d.startDTS=i,d.endPTS=t,d.minEndPTS=r,d.endDTS=n;var D,N=d.sn;if(!v||N<v.startSN||N>v.endSN)return 0;var V=N-v.startSN,q=v.fragments;for(q[V]=d,D=V;D>0;D--)rr(q[D],q[D-1]);for(D=V;D<q.length-1;D++)rr(q[D],q[D+1]);return v.fragmentHint&&rr(q[q.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,E}function ur(v,d){var e=d.startSN+d.skippedSegments-v.startSN,t=v.fragments;e<0||e>=t.length||hr(d,t[e].start)}function hr(v,d){if(d){for(var e=v.fragments,t=v.skippedSegments;t<e.length;t++)e[t].start+=d;v.fragmentHint&&(v.fragmentHint.start+=d)}}var Xt=function(){function v(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,t+":"),this.warn=_.logger.warn.bind(_.logger,t+":"),this.hls=e}var d=v.prototype;return d.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},d.onError=function(e,t){t.fatal&&t.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},d.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},d.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},d.stopLoad=function(){this.canLoad=!1,this.clearTimer()},d.switchParams=function(e,t){var i=t==null?void 0:t.renditionReports;if(i)for(var n=0;n<i.length;n++){var a=i[n],r=""+a.URI;if(r===e.slice(-r.length)){var s=parseInt(a["LAST-MSN"]),u=parseInt(a["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var f=Math.min(t.age-t.partTarget,t.targetduration);u!==void 0&&f>t.partTarget&&(u+=1)}if((0,B.isFiniteNumber)(s))return new Jt(s,(0,B.isFiniteNumber)(u)?u:void 0,yt.No)}}},d.loadPlaylist=function(e){},d.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},d.playlistLoaded=function(e,t,i){var n=this,a=t.details,r=t.stats,s=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(a.advancedDateTime=Date.now()-s,a.live||i!=null&&i.live){if(a.reloaded(i),i&&this.log("live playlist "+e+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),i&&a.fragments.length>0&&function(Xe,Ue){for(var ut=null,tt=Xe.fragments,Dt=tt.length-1;Dt>=0;Dt--){var kt=tt[Dt].initSegment;if(kt){ut=kt;break}}Xe.fragmentHint&&delete Xe.fragmentHint.endPTS;var Yt,er,Kt,Wt,ar,Tr=0;if(function(xt,Ht,Yi){for(var fi=Ht.skippedSegments,jr=Math.max(xt.startSN,Ht.startSN)-Ht.startSN,Wi=(xt.fragmentHint?1:0)+(fi?Ht.endSN:Math.min(xt.endSN,Ht.endSN))-Ht.startSN,Yr=Ht.startSN-xt.startSN,Si=Ht.fragmentHint?Ht.fragments.concat(Ht.fragmentHint):Ht.fragments,_i=xt.fragmentHint?xt.fragments.concat(xt.fragmentHint):xt.fragments,Wr=jr;Wr<=Wi;Wr++){var qi=_i[Yr+Wr],Ci=Si[Wr];fi&&!Ci&&Wr<fi&&(Ci=Ht.fragments[Wr]=qi),qi&&Ci&&Yi(qi,Ci)}}(Xe,Ue,function(xt,Ht){xt.relurl&&(Tr=xt.cc-Ht.cc),(0,B.isFiniteNumber)(xt.startPTS)&&(0,B.isFiniteNumber)(xt.endPTS)&&(Ht.start=Ht.startPTS=xt.startPTS,Ht.startDTS=xt.startDTS,Ht.appendedPTS=xt.appendedPTS,Ht.maxStartPTS=xt.maxStartPTS,Ht.endPTS=xt.endPTS,Ht.endDTS=xt.endDTS,Ht.minEndPTS=xt.minEndPTS,Ht.duration=xt.endPTS-xt.startPTS,Ht.duration&&(Yt=Ht),Ue.PTSKnown=Ue.alignedSliding=!0),Ht.elementaryStreams=xt.elementaryStreams,Ht.loader=xt.loader,Ht.stats=xt.stats,Ht.urlId=xt.urlId,xt.initSegment&&(Ht.initSegment=xt.initSegment,ut=xt.initSegment)}),ut&&(Ue.fragmentHint?Ue.fragments.concat(Ue.fragmentHint):Ue.fragments).forEach(function(xt){var Ht;xt.initSegment&&xt.initSegment.relurl!==((Ht=ut)===null||Ht===void 0?void 0:Ht.relurl)||(xt.initSegment=ut)}),Ue.skippedSegments)if(Ue.deltaUpdateFailed=Ue.fragments.some(function(xt){return!xt}),Ue.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var Ir=Ue.skippedSegments;Ir--;)Ue.fragments.shift();Ue.startSN=Ue.fragments[0].sn,Ue.startCC=Ue.fragments[0].cc}else Ue.canSkipDateRanges&&(Ue.dateRanges=(er=Xe.dateRanges,Kt=Ue.dateRanges,Wt=Ue.recentlyRemovedDateranges,ar=wt({},er),Wt&&Wt.forEach(function(xt){delete ar[xt]}),Object.keys(Kt).forEach(function(xt){var Ht=new Q(Kt[xt].attr,ar[xt]);Ht.isValid?ar[xt]=Ht:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Kt[xt].attr)+'"')}),ar));var fr=Ue.fragments;if(Tr){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var Sr=0;Sr<fr.length;Sr++)fr[Sr].cc+=Tr}Ue.skippedSegments&&(Ue.startCC=Ue.fragments[0].cc),function(xt,Ht,Yi){if(xt&&Ht)for(var fi=0,jr=0,Wi=xt.length;jr<=Wi;jr++){var Yr=xt[jr],Si=Ht[jr+fi];Yr&&Si&&Yr.index===Si.index&&Yr.fragment.sn===Si.fragment.sn?(_i=Yr,(Wr=Si).elementaryStreams=_i.elementaryStreams,Wr.stats=_i.stats):fi--}var _i,Wr}(Xe.partList,Ue.partList),Yt?lr(Ue,Yt,Yt.startPTS,Yt.endPTS,Yt.startDTS,Yt.endDTS):ur(Xe,Ue),fr.length&&(Ue.totalduration=Ue.edge-fr[0].start),Ue.driftStartTime=Xe.driftStartTime,Ue.driftStart=Xe.driftStart;var Gr=Ue.advancedDateTime;if(Ue.advanced&&Gr){var ji=Ue.edge;Ue.driftStart||(Ue.driftStartTime=Gr,Ue.driftStart=ji),Ue.driftEndTime=Gr,Ue.driftEnd=ji}else Ue.driftEndTime=Xe.driftEndTime,Ue.driftEnd=Xe.driftEnd,Ue.advancedDateTime=Xe.advancedDateTime}(i,a),!this.canLoad||!a.live)return;var u,f=void 0,E=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var D=this.hls.config.lowLatencyMode,N=a.lastPartSn,V=a.endSN,q=a.lastPartIndex,ge=N===V;q!==-1?(f=ge?V+1:N,E=ge?D?0:q:q+1):f=V+1;var be=a.age,Ve=be+a.ageHeader,Ke=Math.min(Ve-a.partTarget,1.5*a.targetduration);if(Ke>0){if(i&&Ke>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+Ke+" with playlist age: "+a.age),Ke=0;else{var Me=Math.floor(Ke/a.targetduration);f+=Me,E!==void 0&&(E+=Math.round(Ke%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+be.toFixed(2)+"s goal: "+Ke+" skip sn "+Me+" to part "+E)}a.tuneInGoal=Ke}if(u=this.getDeliveryDirectives(a,t.deliveryDirectives,f,E),D||!ge)return void this.loadPlaylist(u)}else u=this.getDeliveryDirectives(a,t.deliveryDirectives,f,E);var We=function(Xe,Ue){var ut,tt=1e3*Xe.levelTargetDuration,Dt=tt/2,kt=Xe.age,Yt=kt>0&&kt<3*tt,er=Ue.loading.end-Ue.loading.start,Kt=Xe.availabilityDelay;if(Xe.updated===!1)if(Yt){var Wt=333*Xe.misses;ut=Math.max(Math.min(Dt,2*er),Wt),Xe.availabilityDelay=(Xe.availabilityDelay||0)+ut}else ut=Dt;else Yt?(Kt=Math.min(Kt||tt/2,kt),Xe.availabilityDelay=Kt,ut=Kt+tt-kt):ut=tt-er;return Math.round(ut)}(a,r);f!==void 0&&a.canBlockReload&&(We-=a.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(We)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(u)},We)}else this.clearTimer()},d.getDeliveryDirectives=function(e,t,i,n){var a=function(r,s){var u=r.canSkipUntil,f=r.canSkipDateRanges,E=r.endSN;return u&&(s!==void 0?s-E:0)<u?f?yt.v2:yt.Yes:yt.No}(e,i);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,a=yt.No),new Jt(i,n,a)},d.retryLoadingOrFail=function(e){var t,i=this,n=this.hls.config,a=this.retryCount<n.levelLoadingMaxRetry;if(a)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&(t=e.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return i.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return a},v}();function sr(){return sr=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},sr.apply(this,arguments)}function ye(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ae(v,d){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ae(v,d)}var x,ee=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),$=function(v){var d,e;function t(r){var s;return(s=v.call(this,r,"[level-controller]")||this)._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ae(d,e);var i,n,a=t.prototype;return a._registerListeners=function(){var r=this.hls;r.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(c.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(c.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,v.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),v.prototype.startLoad.call(this)},a.onManifestLoaded=function(r,s){var u,f,E=[],D=[],N=[],V={},q=!1,ge=!1,be=!1;if(s.levels.forEach(function(We){var Xe=We.attrs;q=q||!(!We.width||!We.height),ge=ge||!!We.videoCodec,be=be||!!We.audioCodec,ee&&We.audioCodec&&We.audioCodec.indexOf("mp4a.40.34")!==-1&&(We.audioCodec=void 0);var Ue=We.bitrate+"-"+We.attrs.RESOLUTION+"-"+We.attrs.CODECS;(f=V[Ue])?f.url.push(We.url):(f=new Gt(We),V[Ue]=f,E.push(f)),Xe&&(Xe.AUDIO&&tr(f,"audio",Xe.AUDIO),Xe.SUBTITLES&&tr(f,"text",Xe.SUBTITLES))}),(q||ge)&&be&&(E=E.filter(function(We){var Xe=We.videoCodec,Ue=We.width,ut=We.height;return!!Xe||!(!Ue||!ut)})),E=E.filter(function(We){var Xe=We.audioCodec,Ue=We.videoCodec;return(!Xe||F(Xe,"audio"))&&(!Ue||F(Ue,"video"))}),s.audioTracks&&Zt(D=s.audioTracks.filter(function(We){return!We.audioCodec||F(We.audioCodec,"audio")})),s.subtitles&&Zt(N=s.subtitles),E.length>0){u=E[0].bitrate,E.sort(function(We,Xe){return We.bitrate-Xe.bitrate}),this._levels=E;for(var Ve=0;Ve<E.length;Ve++)if(E[Ve].bitrate===u){this._firstLevel=Ve,this.log("manifest loaded, "+E.length+" level(s) found, first bitrate: "+u);break}var Ke=be&&!ge,Me={levels:E,audioTracks:D,subtitleTracks:N,firstLevel:this._firstLevel,stats:s.stats,audio:be,video:ge,altAudio:!Ke&&D.some(function(We){return!!We.url})};this.hls.trigger(c.Events.MANIFEST_PARSED,Me),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(r,s){var u;if(v.prototype.onError.call(this,r,s),!s.fatal){var f=s.context,E=this._levels[this.currentLevelIndex];if(f&&(f.type===G.PlaylistContextType.AUDIO_TRACK&&E.audioGroupIds&&f.groupId===E.audioGroupIds[E.urlId]||f.type===G.PlaylistContextType.SUBTITLE_TRACK&&E.textGroupIds&&f.groupId===E.textGroupIds[E.urlId]))this.redundantFailover(this.currentLevelIndex);else{var D,N=!1,V=!0;switch(s.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:if(s.frag){var q=s.frag.type===G.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,ge=this._levels[q];ge?(ge.fragmentError++,ge.fragmentError>this.hls.config.fragLoadingMaxRetry&&(D=q)):D=q}break;case P.ErrorDetails.LEVEL_LOAD_ERROR:case P.ErrorDetails.LEVEL_LOAD_TIMEOUT:f&&(f.deliveryDirectives&&(V=!1),D=f.level),N=!0;break;case P.ErrorDetails.REMUX_ALLOC_ERROR:D=(u=s.level)!=null?u:this.currentLevelIndex,N=!0}D!==void 0&&this.recoverLevel(s,D,N,V)}}},a.recoverLevel=function(r,s,u,f){var E=r.details,D=this._levels[s];if(D.loadError++,u){if(!this.retryLoadingOrFail(r))return void(this.currentLevelIndex=-1);r.levelRetry=!0}if(f){var N=D.url.length;if(N>1&&D.loadError<N)r.levelRetry=!0,this.redundantFailover(s);else if(this.manualLevelIndex===-1){for(var V=-1,q=this._levels,ge=q.length;ge--;){var be=(ge+this.currentLevelIndex)%q.length;if(be!==this.currentLevelIndex&&q[be].loadError===0){V=be;break}}V>-1&&this.currentLevelIndex!==V&&(this.warn(E+": switch to "+V),r.levelRetry=!0,this.hls.nextAutoLevel=V)}}},a.redundantFailover=function(r){var s=this._levels[r],u=s.url.length;if(u>1){var f=(s.urlId+1)%u;this.warn("Switching to redundant URL-id "+f),this._levels.forEach(function(E){E.urlId=f}),this.level=r}},a.onFragLoaded=function(r,s){var u=s.frag;if(u!==void 0&&u.type===G.PlaylistLevelType.MAIN){var f=this._levels[u.level];f!==void 0&&(f.fragmentError=0,f.loadError=0)}},a.onLevelLoaded=function(r,s){var u,f,E=s.level,D=s.details,N=this._levels[E];if(!N)return this.warn("Invalid level index "+E),void((f=s.deliveryDirectives)!==null&&f!==void 0&&f.skip&&(D.deltaUpdateFailed=!0));E===this.currentLevelIndex?(N.fragmentError===0&&(N.loadError=0,this.retryCount=0),this.playlistLoaded(E,s,N.details)):(u=s.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(D.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(r,s){var u=this.hls.levels[this.currentLevelIndex];if(u&&u.audioGroupIds){for(var f=-1,E=this.hls.audioTracks[s.id].groupId,D=0;D<u.audioGroupIds.length;D++)if(u.audioGroupIds[D]===E){f=D;break}f!==u.urlId&&(u.urlId=f,this.startLoad())}},a.loadPlaylist=function(r){var s=this.currentLevelIndex,u=this._levels[s];if(this.canLoad&&u&&u.url.length>0){var f=u.urlId,E=u.url[f];if(r)try{E=r.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("Attempt loading level index "+s+(r?" at sn "+r.msn+" part "+r.part:"")+" with URL-id "+f+" "+E),this.clearTimer(),this.hls.trigger(c.Events.LEVEL_LOADING,{url:E,level:s,id:f,deliveryDirectives:r||null})}},a.removeLevel=function(r,s){var u=function(E,D){return D!==s},f=this._levels.filter(function(E,D){return D!==r||E.url.length>1&&s!==void 0&&(E.url=E.url.filter(u),E.audioGroupIds&&(E.audioGroupIds=E.audioGroupIds.filter(u)),E.textGroupIds&&(E.textGroupIds=E.textGroupIds.filter(u)),E.urlId=0,!0)}).map(function(E,D){var N=E.details;return N!=null&&N.fragments&&N.fragments.forEach(function(V){V.level=D}),E});this._levels=f,this.hls.trigger(c.Events.LEVELS_UPDATED,{levels:f})},i=t,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var s,u=this._levels;if(u.length!==0&&(this.currentLevelIndex!==r||(s=u[r])===null||s===void 0||!s.details)){if(r<0||r>=u.length){var f=r<0;if(this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.LEVEL_SWITCH_ERROR,level:r,fatal:f,reason:"invalid level idx"}),f)return;r=Math.min(r,u.length-1)}this.clearTimer();var E=this.currentLevelIndex,D=u[E],N=u[r];this.log("switching to level "+r+" from "+E),this.currentLevelIndex=r;var V=sr({},N,{level:r,maxBitrate:N.maxBitrate,uri:N.uri,urlId:N.urlId});delete V._urlId,this.hls.trigger(c.Events.LEVEL_SWITCHING,V);var q=N.details;if(!q||q.live){var ge=this.switchParams(N.uri,D==null?void 0:D.details);this.loadPlaylist(ge)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this._firstLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}])&&ye(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Xt);(function(v){v.NOT_LOADED="NOT_LOADED",v.APPENDING="APPENDING",v.PARTIAL="PARTIAL",v.OK="OK"})(x||(x={}));var ce=function(){function v(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var d=v.prototype;return d._registerListeners=function(){var e=this.hls;e.on(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(c.Events.FRAG_LOADED,this.onFragLoaded,this)},d._unregisterListeners=function(){var e=this.hls;e.off(c.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(c.Events.FRAG_LOADED,this.onFragLoaded,this)},d.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},d.getAppendedFrag=function(e,t){if(t===G.PlaylistLevelType.MAIN){var i=this.activeFragment,n=this.activeParts;if(!i)return null;if(n)for(var a=n.length;a--;){var r=n[a],s=r?r.end:i.appendedPTS;if(r.start<=e&&s!==void 0&&e<=s)return a>9&&(this.activeParts=n.slice(a-9)),r}else if(i.start<=e&&i.appendedPTS!==void 0&&e<=i.appendedPTS)return i}return this.getBufferedFrag(e,t)},d.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),a=n.length;a--;){var r=i[n[a]];if((r==null?void 0:r.body.type)===t&&r.buffered){var s=r.body;if(s.start<=e&&e<=s.end)return s}}return null},d.detectEvictedFragments=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(a){var r=n.fragments[a];if(r)if(r.buffered){var s=r.range[e];s&&s.time.some(function(u){var f=!n.isTimeBuffered(u.startPTS,u.endPTS,t);return f&&n.removeFragment(r.body),f})}else r.body.type===i&&n.removeFragment(r.body)})},d.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,a=e.part;if(i&&n.sn!=="initSegment"){var r=Le(n),s=this.fragments[r];s&&(Object.keys(i).forEach(function(u){var f=n.elementaryStreams[u];if(f){var E=i[u],D=a!==null||f.partial===!0;s.range[u]=t.getBufferedTimes(n,a,D,E)}}),s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},d.fragBuffered=function(e){var t=Le(e),i=this.fragments[t];i&&(i.loaded=null,i.buffered=!0)},d.getBufferedTimes=function(e,t,i,n){for(var a={time:[],partial:i},r=t?t.start:e.start,s=t?t.end:e.end,u=e.minEndPTS||s,f=e.maxStartPTS||r,E=0;E<n.length;E++){var D=n.start(E)-this.bufferPadding,N=n.end(E)+this.bufferPadding;if(f>=D&&u<=N){a.time.push({startPTS:Math.max(r,n.start(E)),endPTS:Math.min(s,n.end(E))});break}if(r<N&&s>D)a.partial=!0,a.time.push({startPTS:Math.max(r,n.start(E)),endPTS:Math.min(s,n.end(E))});else if(s<=D)break}return a},d.getPartialFragment=function(e){var t,i,n,a=null,r=0,s=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(f){var E=u[f];E&&ve(E)&&(i=E.body.start-s,n=E.body.end+s,e>=i&&e<=n&&(t=Math.min(e-i,n-e),r<=t&&(a=E.body,r=t)))}),a},d.getState=function(e){var t=Le(e),i=this.fragments[t];return i?i.buffered?ve(i)?x.PARTIAL:x.OK:x.APPENDING:x.NOT_LOADED},d.isTimeBuffered=function(e,t,i){for(var n,a,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,a=i.end(r)+this.bufferPadding,e>=n&&t<=a)return!0;if(t<=n)return!1}return!1},d.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if(i.sn!=="initSegment"&&!i.bitrateTest&&!n){var a=Le(i);this.fragments[a]={body:i,loaded:t,buffered:!1,range:Object.create(null)}}},d.onBufferAppended=function(e,t){var i=this,n=t.frag,a=t.part,r=t.timeRanges;if(n.type===G.PlaylistLevelType.MAIN)if(this.activeFragment=n,a){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(a)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(u){var f=r[u];if(i.detectEvictedFragments(u,f),!a)for(var E=0;E<f.length;E++)n.appendedPTS=Math.max(f.end(E),n.appendedPTS||0)})},d.onFragBuffered=function(e,t){this.detectPartialFragments(t)},d.hasFragment=function(e){var t=Le(e);return!!this.fragments[t]},d.removeFragmentsInRange=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(a){var r=n.fragments[a];if(r&&r.buffered){var s=r.body;s.type===i&&s.start<t&&s.end>e&&n.removeFragment(s)}})},d.removeFragment=function(e){var t=Le(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},d.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},v}();function ve(v){var d,e;return v.buffered&&(((d=v.range.video)===null||d===void 0?void 0:d.partial)||((e=v.range.audio)===null||e===void 0?void 0:e.partial))}function Le(v){return v.type+"_"+v.level+"_"+v.urlId+"_"+v.sn}var Ne=function(){function v(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var d=v.prototype;return d.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},d.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},d.onHandlerDestroyed=function(){},d.hasInterval=function(){return!!this._tickInterval},d.hasNextTick=function(){return!!this._tickTimer},d.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},d.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},d.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},d.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},d.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},d.doTick=function(){},v}(),ze={length:0,start:function(){return 0},end:function(){return 0}},Be=function(){function v(){}return v.isBuffered=function(d,e){try{if(d){for(var t=v.getBuffered(d),i=0;i<t.length;i++)if(e>=t.start(i)&&e<=t.end(i))return!0}}catch(n){}return!1},v.bufferInfo=function(d,e,t){try{if(d){var i,n=v.getBuffered(d),a=[];for(i=0;i<n.length;i++)a.push({start:n.start(i),end:n.end(i)});return this.bufferedInfo(a,e,t)}}catch(r){}return{len:0,start:e,end:e,nextStart:void 0}},v.bufferedInfo=function(d,e,t){e=Math.max(0,e),d.sort(function(q,ge){return q.start-ge.start||ge.end-q.end});var i=[];if(t)for(var n=0;n<d.length;n++){var a=i.length;if(a){var r=i[a-1].end;d[n].start-r<t?d[n].end>r&&(i[a-1].end=d[n].end):i.push(d[n])}else i.push(d[n])}else i=d;for(var s,u=0,f=e,E=e,D=0;D<i.length;D++){var N=i[D].start,V=i[D].end;if(e+t>=N&&e<V)f=N,u=(E=V)-e;else if(e+t<N){s=N;break}}return{len:u,start:f||0,end:E||0,nextStart:s}},v.getBuffered=function(d){try{return d.buffered}catch(e){return _.logger.log("failed to get media.buffered",e),ze}},v}(),rt=function(v,d,e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=v,this.sn=d,this.id=e,this.size=t,this.part=i,this.partial=n};function pt(v,d){for(var e=null,t=0,i=v.length;t<i;t++){var n=v[t];if(n&&n.cc===d){e=n;break}}return e}function ct(v,d){if(v){var e=v.start+d;v.start=v.startPTS=e,v.endPTS=e+v.duration}}function R(v,d){for(var e=d.fragments,t=0,i=e.length;t<i;t++)ct(e[t],v);d.fragmentHint&&ct(d.fragmentHint,v),d.alignedSliding=!0}function I(v,d){if(v.hasProgramDateTime&&d.hasProgramDateTime){var e=v.fragments,t=d.fragments;if(e.length&&t.length){var i=t[Math.round(t.length/2)-1],n=pt(e,i.cc)||e[Math.round(e.length/2)-1],a=i.programDateTime,r=n.programDateTime;a!==null&&r!==null&&R((r-a)/1e3-(n.start-i.start),v)}}}const S=function(v,d){for(var e=0,t=v.length-1,i=null,n=null;e<=t;){var a=d(n=v[i=(e+t)/2|0]);if(a>0)e=i+1;else{if(!(a<0))return n;t=i-1}}return null};function C(v,d,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var i=null;return v?i=d[v.sn-d[0].sn+1]||null:e===0&&d[0].start===0&&(i=d[0]),i&&O(e,t,i)===0?i:S(d,O.bind(null,e,t))||i}function O(v,d,e){v===void 0&&(v=0),d===void 0&&(d=0);var t=Math.min(d,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=v?1:e.start-t>v&&e.start?-1:0}function Y(v,d,e){var t=1e3*Math.min(d,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>v}function j(v){var d=typeof Map=="function"?new Map:void 0;return j=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(d!==void 0){if(d.has(e))return d.get(e);d.set(e,i)}function i(){return J(e,arguments,ke(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),pe(i,e)},j(v)}function J(v,d,e){return J=De()?Reflect.construct.bind():function(t,i,n){var a=[null];a.push.apply(a,i);var r=new(Function.bind.apply(t,a));return n&&pe(r,n.prototype),r},J.apply(null,arguments)}function De(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}function pe(v,d){return pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pe(v,d)}function ke(v){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},ke(v)}var Fe=Math.pow(2,17),Qe=function(){function v(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var d=v.prototype;return d.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},d.abort=function(){this.loader&&this.loader.abort()},d.load=function(e,t){var i=this,n=e.url;if(!n)return Promise.reject(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var a=this.config,r=a.fLoader,s=a.loader;return new Promise(function(u,f){i.loader&&i.loader.destroy();var E=i.loader=e.loader=r?new r(a):new s(a),D=$e(e),N={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:e.sn==="initSegment"?1/0:Fe};e.stats=E.stats,E.load(D,N,{onSuccess:function(V,q,ge,be){i.resetLoader(e,E),u({frag:e,part:null,payload:V.data,networkDetails:be})},onError:function(V,q,ge){i.resetLoader(e,E),f(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:V,networkDetails:ge}))},onAbort:function(V,q,ge){i.resetLoader(e,E),f(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:ge}))},onTimeout:function(V,q,ge){i.resetLoader(e,E),f(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:ge}))},onProgress:function(V,q,ge,be){t&&t({frag:e,part:null,payload:ge,networkDetails:be})}})})},d.loadPart=function(e,t,i){var n=this;this.abort();var a=this.config,r=a.fLoader,s=a.loader;return new Promise(function(u,f){n.loader&&n.loader.destroy();var E=n.loader=e.loader=r?new r(a):new s(a),D=$e(e,t),N={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:Fe};t.stats=E.stats,E.load(D,N,{onSuccess:function(V,q,ge,be){n.resetLoader(e,E),n.updateStatsFromPart(e,t);var Ve={frag:e,part:t,payload:V.data,networkDetails:be};i(Ve),u(Ve)},onError:function(V,q,ge){n.resetLoader(e,E),f(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:V,networkDetails:ge}))},onAbort:function(V,q,ge){e.stats.aborted=t.stats.aborted,n.resetLoader(e,E),f(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:ge}))},onTimeout:function(V,q,ge){n.resetLoader(e,E),f(new je({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:ge}))}})})},d.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,a=n.total;if(i.loaded+=n.loaded,a){var r=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/a),r),u=(r-s)*Math.round(i.loaded/s);i.total=i.loaded+u}else i.total=Math.max(i.loaded,i.total);var f=i.loading,E=n.loading;f.start?f.first+=E.first-E.start:(f.start=E.start,f.first=E.first),f.end=E.end},d.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},v}();function $e(v,d){d===void 0&&(d=null);var e=d||v,t={frag:v,part:d,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return(0,B.isFiniteNumber)(i)&&(0,B.isFiniteNumber)(n)&&(t.rangeStart=i,t.rangeEnd=n),t}var je=function(v){var d,e;function t(i){for(var n,a=arguments.length,r=new Array(a>1?a-1:0),s=1;s<a;s++)r[s-1]=arguments[s];return(n=v.call.apply(v,[this].concat(r))||this).data=void 0,n.data=i,n}return e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,pe(d,e),t}(j(Error)),ot=X(21);const Tt=function(v){for(var d="",e=v.length,t=0;t<e;t++)d+="["+v.start(t).toFixed(3)+","+v.end(t).toFixed(3)+"]";return d};function dt(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function Ft(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function Qt(v,d){return Qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qt(v,d)}var Pt="STOPPED",mt="IDLE",Vt="KEY_LOADING",bt="FRAG_LOADING",zt="FRAG_LOADING_WAITING_RETRY",dr="WAITING_TRACK",jt="PARSING",gr="PARSED",yr="ENDED",mr="ERROR",ir="WAITING_INIT_PTS",vr="WAITING_LEVEL",Ar=function(v){var d,e;function t(r,s,u){var f;return(f=v.call(this)||this).hls=void 0,f.fragPrevious=null,f.fragCurrent=null,f.fragmentTracker=void 0,f.transmuxer=null,f._state=Pt,f.media=null,f.mediaBuffer=null,f.config=void 0,f.bitrateTest=!1,f.lastCurrentTime=0,f.nextLoadPosition=0,f.startPosition=0,f.loadedmetadata=!1,f.fragLoadError=0,f.retryDate=0,f.levels=null,f.fragmentLoader=void 0,f.levelLastLoaded=null,f.startFragRequested=!1,f.decrypter=void 0,f.initPTS=[],f.onvseeking=null,f.onvended=null,f.logPrefix="",f.log=void 0,f.warn=void 0,f.logPrefix=u,f.log=_.logger.log.bind(_.logger,u+":"),f.warn=_.logger.warn.bind(_.logger,u+":"),f.hls=r,f.fragmentLoader=new Qe(r.config),f.fragmentTracker=s,f.config=r.config,f.decrypter=new ot.default(r,r.config),r.on(c.Events.KEY_LOADED,f.onKeyLoaded,Ft(f)),r.on(c.Events.LEVEL_SWITCHING,f.onLevelSwitching,Ft(f)),f}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Qt(d,e);var i,n,a=t.prototype;return a.doTick=function(){this.onTickEnd()},a.onTickEnd=function(){},a.startLoad=function(r){},a.stopLoad=function(){this.fragmentLoader.abort();var r=this.fragCurrent;r&&this.fragmentTracker.removeFragment(r),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Pt},a._streamEnded=function(r,s){var u=this.fragCurrent,f=this.fragmentTracker;if(!s.live&&u&&this.media&&u.sn>=s.endSN&&!r.nextStart){var E=s.partList;if(E!=null&&E.length){var D=E[E.length-1];return Be.isBuffered(this.media,D.start+D.duration/2)}var N=f.getState(u);return N===x.PARTIAL||N===x.OK}return!1},a.onMediaAttached=function(r,s){var u=this.media=this.mediaBuffer=s.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),u.addEventListener("seeking",this.onvseeking),u.addEventListener("ended",this.onvended);var f=this.config;this.levels&&f.autoStartLoad&&this.state===Pt&&this.startLoad(f.startPosition)},a.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},a.onMediaSeeking=function(){var r=this.config,s=this.fragCurrent,u=this.media,f=this.mediaBuffer,E=this.state,D=u?u.currentTime:0,N=Be.bufferInfo(f||u,D,r.maxBufferHole);if(this.log("media seeking to "+((0,B.isFiniteNumber)(D)?D.toFixed(3):D)+", state: "+E),E===yr)this.resetLoadingState();else if(s&&!N.len){var V=r.maxFragLookUpTolerance,q=s.start-V,ge=D>s.start+s.duration+V;(D<q||ge)&&(ge&&s.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.resetLoadingState())}u&&(this.lastCurrentTime=D),this.loadedmetadata||N.len||(this.nextLoadPosition=this.startPosition=D),this.tickImmediate()},a.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},a.onKeyLoaded=function(r,s){if(this.state===Vt&&s.frag===this.fragCurrent&&this.levels){this.state=mt;var u=this.levels[s.frag.level].details;u&&this.loadFragment(s.frag,u,s.frag.start)}},a.onLevelSwitching=function(r,s){this.fragLoadError=0},a.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},a.onHandlerDestroyed=function(){this.state=Pt,this.hls.off(c.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},a.loadKey=function(r,s){this.log("Loading key for "+r.sn+" of ["+s.startSN+"-"+s.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=Vt,this.fragCurrent=r,this.hls.trigger(c.Events.KEY_LOADING,{frag:r})},a.loadFragment=function(r,s,u){this._loadFragForPlayback(r,s,u)},a._loadFragForPlayback=function(r,s,u){var f=this;this._doFragLoad(r,s,u,function(E){if(f.fragContextChanged(r))return f.warn("Fragment "+r.sn+(E.part?" p: "+E.part.index:"")+" of level "+r.level+" was dropped during download."),void f.fragmentTracker.removeFragment(r);r.stats.chunkCount++,f._handleFragmentLoadProgress(E)}).then(function(E){if(E){f.fragLoadError=0;var D=f.state;f.fragContextChanged(r)?(D===bt||!f.fragCurrent&&D===jt)&&(f.fragmentTracker.removeFragment(r),f.state=mt):("payload"in E&&(f.log("Loaded fragment "+r.sn+" of level "+r.level),f.hls.trigger(c.Events.FRAG_LOADED,E)),f._handleFragmentLoadComplete(E))}}).catch(function(E){f.state!==Pt&&f.state!==mr&&(f.warn(E),f.resetFragmentLoading(r))})},a.flushMainBuffer=function(r,s,u){if(u===void 0&&(u=null),r-s){var f={startOffset:r,endOffset:s,type:u};this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,f)}},a._loadInitSegment=function(r){var s=this;this._doFragLoad(r).then(function(u){if(!u||s.fragContextChanged(r)||!s.levels)throw new Error("init load aborted");return u}).then(function(u){var f=s.hls,E=u.payload,D=r.decryptdata;if(E&&E.byteLength>0&&D&&D.key&&D.iv&&D.method==="AES-128"){var N=self.performance.now();return s.decrypter.webCryptoDecrypt(new Uint8Array(E),D.key.buffer,D.iv.buffer).then(function(V){var q=self.performance.now();return f.trigger(c.Events.FRAG_DECRYPTED,{frag:r,payload:V,stats:{tstart:N,tdecrypt:q}}),u.payload=V,u})}return u}).then(function(u){var f=s.fragCurrent,E=s.hls,D=s.levels;if(!D)throw new Error("init load aborted, missing levels");D[r.level].details;var N=r.stats;s.state=mt,s.fragLoadError=0,r.data=new Uint8Array(u.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),u.frag===f&&E.trigger(c.Events.FRAG_BUFFERED,{stats:N,frag:f,part:null,id:r.type}),s.tick()}).catch(function(u){s.state!==Pt&&s.state!==mr&&(s.warn(u),s.resetFragmentLoading(r))})},a.fragContextChanged=function(r){var s=this.fragCurrent;return!r||!s||r.level!==s.level||r.sn!==s.sn||r.urlId!==s.urlId},a.fragBufferedComplete=function(r,s){var u,f,E=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+r.type+" sn: "+r.sn+(s?" part: "+s.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level+" "+(E?Tt(Be.getBuffered(E)):"(detached)")),this.state=mt,E&&(!this.loadedmetadata&&E.buffered.length&&((u=this.fragCurrent)===null||u===void 0?void 0:u.sn)===((f=this.fragPrevious)===null||f===void 0?void 0:f.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},a.seekToStartPos=function(){},a._handleFragmentLoadComplete=function(r){var s=this.transmuxer;if(s){var u=r.frag,f=r.part,E=r.partsLoaded,D=!E||E.length===0||E.some(function(V){return!V}),N=new rt(u.level,u.sn,u.stats.chunkCount+1,0,f?f.index:-1,!D);s.flush(N)}},a._handleFragmentLoadProgress=function(r){},a._doFragLoad=function(r,s,u,f){var E=this;if(u===void 0&&(u=null),!this.levels)throw new Error("frag load aborted, missing levels");if(u=Math.max(r.start,u||0),this.config.lowLatencyMode&&s){var D=s.partList;if(D&&f){u>r.end&&s.fragmentHint&&(r=s.fragmentHint);var N=this.getNextPart(D,r,u);if(N>-1){var V=D[N];return this.log("Loading part sn: "+r.sn+" p: "+V.index+" cc: "+r.cc+" of playlist ["+s.startSN+"-"+s.endSN+"] parts [0-"+N+"-"+(D.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(u.toFixed(3))),this.nextLoadPosition=V.start+V.duration,this.state=bt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:r,part:D[N],targetBufferTime:u}),this.doFragPartsLoad(r,D,N,f).catch(function(q){return E.handleFragLoadError(q)})}if(!r.url||this.loadedEndOfParts(D,u))return Promise.resolve(null)}}return this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(s?"of ["+s.startSN+"-"+s.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(u.toFixed(3))),(0,B.isFiniteNumber)(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=bt,this.hls.trigger(c.Events.FRAG_LOADING,{frag:r,targetBufferTime:u}),this.fragmentLoader.load(r,f).catch(function(q){return E.handleFragLoadError(q)})},a.doFragPartsLoad=function(r,s,u,f){var E=this;return new Promise(function(D,N){var V=[];(function q(ge){var be=s[ge];E.fragmentLoader.loadPart(r,be,f).then(function(Ve){V[be.index]=Ve;var Ke=Ve.part;E.hls.trigger(c.Events.FRAG_LOADED,Ve);var Me=s[ge+1];if(!Me||Me.fragment!==r)return D({frag:r,part:Ke,partsLoaded:V});q(ge+1)}).catch(N)})(u)})},a.handleFragLoadError=function(r){var s=r.data;return s&&s.details===P.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(s.frag,s.part):this.hls.trigger(c.Events.ERROR,s),null},a._handleTransmuxerFlush=function(r){var s=this.getCurrentContext(r);if(s&&this.state===jt){var u=s.frag,f=s.part,E=s.level,D=self.performance.now();u.stats.parsing.end=D,f&&(f.stats.parsing.end=D),this.updateLevelTiming(u,f,E,r.partial)}else this.fragCurrent||(this.state=mt)},a.getCurrentContext=function(r){var s=this.levels,u=r.level,f=r.sn,E=r.part;if(!s||!s[u])return this.warn("Levels object was unset while buffering fragment "+f+" of level "+u+". The current chunk will not be buffered."),null;var D=s[u],N=E>-1?function(q,ge,be){if(!q||!q.details)return null;var Ve=q.details.partList;if(Ve)for(var Ke=Ve.length;Ke--;){var Me=Ve[Ke];if(Me.index===be&&Me.fragment.sn===ge)return Me}return null}(D,f,E):null,V=N?N.fragment:function(q,ge,be){if(!q||!q.details)return null;var Ve=q.details,Ke=Ve.fragments[ge-Ve.startSN];return Ke||((Ke=Ve.fragmentHint)&&Ke.sn===ge?Ke:ge<Ve.startSN&&be&&be.sn===ge?be:null)}(D,f,this.fragCurrent);return V?{frag:V,part:N,level:D}:null},a.bufferFragmentData=function(r,s,u,f){if(r&&this.state===jt){var E=r.data1,D=r.data2,N=E;if(E&&D&&(N=(0,se.appendUint8Array)(E,D)),N&&N.length){var V={type:r.type,frag:s,part:u,chunkMeta:f,parent:s.type,data:N};this.hls.trigger(c.Events.BUFFER_APPENDING,V),r.dropped&&r.independent&&!u&&this.flushBufferGap(s)}}},a.flushBufferGap=function(r){var s=this.media;if(s)if(Be.isBuffered(s,s.currentTime)){var u=s.currentTime,f=Be.bufferInfo(s,u,0),E=r.duration,D=Math.min(2*this.config.maxFragLookUpTolerance,.25*E),N=Math.max(Math.min(r.start-D,f.end-D),u+D);r.start-N>D&&this.flushMainBuffer(N,r.start)}else this.flushMainBuffer(0,r.start)},a.getFwdBufferInfo=function(r,s){var u=this.config,f=this.getLoadPosition();if(!(0,B.isFiniteNumber)(f))return null;var E=Be.bufferInfo(r,f,u.maxBufferHole);if(E.len===0&&E.nextStart!==void 0){var D=this.fragmentTracker.getBufferedFrag(f,s);if(D&&E.nextStart<D.end)return Be.bufferInfo(r,f,Math.max(E.nextStart,u.maxBufferHole))}return E},a.getMaxBufferLength=function(r){var s,u=this.config;return s=r?Math.max(8*u.maxBufferSize/r,u.maxBufferLength):u.maxBufferLength,Math.min(s,u.maxMaxBufferLength)},a.reduceMaxBufferLength=function(r){var s=this.config,u=r||s.maxBufferLength;return s.maxMaxBufferLength>=u&&(s.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+s.maxMaxBufferLength+"s"),!0)},a.getNextFragment=function(r,s){var u=s.fragments,f=u.length;if(!f)return null;var E,D=this.config,N=u[0].start;if(s.live){var V=D.initialLiveManifestSize;if(f<V)return this.warn("Not enough fragments to start playback (have: "+f+", need: "+V+")"),null;s.PTSKnown||this.startFragRequested||this.startPosition!==-1||(E=this.getInitialLiveFragment(s,u),this.startPosition=E?this.hls.liveSyncPosition||E.start:r)}else r<=N&&(E=u[0]);if(!E){var q=D.lowLatencyMode?s.partEnd:s.fragmentEnd;E=this.getFragmentAtPosition(r,q,s)}return this.mapToInitFragWhenRequired(E)},a.mapToInitFragWhenRequired=function(r){return r==null||!r.initSegment||r!=null&&r.initSegment.data||this.bitrateTest?r:r.initSegment},a.getNextPart=function(r,s,u){for(var f=-1,E=!1,D=!0,N=0,V=r.length;N<V;N++){var q=r[N];if(D=D&&!q.independent,f>-1&&u<q.start)break;var ge=q.loaded;!ge&&(E||q.independent||D)&&q.fragment===s&&(f=N),E=ge}return f},a.loadedEndOfParts=function(r,s){var u=r[r.length-1];return u&&s>u.start&&u.loaded},a.getInitialLiveFragment=function(r,s){var u=this.fragPrevious,f=null;if(u){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+u.programDateTime),f=function(V,q,ge){if(q===null||!Array.isArray(V)||!V.length||!(0,B.isFiniteNumber)(q)||q<(V[0].programDateTime||0)||q>=(V[V.length-1].endProgramDateTime||0))return null;ge=ge||0;for(var be=0;be<V.length;++be){var Ve=V[be];if(Y(q,ge,Ve))return Ve}return null}(s,u.endProgramDateTime,this.config.maxFragLookUpTolerance)),!f){var E=u.sn+1;if(E>=r.startSN&&E<=r.endSN){var D=s[E-r.startSN];u.cc===D.cc&&(f=D,this.log("Live playlist, switching playlist, load frag with next SN: "+f.sn))}f||(f=function(V,q){return S(V,function(ge){return ge.cc<q?1:ge.cc>q?-1:0})}(s,u.cc),f&&this.log("Live playlist, switching playlist, load frag with same CC: "+f.sn))}}else{var N=this.hls.liveSyncPosition;N!==null&&(f=this.getFragmentAtPosition(N,this.bitrateTest?r.fragmentEnd:r.edge,r))}return f},a.getFragmentAtPosition=function(r,s,u){var f,E=this.config,D=this.fragPrevious,N=u.fragments,V=u.endSN,q=u.fragmentHint,ge=E.maxFragLookUpTolerance,be=!!(E.lowLatencyMode&&u.partList&&q);if(be&&q&&!this.bitrateTest&&(N=N.concat(q),V=q.sn),f=r<s?C(D,N,r,r>s-ge?0:ge):N[N.length-1]){var Ve=f.sn-u.startSN;if(this.fragmentTracker.getState(f)===x.OK&&(D=f),D&&f.sn===D.sn&&!be&&D&&f.level===D.level){var Ke=N[Ve+1];f.sn<V&&this.fragmentTracker.getState(Ke)!==x.OK?(this.log("SN "+f.sn+" just loaded, load next one: "+Ke.sn),f=Ke):f=null}}return f},a.synchronizeToLiveEdge=function(r){var s=this.config,u=this.media;if(u){var f=this.hls.liveSyncPosition,E=u.currentTime,D=r.fragments[0].start,N=r.edge,V=E>=D-s.maxFragLookUpTolerance&&E<=N;if(f!==null&&u.duration>f&&(E<f||!V)){var q=s.liveMaxLatencyDuration!==void 0?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*r.targetduration;(!V&&u.readyState<4||E<N-q)&&(this.loadedmetadata||(this.nextLoadPosition=f),u.readyState&&(this.warn("Playback: "+E.toFixed(3)+" is located too far from the end of live sliding playlist: "+N+", reset currentTime to : "+f.toFixed(3)),u.currentTime=f))}}},a.alignPlaylists=function(r,s){var u=this.levels,f=this.levelLastLoaded,E=this.fragPrevious,D=f!==null?u[f]:null,N=r.fragments.length;if(!N)return this.warn("No fragments in live playlist"),0;var V=r.fragments[0].start,q=!s,ge=r.alignedSliding&&(0,B.isFiniteNumber)(V);if(q||!ge&&!V){(function(Ve,Ke,Me){Ke&&(function(We,Xe,Ue){if(function(tt,Dt,kt){return!(!Dt.details||!(kt.endCC>kt.startCC||tt&&tt.cc<kt.startCC))}(We,Ue,Xe)){var ut=function(tt,Dt,kt){kt===void 0&&(kt=0);var Yt=tt.fragments,er=Dt.fragments;if(er.length&&Yt.length){var Kt=pt(Yt,er[0].cc);if(Kt&&(!Kt||Kt.startPTS))return Kt;_.logger.log("No frag in previous level to align on")}else _.logger.log("No fragments to align")}(Ue.details,Xe);ut&&(0,B.isFiniteNumber)(ut.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+Xe.url),R(ut.start,Xe))}}(Ve,Me,Ke),!Me.alignedSliding&&Ke.details&&function(We,Xe){if(Xe.fragments.length&&We.hasProgramDateTime&&Xe.hasProgramDateTime){var Ue=Xe.fragments[0].programDateTime,ut=We.fragments[0].programDateTime,tt=(ut-Ue)/1e3+Xe.fragments[0].start;tt&&(0,B.isFiniteNumber)(tt)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(ut-Ue)+"ms, sliding:"+tt.toFixed(3)+" "+We.url+" "),R(tt,We))}}(Me,Ke.details),Me.alignedSliding||!Ke.details||Me.skippedSegments||ur(Ke.details,Me))})(E,D,r);var be=r.fragments[0].start;return this.log("Live playlist sliding: "+be.toFixed(2)+" start-sn: "+(s?s.startSN:"na")+"->"+r.startSN+" prev-sn: "+(E?E.sn:"na")+" fragments: "+N),be}return V},a.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,3*r.partTarget)},a.setStartPosition=function(r,s){var u=this.startPosition;if(u<s&&(u=-1),u===-1||this.lastCurrentTime===-1){var f=r.startTimeOffset;(0,B.isFiniteNumber)(f)?(u=s+f,f<0&&(u+=r.totalduration),u=Math.min(Math.max(s,u),s+r.totalduration),this.log("Start time offset "+f+" found in playlist, adjust startPosition to "+u),this.startPosition=u):r.live?u=this.hls.liveSyncPosition||s:this.startPosition=u=0,this.lastCurrentTime=u}this.nextLoadPosition=u},a.getLoadPosition=function(){var r=this.media,s=0;return this.loadedmetadata&&r?s=r.currentTime:this.nextLoadPosition&&(s=this.nextLoadPosition),s},a.handleFragLoadAborted=function(r,s){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(s?" part"+s.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},a.resetFragmentLoading=function(r){this.fragCurrent&&(this.fragContextChanged(r)||this.state===zt)||(this.state=mt)},a.onFragmentOrKeyLoadError=function(r,s){if(!s.fatal){var u=s.frag;if(u&&u.type===r){this.fragCurrent;var f=this.config;if(this.fragLoadError+1<=f.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var E=Math.min(Math.pow(2,this.fragLoadError)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout);this.warn("Fragment "+u.sn+" of "+r+" "+u.level+" failed to load, retrying in "+E+"ms"),this.retryDate=self.performance.now()+E,this.fragLoadError++,this.state=zt}else s.levelRetry?(r===G.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=mt):(_.logger.error(s.details+" reaches max retry, redispatch as fatal ..."),s.fatal=!0,this.hls.stopLoad(),this.state=mr)}}},a.afterBufferFlushed=function(r,s,u){if(r){var f=Be.getBuffered(r);this.fragmentTracker.detectEvictedFragments(s,f,u),this.state===yr&&this.resetLoadingState()}},a.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=mt},a.resetStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var s=this.levels?this.levels[r].details:null;s!=null&&s.live?(this.startPosition=-1,this.setStartPosition(s,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},a.updateLevelTiming=function(r,s,u,f){var E=this,D=u.details;Object.keys(r.elementaryStreams).reduce(function(N,V){var q=r.elementaryStreams[V];if(q){var ge=q.endPTS-q.startPTS;if(ge<=0)return E.warn("Could not parse fragment "+r.sn+" "+V+" duration reliably ("+ge+")"),N||!1;var be=f?0:lr(D,r,q.startPTS,q.endPTS,q.startDTS,q.endDTS);return E.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:D,level:u,drift:be,type:V,frag:r,start:q.startPTS,end:q.endPTS}),!0}return N},!1)||(this.warn("Found no media in fragment "+r.sn+" of level "+u.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=gr,this.hls.trigger(c.Events.FRAG_PARSED,{frag:r,part:s})},a.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=t,(n=[{key:"state",get:function(){return this._state},set:function(r){var s=this._state;s!==r&&(this._state=r,this.log(s+"->"+r))}}])&&dt(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ne);function Rr(){return self.MediaSource||self.WebKitMediaSource}function Br(){return self.SourceBuffer||self.WebKitSourceBuffer}var Pr=function(){var v=ENTRY_MODULE,d={};function e(i){var n=d[i];if(n!==void 0)return n.exports;var a=d[i]={exports:{}};return v[i].call(a.exports,a,a.exports,e),a.exports}e.m=v,e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,{a:n}),n},e.d=function(i,n){for(var a in n)e.o(n,a)&&!e.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:n[a]})},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var t=e(ENTRY_MODULE);return t.default||t};Pr.toString();var qr="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function $r(v){return(v+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function zr(v,d,e){var t={};t[e]=[];var i=d.toString(),n=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return t;for(var a,r=n[1],s=new RegExp("(\\\\n|\\W)"+$r(r)+qr,"g");a=s.exec(i);)a[3]!=="dll-reference"&&t[e].push(a[3]);for(s=new RegExp("\\("+$r(r)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+qr,"g");a=s.exec(i);)v[a[2]]||(t[e].push(a[1]),v[a[2]]=X(a[1]).m),t[a[2]]=t[a[2]]||[],t[a[2]].push(a[4]);for(var u,f=Object.keys(t),E=0;E<f.length;E++)for(var D=0;D<t[f[E]].length;D++)u=t[f[E]][D],isNaN(1*u)||(t[f[E]][D]=1*t[f[E]][D]);return t}function Kr(v){return Object.keys(v).reduce(function(d,e){return d||v[e].length>0},!1)}function Nr(v,d,e,t){var i=v[t].map(function(a){return'"'+a+'": '+d[t][a].toString()}).join(","),n=Pr.toString().split("ENTRY_MODULE");return n[0]+"{"+i+"}"+n[1]+'"'+e+'"'+n[2]}var xr=X(544),Jr=X(729),kr=Rr()||{isTypeSupported:function(){return!1}},wr=function(){function v(e,t,i,n){var a=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var s=function(D,N){(N=N||{}).frag=a.frag,N.id=a.id,a.hls.trigger(D,N)};this.observer=new Jr.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,s),this.observer.on(c.Events.ERROR,s);var u={mp4:kr.isTypeSupported("video/mp4"),mpeg:kr.isTypeSupported("audio/mpeg"),mp3:kr.isTypeSupported('audio/mp4; codecs="mp3"')},f=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){var E;_.logger.log("demuxing in webworker");try{E=this.worker=function(D,N){N=N||{};var V={main:X.m},q=N.all?{main:Object.keys(V.main)}:function(Me,We){for(var Xe={main:[We]},Ue={main:[]},ut={main:{}};Kr(Xe);)for(var tt=Object.keys(Xe),Dt=0;Dt<tt.length;Dt++){var kt=tt[Dt],Yt=Xe[kt].pop();if(ut[kt]=ut[kt]||{},!ut[kt][Yt]&&Me[kt][Yt]){ut[kt][Yt]=!0,Ue[kt]=Ue[kt]||[],Ue[kt].push(Yt);for(var er=zr(Me,Me[kt][Yt],kt),Kt=Object.keys(er),Wt=0;Wt<Kt.length;Wt++)Xe[Kt[Wt]]=Xe[Kt[Wt]]||[],Xe[Kt[Wt]]=Xe[Kt[Wt]].concat(er[Kt[Wt]])}}return Ue}(V,D),ge="";Object.keys(q).filter(function(Me){return Me!=="main"}).forEach(function(Me){for(var We=0;q[Me][We];)We++;q[Me].push(We),V[Me][We]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",ge=ge+"var "+Me+" = ("+Nr(q,V,We,modules)+`)();
`}),ge=ge+"(("+Nr(q,V,D,"main")+")())(self);";var be=new window.Blob([ge],{type:"text/javascript"}),Ve=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(be),Ke=new window.Worker(Ve);return Ke.objectURL=Ve,Ke}(182),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(D){a.useWorker=!1,_.logger.warn("Exception in webworker, fallback to inline"),a.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(D.message+"  ("+D.filename+":"+D.lineno+")")})},E.postMessage({cmd:"init",typeSupported:u,vendor:f,id:t,config:JSON.stringify(r)})}catch(D){_.logger.warn("Error in worker:",D),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new xr.default(this.observer,u,r,f,t),this.worker=null}}else this.transmuxer=new xr.default(this.observer,u,r,f,t)}var d=v.prototype;return d.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},d.push=function(e,t,i,n,a,r,s,u,f,E){var D,N,V=this;f.transmuxing.start=self.performance.now();var q=this.transmuxer,ge=this.worker,be=r?r.start:a.start,Ve=a.decryptdata,Ke=this.frag,Me=!(Ke&&a.cc===Ke.cc),We=!(Ke&&f.level===Ke.level),Xe=Ke?f.sn-Ke.sn:-1,Ue=this.part?f.part-this.part.index:-1,ut=Xe===0&&f.id>1&&f.id===(Ke==null?void 0:Ke.stats.chunkCount),tt=!We&&(Xe===1||Xe===0&&(Ue===1||ut&&Ue<=0)),Dt=self.performance.now();(We||Xe||a.stats.parsing.start===0)&&(a.stats.parsing.start=Dt),!r||!Ue&&tt||(r.stats.parsing.start=Dt);var kt=!(Ke&&((D=a.initSegment)===null||D===void 0?void 0:D.url)===((N=Ke.initSegment)===null||N===void 0?void 0:N.url)),Yt=new xr.TransmuxState(Me,tt,u,We,be,kt);if(!tt||Me||kt){_.logger.log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+f.sn+" p: "+f.part+" level: "+f.level+" id: "+f.id+`
        discontinuity: `+Me+`
        trackSwitch: `+We+`
        contiguous: `+tt+`
        accurateTimeOffset: `+u+`
        timeOffset: `+be+`
        initSegmentChange: `+kt);var er=new xr.TransmuxConfig(i,n,t,s,E);this.configureTransmuxer(er)}if(this.frag=a,this.part=r,ge)ge.postMessage({cmd:"demux",data:e,decryptdata:Ve,chunkMeta:f,state:Yt},e instanceof ArrayBuffer?[e]:[]);else if(q){var Kt=q.push(e,Ve,f,Yt);(0,xr.isPromise)(Kt)?Kt.then(function(Wt){V.handleTransmuxComplete(Wt)}):this.handleTransmuxComplete(Kt)}},d.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(i){var a=i.flush(e);(0,xr.isPromise)(a)?a.then(function(r){t.handleFlushResult(r,e)}):this.handleFlushResult(a,e)}},d.handleFlushResult=function(e,t){var i=this;e.forEach(function(n){i.handleTransmuxComplete(n)}),this.onFlush(t)},d.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":_.logger[t.data.logType]&&_.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},d.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},d.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},v}(),ri=function(){function v(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var d=v.prototype;return d.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},d.poll=function(e,t){var i=this.config,n=this.media,a=this.stalled;if(n!==null){var r=n.currentTime,s=n.seeking,u=this.seeking&&!s,f=!this.seeking&&s;if(this.seeking=s,r===e){if((f||u)&&(this.stalled=null),!(n.paused&&!s||n.ended||n.playbackRate===0)&&Be.getBuffered(n).length){var E=Be.bufferInfo(n,r,0),D=E.len>0,N=E.nextStart||0;if(D||N){if(s){var V=E.len>2,q=!N||t&&t.start<=r||N-r>2&&!this.fragmentTracker.getPartialFragment(r);if(V||q)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var ge,be=Math.max(N,E.start||0)-r,Ve=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Ke=!(Ve==null||(ge=Ve.details)===null||ge===void 0)&&ge.live?2*Ve.details.targetduration:2;if(be>0&&be<=Ke)return void this._trySkipBufferHole(null)}var Me=self.performance.now();if(a!==null){var We=Me-a;if(s||!(We>=250)||(this._reportStall(E),this.media)){var Xe=Be.bufferInfo(n,r,i.maxBufferHole);this._tryFixBufferStall(Xe,We)}}else this.stalled=Me}}}else if(this.moved=!0,a!==null){if(this.stallReported){var Ue=self.performance.now()-a;_.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(Ue)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},d._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,a=this.media;if(a!==null){var r=a.currentTime,s=n.getPartialFragment(r);if(s&&(this._trySkipBufferHole(s)||!this.media))return;e.len>i.maxBufferHole&&t>1e3*i.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},d._reportStall=function(e){var t=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,_.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},d._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(n===null)return 0;for(var a=n.currentTime,r=0,s=Be.getBuffered(n),u=0;u<s.length;u++){var f=s.start(u);if(a+t.maxBufferHole>=r&&a<f){var E=Math.max(f+.05,n.currentTime+.1);return _.logger.warn("skipping hole, adjusting currentTime from "+a+" to "+E),this.moved=!0,this.stalled=null,n.currentTime=E,e&&i.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+E,frag:e}),E}r=s.end(u)}return 0},d._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(i!==null){var a=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var r=a+(n+1)*e.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+a+" to "+r),i.currentTime=r,t.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},v}();function ci(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function Or(v,d){return Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Or(v,d)}var Ii=function(v){var d,e;function t(r,s){var u;return(u=v.call(this,r,s,"[stream-controller]")||this).audioCodecSwap=!1,u.gapController=null,u.level=-1,u._forceStartLoad=!1,u.altAudio=!1,u.audioOnly=!1,u.fragPlaying=null,u.onvplaying=null,u.onvseeked=null,u.fragLastKbps=0,u.couldBacktrack=!1,u.backtrackFragment=null,u.audioCodecSwitch=!1,u.videoBuffer=null,u._registerListeners(),u}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Or(d,e);var i,n,a=t.prototype;return a._registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(c.Events.ERROR,this.onError,this),r.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(c.Events.ERROR,this.onError,this),r.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},a.startLoad=function(r){if(this.levels){var s=this.lastCurrentTime,u=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var f=u.startLevel;f===-1&&(u.config.testBandwidth&&this.levels.length>1?(f=0,this.bitrateTest=!0):f=u.nextAutoLevel),this.level=u.nextLoadLevel=f,this.loadedmetadata=!1}s>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),r=s),this.state=mt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=Pt},a.stopLoad=function(){this._forceStartLoad=!1,v.prototype.stopLoad.call(this)},a.doTick=function(){switch(this.state){case mt:this.doTickIdle();break;case vr:var r,s=this.levels,u=this.level,f=s==null||(r=s[u])===null||r===void 0?void 0:r.details;if(f&&(!f.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(f))break;this.state=mt;break}break;case zt:var E,D=self.performance.now(),N=this.retryDate;(!N||D>=N||(E=this.media)!==null&&E!==void 0&&E.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=mt)}this.onTickEnd()},a.onTickEnd=function(){v.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},a.doTickIdle=function(){var r,s,u=this.hls,f=this.levelLastLoaded,E=this.levels,D=this.media,N=u.config,V=u.nextLoadLevel;if(f!==null&&(D||!this.startFragRequested&&N.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&E&&E[V]){var q=E[V];this.level=u.nextLoadLevel=V;var ge=q.details;if(!ge||this.state===vr||ge.live&&this.levelLastLoaded!==V)this.state=vr;else{var be=this.getMainFwdBufferInfo();if(be!==null&&!(be.len>=this.getMaxBufferLength(q.maxBitrate))){if(this._streamEnded(be,ge)){var Ve={};return this.altAudio&&(Ve.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,Ve),void(this.state=yr)}this.backtrackFragment&&this.backtrackFragment.start>be.end&&(this.backtrackFragment=null);var Ke=this.backtrackFragment?this.backtrackFragment.start:be.end,Me=this.getNextFragment(Ke,ge);if(this.couldBacktrack&&!this.fragPrevious&&Me&&Me.sn!=="initSegment"&&this.fragmentTracker.getState(Me)!==x.OK){var We,Xe=((We=this.backtrackFragment)!=null?We:Me).sn-ge.startSN,Ue=ge.fragments[Xe-1];Ue&&Me.cc===Ue.cc&&(Me=Ue,this.fragmentTracker.removeFragment(Ue))}else this.backtrackFragment&&be.len&&(this.backtrackFragment=null);if(Me&&this.fragmentTracker.getState(Me)===x.OK&&this.nextLoadPosition>Ke){var ut=this.audioOnly&&!this.altAudio?ne.ElementaryStreamTypes.AUDIO:ne.ElementaryStreamTypes.VIDEO;D&&this.afterBufferFlushed(D,ut,G.PlaylistLevelType.MAIN),Me=this.getNextFragment(this.nextLoadPosition,ge)}Me&&(!Me.initSegment||Me.initSegment.data||this.bitrateTest||(Me=Me.initSegment),((r=Me.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=Me.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(Me,ge,Ke):this.loadKey(Me,ge))}}}},a.loadFragment=function(r,s,u){var f,E=this.fragmentTracker.getState(r);this.fragCurrent=r,E===x.NOT_LOADED?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,r,s,u)):E===x.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((f=this.media)===null||f===void 0?void 0:f.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},a.getAppendedFrag=function(r){var s=this.fragmentTracker.getAppendedFrag(r,G.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},a.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,G.PlaylistLevelType.MAIN)},a.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},a.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function(){var r=this.levels,s=this.media;if(s!=null&&s.readyState){var u,f=this.getAppendedFrag(s.currentTime);if(f&&f.start>1&&this.flushMainBuffer(0,f.start-1),!s.paused&&r){var E=r[this.hls.nextLoadLevel],D=this.fragLastKbps;u=D&&this.fragCurrent?this.fragCurrent.duration*E.maxBitrate/(1e3*D)+1:0}else u=0;var N=this.getBufferedFrag(s.currentTime+u);if(N){var V=this.followingBufferedFrag(N);if(V){this.abortCurrentFrag();var q=V.maxStartPTS?V.maxStartPTS:V.start,ge=V.duration,be=Math.max(N.end,q+Math.min(Math.max(ge-this.config.maxFragLookUpTolerance,.5*ge),.75*ge));this.flushMainBuffer(be,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r!=null&&r.loader&&r.loader.abort(),this.state){case Vt:case bt:case zt:case jt:case gr:this.state=mt}this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function(r,s){v.prototype.flushMainBuffer.call(this,r,s,this.altAudio?"video":null)},a.onMediaAttached=function(r,s){v.prototype.onMediaAttached.call(this,r,s);var u=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),u.addEventListener("playing",this.onvplaying),u.addEventListener("seeked",this.onvseeked),this.gapController=new ri(this.config,u,this.fragmentTracker,this.hls)},a.onMediaDetaching=function(){var r=this.media;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),v.prototype.onMediaDetaching.call(this)},a.onMediaPlaying=function(){this.tick()},a.onMediaSeeked=function(){var r=this.media,s=r?r.currentTime:null;(0,B.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},a.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},a.onManifestParsed=function(r,s){var u,f,E,D=!1,N=!1;s.levels.forEach(function(V){(u=V.audioCodec)&&(u.indexOf("mp4a.40.2")!==-1&&(D=!0),u.indexOf("mp4a.40.5")!==-1&&(N=!0))}),this.audioCodecSwitch=D&&N&&typeof((E=Br())==null||(f=E.prototype)===null||f===void 0?void 0:f.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},a.onLevelLoading=function(r,s){var u=this.levels;if(u&&this.state===mt){var f=u[s.level];(!f.details||f.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(f.details))&&(this.state=vr)}},a.onLevelLoaded=function(r,s){var u,f=this.levels,E=s.level,D=s.details,N=D.totalduration;if(f){this.log("Level "+E+" loaded ["+D.startSN+","+D.endSN+"], cc ["+D.startCC+", "+D.endCC+"] duration:"+N);var V=this.fragCurrent;!V||this.state!==bt&&this.state!==zt||V.level!==s.level&&V.loader&&(this.state=mt,this.backtrackFragment=null,V.loader.abort());var q=f[E],ge=0;if(D.live||(u=q.details)!==null&&u!==void 0&&u.live){if(D.fragments[0]||(D.deltaUpdateFailed=!0),D.deltaUpdateFailed)return;ge=this.alignPlaylists(D,q.details)}if(q.details=D,this.levelLastLoaded=E,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:D,level:E}),this.state===vr){if(this.waitForCdnTuneIn(D))return;this.state=mt}this.startFragRequested?D.live&&this.synchronizeToLiveEdge(D):this.setStartPosition(D,ge),this.tick()}else this.warn("Levels were reset while loading level "+E)},a._handleFragmentLoadProgress=function(r){var s,u=r.frag,f=r.part,E=r.payload,D=this.levels;if(D){var N=D[u.level],V=N.details;if(V){var q=N.videoCodec,ge=V.PTSKnown||!V.live,be=(s=u.initSegment)===null||s===void 0?void 0:s.data,Ve=this._getAudioCodec(N),Ke=this.transmuxer=this.transmuxer||new wr(this.hls,G.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Me=f?f.index:-1,We=Me!==-1,Xe=new rt(u.level,u.sn,u.stats.chunkCount,E.byteLength,Me,We),Ue=this.initPTS[u.cc];Ke.push(E,be,Ve,q,u,f,V.totalduration,ge,Xe,Ue)}else this.warn("Dropping fragment "+u.sn+" of level "+u.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered")},a.onAudioTrackSwitching=function(r,s){var u=this.altAudio,f=!!s.url,E=s.id;if(!f){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var D=this.fragCurrent;D!=null&&D.loader&&(this.log("Switching to main audio track, cancel main fragment load"),D.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var N=this.hls;u&&N.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),N.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:E})}},a.onAudioTrackSwitched=function(r,s){var u=s.id,f=!!this.hls.audioTracks[u].url;if(f){var E=this.videoBuffer;E&&this.mediaBuffer!==E&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=E)}this.altAudio=f,this.tick()},a.onBufferCreated=function(r,s){var u,f,E=s.tracks,D=!1;for(var N in E){var V=E[N];if(V.id==="main"){if(f=N,u=V,N==="video"){var q=E[N];q&&(this.videoBuffer=q.buffer)}}else D=!0}D&&u?(this.log("Alternate track found, use "+f+".buffered to schedule main fragment loading"),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function(r,s){var u=s.frag,f=s.part;if(!u||u.type===G.PlaylistLevelType.MAIN){if(this.fragContextChanged(u))return this.warn("Fragment "+u.sn+(f?" p: "+f.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===gr&&(this.state=mt));var E=f?f.stats:u.stats;this.fragLastKbps=Math.round(8*E.total/(E.buffering.end-E.loading.first)),u.sn!=="initSegment"&&(this.fragPrevious=u),this.fragBufferedComplete(u,f)}},a.onError=function(r,s){switch(s.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.PlaylistLevelType.MAIN,s);break;case P.ErrorDetails.LEVEL_LOAD_ERROR:case P.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==mr&&(s.fatal?(this.warn(""+s.details),this.state=mr):s.levelRetry||this.state!==vr||(this.state=mt));break;case P.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===jt||this.state===gr)){var u=!0,f=this.getFwdBufferInfo(this.media,G.PlaylistLevelType.MAIN);f&&f.len>.5&&(u=!this.reduceMaxBufferLength(f.len)),u&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},a.checkBuffer=function(){var r=this.media,s=this.gapController;if(r&&s&&r.readyState){if(this.loadedmetadata||!Be.getBuffered(r).length){var u=this.state!==mt?this.fragCurrent:null;s.poll(this.lastCurrentTime,u)}this.lastCurrentTime=r.currentTime}},a.onFragLoadEmergencyAborted=function(){this.state=mt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},a.onBufferFlushed=function(r,s){var u=s.type;if(u!==ne.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var f=(u===ne.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(f,u,G.PlaylistLevelType.MAIN)}},a.onLevelsUpdated=function(r,s){this.levels=s.levels},a.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function(){var r=this.media;if(r){var s=r.currentTime,u=this.startPosition;if(u>=0&&s<u){if(r.seeking)return void this.log("could not seek to "+u+", already seeking at "+s);var f=Be.getBuffered(r),E=(f.length?f.start(0):0)-u;E>0&&(E<this.config.maxBufferHole||E<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+E+" to match buffer start"),u+=E,this.startPosition=u),this.log("seek to target start position "+u+" from current time "+s),r.currentTime=u}}},a._getAudioCodec=function(r){var s=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s=s.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),s},a._loadBitrateTestFrag=function(r){var s=this;r.bitrateTest=!0,this._doFragLoad(r).then(function(u){var f=s.hls;if(u&&!f.nextLoadLevel&&!s.fragContextChanged(r)){s.fragLoadError=0,s.state=mt,s.startFragRequested=!1,s.bitrateTest=!1;var E=r.stats;E.parsing.start=E.parsing.end=E.buffering.start=E.buffering.end=self.performance.now(),f.trigger(c.Events.FRAG_LOADED,u),r.bitrateTest=!1}})},a._handleTransmuxComplete=function(r){var s,u="main",f=this.hls,E=r.remuxResult,D=r.chunkMeta,N=this.getCurrentContext(D);if(!N)return this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(D.level);var V=N.frag,q=N.part,ge=N.level,be=E.video,Ve=E.text,Ke=E.id3,Me=E.initSegment,We=ge.details,Xe=this.altAudio?void 0:E.audio;if(!this.fragContextChanged(V)){if(this.state=jt,Me){Me.tracks&&(this._bufferInitSegment(ge,Me.tracks,V,D),f.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:V,id:u,tracks:Me.tracks}));var Ue=Me.initPTS,ut=Me.timescale;(0,B.isFiniteNumber)(Ue)&&(this.initPTS[V.cc]=Ue,f.trigger(c.Events.INIT_PTS_FOUND,{frag:V,id:u,initPTS:Ue,timescale:ut}))}if(be&&E.independent!==!1){if(We){var tt=be.startPTS,Dt=be.endPTS,kt=be.startDTS,Yt=be.endDTS;if(q)q.elementaryStreams[be.type]={startPTS:tt,endPTS:Dt,startDTS:kt,endDTS:Yt};else if(be.firstKeyFrame&&be.independent&&(this.couldBacktrack=!0),be.dropped&&be.independent){var er=this.getMainFwdBufferInfo();if((er?er.end:this.getLoadPosition())+this.config.maxBufferHole<(be.firstKeyFramePTS?be.firstKeyFramePTS:tt)-this.config.maxBufferHole)return void this.backtrack(V);V.setElementaryStreamInfo(be.type,V.start,Dt,V.start,Yt,!0)}V.setElementaryStreamInfo(be.type,tt,Dt,kt,Yt),this.backtrackFragment&&(this.backtrackFragment=V),this.bufferFragmentData(be,V,q,D)}}else if(E.independent===!1)return void this.backtrack(V);if(Xe){var Kt=Xe.startPTS,Wt=Xe.endPTS,ar=Xe.startDTS,Tr=Xe.endDTS;q&&(q.elementaryStreams[ne.ElementaryStreamTypes.AUDIO]={startPTS:Kt,endPTS:Wt,startDTS:ar,endDTS:Tr}),V.setElementaryStreamInfo(ne.ElementaryStreamTypes.AUDIO,Kt,Wt,ar,Tr),this.bufferFragmentData(Xe,V,q,D)}if(We&&Ke!=null&&(s=Ke.samples)!==null&&s!==void 0&&s.length){var Ir={id:u,frag:V,details:We,samples:Ke.samples};f.trigger(c.Events.FRAG_PARSING_METADATA,Ir)}if(We&&Ve){var fr={id:u,frag:V,details:We,samples:Ve.samples};f.trigger(c.Events.FRAG_PARSING_USERDATA,fr)}}},a._bufferInitSegment=function(r,s,u,f){var E=this;if(this.state===jt){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var D=s.audio,N=s.video,V=s.audiovideo;if(D){var q=r.audioCodec,ge=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(q&&(q=q.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),D.metadata.channelCount!==1&&ge.indexOf("firefox")===-1&&(q="mp4a.40.5")),ge.indexOf("android")!==-1&&D.container!=="audio/mpeg"&&(q="mp4a.40.2",this.log("Android: force audio codec to "+q)),r.audioCodec&&r.audioCodec!==q&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+q+'"'),D.levelCodec=q,D.id="main",this.log("Init audio buffer, container:"+D.container+", codecs[selected/level/parsed]=["+(q||"")+"/"+(r.audioCodec||"")+"/"+D.codec+"]")}N&&(N.levelCodec=r.videoCodec,N.id="main",this.log("Init video buffer, container:"+N.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+N.codec+"]")),V&&this.log("Init audiovideo buffer, container:"+V.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+V.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(be){var Ve=s[be].initSegment;Ve!=null&&Ve.byteLength&&E.hls.trigger(c.Events.BUFFER_APPENDING,{type:be,data:Ve,frag:u,part:null,chunkMeta:f,parent:u.type})}),this.tick()}},a.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.PlaylistLevelType.MAIN)},a.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=mt},a.checkFragmentChanged=function(){var r=this.media,s=null;if(r&&r.readyState>1&&r.seeking===!1){var u=r.currentTime;if(Be.isBuffered(r,u)?s=this.getAppendedFrag(u):Be.isBuffered(r,u+.1)&&(s=this.getAppendedFrag(u+.1)),s){this.backtrackFragment=null;var f=this.fragPlaying,E=s.level;f&&s.sn===f.sn&&f.level===E&&s.urlId===f.urlId||(this.hls.trigger(c.Events.FRAG_CHANGED,{frag:s}),f&&f.level===E||this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:E}),this.fragPlaying=s)}}},i=t,(n=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var s=r.currentTime,u=this.currentFrag;if(u&&(0,B.isFiniteNumber)(s)&&(0,B.isFiniteNumber)(u.programDateTime)){var f=u.programDateTime+1e3*(s-u.start);return new Date(f)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&ci(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ar);const ii=function(){function v(e,t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var d=v.prototype;return d.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},d.getTotalWeight=function(){return this.totalWeight_},d.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},v}(),Oi=function(){function v(e,t,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ii(e),this.fast_=new ii(t)}var d=v.prototype;return d.update=function(e,t){var i=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new ii(e,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new ii(t,n.getEstimate(),n.getTotalWeight()))},d.sample=function(e,t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},d.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},d.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},d.destroy=function(){},v}();function bi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}const gi=function(){function v(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var n=i.config;this.bwEstimator=new Oi(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var d,e,t=v.prototype;return t.registerListeners=function(){var i=this.hls;i.on(c.Events.FRAG_LOADING,this.onFragLoading,this),i.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(c.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var i=this.hls;i.off(c.Events.FRAG_LOADING,this.onFragLoading,this),i.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(c.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(i,n){var a,r=n.frag;r.type===G.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=(a=n.part)!=null?a:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(i,n){var a=this.hls.config;n.details.live?this.bwEstimator.update(a.abrEwmaSlowLive,a.abrEwmaFastLive):this.bwEstimator.update(a.abrEwmaSlowVoD,a.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var i=this.fragCurrent,n=this.partCurrent,a=this.hls,r=a.autoLevelEnabled,s=(a.config,a.media);if(i&&s){var u=n?n.stats:i.stats,f=n?n.duration:i.duration;if(u.aborted||u.loaded&&u.loaded===u.total||i.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!s.paused&&s.playbackRate&&s.readyState){var E=a.mainForwardBufferInfo;if(E!==null){var D=performance.now()-u.loading.start,N=Math.abs(s.playbackRate);if(!(D<=500*f/N)){var V=u.loaded&&u.loading.first,q=this.bwEstimator.getEstimate(),ge=a.levels,be=a.minAutoLevel,Ve=ge[i.level],Ke=u.total||Math.max(u.loaded,Math.round(f*Ve.maxBitrate/8)),Me=V?1e3*u.loaded/D:0,We=Me?(Ke-u.loaded)/Me:8*Ke/q,Xe=E.len/N;if(!(We<=Xe)){var Ue,ut=Number.POSITIVE_INFINITY;for(Ue=i.level-1;Ue>be;Ue--){var tt=ge[Ue].maxBitrate;if((ut=Me?f*tt/(6.4*Me):f*tt/q)<Xe)break}ut>=We||(_.logger.warn("Fragment "+i.sn+(n?" part "+n.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Ue+`
      Current BW estimate: `+((0,B.isFiniteNumber)(q)?(q/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+We.toFixed(3)+` s
      Estimated load time for the next fragment: `+ut.toFixed(3)+` s
      Time to underbuffer: `+Xe.toFixed(3)+" s"),a.nextLoadLevel=Ue,V&&this.bwEstimator.sample(D,u.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),a.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:u}))}}}}}},t.onFragLoaded=function(i,n){var a=n.frag,r=n.part;if(a.type===G.PlaylistLevelType.MAIN&&(0,B.isFiniteNumber)(a.sn)){var s=r?r.stats:a.stats,u=r?r.duration:a.duration;if(this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var f=this.hls.levels[a.level],E=(f.loaded?f.loaded.bytes:0)+s.loaded,D=(f.loaded?f.loaded.duration:0)+u;f.loaded={bytes:E,duration:D},f.realBitrate=Math.round(8*E/D)}if(a.bitrateTest){var N={stats:s,frag:a,part:r,id:a.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,N)}}},t.onFragBuffered=function(i,n){var a=n.frag,r=n.part,s=r?r.stats:a.stats;if(!s.aborted&&a.type===G.PlaylistLevelType.MAIN&&a.sn!=="initSegment"){var u=s.parsing.end-s.loading.start;this.bwEstimator.sample(u,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),a.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},t.onError=function(i,n){switch(n.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var i=this.fragCurrent,n=this.partCurrent,a=this.hls,r=a.maxAutoLevel,s=a.config,u=a.minAutoLevel,f=a.media,E=n?n.duration:i?i.duration:0,D=(f&&f.currentTime,f&&f.playbackRate!==0?Math.abs(f.playbackRate):1),N=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,V=a.mainForwardBufferInfo,q=(V?V.len:0)/D,ge=this.findBestLevel(N,u,r,q,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(ge>=0)return ge;_.logger.trace((q?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var be=E?Math.min(E,s.maxStarvationDelay):s.maxStarvationDelay,Ve=s.abrBandWidthFactor,Ke=s.abrBandWidthUpFactor;if(!q){var Me=this.bitrateTestDelay;Me&&(be=(E?Math.min(E,s.maxLoadingDelay):s.maxLoadingDelay)-Me,_.logger.trace("bitrate test took "+Math.round(1e3*Me)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*be)+" ms"),Ve=Ke=1)}return ge=this.findBestLevel(N,u,r,q+be,Ve,Ke),Math.max(ge,0)},t.findBestLevel=function(i,n,a,r,s,u){for(var f,E=this.fragCurrent,D=this.partCurrent,N=this.lastLoadedFragLevel,V=this.hls.levels,q=V[N],ge=!(q==null||(f=q.details)===null||f===void 0||!f.live),be=q==null?void 0:q.codecSet,Ve=D?D.duration:E?E.duration:0,Ke=a;Ke>=n;Ke--){var Me=V[Ke];if(Me&&(!be||Me.codecSet===be)){var We,Xe=Me.details,Ue=(D?Xe==null?void 0:Xe.partTarget:Xe==null?void 0:Xe.averagetargetduration)||Ve;We=Ke<=N?s*i:u*i;var ut=V[Ke].maxBitrate,tt=ut*Ue/We;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+Ke+"/"+Math.round(We)+"/"+ut+"/"+Ue+"/"+r+"/"+tt),We>ut&&(tt===0||!(0,B.isFiniteNumber)(tt)||ge&&!this.bitrateTestDelay||tt<r))return Ke}}return-1},d=v,(e=[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,n=this.bwEstimator;if(i!==-1&&!n.canEstimate())return i;var a=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[a].loadError?i:(i!==-1&&(a=Math.min(i,a)),a)},set:function(i){this._nextAutoLevel=i}}])&&bi(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();var vi=function(){function v(){this.chunks=[],this.dataLength=0}var d=v.prototype;return d.push=function(e){this.chunks.push(e),this.dataLength+=e.length},d.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=t.length===1?t[0]:function(n,a){for(var r=new Uint8Array(a),s=0,u=0;u<n.length;u++){var f=n[u];r.set(f,s),s+=f.length}return r}(t,i),this.reset(),e):new Uint8Array(0)},d.reset=function(){this.chunks.length=0,this.dataLength=0},v}();function Xr(){return Xr=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},Xr.apply(this,arguments)}function pi(v,d){return pi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pi(v,d)}var Li=function(v){var d,e;function t(n,a){var r;return(r=v.call(this,n,a,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,pi(d,e);var i=t.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var n=this.hls;n.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(c.Events.ERROR,this.onError,this),n.on(c.Events.BUFFER_RESET,this.onBufferReset,this),n.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var n=this.hls;n.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(c.Events.ERROR,this.onError,this),n.off(c.Events.BUFFER_RESET,this.onBufferReset,this),n.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(n,a){var r=a.frag,s=a.id,u=a.initPTS;if(s==="main"){var f=r.cc;this.initPTS[r.cc]=u,this.log("InitPTS for cc: "+f+" found from main: "+u),this.videoTrackCC=f,this.state===ir&&this.tick()}},i.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=Pt);var a=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,a>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),n=a,this.state=mt):(this.loadedmetadata=!1,this.state=dr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},i.doTick=function(){switch(this.state){case mt:this.doTickIdle();break;case dr:var n,a=this.levels,r=this.trackId,s=a==null||(n=a[r])===null||n===void 0?void 0:n.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=ir}break;case zt:var u,f=performance.now(),E=this.retryDate;(!E||f>=E||(u=this.media)!==null&&u!==void 0&&u.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=mt);break;case ir:var D=this.waitingData;if(D){var N=D.frag,V=D.part,q=D.cache,ge=D.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=bt;var be={frag:N,part:V,payload:q.flush(),networkDetails:null};this._handleFragmentLoadProgress(be),ge&&v.prototype._handleFragmentLoadComplete.call(this,be)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Ve=this.getLoadPosition(),Ke=Be.bufferInfo(this.mediaBuffer,Ve,this.config.maxBufferHole);O(Ke.end,this.config.maxFragLookUpTolerance,N)<0&&(this.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+Ke.end+" is needed"),this.clearWaitingFragment())}}else this.state=mt}this.onTickEnd()},i.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=mt)},i.resetLoadingState=function(){this.clearWaitingFragment(),v.prototype.resetLoadingState.call(this)},i.onTickEnd=function(){var n=this.media;if(n&&n.readyState){var a=(this.mediaBuffer?this.mediaBuffer:n).buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=n.currentTime}},i.doTickIdle=function(){var n,a,r=this.hls,s=this.levels,u=this.media,f=this.trackId,E=r.config;if(s&&s[f]&&(u||!this.startFragRequested&&E.startFragPrefetch)){var D=s[f].details;if(!D||D.live&&this.levelLastLoaded!==f||this.waitForCdnTuneIn(D))this.state=dr;else{var N=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&N&&(this.bufferFlushed=!1,this.afterBufferFlushed(N,ne.ElementaryStreamTypes.AUDIO,G.PlaylistLevelType.AUDIO));var V=this.getFwdBufferInfo(N,G.PlaylistLevelType.AUDIO);if(V!==null){var q=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,G.PlaylistLevelType.MAIN),ge=V.len,be=this.getMaxBufferLength(q==null?void 0:q.len),Ve=this.audioSwitch;if(!(ge>=be)||Ve){if(!Ve&&this._streamEnded(V,D))return r.trigger(c.Events.BUFFER_EOS,{type:"audio"}),void(this.state=yr);var Ke=D.fragments[0].start,Me=V.end;if(Ve&&u){var We=this.getLoadPosition();Me=We,D.PTSKnown&&We<Ke&&(V.end>Ke||V.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),u.currentTime=Ke+.05)}if(!(q&&Me>q.end+D.targetduration)&&(q&&q.len||!V.len)){var Xe=this.getNextFragment(Me,D);Xe?((n=Xe.decryptdata)===null||n===void 0?void 0:n.keyFormat)!=="identity"||(a=Xe.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(Xe,D,Me):this.loadKey(Xe,D):this.bufferFlushed=!0}}}}}},i.getMaxBufferLength=function(n){var a=v.prototype.getMaxBufferLength.call(this);return n?Math.max(a,n):a},i.onMediaDetaching=function(){this.videoBuffer=null,v.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(n,a){var r=a.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(s){return new Gt(s)})},i.onAudioTrackSwitching=function(n,a){var r=!!a.url;this.trackId=a.id;var s=this.fragCurrent;s!=null&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=mt):this.state=Pt,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(n,a){this.mainDetails=a.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(n,a){var r;if(this.mainDetails!=null){var s=this.levels,u=a.details,f=a.id;if(s){this.log("Track "+f+" loaded ["+u.startSN+","+u.endSN+"],duration:"+u.totalduration);var E=s[f],D=0;if(u.live||(r=E.details)!==null&&r!==void 0&&r.live){var N=this.mainDetails;if(u.fragments[0]||(u.deltaUpdateFailed=!0),u.deltaUpdateFailed||!N)return;!E.details&&u.hasProgramDateTime&&N.hasProgramDateTime?(I(u,N),D=u.fragments[0].start):D=this.alignPlaylists(u,E.details)}E.details=u,this.levelLastLoaded=f,this.startFragRequested||!this.mainDetails&&u.live||this.setStartPosition(E.details,D),this.state!==dr||this.waitForCdnTuneIn(u)||(this.state=mt),this.tick()}else this.warn("Audio tracks were reset while loading level "+f)}else this.cachedTrackLoadedData=a},i._handleFragmentLoadProgress=function(n){var a,r=n.frag,s=n.part,u=n.payload,f=this.config,E=this.trackId,D=this.levels;if(D){var N=D[E],V=N.details,q=f.defaultAudioCodec||N.audioCodec||"mp4a.40.2",ge=this.transmuxer;ge||(ge=this.transmuxer=new wr(this.hls,G.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var be=this.initPTS[r.cc],Ve=(a=r.initSegment)===null||a===void 0?void 0:a.data;if(be!==void 0){var Ke=s?s.index:-1,Me=Ke!==-1,We=new rt(r.level,r.sn,r.stats.chunkCount,u.byteLength,Ke,Me);ge.push(u,Ve,q,"",r,s,V.totalduration,!1,We,be)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+V.startSN+" ,"+V.endSN+"],track "+E),(this.waitingData=this.waitingData||{frag:r,part:s,cache:new vi,complete:!1}).cache.push(new Uint8Array(u)),this.waitingVideoCC=this.videoTrackCC,this.state=ir}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:v.prototype._handleFragmentLoadComplete.call(this,n)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(n,a){var r=a.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer||null)},i.onFragBuffered=function(n,a){var r=a.frag,s=a.part;r.type===G.PlaylistLevelType.AUDIO&&(this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(s?" p: "+s.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(r.sn!=="initSegment"&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,s)))},i.onError=function(n,a){switch(a.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.PlaylistLevelType.AUDIO,a);break;case P.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case P.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==mr&&this.state!==Pt&&(this.state=a.fatal?mr:mt,this.warn(a.details+" while loading frag, switching to "+this.state+" state"));break;case P.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="audio"&&(this.state===jt||this.state===gr)){var r=!0,s=this.getFwdBufferInfo(this.mediaBuffer,G.PlaylistLevelType.AUDIO);s&&s.len>.5&&(r=!this.reduceMaxBufferLength(s.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},i.onBufferFlushed=function(n,a){a.type===ne.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},i._handleTransmuxComplete=function(n){var a,r="audio",s=this.hls,u=n.remuxResult,f=n.chunkMeta,E=this.getCurrentContext(f);if(!E)return this.warn("The loading context changed while buffering fragment "+f.sn+" of level "+f.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(f.level);var D=E.frag,N=E.part,V=E.level.details,q=u.audio,ge=u.text,be=u.id3,Ve=u.initSegment;if(!this.fragContextChanged(D)&&V){if(this.state=jt,this.audioSwitch&&q&&this.completeAudioSwitch(),Ve!=null&&Ve.tracks&&(this._bufferInitSegment(Ve.tracks,D,f),s.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:r,tracks:Ve.tracks})),q){var Ke=q.startPTS,Me=q.endPTS,We=q.startDTS,Xe=q.endDTS;N&&(N.elementaryStreams[ne.ElementaryStreamTypes.AUDIO]={startPTS:Ke,endPTS:Me,startDTS:We,endDTS:Xe}),D.setElementaryStreamInfo(ne.ElementaryStreamTypes.AUDIO,Ke,Me,We,Xe),this.bufferFragmentData(q,D,N,f)}if(be!=null&&(a=be.samples)!==null&&a!==void 0&&a.length){var Ue=Xr({id:r,frag:D,details:V},be);s.trigger(c.Events.FRAG_PARSING_METADATA,Ue)}if(ge){var ut=Xr({id:r,frag:D,details:V},ge);s.trigger(c.Events.FRAG_PARSING_USERDATA,ut)}}},i._bufferInitSegment=function(n,a,r){if(this.state===jt){n.video&&delete n.video;var s=n.audio;if(s){s.levelCodec=s.codec,s.id="audio",this.log("Init audio buffer, container:"+s.container+", codecs[parsed]=["+s.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,n);var u=s.initSegment;if(u!=null&&u.byteLength){var f={type:"audio",frag:a,part:null,chunkMeta:r,parent:a.type,data:u};this.hls.trigger(c.Events.BUFFER_APPENDING,f)}this.tick()}}},i.loadFragment=function(n,a,r){var s=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||s===x.NOT_LOADED||s===x.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):a.live&&!(0,B.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=ir):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,n,a,r)))},i.completeAudioSwitch=function(){var n=this.hls,a=this.media,r=this.trackId;a&&(this.log("Switching audio track : flushing all audio"),v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:r})},t}(Ar);const Di=Li;function mi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ni(v,d){return ni=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ni(v,d)}const Dr=function(v){var d,e;function t(r){var s;return(s=v.call(this,r,"[audio-track-controller]")||this).tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.trackName="",s.selectDefaultTrack=!0,s.registerListeners(),s}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ni(d,e);var i,n,a=t.prototype;return a.registerListeners=function(){var r=this.hls;r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(c.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var r=this.hls;r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(c.Events.ERROR,this.onError,this)},a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,v.prototype.destroy.call(this)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},a.onManifestParsed=function(r,s){this.tracks=s.audioTracks||[]},a.onAudioTrackLoaded=function(r,s){var u=s.id,f=s.details,E=this.tracksInGroup[u];if(E){var D=E.details;E.details=s.details,this.log("audioTrack "+u+" loaded ["+f.startSN+"-"+f.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,s,D))}else this.warn("Invalid audio track id "+u)},a.onLevelLoading=function(r,s){this.switchLevel(s.level)},a.onLevelSwitching=function(r,s){this.switchLevel(s.level)},a.switchLevel=function(r){var s=this.hls.levels[r];if(s!=null&&s.audioGroupIds){var u=s.audioGroupIds[s.urlId];if(this.groupId!==u){this.groupId=u;var f=this.tracks.filter(function(D){return!u||D.groupId===u});this.selectDefaultTrack&&!f.some(function(D){return D.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=f;var E={audioTracks:f};this.log("Updating audio tracks, "+f.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(c.Events.AUDIO_TRACKS_UPDATED,E),this.selectInitialTrack()}}},a.onError=function(r,s){v.prototype.onError.call(this,r,s),!s.fatal&&s.context&&s.context.type===G.PlaylistContextType.AUDIO_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},a.setAudioTrack=function(r){var s=this.tracksInGroup;if(r<0||r>=s.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var u=s[this.trackId];this.log("Now switching to audio-track index "+r);var f=s[r],E=f.id,D=f.groupId,N=D===void 0?"":D,V=f.name,q=f.type,ge=f.url;if(this.trackId=r,this.trackName=V,this.selectDefaultTrack=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHING,{id:E,groupId:N,name:V,type:q,url:ge}),!f.details||f.details.live){var be=this.switchParams(f.url,u==null?void 0:u.details);this.loadPlaylist(be)}}},a.selectInitialTrack=function(){this.tracksInGroup;var r=this.trackName,s=this.findTrackId(r)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},a.findTrackId=function(r){for(var s=this.tracksInGroup,u=0;u<s.length;u++){var f=s[u];if((!this.selectDefaultTrack||f.default)&&(!r||r===f.name))return f.id}return-1},a.loadPlaylist=function(r){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var u=s.id,f=s.groupId,E=s.url;if(r)try{E=r.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("loading audio-track playlist for id: "+u),this.clearTimer(),this.hls.trigger(c.Events.AUDIO_TRACK_LOADING,{url:E,id:u,groupId:f,deliveryDirectives:r||null})}},i=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}])&&mi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Xt);function yi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function Zr(v,d){return Zr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zr(v,d)}var Pi=function(v){var d,e;function t(r,s){var u;return(u=v.call(this,r,s,"[subtitle-stream-controller]")||this).levels=[],u.currentTrackId=-1,u.tracksBuffered=[],u.mainDetails=null,u._registerListeners(),u}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Zr(d,e);var i,n,a=t.prototype;return a.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},a._registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.Events.ERROR,this.onError,this),r.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(c.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a._unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.Events.ERROR,this.onError,this),r.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(c.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},a.startLoad=function(){this.stopLoad(),this.state=mt,this.setInterval(500),this.tick()},a.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},a.onLevelLoaded=function(r,s){this.mainDetails=s.details},a.onSubtitleFragProcessed=function(r,s){var u=s.frag,f=s.success;if(this.fragPrevious=u,this.state=mt,f){var E=this.tracksBuffered[this.currentTrackId];if(E){for(var D,N=u.start,V=0;V<E.length;V++)if(N>=E[V].start&&N<=E[V].end){D=E[V];break}var q=u.start+u.duration;D?D.end=q:(D={start:N,end:q},E.push(D)),this.fragmentTracker.fragBuffered(u)}}},a.onBufferFlushing=function(r,s){var u=s.startOffset,f=s.endOffset;if(u===0&&f!==Number.POSITIVE_INFINITY){var E=this.currentTrackId,D=this.levels;if(!D.length||!D[E]||!D[E].details)return;var N=f-D[E].details.targetduration;if(N<=0)return;s.endOffsetSubtitles=Math.max(0,N),this.tracksBuffered.forEach(function(V){for(var q=0;q<V.length;)if(V[q].end<=N)V.shift();else{if(!(V[q].start<N))break;V[q].start=N,q++}}),this.fragmentTracker.removeFragmentsInRange(u,N,G.PlaylistLevelType.SUBTITLE)}},a.onError=function(r,s){var u,f=s.frag;f&&f.type===G.PlaylistLevelType.SUBTITLE&&((u=this.fragCurrent)!==null&&u!==void 0&&u.loader&&this.fragCurrent.loader.abort(),this.state=mt)},a.onSubtitleTracksUpdated=function(r,s){var u=this,f=s.subtitleTracks;this.tracksBuffered=[],this.levels=f.map(function(E){return new Gt(E)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(E){u.tracksBuffered[E.id]=[]}),this.mediaBuffer=null},a.onSubtitleTrackSwitch=function(r,s){if(this.currentTrackId=s.id,this.levels.length&&this.currentTrackId!==-1){var u=this.levels[this.currentTrackId];u!=null&&u.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,u&&this.setInterval(500)}else this.clearInterval()},a.onSubtitleTrackLoaded=function(r,s){var u,f=s.details,E=s.id,D=this.currentTrackId,N=this.levels;if(N.length){var V=N[D];if(!(E>=N.length||E!==D)&&V){if(this.mediaBuffer=this.mediaBufferTimeRanges,f.live||(u=V.details)!==null&&u!==void 0&&u.live){var q=this.mainDetails;if(f.deltaUpdateFailed||!q)return;var ge=q.fragments[0];V.details?this.alignPlaylists(f,V.details)===0&&ge&&hr(f,ge.start):f.hasProgramDateTime&&q.hasProgramDateTime?I(f,q):ge&&hr(f,ge.start)}V.details=f,this.levelLastLoaded=E,this.tick(),f.live&&!this.fragCurrent&&this.media&&this.state===mt&&(C(null,f.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),V.details=void 0))}}},a._handleFragmentLoadComplete=function(r){var s=r.frag,u=r.payload,f=s.decryptdata,E=this.hls;if(!this.fragContextChanged(s)&&u&&u.byteLength>0&&f&&f.key&&f.iv&&f.method==="AES-128"){var D=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(u),f.key.buffer,f.iv.buffer).then(function(N){var V=performance.now();E.trigger(c.Events.FRAG_DECRYPTED,{frag:s,payload:N,stats:{tstart:D,tdecrypt:V}})})}},a.doTick=function(){if(this.media){if(this.state===mt){var r=this.currentTrackId,s=this.levels;if(!s.length||!s[r]||!s[r].details)return;var u=s[r].details,f=u.targetduration,E=this.config,D=this.media,N=Be.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],D.currentTime-f,E.maxBufferHole),V=N.end;if(N.len>this.getMaxBufferLength()+f)return;var q,ge=u.fragments,be=ge.length,Ve=u.edge,Ke=this.fragPrevious;if(V<Ve){var Me=E.maxFragLookUpTolerance;!(q=C(Ke,ge,Math.max(ge[0].start,V),Me))&&Ke&&Ke.start<ge[0].start&&(q=ge[0])}else q=ge[be-1];if(!(q=this.mapToInitFragWhenRequired(q))||this.fragmentTracker.getState(q)!==x.NOT_LOADED)return;q.encrypted?this.loadKey(q,u):this.loadFragment(q,u,V)}}else this.state=mt},a.loadFragment=function(r,s,u){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):v.prototype.loadFragment.call(this,r,s,u)},i=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return new Fi(this.tracksBuffered[this.currentTrackId]||[])}}])&&yi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Ar),Fi=function(v){this.buffered=void 0;var d=function(e,t,i){if((t>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return v[t][e]};this.buffered={get length(){return v.length},end:function(e){return d("end",e,v.length)},start:function(e){return d("start",e,v.length)}}};function Mi(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function ei(v,d){return ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ei(v,d)}function ai(v){for(var d=[],e=0;e<v.length;e++){var t=v[e];t.kind==="subtitles"&&t.label&&d.push(v[e])}return d}const Ni=function(v){var d,e;function t(r){var s;return(s=v.call(this,r,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s._subtitleDisplay=!0,s.registerListeners(),s}e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,ei(d,e);var i,n,a=t.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,v.prototype.destroy.call(this)},a.registerListeners=function(){var r=this.hls;r.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var r=this.hls;r.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.Events.ERROR,this.onError,this)},a.onMediaAttached=function(r,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},a.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),ai(this.media.textTracks).forEach(function(r){Ze(r)}),this.subtitleTrack=-1,this.media=null)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(r,s){this.tracks=s.subtitleTracks},a.onSubtitleTrackLoaded=function(r,s){var u=s.id,f=s.details,E=this.trackId,D=this.tracksInGroup[E];if(D){var N=D.details;D.details=s.details,this.log("subtitle track "+u+" loaded ["+f.startSN+"-"+f.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,s,N))}else this.warn("Invalid subtitle track id "+u)},a.onLevelLoading=function(r,s){this.switchLevel(s.level)},a.onLevelSwitching=function(r,s){this.switchLevel(s.level)},a.switchLevel=function(r){var s=this.hls.levels[r];if(s!=null&&s.textGroupIds){var u=s.textGroupIds[s.urlId];if(this.groupId!==u){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,E=this.tracks.filter(function(V){return!u||V.groupId===u});this.tracksInGroup=E;var D=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=u;var N={subtitleTracks:E};this.log("Updating subtitle tracks, "+E.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(c.Events.SUBTITLE_TRACKS_UPDATED,N),D!==-1&&this.setSubtitleTrack(D,f)}}},a.findTrackId=function(r){for(var s=this.tracksInGroup,u=0;u<s.length;u++){var f=s[u];if((!this.selectDefaultTrack||f.default)&&(!r||r===f.name))return f.id}return-1},a.onError=function(r,s){v.prototype.onError.call(this,r,s),!s.fatal&&s.context&&s.context.type===G.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},a.loadPlaylist=function(r){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var u=s.id,f=s.groupId,E=s.url;if(r)try{E=r.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(c.Events.SUBTITLE_TRACK_LOADING,{url:E,id:u,groupId:f,deliveryDirectives:r||null})}},a.toggleTrackModes=function(r){var s=this,u=this.media,f=this.trackId;if(u){var E=ai(u.textTracks),D=E.filter(function(q){return q.groupId===s.groupId});if(r===-1)[].slice.call(E).forEach(function(q){q.mode="disabled"});else{var N=D[f];N&&(N.mode="disabled")}var V=D[r];V&&(V.mode=this.subtitleDisplay?"showing":"hidden")}},a.setSubtitleTrack=function(r,s){var u,f=this.tracksInGroup;if(this.media){if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(u=f[r])!==null&&u!==void 0&&u.details)||r<-1||r>=f.length)){this.clearTimer();var E=f[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,E){var D=E.id,N=E.groupId,V=N===void 0?"":N,q=E.name,ge=E.type,be=E.url;this.hls.trigger(c.Events.SUBTITLE_TRACK_SWITCH,{id:D,groupId:V,name:q,type:ge,url:be});var Ve=this.switchParams(E.url,s==null?void 0:s.details);this.loadPlaylist(Ve)}else this.hls.trigger(c.Events.SUBTITLE_TRACK_SWITCH,{id:r})}}else this.queuedDefaultTrack=r},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var r=-1,s=ai(this.media.textTracks),u=0;u<s.length;u++)if(s[u].mode==="hidden")r=u;else if(s[u].mode==="showing"){r=u;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},i=t,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,s)}}])&&Mi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Xt);var Ut,Ji=function(){function v(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var d=v.prototype;return d.append=function(e,t){var i=this.queues[t];i.push(e),i.length===1&&this.buffers[t]&&this.executeNext(t)},d.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},d.appendBlocker=function(e){var t,i=new Promise(function(a){t=a}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},d.executeNext=function(e){var t=this.buffers,i=this.queues,n=t[e],a=i[e];if(a.length){var r=a[0];try{r.execute()}catch(s){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(s),n&&n.updating||(a.shift(),this.executeNext(e))}}},d.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},d.current=function(e){return this.queues[e][0]},v}(),Ui=Rr(),Zi=/([ha]vc.)(?:\.[^.,]+)+/,an=function(){function v(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=t.hls,n=t.media,a=t.mediaSource;_.logger.log("[buffer-controller]: Media source opened"),n&&(t.updateMediaElementDuration(),i.trigger(c.Events.MEDIA_ATTACHED,{media:n})),a&&a.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){_.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){_.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var d=v.prototype;return d.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},d.destroy=function(){this.unregisterListeners(),this.details=null},d.registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(c.Events.BUFFER_RESET,this.onBufferReset,this),e.on(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(c.Events.BUFFER_EOS,this.onBufferEos,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(c.Events.FRAG_PARSED,this.onFragParsed,this),e.on(c.Events.FRAG_CHANGED,this.onFragChanged,this)},d.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(c.Events.BUFFER_RESET,this.onBufferReset,this),e.off(c.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(c.Events.BUFFER_EOS,this.onBufferEos,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(c.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(c.Events.FRAG_PARSED,this.onFragParsed,this),e.off(c.Events.FRAG_CHANGED,this.onFragChanged,this)},d._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Ji(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},d.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,_.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},d.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&Ui){var n=this.mediaSource=new Ui;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src}},d.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(_.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(n){_.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):_.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.Events.MEDIA_DETACHED,void 0)},d.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(n){_.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",n)}}),this._initSourceBuffer()},d.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(a){if(n){var r=i.tracks[a];if(r&&typeof r.buffer.changeType=="function"){var s=t[a],u=s.id,f=s.codec,E=s.levelCodec,D=s.container,N=s.metadata,V=(r.levelCodec||r.codec).replace(Zi,"$1"),q=(E||f).replace(Zi,"$1");if(V!==q){var ge=D+";codecs="+(E||f);i.appendChangeType(a,ge),_.logger.log("[buffer-controller]: switching codec "+V+" to "+q),i.tracks[a]={buffer:r.buffer,codec:f,container:D,levelCodec:E,metadata:N,id:u}}}}else i.pendingTracks[a]=t[a]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},d.appendChangeType=function(e,t){var i=this,n=this.operationQueue,a={execute:function(){var r=i.sourceBuffer[e];r&&(_.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(r){_.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",r)}};n.append(a,e)},d.onBufferAppending=function(e,t){var i=this,n=this.hls,a=this.operationQueue,r=this.tracks,s=t.data,u=t.type,f=t.frag,E=t.part,D=t.chunkMeta,N=D.buffering[u],V=self.performance.now();N.start=V;var q=f.stats.buffering,ge=E?E.stats.buffering:null;q.start===0&&(q.start=V),ge&&ge.start===0&&(ge.start=V);var be=r.audio,Ve=u==="audio"&&D.id===1&&(be==null?void 0:be.container)==="audio/mpeg",Ke={execute:function(){if(N.executeStart=self.performance.now(),Ve){var Me=i.sourceBuffer[u];if(Me){var We=f.start-Me.timestampOffset;Math.abs(We)>=.1&&(_.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+We+") sn: "+f.sn+")"),Me.timestampOffset=f.start)}}i.appendExecutor(s,u)},onStart:function(){},onComplete:function(){var Me=self.performance.now();N.executeEnd=N.end=Me,q.first===0&&(q.first=Me),ge&&ge.first===0&&(ge.first=Me);var We=i.sourceBuffer,Xe={};for(var Ue in We)Xe[Ue]=Be.getBuffered(We[Ue]);i.appendError=0,i.hls.trigger(c.Events.BUFFER_APPENDED,{type:u,frag:f,part:E,chunkMeta:D,parent:f.type,timeRanges:Xe})},onError:function(Me){_.logger.error("[buffer-controller]: Error encountered while trying to append to the "+u+" SourceBuffer",Me);var We={type:P.ErrorTypes.MEDIA_ERROR,parent:f.type,details:P.ErrorDetails.BUFFER_APPEND_ERROR,err:Me,fatal:!1};Me.code===DOMException.QUOTA_EXCEEDED_ERR?We.details=P.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,We.details=P.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(_.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),We.fatal=!0,n.stopLoad())),n.trigger(c.Events.ERROR,We)}};a.append(Ke,u)},d.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,a=function(r){return{execute:i.removeExecutor.bind(i,r,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(c.Events.BUFFER_FLUSHED,{type:r})},onError:function(s){_.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",s)}}};t.type?n.append(a(t.type),t.type):this.getSourceBufferTypes().forEach(function(r){n.append(a(r),r)})},d.onFragParsed=function(e,t){var i=this,n=t.frag,a=t.part,r=[],s=a?a.elementaryStreams:n.elementaryStreams;s[ne.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(s[ne.ElementaryStreamTypes.AUDIO]&&r.push("audio"),s[ne.ElementaryStreamTypes.VIDEO]&&r.push("video")),r.length===0&&_.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var u=self.performance.now();n.stats.buffering.end=u,a&&(a.stats.buffering.end=u);var f=a?a.stats:n.stats;i.hls.trigger(c.Events.FRAG_BUFFERED,{frag:n,part:a,stats:f,id:n.type})},r)},d.onFragChanged=function(e,t){this.flushBackBuffer()},d.onBufferEos=function(e,t){var i=this;this.getSourceBufferTypes().reduce(function(n,a){var r=i.sourceBuffer[a];return t.type&&t.type!==a||r&&!r.ended&&(r.ended=!0,_.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),n&&!(r&&!r.ended)},!0)&&this.blockBuffers(function(){var n=i.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},d.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},d.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,n=this.sourceBuffer;if(i&&t!==null){var a=this.getSourceBufferTypes();if(a.length){var r=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,B.isFiniteNumber)(r)&&!(r<0)){var s=i.currentTime,u=t.levelTargetDuration,f=Math.max(r,u),E=Math.floor(s/u)*u-f;a.forEach(function(D){var N=n[D];if(N){var V=Be.getBuffered(N);V.length>0&&E>V.start(0)&&(e.trigger(c.Events.BACK_BUFFER_REACHED,{bufferEnd:E}),t.live&&e.trigger(c.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:E}),e.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:E,type:D}))}})}}}},d.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,a=e.fragments[0].start+e.totalduration,r=i.duration,s=(0,B.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(_.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(a>s&&a>r||!(0,B.isFiniteNumber)(r))&&(_.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),n.duration=a)}},d.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){var n=Math.max(0,i[0].start),a=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,a)}},d.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!e||n===2){this.createSourceBuffers(i),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length===0)return void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach(function(r){t.executeNext(r)})}},d.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var a in e)if(!t[a]){var r=e[a];if(!r)throw Error("source buffer exists for track "+a+", however track does not");var s=r.levelCodec||r.codec,u=r.container+";codecs="+s;_.logger.log("[buffer-controller]: creating sourceBuffer("+u+")");try{var f=t[a]=i.addSourceBuffer(u),E=a;this.addBufferListener(E,"updatestart",this._onSBUpdateStart),this.addBufferListener(E,"updateend",this._onSBUpdateEnd),this.addBufferListener(E,"error",this._onSBUpdateError),this.tracks[a]={buffer:f,codec:s,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},n++}catch(D){_.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+D.message),this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:D,mimeType:u})}}n&&this.hls.trigger(c.Events.BUFFER_CREATED,{tracks:this.tracks})},d._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},d._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},d._onSBUpdateError=function(e,t){_.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},d.removeExecutor=function(e,t,i){var n=this.media,a=this.mediaSource,r=this.operationQueue,s=this.sourceBuffer[e];if(!n||!a||!s)return _.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);var u=(0,B.isFiniteNumber)(n.duration)?n.duration:1/0,f=(0,B.isFiniteNumber)(a.duration)?a.duration:1/0,E=Math.max(0,t),D=Math.min(i,u,f);D>E?(_.logger.log("[buffer-controller]: Removing ["+E+","+D+"] from the "+e+" SourceBuffer"),s.remove(E,D)):r.shiftAndExecuteNext(e)},d.appendExecutor=function(e,t){var i=this.operationQueue,n=this.sourceBuffer[t];if(!n)return _.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)},d.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return _.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,a=t.map(function(r){return n.appendBlocker(r)});Promise.all(a).then(function(){e(),t.forEach(function(r){var s=i.sourceBuffer[r];s&&s.updating||n.shiftAndExecuteNext(r)})})},d.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},d.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var a=i.bind(this,e);this.listeners[e].push({event:t,listener:a}),n.addEventListener(t,a)}},d.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(i){t.removeEventListener(i.event,i.listener)})},v}(),Bi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Gi=function(v){var d=v;return Bi.hasOwnProperty(v)&&(d=Bi[v]),String.fromCharCode(d)},w=15,b=100,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(v){v[v.ERROR=0]="ERROR",v[v.TEXT=1]="TEXT",v[v.WARNING=2]="WARNING",v[v.INFO=2]="INFO",v[v.DEBUG=3]="DEBUG",v[v.DATA=3]="DATA"})(Ut||(Ut={}));var h=function(){function v(){this.time=null,this.verboseLevel=Ut.ERROR}return v.prototype.log=function(d,e){this.verboseLevel>=d&&_.logger.log(this.time+" ["+d+"] "+e)},v}(),y=function(v){for(var d=[],e=0;e<v.length;e++)d.push(v[e].toString(16));return d},T=function(){function v(e,t,i,n,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=n||"black",this.flash=a||!1}var d=v.prototype;return d.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},d.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},d.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},d.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},d.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},d.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),L=function(){function v(e,t,i,n,a,r){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new T(t,i,n,a,r)}var d=v.prototype;return d.reset=function(){this.uchar=" ",this.penState.reset()},d.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},d.setPenState=function(e){this.penState.copy(e)},d.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},d.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},d.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),A=function(){function v(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<b;t++)this.chars.push(new L);this.logger=e,this.pos=0,this.currPenState=new T}var d=v.prototype;return d.equals=function(e){for(var t=!0,i=0;i<b;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},d.copy=function(e){for(var t=0;t<b;t++)this.chars[t].copy(e.chars[t])},d.isEmpty=function(){for(var e=!0,t=0;t<b;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},d.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(Ut.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>b&&(this.logger.log(Ut.DEBUG,"Too large cursor position "+this.pos),this.pos=b)},d.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},d.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},d.insertChar=function(e){e>=144&&this.backSpace();var t=Gi(e);this.pos>=b?this.logger.log(Ut.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},d.clearFromPos=function(e){var t;for(t=e;t<b;t++)this.chars[t].reset()},d.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},d.clearToEndOfRow=function(){this.clearFromPos(this.pos)},d.getTextString=function(){for(var e=[],t=!0,i=0;i<b;i++){var n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")},d.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},v}(),M=function(){function v(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<w;t++)this.rows.push(new A(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var d=v.prototype;return d.reset=function(){for(var e=0;e<w;e++)this.rows[e].clear();this.currRow=14},d.equals=function(e){for(var t=!0,i=0;i<w;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},d.copy=function(e){for(var t=0;t<w;t++)this.rows[t].copy(e.rows[t])},d.isEmpty=function(){for(var e=!0,t=0;t<w;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},d.backSpace=function(){this.rows[this.currRow].backSpace()},d.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},d.insertChar=function(e){this.rows[this.currRow].insertChar(e)},d.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},d.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},d.setCursor=function(e){this.logger.log(Ut.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},d.setPAC=function(e){this.logger.log(Ut.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<w;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var r=a.rows[n].cueStartTime,s=this.logger.time;if(r&&s!==null&&r<s)for(var u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[n+u])}}this.currRow=t;var f=this.rows[this.currRow];if(e.indent!==null){var E=e.indent,D=Math.max(E-1,0);f.setCursor(e.indent),e.color=f.chars[D].penState.foreground}var N={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(N)},d.setBkgData=function(e){this.logger.log(Ut.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},d.setRollUpRows=function(e){this.nrRollUpRows=e},d.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(Ut.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(Ut.INFO,"Rolling up")}else this.logger.log(Ut.DEBUG,"roll_up but nrRollUpRows not set yet")},d.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,a=0;a<w;a++){var r=this.rows[a].getTextString();r&&(n=a+1,e?t.push("Row "+n+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join(`
`)),i},d.getTextAndFormat=function(){return this.rows},v}(),oe=function(){function v(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new M(i),this.nonDisplayedMemory=new M(i),this.lastOutputScreen=new M(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var d=v.prototype;return d.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},d.getHandler=function(){return this.outputFilter},d.setHandler=function(e){this.outputFilter=e},d.setPAC=function(e){this.writeScreen.setPAC(e)},d.setBkgData=function(e){this.writeScreen.setBkgData(e)},d.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(Ut.INFO,"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},d.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Ut.INFO,i+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(Ut.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},d.ccRCL=function(){this.logger.log(Ut.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},d.ccBS=function(){this.logger.log(Ut.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},d.ccAOF=function(){},d.ccAON=function(){},d.ccDER=function(){this.logger.log(Ut.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},d.ccRU=function(e){this.logger.log(Ut.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},d.ccFON=function(){this.logger.log(Ut.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},d.ccRDC=function(){this.logger.log(Ut.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},d.ccTR=function(){this.logger.log(Ut.INFO,"TR"),this.setMode("MODE_TEXT")},d.ccRTD=function(){this.logger.log(Ut.INFO,"RTD"),this.setMode("MODE_TEXT")},d.ccEDM=function(){this.logger.log(Ut.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},d.ccCR=function(){this.logger.log(Ut.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},d.ccENM=function(){this.logger.log(Ut.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},d.ccEOC=function(){if(this.logger.log(Ut.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Ut.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},d.ccTO=function(e){this.logger.log(Ut.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},d.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(Ut.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},d.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},d.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},v}(),fe=function(){function v(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new h;this.channels=[null,new oe(e,t,n),new oe(e+1,i,n)],this.cmdHistory={a:null,b:null},this.logger=n}var d=v.prototype;return d.getHandler=function(e){return this.channels[e].getHandler()},d.setHandler=function(e,t){this.channels[e].setHandler(t)},d.addData=function(e,t){var i,n,a,r=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(n=127&t[s],a=127&t[s+1],n!==0||a!==0){if(this.logger.log(Ut.DATA,"["+y([t[s],t[s+1]])+"] -> ("+y([n,a])+")"),(i=this.parseCmd(n,a))||(i=this.parseMidrow(n,a)),i||(i=this.parsePAC(n,a)),i||(i=this.parseBackgroundAttributes(n,a)),!i&&(r=this.parseChars(n,a))){var u=this.currentChannel;u&&u>0?this.channels[u].insertChars(r):this.logger.log(Ut.WARNING,"No channel found yet. TEXT-MODE?")}i||r||this.logger.log(Ut.WARNING,"Couldn't parse cleaned data "+y([n,a])+" orig: "+y([t[s],t[s+1]]))}},d.parseCmd=function(e,t){var i=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Ce(e,t,i))return Se(null,null,i),this.logger.log(Ut.DEBUG,"Repeated command ("+y([e,t])+") is dropped"),!0;var n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),Se(e,t,i),this.currentChannel=n,!0},d.parseMidrow=function(e,t){var i=0;if((e===17||e===25)&&t>=32&&t<=47){if((i=e===17?1:2)!==this.currentChannel)return this.logger.log(Ut.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[i];return!!n&&(n.ccMIDROW(t),this.logger.log(Ut.DEBUG,"MIDROW ("+y([e,t])+")"),!0)}return!1},d.parsePAC=function(e,t){var i,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Ce(e,t,n))return Se(null,null,n),!0;var a=e<=23?1:2;i=t>=64&&t<=95?a===1?o[e]:g[e]:a===1?l[e]:m[e];var r=this.channels[a];return!!r&&(r.setPAC(this.interpretPAC(i,t)),Se(e,t,n),this.currentChannel=a,!0)},d.interpretPAC=function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=(1&i)==1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},d.parseChars=function(e,t){var i,n,a=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19?(n=r===17?t+80:r===18?t+112:t+144,this.logger.log(Ut.INFO,"Special char '"+Gi(n)+"' in channel "+i),a=[n]):e>=32&&e<=127&&(a=t===0?[e]:[e,t]),a){var s=y(a);this.logger.log(Ut.DEBUG,"Char codes =  "+s.join(",")),Se(e,t,this.cmdHistory)}return a},d.parseBackgroundAttributes=function(e,t){var i;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var n={};e===16||e===24?(i=Math.floor((t-32)/2),n.background=p[i],t%2==1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));var a=e<=23?1:2;return this.channels[a].setBkgData(n),Se(e,t,this.cmdHistory),!0},d.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},d.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t];i&&i.cueSplitAtTime(e)}},v}();function Se(v,d,e){e.a=v,e.b=d}function Ce(v,d,e){return e.a===v&&e.b===d}const Ie=fe;var ft=function(){function v(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var d=v.prototype;return d.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},d.newCue=function(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},d.reset=function(){this.cueRanges=[],this.startTime=null},v}();const nt=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var v=["","lr","rl"],d=["start","middle","end","left","right"];function e(a,r){if(typeof r!="string"||!Array.isArray(a))return!1;var s=r.toLowerCase();return!!~a.indexOf(s)&&s}function t(a){return e(d,a)}function i(a){for(var r=arguments.length,s=new Array(r>1?r-1:0),u=1;u<r;u++)s[u-1]=arguments[u];for(var f=1;f<arguments.length;f++){var E=arguments[f];for(var D in E)a[D]=E[D]}return a}function n(a,r,s){var u=this,f={enumerable:!0};u.hasBeenReset=!1;var E="",D=!1,N=a,V=r,q=s,ge=null,be="",Ve=!0,Ke="auto",Me="start",We=50,Xe="middle",Ue=50,ut="middle";Object.defineProperty(u,"id",i({},f,{get:function(){return E},set:function(tt){E=""+tt}})),Object.defineProperty(u,"pauseOnExit",i({},f,{get:function(){return D},set:function(tt){D=!!tt}})),Object.defineProperty(u,"startTime",i({},f,{get:function(){return N},set:function(tt){if(typeof tt!="number")throw new TypeError("Start time must be set to a number.");N=tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},f,{get:function(){return V},set:function(tt){if(typeof tt!="number")throw new TypeError("End time must be set to a number.");V=tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},f,{get:function(){return q},set:function(tt){q=""+tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},f,{get:function(){return ge},set:function(tt){ge=tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},f,{get:function(){return be},set:function(tt){var Dt=function(kt){return e(v,kt)}(tt);if(Dt===!1)throw new SyntaxError("An invalid or illegal string was specified.");be=Dt,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},f,{get:function(){return Ve},set:function(tt){Ve=!!tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},f,{get:function(){return Ke},set:function(tt){if(typeof tt!="number"&&tt!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Ke=tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},f,{get:function(){return Me},set:function(tt){var Dt=t(tt);if(!Dt)throw new SyntaxError("An invalid or illegal string was specified.");Me=Dt,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},f,{get:function(){return We},set:function(tt){if(tt<0||tt>100)throw new Error("Position must be between 0 and 100.");We=tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},f,{get:function(){return Xe},set:function(tt){var Dt=t(tt);if(!Dt)throw new SyntaxError("An invalid or illegal string was specified.");Xe=Dt,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},f,{get:function(){return Ue},set:function(tt){if(tt<0||tt>100)throw new Error("Size must be between 0 and 100.");Ue=tt,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},f,{get:function(){return ut},set:function(tt){var Dt=t(tt);if(!Dt)throw new SyntaxError("An invalid or illegal string was specified.");ut=Dt,this.hasBeenReset=!0}})),u.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();var Ye=function(){function v(){}return v.prototype.decode=function(d,e){if(!d)return"";if(typeof d!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(d))},v}();function Je(v){function d(t,i,n,a){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(a||0)}var e=v.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?d(e[2],e[3],0,e[4]):d(e[1],e[2],e[3],e[4]):null}var et=function(){function v(){this.values=Object.create(null)}var d=v.prototype;return d.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},d.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},d.has=function(e){return e in this.values},d.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},d.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},d.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},v}();function He(v,d,e,t){var i=t?v.split(t):[v];for(var n in i)if(typeof i[n]=="string"){var a=i[n].split(e);a.length===2&&d(a[0],a[1])}}var at=new nt(0,0,""),Rt=at.align==="middle"?"middle":"center";function $t(v,d,e){var t=v;function i(){var a=Je(v);if(a===null)throw new Error("Malformed timestamp: "+t);return v=v.replace(/^[^\sa-zA-Z-]+/,""),a}function n(){v=v.replace(/^\s+/,"")}if(n(),d.startTime=i(),n(),v.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);v=v.slice(3),n(),d.endTime=i(),n(),function(a,r){var s=new et;He(a,function(E,D){var N;switch(E){case"region":for(var V=e.length-1;V>=0;V--)if(e[V].id===D){s.set(E,e[V].region);break}break;case"vertical":s.alt(E,D,["rl","lr"]);break;case"line":N=D.split(","),s.integer(E,N[0]),s.percent(E,N[0])&&s.set("snapToLines",!1),s.alt(E,N[0],["auto"]),N.length===2&&s.alt("lineAlign",N[1],["start",Rt,"end"]);break;case"position":N=D.split(","),s.percent(E,N[0]),N.length===2&&s.alt("positionAlign",N[1],["start",Rt,"end","line-left","line-right","auto"]);break;case"size":s.percent(E,D);break;case"align":s.alt(E,D,["start",Rt,"end","left","right"])}},/:/,/\s/),r.region=s.get("region",null),r.vertical=s.get("vertical","");var u=s.get("line","auto");u==="auto"&&at.line===-1&&(u=-1),r.line=u,r.lineAlign=s.get("lineAlign","start"),r.snapToLines=s.get("snapToLines",!0),r.size=s.get("size",100),r.align=s.get("align",Rt);var f=s.get("position","auto");f==="auto"&&at.position===50&&(f=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=f}(v,d)}function Ct(v){return v.replace(/<br(?: \/)?>/gi,`
`)}var qt=function(){function v(){this.state="INITIAL",this.buffer="",this.decoder=new Ye,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var d=v.prototype;return d.parse=function(e){var t=this;function i(){var u=t.buffer,f=0;for(u=Ct(u);f<u.length&&u[f]!=="\r"&&u[f]!==`
`;)++f;var E=u.slice(0,f);return u[f]==="\r"&&++f,u[f]===`
`&&++f,t.buffer=u.slice(f),E}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var a=(n=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?He(n,function(u,f){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new nt(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{$t(n,t.cue,t.regionList)}catch(u){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=n.indexOf("-->")!==-1;if(!n||s&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(u){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},d.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},v}(),or=X(673),Bt=X(524),Mt=/\r\n|\n\r|\n|\r/g,nr=function(v,d,e){return e===void 0&&(e=0),v.slice(e,e+d.length)===d},pr=function(v){for(var d=5381,e=v.length;e;)d=33*d^v.charCodeAt(--e);return(d>>>0).toString()};function br(v,d,e){return pr(v.toString())+pr(d.toString())+pr(e)}function Lr(){return Lr=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},Lr.apply(this,arguments)}var _r="stpp.ttml.im1t",si=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ei=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,It={left:"start",center:"center",right:"end",start:"start",end:"end"};function Nt(v,d,e,t,i){var n=(0,se.findBox)(new Uint8Array(v),["mdat"]);if(n.length!==0){var a=n.map(function(s){return(0,Et.utf8ArrayToStr)(s)}),r=(0,or.toTimescaleFromScale)(d,1,e);try{a.forEach(function(s){return t(function(u,f){var E=new DOMParser().parseFromString(u,"text/xml").getElementsByTagName("tt")[0];if(!E)throw new Error("Invalid ttml");var D={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},N=Object.keys(D).reduce(function(Ve,Ke){return Ve[Ke]=E.getAttribute("ttp:"+Ke)||D[Ke],Ve},{}),V=E.getAttribute("xml:space")!=="preserve",q=Hr(oi(E,"styling","style")),ge=Hr(oi(E,"layout","region")),be=oi(E,"body","[begin]");return[].map.call(be,function(Ve){var Ke=Fr(Ve,V);if(!Ke||!Ve.hasAttribute("begin"))return null;var Me=Vr(Ve.getAttribute("begin"),N),We=Vr(Ve.getAttribute("dur"),N),Xe=Vr(Ve.getAttribute("end"),N);if(Me===null)throw Mr(Ve);if(Xe===null){if(We===null)throw Mr(Ve);Xe=Me+We}var Ue=new nt(Me-f,Xe-f,Ke);Ue.id=br(Ue.startTime,Ue.endTime,Ue.text);var ut=ge[Ve.getAttribute("region")],tt=q[Ve.getAttribute("style")];Ue.position=10,Ue.size=80;var Dt=function(er,Kt,Wt){var ar="http://www.w3.org/ns/ttml#styling",Tr=null,Ir=er!=null&&er.hasAttribute("style")?er.getAttribute("style"):null;return Ir&&Wt.hasOwnProperty(Ir)&&(Tr=Wt[Ir]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(fr,Sr){var Gr=li(Kt,ar,Sr)||li(er,ar,Sr)||li(Tr,ar,Sr);return Gr&&(fr[Sr]=Gr),fr},{})}(ut,tt,q),kt=Dt.textAlign;if(kt){var Yt=It[kt];Yt&&(Ue.lineAlign=Yt),Ue.align=kt}return Lr(Ue,Dt),Ue}).filter(function(Ve){return Ve!==null})}(s,r))})}catch(s){i(s)}}else i(new Error("Could not parse IMSC1 mdat"))}function oi(v,d,e){var t=v.getElementsByTagName(d)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Hr(v){return v.reduce(function(d,e){var t=e.getAttribute("xml:id");return t&&(d[t]=e),d},{})}function Fr(v,d){return[].slice.call(v.childNodes).reduce(function(e,t,i){var n;return t.nodeName==="br"&&i?e+`
`:(n=t.childNodes)!==null&&n!==void 0&&n.length?Fr(t,d):d?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function li(v,d,e){return v&&v.hasAttributeNS(d,e)?v.getAttributeNS(d,e):null}function Mr(v){return new Error("Could not parse ttml timestamp "+v)}function Vr(v,d){if(!v)return null;var e=Je(v);return e===null&&(si.test(v)?e=function(t,i){var n=si.exec(t),a=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+a/i.frameRate}(v,d):Ei.test(v)&&(e=function(t,i){var n=Ei.exec(t),a=Number(n[1]);switch(n[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/i.frameRate;case"t":return a/i.tickRate}return a}(v,d))),e}var ui=function(){function v(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new ft(this,"textTrack1"),i=new ft(this,"textTrack2"),n=new ft(this,"textTrack3"),a=new ft(this,"textTrack4");this.cea608Parser1=new Ie(1,t,i),this.cea608Parser2=new Ie(3,n,a)}e.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(c.Events.FRAG_LOADING,this.onFragLoading,this),e.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=v.prototype;return d.destroy=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(c.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(c.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(c.Events.FRAG_LOADING,this.onFragLoading,this),e.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(c.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(c.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(c.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(c.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(e,t,i,n,a){for(var r,s,u,f,E=!1,D=a.length;D--;){var N=a[D],V=(r=N[0],s=N[1],u=t,f=i,Math.min(s,f)-Math.max(r,u));if(V>=0&&(N[0]=Math.min(N[0],t),N[1]=Math.max(N[1],i),E=!0,V/(i-t)>.5))return}if(E||a.push([t,i]),this.config.renderTextTracksNatively){var q=this.captionsTracks[e];this.Cues.newCue(q,t,i,n)}else{var ge=this.Cues.newCue(null,t,i,n);this.hls.trigger(c.Events.CUES_PARSED,{type:"captions",cues:ge,track:e})}},d.onInitPtsFound=function(e,t){var i=this,n=t.frag,a=t.id,r=t.initPTS,s=t.timescale,u=this.unparsedVttFrags;a==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=s),u.length&&(this.unparsedVttFrags=[],u.forEach(function(f){i.onFragLoaded(c.Events.FRAG_LOADED,f)}))},d.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null},d.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},d.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,i=this.captionsTracks,n=this.media,a=t[e],r=a.label,s=a.languageCode,u=this.getExistingTrack(e);if(u)i[e]=u,Ze(i[e]),it(i[e],n);else{var f=this.createTextTrack("captions",r,s);f&&(f[e]=!0,i[e]=f)}}},d.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},d.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},d.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},d.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Ze(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)Ze(t[i])}},d.onSubtitleTracksUpdated=function(e,t){var i=this;this.textTracks=[];var n=t.subtitleTracks||[],a=n.some(function(f){return f.textCodec===_r});if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,E){var D;if(E<s.length){for(var N=null,V=0;V<s.length;V++)if(Ur(s[V],f)){N=s[V];break}N&&(D=N)}if(D)Ze(D);else{var q=i._captionsOrSubtitlesFromCharacteristics(f);(D=i.createTextTrack(q,f.name,f.lang))&&(D.mode="disabled")}D&&(D.groupId=f.groupId,i.textTracks.push(D))})}else if(!r&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(c.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},d._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!==null&&t!==void 0&&t.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"},d.onManifestLoaded=function(e,t){var i=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(n){var a=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(a){var r="textTrack"+a[1],s=i.captionsProperties[r];s&&(s.label=n.name,n.lang&&(s.languageCode=n.lang),s.media=n)}})},d.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},d.onFragLoading=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2,a=this.lastSn,r=this.lastPartIndex;if(this.enabled&&i&&n&&t.frag.type===G.PlaylistLevelType.MAIN){var s,u,f=t.frag.sn,E=(s=t==null||(u=t.part)===null||u===void 0?void 0:u.index)!=null?s:-1;f===a+1||f===a&&E===r+1||(i.reset(),n.reset()),this.lastSn=f,this.lastPartIndex=E}},d.onFragLoaded=function(e,t){var i=t.frag,n=t.payload,a=this.initPTS,r=this.unparsedVttFrags;if(i.type===G.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,B.isFiniteNumber)(a[i.cc]))return r.push(t),void(a.length&&this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var s=i.decryptdata,u="stats"in t;if(s==null||s.key==null||s.method!=="AES-128"||u){var f=this.tracks[i.level],E=this.vttCCs;E[i.cc]||(E[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),f&&f.textCodec===_r?this._parseIMSC1(i,n):this._parseVTTs(i,n,E)}}else this.hls.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(e,t){var i=this,n=this.hls;Nt(t,this.initPTS[e.cc],this.timescale[e.cc],function(a){i._appendCues(a,e.level),n.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){_.logger.log("Failed to parse IMSC1: "+a),n.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},d._parseVTTs=function(e,t,i){var n,a=this,r=this.hls;(function(s,u,f,E,D,N,V,q){var ge,be=new qt,Ve=(0,Et.utf8ArrayToStr)(new Uint8Array(s)).trim().replace(Mt,`
`).split(`
`),Ke=[],Me=(0,or.toMpegTsClockFromTimescale)(u,f),We="00:00.000",Xe=0,Ue=0,ut=!0;be.oncue=function(tt){var Dt=E[D],kt=E.ccOffset,Yt=(Xe-Me)/9e4;Dt!=null&&Dt.new&&(Ue!==void 0?kt=E.ccOffset=Dt.start:function(ar,Tr,Ir){var fr=ar[Tr],Sr=ar[fr.prevCC];if(!Sr||!Sr.new&&fr.new)return ar.ccOffset=ar.presentationOffset=fr.start,void(fr.new=!1);for(;(Gr=Sr)!==null&&Gr!==void 0&&Gr.new;){var Gr;ar.ccOffset+=fr.start-Sr.start,fr.new=!1,Sr=ar[(fr=Sr).prevCC]}ar.presentationOffset=Ir}(E,D,Yt)),Yt&&(kt=Yt-E.presentationOffset);var er=tt.endTime-tt.startTime,Kt=(0,Bt.normalizePts)(9e4*(tt.startTime+kt-Ue),9e4*N)/9e4;tt.startTime=Math.max(Kt,0),tt.endTime=Math.max(Kt+er,0);var Wt=tt.text.trim();tt.text=decodeURIComponent(encodeURIComponent(Wt)),tt.id||(tt.id=br(tt.startTime,tt.endTime,Wt)),tt.endTime>0&&Ke.push(tt)},be.onparsingerror=function(tt){ge=tt},be.onflush=function(){ge?q(ge):V(Ke)},Ve.forEach(function(tt){if(ut){if(nr(tt,"X-TIMESTAMP-MAP=")){ut=!1,tt.slice(16).split(",").forEach(function(Dt){nr(Dt,"LOCAL:")?We=Dt.slice(6):nr(Dt,"MPEGTS:")&&(Xe=parseInt(Dt.slice(7)))});try{Ue=function(Dt){var kt=parseInt(Dt.slice(-3)),Yt=parseInt(Dt.slice(-6,-4)),er=parseInt(Dt.slice(-9,-7)),Kt=Dt.length>9?parseInt(Dt.substring(0,Dt.indexOf(":"))):0;if(!((0,B.isFiniteNumber)(kt)&&(0,B.isFiniteNumber)(Yt)&&(0,B.isFiniteNumber)(er)&&(0,B.isFiniteNumber)(Kt)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+Dt);return kt+=1e3*Yt,(kt+=6e4*er)+36e5*Kt}(We)/1e3}catch(Dt){ge=Dt}return}tt===""&&(ut=!1)}be.parse(tt+`
`)}),be.flush()})((n=e.initSegment)!==null&&n!==void 0&&n.data?(0,se.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],this.timescale[e.cc],i,e.cc,e.start,function(s){a._appendCues(s,e.level),r.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){a._fallbackToIMSC1(e,t),_.logger.log("Failed to parse VTT cue: "+s),r.trigger(c.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},d._fallbackToIMSC1=function(e,t){var i=this,n=this.tracks[e.level];n.textCodec||Nt(t,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=_r,i._parseIMSC1(e,t)},function(){n.textCodec="wvtt"})},d._appendCues=function(e,t){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(function(s){return me(n,s)})}else{var a=this.tracks[t];if(!a)return;var r=a.default?"default":"subtitles"+t;i.trigger(c.Events.CUES_PARSED,{type:"subtitles",cues:e,track:r})}},d.onFragDecrypted=function(e,t){var i=t.frag;if(i.type===G.PlaylistLevelType.SUBTITLE){if(!(0,B.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(c.Events.FRAG_LOADED,t)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&i&&n){var a=t.frag,r=t.samples;if(a.type!==G.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(a)!=="NONE")for(var s=0;s<r.length;s++){var u=r[s].bytes;if(u){var f=this.extractCea608Data(u);i.addData(r[s].pts,f[0]),n.addData(r[s].pts,f[1])}}}},d.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,a=t.endOffsetSubtitles,r=t.type,s=this.media;if(s&&!(s.currentTime<n)){if(!r||r==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(E){return st(u[E],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&a!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(E){return st(f[E],i,a)})}}},d.extractCea608Data=function(e){for(var t=[[],[]],i=31&e[0],n=2,a=0;a<i;a++){var r=e[n++],s=127&e[n++],u=127&e[n++];if((s!==0||u!==0)&&(4&r)!=0){var f=3&r;f!==0&&f!==1||(t[f].push(s),t[f].push(u))}}return t},v}();function Ur(v,d){return v&&v.label===d.name&&!(v.textTrack1||v.textTrack2)}function Ai(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}const Ti=function(){function v(i){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var d,e,t=v.prototype;return t.setStreamController=function(i){this.streamController=i},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var i=this.hls;i.on(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var i=this.hls;i.off(c.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(c.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(i,n){v.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},t.onMediaAttaching=function(i,n){this.media=n.media instanceof HTMLVideoElement?n.media:null},t.onManifestParsed=function(i,n){var a=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,a.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onBufferCodecs=function(i,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(i.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},t.getMaxLevel=function(i){var n=this,a=this.hls.levels;if(!a.length)return-1;var r=a.filter(function(s,u){return v.isLevelAllowed(u,n.restrictedLevels)&&u<=i});return this.clientRect=null,v.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,n={width:0,height:0};if(i){var a=i.getBoundingClientRect();n.width=a.width,n.height=a.height,n.width||n.height||(n.width=a.right-a.left||i.width||0,n.height=a.bottom-a.top||i.height||0)}return this.clientRect=n,n},v.isLevelAllowed=function(i,n){return n===void 0&&(n=[]),n.indexOf(i)===-1},v.getMaxLevelByMediaSize=function(i,n,a){if(!i||!i.length)return-1;for(var r,s,u=i.length-1,f=0;f<i.length;f+=1){var E=i[f];if((E.width>=n||E.height>=a)&&(r=E,!(s=i[f+1])||r.width!==s.width||r.height!==s.height)){u=f;break}}return u},d=v,(e=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch(n){}return i}}])&&Ai(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}(),Ki=function(){function v(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var d=v.prototype;return d.setStreamController=function(e){this.streamController=e},d.registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},d.unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHING,this.onMediaAttaching)},d.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},d.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},d.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var a=n-this.lastTime,r=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,u=1e3*r/a,f=this.hls;if(f.trigger(c.Events.FPS_DROP,{currentDropped:r,currentDecoded:s,totalDroppedFrames:i}),u>0&&r>f.config.fpsDroppedMonitoringThreshold*s){var E=f.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+E),E>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=E)&&(E-=1,f.trigger(c.Events.FPS_DROP_LEVEL_CAPPING,{level:E,droppedLevel:f.currentLevel}),f.autoLevelCapping=E,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},d.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},v}();var Qr;(function(v){v.WIDEVINE="com.widevine.alpha",v.PLAYREADY="com.microsoft.playready"})(Qr||(Qr={}));var Hi=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function en(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}const Ri=function(){function v(i){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=i,this._config=i.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var d,e,t=v.prototype;return t.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},t._registerListeners=function(){this.hls.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t._unregisterListeners=function(){this.hls.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t.getLicenseServerUrl=function(i){switch(i){case Qr.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},t._attemptKeySystemAccess=function(i,n,a){var r=this,s=function(f,E,D,N){if(f===Qr.WIDEVINE)return function(V,q,ge){var be={audioCapabilities:[],videoCapabilities:[]};return V.forEach(function(Ve){be.audioCapabilities.push({contentType:'audio/mp4; codecs="'+Ve+'"',robustness:ge.audioRobustness||""})}),q.forEach(function(Ve){be.videoCapabilities.push({contentType:'video/mp4; codecs="'+Ve+'"',robustness:ge.videoRobustness||""})}),[be]}(E,D,N);throw new Error("Unknown key-system: "+f)}(i,n,a,this._drmSystemOptions);_.logger.log("Requesting encrypted media key-system access");var u=this.requestMediaKeySystemAccess(i,s);this.mediaKeysPromise=u.then(function(f){return r._onMediaKeySystemAccessObtained(i,f)}),u.catch(function(f){_.logger.error('Failed to obtain key-system "'+i+'" access:',f)})},t._onMediaKeySystemAccessObtained=function(i,n){var a=this;_.logger.log('Access for key-system "'+i+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:n,mediaKeySystemDomain:i};this._mediaKeysList.push(r);var s=Promise.resolve().then(function(){return n.createMediaKeys()}).then(function(u){return r.mediaKeys=u,_.logger.log('Media-keys created for key-system "'+i+'"'),a._onMediaKeysCreated(),u});return s.catch(function(u){_.logger.error("Failed to create media-keys:",u)}),s},t._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(n){n.mediaKeysSession||(n.mediaKeysSession=n.mediaKeys.createSession(),i._onNewMediaKeySession(n.mediaKeysSession))})},t._onNewMediaKeySession=function(i){var n=this;_.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(a){n._onKeySessionMessage(i,a.message)},!1)},t._onKeySessionMessage=function(i,n){_.logger.log("Got EME message event, creating license request"),this._requestLicense(n,function(a){_.logger.log("Received license data (length: "+(a&&a.byteLength)+"), updating key-session"),i.update(a).catch(function(r){_.logger.warn("Updating key-session failed: "+r)})})},t.onMediaEncrypted=function(i){var n=this;if(_.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise)return _.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var a=function(r){n._media&&(n._attemptSetMediaKeys(r),n._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(a).catch(a)},t._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var n=this._mediaKeysList[0];if(!n||!n.mediaKeys)return _.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});_.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(n.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(i,n){var a=this,r=this._mediaKeysList[0];if(!r)return _.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)_.logger.warn("Key-Session already initialized but requested again");else{var s=r.mediaKeysSession;if(!s)return _.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!n)return _.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});_.logger.log('Generating key-session request for "'+i+'" init data type'),r.mediaKeysSessionInitialized=!0,s.generateRequest(i,n).then(function(){_.logger.debug("Key-session generation succeeded")}).catch(function(u){_.logger.error("Error generating key-session request:",u),a.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t._createLicenseXhr=function(i,n,a){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,i,n,a);var s=this._licenseXhrSetup;if(s)try{s.call(this.hls,r,i),s=void 0}catch(u){_.logger.error(u)}try{r.readyState||r.open("POST",i,!0),s&&s.call(this.hls,r,i)}catch(u){throw new Error("issue setting up KeySystem license XHR "+u)}return r},t._onLicenseRequestReadyStageChange=function(i,n,a,r){if(i.readyState===4)if(i.status===200){this._requestLicenseFailureCount=0,_.logger.log("License request succeeded");var s=i.response,u=this._licenseResponseCallback;if(u)try{s=u.call(this.hls,i,n)}catch(E){_.logger.error(E)}r(s)}else{if(_.logger.error("License Request XHR failed ("+n+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var f=3-this._requestLicenseFailureCount+1;_.logger.warn("Retrying license request, "+f+" attempts left"),this._requestLicense(a,r)}},t._generateLicenseRequestChallenge=function(i,n){if(i.mediaKeySystemDomain===Qr.WIDEVINE)return n;throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},t._requestLicense=function(i,n){_.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a)return _.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(a.mediaKeySystemDomain),s=this._createLicenseXhr(r,i,n);_.logger.log("Sending license request to URL: "+r);var u=this._generateLicenseRequestChallenge(a,i);s.send(u)}catch(f){_.logger.error("Failure requesting DRM license: "+f),this.hls.trigger(c.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(i,n){if(this._emeEnabled){var a=n.media;this._media=a,a.addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){var i=this._media,n=this._mediaKeysList;i&&(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(n.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},t.onManifestParsed=function(i,n){if(this._emeEnabled){var a=n.levels.map(function(s){return s.audioCodec}).filter(function(s){return!!s}),r=n.levels.map(function(s){return s.videoCodec}).filter(function(s){return!!s});this._attemptKeySystemAccess(Qr.WIDEVINE,a,r)}},d=v,(e=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&en(d.prototype,e),Object.defineProperty(d,"prototype",{writable:!1}),v}();var Er,di,hi;function ki(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function cn(v,d,e){return d&&ki(v.prototype,d),e&&ki(v,e),Object.defineProperty(v,"prototype",{writable:!1}),v}function gn(v,d){var e=typeof Symbol!="undefined"&&v[Symbol.iterator]||v["@@iterator"];if(e)return(e=e.call(v)).next.bind(e);if(Array.isArray(v)||(e=function(i,n){if(i){if(typeof i=="string")return vn(i,n);var a=Object.prototype.toString.call(i).slice(8,-1);return a==="Object"&&i.constructor&&(a=i.constructor.name),a==="Map"||a==="Set"?Array.from(i):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?vn(i,n):void 0}}(v))||d&&v&&typeof v.length=="number"){e&&(v=e);var t=0;return function(){return t>=v.length?{done:!0}:{done:!1,value:v[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vn(v,d){(d==null||d>v.length)&&(d=v.length);for(var e=0,t=new Array(d);e<d;e++)t[e]=v[e];return t}function tn(){return tn=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},tn.apply(this,arguments)}(function(v){v.MANIFEST="m",v.AUDIO="a",v.VIDEO="v",v.MUXED="av",v.INIT="i",v.CAPTION="c",v.TIMED_TEXT="tt",v.KEY="k",v.OTHER="o"})(Er||(Er={})),function(v){v.DASH="d",v.HLS="h",v.SMOOTH="s",v.OTHER="o"}(di||(di={})),function(v){v.VOD="v",v.LIVE="l"}(hi||(hi={}));var Dn=function(){function v(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(a){try{t.apply(a,{ot:Er.MANIFEST,su:!t.initialized})}catch(r){_.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=function(a){try{var r=a.frag,s=t.hls.levels[r.level],u=t.getObjectType(r),f={d:1e3*r.duration,ot:u};u!==Er.VIDEO&&u!==Er.AUDIO&&u!=Er.MUXED||(f.br=s.bitrate/1e3,f.tb=t.getTopBandwidth(u)/1e3,f.bl=t.getBufferLength(u)),t.apply(a,f)}catch(E){_.logger.warn("Could not generate segment CMCD data.",E)}},this.hls=e;var i=this.config=e.config,n=i.cmcd;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||v.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var d=v.prototype;return d.registerListeners=function(){var e=this.hls;e.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this)},d.unregisterListeners=function(){var e=this.hls;e.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(c.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},d.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},d.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},d.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},d.onBufferCreated=function(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)===null||n===void 0?void 0:n.buffer},d.createData=function(){var e;return{v:1,sf:di.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},d.apply=function(e,t){t===void 0&&(t={}),tn(t,this.createData());var i=t.ot===Er.INIT||t.ot===Er.VIDEO||t.ot===Er.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var n=v.toHeaders(t);if(!Object.keys(n).length)return;e.headers||(e.headers={}),tn(e.headers,n)}else{var a=v.toQuery(t);if(!a)return;e.url=v.appendQueryToUri(e.url,a)}},d.getObjectType=function(e){var t=e.type;return t==="subtitle"?Er.TIMED_TEXT:e.sn==="initSegment"?Er.INIT:t==="audio"?Er.AUDIO:t==="main"?this.hls.audioTracks.length?Er.VIDEO:Er.MUXED:void 0},d.getTopBandwidth=function(e){var t,i=0,n=this.hls;if(e===Er.AUDIO)t=n.audioTracks;else{var a=n.maxAutoLevel,r=a>-1?a+1:n.levels.length;t=n.levels.slice(0,r)}for(var s,u=gn(t);!(s=u()).done;){var f=s.value;f.bitrate>i&&(i=f.bitrate)}return i>0?i:NaN},d.getBufferLength=function(e){var t=this.hls.media,i=e===Er.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*Be.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN},d.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var a=n.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(r,s,u){t(r),this.loader.load(r,s,u)},cn(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},d.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var a=n.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(r,s,u){t(r),this.loader.load(r,s,u)},cn(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},v.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},v.serialize=function(e){for(var t,i=[],n=function(q){return!Number.isNaN(q)&&q!=null&&q!==""&&q!==!1},a=function(q){return Math.round(q)},r=function(q){return 100*a(q/100)},s={br:a,d:a,bl:r,dl:r,mtp:r,nor:function(q){return encodeURIComponent(q)},rtp:r,tb:a},u=gn(Object.keys(e||{}).sort());!(t=u()).done;){var f=t.value,E=e[f];if(n(E)&&!(f==="v"&&E===1||f=="pr"&&E===1)){var D=s[f];D&&(E=D(E));var N,V=typeof E;N=f==="ot"||f==="sf"||f==="st"?f+"="+E:V==="boolean"?f:V==="number"?f+"="+E:f+"="+JSON.stringify(E),i.push(N)}}return i.join(",")},v.toHeaders=function(e){for(var t={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,s=Object.keys(e);r<s.length;r++){var u=s[r];n[a[u]!=null?a[u]:1][u]=e[u]}for(var f=0;f<n.length;f++){var E=v.serialize(n[f]);E&&(t["CMCD-"+i[f]]=E)}return t},v.toQuery=function(e){return"CMCD="+encodeURIComponent(v.serialize(e))},v.appendQueryToUri=function(e,t){if(!t)return e;var i=e.includes("?")?"&":"?";return""+e+i+t},v}(),pn=X(408),An=/^age:\s*[\d.]+\s*$/m;const mn=function(){function v(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new pn.LoadStats,this.retryDelay=0}var d=v.prototype;return d.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},d.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},d.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},d.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.retryDelay=t.retryDelay,this.loadInternal()},d.loadInternal=function(){var e=this.config,t=this.context;if(e){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var a=this.xhrSetup;try{if(a)try{a(i,t.url)}catch(u){i.open("GET",t.url,!0),a(i,t.url)}i.readyState||i.open("GET",t.url,!0);var r=this.context.headers;if(r)for(var s in r)i.setRequestHeader(s,r[s])}catch(u){return void this.callbacks.onError({code:i.status,text:u.message},t,i)}t.rangeEnd&&i.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),i.send()}},d.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,a=this.config;if(!i.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),n===4){t.onreadystatechange=null,t.onprogress=null;var r=t.status,s=t.responseType==="arraybuffer";if(r>=200&&r<300&&(s&&t.response||t.responseText!==null)){var u,f;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),f=s?(u=t.response).byteLength:(u=t.responseText).length,i.loaded=i.total=f,!this.callbacks)return;var E=this.callbacks.onProgress;if(E&&E(i,e,u,t),!this.callbacks)return;var D={url:t.responseURL,data:u};this.callbacks.onSuccess(D,i,e,t)}else i.retry>=a.maxRetry||r>=400&&r<499?(_.logger.error(r+" while loading "+e.url),this.callbacks.onError({code:r,text:t.statusText},e,t)):(_.logger.warn(r+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},d.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},d.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},d.getCacheAge=function(){var e=null;if(this.loader&&An.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},v}();function sn(v){var d=typeof Map=="function"?new Map:void 0;return sn=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(d!==void 0){if(d.has(e))return d.get(e);d.set(e,i)}function i(){return on(e,arguments,ln(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Vi(i,e)},sn(v)}function on(v,d,e){return on=Rn()?Reflect.construct.bind():function(t,i,n){var a=[null];a.push.apply(a,i);var r=new(Function.bind.apply(t,a));return n&&Vi(r,n.prototype),r},on.apply(null,arguments)}function Rn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}function Vi(v,d){return Vi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vi(v,d)}function ln(v){return ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},ln(v)}function un(){return un=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},un.apply(this,arguments)}var kn=function(){function v(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||_n,this.controller=new self.AbortController,this.stats=new pn.LoadStats}var d=v.prototype;return d.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},d.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},d.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},d.load=function(e,t,i){var n=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var r=function(E,D){var N={method:"GET",mode:"cors",credentials:"same-origin",signal:D,headers:new self.Headers(un({},E.headers))};return E.rangeEnd&&N.headers.set("Range","bytes="+E.rangeStart+"-"+String(E.rangeEnd-1)),N}(e,this.controller.signal),s=i.onProgress,u=e.responseType==="arraybuffer",f=u?"byteLength":"length";this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),i.onTimeout(a,e,n.response)},t.timeout),self.fetch(this.request).then(function(E){if(n.response=n.loader=E,!E.ok){var D=E.status,N=E.statusText;throw new In(N||"fetch, bad network response",D,E)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(E.headers.get("Content-Length")||"0"),s&&(0,B.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(E,a,e,t.highWaterMark,s):u?E.arrayBuffer():E.text()}).then(function(E){var D=n.response;self.clearTimeout(n.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=E[f];var N={url:D.url,data:E};s&&!(0,B.isFiniteNumber)(t.highWaterMark)&&s(a,e,E,D),i.onSuccess(N,a,e,D)}).catch(function(E){if(self.clearTimeout(n.requestTimeout),!a.aborted){var D=E&&E.code||0,N=E?E.message:null;i.onError({code:D,text:N},e,E?E.details:null)}})},d.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},d.loadProgressively=function(e,t,i,n,a){n===void 0&&(n=0);var r=new vi,s=e.body.getReader();return function u(){return s.read().then(function(f){if(f.done)return r.dataLength&&a(t,i,r.flush(),e),Promise.resolve(new ArrayBuffer(0));var E=f.value,D=E.length;return t.loaded+=D,D<n||r.dataLength?(r.push(E),r.dataLength>=n&&a(t,i,r.flush(),e)):a(t,i,E,e),u()}).catch(function(){return Promise.reject()})}()},v}();function _n(v,d){return new self.Request(v.url,d)}var In=function(v){var d,e;function t(i,n,a){var r;return(r=v.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=a,r}return e=v,(d=t).prototype=Object.create(e.prototype),d.prototype.constructor=d,Vi(d,e),t}(sn(Error));const yn=kn;var Cn=/\s/;function dn(){return dn=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var e=arguments[d];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(v[t]=e[t])}return v},dn.apply(this,arguments)}function En(v,d){var e=Object.keys(v);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(v);d&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(v,i).enumerable})),e.push.apply(e,t)}return e}function Tn(v){for(var d=1;d<arguments.length;d++){var e=arguments[d]!=null?arguments[d]:{};d%2?En(Object(e),!0).forEach(function(t){wn(v,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(e)):En(Object(e)).forEach(function(t){Object.defineProperty(v,t,Object.getOwnPropertyDescriptor(e,t))})}return v}function wn(v,d,e){return d in v?Object.defineProperty(v,d,{value:e,enumerable:!0,configurable:!0,writable:!0}):v[d]=e,v}var xn=Tn(Tn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:mn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:gi,bufferController:an,capLevelController:Ti,fpsController:Ki,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Hi,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(v,d,e,t){for(var i,n,a,r,s,u=[],f=self.VTTCue||self.TextTrackCue,E=0;E<t.rows.length;E++)if(a=!0,r=0,s="",!(i=t.rows[E]).isEmpty()){for(var D=0;D<i.chars.length;D++)Cn.test(i.chars[D].uchar)&&a?r++:(s+=i.chars[D].uchar,a=!1);i.cueStartTime=d,d===e&&(e+=1e-4),r>=16?r--:r++;var N=Ct(s.trim()),V=br(d,e,N);v&&v.cues&&v.cues.getCueById(V)||((n=new f(d,e,N)).id=V,n.line=E+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*r/32)),u.push(n))}return v&&u.length&&(u.sort(function(q,ge){return q.line==="auto"||ge.line==="auto"?0:q.line>8&&ge.line>8?ge.line-q.line:q.line-ge.line}),u.forEach(function(q){return me(v,q)})),u}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Pi,subtitleTrackController:Ni,timelineController:ui,audioStreamController:Di,audioTrackController:Dr,emeController:Ri,cmcdController:Dn});function Sn(v,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}var bn=function(){function v(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Jr.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var a=this.config=function(Ue,ut){if((ut.liveSyncDurationCount||ut.liveMaxLatencyDurationCount)&&(ut.liveSyncDuration||ut.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(ut.liveMaxLatencyDurationCount!==void 0&&(ut.liveSyncDurationCount===void 0||ut.liveMaxLatencyDurationCount<=ut.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(ut.liveMaxLatencyDuration!==void 0&&(ut.liveSyncDuration===void 0||ut.liveMaxLatencyDuration<=ut.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return dn({},Ue,ut)}(v.DefaultConfig,n);this.userConfig=n,(0,_.enableLogs)(a.debug,"Hls instance"),this._autoLevelCapping=-1,a.progressive&&function(Ue){var ut=Ue.loader;ut!==yn&&ut!==mn?(_.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),Ue.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(tt){}return!1}()&&(Ue.loader=yn,Ue.progressive=!0,Ue.enableSoftwareAES=!0,_.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(a);var r=a.abrController,s=a.bufferController,u=a.capLevelController,f=a.fpsController,E=this.abrController=new r(this),D=this.bufferController=new s(this),N=this.capLevelController=new u(this),V=new f(this),q=new Ge(this),ge=new qe(this),be=new At(this),Ve=this.levelController=new $(this),Ke=new ce(this),Me=this.streamController=new Ii(this,Ke);N.setStreamController(Me),V.setStreamController(Me);var We=[q,ge,Ve,Me];this.networkControllers=We;var Xe=[E,D,N,V,be,Ke];this.audioTrackController=this.createController(a.audioTrackController,null,We),this.createController(a.audioStreamController,Ke,We),this.subtitleTrackController=this.createController(a.subtitleTrackController,null,We),this.createController(a.subtitleStreamController,Ke,We),this.createController(a.timelineController,null,Xe),this.emeController=this.createController(a.emeController,null,Xe),this.cmcdController=this.createController(a.cmcdController,null,Xe),this.latencyController=this.createController(Ot,null,Xe),this.coreComponents=Xe}v.isSupported=function(){return function(){var n=Rr();if(!n)return!1;var a=Br(),r=n&&typeof n.isTypeSupported=="function"&&n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!a||a.prototype&&typeof a.prototype.appendBuffer=="function"&&typeof a.prototype.remove=="function";return!!r&&!!s}()};var d,e,t,i=v.prototype;return i.createController=function(n,a,r){if(n){var s=a?new n(this,a):new n(this);return r&&r.push(s),s}return null},i.on=function(n,a,r){r===void 0&&(r=this),this._emitter.on(n,a,r)},i.once=function(n,a,r){r===void 0&&(r=this),this._emitter.once(n,a,r)},i.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},i.off=function(n,a,r,s){r===void 0&&(r=this),this._emitter.off(n,a,r,s)},i.listeners=function(n){return this._emitter.listeners(n)},i.emit=function(n,a,r){return this._emitter.emit(n,a,r)},i.trigger=function(n,a){if(this.config.debug)return this.emit(n,n,a);try{return this.emit(n,n,a)}catch(r){_.logger.error("An internal error happened while handling event "+n+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(c.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:r})}return!1},i.listenerCount=function(n){return this._emitter.listenerCount(n)},i.destroy=function(){_.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},i.attachMedia=function(n){_.logger.log("attachMedia"),this._media=n,this.trigger(c.Events.MEDIA_ATTACHING,{media:n})},i.detachMedia=function(){_.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(n){this.stopLoad();var a=this.media,r=this.url,s=this.url=ie.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});_.logger.log("loadSource:"+s),a&&r&&r!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(a)),this.trigger(c.Events.MANIFEST_LOADING,{url:n})},i.startLoad=function(n){n===void 0&&(n=-1),_.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(a){a.startLoad(n)})},i.stopLoad=function(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},i.swapAudioCodec=function(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){_.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},i.removeLevel=function(n,a){a===void 0&&(a=0),this.levelController.removeLevel(n,a)},d=v,t=[{key:"version",get:function(){return"1.2.7"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return P.ErrorTypes}},{key:"ErrorDetails",get:function(){return P.ErrorDetails}},{key:"DefaultConfig",get:function(){return v.defaultConfig?v.defaultConfig:xn},set:function(n){v.defaultConfig=n}}],(e=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){_.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){_.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){_.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){_.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){_.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var a=!!n;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(_.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,a=this.config.minAutoBitrate;if(!n)return 0;for(var r=n.length,s=0;s<r;s++)if(n[s].maxBitrate>=a)return s;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,a=this.autoLevelCapping;return a===-1&&n&&n.length?n.length-1:a}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var a=this.audioTrackController;a&&(a.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var a=this.subtitleTrackController;a&&(a.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Sn(d.prototype,e),t&&Sn(d,t),Object.defineProperty(d,"prototype",{writable:!1}),v}();bn.defaultConfig=void 0},923:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{BaseSegment:()=>re,ElementaryStreamTypes:()=>Ee,Fragment:()=>de,Part:()=>Q});var Ee,ie=X(965),B=X(945),c=X(93),P=X(960),_=X(408);function se(ne,le){ne.prototype=Object.create(le.prototype),ne.prototype.constructor=ne,z(ne,le)}function z(ne,le){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Re,Te){return Re.__proto__=Te,Re},z(ne,le)}function K(ne,le){for(var Re=0;Re<le.length;Re++){var Te=le[Re];Te.enumerable=Te.enumerable||!1,Te.configurable=!0,"value"in Te&&(Te.writable=!0),Object.defineProperty(ne,Te.key,Te)}}function te(ne,le,Re){return le&&K(ne.prototype,le),Re&&K(ne,Re),Object.defineProperty(ne,"prototype",{writable:!1}),ne}(function(ne){ne.AUDIO="audio",ne.VIDEO="video",ne.AUDIOVIDEO="audiovideo"})(Ee||(Ee={}));var re=function(){function ne(le){var Re;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((Re={})[Ee.AUDIO]=null,Re[Ee.VIDEO]=null,Re[Ee.AUDIOVIDEO]=null,Re),this.baseurl=le}return ne.prototype.setByteRange=function(le,Re){var Te=le.split("@",2),Pe=[];Te.length===1?Pe[0]=Re?Re.byteRangeEndOffset:0:Pe[0]=parseInt(Te[1]),Pe[1]=parseInt(Te[0])+Pe[0],this._byteRange=Pe},te(ne,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,B.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(le){this._url=le}}]),ne}(),de=function(ne){function le(Te,Pe){var F;return(F=ne.call(this,Pe)||this)._decryptdata=null,F.rawProgramDateTime=null,F.programDateTime=null,F.tagList=[],F.duration=0,F.sn=0,F.levelkey=void 0,F.type=void 0,F.loader=null,F.level=-1,F.cc=0,F.startPTS=void 0,F.endPTS=void 0,F.appendedPTS=void 0,F.startDTS=void 0,F.endDTS=void 0,F.start=0,F.deltaPTS=void 0,F.maxStartPTS=void 0,F.minEndPTS=void 0,F.stats=new _.LoadStats,F.urlId=0,F.data=void 0,F.bitrateTest=!1,F.title=null,F.initSegment=null,F.type=Te,F}se(le,ne);var Re=le.prototype;return Re.createInitializationVector=function(Te){for(var Pe=new Uint8Array(16),F=12;F<16;F++)Pe[F]=Te>>8*(15-F)&255;return Pe},Re.setDecryptDataFromLevelKey=function(Te,Pe){var F=Te;return(Te==null?void 0:Te.method)==="AES-128"&&Te.uri&&!Te.iv&&((F=P.LevelKey.fromURI(Te.uri)).method=Te.method,F.iv=this.createInitializationVector(Pe),F.keyFormat="identity"),F},Re.setElementaryStreamInfo=function(Te,Pe,F,k,W,H){H===void 0&&(H=!1);var Ae=this.elementaryStreams,_e=Ae[Te];_e?(_e.startPTS=Math.min(_e.startPTS,Pe),_e.endPTS=Math.max(_e.endPTS,F),_e.startDTS=Math.min(_e.startDTS,k),_e.endDTS=Math.max(_e.endDTS,W)):Ae[Te]={startPTS:Pe,endPTS:F,startDTS:k,endDTS:W,partial:H}},Re.clearElementaryStreamInfo=function(){var Te=this.elementaryStreams;Te[Ee.AUDIO]=null,Te[Ee.VIDEO]=null,Te[Ee.AUDIOVIDEO]=null},te(le,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var Te=this.sn;typeof Te!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),Te=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,Te)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,ie.isFiniteNumber)(this.programDateTime))return null;var Te=(0,ie.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*Te}},{key:"encrypted",get:function(){var Te;return!((Te=this.decryptdata)===null||Te===void 0||!Te.keyFormat||!this.decryptdata.uri)}}]),le}(re),Q=function(ne){function le(Re,Te,Pe,F,k){var W;(W=ne.call(this,Pe)||this).fragOffset=0,W.duration=0,W.gap=!1,W.independent=!1,W.relurl=void 0,W.fragment=void 0,W.index=void 0,W.stats=new _.LoadStats,W.duration=Re.decimalFloatingPoint("DURATION"),W.gap=Re.bool("GAP"),W.independent=Re.bool("INDEPENDENT"),W.relurl=Re.enumeratedString("URI"),W.fragment=Te,W.index=F;var H=Re.enumeratedString("BYTERANGE");return H&&W.setByteRange(H,k),k&&(W.fragOffset=k.fragOffset+k.duration),W}return se(le,ne),te(le,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var Re=this.elementaryStreams;return!!(Re.audio||Re.video||Re.audiovideo)}}]),le}(re)},960:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{LevelKey:()=>B});var Ee=X(945);function ie(c,P){for(var _=0;_<P.length;_++){var se=P[_];se.enumerable=se.enumerable||!1,se.configurable=!0,"value"in se&&(se.writable=!0),Object.defineProperty(c,se.key,se)}}var B=function(){function c(se,z){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=z?(0,Ee.buildAbsoluteURL)(se,z,{alwaysNormalize:!0}):se}var P,_;return c.fromURL=function(se,z){return new c(se,z)},c.fromURI=function(se){return new c(se)},P=c,(_=[{key:"uri",get:function(){return this._uri}}])&&ie(P.prototype,_),Object.defineProperty(P,"prototype",{writable:!1}),c}()},408:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{LoadStats:()=>Ee});var Ee=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{MAX_SAFE_INTEGER:()=>ie,isFiniteNumber:()=>Ee});var Ee=Number.isFinite||function(B){return typeof B=="number"&&isFinite(B)},ie=Number.MAX_SAFE_INTEGER||9007199254740991},524:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{default:()=>ne,flushTextTrackMetadataCueSamples:()=>Re,flushTextTrackUserdataCueSamples:()=>Te,normalizePts:()=>le});var Ee=X(965);const ie=function(){function k(){}return k.getSilentFrame=function(W,H){if(W==="mp4a.40.2"){if(H===1)return new Uint8Array([0,200,0,128,35,128]);if(H===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(H===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(H===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(H===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(H===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(H===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(H===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(H===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},k}();var B=Math.pow(2,32)-1,c=function(){function k(){}return k.init=function(){var W;for(W in k.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},k.types)k.types.hasOwnProperty(W)&&(k.types[W]=[W.charCodeAt(0),W.charCodeAt(1),W.charCodeAt(2),W.charCodeAt(3)]);var H=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Ae=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:H,audio:Ae};var _e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),we=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=we,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var U=new Uint8Array([105,115,111,109]),ue=new Uint8Array([97,118,99,49]),Z=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,U,Z,U,ue),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,_e))},k.box=function(W){for(var H=8,Ae=arguments.length,_e=new Array(Ae>1?Ae-1:0),we=1;we<Ae;we++)_e[we-1]=arguments[we];for(var U=_e.length,ue=U;U--;)H+=_e[U].byteLength;var Z=new Uint8Array(H);for(Z[0]=H>>24&255,Z[1]=H>>16&255,Z[2]=H>>8&255,Z[3]=255&H,Z.set(W,4),U=0,H=8;U<ue;U++)Z.set(_e[U],H),H+=_e[U].byteLength;return Z},k.hdlr=function(W){return k.box(k.types.hdlr,k.HDLR_TYPES[W])},k.mdat=function(W){return k.box(k.types.mdat,W)},k.mdhd=function(W,H){H*=W;var Ae=Math.floor(H/(B+1)),_e=Math.floor(H%(B+1));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,W>>24&255,W>>16&255,W>>8&255,255&W,Ae>>24,Ae>>16&255,Ae>>8&255,255&Ae,_e>>24,_e>>16&255,_e>>8&255,255&_e,85,196,0,0]))},k.mdia=function(W){return k.box(k.types.mdia,k.mdhd(W.timescale,W.duration),k.hdlr(W.type),k.minf(W))},k.mfhd=function(W){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,W>>24,W>>16&255,W>>8&255,255&W]))},k.minf=function(W){return W.type==="audio"?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(W)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(W))},k.moof=function(W,H,Ae){return k.box(k.types.moof,k.mfhd(W),k.traf(Ae,H))},k.moov=function(W){for(var H=W.length,Ae=[];H--;)Ae[H]=k.trak(W[H]);return k.box.apply(null,[k.types.moov,k.mvhd(W[0].timescale,W[0].duration)].concat(Ae).concat(k.mvex(W)))},k.mvex=function(W){for(var H=W.length,Ae=[];H--;)Ae[H]=k.trex(W[H]);return k.box.apply(null,[k.types.mvex].concat(Ae))},k.mvhd=function(W,H){H*=W;var Ae=Math.floor(H/(B+1)),_e=Math.floor(H%(B+1)),we=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,W>>24&255,W>>16&255,W>>8&255,255&W,Ae>>24,Ae>>16&255,Ae>>8&255,255&Ae,_e>>24,_e>>16&255,_e>>8&255,255&_e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,we)},k.sdtp=function(W){var H,Ae,_e=W.samples||[],we=new Uint8Array(4+_e.length);for(H=0;H<_e.length;H++)Ae=_e[H].flags,we[H+4]=Ae.dependsOn<<4|Ae.isDependedOn<<2|Ae.hasRedundancy;return k.box(k.types.sdtp,we)},k.stbl=function(W){return k.box(k.types.stbl,k.stsd(W),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))},k.avc1=function(W){var H,Ae,_e,we=[],U=[];for(H=0;H<W.sps.length;H++)_e=(Ae=W.sps[H]).byteLength,we.push(_e>>>8&255),we.push(255&_e),we=we.concat(Array.prototype.slice.call(Ae));for(H=0;H<W.pps.length;H++)_e=(Ae=W.pps[H]).byteLength,U.push(_e>>>8&255),U.push(255&_e),U=U.concat(Array.prototype.slice.call(Ae));var ue=k.box(k.types.avcC,new Uint8Array([1,we[3],we[4],we[5],255,224|W.sps.length].concat(we).concat([W.pps.length]).concat(U))),Z=W.width,he=W.height,G=W.pixelRatio[0],xe=W.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Z>>8&255,255&Z,he>>8&255,255&he,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),ue,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([G>>24,G>>16&255,G>>8&255,255&G,xe>>24,xe>>16&255,xe>>8&255,255&xe])))},k.esds=function(W){var H=W.config.length;return new Uint8Array([0,0,0,0,3,23+H,0,1,0,4,15+H,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([H]).concat(W.config).concat([6,1,2]))},k.mp4a=function(W){var H=W.samplerate;return k.box(k.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,W.channelCount,0,16,0,0,0,0,H>>8&255,255&H,0,0]),k.box(k.types.esds,k.esds(W)))},k.mp3=function(W){var H=W.samplerate;return k.box(k.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,W.channelCount,0,16,0,0,0,0,H>>8&255,255&H,0,0]))},k.stsd=function(W){return W.type==="audio"?W.segmentCodec==="mp3"&&W.codec==="mp3"?k.box(k.types.stsd,k.STSD,k.mp3(W)):k.box(k.types.stsd,k.STSD,k.mp4a(W)):k.box(k.types.stsd,k.STSD,k.avc1(W))},k.tkhd=function(W){var H=W.id,Ae=W.duration*W.timescale,_e=W.width,we=W.height,U=Math.floor(Ae/(B+1)),ue=Math.floor(Ae%(B+1));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,H>>24&255,H>>16&255,H>>8&255,255&H,0,0,0,0,U>>24,U>>16&255,U>>8&255,255&U,ue>>24,ue>>16&255,ue>>8&255,255&ue,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_e>>8&255,255&_e,0,0,we>>8&255,255&we,0,0]))},k.traf=function(W,H){var Ae=k.sdtp(W),_e=W.id,we=Math.floor(H/(B+1)),U=Math.floor(H%(B+1));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,_e>>24,_e>>16&255,_e>>8&255,255&_e])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,we>>24,we>>16&255,we>>8&255,255&we,U>>24,U>>16&255,U>>8&255,255&U])),k.trun(W,Ae.length+16+20+8+16+8+8),Ae)},k.trak=function(W){return W.duration=W.duration||4294967295,k.box(k.types.trak,k.tkhd(W),k.mdia(W))},k.trex=function(W){var H=W.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,H>>24,H>>16&255,H>>8&255,255&H,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},k.trun=function(W,H){var Ae,_e,we,U,ue,Z,he=W.samples||[],G=he.length,xe=12+16*G,Ge=new Uint8Array(xe);for(H+=8+xe,Ge.set([W.type==="video"?1:0,0,15,1,G>>>24&255,G>>>16&255,G>>>8&255,255&G,H>>>24&255,H>>>16&255,H>>>8&255,255&H],0),Ae=0;Ae<G;Ae++)we=(_e=he[Ae]).duration,U=_e.size,ue=_e.flags,Z=_e.cts,Ge.set([we>>>24&255,we>>>16&255,we>>>8&255,255&we,U>>>24&255,U>>>16&255,U>>>8&255,255&U,ue.isLeading<<2|ue.dependsOn,ue.isDependedOn<<6|ue.hasRedundancy<<4|ue.paddingValue<<1|ue.isNonSync,61440&ue.degradPrio,15&ue.degradPrio,Z>>>24&255,Z>>>16&255,Z>>>8&255,255&Z],12+16*Ae);return k.box(k.types.trun,Ge)},k.initSegment=function(W){k.types||k.init();var H=k.moov(W),Ae=new Uint8Array(k.FTYP.byteLength+H.byteLength);return Ae.set(k.FTYP),Ae.set(H,k.FTYP.byteLength),Ae},k}();c.types=void 0,c.HDLR_TYPES=void 0,c.STTS=void 0,c.STSC=void 0,c.STCO=void 0,c.STSZ=void 0,c.VMHD=void 0,c.SMHD=void 0,c.STSD=void 0,c.FTYP=void 0,c.DINF=void 0;const P=c;var _=X(851),se=X(973),z=X(93),K=X(308),te=X(673);function re(){return re=Object.assign?Object.assign.bind():function(k){for(var W=1;W<arguments.length;W++){var H=arguments[W];for(var Ae in H)Object.prototype.hasOwnProperty.call(H,Ae)&&(k[Ae]=H[Ae])}return k},re.apply(this,arguments)}var de=null,Q=null,ne=function(){function k(H,Ae,_e,we){if(we===void 0&&(we=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=H,this.config=Ae,this.typeSupported=_e,this.ISGenerated=!1,de===null){var U=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);de=U?parseInt(U[1]):0}if(Q===null){var ue=navigator.userAgent.match(/Safari\/(\d+)/i);Q=ue?parseInt(ue[1]):0}}var W=k.prototype;return W.destroy=function(){},W.resetTimeStamp=function(H){z.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=H},W.resetNextTimestamp=function(){z.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},W.resetInitSegment=function(){z.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},W.getVideoStartPts=function(H){var Ae=!1,_e=H.reduce(function(we,U){var ue=U.pts-we;return ue<-4294967296?(Ae=!0,le(we,U.pts)):ue>0?we:U.pts},H[0].pts);return Ae&&z.logger.debug("PTS rollover detected"),_e},W.remux=function(H,Ae,_e,we,U,ue,Z,he){var G,xe,Ge,qe,it,me,Ze=U,st=U,Et=H.pid>-1,lt=Ae.pid>-1,vt=Ae.samples.length,St=H.samples.length>0,gt=Z&&vt>0||vt>1;if((!Et||St)&&(!lt||gt)||this.ISGenerated||Z){this.ISGenerated||(Ge=this.generateIS(H,Ae,U));var At,Lt=this.isVideoContiguous,yt=-1;if(gt&&(yt=function(wt){for(var tr=0;tr<wt.length;tr++)if(wt[tr].key)return tr;return-1}(Ae.samples),!Lt&&this.config.forceKeyFrameOnDiscontinuity))if(me=!0,yt>0){z.logger.warn("[mp4-remuxer]: Dropped "+yt+" out of "+vt+" video samples due to a missing keyframe");var Ot=this.getVideoStartPts(Ae.samples);Ae.samples=Ae.samples.slice(yt),Ae.dropped+=yt,At=st+=(Ae.samples[0].pts-Ot)/Ae.inputTimeScale}else yt===-1&&(z.logger.warn("[mp4-remuxer]: No keyframe found out of "+vt+" video samples"),me=!1);if(this.ISGenerated){if(St&&gt){var _t=this.getVideoStartPts(Ae.samples),Jt=(le(H.samples[0].pts,_t)-_t)/Ae.inputTimeScale;Ze+=Math.max(0,Jt),st+=Math.max(0,-Jt)}if(St){if(H.samplerate||(z.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Ge=this.generateIS(H,Ae,U)),xe=this.remuxAudio(H,Ze,this.isAudioContiguous,ue,lt||gt||he===K.PlaylistLevelType.AUDIO?st:void 0),gt){var Gt=xe?xe.endPTS-xe.startPTS:0;Ae.inputTimeScale||(z.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Ge=this.generateIS(H,Ae,U)),G=this.remuxVideo(Ae,st,Lt,Gt)}}else gt&&(G=this.remuxVideo(Ae,st,Lt,0));G&&(G.firstKeyFrame=yt,G.independent=yt!==-1,G.firstKeyFramePTS=At)}}return this.ISGenerated&&(_e.samples.length&&(it=Re(_e,U,this._initPTS,this._initDTS)),we.samples.length&&(qe=Te(we,U,this._initPTS))),{audio:xe,video:G,initSegment:Ge,independent:me,text:qe,id3:it}},W.generateIS=function(H,Ae,_e){var we,U,ue,Z=H.samples,he=Ae.samples,G=this.typeSupported,xe={},Ge=!(0,Ee.isFiniteNumber)(this._initPTS),qe="audio/mp4";if(Ge&&(we=U=1/0),H.config&&Z.length&&(H.timescale=H.samplerate,H.segmentCodec==="mp3"&&(G.mpeg?(qe="audio/mpeg",H.codec=""):G.mp3&&(H.codec="mp3")),xe.audio={id:"audio",container:qe,codec:H.codec,initSegment:H.segmentCodec==="mp3"&&G.mpeg?new Uint8Array(0):P.initSegment([H]),metadata:{channelCount:H.channelCount}},Ge&&(ue=H.inputTimeScale,we=U=Z[0].pts-Math.round(ue*_e))),Ae.sps&&Ae.pps&&he.length&&(Ae.timescale=Ae.inputTimeScale,xe.video={id:"main",container:"video/mp4",codec:Ae.codec,initSegment:P.initSegment([Ae]),metadata:{width:Ae.width,height:Ae.height}},Ge)){ue=Ae.inputTimeScale;var it=this.getVideoStartPts(he),me=Math.round(ue*_e);U=Math.min(U,le(he[0].dts,it)-me),we=Math.min(we,it-me)}if(Object.keys(xe).length)return this.ISGenerated=!0,Ge&&(this._initPTS=we,this._initDTS=U),{tracks:xe,initPTS:we,timescale:ue}},W.remuxVideo=function(H,Ae,_e,we){var U,ue,Z=H.inputTimeScale,he=H.samples,G=[],xe=he.length,Ge=this._initPTS,qe=this.nextAvcDts,it=8,me=this.videoSampleDuration,Ze=Number.POSITIVE_INFINITY,st=Number.NEGATIVE_INFINITY,Et=!1;_e&&qe!==null||(qe=Ae*Z-(he[0].pts-le(he[0].dts,he[0].pts)));for(var lt=0;lt<xe;lt++){var vt=he[lt];vt.pts=le(vt.pts-Ge,qe),vt.dts=le(vt.dts-Ge,qe),vt.dts<he[lt>0?lt-1:lt].dts&&(Et=!0)}Et&&he.sort(function($e,je){var ot=$e.dts-je.dts,Tt=$e.pts-je.pts;return ot||Tt}),U=he[0].dts;var St=he[he.length-1].dts-U,gt=St?Math.round(St/(xe-1)):me||H.inputTimeScale/30;if(_e){var At=U-qe,Lt=At>gt,yt=At<-1;if((Lt||yt)&&(Lt?z.logger.warn("AVC: "+(0,te.toMsFromMpegTsClock)(At,!0)+" ms ("+At+"dts) hole between fragments detected, filling it"):z.logger.warn("AVC: "+(0,te.toMsFromMpegTsClock)(-At,!0)+" ms ("+At+"dts) overlapping between fragments detected"),!yt||qe>he[0].pts)){U=qe;var Ot=he[0].pts-At;he[0].dts=U,he[0].pts=Ot,z.logger.log("Video: First PTS/DTS adjusted: "+(0,te.toMsFromMpegTsClock)(Ot,!0)+"/"+(0,te.toMsFromMpegTsClock)(U,!0)+", delta: "+(0,te.toMsFromMpegTsClock)(At,!0)+" ms")}}U=Math.max(0,U);for(var _t=0,Jt=0,Gt=0;Gt<xe;Gt++){for(var wt=he[Gt],tr=wt.units,Zt=tr.length,rr=0,lr=0;lr<Zt;lr++)rr+=tr[lr].data.length;Jt+=rr,_t+=Zt,wt.length=rr,wt.dts=Math.max(wt.dts,U),Ze=Math.min(wt.pts,Ze),st=Math.max(wt.pts,st)}ue=he[xe-1].dts;var ur,hr=Jt+4*_t+8;try{ur=new Uint8Array(hr)}catch($e){return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:se.ErrorTypes.MUX_ERROR,details:se.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:hr,reason:"fail allocating video mdat "+hr})}var Xt=new DataView(ur.buffer);Xt.setUint32(0,hr),ur.set(P.types.mdat,4);for(var sr=!1,ye=Number.POSITIVE_INFINITY,ae=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,$=0;$<xe;$++){for(var ce=he[$],ve=ce.units,Le=0,Ne=0,ze=ve.length;Ne<ze;Ne++){var Be=ve[Ne],rt=Be.data,pt=Be.data.byteLength;Xt.setUint32(it,pt),it+=4,ur.set(rt,it),it+=pt,Le+=4+pt}var ct=void 0;if($<xe-1)me=he[$+1].dts-ce.dts,ct=he[$+1].pts-ce.pts;else{var R=this.config,I=$>0?ce.dts-he[$-1].dts:gt;if(ct=$>0?ce.pts-he[$-1].pts:gt,R.stretchShortVideoTrack&&this.nextAudioPts!==null){var S=Math.floor(R.maxBufferHole*Z),C=(we?Ze+we*Z:this.nextAudioPts)-ce.pts;C>S?((me=C-I)<0?me=I:sr=!0,z.logger.log("[mp4-remuxer]: It is approximately "+C/90+" ms to the next segment; using duration "+me/90+" ms for the last video frame.")):me=I}else me=I}var O=Math.round(ce.pts-ce.dts);ye=Math.min(ye,me),x=Math.max(x,me),ae=Math.min(ae,ct),ee=Math.max(ee,ct),G.push(new Pe(ce.key,me,Le,O))}if(G.length){if(de){if(de<70){var Y=G[0].flags;Y.dependsOn=2,Y.isNonSync=0}}else if(Q&&ee-ae<x-ye&&gt/x<.025&&G[0].cts===0){z.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var j=U,J=0,De=G.length;J<De;J++){var pe=j+G[J].duration,ke=j+G[J].cts;if(J<De-1){var Fe=pe+G[J+1].cts;G[J].duration=Fe-ke}else G[J].duration=J?G[J-1].duration:gt;G[J].cts=0,j=pe}}}me=sr||!me?gt:me,this.nextAvcDts=qe=ue+me,this.videoSampleDuration=me,this.isVideoContiguous=!0;var Qe={data1:P.moof(H.sequenceNumber++,U,re({},H,{samples:G})),data2:ur,startPTS:Ze/Z,endPTS:(st+me)/Z,startDTS:U/Z,endDTS:qe/Z,type:"video",hasAudio:!1,hasVideo:!0,nb:G.length,dropped:H.dropped};return H.samples=[],H.dropped=0,Qe},W.remuxAudio=function(H,Ae,_e,we,U){var ue=H.inputTimeScale,Z=ue/(H.samplerate?H.samplerate:ue),he=H.segmentCodec==="aac"?1024:1152,G=he*Z,xe=this._initPTS,Ge=H.segmentCodec==="mp3"&&this.typeSupported.mpeg,qe=[],it=U!==void 0,me=H.samples,Ze=Ge?0:8,st=this.nextAudioPts||-1,Et=Ae*ue;if(this.isAudioContiguous=_e=_e||me.length&&st>0&&(we&&Math.abs(Et-st)<9e3||Math.abs(le(me[0].pts-xe,Et)-st)<20*G),me.forEach(function(Ne){Ne.pts=le(Ne.pts-xe,Et)}),!_e||st<0){if(me=me.filter(function(Ne){return Ne.pts>=0}),!me.length)return;st=U===0?0:we&&!it?Math.max(0,Et):me[0].pts}if(H.segmentCodec==="aac")for(var lt=this.config.maxAudioFramesDrift,vt=0,St=st;vt<me.length;vt++){var gt=me[vt],At=gt.pts,Lt=At-St,yt=Math.abs(1e3*Lt/ue);if(Lt<=-lt*G&&it)vt===0&&(z.logger.warn("Audio frame @ "+(At/ue).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Lt/ue)+" ms."),this.nextAudioPts=st=St=At);else if(Lt>=lt*G&&yt<1e4&&it){var Ot=Math.round(Lt/G);(St=At-Ot*G)<0&&(Ot--,St+=G),vt===0&&(this.nextAudioPts=st=St),z.logger.warn("[mp4-remuxer]: Injecting "+Ot+" audio frame @ "+(St/ue).toFixed(3)+"s due to "+Math.round(1e3*Lt/ue)+" ms gap.");for(var _t=0;_t<Ot;_t++){var Jt=Math.max(St,0),Gt=ie.getSilentFrame(H.manifestCodec||H.codec,H.channelCount);Gt||(z.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Gt=gt.unit.subarray()),me.splice(vt,0,{unit:Gt,pts:Jt}),St+=G,vt++}}gt.pts=St,St+=G}for(var wt,tr=null,Zt=null,rr=0,lr=me.length;lr--;)rr+=me[lr].unit.byteLength;for(var ur=0,hr=me.length;ur<hr;ur++){var Xt=me[ur],sr=Xt.unit,ye=Xt.pts;if(Zt!==null)qe[ur-1].duration=Math.round((ye-Zt)/Z);else{if(_e&&H.segmentCodec==="aac"&&(ye=st),tr=ye,!(rr>0))return;rr+=Ze;try{wt=new Uint8Array(rr)}catch(Ne){return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:se.ErrorTypes.MUX_ERROR,details:se.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:rr,reason:"fail allocating audio mdat "+rr})}Ge||(new DataView(wt.buffer).setUint32(0,rr),wt.set(P.types.mdat,4))}wt.set(sr,Ze);var ae=sr.byteLength;Ze+=ae,qe.push(new Pe(!0,he,ae,0)),Zt=ye}var x=qe.length;if(x){var ee=qe[qe.length-1];this.nextAudioPts=st=Zt+Z*ee.duration;var $=Ge?new Uint8Array(0):P.moof(H.sequenceNumber++,tr/Z,re({},H,{samples:qe}));H.samples=[];var ce=tr/ue,ve=st/ue,Le={data1:$,data2:wt,startPTS:ce,endPTS:ve,startDTS:ce,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:x};return this.isAudioContiguous=!0,Le}},W.remuxEmptyAudio=function(H,Ae,_e,we){var U=H.inputTimeScale,ue=U/(H.samplerate?H.samplerate:U),Z=this.nextAudioPts,he=(Z!==null?Z:we.startDTS*U)+this._initDTS,G=we.endDTS*U+this._initDTS,xe=1024*ue,Ge=Math.ceil((G-he)/xe),qe=ie.getSilentFrame(H.manifestCodec||H.codec,H.channelCount);if(z.logger.warn("[mp4-remuxer]: remux empty Audio"),qe){for(var it=[],me=0;me<Ge;me++){var Ze=he+me*xe;it.push({unit:qe,pts:Ze,dts:Ze})}return H.samples=it,this.remuxAudio(H,Ae,_e,!1)}z.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},k}();function le(k,W){var H;if(W===null)return k;for(H=W<k?-8589934592:8589934592;Math.abs(k-W)>4294967296;)k+=H;return k}function Re(k,W,H,Ae){var _e=k.samples.length;if(_e){for(var we=k.inputTimeScale,U=0;U<_e;U++){var ue=k.samples[U];ue.pts=le(ue.pts-H,W*we)/we,ue.dts=le(ue.dts-Ae,W*we)/we}var Z=k.samples;return k.samples=[],{samples:Z}}}function Te(k,W,H){var Ae=k.samples.length;if(Ae){for(var _e=k.inputTimeScale,we=0;we<Ae;we++){var U=k.samples[we];U.pts=le(U.pts-H,W*_e)/_e}k.samples.sort(function(Z,he){return Z.pts-he.pts});var ue=k.samples;return k.samples=[],{samples:ue}}}var Pe=function(k,W,H,Ae){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=W,this.size=H,this.cts=Ae,this.flags=new F(k)},F=function(k){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=k?2:1,this.isNonSync=k?0:1}},856:(ht,Oe,X)=>{"use strict";var Ee;X.r(Oe),X.d(Oe,{MetadataSchema:()=>Ee}),function(ie){ie.audioId3="org.id3",ie.dateRange="com.apple.quicktime.HLS",ie.emsg="https://aomedia.org/emsg/ID3"}(Ee||(Ee={}))},308:(ht,Oe,X)=>{"use strict";var Ee,ie;X.r(Oe),X.d(Oe,{PlaylistContextType:()=>Ee,PlaylistLevelType:()=>ie}),function(B){B.MANIFEST="manifest",B.LEVEL="level",B.AUDIO_TRACK="audioTrack",B.SUBTITLE_TRACK="subtitleTrack"}(Ee||(Ee={})),function(B){B.MAIN="main",B.AUDIO="audio",B.SUBTITLE="subtitle"}(ie||(ie={}))},93:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{enableLogs:()=>P,logger:()=>_});var Ee=function(){},ie={trace:Ee,debug:Ee,log:Ee,warn:Ee,info:Ee,error:Ee},B=ie;function c(se){var z=self.console[se];return z?z.bind(self.console,"["+se+"] >"):Ee}function P(se,z){if(self.console&&se===!0||typeof se=="object"){(function(K){for(var te=arguments.length,re=new Array(te>1?te-1:0),de=1;de<te;de++)re[de-1]=arguments[de];re.forEach(function(Q){B[Q]=K[Q]?K[Q].bind(K):c(Q)})})(se,"debug","log","info","warn","error");try{B.log('Debug logs enabled for "'+z+'"')}catch(K){B=ie}}else B=ie}var _=ie},63:(ht,Oe,X)=>{"use strict";X.r(Oe),X.d(Oe,{RemuxerTrackIdConfig:()=>_,appendUint8Array:()=>k,bin2str:()=>se,computeRawDurationFromSamples:()=>Te,discardEPB:()=>_e,findBox:()=>de,getDuration:()=>Re,getStartDTS:()=>le,offsetStartDTS:()=>Pe,parseEmsg:()=>we,parseInitSegment:()=>ne,parseSEIMessageFromNALu:()=>Ae,parseSamples:()=>W,parseSegmentIndex:()=>Q,readSint32:()=>te,readUint16:()=>z,readUint32:()=>K,segmentValidRange:()=>F,writeUint32:()=>re});var Ee=X(145),ie=X(923),B=X(181),c=Math.pow(2,32)-1,P=[].push,_={video:1,audio:2,id3:3,text:4};function se(U){return String.fromCharCode.apply(null,U)}function z(U,ue){var Z=U[ue]<<8|U[ue+1];return Z<0?65536+Z:Z}function K(U,ue){var Z=te(U,ue);return Z<0?4294967296+Z:Z}function te(U,ue){return U[ue]<<24|U[ue+1]<<16|U[ue+2]<<8|U[ue+3]}function re(U,ue,Z){U[ue]=Z>>24,U[ue+1]=Z>>16&255,U[ue+2]=Z>>8&255,U[ue+3]=255&Z}function de(U,ue){var Z=[];if(!ue.length)return Z;for(var he=U.byteLength,G=0;G<he;){var xe=K(U,G),Ge=xe>1?G+xe:he;if(se(U.subarray(G+4,G+8))===ue[0])if(ue.length===1)Z.push(U.subarray(G+8,Ge));else{var qe=de(U.subarray(G+8,Ge),ue.slice(1));qe.length&&P.apply(Z,qe)}G=Ge}return Z}function Q(U){var ue=[],Z=U[0],he=8,G=K(U,he);he+=4,he+=Z===0?8:16,he+=2;var xe=U.length+0,Ge=z(U,he);he+=2;for(var qe=0;qe<Ge;qe++){var it=he,me=K(U,it);it+=4;var Ze=2147483647&me;if((2147483648&me)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var st=K(U,it);it+=4,ue.push({referenceSize:Ze,subsegmentDuration:st,info:{duration:st/G,start:xe,end:xe+Ze-1}}),xe+=Ze,he=it+=4}return{earliestPresentationTime:0,timescale:G,version:Z,referencesCount:Ge,references:ue}}function ne(U){for(var ue=[],Z=de(U,["moov","trak"]),he=0;he<Z.length;he++){var G=Z[he],xe=de(G,["tkhd"])[0];if(xe){var Ge=xe[0],qe=Ge===0?12:20,it=K(xe,qe),me=de(G,["mdia","mdhd"])[0];if(me){var Ze=K(me,qe=(Ge=me[0])===0?12:20),st=de(G,["mdia","hdlr"])[0];if(st){var Et=se(st.subarray(8,12)),lt={soun:ie.ElementaryStreamTypes.AUDIO,vide:ie.ElementaryStreamTypes.VIDEO}[Et];if(lt){var vt=de(G,["mdia","minf","stbl","stsd"])[0],St=void 0;vt&&(St=se(vt.subarray(12,16))),ue[it]={timescale:Ze,type:lt},ue[lt]={timescale:Ze,id:it,codec:St}}}}}}return de(U,["moov","mvex","trex"]).forEach(function(gt){var At=K(gt,4),Lt=ue[At];Lt&&(Lt.default={duration:K(gt,12),flags:K(gt,20)})}),ue}function le(U,ue){return de(ue,["moof","traf"]).reduce(function(Z,he){var G=de(he,["tfdt"])[0],xe=G[0],Ge=de(he,["tfhd"]).reduce(function(qe,it){var me=K(it,4),Ze=U[me];if(Ze){var st=K(G,4);xe===1&&(st*=Math.pow(2,32),st+=K(G,8));var Et=st/(Ze.timescale||9e4);if(isFinite(Et)&&(qe===null||Et<qe))return Et}return qe},null);return Ge!==null&&isFinite(Ge)&&(Z===null||Ge<Z)?Ge:Z},null)||0}function Re(U,ue){for(var Z=0,he=0,G=0,xe=de(U,["moof","traf"]),Ge=0;Ge<xe.length;Ge++){var qe=xe[Ge],it=de(qe,["tfhd"])[0],me=ue[K(it,4)];if(me){var Ze=me.default,st=K(it,0)|(Ze==null?void 0:Ze.flags),Et=Ze==null?void 0:Ze.duration;8&st&&(Et=K(it,2&st?12:8));for(var lt=me.timescale||9e4,vt=de(qe,["trun"]),St=0;St<vt.length;St++)!(Z=Te(vt[St]))&&Et&&(Z=Et*K(vt[St],4)),me.type===ie.ElementaryStreamTypes.VIDEO?he+=Z/lt:me.type===ie.ElementaryStreamTypes.AUDIO&&(G+=Z/lt)}}if(he===0&&G===0){for(var gt=0,At=de(U,["sidx"]),Lt=0;Lt<At.length;Lt++){var yt=Q(At[Lt]);yt!=null&&yt.references&&(gt+=yt.references.reduce(function(Ot,_t){return Ot+_t.info.duration||0},0))}return gt}return he||G}function Te(U){var ue=K(U,0),Z=8;1&ue&&(Z+=4),4&ue&&(Z+=4);for(var he=0,G=K(U,4),xe=0;xe<G;xe++)256&ue&&(he+=K(U,Z),Z+=4),512&ue&&(Z+=4),1024&ue&&(Z+=4),2048&ue&&(Z+=4);return he}function Pe(U,ue,Z){de(ue,["moof","traf"]).forEach(function(he){de(he,["tfhd"]).forEach(function(G){var xe=K(G,4),Ge=U[xe];if(Ge){var qe=Ge.timescale||9e4;de(he,["tfdt"]).forEach(function(it){var me=it[0],Ze=K(it,4);if(me===0)Ze-=Z*qe,re(it,4,Ze=Math.max(Ze,0));else{Ze*=Math.pow(2,32),Ze+=K(it,8),Ze-=Z*qe,Ze=Math.max(Ze,0);var st=Math.floor(Ze/(c+1)),Et=Math.floor(Ze%(c+1));re(it,4,st),re(it,8,Et)}})}})})}function F(U){var ue={valid:null,remainder:null},Z=de(U,["moof"]);if(!Z)return ue;if(Z.length<2)return ue.remainder=U,ue;var he=Z[Z.length-1];return ue.valid=(0,Ee.sliceUint8)(U,0,he.byteOffset-8),ue.remainder=(0,Ee.sliceUint8)(U,he.byteOffset-8),ue}function k(U,ue){var Z=new Uint8Array(U.length+ue.length);return Z.set(U),Z.set(ue,U.length),Z}function W(U,ue){var Z=[],he=ue.samples,G=ue.timescale,xe=ue.id,Ge=!1;return de(he,["moof"]).map(function(qe){var it=qe.byteOffset-8;de(qe,["traf"]).map(function(me){var Ze=de(me,["tfdt"]).map(function(st){var Et=st[0],lt=K(st,4);return Et===1&&(lt*=Math.pow(2,32),lt+=K(st,8)),lt/G})[0];return Ze!==void 0&&(U=Ze),de(me,["tfhd"]).map(function(st){var Et=K(st,4),lt=16777215&K(st,0),vt=0,St=(16&lt)!=0,gt=0,At=(32&lt)!=0,Lt=8;Et===xe&&((1&lt)!=0&&(Lt+=8),(2&lt)!=0&&(Lt+=4),(8&lt)!=0&&(vt=K(st,Lt),Lt+=4),St&&(gt=K(st,Lt),Lt+=4),At&&(Lt+=4),ue.type==="video"&&(Ge=function(yt){if(!yt)return!1;var Ot=yt.indexOf("."),_t=Ot<0?yt:yt.substring(0,Ot);return _t==="hvc1"||_t==="hev1"||_t==="dvh1"||_t==="dvhe"}(ue.codec)),de(me,["trun"]).map(function(yt){var Ot=yt[0],_t=16777215&K(yt,0),Jt=(1&_t)!=0,Gt=0,wt=(4&_t)!=0,tr=(256&_t)!=0,Zt=0,rr=(512&_t)!=0,lr=0,ur=(1024&_t)!=0,hr=(2048&_t)!=0,Xt=0,sr=K(yt,4),ye=8;Jt&&(Gt=K(yt,ye),ye+=4),wt&&(ye+=4);for(var ae=Gt+it,x=0;x<sr;x++){if(tr?(Zt=K(yt,ye),ye+=4):Zt=vt,rr?(lr=K(yt,ye),ye+=4):lr=gt,ur&&(ye+=4),hr&&(Xt=Ot===0?K(yt,ye):te(yt,ye),ye+=4),ue.type===ie.ElementaryStreamTypes.VIDEO)for(var ee=0;ee<lr;){var $=K(he,ae);H(Ge,he[ae+=4])&&Ae(he.subarray(ae,ae+$),Ge?2:1,U+Xt/G,Z),ae+=$,ee+=$+4}U+=Zt/G}}))})})}),Z}function H(U,ue){if(U){var Z=ue>>1&63;return Z===39||Z===40}return(31&ue)==6}function Ae(U,ue,Z,he){var G=_e(U),xe=0;xe+=ue;for(var Ge=0,qe=0,it=!1,me=0;xe<G.length;){Ge=0;do{if(xe>=G.length)break;Ge+=me=G[xe++]}while(me===255);qe=0;do{if(xe>=G.length)break;qe+=me=G[xe++]}while(me===255);var Ze=G.length-xe;if(!it&&Ge===4&&xe<G.length){if(it=!0,G[xe++]===181){var st=z(G,xe);if(xe+=2,st===49){var Et=K(G,xe);if(xe+=4,Et===1195456820){var lt=G[xe++];if(lt===3){var vt=G[xe++],St=64&vt,gt=St?2+3*(31&vt):0,At=new Uint8Array(gt);if(St){At[0]=vt;for(var Lt=1;Lt<gt;Lt++)At[Lt]=G[xe++]}he.push({type:lt,payloadType:Ge,pts:Z,bytes:At})}}}}}else if(Ge===5&&qe<Ze){if(it=!0,qe>16){for(var yt=[],Ot=0;Ot<16;Ot++){var _t=G[xe++].toString(16);yt.push(_t.length==1?"0"+_t:_t),Ot!==3&&Ot!==5&&Ot!==7&&Ot!==9||yt.push("-")}for(var Jt=qe-16,Gt=new Uint8Array(Jt),wt=0;wt<Jt;wt++)Gt[wt]=G[xe++];he.push({payloadType:Ge,pts:Z,uuid:yt.join(""),userData:(0,B.utf8ArrayToStr)(Gt),userDataBytes:Gt})}}else if(qe<Ze)xe+=qe;else if(qe>Ze)break}}function _e(U){for(var ue=U.byteLength,Z=[],he=1;he<ue-2;)U[he]===0&&U[he+1]===0&&U[he+2]===3?(Z.push(he+2),he+=2):he++;if(Z.length===0)return U;var G=ue-Z.length,xe=new Uint8Array(G),Ge=0;for(he=0;he<G;Ge++,he++)Ge===Z[0]&&(Ge++,Z.shift()),xe[he]=U[Ge];return xe}function we(U){var ue=U[0],Z="",he="",G=0,xe=0,Ge=0,qe=0,it=0,me=0;if(ue===0){for(;se(U.subarray(me,me+1))!=="\0";)Z+=se(U.subarray(me,me+1)),me+=1;for(Z+=se(U.subarray(me,me+1)),me+=1;se(U.subarray(me,me+1))!=="\0";)he+=se(U.subarray(me,me+1)),me+=1;he+=se(U.subarray(me,me+1)),me+=1,G=K(U,12),xe=K(U,16),qe=K(U,20),it=K(U,24),me=28}else if(ue===1){G=K(U,me+=4);var Ze=K(U,me+=4),st=K(U,me+=4);for(me+=4,Ge=Math.pow(2,32)*Ze+st,Number.isSafeInteger(Ge)||(Ge=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),qe=K(U,me),it=K(U,me+=4),me+=4;se(U.subarray(me,me+1))!=="\0";)Z+=se(U.subarray(me,me+1)),me+=1;for(Z+=se(U.subarray(me,me+1)),me+=1;se(U.subarray(me,me+1))!=="\0";)he+=se(U.subarray(me,me+1)),me+=1;he+=se(U.subarray(me,me+1)),me+=1}return{schemeIdUri:Z,value:he,timeScale:G,presentationTime:Ge,presentationTimeDelta:xe,eventDuration:qe,id:it,payload:U.subarray(me,U.byteLength)}}},673:(ht,Oe,X)=>{"use strict";function Ee(P,_,se,z){se===void 0&&(se=1),z===void 0&&(z=!1);var K=P*_*se;return z?Math.round(K):K}function ie(P,_,se,z){return se===void 0&&(se=1),z===void 0&&(z=!1),Ee(P,_,1/se,z)}function B(P,_){return _===void 0&&(_=!1),Ee(P,1e3,11111111111111112e-21,_)}function c(P,_){return _===void 0&&(_=1),Ee(P,9e4,1/_)}X.r(Oe),X.d(Oe,{toMpegTsClockFromTimescale:()=>c,toMsFromMpegTsClock:()=>B,toTimescaleFromBase:()=>Ee,toTimescaleFromScale:()=>ie})},145:(ht,Oe,X)=>{"use strict";function Ee(ie,B,c){return Uint8Array.prototype.slice?ie.slice(B,c):new Uint8Array(Array.prototype.slice.call(ie,B,c))}X.r(Oe),X.d(Oe,{sliceUint8:()=>Ee})},729:ht=>{"use strict";var Oe=Object.prototype.hasOwnProperty,X="~";function Ee(){}function ie(_,se,z){this.fn=_,this.context=se,this.once=z||!1}function B(_,se,z,K,te){if(typeof z!="function")throw new TypeError("The listener must be a function");var re=new ie(z,K||_,te),de=X?X+se:se;return _._events[de]?_._events[de].fn?_._events[de]=[_._events[de],re]:_._events[de].push(re):(_._events[de]=re,_._eventsCount++),_}function c(_,se){--_._eventsCount==0?_._events=new Ee:delete _._events[se]}function P(){this._events=new Ee,this._eventsCount=0}Object.create&&(Ee.prototype=Object.create(null),new Ee().__proto__||(X=!1)),P.prototype.eventNames=function(){var _,se,z=[];if(this._eventsCount===0)return z;for(se in _=this._events)Oe.call(_,se)&&z.push(X?se.slice(1):se);return Object.getOwnPropertySymbols?z.concat(Object.getOwnPropertySymbols(_)):z},P.prototype.listeners=function(_){var se=X?X+_:_,z=this._events[se];if(!z)return[];if(z.fn)return[z.fn];for(var K=0,te=z.length,re=new Array(te);K<te;K++)re[K]=z[K].fn;return re},P.prototype.listenerCount=function(_){var se=X?X+_:_,z=this._events[se];return z?z.fn?1:z.length:0},P.prototype.emit=function(_,se,z,K,te,re){var de=X?X+_:_;if(!this._events[de])return!1;var Q,ne,le=this._events[de],Re=arguments.length;if(le.fn){switch(le.once&&this.removeListener(_,le.fn,void 0,!0),Re){case 1:return le.fn.call(le.context),!0;case 2:return le.fn.call(le.context,se),!0;case 3:return le.fn.call(le.context,se,z),!0;case 4:return le.fn.call(le.context,se,z,K),!0;case 5:return le.fn.call(le.context,se,z,K,te),!0;case 6:return le.fn.call(le.context,se,z,K,te,re),!0}for(ne=1,Q=new Array(Re-1);ne<Re;ne++)Q[ne-1]=arguments[ne];le.fn.apply(le.context,Q)}else{var Te,Pe=le.length;for(ne=0;ne<Pe;ne++)switch(le[ne].once&&this.removeListener(_,le[ne].fn,void 0,!0),Re){case 1:le[ne].fn.call(le[ne].context);break;case 2:le[ne].fn.call(le[ne].context,se);break;case 3:le[ne].fn.call(le[ne].context,se,z);break;case 4:le[ne].fn.call(le[ne].context,se,z,K);break;default:if(!Q)for(Te=1,Q=new Array(Re-1);Te<Re;Te++)Q[Te-1]=arguments[Te];le[ne].fn.apply(le[ne].context,Q)}}return!0},P.prototype.on=function(_,se,z){return B(this,_,se,z,!1)},P.prototype.once=function(_,se,z){return B(this,_,se,z,!0)},P.prototype.removeListener=function(_,se,z,K){var te=X?X+_:_;if(!this._events[te])return this;if(!se)return c(this,te),this;var re=this._events[te];if(re.fn)re.fn!==se||K&&!re.once||z&&re.context!==z||c(this,te);else{for(var de=0,Q=[],ne=re.length;de<ne;de++)(re[de].fn!==se||K&&!re[de].once||z&&re[de].context!==z)&&Q.push(re[de]);Q.length?this._events[te]=Q.length===1?Q[0]:Q:c(this,te)}return this},P.prototype.removeAllListeners=function(_){var se;return _?(se=X?X+_:_,this._events[se]&&c(this,se)):(this._events=new Ee,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=X,P.EventEmitter=P,ht.exports=P},945:function(ht){var Oe,X,Ee,ie,B;Oe=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,X=/^(?=([^\/?#]*))\1([^]*)$/,Ee=/(?:\/|^)\.(?=\/)/g,ie=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,B={buildAbsoluteURL:function(c,P,_){if(_=_||{},c=c.trim(),!(P=P.trim())){if(!_.alwaysNormalize)return c;var se=B.parseURL(c);if(!se)throw new Error("Error trying to parse base URL.");return se.path=B.normalizePath(se.path),B.buildURLFromParts(se)}var z=B.parseURL(P);if(!z)throw new Error("Error trying to parse relative URL.");if(z.scheme)return _.alwaysNormalize?(z.path=B.normalizePath(z.path),B.buildURLFromParts(z)):P;var K=B.parseURL(c);if(!K)throw new Error("Error trying to parse base URL.");if(!K.netLoc&&K.path&&K.path[0]!=="/"){var te=X.exec(K.path);K.netLoc=te[1],K.path=te[2]}K.netLoc&&!K.path&&(K.path="/");var re={scheme:K.scheme,netLoc:z.netLoc,path:null,params:z.params,query:z.query,fragment:z.fragment};if(!z.netLoc&&(re.netLoc=K.netLoc,z.path[0]!=="/"))if(z.path){var de=K.path,Q=de.substring(0,de.lastIndexOf("/")+1)+z.path;re.path=B.normalizePath(Q)}else re.path=K.path,z.params||(re.params=K.params,z.query||(re.query=K.query));return re.path===null&&(re.path=_.alwaysNormalize?B.normalizePath(z.path):z.path),B.buildURLFromParts(re)},parseURL:function(c){var P=Oe.exec(c);return P?{scheme:P[1]||"",netLoc:P[2]||"",path:P[3]||"",params:P[4]||"",query:P[5]||"",fragment:P[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(Ee,"");c.length!==(c=c.replace(ie,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}},ht.exports=B}},Cr={};function cr(ht){var Oe=Cr[ht];if(Oe!==void 0)return Oe.exports;var X=Cr[ht]={exports:{}};return ti[ht].call(X.exports,X,X.exports,cr),X.exports}cr.m=ti,cr.n=ht=>{var Oe=ht&&ht.__esModule?()=>ht.default:()=>ht;return cr.d(Oe,{a:Oe}),Oe},cr.d=(ht,Oe)=>{for(var X in Oe)cr.o(Oe,X)&&!cr.o(ht,X)&&Object.defineProperty(ht,X,{enumerable:!0,get:Oe[X]})},cr.o=(ht,Oe)=>Object.prototype.hasOwnProperty.call(ht,Oe),cr.r=ht=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(ht,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ht,"__esModule",{value:!0})};var xi=cr(817);return xi.default})())},7737:function($i,ti,Cr){"use strict";Cr.d(ti,{Z:function(){return ie}});var cr=(B,c,P)=>new Promise((_,se)=>{var z=re=>{try{te(P.next(re))}catch(de){se(de)}},K=re=>{try{te(P.throw(re))}catch(de){se(de)}},te=re=>re.done?_(re.value):Promise.resolve(re.value).then(z,K);te((P=P.apply(B,c)).next())});const xi='<svg t="1662781037078" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2912" width="200" height="200"><path d="M810.666667 170.666667H213.333333c-47.146667 0-85.333333 38.186667-85.333333 85.333333v512c0 47.146667 38.186667 85.333333 85.333333 85.333333h597.333334c47.146667 0 85.333333-38.186667 85.333333-85.333333V256c0-47.146667-38.186667-85.333333-85.333333-85.333333zM469.333333 640h-64v-85.333333h-85.333333v85.333333h-64V384h64v106.666667h85.333333v-106.666667h64v256z m298.666667-42.666667a42.666667 42.666667 0 0 1-42.666667 42.666667h-32v64h-64v-64H597.333333a42.666667 42.666667 0 0 1-42.666666-42.666667v-170.666666a42.666667 42.666667 0 0 1 42.666666-42.666667h128a42.666667 42.666667 0 0 1 42.666667 42.666667v170.666666z m-149.333333-21.333333h85.333333v-128h-85.333333v128z" p-id="2913" fill="#ffffff"></path></svg>',ht="oplayer-plugin-hls";let Oe=globalThis.Hls;const X=(B,c,P)=>(P||!(Boolean(B.canPlayType("application/x-mpegURL"))||Boolean(B.canPlayType("application/vnd.apple.mpegURL"))))&&(c.format==="m3u8"||(c.format==="auto"||typeof c.format=="undefined")&&/m3u8(#|\?|$)/i.test(c.src)),Ee=function(B,c){let P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!P.hlsQualityControl)return;const _=()=>{var z,K;const te=[{name:B.locales.get("Auto"),default:!0,value:-1}];c.levels.length>1&&c.levels.forEach((re,de)=>{let Q=(re.name||re.height).toString();if(isFinite(+Q)&&(Q+="p"),P.withBitrate){const ne=re.bitrate/1e3,le=ne>1e3,Re=le?~~(ne/1e3):Math.floor(ne);Q+=" ("+Re+(le?"m":"k")+"bps)"}return te.push({name:Q,default:!1,value:de})}),(z=B.plugins.ui)==null||z.setting.unregister(ht),(K=B.plugins.ui)==null||K.setting.register({name:B.locales.get("Quality"),type:"selector",key:ht,icon:xi,onChange:re=>{P.hlsQualitySwitch=="immediate"?(c.currentLevel=re.value,re.value!==-1&&(c.loadLevel=re.value)):(c.nextLevel=re.value,re.value!==-1&&(c.nextLoadLevel=re.value))},children:te})},se=z=>{var K,te;const re=z.level;if(c.autoLevelEnabled){const de=c.levels[re].height,Q=B.locales.get("Auto")+(de?" ("+de+"p)":"");(K=B.plugins.ui)==null||K.setting.updateLabel(ht,Q)}else(te=B.plugins.ui)==null||te.setting.select(ht,re+1,!1)};c.once(Oe.Events.MANIFEST_PARSED,_),c.on(Oe.Events.LEVEL_SWITCHED,(z,K)=>se(K))},ie=function(){let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=B.hlsConfig,P=c===void 0?{}:c,_=B.matcher,se=_===void 0?X:_,z=B.options,K,te;const re=Object.assign({light:!0,hlsQualityControl:!1,hlsQualitySwitch:"smooth"},z);re.hlsQualityControl&&(re.light=!1);const de=()=>cr(this,null,function*(){K&&K.destroy(),Oe!=null||(Oe=(yield re.light?Cr.e(817).then(Cr.t.bind(Cr,1527,19)):Cr.e(817).then(Cr.t.bind(Cr,5025,19))).default),K=new Oe(P)});return{name:ht,key:"hls",load:(Q,ne,le)=>cr(this,null,function*(){var Re,Te;const Pe=se(Q.$video,ne,re.forceHLS);return le.loader||!Pe?(K&&((Re=Q.plugins.ui)==null||Re.setting.unregister(ht),K.destroy(),te==null||te()),!1):(yield de(),Oe.isSupported()?(K.loadSource(ne.src),K.attachMedia(Q.$video),Q.isNativeUI||Ee(Q,K,re),K.on(Oe.Events.ERROR,function(F,k){const W=k.type,H=k.details;k.fatal?(Q.hasError=!0,Q.emit("error",Object.assign({},k,{pluginName:ht,message:W+": "+H}))):re.showWarning&&Q.emit("notice",Object.assign({},k,{pluginName:ht,text:W+": "+H}))}),te=(Te=re.onActive)==null?void 0:Te.call(re,K),!0):!1)}),apply:Q=>(Q.on("destroy",()=>{K==null||K.destroy(),K=null}),{value:()=>K,constructor:()=>Oe})}}}}]);
