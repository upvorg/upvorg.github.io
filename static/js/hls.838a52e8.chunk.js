(self.webpackChunk_web_index=self.webpackChunk_web_index||[]).push([[817],{9588:function(ze){typeof window!="undefined"&&function(Mt,ct){ze.exports=ct()}(this,function(){return function(Mt){var ct={};function J(z){if(ct[z])return ct[z].exports;var V=ct[z]={i:z,l:!1,exports:{}};return Mt[z].call(V.exports,V,V.exports,J),V.l=!0,V.exports}return J.m=Mt,J.c=ct,J.d=function(z,V,q){J.o(z,V)||Object.defineProperty(z,V,{enumerable:!0,get:q})},J.r=function(z){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(z,"__esModule",{value:!0})},J.t=function(z,V){if(1&V&&(z=J(z)),8&V||4&V&&typeof z=="object"&&z&&z.__esModule)return z;var q=Object.create(null);if(J.r(q),Object.defineProperty(q,"default",{enumerable:!0,value:z}),2&V&&typeof z!="string")for(var Tt in z)J.d(q,Tt,function(S){return z[S]}.bind(null,Tt));return q},J.n=function(z){var V=z&&z.__esModule?function(){return z.default}:function(){return z};return J.d(V,"a",V),V},J.o=function(z,V){return Object.prototype.hasOwnProperty.call(z,V)},J.p="/dist/",J(J.s=13)}([function(Mt,ct,J){"use strict";J.d(ct,"a",function(){return u}),J.d(ct,"b",function(){return R});var z=J(5);function V(){}var q={trace:V,debug:V,log:V,warn:V,info:V,error:V},Tt=q;function S(k,D){return D="["+k+"] > "+D}var O=Object(z.a)();function d(k){var D=O.console[k];return D?function(){for(var M=arguments.length,I=new Array(M),G=0;G<M;G++)I[G]=arguments[G];I[0]&&(I[0]=S(k,I[0])),D.apply(O.console,I)}:V}var u=function(k){if(O.console&&k===!0||typeof k=="object"){(function(D){for(var M=arguments.length,I=new Array(M>1?M-1:0),G=1;G<M;G++)I[G-1]=arguments[G];I.forEach(function(U){Tt[U]=D[U]?D[U].bind(D):d(U)})})(k,"debug","log","info","warn","error");try{Tt.log()}catch(D){Tt=q}}else Tt=q},R=Tt},function(Mt,ct,J){"use strict";ct.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},function(Mt,ct,J){"use strict";var z,V;J.d(ct,"b",function(){return z}),J.d(ct,"a",function(){return V}),function(q){q.NETWORK_ERROR="networkError",q.MEDIA_ERROR="mediaError",q.KEY_SYSTEM_ERROR="keySystemError",q.MUX_ERROR="muxError",q.OTHER_ERROR="otherError"}(z||(z={})),function(q){q.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",q.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",q.KEY_SYSTEM_NO_SESSION="keySystemNoSession",q.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",q.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",q.MANIFEST_LOAD_ERROR="manifestLoadError",q.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",q.MANIFEST_PARSING_ERROR="manifestParsingError",q.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",q.LEVEL_EMPTY_ERROR="levelEmptyError",q.LEVEL_LOAD_ERROR="levelLoadError",q.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",q.LEVEL_SWITCH_ERROR="levelSwitchError",q.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",q.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",q.FRAG_LOAD_ERROR="fragLoadError",q.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",q.FRAG_DECRYPT_ERROR="fragDecryptError",q.FRAG_PARSING_ERROR="fragParsingError",q.REMUX_ALLOC_ERROR="remuxAllocError",q.KEY_LOAD_ERROR="keyLoadError",q.KEY_LOAD_TIMEOUT="keyLoadTimeOut",q.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",q.BUFFER_APPEND_ERROR="bufferAppendError",q.BUFFER_APPENDING_ERROR="bufferAppendingError",q.BUFFER_STALLED_ERROR="bufferStalledError",q.BUFFER_FULL_ERROR="bufferFullError",q.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",q.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",q.INTERNAL_EXCEPTION="internalException"}(V||(V={}))},function(Mt,ct,J){"use strict";J.d(ct,"a",function(){return z});var z=Number.isFinite||function(V){return typeof V=="number"&&isFinite(V)};Number.MAX_SAFE_INTEGER},function(Mt,ct,J){"use strict";J.d(ct,"b",function(){return S});var z,V=J(5),q=function(){function O(){}return O.isHeader=function(d,u){return u+10<=d.length&&d[u]===73&&d[u+1]===68&&d[u+2]===51&&d[u+3]<255&&d[u+4]<255&&d[u+6]<128&&d[u+7]<128&&d[u+8]<128&&d[u+9]<128},O.isFooter=function(d,u){return u+10<=d.length&&d[u]===51&&d[u+1]===68&&d[u+2]===73&&d[u+3]<255&&d[u+4]<255&&d[u+6]<128&&d[u+7]<128&&d[u+8]<128&&d[u+9]<128},O.getID3Data=function(d,u){for(var R=u,k=0;O.isHeader(d,u);)k+=10,k+=O._readSize(d,u+6),O.isFooter(d,u+10)&&(k+=10),u+=k;if(k>0)return d.subarray(R,R+k)},O._readSize=function(d,u){var R=0;return R=(127&d[u])<<21,R|=(127&d[u+1])<<14,R|=(127&d[u+2])<<7,R|=127&d[u+3]},O.getTimeStamp=function(d){for(var u=O.getID3Frames(d),R=0;R<u.length;R++){var k=u[R];if(O.isTimeStampFrame(k))return O._readTimeStamp(k)}},O.isTimeStampFrame=function(d){return d&&d.key==="PRIV"&&d.info==="com.apple.streaming.transportStreamTimestamp"},O._getFrameData=function(d){var u=String.fromCharCode(d[0],d[1],d[2],d[3]),R=O._readSize(d,4);return{type:u,size:R,data:d.subarray(10,10+R)}},O.getID3Frames=function(d){for(var u=0,R=[];O.isHeader(d,u);){for(var k=O._readSize(d,u+6),D=(u+=10)+k;u+8<D;){var M=O._getFrameData(d.subarray(u)),I=O._decodeFrame(M);I&&R.push(I),u+=M.size+10}O.isFooter(d,u)&&(u+=10)}return R},O._decodeFrame=function(d){return d.type==="PRIV"?O._decodePrivFrame(d):d.type[0]==="W"?O._decodeURLFrame(d):O._decodeTextFrame(d)},O._readTimeStamp=function(d){if(d.data.byteLength===8){var u=new Uint8Array(d.data),R=1&u[3],k=(u[4]<<23)+(u[5]<<15)+(u[6]<<7)+u[7];return k/=45,R&&(k+=4772185884e-2),Math.round(k)}},O._decodePrivFrame=function(d){if(!(d.size<2)){var u=O._utf8ArrayToStr(d.data,!0),R=new Uint8Array(d.data.subarray(u.length+1));return{key:d.type,info:u,data:R.buffer}}},O._decodeTextFrame=function(d){if(!(d.size<2)){if(d.type==="TXXX"){var u=1,R=O._utf8ArrayToStr(d.data.subarray(u),!0);u+=R.length+1;var k=O._utf8ArrayToStr(d.data.subarray(u));return{key:d.type,info:R,data:k}}var D=O._utf8ArrayToStr(d.data.subarray(1));return{key:d.type,data:D}}},O._decodeURLFrame=function(d){if(d.type==="WXXX"){if(d.size<2)return;var u=1,R=O._utf8ArrayToStr(d.data.subarray(u),!0);u+=R.length+1;var k=O._utf8ArrayToStr(d.data.subarray(u));return{key:d.type,info:R,data:k}}var D=O._utf8ArrayToStr(d.data);return{key:d.type,data:D}},O._utf8ArrayToStr=function(d,u){u===void 0&&(u=!1);var R=Tt();if(R){var k=R.decode(d);if(u){var D=k.indexOf("\0");return D!==-1?k.substring(0,D):k}return k.replace(/\0/g,"")}for(var M,I,G,U=d.length,K="",Y=0;Y<U;){if((M=d[Y++])===0&&u)return K;if(M!==0&&M!==3)switch(M>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:K+=String.fromCharCode(M);break;case 12:case 13:I=d[Y++],K+=String.fromCharCode((31&M)<<6|63&I);break;case 14:I=d[Y++],G=d[Y++],K+=String.fromCharCode((15&M)<<12|(63&I)<<6|(63&G)<<0)}}return K},O}();function Tt(){var O=Object(V.a)();return z||O.TextDecoder===void 0||(z=new O.TextDecoder("utf-8")),z}var S=q._utf8ArrayToStr;ct.a=q},function(Mt,ct,J){"use strict";function z(){return typeof window=="undefined"?self:window}J.d(ct,"a",function(){return z})},function(Mt,ct,J){var z,V,q,Tt,S;z=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,V=/^([^\/?#]*)(.*)$/,q=/(?:\/|^)\.(?=\/)/g,Tt=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,S={buildAbsoluteURL:function(O,d,u){if(u=u||{},O=O.trim(),!(d=d.trim())){if(!u.alwaysNormalize)return O;var R=S.parseURL(O);if(!R)throw new Error("Error trying to parse base URL.");return R.path=S.normalizePath(R.path),S.buildURLFromParts(R)}var k=S.parseURL(d);if(!k)throw new Error("Error trying to parse relative URL.");if(k.scheme)return u.alwaysNormalize?(k.path=S.normalizePath(k.path),S.buildURLFromParts(k)):d;var D=S.parseURL(O);if(!D)throw new Error("Error trying to parse base URL.");if(!D.netLoc&&D.path&&D.path[0]!=="/"){var M=V.exec(D.path);D.netLoc=M[1],D.path=M[2]}D.netLoc&&!D.path&&(D.path="/");var I={scheme:D.scheme,netLoc:k.netLoc,path:null,params:k.params,query:k.query,fragment:k.fragment};if(!k.netLoc&&(I.netLoc=D.netLoc,k.path[0]!=="/"))if(k.path){var G=D.path,U=G.substring(0,G.lastIndexOf("/")+1)+k.path;I.path=S.normalizePath(U)}else I.path=D.path,k.params||(I.params=D.params,k.query||(I.query=D.query));return I.path===null&&(I.path=u.alwaysNormalize?S.normalizePath(k.path):k.path),S.buildURLFromParts(I)},parseURL:function(O){var d=z.exec(O);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(O){for(O=O.split("").reverse().join("").replace(q,"");O.length!==(O=O.replace(Tt,"")).length;);return O.split("").reverse().join("")},buildURLFromParts:function(O){return O.scheme+O.netLoc+O.path+O.params+O.query+O.fragment}},Mt.exports=S},function(Mt,ct,J){"use strict";var z=function(){function k(D,M){this.subtle=D,this.aesIV=M}return k.prototype.decrypt=function(D,M){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},M,D)},k}(),V=function(){function k(D,M){this.subtle=D,this.key=M}return k.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},k}(),q=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var D=k.prototype;return D.uint8ArrayToUint32Array_=function(M){for(var I=new DataView(M),G=new Uint32Array(4),U=0;U<4;U++)G[U]=I.getUint32(4*U);return G},D.initTable=function(){var M=this.sBox,I=this.invSBox,G=this.subMix,U=G[0],K=G[1],Y=G[2],rt=G[3],ot=this.invSubMix,et=ot[0],gt=ot[1],_t=ot[2],St=ot[3],ut=new Uint32Array(256),Lt=0,At=0,Ct=0;for(Ct=0;Ct<256;Ct++)ut[Ct]=Ct<128?Ct<<1:Ct<<1^283;for(Ct=0;Ct<256;Ct++){var Rt=At^At<<1^At<<2^At<<3^At<<4;Rt=Rt>>>8^255&Rt^99,M[Lt]=Rt,I[Rt]=Lt;var mt=ut[Lt],zt=ut[mt],Jt=ut[zt],Ft=257*ut[Rt]^16843008*Rt;U[Lt]=Ft<<24|Ft>>>8,K[Lt]=Ft<<16|Ft>>>16,Y[Lt]=Ft<<8|Ft>>>24,rt[Lt]=Ft,Ft=16843009*Jt^65537*zt^257*mt^16843008*Lt,et[Rt]=Ft<<24|Ft>>>8,gt[Rt]=Ft<<16|Ft>>>16,_t[Rt]=Ft<<8|Ft>>>24,St[Rt]=Ft,Lt?(Lt=mt^ut[ut[ut[Jt^mt]]],At^=ut[ut[At]]):Lt=At=1}},D.expandKey=function(M){for(var I=this.uint8ArrayToUint32Array_(M),G=!0,U=0;U<I.length&&G;)G=I[U]===this.key[U],U++;if(!G){this.key=I;var K=this.keySize=I.length;if(K!==4&&K!==6&&K!==8)throw new Error("Invalid aes key size="+K);var Y,rt,ot,et,gt=this.ksRows=4*(K+6+1),_t=this.keySchedule=new Uint32Array(gt),St=this.invKeySchedule=new Uint32Array(gt),ut=this.sBox,Lt=this.rcon,At=this.invSubMix,Ct=At[0],Rt=At[1],mt=At[2],zt=At[3];for(Y=0;Y<gt;Y++)Y<K?ot=_t[Y]=I[Y]:(et=ot,Y%K==0?(et=ut[(et=et<<8|et>>>24)>>>24]<<24|ut[et>>>16&255]<<16|ut[et>>>8&255]<<8|ut[255&et],et^=Lt[Y/K|0]<<24):K>6&&Y%K==4&&(et=ut[et>>>24]<<24|ut[et>>>16&255]<<16|ut[et>>>8&255]<<8|ut[255&et]),_t[Y]=ot=(_t[Y-K]^et)>>>0);for(rt=0;rt<gt;rt++)Y=gt-rt,et=3&rt?_t[Y]:_t[Y-4],St[rt]=rt<4||Y<=4?et:Ct[ut[et>>>24]]^Rt[ut[et>>>16&255]]^mt[ut[et>>>8&255]]^zt[ut[255&et]],St[rt]=St[rt]>>>0}},D.networkToHostOrderSwap=function(M){return M<<24|(65280&M)<<8|(16711680&M)>>8|M>>>24},D.decrypt=function(M,I,G,U){for(var K,Y,rt,ot,et,gt,_t,St,ut,Lt,At,Ct,Rt,mt,zt,Jt,Ft,de=this.keySize+6,Ot=this.invKeySchedule,wt=this.invSBox,ie=this.invSubMix,ae=ie[0],te=ie[1],ce=ie[2],y=ie[3],T=this.uint8ArrayToUint32Array_(G),c=T[0],m=T[1],_=T[2],E=T[3],A=new Int32Array(M),w=new Int32Array(A.length),P=this.networkToHostOrderSwap;I<A.length;){for(ut=P(A[I]),Lt=P(A[I+1]),At=P(A[I+2]),Ct=P(A[I+3]),et=ut^Ot[0],gt=Ct^Ot[1],_t=At^Ot[2],St=Lt^Ot[3],Rt=4,mt=1;mt<de;mt++)K=ae[et>>>24]^te[gt>>16&255]^ce[_t>>8&255]^y[255&St]^Ot[Rt],Y=ae[gt>>>24]^te[_t>>16&255]^ce[St>>8&255]^y[255&et]^Ot[Rt+1],rt=ae[_t>>>24]^te[St>>16&255]^ce[et>>8&255]^y[255&gt]^Ot[Rt+2],ot=ae[St>>>24]^te[et>>16&255]^ce[gt>>8&255]^y[255&_t]^Ot[Rt+3],et=K,gt=Y,_t=rt,St=ot,Rt+=4;K=wt[et>>>24]<<24^wt[gt>>16&255]<<16^wt[_t>>8&255]<<8^wt[255&St]^Ot[Rt],Y=wt[gt>>>24]<<24^wt[_t>>16&255]<<16^wt[St>>8&255]<<8^wt[255&et]^Ot[Rt+1],rt=wt[_t>>>24]<<24^wt[St>>16&255]<<16^wt[et>>8&255]<<8^wt[255&gt]^Ot[Rt+2],ot=wt[St>>>24]<<24^wt[et>>16&255]<<16^wt[gt>>8&255]<<8^wt[255&_t]^Ot[Rt+3],Rt+=3,w[I]=P(K^c),w[I+1]=P(ot^m),w[I+2]=P(rt^_),w[I+3]=P(Y^E),c=ut,m=Lt,_=At,E=Ct,I+=4}return U?(zt=w.buffer,Jt=zt.byteLength,(Ft=Jt&&new DataView(zt).getUint8(Jt-1))?zt.slice(0,Jt-Ft):zt):w.buffer},D.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},k}(),Tt=J(2),S=J(0),O=J(1),d=J(5),u=Object(d.a)(),R=function(){function k(M,I,G){var U=(G===void 0?{}:G).removePKCS7Padding,K=U===void 0||U;if(this.logEnabled=!0,this.observer=M,this.config=I,this.removePKCS7Padding=K,K)try{var Y=u.crypto;Y&&(this.subtle=Y.subtle||Y.webkitSubtle)}catch(rt){}this.disableWebCrypto=!this.subtle}var D=k.prototype;return D.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},D.decrypt=function(M,I,G,U){var K=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(S.b.log("JS AES decrypt"),this.logEnabled=!1);var Y=this.decryptor;Y||(this.decryptor=Y=new q),Y.expandKey(I),U(Y.decrypt(M,0,G,this.removePKCS7Padding))}else{this.logEnabled&&(S.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var rt=this.subtle;this.key!==I&&(this.key=I,this.fastAesKey=new V(rt,I)),this.fastAesKey.expandKey().then(function(ot){new z(rt,G).decrypt(M,ot).catch(function(et){K.onWebCryptoError(et,M,I,G,U)}).then(function(et){U(et)})}).catch(function(ot){K.onWebCryptoError(ot,M,I,G,U)})}},D.onWebCryptoError=function(M,I,G,U,K){this.config.enableSoftwareAES?(S.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(I,G,U,K)):(S.b.error("decrypting error : "+M.message),this.observer.trigger(O.a.ERROR,{type:Tt.b.MEDIA_ERROR,details:Tt.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:M.message}))},D.destroy=function(){var M=this.decryptor;M&&(M.destroy(),this.decryptor=void 0)},k}();ct.a=R},function(Mt,ct,J){"use strict";var z=Object.prototype.hasOwnProperty,V="~";function q(){}function Tt(u,R,k){this.fn=u,this.context=R,this.once=k||!1}function S(u,R,k,D,M){if(typeof k!="function")throw new TypeError("The listener must be a function");var I=new Tt(k,D||u,M),G=V?V+R:R;return u._events[G]?u._events[G].fn?u._events[G]=[u._events[G],I]:u._events[G].push(I):(u._events[G]=I,u._eventsCount++),u}function O(u,R){--u._eventsCount==0?u._events=new q:delete u._events[R]}function d(){this._events=new q,this._eventsCount=0}Object.create&&(q.prototype=Object.create(null),new q().__proto__||(V=!1)),d.prototype.eventNames=function(){var u,R,k=[];if(this._eventsCount===0)return k;for(R in u=this._events)z.call(u,R)&&k.push(V?R.slice(1):R);return Object.getOwnPropertySymbols?k.concat(Object.getOwnPropertySymbols(u)):k},d.prototype.listeners=function(u){var R=V?V+u:u,k=this._events[R];if(!k)return[];if(k.fn)return[k.fn];for(var D=0,M=k.length,I=new Array(M);D<M;D++)I[D]=k[D].fn;return I},d.prototype.listenerCount=function(u){var R=V?V+u:u,k=this._events[R];return k?k.fn?1:k.length:0},d.prototype.emit=function(u,R,k,D,M,I){var G=V?V+u:u;if(!this._events[G])return!1;var U,K,Y=this._events[G],rt=arguments.length;if(Y.fn){switch(Y.once&&this.removeListener(u,Y.fn,void 0,!0),rt){case 1:return Y.fn.call(Y.context),!0;case 2:return Y.fn.call(Y.context,R),!0;case 3:return Y.fn.call(Y.context,R,k),!0;case 4:return Y.fn.call(Y.context,R,k,D),!0;case 5:return Y.fn.call(Y.context,R,k,D,M),!0;case 6:return Y.fn.call(Y.context,R,k,D,M,I),!0}for(K=1,U=new Array(rt-1);K<rt;K++)U[K-1]=arguments[K];Y.fn.apply(Y.context,U)}else{var ot,et=Y.length;for(K=0;K<et;K++)switch(Y[K].once&&this.removeListener(u,Y[K].fn,void 0,!0),rt){case 1:Y[K].fn.call(Y[K].context);break;case 2:Y[K].fn.call(Y[K].context,R);break;case 3:Y[K].fn.call(Y[K].context,R,k);break;case 4:Y[K].fn.call(Y[K].context,R,k,D);break;default:if(!U)for(ot=1,U=new Array(rt-1);ot<rt;ot++)U[ot-1]=arguments[ot];Y[K].fn.apply(Y[K].context,U)}}return!0},d.prototype.on=function(u,R,k){return S(this,u,R,k,!1)},d.prototype.once=function(u,R,k){return S(this,u,R,k,!0)},d.prototype.removeListener=function(u,R,k,D){var M=V?V+u:u;if(!this._events[M])return this;if(!R)return O(this,M),this;var I=this._events[M];if(I.fn)I.fn!==R||D&&!I.once||k&&I.context!==k||O(this,M);else{for(var G=0,U=[],K=I.length;G<K;G++)(I[G].fn!==R||D&&!I[G].once||k&&I[G].context!==k)&&U.push(I[G]);U.length?this._events[M]=U.length===1?U[0]:U:O(this,M)}return this},d.prototype.removeAllListeners=function(u){var R;return u?(R=V?V+u:u,this._events[R]&&O(this,R)):(this._events=new q,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=V,d.EventEmitter=d,Mt.exports=d},function(Mt,ct,J){"use strict";var z=J(1),V=J(2),q=J(7),Tt=J(3),S=J(0),O=J(5);function d(y,T){return y[T]===255&&(246&y[T+1])==240}function u(y,T){return 1&y[T+1]?7:9}function R(y,T){return(3&y[T+3])<<11|y[T+4]<<3|(224&y[T+5])>>>5}function k(y,T){return!!(T+1<y.length&&d(y,T))}function D(y,T){if(k(y,T)){var c=u(y,T);if(T+c>=y.length)return!1;var m=R(y,T);if(m<=c)return!1;var _=T+m;if(_===y.length||_+1<y.length&&d(y,_))return!0}return!1}function M(y,T,c,m,_){if(!y.samplerate){var E=function(A,w,P,B){var x,W,j,$,H,X=navigator.userAgent.toLowerCase(),tt=B,it=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(x=1+((192&w[P+2])>>>6),!((W=(60&w[P+2])>>>2)>it.length-1))return $=(1&w[P+2])<<2,$|=(192&w[P+3])>>>6,S.b.log("manifest codec:"+B+",ADTS data:type:"+x+",sampleingIndex:"+W+"["+it[W]+"Hz],channelConfig:"+$),/firefox/i.test(X)?W>=6?(x=5,H=new Array(4),j=W-3):(x=2,H=new Array(2),j=W):X.indexOf("android")!==-1?(x=2,H=new Array(2),j=W):(x=5,H=new Array(4),B&&(B.indexOf("mp4a.40.29")!==-1||B.indexOf("mp4a.40.5")!==-1)||!B&&W>=6?j=W-3:((B&&B.indexOf("mp4a.40.2")!==-1&&(W>=6&&$===1||/vivaldi/i.test(X))||!B&&$===1)&&(x=2,H=new Array(2)),j=W)),H[0]=x<<3,H[0]|=(14&W)>>1,H[1]|=(1&W)<<7,H[1]|=$<<3,x===5&&(H[1]|=(14&j)>>1,H[2]=(1&j)<<7,H[2]|=8,H[3]=0),{config:H,samplerate:it[W],channelCount:$,codec:"mp4a.40."+x,manifestCodec:tt};A.trigger(z.a.ERROR,{type:V.b.MEDIA_ERROR,details:V.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+W})}(T,c,m,_);y.config=E.config,y.samplerate=E.samplerate,y.channelCount=E.channelCount,y.codec=E.codec,y.manifestCodec=E.manifestCodec,S.b.log("parsed codec:"+y.codec+",rate:"+E.samplerate+",nb channel:"+E.channelCount)}}function I(y){return 9216e4/y}function G(y,T,c,m,_){var E=function(x,W,j,$,H){var X,tt,it=x.length;if(X=u(x,W),tt=R(x,W),(tt-=X)>0&&W+X+tt<=it)return{headerLength:X,frameLength:tt,stamp:j+$*H}}(T,c,m,_,I(y.samplerate));if(E){var A=E.stamp,w=E.headerLength,P=E.frameLength,B={unit:T.subarray(c+w,c+w+P),pts:A,dts:A};return y.samples.push(B),{sample:B,length:P+w}}}var U=J(4),K=function(){function y(c,m,_){this.observer=c,this.config=_,this.remuxer=m}var T=y.prototype;return T.resetInitSegment=function(c,m,_,E){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:m,duration:E,inputTimeScale:9e4}},T.resetTimeStamp=function(){},y.probe=function(c){if(!c)return!1;for(var m=(U.a.getID3Data(c,0)||[]).length,_=c.length;m<_;m++)if(D(c,m))return S.b.log("ADTS sync word found !"),!0;return!1},T.append=function(c,m,_,E){for(var A=this._audioTrack,w=U.a.getID3Data(c,0)||[],P=U.a.getTimeStamp(w),B=Object(Tt.a)(P)?90*P:9e4*m,x=0,W=B,j=c.length,$=w.length,H=[{pts:W,dts:W,data:w}];$<j-1;)if(k(c,$)&&$+5<j){M(A,this.observer,c,$,A.manifestCodec);var X=G(A,c,$,B,x);if(!X){S.b.log("Unable to parse AAC frame");break}$+=X.length,W=X.sample.pts,x++}else U.a.isHeader(c,$)?(w=U.a.getID3Data(c,$),H.push({pts:W,dts:W,data:w}),$+=w.length):$++;this.remuxer.remux(A,{samples:[]},{samples:H,inputTimeScale:9e4},{samples:[]},m,_,E)},T.destroy=function(){},y}(),Y=J(10),rt={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(y,T,c,m,_){if(!(c+24>T.length)){var E=this.parseHeader(T,c);if(E&&c+E.frameLength<=T.length){var A=m+_*(9e4*E.samplesPerFrame/E.sampleRate),w={unit:T.subarray(c,c+E.frameLength),pts:A,dts:A};return y.config=[],y.channelCount=E.channelCount,y.samplerate=E.sampleRate,y.samples.push(w),{sample:w,length:E.frameLength}}}},parseHeader:function(y,T){var c=y[T+1]>>3&3,m=y[T+1]>>1&3,_=y[T+2]>>4&15,E=y[T+2]>>2&3,A=y[T+2]>>1&1;if(c!==1&&_!==0&&_!==15&&E!==3){var w=c===3?3-m:m===3?3:4,P=1e3*rt.BitratesMap[14*w+_-1],B=c===3?0:c===2?1:2,x=rt.SamplingRateMap[3*B+E],W=y[T+3]>>6==3?1:2,j=rt.SamplesCoefficients[c][m],$=rt.BytesInSlot[m],H=8*j*$;return{sampleRate:x,channelCount:W,frameLength:parseInt(j*P/x+A,10)*$,samplesPerFrame:H}}},isHeaderPattern:function(y,T){return y[T]===255&&(224&y[T+1])==224&&(6&y[T+1])!=0},isHeader:function(y,T){return!!(T+1<y.length&&this.isHeaderPattern(y,T))},probe:function(y,T){if(T+1<y.length&&this.isHeaderPattern(y,T)){var c=this.parseHeader(y,T),m=4;c&&c.frameLength&&(m=c.frameLength);var _=T+m;if(_===y.length||_+1<y.length&&this.isHeaderPattern(y,_))return!0}return!1}},ot=rt,et=function(){function y(c){this.data=c,this.bytesAvailable=c.byteLength,this.word=0,this.bitsAvailable=0}var T=y.prototype;return T.loadWord=function(){var c=this.data,m=this.bytesAvailable,_=c.byteLength-m,E=new Uint8Array(4),A=Math.min(4,m);if(A===0)throw new Error("no bytes available");E.set(c.subarray(_,_+A)),this.word=new DataView(E.buffer).getUint32(0),this.bitsAvailable=8*A,this.bytesAvailable-=A},T.skipBits=function(c){var m;this.bitsAvailable>c?(this.word<<=c,this.bitsAvailable-=c):(c-=this.bitsAvailable,c-=(m=c>>3)>>3,this.bytesAvailable-=m,this.loadWord(),this.word<<=c,this.bitsAvailable-=c)},T.readBits=function(c){var m=Math.min(this.bitsAvailable,c),_=this.word>>>32-m;return c>32&&S.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=m,this.bitsAvailable>0?this.word<<=m:this.bytesAvailable>0&&this.loadWord(),(m=c-m)>0&&this.bitsAvailable?_<<m|this.readBits(m):_},T.skipLZ=function(){var c;for(c=0;c<this.bitsAvailable;++c)if(this.word&2147483648>>>c)return this.word<<=c,this.bitsAvailable-=c,c;return this.loadWord(),c+this.skipLZ()},T.skipUEG=function(){this.skipBits(1+this.skipLZ())},T.skipEG=function(){this.skipBits(1+this.skipLZ())},T.readUEG=function(){var c=this.skipLZ();return this.readBits(c+1)-1},T.readEG=function(){var c=this.readUEG();return 1&c?1+c>>>1:-1*(c>>>1)},T.readBoolean=function(){return this.readBits(1)===1},T.readUByte=function(){return this.readBits(8)},T.readUShort=function(){return this.readBits(16)},T.readUInt=function(){return this.readBits(32)},T.skipScalingList=function(c){var m,_=8,E=8;for(m=0;m<c;m++)E!==0&&(E=(_+this.readEG()+256)%256),_=E===0?_:E},T.readSPS=function(){var c,m,_,E,A,w,P,B=0,x=0,W=0,j=0,$=this.readUByte.bind(this),H=this.readBits.bind(this),X=this.readUEG.bind(this),tt=this.readBoolean.bind(this),it=this.skipBits.bind(this),Et=this.skipEG.bind(this),dt=this.skipUEG.bind(this),It=this.skipScalingList.bind(this);if($(),c=$(),H(5),it(3),$(),dt(),c===100||c===110||c===122||c===244||c===44||c===83||c===86||c===118||c===128){var ht=X();if(ht===3&&it(1),dt(),dt(),it(1),tt())for(w=ht!==3?8:12,P=0;P<w;P++)tt()&&It(P<6?16:64)}dt();var bt=X();if(bt===0)X();else if(bt===1)for(it(1),Et(),Et(),m=X(),P=0;P<m;P++)Et();dt(),it(1),_=X(),E=X(),(A=H(1))===0&&it(1),it(1),tt()&&(B=X(),x=X(),W=X(),j=X());var nt=[1,1];if(tt()&&tt())switch($()){case 1:nt=[1,1];break;case 2:nt=[12,11];break;case 3:nt=[10,11];break;case 4:nt=[16,11];break;case 5:nt=[40,33];break;case 6:nt=[24,11];break;case 7:nt=[20,11];break;case 8:nt=[32,11];break;case 9:nt=[80,33];break;case 10:nt=[18,11];break;case 11:nt=[15,11];break;case 12:nt=[64,33];break;case 13:nt=[160,99];break;case 14:nt=[4,3];break;case 15:nt=[3,2];break;case 16:nt=[2,1];break;case 255:nt=[$()<<8|$(),$()<<8|$()]}return{width:Math.ceil(16*(_+1)-2*B-2*x),height:(2-A)*(E+1)*16-(A?2:4)*(W+j),pixelRatio:nt}},T.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},y}(),gt=function(){function y(c,m,_,E){this.decryptdata=_,this.discardEPB=E,this.decrypter=new q.a(c,m,{removePKCS7Padding:!1})}var T=y.prototype;return T.decryptBuffer=function(c,m){this.decrypter.decrypt(c,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,m)},T.decryptAacSample=function(c,m,_,E){var A=c[m].unit,w=A.subarray(16,A.length-A.length%16),P=w.buffer.slice(w.byteOffset,w.byteOffset+w.length),B=this;this.decryptBuffer(P,function(x){x=new Uint8Array(x),A.set(x,16),E||B.decryptAacSamples(c,m+1,_)})},T.decryptAacSamples=function(c,m,_){for(;;m++){if(m>=c.length)return void _();if(!(c[m].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(c,m,_,E),!E)return}}},T.getAvcEncryptedData=function(c){for(var m=16*Math.floor((c.length-48)/160)+16,_=new Int8Array(m),E=0,A=32;A<=c.length-16;A+=160,E+=16)_.set(c.subarray(A,A+16),E);return _},T.getAvcDecryptedUnit=function(c,m){m=new Uint8Array(m);for(var _=0,E=32;E<=c.length-16;E+=160,_+=16)c.set(m.subarray(_,_+16),E);return c},T.decryptAvcSample=function(c,m,_,E,A,w){var P=this.discardEPB(A.data),B=this.getAvcEncryptedData(P),x=this;this.decryptBuffer(B.buffer,function(W){A.data=x.getAvcDecryptedUnit(P,W),w||x.decryptAvcSamples(c,m,_+1,E)})},T.decryptAvcSamples=function(c,m,_,E){for(;;m++,_=0){if(m>=c.length)return void E();for(var A=c[m].units;!(_>=A.length);_++){var w=A[_];if(!(w.data.length<=48||w.type!==1&&w.type!==5)){var P=this.decrypter.isSync();if(this.decryptAvcSample(c,m,_,E,w,P),!P)return}}}},y}(),_t={video:1,audio:2,id3:3,text:4},St=function(){function y(c,m,_,E){this.observer=c,this.config=_,this.typeSupported=E,this.remuxer=m,this.sampleAes=null,this.pmtUnknownTypes={}}var T=y.prototype;return T.setDecryptData=function(c){c!=null&&c.key!=null&&c.method==="SAMPLE-AES"?this.sampleAes=new gt(this.observer,this.config,c,this.discardEPB):this.sampleAes=null},y.probe=function(c){var m=y._syncOffset(c);return!(m<0)&&(m&&S.b.warn("MPEG2-TS detected but first sync word found @ offset "+m+", junk ahead ?"),!0)},y._syncOffset=function(c){for(var m=Math.min(1e3,c.length-564),_=0;_<m;){if(c[_]===71&&c[_+188]===71&&c[_+376]===71)return _;_++}return-1},y.createTrack=function(c,m){return{container:c==="video"||c==="audio"?"video/mp2t":void 0,type:c,id:_t[c],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:c==="video"?0:void 0,isAAC:c==="audio"||void 0,duration:c==="audio"?m:void 0}},T.resetInitSegment=function(c,m,_,E){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=y.createTrack("video",E),this._audioTrack=y.createTrack("audio",E),this._id3Track=y.createTrack("id3",E),this._txtTrack=y.createTrack("text",E),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=_,this._duration=E},T.resetTimeStamp=function(){},T.append=function(c,m,_,E){var A,w,P,B,x,W=c.length,j=!1;this.pmtUnknownTypes={},this.contiguous=_;var $=this.pmtParsed,H=this._avcTrack,X=this._audioTrack,tt=this._id3Track,it=H.pid,Et=X.pid,dt=tt.pid,It=this._pmtId,ht=H.pesData,bt=X.pesData,nt=tt.pesData,Pt=this._parsePAT,Ht=this._parsePMT.bind(this),xt=this._parsePES,kt=this._parseAVCPES.bind(this),Gt=this._parseAACPES.bind(this),st=this._parseMPEGPES.bind(this),Wt=this._parseID3PES.bind(this),Ut=y._syncOffset(c);for(W-=(W+Ut)%188,A=Ut;A<W;A+=188)if(c[A]===71){if(w=!!(64&c[A+1]),P=((31&c[A+1])<<8)+c[A+2],(48&c[A+3])>>4>1){if((B=A+5+c[A+4])===A+188)continue}else B=A+4;switch(P){case it:w&&(ht&&(x=xt(ht))&&kt(x,!1),ht={data:[],size:0}),ht&&(ht.data.push(c.subarray(B,A+188)),ht.size+=A+188-B);break;case Et:w&&(bt&&(x=xt(bt))&&(X.isAAC?Gt(x):st(x)),bt={data:[],size:0}),bt&&(bt.data.push(c.subarray(B,A+188)),bt.size+=A+188-B);break;case dt:w&&(nt&&(x=xt(nt))&&Wt(x),nt={data:[],size:0}),nt&&(nt.data.push(c.subarray(B,A+188)),nt.size+=A+188-B);break;case 0:w&&(B+=c[B]+1),It=this._pmtId=Pt(c,B);break;case It:w&&(B+=c[B]+1);var Dt=Ht(c,B,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);(it=Dt.avc)>0&&(H.pid=it),(Et=Dt.audio)>0&&(X.pid=Et,X.isAAC=Dt.isAAC),(dt=Dt.id3)>0&&(tt.pid=dt),j&&!$&&(S.b.log("reparse from beginning"),j=!1,A=Ut-188),$=this.pmtParsed=!0;break;case 17:case 8191:break;default:j=!0}}else this.observer.trigger(z.a.ERROR,{type:V.b.MEDIA_ERROR,details:V.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});ht&&(x=xt(ht))?(kt(x,!0),H.pesData=null):H.pesData=ht,bt&&(x=xt(bt))?(X.isAAC?Gt(x):st(x),X.pesData=null):(bt&&bt.size&&S.b.log("last AAC PES packet truncated,might overlap between fragments"),X.pesData=bt),nt&&(x=xt(nt))?(Wt(x),tt.pesData=null):tt.pesData=nt,this.sampleAes==null?this.remuxer.remux(X,H,tt,this._txtTrack,m,_,E):this.decryptAndRemux(X,H,tt,this._txtTrack,m,_,E)},T.decryptAndRemux=function(c,m,_,E,A,w,P){if(c.samples&&c.isAAC){var B=this;this.sampleAes.decryptAacSamples(c.samples,0,function(){B.decryptAndRemuxAvc(c,m,_,E,A,w,P)})}else this.decryptAndRemuxAvc(c,m,_,E,A,w,P)},T.decryptAndRemuxAvc=function(c,m,_,E,A,w,P){if(m.samples){var B=this;this.sampleAes.decryptAvcSamples(m.samples,0,0,function(){B.remuxer.remux(c,m,_,E,A,w,P)})}else this.remuxer.remux(c,m,_,E,A,w,P)},T.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},T._parsePAT=function(c,m){return(31&c[m+10])<<8|c[m+11]},T._trackUnknownPmt=function(c,m,_){var E=this.pmtUnknownTypes[c]||0;return E===0&&(this.pmtUnknownTypes[c]=0,m.call(S.b,_)),this.pmtUnknownTypes[c]++,E},T._parsePMT=function(c,m,_,E){var A,w,P={audio:-1,avc:-1,id3:-1,isAAC:!0};for(A=m+3+((15&c[m+1])<<8|c[m+2])-4,m+=12+((15&c[m+10])<<8|c[m+11]);m<A;){switch(w=(31&c[m+1])<<8|c[m+2],c[m]){case 207:if(!E){this._trackUnknownPmt(c[m],S.b.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:P.audio===-1&&(P.audio=w);break;case 21:P.id3===-1&&(P.id3=w);break;case 219:if(!E){this._trackUnknownPmt(c[m],S.b.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:P.avc===-1&&(P.avc=w);break;case 3:case 4:_?P.audio===-1&&(P.audio=w,P.isAAC=!1):this._trackUnknownPmt(c[m],S.b.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(c[m],S.b.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(c[m],S.b.log,"Unknown stream type:"+c[m])}m+=5+((15&c[m+3])<<8|c[m+4])}return P},T._parsePES=function(c){var m,_,E,A,w,P,B,x,W=0,j=c.data;if(!c||c.size===0)return null;for(;j[0].length<19&&j.length>1;){var $=new Uint8Array(j[0].length+j[1].length);$.set(j[0]),$.set(j[1],j[0].length),j[0]=$,j.splice(1,1)}if(((m=j[0])[0]<<16)+(m[1]<<8)+m[2]===1){if((E=(m[4]<<8)+m[5])&&E>c.size-6||(192&(_=m[7])&&(P=536870912*(14&m[9])+4194304*(255&m[10])+16384*(254&m[11])+128*(255&m[12])+(254&m[13])/2,64&_?P-(B=536870912*(14&m[14])+4194304*(255&m[15])+16384*(254&m[16])+128*(255&m[17])+(254&m[18])/2)>54e5&&(S.b.warn(Math.round((P-B)/9e4)+"s delta between PTS and DTS, align them"),P=B):B=P),x=(A=m[8])+9,c.size<=x))return null;c.size-=x,w=new Uint8Array(c.size);for(var H=0,X=j.length;H<X;H++){var tt=(m=j[H]).byteLength;if(x){if(x>tt){x-=tt;continue}m=m.subarray(x),tt-=x,x=0}w.set(m,W),W+=tt}return E&&(E-=A+3),{data:w,pts:P,dts:B,len:E}}return null},T.pushAccesUnit=function(c,m){if(c.units.length&&c.frame){var _=m.samples,E=_.length;if(isNaN(c.pts)){if(!E)return void m.dropped++;var A=_[E-1];c.pts=A.pts,c.dts=A.dts}!this.config.forceKeyFrameOnDiscontinuity||c.key===!0||m.sps&&(E||this.contiguous)?(c.id=E,_.push(c)):m.dropped++}c.debug.length&&S.b.log(c.pts+"/"+c.dts+":"+c.debug)},T._parseAVCPES=function(c,m){var _,E,A,w=this,P=this._avcTrack,B=this._parseAVCNALu(c.data),x=this.avcSample,W=!1,j=this.pushAccesUnit.bind(this),$=function(H,X,tt,it){return{key:H,pts:X,dts:tt,units:[],debug:it}};c.data=null,x&&B.length&&!P.audFound&&(j(x,P),x=this.avcSample=$(!1,c.pts,c.dts,"")),B.forEach(function(H){switch(H.type){case 1:E=!0,x||(x=w.avcSample=$(!0,c.pts,c.dts,"")),x.frame=!0;var X=H.data;if(W&&X.length>4){var tt=new et(X).readSliceType();tt!==2&&tt!==4&&tt!==7&&tt!==9||(x.key=!0)}break;case 5:E=!0,x||(x=w.avcSample=$(!0,c.pts,c.dts,"")),x.key=!0,x.frame=!0;break;case 6:E=!0,(_=new et(w.discardEPB(H.data))).readUByte();for(var it=0,Et=0,dt=!1,It=0;!dt&&_.bytesAvailable>1;){it=0;do it+=It=_.readUByte();while(It===255);Et=0;do Et+=It=_.readUByte();while(It===255);if(it===4&&_.bytesAvailable!==0){if(dt=!0,_.readUByte()===181&&_.readUShort()===49&&_.readUInt()===1195456820&&_.readUByte()===3){var ht=_.readUByte(),bt=31&ht,nt=[ht,_.readUByte()];for(A=0;A<bt;A++)nt.push(_.readUByte()),nt.push(_.readUByte()),nt.push(_.readUByte());w._insertSampleInOrder(w._txtTrack.samples,{type:3,pts:c.pts,bytes:nt})}}else if(it===5&&_.bytesAvailable!==0){if(dt=!0,Et>16){var Pt=[];for(A=0;A<16;A++)Pt.push(_.readUByte().toString(16)),A!==3&&A!==5&&A!==7&&A!==9||Pt.push("-");var Ht=Et-16,xt=new Uint8Array(Ht);for(A=0;A<Ht;A++)xt[A]=_.readUByte();w._insertSampleInOrder(w._txtTrack.samples,{pts:c.pts,payloadType:it,uuid:Pt.join(""),userDataBytes:xt,userData:Object(U.b)(xt.buffer)})}}else if(Et<_.bytesAvailable)for(A=0;A<Et;A++)_.readUByte()}break;case 7:if(E=!0,W=!0,!P.sps){var kt=(_=new et(H.data)).readSPS();P.width=kt.width,P.height=kt.height,P.pixelRatio=kt.pixelRatio,P.sps=[H.data],P.duration=w._duration;var Gt=H.data.subarray(1,4),st="avc1.";for(A=0;A<3;A++){var Wt=Gt[A].toString(16);Wt.length<2&&(Wt="0"+Wt),st+=Wt}P.codec=st}break;case 8:E=!0,P.pps||(P.pps=[H.data]);break;case 9:E=!1,P.audFound=!0,x&&j(x,P),x=w.avcSample=$(!1,c.pts,c.dts,"");break;case 12:E=!1;break;default:E=!1,x&&(x.debug+="unknown NAL "+H.type+" ")}x&&E&&x.units.push(H)}),m&&x&&(j(x,P),this.avcSample=null)},T._insertSampleInOrder=function(c,m){var _=c.length;if(_>0){if(m.pts>=c[_-1].pts)c.push(m);else for(var E=_-1;E>=0;E--)if(m.pts<c[E].pts){c.splice(E,0,m);break}}else c.push(m)},T._getLastNalUnit=function(){var c,m=this.avcSample;if(!m||m.units.length===0){var _=this._avcTrack.samples;m=_[_.length-1]}if(m){var E=m.units;c=E[E.length-1]}return c},T._parseAVCNALu=function(c){var m,_,E,A,w=0,P=c.byteLength,B=this._avcTrack,x=B.naluState||0,W=x,j=[],$=-1;for(x===-1&&($=0,A=31&c[0],x=0,w=1);w<P;)if(m=c[w++],x)if(x!==1)if(m)if(m===1){if($>=0)E={data:c.subarray($,w-x-1),type:A},j.push(E);else{var H=this._getLastNalUnit();if(H&&(W&&w<=4-W&&H.state&&(H.data=H.data.subarray(0,H.data.byteLength-W)),(_=w-x-1)>0)){var X=new Uint8Array(H.data.byteLength+_);X.set(H.data,0),X.set(c.subarray(0,_),H.data.byteLength),H.data=X}}w<P?($=w,A=31&c[w],x=0):x=-1}else x=0;else x=3;else x=m?0:2;else x=m?0:1;if($>=0&&x>=0&&(E={data:c.subarray($,P),type:A,state:x},j.push(E)),j.length===0){var tt=this._getLastNalUnit();if(tt){var it=new Uint8Array(tt.data.byteLength+c.byteLength);it.set(tt.data,0),it.set(c,tt.data.byteLength),tt.data=it}}return B.naluState=x,j},T.discardEPB=function(c){for(var m,_,E=c.byteLength,A=[],w=1;w<E-2;)c[w]===0&&c[w+1]===0&&c[w+2]===3?(A.push(w+2),w+=2):w++;if(A.length===0)return c;m=E-A.length,_=new Uint8Array(m);var P=0;for(w=0;w<m;P++,w++)P===A[0]&&(P++,A.shift()),_[w]=c[P];return _},T._parseAACPES=function(c){var m,_,E,A,w,P,B,x=this._audioTrack,W=c.data,j=c.pts,$=this.aacOverFlow,H=this.aacLastPTS;if($){var X=new Uint8Array($.byteLength+W.byteLength);X.set($,0),X.set(W,$.byteLength),W=X}for(E=0,w=W.length;E<w-1&&!k(W,E);E++);if(!(E&&(E<w-1?(P="AAC PES did not start with ADTS header,offset:"+E,B=!1):(P="no ADTS header found in AAC PES",B=!0),S.b.warn("parsing error:"+P),this.observer.trigger(z.a.ERROR,{type:V.b.MEDIA_ERROR,details:V.a.FRAG_PARSING_ERROR,fatal:B,reason:P}),B))){if(M(x,this.observer,W,E,this.audioCodec),_=0,m=I(x.samplerate),$&&H){var tt=H+m;Math.abs(tt-j)>1&&(S.b.log("AAC: align PTS for overlapping frames by "+Math.round((tt-j)/90)),j=tt)}for(;E<w;){if(k(W,E)){if(E+5<w){var it=G(x,W,E,j,_);if(it){E+=it.length,A=it.sample.pts,_++;continue}}break}E++}$=E<w?W.subarray(E,w):null,this.aacOverFlow=$,this.aacLastPTS=A}},T._parseMPEGPES=function(c){for(var m=c.data,_=m.length,E=0,A=0,w=c.pts;A<_;)if(ot.isHeader(m,A)){var P=ot.appendFrame(this._audioTrack,m,A,w,E);if(!P)break;A+=P.length,E++}else A++},T._parseID3PES=function(c){this._id3Track.samples.push(c)},y}(),ut=function(){function y(c,m,_){this.observer=c,this.config=_,this.remuxer=m}var T=y.prototype;return T.resetInitSegment=function(c,m,_,E){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:m,duration:E,inputTimeScale:9e4}},T.resetTimeStamp=function(){},y.probe=function(c){var m,_,E=U.a.getID3Data(c,0);if(E&&U.a.getTimeStamp(E)!==void 0){for(m=E.length,_=Math.min(c.length-1,m+100);m<_;m++)if(ot.probe(c,m))return S.b.log("MPEG Audio sync word found !"),!0}return!1},T.append=function(c,m,_,E){for(var A=U.a.getID3Data(c,0)||[],w=U.a.getTimeStamp(A),P=w!==void 0?90*w:9e4*m,B=A.length,x=c.length,W=0,j=0,$=this._audioTrack,H=[{pts:P,dts:P,data:A}];B<x;)if(ot.isHeader(c,B)){var X=ot.appendFrame($,c,B,P,W);if(!X)break;B+=X.length,j=X.sample.pts,W++}else U.a.isHeader(c,B)?(A=U.a.getID3Data(c,B),H.push({pts:j,dts:j,data:A}),B+=A.length):B++;this.remuxer.remux($,{samples:[]},{samples:H,inputTimeScale:9e4},{samples:[]},m,_,E)},T.destroy=function(){},y}(),Lt=function(){function y(){}return y.getSilentFrame=function(T,c){switch(T){case"mp4a.40.2":if(c===1)return new Uint8Array([0,200,0,128,35,128]);if(c===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(c===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(c===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(c===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(c===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(c===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(c===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(c===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},y}(),At=Math.pow(2,32)-1,Ct=function(){function y(){}return y.init=function(){var T;for(T in y.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},y.types)y.types.hasOwnProperty(T)&&(y.types[T]=[T.charCodeAt(0),T.charCodeAt(1),T.charCodeAt(2),T.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),m=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);y.HDLR_TYPES={video:c,audio:m};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]);y.STTS=y.STSC=y.STCO=E,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var A=new Uint8Array([105,115,111,109]),w=new Uint8Array([97,118,99,49]),P=new Uint8Array([0,0,0,1]);y.FTYP=y.box(y.types.ftyp,A,P,A,w),y.DINF=y.box(y.types.dinf,y.box(y.types.dref,_))},y.box=function(T){for(var c,m=Array.prototype.slice.call(arguments,1),_=8,E=m.length,A=E;E--;)_+=m[E].byteLength;for((c=new Uint8Array(_))[0]=_>>24&255,c[1]=_>>16&255,c[2]=_>>8&255,c[3]=255&_,c.set(T,4),E=0,_=8;E<A;E++)c.set(m[E],_),_+=m[E].byteLength;return c},y.hdlr=function(T){return y.box(y.types.hdlr,y.HDLR_TYPES[T])},y.mdat=function(T){return y.box(y.types.mdat,T)},y.mdhd=function(T,c){c*=T;var m=Math.floor(c/(At+1)),_=Math.floor(c%(At+1));return y.box(y.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,255&T,m>>24,m>>16&255,m>>8&255,255&m,_>>24,_>>16&255,_>>8&255,255&_,85,196,0,0]))},y.mdia=function(T){return y.box(y.types.mdia,y.mdhd(T.timescale,T.duration),y.hdlr(T.type),y.minf(T))},y.mfhd=function(T){return y.box(y.types.mfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,255&T]))},y.minf=function(T){return T.type==="audio"?y.box(y.types.minf,y.box(y.types.smhd,y.SMHD),y.DINF,y.stbl(T)):y.box(y.types.minf,y.box(y.types.vmhd,y.VMHD),y.DINF,y.stbl(T))},y.moof=function(T,c,m){return y.box(y.types.moof,y.mfhd(T),y.traf(m,c))},y.moov=function(T){for(var c=T.length,m=[];c--;)m[c]=y.trak(T[c]);return y.box.apply(null,[y.types.moov,y.mvhd(T[0].timescale,T[0].duration)].concat(m).concat(y.mvex(T)))},y.mvex=function(T){for(var c=T.length,m=[];c--;)m[c]=y.trex(T[c]);return y.box.apply(null,[y.types.mvex].concat(m))},y.mvhd=function(T,c){c*=T;var m=Math.floor(c/(At+1)),_=Math.floor(c%(At+1)),E=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,255&T,m>>24,m>>16&255,m>>8&255,255&m,_>>24,_>>16&255,_>>8&255,255&_,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return y.box(y.types.mvhd,E)},y.sdtp=function(T){var c,m,_=T.samples||[],E=new Uint8Array(4+_.length);for(m=0;m<_.length;m++)c=_[m].flags,E[m+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return y.box(y.types.sdtp,E)},y.stbl=function(T){return y.box(y.types.stbl,y.stsd(T),y.box(y.types.stts,y.STTS),y.box(y.types.stsc,y.STSC),y.box(y.types.stsz,y.STSZ),y.box(y.types.stco,y.STCO))},y.avc1=function(T){var c,m,_,E=[],A=[];for(c=0;c<T.sps.length;c++)_=(m=T.sps[c]).byteLength,E.push(_>>>8&255),E.push(255&_),E=E.concat(Array.prototype.slice.call(m));for(c=0;c<T.pps.length;c++)_=(m=T.pps[c]).byteLength,A.push(_>>>8&255),A.push(255&_),A=A.concat(Array.prototype.slice.call(m));var w=y.box(y.types.avcC,new Uint8Array([1,E[3],E[4],E[5],255,224|T.sps.length].concat(E).concat([T.pps.length]).concat(A))),P=T.width,B=T.height,x=T.pixelRatio[0],W=T.pixelRatio[1];return y.box(y.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,P>>8&255,255&P,B>>8&255,255&B,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),w,y.box(y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),y.box(y.types.pasp,new Uint8Array([x>>24,x>>16&255,x>>8&255,255&x,W>>24,W>>16&255,W>>8&255,255&W])))},y.esds=function(T){var c=T.config.length;return new Uint8Array([0,0,0,0,3,23+c,0,1,0,4,15+c,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([c]).concat(T.config).concat([6,1,2]))},y.mp4a=function(T){var c=T.samplerate;return y.box(y.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,T.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),y.box(y.types.esds,y.esds(T)))},y.mp3=function(T){var c=T.samplerate;return y.box(y.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,T.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},y.stsd=function(T){return T.type==="audio"?T.isAAC||T.codec!=="mp3"?y.box(y.types.stsd,y.STSD,y.mp4a(T)):y.box(y.types.stsd,y.STSD,y.mp3(T)):y.box(y.types.stsd,y.STSD,y.avc1(T))},y.tkhd=function(T){var c=T.id,m=T.duration*T.timescale,_=T.width,E=T.height,A=Math.floor(m/(At+1)),w=Math.floor(m%(At+1));return y.box(y.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,A>>24,A>>16&255,A>>8&255,255&A,w>>24,w>>16&255,w>>8&255,255&w,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_>>8&255,255&_,0,0,E>>8&255,255&E,0,0]))},y.traf=function(T,c){var m=y.sdtp(T),_=T.id,E=Math.floor(c/(At+1)),A=Math.floor(c%(At+1));return y.box(y.types.traf,y.box(y.types.tfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_])),y.box(y.types.tfdt,new Uint8Array([1,0,0,0,E>>24,E>>16&255,E>>8&255,255&E,A>>24,A>>16&255,A>>8&255,255&A])),y.trun(T,m.length+16+20+8+16+8+8),m)},y.trak=function(T){return T.duration=T.duration||4294967295,y.box(y.types.trak,y.tkhd(T),y.mdia(T))},y.trex=function(T){var c=T.id;return y.box(y.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},y.trun=function(T,c){var m,_,E,A,w,P,B=T.samples||[],x=B.length,W=12+16*x,j=new Uint8Array(W);for(c+=8+W,j.set([0,0,15,1,x>>>24&255,x>>>16&255,x>>>8&255,255&x,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),m=0;m<x;m++)E=(_=B[m]).duration,A=_.size,w=_.flags,P=_.cts,j.set([E>>>24&255,E>>>16&255,E>>>8&255,255&E,A>>>24&255,A>>>16&255,A>>>8&255,255&A,w.isLeading<<2|w.dependsOn,w.isDependedOn<<6|w.hasRedundancy<<4|w.paddingValue<<1|w.isNonSync,61440&w.degradPrio,15&w.degradPrio,P>>>24&255,P>>>16&255,P>>>8&255,255&P],12+16*m);return y.box(y.types.trun,j)},y.initSegment=function(T){y.types||y.init();var c,m=y.moov(T);return(c=new Uint8Array(y.FTYP.byteLength+m.byteLength)).set(y.FTYP),c.set(m,y.FTYP.byteLength),c},y}();function Rt(y,T,c,m){c===void 0&&(c=1),m===void 0&&(m=!1);var _=y*T*c;return m?Math.round(_):_}function mt(y,T){return T===void 0&&(T=!1),Rt(y,1e3,1/9e4,T)}function zt(y,T){return T===void 0&&(T=1),Rt(y,9e4,1/T)}var Jt=zt(10),Ft=zt(.2),de=null;function Ot(y,T){var c;if(T===void 0)return y;for(c=T<y?-8589934592:8589934592;Math.abs(y-T)>4294967296;)y+=c;return y}var wt,ie=function(){function y(c,m,_,E){if(this.observer=c,this.config=m,this.typeSupported=_,this.ISGenerated=!1,de===null){var A=navigator.userAgent.match(/Chrome\/(\d+)/i);de=A?parseInt(A[1]):0}}var T=y.prototype;return T.destroy=function(){},T.resetTimeStamp=function(c){this._initPTS=this._initDTS=c},T.resetInitSegment=function(){this.ISGenerated=!1},T.getVideoStartPts=function(c){var m=!1,_=c.reduce(function(E,A){var w=A.pts-E;return w<-4294967296?(m=!0,Ot(E,A.pts)):w>0?E:A.pts},c[0].pts);return m&&S.b.debug("PTS rollover detected"),_},T.remux=function(c,m,_,E,A,w,P){if(this.ISGenerated||this.generateIS(c,m,A),this.ISGenerated){var B=c.samples.length,x=m.samples.length,W=A,j=A;if(B&&x){var $=this.getVideoStartPts(m.samples),H=(Ot(c.samples[0].pts,$)-$)/m.inputTimeScale;W+=Math.max(0,H),j+=Math.max(0,-H)}if(B){c.timescale||(S.b.warn("regenerate InitSegment as audio detected"),this.generateIS(c,m,A));var X,tt=this.remuxAudio(c,W,w,P);x&&(tt&&(X=tt.endPTS-tt.startPTS),m.timescale||(S.b.warn("regenerate InitSegment as video detected"),this.generateIS(c,m,A)),this.remuxVideo(m,j,w,X))}else if(x){var it=this.remuxVideo(m,j,w,0,P);it&&c.codec&&this.remuxEmptyAudio(c,W,w,it)}}_.samples.length&&this.remuxID3(_,A),E.samples.length&&this.remuxText(E,A),this.observer.trigger(z.a.FRAG_PARSED)},T.generateIS=function(c,m,_){var E,A,w=this.observer,P=c.samples,B=m.samples,x=this.typeSupported,W="audio/mp4",j={},$={tracks:j},H=this._initPTS===void 0;if(H&&(E=A=1/0),c.config&&P.length&&(c.timescale=c.samplerate,S.b.log("audio sampling rate : "+c.samplerate),c.isAAC||(x.mpeg?(W="audio/mpeg",c.codec=""):x.mp3&&(c.codec="mp3")),j.audio={container:W,codec:c.codec,initSegment:!c.isAAC&&x.mpeg?new Uint8Array:Ct.initSegment([c]),metadata:{channelCount:c.channelCount}},H&&(E=A=P[0].pts-Math.round(c.inputTimeScale*_))),m.sps&&m.pps&&B.length){var X=m.inputTimeScale;if(m.timescale=X,j.video={container:"video/mp4",codec:m.codec,initSegment:Ct.initSegment([m]),metadata:{width:m.width,height:m.height}},H){var tt=this.getVideoStartPts(B),it=Math.round(X*_);A=Math.min(A,Ot(B[0].dts,tt)-it),E=Math.min(E,tt-it),this.observer.trigger(z.a.INIT_PTS_FOUND,{initPTS:E})}}else H&&j.audio&&this.observer.trigger(z.a.INIT_PTS_FOUND,{initPTS:E});Object.keys(j).length?(w.trigger(z.a.FRAG_PARSING_INIT_SEGMENT,$),this.ISGenerated=!0,H&&(this._initPTS=E,this._initDTS=A)):w.trigger(z.a.ERROR,{type:V.b.MEDIA_ERROR,details:V.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},T.remuxVideo=function(c,m,_,E){var A,w,P,B,x,W=c.timescale,j=c.samples,$=[],H=j.length,X=this._initPTS,tt=8,it=Number.POSITIVE_INFINITY,Et=Number.NEGATIVE_INFINITY,dt=0,It=!1,ht=this.nextAvcDts;if(H!==0){_||(ht=m*W-(j[0].pts-Ot(j[0].dts,j[0].pts)));for(var bt=0;bt<H;bt++){var nt=j[bt];nt.pts=Ot(nt.pts-X,ht),nt.dts=Ot(nt.dts-X,ht),nt.dts>nt.pts&&(dt=Math.max(Math.min(dt,nt.pts-nt.dts),-1*Ft)),nt.dts<j[bt>0?bt-1:bt].dts&&(It=!0)}It&&j.sort(function(ve,Re){var Be=ve.dts-Re.dts,Ge=ve.pts-Re.pts;return Be||Ge||ve.id-Re.id}),B=j[0].dts,x=j[H-1].dts;var Pt=Math.round((x-B)/(H-1));if(dt<0){if(dt<-2*Pt){S.b.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+mt(-Pt,!0)+" ms");for(var Ht=dt,xt=0;xt<H;xt++)j[xt].dts=Ht=Math.max(Ht,j[xt].pts-Pt),j[xt].pts=Math.max(Ht,j[xt].pts)}else{S.b.warn("PTS < DTS detected in video samples, shifting DTS by "+mt(dt,!0)+" ms to overcome this issue");for(var kt=0;kt<H;kt++)j[kt].dts=j[kt].dts+dt}B=j[0].dts,x=j[H-1].dts}if(_){var Gt=B-ht,st=Gt>Pt;if(st||Gt<-1){st?S.b.warn("AVC: "+mt(Gt,!0)+" ms ("+Gt+"dts) hole between fragments detected, filling it"):S.b.warn("AVC: "+mt(-Gt,!0)+" ms ("+Gt+"dts) overlapping between fragments detected"),B=ht;var Wt=j[0].pts-Gt;j[0].dts=B,j[0].pts=Wt,S.b.log("Video: First PTS/DTS adjusted: "+mt(Wt,!0)+"/"+mt(B,!0)+", delta: "+mt(Gt,!0)+" ms")}}de&&de<75&&(B=Math.max(0,B));for(var Ut=0,Dt=0,re=0;re<H;re++){for(var qt=j[re],Nt=qt.units,Kt=Nt.length,Vt=0,$t=0;$t<Kt;$t++)Vt+=Nt[$t].data.length;Dt+=Vt,Ut+=Kt,qt.length=Vt,qt.dts=Math.max(qt.dts,B),qt.pts=Math.max(qt.pts,qt.dts,0),it=Math.min(qt.pts,it),Et=Math.max(qt.pts,Et)}x=j[H-1].dts;var Yt=Dt+4*Ut+8;try{w=new Uint8Array(Yt)}catch(ve){return void this.observer.trigger(z.a.ERROR,{type:V.b.MUX_ERROR,details:V.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Yt,reason:"fail allocating video mdat "+Yt})}var se=new DataView(w.buffer);se.setUint32(0,Yt),w.set(Ct.types.mdat,4);for(var Xt=0;Xt<H;Xt++){for(var ne,Zt=j[Xt],he=Zt.units,ge=0,ee=0,Fe=he.length;ee<Fe;ee++){var ye=he[ee],we=ye.data,oe=ye.data.byteLength;se.setUint32(tt,oe),tt+=4,w.set(we,tt),tt+=oe,ge+=4+oe}if(Xt<H-1)A=j[Xt+1].dts-Zt.dts;else{var De=this.config,pe=Zt.dts-j[Xt>0?Xt-1:Xt].dts;if(De.stretchShortVideoTrack){var Ue=De.maxBufferHole,Ce=Math.floor(Ue*W),Se=(E?it+E*W:this.nextAudioPts)-Zt.pts;Se>Ce?((A=Se-pe)<0&&(A=pe),S.b.log("It is approximately "+mt(Se,!1)+" ms to the next segment; using duration "+mt(A,!1)+" ms for the last video frame.")):A=pe}else A=pe}ne=Math.round(Zt.pts-Zt.dts),$.push({size:ge,duration:A,cts:ne,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Zt.key?2:1,isNonSync:Zt.key?0:1}})}this.nextAvcDts=x+A;var Ne=c.dropped;if(c.nbNalu=0,c.dropped=0,$.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var _e=$[0].flags;_e.dependsOn=2,_e.isNonSync=0}c.samples=$,P=Ct.moof(c.sequenceNumber++,B,c),c.samples=[];var Oe={data1:P,data2:w,startPTS:it/W,endPTS:(Et+A)/W,startDTS:B/W,endDTS:this.nextAvcDts/W,type:"video",hasAudio:!1,hasVideo:!0,nb:$.length,dropped:Ne};return this.observer.trigger(z.a.FRAG_PARSING_DATA,Oe),Oe}},T.remuxAudio=function(c,m,_,E){var A,w,P,B,x,W,j=c.inputTimeScale,$=c.timescale,H=j/$,X=(c.isAAC?1024:1152)*H,tt=this._initPTS,it=!c.isAAC&&this.typeSupported.mpeg,Et=it?0:8,dt=c.samples,It=[],ht=this.nextAudioPts;if(_|=dt.length&&ht&&(E&&Math.abs(m-ht/j)<.1||Math.abs(dt[0].pts-ht-tt)<20*X),dt.forEach(function(ee){ee.pts=ee.dts=Ot(ee.pts-tt,m*j)}),(dt=dt.filter(function(ee){return ee.pts>=0})).length!==0){if(_||(ht=E?Math.max(0,m*j):dt[0].pts),c.isAAC)for(var bt=this.config.maxAudioFramesDrift,nt=0,Pt=ht;nt<dt.length;){var Ht=dt[nt],xt=Ht.pts,kt=xt-Pt;if(kt<=-bt*X)_||nt>0?(S.b.warn("Dropping 1 audio frame @ "+mt(Pt,!0)/1e3+"s due to "+mt(kt,!0)+" ms overlap."),dt.splice(nt,1)):(S.b.warn("Audio frame @ "+mt(xt,!0)/1e3+"s overlaps nextAudioPts by "+mt(kt,!0)+" ms."),Pt=xt+X,nt++);else if(kt>=bt*X&&kt<Jt&&Pt){var Gt=Math.round(kt/X);S.b.warn("Injecting "+Gt+" audio frames @ "+mt(Pt,!0)/1e3+"s due to "+mt(kt,!0)+" ms gap.");for(var st=0;st<Gt;st++){var Wt=Math.max(Pt,0);(w=Lt.getSilentFrame(c.manifestCodec||c.codec,c.channelCount))||(S.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),w=Ht.unit.subarray()),dt.splice(nt,0,{unit:w,pts:Wt,dts:Wt}),Pt+=X,nt++}Ht.pts=Ht.dts=Pt,Pt+=X,nt++}else Math.abs(kt),Ht.pts=Ht.dts=Pt,Pt+=X,nt++}for(var Ut=dt.length,Dt=0;Ut--;)Dt+=dt[Ut].unit.byteLength;for(var re=0,qt=dt.length;re<qt;re++){var Nt=dt[re],Kt=Nt.unit,Vt=Nt.pts;if(W!==void 0&&A)A.duration=Math.round((Vt-W)/H);else{var $t=Vt-ht,Yt=0;if(_&&c.isAAC&&$t){if($t>0&&$t<Jt)Yt=Math.round((Vt-ht)/X),S.b.log(mt($t,!0)+" ms hole between AAC samples detected,filling it"),Yt>0&&((w=Lt.getSilentFrame(c.manifestCodec||c.codec,c.channelCount))||(w=Kt.subarray()),Dt+=Yt*w.length);else if($t<-12){S.b.log("drop overlapping AAC sample, expected/parsed/delta: "+mt(ht,!0)+" ms / "+mt(Vt,!0)+" ms / "+mt(-$t,!0)+" ms"),Dt-=Kt.byteLength;continue}Vt=ht}if(x=Vt,!(Dt>0))return;Dt+=Et;try{P=new Uint8Array(Dt)}catch(ee){return void this.observer.trigger(z.a.ERROR,{type:V.b.MUX_ERROR,details:V.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Dt,reason:"fail allocating audio mdat "+Dt})}it||(new DataView(P.buffer).setUint32(0,Dt),P.set(Ct.types.mdat,4));for(var se=0;se<Yt;se++)(w=Lt.getSilentFrame(c.manifestCodec||c.codec,c.channelCount))||(S.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),w=Kt.subarray()),P.set(w,Et),Et+=w.byteLength,A={size:w.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},It.push(A)}P.set(Kt,Et);var Xt=Kt.byteLength;Et+=Xt,A={size:Xt,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},It.push(A),W=Vt}var ne=0;if((Ut=It.length)>=2&&(ne=It[Ut-2].duration,A.duration=ne),Ut){this.nextAudioPts=ht=W+H*ne,c.samples=It,B=it?new Uint8Array:Ct.moof(c.sequenceNumber++,x/H,c),c.samples=[];var Zt=x/j,he=ht/j,ge={data1:B,data2:P,startPTS:Zt,endPTS:he,startDTS:Zt,endDTS:he,type:"audio",hasAudio:!0,hasVideo:!1,nb:Ut};return this.observer.trigger(z.a.FRAG_PARSING_DATA,ge),ge}return null}},T.remuxEmptyAudio=function(c,m,_,E){var A=c.inputTimeScale,w=A/(c.samplerate?c.samplerate:A),P=this.nextAudioPts,B=(P!==void 0?P:E.startDTS*A)+this._initDTS,x=E.endDTS*A+this._initDTS,W=1024*w,j=Math.ceil((x-B)/W),$=Lt.getSilentFrame(c.manifestCodec||c.codec,c.channelCount);if(S.b.warn("remux empty Audio"),$){for(var H=[],X=0;X<j;X++){var tt=B+X*W;H.push({unit:$,pts:tt,dts:tt})}c.samples=H,this.remuxAudio(c,m,_)}else S.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},T.remuxID3=function(c,m){var _=c.samples.length;if(_){for(var E=c.inputTimeScale,A=this._initPTS,w=this._initDTS,P=0;P<_;P++){var B=c.samples[P];B.pts=Ot(B.pts-A,m*E)/E,B.dts=Ot(B.dts-w,m*E)/E}this.observer.trigger(z.a.FRAG_PARSING_METADATA,{samples:c.samples}),c.samples=[]}},T.remuxText=function(c,m){var _=c.samples.length,E=c.inputTimeScale,A=this._initPTS;if(_){for(var w=0;w<_;w++){var P=c.samples[w];P.pts=Ot(P.pts-A,m*E)/E}c.samples.sort(function(B,x){return B.pts-x.pts}),this.observer.trigger(z.a.FRAG_PARSING_USERDATA,{samples:c.samples})}c.samples=[]},y}(),ae=function(){function y(c){this.observer=c}var T=y.prototype;return T.destroy=function(){},T.resetTimeStamp=function(){},T.resetInitSegment=function(){},T.remux=function(c,m,_,E,A,w,P,B){var x=this.observer,W="";c&&(W+="audio"),m&&(W+="video"),x.trigger(z.a.FRAG_PARSING_DATA,{data1:B,startPTS:A,startDTS:A,type:W,hasAudio:!!c,hasVideo:!!m,nb:1,dropped:0}),x.trigger(z.a.FRAG_PARSED)},y}(),te=Object(O.a)();try{wt=te.performance.now.bind(te.performance)}catch(y){S.b.debug("Unable to use Performance API on this environment"),wt=te.Date.now}var ce=function(){function y(c,m,_,E){this.observer=c,this.typeSupported=m,this.config=_,this.vendor=E}var T=y.prototype;return T.destroy=function(){var c=this.demuxer;c&&c.destroy()},T.push=function(c,m,_,E,A,w,P,B,x,W,j,$){var H=this;if(c.byteLength>0&&m!=null&&m.key!=null&&m.method==="AES-128"){var X=this.decrypter;X==null&&(X=this.decrypter=new q.a(this.observer,this.config));var tt=wt();X.decrypt(c,m.key.buffer,m.iv.buffer,function(it){var Et=wt();H.observer.trigger(z.a.FRAG_DECRYPTED,{stats:{tstart:tt,tdecrypt:Et}}),H.pushDecrypted(new Uint8Array(it),m,new Uint8Array(_),E,A,w,P,B,x,W,j,$)})}else this.pushDecrypted(new Uint8Array(c),m,new Uint8Array(_),E,A,w,P,B,x,W,j,$)},T.pushDecrypted=function(c,m,_,E,A,w,P,B,x,W,j,$){var H=this.demuxer,X=this.remuxer;if(!H||P||B){for(var tt,it=this.observer,Et=this.typeSupported,dt=this.config,It=[{demux:St,remux:ie},{demux:Y.a,remux:ae},{demux:K,remux:ie},{demux:ut,remux:ie}],ht=0,bt=It.length;ht<bt&&!(tt=It[ht]).demux.probe(c);ht++);if(!tt)return void it.trigger(z.a.ERROR,{type:V.b.MEDIA_ERROR,details:V.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});X&&X instanceof tt.remux||(X=new tt.remux(it,dt,Et,this.vendor)),H&&H instanceof tt.demux||(H=new tt.demux(it,X,dt,Et),this.probe=tt.demux.probe),this.demuxer=H,this.remuxer=X}(P||B)&&(H.resetInitSegment(_,E,A,W),X.resetInitSegment()),P&&(H.resetTimeStamp($),X.resetTimeStamp($)),typeof H.setDecryptData=="function"&&H.setDecryptData(m),H.append(c,w,x,j)},y}();ct.a=ce},function(Mt,ct,J){"use strict";var z=J(0),V=J(1),q=Math.pow(2,32)-1,Tt=function(){function S(d,u){this.observer=d,this.remuxer=u}var O=S.prototype;return O.resetTimeStamp=function(d){this.initPTS=d},O.resetInitSegment=function(d,u,R,k){if(d&&d.byteLength){var D=this.initData=S.parseInitSegment(d);u==null&&(u="mp4a.40.5"),R==null&&(R="avc1.42e01e");var M={};D.audio&&D.video?M.audiovideo={container:"video/mp4",codec:u+","+R,initSegment:k?d:null}:(D.audio&&(M.audio={container:"audio/mp4",codec:u,initSegment:k?d:null}),D.video&&(M.video={container:"video/mp4",codec:R,initSegment:k?d:null})),this.observer.trigger(V.a.FRAG_PARSING_INIT_SEGMENT,{tracks:M})}else u&&(this.audioCodec=u),R&&(this.videoCodec=R)},S.probe=function(d){return S.findBox({data:d,start:0,end:Math.min(d.length,16384)},["moof"]).length>0},S.bin2str=function(d){return String.fromCharCode.apply(null,d)},S.readUint16=function(d,u){d.data&&(u+=d.start,d=d.data);var R=d[u]<<8|d[u+1];return R<0?65536+R:R},S.readUint32=function(d,u){d.data&&(u+=d.start,d=d.data);var R=d[u]<<24|d[u+1]<<16|d[u+2]<<8|d[u+3];return R<0?4294967296+R:R},S.writeUint32=function(d,u,R){d.data&&(u+=d.start,d=d.data),d[u]=R>>24,d[u+1]=R>>16&255,d[u+2]=R>>8&255,d[u+3]=255&R},S.findBox=function(d,u){var R,k,D,M,I,G,U=[];if(d.data?(I=d.start,D=d.end,d=d.data):(I=0,D=d.byteLength),!u.length)return null;for(R=I;R<D;)G=(k=S.readUint32(d,R))>1?R+k:D,S.bin2str(d.subarray(R+4,R+8))===u[0]&&(u.length===1?U.push({data:d,start:R+8,end:G}):(M=S.findBox({data:d,start:R+8,end:G},u.slice(1))).length&&(U=U.concat(M))),R=G;return U},S.parseSegmentIndex=function(d){var u,R=S.findBox(d,["moov"])[0],k=R?R.end:null,D=0,M=S.findBox(d,["sidx"]);if(!M||!M[0])return null;u=[];var I=(M=M[0]).data[0];D=I===0?8:16;var G=S.readUint32(M,D);D+=4,D+=I===0?8:16,D+=2;var U=M.end+0,K=S.readUint16(M,D);D+=2;for(var Y=0;Y<K;Y++){var rt=D,ot=S.readUint32(M,rt);rt+=4;var et=2147483647&ot;if((2147483648&ot)>>>31===1)return void console.warn("SIDX has hierarchical references (not supported)");var gt=S.readUint32(M,rt);rt+=4,u.push({referenceSize:et,subsegmentDuration:gt,info:{duration:gt/G,start:U,end:U+et-1}}),U+=et,D=rt+=4}return{earliestPresentationTime:0,timescale:G,version:I,referencesCount:K,references:u,moovEndOffset:k}},S.parseInitSegment=function(d){var u=[];return S.findBox(d,["moov","trak"]).forEach(function(R){var k=S.findBox(R,["tkhd"])[0];if(k){var D=k.data[k.start],M=D===0?12:20,I=S.readUint32(k,M),G=S.findBox(R,["mdia","mdhd"])[0];if(G){M=(D=G.data[G.start])===0?12:20;var U=S.readUint32(G,M),K=S.findBox(R,["mdia","hdlr"])[0];if(K){var Y={soun:"audio",vide:"video"}[S.bin2str(K.data.subarray(K.start+8,K.start+12))];if(Y){var rt=S.findBox(R,["mdia","minf","stbl","stsd"]);if(rt.length){rt=rt[0];var ot=S.bin2str(rt.data.subarray(rt.start+12,rt.start+16));z.b.log("MP4Demuxer:"+Y+":"+ot+" found")}u[I]={timescale:U,type:Y},u[Y]={timescale:U,id:I}}}}}}),u},S.getStartDTS=function(d,u){var R,k,D;return R=S.findBox(u,["moof","traf"]),k=[].concat.apply([],R.map(function(M){return S.findBox(M,["tfhd"]).map(function(I){var G,U;return G=S.readUint32(I,4),U=d[G].timescale||9e4,S.findBox(M,["tfdt"]).map(function(K){var Y,rt;return Y=K.data[K.start],rt=S.readUint32(K,4),Y===1&&(rt*=Math.pow(2,32),rt+=S.readUint32(K,8)),rt})[0]/U})})),D=Math.min.apply(null,k),isFinite(D)?D:0},S.offsetStartDTS=function(d,u,R){S.findBox(u,["moof","traf"]).map(function(k){return S.findBox(k,["tfhd"]).map(function(D){var M=S.readUint32(D,4),I=d[M].timescale||9e4;S.findBox(k,["tfdt"]).map(function(G){var U=G.data[G.start],K=S.readUint32(G,4);if(U===0)S.writeUint32(G,4,K-R*I);else{K*=Math.pow(2,32),K+=S.readUint32(G,8),K-=R*I,K=Math.max(K,0);var Y=Math.floor(K/(q+1)),rt=Math.floor(K%(q+1));S.writeUint32(G,4,Y),S.writeUint32(G,8,rt)}})})})},O.append=function(d,u,R,k){var D=this.initData;D||(this.resetInitSegment(d,this.audioCodec,this.videoCodec,!1),D=this.initData);var M,I=this.initPTS;if(I===void 0){var G=S.getStartDTS(D,d);this.initPTS=I=G-u,this.observer.trigger(V.a.INIT_PTS_FOUND,{initPTS:I})}S.offsetStartDTS(D,d,I),M=S.getStartDTS(D,d),this.remuxer.remux(D.audio,D.video,null,null,M,R,k,d)},O.destroy=function(){},S}();ct.a=Tt},function(Mt,ct,J){function z(S){var O={};function d(R){if(O[R])return O[R].exports;var k=O[R]={i:R,l:!1,exports:{}};return S[R].call(k.exports,k,k.exports,d),k.l=!0,k.exports}d.m=S,d.c=O,d.i=function(R){return R},d.d=function(R,k,D){d.o(R,k)||Object.defineProperty(R,k,{configurable:!1,enumerable:!0,get:D})},d.r=function(R){Object.defineProperty(R,"__esModule",{value:!0})},d.n=function(R){var k=R&&R.__esModule?function(){return R.default}:function(){return R};return d.d(k,"a",k),k},d.o=function(R,k){return Object.prototype.hasOwnProperty.call(R,k)},d.p="/",d.oe=function(R){throw console.error(R),R};var u=d(d.s=ENTRY_MODULE);return u.default||u}function V(S){return(S+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function q(S,O,d){var u={};u[d]=[];var R=O.toString(),k=R.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!k)return u;for(var D,M=k[1],I=new RegExp("(\\\\n|\\W)"+V(M)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");D=I.exec(R);)D[3]!=="dll-reference"&&u[d].push(D[3]);for(I=new RegExp("\\("+V(M)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");D=I.exec(R);)S[D[2]]||(u[d].push(D[1]),S[D[2]]=J(D[1]).m),u[D[2]]=u[D[2]]||[],u[D[2]].push(D[4]);for(var G,U=Object.keys(u),K=0;K<U.length;K++)for(var Y=0;Y<u[U[K]].length;Y++)G=u[U[K]][Y],isNaN(1*G)||(u[U[K]][Y]=1*u[U[K]][Y]);return u}function Tt(S){return Object.keys(S).reduce(function(O,d){return O||S[d].length>0},!1)}Mt.exports=function(S,O){O=O||{};var d={main:J.m},u=O.all?{main:Object.keys(d.main)}:function(I,G){for(var U={main:[G]},K={main:[]},Y={main:{}};Tt(U);)for(var rt=Object.keys(U),ot=0;ot<rt.length;ot++){var et=rt[ot],gt=U[et].pop();if(Y[et]=Y[et]||{},!Y[et][gt]&&I[et][gt]){Y[et][gt]=!0,K[et]=K[et]||[],K[et].push(gt);for(var _t=q(I,I[et][gt],et),St=Object.keys(_t),ut=0;ut<St.length;ut++)U[St[ut]]=U[St[ut]]||[],U[St[ut]]=U[St[ut]].concat(_t[St[ut]])}}return K}(d,S),R="";Object.keys(u).filter(function(I){return I!=="main"}).forEach(function(I){for(var G=0;u[I][G];)G++;u[I].push(G),d[I][G]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",R=R+"var "+I+" = ("+z.toString().replace("ENTRY_MODULE",JSON.stringify(G))+")({"+u[I].map(function(U){return JSON.stringify(U)+": "+d[I][U].toString()}).join(",")+`});
`}),R=R+"new (("+z.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+u.main.map(function(I){return JSON.stringify(I)+": "+d.main[I].toString()}).join(",")+"}))(self);";var k=new window.Blob([R],{type:"text/javascript"});if(O.bare)return k;var D=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(k),M=new window.Worker(D);return M.objectURL=D,M}},function(Mt,ct,J){"use strict";J.r(ct);var z=J(9),V=J(1),q=J(0),Tt=J(8);ct.default=function(S){var O=new Tt.EventEmitter;O.trigger=function(u){for(var R=arguments.length,k=new Array(R>1?R-1:0),D=1;D<R;D++)k[D-1]=arguments[D];O.emit.apply(O,[u,u].concat(k))},O.off=function(u){for(var R=arguments.length,k=new Array(R>1?R-1:0),D=1;D<R;D++)k[D-1]=arguments[D];O.removeListener.apply(O,[u].concat(k))};var d=function(u,R){S.postMessage({event:u,data:R})};S.addEventListener("message",function(u){var R=u.data;switch(R.cmd){case"init":var k=JSON.parse(R.config);S.demuxer=new z.a(O,R.typeSupported,k,R.vendor),Object(q.a)(k.debug),d("init",null);break;case"demux":S.demuxer.push(R.data,R.decryptdata,R.initSegment,R.audioCodec,R.videoCodec,R.timeOffset,R.discontinuity,R.trackSwitch,R.contiguous,R.duration,R.accurateTimeOffset,R.defaultInitPTS)}}),O.on(V.a.FRAG_DECRYPTED,d),O.on(V.a.FRAG_PARSING_INIT_SEGMENT,d),O.on(V.a.FRAG_PARSED,d),O.on(V.a.ERROR,d),O.on(V.a.FRAG_PARSING_METADATA,d),O.on(V.a.FRAG_PARSING_USERDATA,d),O.on(V.a.INIT_PTS_FOUND,d),O.on(V.a.FRAG_PARSING_DATA,function(u,R){var k=[],D={event:u,data:R};R.data1&&(D.data1=R.data1.buffer,k.push(R.data1.buffer),delete R.data1),R.data2&&(D.data2=R.data2.buffer,k.push(R.data2.buffer),delete R.data2),S.postMessage(D,k)})}},function(Mt,ct,J){"use strict";J.r(ct),J.d(ct,"default",function(){return yr});var z={};J.r(z),J.d(z,"newCue",function(){return Dr});var V,q,Tt=J(6),S=J(2),O=J(3),d=J(1),u=J(0),R={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},k=function(){function g(n){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=n,this.onEvent=this.onEvent.bind(this);for(var a=arguments.length,h=new Array(a>1?a-1:0),r=1;r<a;r++)h[r-1]=arguments[r];this.handledEvents=h,this.useGenericHandler=!0,this.registerListeners()}var l=g.prototype;return l.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},l.onHandlerDestroying=function(){},l.onHandlerDestroyed=function(){},l.isEventHandler=function(){return typeof this.handledEvents=="object"&&this.handledEvents.length&&typeof this.onEvent=="function"},l.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(n){if(R[n])throw new Error("Forbidden event-name: "+n);this.hls.on(n,this.onEvent)},this)},l.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(n){this.hls.off(n,this.onEvent)},this)},l.onEvent=function(n,a){this.onEventGeneric(n,a)},l.onEventGeneric=function(n,a){try{(function(h,r){var i="on"+h.replace("hls","");if(typeof this[i]!="function")throw new Error("Event "+h+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,r)}).call(this,n,a).call()}catch(h){u.b.error("An internal error happened while handling event "+n+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.hls.trigger(d.a.ERROR,{type:S.b.OTHER_ERROR,details:S.a.INTERNAL_EXCEPTION,fatal:!1,event:n,err:h})}},g}();(function(g){g.MANIFEST="manifest",g.LEVEL="level",g.AUDIO_TRACK="audioTrack",g.SUBTITLE_TRACK="subtitleTrack"})(V||(V={})),function(g){g.MAIN="main",g.AUDIO="audio",g.SUBTITLE="subtitle"}(q||(q={}));var D=J(10);function M(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var I,G=function(){function g(h,r){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=h,this.reluri=r}var l,n,a;return l=g,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(Tt.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&M(l.prototype,n),a&&M(l,a),g}();function U(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}(function(g){g.AUDIO="audio",g.VIDEO="video"})(I||(I={}));var K=function(){function g(){var r;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((r={})[I.AUDIO]=!1,r[I.VIDEO]=!1,r),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var l,n,a,h=g.prototype;return h.setByteRange=function(r,i){var s=r.split("@",2),t=[];s.length===1?t[0]=i?i.byteRangeEndOffset:0:t[0]=parseInt(s[1]),t[1]=parseInt(s[0])+t[0],this._byteRange=t},h.addElementaryStream=function(r){this._elementaryStreams[r]=!0},h.hasElementaryStream=function(r){return this._elementaryStreams[r]===!0},h.createInitializationVector=function(r){for(var i=new Uint8Array(16),s=12;s<16;s++)i[s]=r>>8*(15-s)&255;return i},h.setDecryptDataFromLevelKey=function(r,i){var s=r;return r!=null&&r.method&&r.uri&&!r.iv&&((s=new G(r.baseuri,r.reluri)).method=r.method,s.iv=this.createInitializationVector(i)),s},l=g,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(Tt.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(r){this._url=r}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var r=this.sn;typeof r!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&u.b.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),r=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,r)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(O.a)(this.programDateTime))return null;var r=Object(O.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*r}},{key:"encrypted",get:function(){return!(!this.decryptdata||this.decryptdata.uri===null||this.decryptdata.key!==null)}}])&&U(l.prototype,n),a&&U(l,a),g}();function Y(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var rt=function(){function g(h){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=h,this.version=null}var l,n,a;return l=g,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(O.a)(this.fragments[0].programDateTime))}}])&&Y(l.prototype,n),a&&Y(l,a),g}(),ot=/^(\d+)x(\d+)$/,et=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,gt=function(){function g(n){for(var a in typeof n=="string"&&(n=g.parseAttrList(n)),n)n.hasOwnProperty(a)&&(this[a]=n[a])}var l=g.prototype;return l.decimalInteger=function(n){var a=parseInt(this[n],10);return a>Number.MAX_SAFE_INTEGER?1/0:a},l.hexadecimalInteger=function(n){if(this[n]){var a=(this[n]||"0x").slice(2);a=(1&a.length?"0":"")+a;for(var h=new Uint8Array(a.length/2),r=0;r<a.length/2;r++)h[r]=parseInt(a.slice(2*r,2*r+2),16);return h}return null},l.hexadecimalIntegerAsNumber=function(n){var a=parseInt(this[n],16);return a>Number.MAX_SAFE_INTEGER?1/0:a},l.decimalFloatingPoint=function(n){return parseFloat(this[n])},l.enumeratedString=function(n){return this[n]},l.decimalResolution=function(n){var a=ot.exec(this[n]);if(a!==null)return{width:parseInt(a[1],10),height:parseInt(a[2],10)}},g.parseAttrList=function(n){var a,h={};for(et.lastIndex=0;(a=et.exec(n))!==null;){var r=a[2];r.indexOf('"')===0&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),h[a[1]]=r}return h},g}(),_t={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function St(g,l){return MediaSource.isTypeSupported((l||"video")+'/mp4;codecs="'+g+'"')}var ut=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,Lt=/#EXT-X-MEDIA:(.*)/g,At=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ct=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,Rt=/\.(mp4|m4s|m4v|m4a)$/i,mt=function(){function g(){}return g.findGroup=function(l,n){for(var a=0;a<l.length;a++){var h=l[a];if(h.id===n)return h}},g.convertAVC1ToAVCOTI=function(l){var n,a=l.split(".");return a.length>2?(n=a.shift()+".",n+=parseInt(a.shift()).toString(16),n+=("000"+parseInt(a.shift()).toString(16)).substr(-4)):n=l,n},g.resolve=function(l,n){return Tt.buildAbsoluteURL(n,l,{alwaysNormalize:!0})},g.parseMasterPlaylist=function(l,n){var a,h=[],r={},i=!1;function s(p,v){["video","audio"].forEach(function(b){var L=p.filter(function(F){return function(N,Q){var Z=_t[Q];return!!Z&&Z[N.slice(0,4)]===!0}(F,b)});if(L.length){var C=L.filter(function(F){return F.lastIndexOf("avc1",0)===0||F.lastIndexOf("mp4a",0)===0});v[b+"Codec"]=C.length>0?C[0]:L[0],p=p.filter(function(F){return L.indexOf(F)===-1})}}),v.unknownCodecs=p}for(ut.lastIndex=0;(a=ut.exec(l))!=null;)if(a[1]){var t={},e=t.attrs=new gt(a[1]);t.url=g.resolve(a[2],n);var o=e.decimalResolution("RESOLUTION");o&&(t.width=o.width,t.height=o.height),t.bitrate=e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),t.name=e.NAME,s([].concat((e.CODECS||"").split(/[ ,]+/)),t),t.videoCodec&&t.videoCodec.indexOf("avc1")!==-1&&(t.videoCodec=g.convertAVC1ToAVCOTI(t.videoCodec)),h.push(t)}else if(a[3]){var f=new gt(a[3]);f["DATA-ID"]&&(i=!0,r[f["DATA-ID"]]=f)}return{levels:h,sessionData:i?r:null}},g.parseMasterPlaylistMedia=function(l,n,a,h){var r;h===void 0&&(h=[]);var i=[],s=0;for(Lt.lastIndex=0;(r=Lt.exec(l))!==null;){var t=new gt(r[1]);if(t.TYPE===a){var e={attrs:t,id:s++,groupId:t["GROUP-ID"],instreamId:t["INSTREAM-ID"],name:t.NAME||t.LANGUAGE,type:a,default:t.DEFAULT==="YES",autoselect:t.AUTOSELECT==="YES",forced:t.FORCED==="YES",lang:t.LANGUAGE};if(t.URI&&(e.url=g.resolve(t.URI,n)),h.length){var o=g.findGroup(h,e.groupId);e.audioCodec=o?o.codec:h[0].codec}i.push(e)}}return i},g.parseLevelPlaylist=function(l,n,a,h,r){var i,s,t,e=0,o=0,f=new rt(n),p=0,v=null,b=new K,L=null;for(At.lastIndex=0;(i=At.exec(l))!==null;){var C=i[1];if(C){b.duration=parseFloat(C);var F=(" "+i[2]).slice(1);b.title=F||null,b.tagList.push(F?["INF",C,F]:["INF",C])}else if(i[3]){if(Object(O.a)(b.duration)){var N=e++;b.type=h,b.start=o,t&&(b.levelkey=t),b.sn=N,b.level=a,b.cc=p,b.urlId=r,b.baseurl=n,b.relurl=(" "+i[3]).slice(1),zt(b,v),f.fragments.push(b),v=b,o+=b.duration,b=new K}}else if(i[4]){var Q=(" "+i[4]).slice(1);v?b.setByteRange(Q,v):b.setByteRange(Q)}else if(i[5])b.rawProgramDateTime=(" "+i[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),L===null&&(L=f.fragments.length);else{if(!(i=i[0].match(Ct))){u.b.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<i.length&&i[s]===void 0;s++);var Z=(" "+i[s+1]).slice(1),lt=(" "+i[s+2]).slice(1);switch(i[s]){case"#":b.tagList.push(lt?[Z,lt]:[Z]);break;case"PLAYLIST-TYPE":f.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":e=f.startSN=parseInt(Z);break;case"TARGETDURATION":f.targetduration=parseFloat(Z);break;case"VERSION":f.version=parseInt(Z);break;case"EXTM3U":break;case"ENDLIST":f.live=!1;break;case"DIS":p++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":p=parseInt(Z);break;case"KEY":var pt=new gt(Z),vt=pt.enumeratedString("METHOD"),at=pt.URI,Bt=pt.hexadecimalInteger("IV");if((pt.KEYFORMAT||"identity")==="com.apple.streamingkeydelivery"){u.b.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}vt&&(t=new G(n,at),at&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(vt)>=0&&(t.method=vt,t.key=null,t.iv=Bt));break;case"START":var yt=new gt(Z).decimalFloatingPoint("TIME-OFFSET");Object(O.a)(yt)&&(f.startTimeOffset=yt);break;case"MAP":var Qt=new gt(Z);b.relurl=Qt.URI,Qt.BYTERANGE&&b.setByteRange(Qt.BYTERANGE),b.baseurl=n,b.level=a,b.type=h,b.sn="initSegment",f.initSegment=b,(b=new K).rawProgramDateTime=f.initSegment.rawProgramDateTime;break;default:u.b.warn("line parsed but not handled: "+i)}}}return(b=v)&&!b.relurl&&(f.fragments.pop(),o-=b.duration),f.totalduration=o,f.averagetargetduration=o/f.fragments.length,f.endSN=e-1,f.startCC=f.fragments[0]?f.fragments[0].cc:0,f.endCC=p,!f.initSegment&&f.fragments.length&&f.fragments.every(function(fe){return Rt.test(fe.relurl)})&&(u.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(b=new K).relurl=f.fragments[0].relurl,b.baseurl=n,b.level=a,b.type=h,b.sn="initSegment",f.initSegment=b,f.needSidxRanges=!0),L&&function(fe,le){for(var ke=fe[le],Ee=le-1;Ee>=0;Ee--){var ue=fe[Ee];ue.programDateTime=ke.programDateTime-1e3*ue.duration,ke=ue}}(f.fragments,L),f},g}();function zt(g,l){g.rawProgramDateTime?g.programDateTime=Date.parse(g.rawProgramDateTime):l!=null&&l.programDateTime&&(g.programDateTime=l.endProgramDateTime),Object(O.a)(g.programDateTime)||(g.programDateTime=null,g.rawProgramDateTime=null)}var Jt=window.performance,Ft=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,d.a.MANIFEST_LOADING,d.a.LEVEL_LOADING,d.a.AUDIO_TRACK_LOADING,d.a.SUBTITLE_TRACK_LOADING)||this).loaders={},i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n,a.canHaveQualityLevels=function(r){return r!==V.AUDIO_TRACK&&r!==V.SUBTITLE_TRACK},a.mapContextToLevelType=function(r){switch(r.type){case V.AUDIO_TRACK:return q.AUDIO;case V.SUBTITLE_TRACK:return q.SUBTITLE;default:return q.MAIN}},a.getResponseUrl=function(r,i){var s=r.url;return s!==void 0&&s.indexOf("data:")!==0||(s=i.url),s};var h=a.prototype;return h.createInternalLoader=function(r){var i=this.hls.config,s=i.pLoader,t=i.loader,e=new(s||t)(i);return r.loader=e,this.loaders[r.type]=e,e},h.getInternalLoader=function(r){return this.loaders[r.type]},h.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},h.destroyInternalLoaders=function(){for(var r in this.loaders){var i=this.loaders[r];i&&i.destroy(),this.resetInternalLoader(r)}},h.destroy=function(){this.destroyInternalLoaders(),g.prototype.destroy.call(this)},h.onManifestLoading=function(r){this.load({url:r.url,type:V.MANIFEST,level:0,id:null,responseType:"text"})},h.onLevelLoading=function(r){this.load({url:r.url,type:V.LEVEL,level:r.level,id:r.id,responseType:"text"})},h.onAudioTrackLoading=function(r){this.load({url:r.url,type:V.AUDIO_TRACK,level:null,id:r.id,responseType:"text"})},h.onSubtitleTrackLoading=function(r){this.load({url:r.url,type:V.SUBTITLE_TRACK,level:null,id:r.id,responseType:"text"})},h.load=function(r){var i=this.hls.config;u.b.debug("Loading playlist of type "+r.type+", level: "+r.level+", id: "+r.id);var s,t,e,o,f=this.getInternalLoader(r);if(f){var p=f.context;if(p&&p.url===r.url)return u.b.trace("playlist request ongoing"),!1;u.b.warn("aborting previous loader for type: "+r.type),f.abort()}switch(r.type){case V.MANIFEST:s=i.manifestLoadingMaxRetry,t=i.manifestLoadingTimeOut,e=i.manifestLoadingRetryDelay,o=i.manifestLoadingMaxRetryTimeout;break;case V.LEVEL:s=0,o=0,e=0,t=i.levelLoadingTimeOut;break;default:s=i.levelLoadingMaxRetry,t=i.levelLoadingTimeOut,e=i.levelLoadingRetryDelay,o=i.levelLoadingMaxRetryTimeout}f=this.createInternalLoader(r);var v={timeout:t,maxRetry:s,retryDelay:e,maxRetryDelay:o},b={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return u.b.debug("Calling internal loader delegate for URL: "+r.url),f.load(r,v,b),!0},h.loadsuccess=function(r,i,s,t){if(t===void 0&&(t=null),s.isSidxRequest)return this._handleSidxRequest(r,s),void this._handlePlaylistLoaded(r,i,s,t);if(this.resetInternalLoader(s.type),typeof r.data!="string")throw new Error('expected responseType of "text" for PlaylistLoader');var e=r.data;i.tload=Jt.now(),e.indexOf("#EXTM3U")===0?e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(r,i,s,t):this._handleMasterPlaylist(r,i,s,t):this._handleManifestParsingError(r,s,"no EXTM3U delimiter",t)},h.loaderror=function(r,i,s){s===void 0&&(s=null),this._handleNetworkError(i,s,!1,r)},h.loadtimeout=function(r,i,s){s===void 0&&(s=null),this._handleNetworkError(i,s,!0)},h._handleMasterPlaylist=function(r,i,s,t){var e=this.hls,o=r.data,f=a.getResponseUrl(r,s),p=mt.parseMasterPlaylist(o,f),v=p.levels,b=p.sessionData;if(v.length){var L=v.map(function(Z){return{id:Z.attrs.AUDIO,codec:Z.audioCodec}}),C=mt.parseMasterPlaylistMedia(o,f,"AUDIO",L),F=mt.parseMasterPlaylistMedia(o,f,"SUBTITLES"),N=mt.parseMasterPlaylistMedia(o,f,"CLOSED-CAPTIONS");if(C.length){var Q=!1;C.forEach(function(Z){Z.url||(Q=!0)}),Q===!1&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(u.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),C.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}e.trigger(d.a.MANIFEST_LOADED,{levels:v,audioTracks:C,subtitles:F,captions:N,url:f,stats:i,networkDetails:t,sessionData:b})}else this._handleManifestParsingError(r,s,"no level found in manifest",t)},h._handleTrackOrLevelPlaylist=function(r,i,s,t){var e=this.hls,o=s.id,f=s.level,p=s.type,v=a.getResponseUrl(r,s),b=Object(O.a)(o)?o:0,L=Object(O.a)(f)?f:b,C=a.mapContextToLevelType(s),F=mt.parseLevelPlaylist(r.data,v,L,C,b);if(F.tload=i.tload,F.fragments.length){if(p===V.MANIFEST){var N={url:v,details:F};e.trigger(d.a.MANIFEST_LOADED,{levels:[N],audioTracks:[],url:v,stats:i,networkDetails:t,sessionData:null})}if(i.tparsed=Jt.now(),F.needSidxRanges){var Q=F.initSegment.url;this.load({url:Q,isSidxRequest:!0,type:p,level:f,levelDetails:F,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else s.levelDetails=F,this._handlePlaylistLoaded(r,i,s,t)}else e.trigger(d.a.ERROR,{type:S.b.NETWORK_ERROR,details:S.a.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof s.level=="number"?s.level:void 0})},h._handleSidxRequest=function(r,i){if(typeof r.data=="string")throw new Error("sidx request must be made with responseType of array buffer");var s=D.a.parseSegmentIndex(new Uint8Array(r.data));if(s){var t=s.references,e=i.levelDetails;t.forEach(function(o,f){var p=o.info;if(e){var v=e.fragments[f];v.byteRange.length===0&&v.setByteRange(String(1+p.end-p.start)+"@"+String(p.start))}}),e&&e.initSegment.setByteRange(String(s.moovEndOffset)+"@0")}},h._handleManifestParsingError=function(r,i,s,t){this.hls.trigger(d.a.ERROR,{type:S.b.NETWORK_ERROR,details:S.a.MANIFEST_PARSING_ERROR,fatal:!0,url:r.url,reason:s,networkDetails:t})},h._handleNetworkError=function(r,i,s,t){var e,o;s===void 0&&(s=!1),t===void 0&&(t=null),u.b.info("A network error occured while loading a "+r.type+"-type playlist");var f=this.getInternalLoader(r);switch(r.type){case V.MANIFEST:e=s?S.a.MANIFEST_LOAD_TIMEOUT:S.a.MANIFEST_LOAD_ERROR,o=!0;break;case V.LEVEL:e=s?S.a.LEVEL_LOAD_TIMEOUT:S.a.LEVEL_LOAD_ERROR,o=!1;break;case V.AUDIO_TRACK:e=s?S.a.AUDIO_TRACK_LOAD_TIMEOUT:S.a.AUDIO_TRACK_LOAD_ERROR,o=!1;break;default:o=!1}f&&(f.abort(),this.resetInternalLoader(r.type));var p={type:S.b.NETWORK_ERROR,details:e,fatal:o,url:r.url,loader:f,context:r,networkDetails:i};t&&(p.response=t),this.hls.trigger(d.a.ERROR,p)},h._handlePlaylistLoaded=function(r,i,s,t){var e=s.type,o=s.level,f=s.id,p=s.levelDetails;if(p&&p.targetduration)if(a.canHaveQualityLevels(s.type))this.hls.trigger(d.a.LEVEL_LOADED,{details:p,level:o||0,id:f||0,stats:i,networkDetails:t});else switch(e){case V.AUDIO_TRACK:this.hls.trigger(d.a.AUDIO_TRACK_LOADED,{details:p,id:f,stats:i,networkDetails:t});break;case V.SUBTITLE_TRACK:this.hls.trigger(d.a.SUBTITLE_TRACK_LOADED,{details:p,id:f,stats:i,networkDetails:t})}else this._handleManifestParsingError(r,s,"invalid target duration",t)},a}(k),de=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,d.a.FRAG_LOADING)||this).loaders={},i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.destroy=function(){var r=this.loaders;for(var i in r){var s=r[i];s&&s.destroy()}this.loaders={},g.prototype.destroy.call(this)},h.onFragLoading=function(r){var i=r.frag,s=i.type,t=this.loaders,e=this.hls.config,o=e.fLoader,f=e.loader;i.loaded=0;var p,v,b,L=t[s];L&&(u.b.warn("abort previous fragment loader for type: "+s),L.abort()),L=t[s]=i.loader=e.fLoader?new o(e):new f(e),p={url:i.url,frag:i,responseType:"arraybuffer",progressData:!1};var C=i.byteRangeStartOffset,F=i.byteRangeEndOffset;Object(O.a)(C)&&Object(O.a)(F)&&(p.rangeStart=C,p.rangeEnd=F),v={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},b={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},L.load(p,v,b)},h.loadsuccess=function(r,i,s,t){t===void 0&&(t=null);var e=r.data,o=s.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(d.a.FRAG_LOADED,{payload:e,frag:o,stats:i,networkDetails:t})},h.loaderror=function(r,i,s){s===void 0&&(s=null);var t=i.frag,e=t.loader;e&&e.abort(),this.loaders[t.type]=void 0,this.hls.trigger(d.a.ERROR,{type:S.b.NETWORK_ERROR,details:S.a.FRAG_LOAD_ERROR,fatal:!1,frag:i.frag,response:r,networkDetails:s})},h.loadtimeout=function(r,i,s){s===void 0&&(s=null);var t=i.frag,e=t.loader;e&&e.abort(),this.loaders[t.type]=void 0,this.hls.trigger(d.a.ERROR,{type:S.b.NETWORK_ERROR,details:S.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i.frag,networkDetails:s})},h.loadprogress=function(r,i,s,t){t===void 0&&(t=null);var e=i.frag;e.loaded=r.loaded,this.hls.trigger(d.a.FRAG_LOAD_PROGRESS,{frag:e,stats:r,networkDetails:t})},a}(k),Ot=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,d.a.KEY_LOADING)||this).loaders={},i.decryptkey=null,i.decrypturl=null,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.destroy=function(){for(var r in this.loaders){var i=this.loaders[r];i&&i.destroy()}this.loaders={},g.prototype.destroy.call(this)},h.onKeyLoading=function(r){var i=r.frag,s=i.type,t=this.loaders[s];if(i.decryptdata){var e=i.decryptdata.uri;if(e!==this.decrypturl||this.decryptkey===null){var o=this.hls.config;if(t&&(u.b.warn("abort previous key loader for type:"+s),t.abort()),!e)return void u.b.warn("key uri is falsy");i.loader=this.loaders[s]=new o.loader(o),this.decrypturl=e,this.decryptkey=null;var f={url:e,frag:i,responseType:"arraybuffer"},p={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.loader.load(f,p,v)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(d.a.KEY_LOADED,{frag:i}))}else u.b.warn("Missing decryption data on fragment in onKeyLoading")},h.loadsuccess=function(r,i,s){var t=s.frag;t.decryptdata?(this.decryptkey=t.decryptdata.key=new Uint8Array(r.data),t.loader=void 0,delete this.loaders[t.type],this.hls.trigger(d.a.KEY_LOADED,{frag:t})):u.b.error("after key load, decryptdata unset")},h.loaderror=function(r,i){var s=i.frag,t=s.loader;t&&t.abort(),delete this.loaders[s.type],this.hls.trigger(d.a.ERROR,{type:S.b.NETWORK_ERROR,details:S.a.KEY_LOAD_ERROR,fatal:!1,frag:s,response:r})},h.loadtimeout=function(r,i){var s=i.frag,t=s.loader;t&&t.abort(),delete this.loaders[s.type],this.hls.trigger(d.a.ERROR,{type:S.b.NETWORK_ERROR,details:S.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:s})},a}(k),wt="NOT_LOADED",ie="APPENDING",ae="PARTIAL",te="OK",ce=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,d.a.BUFFER_APPENDED,d.a.FRAG_BUFFERED,d.a.FRAG_LOADED)||this).bufferPadding=.2,i.fragments=Object.create(null),i.timeRanges=Object.create(null),i.config=r.config,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,k.prototype.destroy.call(this),g.prototype.destroy.call(this)},h.getBufferedFrag=function(r,i){var s=this.fragments,t=Object.keys(s).filter(function(o){var f=s[o];if(f.body.type!==i||!f.buffered)return!1;var p=f.body;return p.startPTS<=r&&r<=p.endPTS});if(t.length===0)return null;var e=t.pop();return s[e].body},h.detectEvictedFragments=function(r,i){var s=this;Object.keys(this.fragments).forEach(function(t){var e=s.fragments[t];if(e&&e.buffered){var o=e.range[r];if(o)for(var f=o.time,p=0;p<f.length;p++){var v=f[p];if(!s.isTimeBuffered(v.startPTS,v.endPTS,i)){s.removeFragment(e.body);break}}}})},h.detectPartialFragments=function(r){var i=this,s=this.getFragmentKey(r),t=this.fragments[s];t&&(t.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){if(r.hasElementaryStream(e)){var o=i.timeRanges[e];t.range[e]=i.getBufferedTimes(r.startPTS,r.endPTS,o)}}))},h.getBufferedTimes=function(r,i,s){for(var t,e,o=[],f=!1,p=0;p<s.length;p++){if(t=s.start(p)-this.bufferPadding,e=s.end(p)+this.bufferPadding,r>=t&&i<=e){o.push({startPTS:Math.max(r,s.start(p)),endPTS:Math.min(i,s.end(p))});break}if(r<e&&i>t)o.push({startPTS:Math.max(r,s.start(p)),endPTS:Math.min(i,s.end(p))}),f=!0;else if(i<=t)break}return{time:o,partial:f}},h.getFragmentKey=function(r){return r.type+"_"+r.level+"_"+r.urlId+"_"+r.sn},h.getPartialFragment=function(r){var i,s,t,e=this,o=null,f=0;return Object.keys(this.fragments).forEach(function(p){var v=e.fragments[p];e.isPartial(v)&&(s=v.body.startPTS-e.bufferPadding,t=v.body.endPTS+e.bufferPadding,r>=s&&r<=t&&(i=Math.min(r-s,t-r),f<=i&&(o=v.body,f=i)))}),o},h.getState=function(r){var i=this.getFragmentKey(r),s=this.fragments[i],t=wt;return s!==void 0&&(t=s.buffered?this.isPartial(s)===!0?ae:te:ie),t},h.isPartial=function(r){return r.buffered===!0&&(r.range.video!==void 0&&r.range.video.partial===!0||r.range.audio!==void 0&&r.range.audio.partial===!0)},h.isTimeBuffered=function(r,i,s){for(var t,e,o=0;o<s.length;o++){if(t=s.start(o)-this.bufferPadding,e=s.end(o)+this.bufferPadding,r>=t&&i<=e)return!0;if(i<=t)return!1}return!1},h.onFragLoaded=function(r){var i=r.frag;Object(O.a)(i.sn)&&!i.bitrateTest&&(this.fragments[this.getFragmentKey(i)]={body:i,range:Object.create(null),buffered:!1})},h.onBufferAppended=function(r){var i=this;this.timeRanges=r.timeRanges,Object.keys(this.timeRanges).forEach(function(s){var t=i.timeRanges[s];i.detectEvictedFragments(s,t)})},h.onFragBuffered=function(r){this.detectPartialFragments(r.frag)},h.hasFragment=function(r){var i=this.getFragmentKey(r);return this.fragments[i]!==void 0},h.removeFragment=function(r){var i=this.getFragmentKey(r);delete this.fragments[i]},h.removeAllFragments=function(){this.fragments=Object.create(null)},a}(k),y={search:function(g,l){for(var n=0,a=g.length-1,h=null,r=null;n<=a;){var i=l(r=g[h=(n+a)/2|0]);if(i>0)n=h+1;else{if(!(i<0))return r;a=h-1}}return null}},T=function(){function g(){}return g.isBuffered=function(l,n){try{if(l){for(var a=l.buffered,h=0;h<a.length;h++)if(n>=a.start(h)&&n<=a.end(h))return!0}}catch(r){}return!1},g.bufferInfo=function(l,n,a){try{if(l){var h,r=l.buffered,i=[];for(h=0;h<r.length;h++)i.push({start:r.start(h),end:r.end(h)});return this.bufferedInfo(i,n,a)}}catch(s){}return{len:0,start:n,end:n,nextStart:void 0}},g.bufferedInfo=function(l,n,a){l.sort(function(L,C){var F=L.start-C.start;return F||C.end-L.end});var h=[];if(a)for(var r=0;r<l.length;r++){var i=h.length;if(i){var s=h[i-1].end;l[r].start-s<a?l[r].end>s&&(h[i-1].end=l[r].end):h.push(l[r])}else h.push(l[r])}else h=l;for(var t,e=0,o=n,f=n,p=0;p<h.length;p++){var v=h[p].start,b=h[p].end;if(n+a>=v&&n<b)o=v,e=(f=b)-n;else if(n+a<v){t=v;break}}return{len:e,start:o,end:f,nextStart:t}},g}(),c=J(8),m=J(11),_=J(9);function E(){return window.MediaSource||window.WebKitMediaSource}var A=J(5),w=function(g){var l,n;function a(){return g.apply(this,arguments)||this}return n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n,a.prototype.trigger=function(h){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];this.emit.apply(this,[h,h].concat(i))},a}(c.EventEmitter),P=Object(A.a)(),B=E()||{isTypeSupported:function(){return!1}},x=function(){function g(n,a){var h=this;this.hls=n,this.id=a;var r=this.observer=new w,i=n.config,s=function(f,p){(p=p||{}).frag=h.frag,p.id=h.id,n.trigger(f,p)};r.on(d.a.FRAG_DECRYPTED,s),r.on(d.a.FRAG_PARSING_INIT_SEGMENT,s),r.on(d.a.FRAG_PARSING_DATA,s),r.on(d.a.FRAG_PARSED,s),r.on(d.a.ERROR,s),r.on(d.a.FRAG_PARSING_METADATA,s),r.on(d.a.FRAG_PARSING_USERDATA,s),r.on(d.a.INIT_PTS_FOUND,s);var t={mp4:B.isTypeSupported("video/mp4"),mpeg:B.isTypeSupported("audio/mpeg"),mp3:B.isTypeSupported('audio/mp4; codecs="mp3"')},e=navigator.vendor;if(i.enableWorker&&typeof Worker!="undefined"){var o;u.b.log("demuxing in webworker");try{o=this.w=m(12),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(f){n.trigger(d.a.ERROR,{type:S.b.OTHER_ERROR,details:S.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:f.message+" ("+f.filename+":"+f.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:t,vendor:e,id:a,config:JSON.stringify(i)})}catch(f){u.b.warn("Error in worker:",f),u.b.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&P.URL.revokeObjectURL(o.objectURL),this.demuxer=new _.a(r,t,i,e),this.w=void 0}}else this.demuxer=new _.a(r,t,i,e)}var l=g.prototype;return l.destroy=function(){var n=this.w;if(n)n.removeEventListener("message",this.onwmsg),n.terminate(),this.w=null;else{var a=this.demuxer;a&&(a.destroy(),this.demuxer=null)}var h=this.observer;h&&(h.removeAllListeners(),this.observer=null)},l.push=function(n,a,h,r,i,s,t,e){var o=this.w,f=Object(O.a)(i.startPTS)?i.startPTS:i.start,p=i.decryptdata,v=this.frag,b=!(v&&i.cc===v.cc),L=!(v&&i.level===v.level),C=v&&i.sn===v.sn+1,F=!L&&C;if(b&&u.b.log(this.id+":discontinuity detected"),L&&u.b.log(this.id+":switch detected"),this.frag=i,o)o.postMessage({cmd:"demux",data:n,decryptdata:p,initSegment:a,audioCodec:h,videoCodec:r,timeOffset:f,discontinuity:b,trackSwitch:L,contiguous:F,duration:s,accurateTimeOffset:t,defaultInitPTS:e},n instanceof ArrayBuffer?[n]:[]);else{var N=this.demuxer;N&&N.push(n,p,a,h,r,f,b,L,F,s,t,e)}},l.onWorkerMessage=function(n){var a=n.data,h=this.hls;switch(a.event){case"init":P.URL.revokeObjectURL(this.w.objectURL);break;case d.a.FRAG_PARSING_DATA:a.data.data1=new Uint8Array(a.data1),a.data2&&(a.data.data2=new Uint8Array(a.data2));default:a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,h.trigger(a.event,a.data)}},g}();function W(g,l,n){switch(l){case"audio":g.audioGroupIds||(g.audioGroupIds=[]),g.audioGroupIds.push(n);break;case"text":g.textGroupIds||(g.textGroupIds=[]),g.textGroupIds.push(n)}}function j(g,l,n){var a=g[l],h=g[n],r=h.startPTS;if(Object(O.a)(r))n>l?(a.duration=r-a.start,a.duration<0&&u.b.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(h.duration=a.start-r,h.duration<0&&u.b.warn("negative duration computed for frag "+h.sn+",level "+h.level+", there should be some duration drift between playlist and fragment!"));else if(n>l){var i=a.cc===h.cc;h.start=a.start+(i&&a.minEndPTS?a.minEndPTS-a.start:a.duration)}else h.start=Math.max(a.start-h.duration,0)}function $(g,l,n,a,h,r){var i=n,s=a;if(Object(O.a)(l.startPTS)){var t=Math.abs(l.startPTS-n);Object(O.a)(l.deltaPTS)?l.deltaPTS=Math.max(t,l.deltaPTS):l.deltaPTS=t,i=Math.max(n,l.startPTS),n=Math.min(n,l.startPTS),s=Math.min(a,l.endPTS),a=Math.max(a,l.endPTS),h=Math.min(h,l.startDTS),r=Math.max(r,l.endDTS)}var e=n-l.start;l.start=l.startPTS=n,l.maxStartPTS=i,l.endPTS=a,l.minEndPTS=s,l.startDTS=h,l.endDTS=r,l.duration=a-n;var o,f,p,v=l.sn;if(!g||v<g.startSN||v>g.endSN)return 0;for(o=v-g.startSN,(f=g.fragments)[o]=l,p=o;p>0;p--)j(f,p,p-1);for(p=o;p<f.length-1;p++)j(f,p,p+1);return g.PTSKnown=!0,e}function H(g,l){l.initSegment&&g.initSegment&&(l.initSegment=g.initSegment);var n,a=0;if(X(g,l,function(i,s){a=i.cc-s.cc,Object(O.a)(i.startPTS)&&(s.start=s.startPTS=i.startPTS,s.endPTS=i.endPTS,s.duration=i.duration,s.backtracked=i.backtracked,s.dropped=i.dropped,n=s),l.PTSKnown=!0}),l.PTSKnown){if(a){u.b.log("discontinuity sliding from playlist, take drift into account");for(var h=l.fragments,r=0;r<h.length;r++)h[r].cc+=a}n?$(l,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(i,s){var t=s.startSN-i.startSN,e=i.fragments,o=s.fragments;if(!(t<0||t>e.length))for(var f=0;f<o.length;f++)o[f].start+=e[t].start}(g,l),l.PTSKnown=g.PTSKnown}}function X(g,l,n){if(g&&l)for(var a=Math.max(g.startSN,l.startSN)-l.startSN,h=Math.min(g.endSN,l.endSN)-l.startSN,r=l.startSN-g.startSN,i=a;i<=h;i++){var s=g.fragments[r+i],t=l.fragments[i];if(!s||!t)break;n(s,t,i)}}function tt(g,l,n){var a=1e3*(l.averagetargetduration?l.averagetargetduration:l.targetduration),h=a/2;return g&&l.endSN===g.endSN&&(a=h),n&&(a=Math.max(h,a-(window.performance.now()-n))),Math.round(a)}var it={toString:function(g){for(var l="",n=g.length,a=0;a<n;a++)l+="["+g.start(a).toFixed(3)+","+g.end(a).toFixed(3)+"]";return l}};function Et(g,l){l.fragments.forEach(function(n){if(n){var a=n.start+g;n.start=n.startPTS=a,n.endPTS=a+n.duration}}),l.PTSKnown=!0}function dt(g,l,n){(function(a,h,r){if(function(s,t,e){var o=!1;return t&&t.details&&e&&(e.endCC>e.startCC||s&&s.cc<e.startCC)&&(o=!0),o}(a,r,h)){var i=function(s,t){var e=s.fragments,o=t.fragments;if(o.length&&e.length){var f=function(p,v){for(var b=null,L=0;L<p.length;L+=1){var C=p[L];if(C&&C.cc===v){b=C;break}}return b}(e,o[0].cc);if(f&&(!f||f.startPTS))return f;u.b.log("No frag in previous level to align on")}else u.b.log("No fragments to align")}(r.details,h);i&&(u.b.log("Adjusting PTS using last level due to CC increase within current level"),Et(i.start,h))}})(g,n,l),!n.PTSKnown&&l&&function(a,h){if(h&&h.fragments.length){if(!a.hasProgramDateTime||!h.hasProgramDateTime)return;var r=h.fragments[0].programDateTime,i=(a.fragments[0].programDateTime-r)/1e3+h.fragments[0].start;Object(O.a)(i)&&(u.b.log("adjusting PTS using programDateTime delta, sliding:"+i.toFixed(3)),Et(i,a))}}(n,l.details)}function It(g,l,n){if(l===null||!Array.isArray(g)||!g.length||!Object(O.a)(l)||l<(g[0].programDateTime||0)||l>=(g[g.length-1].endProgramDateTime||0))return null;n=n||0;for(var a=0;a<g.length;++a){var h=g[a];if(nt(l,n,h))return h}return null}function ht(g,l,n,a){n===void 0&&(n=0),a===void 0&&(a=0);var h=null;if(g?h=l[g.sn-l[0].sn+1]:n===0&&l[0].start===0&&(h=l[0]),h&&bt(n,a,h)===0)return h;var r=y.search(l,bt.bind(null,n,a));return r||h}function bt(g,l,n){g===void 0&&(g=0),l===void 0&&(l=0);var a=Math.min(l,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-a<=g?1:n.start-a>g&&n.start?-1:0}function nt(g,l,n){var a=1e3*Math.min(l,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-a>g}var Pt=function(){function g(n,a,h,r){this.config=n,this.media=a,this.fragmentTracker=h,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var l=g.prototype;return l.poll=function(n){var a=this.config,h=this.media,r=this.stalled,i=h.currentTime,s=h.seeking,t=this.seeking&&!s,e=!this.seeking&&s;if(this.seeking=s,i===n){if((e||t)&&(this.stalled=null),!h.paused&&!h.ended&&h.playbackRate!==0&&h.buffered.length){var o=T.bufferInfo(h,i,0),f=o.len>0,p=o.nextStart||0;if(f||p){if(s){var v=o.len>2,b=!p||p-i>2&&!this.fragmentTracker.getPartialFragment(i);if(v||b)return;this.moved=!1}if(!this.moved&&this.stalled){var L=Math.max(p,o.start||0)-i;if(L>0&&L<=2)return void this._trySkipBufferHole(null)}var C=self.performance.now();if(r!==null){var F=C-r;!s&&F>=250&&this._reportStall(o.len);var N=T.bufferInfo(h,i,a.maxBufferHole);this._tryFixBufferStall(N,F)}else this.stalled=C}}}else if(this.moved=!0,r!==null){if(this.stallReported){var Q=self.performance.now()-r;u.b.warn("playback not stuck anymore @"+i+", after "+Math.round(Q)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},l._tryFixBufferStall=function(n,a){var h=this.config,r=this.fragmentTracker,i=this.media.currentTime,s=r.getPartialFragment(i);s&&this._trySkipBufferHole(s)||n.len>h.maxBufferHole&&a>1e3*h.highBufferWatchdogPeriod&&(u.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},l._reportStall=function(n){var a=this.hls,h=this.media;this.stallReported||(this.stallReported=!0,u.b.warn("Playback stalling at @"+h.currentTime+" due to low buffer (buffer="+n+")"),a.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:n}))},l._trySkipBufferHole=function(n){for(var a=this.config,h=this.hls,r=this.media,i=r.currentTime,s=0,t=0;t<r.buffered.length;t++){var e=r.buffered.start(t);if(i+a.maxBufferHole>=s&&i<e){var o=Math.max(e+.05,r.currentTime+.1);return u.b.warn("skipping hole, adjusting currentTime from "+i+" to "+o),this.moved=!0,this.stalled=null,r.currentTime=o,n&&h.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+o,frag:n}),o}s=r.buffered.end(t)}return 0},l._tryNudgeBuffer=function(){var n=this.config,a=this.hls,h=this.media,r=h.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<n.nudgeMaxRetry){var s=r+i*n.nudgeOffset;u.b.warn("Nudging 'currentTime' from "+r+" to "+s),h.currentTime=s,a.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else u.b.error("Playhead still not moving while enough data buffered @"+r+" after "+n.nudgeMaxRetry+" nudges"),a.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.BUFFER_STALLED_ERROR,fatal:!0})},g}();function Ht(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}var xt=function(g){var l,n;function a(r){for(var i,s=arguments.length,t=new Array(s>1?s-1:0),e=1;e<s;e++)t[e-1]=arguments[e];return(i=g.call.apply(g,[this,r].concat(t))||this)._boundTick=void 0,i._tickTimer=null,i._tickInterval=null,i._tickCallCount=0,i._boundTick=i.tick.bind(Ht(i)),i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},h.hasInterval=function(){return!!this._tickInterval},h.hasNextTick=function(){return!!this._tickTimer},h.setInterval=function(r){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,r),!0)},h.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},h.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},h.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},h.doTick=function(){},a}(k),kt="STOPPED",Gt="STARTING",st="IDLE",Wt="PAUSED",Ut="KEY_LOADING",Dt="FRAG_LOADING",re="FRAG_LOADING_WAITING_RETRY",qt="WAITING_TRACK",Nt="PARSING",Kt="PARSED",Vt="BUFFER_FLUSHING",$t="ENDED",Yt="ERROR",se="WAITING_INIT_PTS",Xt="WAITING_LEVEL",ne=function(g){var l,n;function a(){return g.apply(this,arguments)||this}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.doTick=function(){},h.startLoad=function(){},h.stopLoad=function(){var r=this.fragCurrent;r&&(r.loader&&r.loader.abort(),this.fragmentTracker.removeFragment(r)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=kt},h._streamEnded=function(r,i){var s=this.fragCurrent,t=this.fragmentTracker;if(!i.live&&s&&!s.backtracked&&s.sn===i.endSN&&!r.nextStart){var e=t.getState(s);return e===ae||e===te}return!1},h.onMediaSeeking=function(){var r=this.config,i=this.media,s=this.mediaBuffer,t=this.state,e=i?i.currentTime:null,o=T.bufferInfo(s||i,e,this.config.maxBufferHole);if(u.b.log("media seeking to "+(Object(O.a)(e)?e.toFixed(3):e)),t===Dt){var f=this.fragCurrent;if(o.len===0&&f){var p=r.maxFragLookUpTolerance,v=f.start-p,b=f.start+f.duration+p;e<v||e>b?(f.loader&&(u.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=st):u.b.log("seeking outside of buffer but within currently loaded fragment range")}}else t===$t&&(o.len===0&&(this.fragPrevious=null,this.fragCurrent=null),this.state=st);i&&(this.lastCurrentTime=e),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},h.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},h.onHandlerDestroying=function(){this.stopLoad(),g.prototype.onHandlerDestroying.call(this)},h.onHandlerDestroyed=function(){this.state=kt,this.fragmentTracker=null},h.computeLivePosition=function(r,i){var s=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*i.targetduration;return r+Math.max(0,i.totalduration-s)},a}(xt);function Zt(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var he,ge=function(g){var l,n;function a(t,e){var o;return(o=g.call(this,t,d.a.MEDIA_ATTACHED,d.a.MEDIA_DETACHING,d.a.MANIFEST_LOADING,d.a.MANIFEST_PARSED,d.a.LEVEL_LOADED,d.a.LEVELS_UPDATED,d.a.KEY_LOADED,d.a.FRAG_LOADED,d.a.FRAG_LOAD_EMERGENCY_ABORTED,d.a.FRAG_PARSING_INIT_SEGMENT,d.a.FRAG_PARSING_DATA,d.a.FRAG_PARSED,d.a.ERROR,d.a.AUDIO_TRACK_SWITCHING,d.a.AUDIO_TRACK_SWITCHED,d.a.BUFFER_CREATED,d.a.BUFFER_APPENDED,d.a.BUFFER_FLUSHED)||this).fragmentTracker=e,o.config=t.config,o.audioCodecSwap=!1,o._state=kt,o.stallReported=!1,o.gapController=null,o.altAudio=!1,o.audioOnly=!1,o.bitrateTest=!1,o}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var f=o.startLevel;f===-1&&(o.config.testBandwidth?(f=0,this.bitrateTest=!0):f=o.nextAutoLevel),this.level=o.nextLoadLevel=f,this.loadedmetadata=!1}e>0&&t===-1&&(u.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=st,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=kt},s.stopLoad=function(){this.forceStartLoad=!1,g.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case Vt:this.fragLoadError=0;break;case st:this._doTickIdle();break;case Xt:var t=this.levels[this.level];t&&t.details&&(this.state=st);break;case re:var e=window.performance.now(),o=this.retryDate;(!o||e>=o||this.media&&this.media.seeking)&&(u.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=st)}this._checkBuffer(),this._checkFragmentChanged()},s._doTickIdle=function(){var t=this.hls,e=t.config,o=this.media;if(this.levelLastLoaded!==void 0&&(o||!this.startFragRequested&&e.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var f;f=this.loadedmetadata?o.currentTime:this.nextLoadPosition;var p=t.nextLoadLevel,v=this.levels[p];if(v){var b,L=v.bitrate;b=L?Math.max(8*e.maxBufferSize/L,e.maxBufferLength):e.maxBufferLength,b=Math.min(b,e.maxMaxBufferLength);var C=f<e.maxBufferHole?Math.max(2,e.maxBufferHole):e.maxBufferHole,F=T.bufferInfo(this.mediaBuffer?this.mediaBuffer:o,f,C),N=F.len;if(!(N>=b)){u.b.trace("buffer length of "+N.toFixed(3)+" is below max of "+b.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=p;var Q=v.details;if(!Q||Q.live&&this.levelLastLoaded!==p)this.state=Xt;else{if(this._streamEnded(F,Q)){var Z={};return this.altAudio&&(Z.type="video"),this.hls.trigger(d.a.BUFFER_EOS,Z),void(this.state=$t)}this._fetchPayloadOrEos(f,F,Q)}}}}},s._fetchPayloadOrEos=function(t,e,o){var f=this.fragPrevious,p=(this.level,o.fragments),v=p.length;if(v!==0){var b,L=p[0].start,C=p[v-1].start+p[v-1].duration,F=e.end;if(o.initSegment&&!o.initSegment.data)b=o.initSegment;else if(o.live){var N=this.config.initialLiveManifestSize;if(v<N)return void u.b.warn("Can not start playback of a level, reason: not enough fragments "+v+" < "+N);if((b=this._ensureFragmentAtLivePoint(o,F,L,C,f,p))===null)return}else F<L&&(b=p[0]);b||(b=this._findFragment(L,f,v,p,F,C,o)),b&&(b.encrypted?this._loadKey(b,o):this._loadFragment(b,o,t,F))}},s._ensureFragmentAtLivePoint=function(t,e,o,f,p,v){var b,L=this.hls.config,C=this.media,F=1/0;if(L.liveMaxLatencyDuration!==void 0?F=L.liveMaxLatencyDuration:Object(O.a)(L.liveMaxLatencyDurationCount)&&(F=L.liveMaxLatencyDurationCount*t.targetduration),e<Math.max(o-L.maxFragLookUpTolerance,f-F)){var N=this.liveSyncPosition=this.computeLivePosition(o,t);e=N,C&&!C.paused&&C.readyState&&C.duration>N&&N>C.currentTime&&(u.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+N.toFixed(3)),C.currentTime=N),this.nextLoadPosition=N}if(t.PTSKnown&&e>f&&C&&C.readyState)return null;if(this.startFragRequested&&!t.PTSKnown&&p)if(t.hasProgramDateTime)u.b.log("live playlist, switching playlist, load frag with same PDT: "+p.programDateTime),b=It(v,p.endProgramDateTime,L.maxFragLookUpTolerance);else{var Q=p.sn+1;if(Q>=t.startSN&&Q<=t.endSN){var Z=v[Q-t.startSN];p.cc===Z.cc&&(b=Z,u.b.log("live playlist, switching playlist, load frag with next SN: "+b.sn))}b||(b=y.search(v,function(lt){return p.cc-lt.cc}))&&u.b.log("live playlist, switching playlist, load frag with same CC: "+b.sn)}return b},s._findFragment=function(t,e,o,f,p,v,b){var L,C=this.hls.config;if(p<v?L=ht(e,f,p,p>v-C.maxFragLookUpTolerance?0:C.maxFragLookUpTolerance):L=f[o-1],L){var F=L.sn-b.startSN,N=e&&L.level===e.level,Q=f[F-1],Z=f[F+1];if(e&&L.sn===e.sn)if(N&&!L.backtracked)if(L.sn<b.endSN){var lt=e.deltaPTS;lt&&lt>C.maxBufferHole&&e.dropped&&F?(L=Q,u.b.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(L=Z,this.fragmentTracker.getState(L)!==te&&u.b.log("Re-loading fragment with SN: "+L.sn))}else L=null;else L.backtracked&&(Z&&Z.backtracked?(u.b.warn("Already backtracked from fragment "+Z.sn+", will not backtrack to fragment "+L.sn+". Loading fragment "+Z.sn),L=Z):(u.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),L.dropped=0,Q?(L=Q).backtracked=!0:F&&(L=null)))}return L},s._loadKey=function(t,e){u.b.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level),this.state=Ut,this.hls.trigger(d.a.KEY_LOADING,{frag:t})},s._loadFragment=function(t,e,o,f){var p=this.fragmentTracker.getState(t);this.fragCurrent=t,t.sn!=="initSegment"&&(this.startFragRequested=!0),Object(O.a)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||p===wt||p===ae?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,u.b.log("Loading "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(o.toFixed(3))+", bufferEnd: "+parseFloat(f.toFixed(3))),this.hls.trigger(d.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new x(this.hls,"main")),this.state=Dt):p===ie&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},s.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,q.MAIN)},s.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},s._checkFragmentChanged=function(){var t,e,o=this.media;if(o&&o.readyState&&o.seeking===!1&&((e=o.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=e),T.isBuffered(o,e)?t=this.getBufferedFrag(e):T.isBuffered(o,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var f=t;if(f!==this.fragPlaying){this.hls.trigger(d.a.FRAG_CHANGED,{frag:f});var p=f.level;this.fragPlaying&&this.fragPlaying.level===p||this.hls.trigger(d.a.LEVEL_SWITCHED,{level:p}),this.fragPlaying=f}}},s.immediateLevelSwitch=function(){if(u.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t,e=this.media;e?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t}var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,t.currentTime>0&&T.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},s.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e,o=this.getBufferedFrag(t.currentTime);if(o&&o.startPTS>1&&this.flushMainBuffer(0,o.startPTS-1),t.paused)e=0;else{var f=this.hls.nextLoadLevel,p=this.levels[f],v=this.fragLastKbps;e=v&&this.fragCurrent?this.fragCurrent.duration*p.bitrate/(1e3*v)+1:0}var b=this.getBufferedFrag(t.currentTime+e);if(b){var L=this.followingBufferedFrag(b);if(L){var C=this.fragCurrent;C&&C.loader&&C.loader.abort(),this.fragCurrent=null;var F=Math.max(b.endPTS,L.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,L.duration));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},s.flushMainBuffer=function(t,e){this.state=Vt;var o={startOffset:t,endOffset:e};this.altAudio&&(o.type="video"),this.hls.trigger(d.a.BUFFER_FLUSHING,o)},s.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var o=this.config;this.levels&&o.autoStartLoad&&this.hls.startLoad(o.startPosition),this.gapController=new Pt(o,e,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(u.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(o){o.details&&o.details.fragments.forEach(function(f){f.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},s.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;Object(O.a)(e)&&u.b.log("media seeked to "+e.toFixed(3)),this.tick()},s.onManifestLoading=function(){u.b.log("trigger BUFFER_RESET"),this.hls.trigger(d.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},s.onManifestParsed=function(t){var e,o=!1,f=!1;t.levels.forEach(function(v){(e=v.audioCodec)&&(e.indexOf("mp4a.40.2")!==-1&&(o=!0),e.indexOf("mp4a.40.5")!==-1&&(f=!0))}),this.audioCodecSwitch=o&&f,this.audioCodecSwitch&&u.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=t.altAudio,this.levels=t.levels,this.startFragRequested=!1;var p=this.config;(p.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(p.startPosition)},s.onLevelLoaded=function(t){var e=t.details,o=t.level,f=this.levels[this.levelLastLoaded],p=this.levels[o],v=e.totalduration,b=0;if(u.b.log("level "+o+" loaded ["+e.startSN+","+e.endSN+"],duration:"+v),e.live||p.details&&p.details.live){var L=p.details;L&&e.fragments.length>0?(H(L,e),b=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(b,L),e.PTSKnown&&Object(O.a)(b)?u.b.log("live playlist sliding:"+b.toFixed(3)):(u.b.log("live playlist - outdated PTS, unknown sliding"),dt(this.fragPrevious,f,e))):(u.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,dt(this.fragPrevious,f,e))}else e.PTSKnown=!1;if(p.details=e,this.levelLastLoaded=o,this.hls.trigger(d.a.LEVEL_UPDATED,{details:e,level:o}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var C=e.startTimeOffset;Object(O.a)(C)?(C<0&&(u.b.log("negative start time offset "+C+", count from end of last fragment"),C=b+v+C),u.b.log("start time offset found in playlist, adjust startPosition to "+C),this.startPosition=C):e.live?(this.startPosition=this.computeLivePosition(b,e),u.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Xt&&(this.state=st),this.tick()},s.onKeyLoaded=function(){this.state===Ut&&(this.state=st,this.tick())},s.onFragLoaded=function(t){var e=this.fragCurrent,o=this.hls,f=this.levels,p=this.media,v=t.frag;if(this.state===Dt&&e&&v.type==="main"&&v.level===e.level&&v.sn===e.sn){var b=t.stats,L=f[e.level],C=L.details;if(this.bitrateTest=!1,this.stats=b,u.b.log("Loaded "+e.sn+" of ["+C.startSN+" ,"+C.endSN+"],level "+e.level),v.bitrateTest&&o.nextLoadLevel)this.state=st,this.startFragRequested=!1,b.tparsed=b.tbuffered=window.performance.now(),o.trigger(d.a.FRAG_BUFFERED,{stats:b,frag:e,id:"main"}),this.tick();else if(v.sn==="initSegment")this.state=st,b.tparsed=b.tbuffered=window.performance.now(),C.initSegment.data=t.payload,o.trigger(d.a.FRAG_BUFFERED,{stats:b,frag:e,id:"main"}),this.tick();else{u.b.log("Parsing "+e.sn+" of ["+C.startSN+" ,"+C.endSN+"],level "+e.level+", cc "+e.cc),this.state=Nt,this.pendingBuffering=!0,this.appended=!1,v.bitrateTest&&(v.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:v}));var F=!(p&&p.seeking)&&(C.PTSKnown||!C.live),N=C.initSegment?C.initSegment.data:[],Q=this._getAudioCodec(L);(this.demuxer=this.demuxer||new x(this.hls,"main")).push(t.payload,N,Q,L.videoCodec,e,C.totalduration,F)}}this.fragLoadError=0},s.onFragParsingInitSegment=function(t){var e=this.fragCurrent,o=t.frag;if(e&&t.id==="main"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt){var f,p,v=t.tracks;if(this.audioOnly=v.audio&&!v.video,this.altAudio&&!this.audioOnly&&delete v.audio,p=v.audio){var b=this.levels[this.level].audioCodec,L=navigator.userAgent.toLowerCase();b&&this.audioCodecSwap&&(u.b.log("swapping playlist audio codec"),b=b.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&p.metadata.channelCount!==1&&L.indexOf("firefox")===-1&&(b="mp4a.40.5"),L.indexOf("android")!==-1&&p.container!=="audio/mpeg"&&(b="mp4a.40.2",u.b.log("Android: force audio codec to "+b)),p.levelCodec=b,p.id=t.id}for(f in(p=v.video)&&(p.levelCodec=this.levels[this.level].videoCodec,p.id=t.id),this.hls.trigger(d.a.BUFFER_CODECS,v),v){p=v[f],u.b.log("main track:"+f+",container:"+p.container+",codecs[level/parsed]=["+p.levelCodec+"/"+p.codec+"]");var C=p.initSegment;C&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(d.a.BUFFER_APPENDING,{type:f,data:C,parent:"main",content:"initSegment"}))}this.tick()}},s.onFragParsingData=function(t){var e=this,o=this.fragCurrent,f=t.frag;if(o&&t.id==="main"&&f.sn===o.sn&&f.level===o.level&&(t.type!=="audio"||!this.altAudio)&&this.state===Nt){var p=this.levels[this.level],v=o;if(Object(O.a)(t.endPTS)||(t.endPTS=t.startPTS+o.duration,t.endDTS=t.startDTS+o.duration),t.hasAudio===!0&&v.addElementaryStream(I.AUDIO),t.hasVideo===!0&&v.addElementaryStream(I.VIDEO),u.b.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),t.type==="video")if(v.dropped=t.dropped,v.dropped)if(v.backtracked)u.b.warn("Already backtracked on this fragment, appending with the gap",v.sn);else{var b=p.details;if(!b||v.sn!==b.startSN)return u.b.warn("missing video frame(s), backtracking fragment",v.sn),this.fragmentTracker.removeFragment(v),v.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=st,this.fragPrevious=v,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();u.b.warn("missing video frame(s) on first frag, appending with gap",v.sn)}else v.backtracked=!1;var L=$(p.details,v,t.startPTS,t.endPTS,t.startDTS,t.endDTS),C=this.hls;C.trigger(d.a.LEVEL_PTS_UPDATED,{details:p.details,level:this.level,drift:L,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(F){F&&F.length&&e.state===Nt&&(e.appended=!0,e.pendingBuffering=!0,C.trigger(d.a.BUFFER_APPENDING,{type:t.type,data:F,parent:"main",content:"data"}))}),this.tick()}},s.onFragParsed=function(t){var e=this.fragCurrent,o=t.frag;e&&t.id==="main"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt&&(this.stats.tparsed=window.performance.now(),this.state=Kt,this._checkAppendedParsed())},s.onAudioTrackSwitching=function(t){var e=this.altAudio,o=!!t.url,f=t.id;if(!o){if(this.mediaBuffer!==this.media){u.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var p=this.fragCurrent;p.loader&&(u.b.log("switching to main audio track, cancel main fragment load"),p.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=st}var v=this.hls;e&&v.trigger(d.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),v.trigger(d.a.AUDIO_TRACK_SWITCHED,{id:f})}},s.onAudioTrackSwitched=function(t){var e=t.id,o=!!this.hls.audioTracks[e].url;if(o){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(u.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=o,this.tick()},s.onBufferCreated=function(t){var e,o,f=t.tracks,p=!1;for(var v in f){var b=f[v];b.id==="main"?(o=v,e=b,v==="video"&&(this.videoBuffer=f[v].buffer)):p=!0}p&&e?(u.b.log("alternate track found, use "+o+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},s.onBufferAppended=function(t){if(t.parent==="main"){var e=this.state;e!==Nt&&e!==Kt||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},s._checkAppendedParsed=function(){if(!(this.state!==Kt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;u.b.log("main buffered : "+it.toString(e.buffered)),this.fragPrevious=t;var o=this.stats;o.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*o.total/(o.tbuffered-o.tfirst)),this.hls.trigger(d.a.FRAG_BUFFERED,{stats:o,frag:t,id:"main"}),this.state=st}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},s.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||e.type==="main"){var o=!!this.media&&T.isBuffered(this.media,this.media.currentTime)&&T.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case S.a.FRAG_LOAD_ERROR:case S.a.FRAG_LOAD_TIMEOUT:case S.a.KEY_LOAD_ERROR:case S.a.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var f=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);u.b.warn("mediaController: frag loading failed, retry in "+f+" ms"),this.retryDate=window.performance.now()+f,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=re}else u.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Yt;break;case S.a.LEVEL_LOAD_ERROR:case S.a.LEVEL_LOAD_TIMEOUT:this.state!==Yt&&(t.fatal?(this.state=Yt,u.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==Xt||(this.state=st));break;case S.a.BUFFER_FULL_ERROR:t.parent!=="main"||this.state!==Nt&&this.state!==Kt||(o?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=st):(u.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},s._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,u.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},s._checkBuffer=function(){var t=this.media;if(t&&t.readyState!==0){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e)}},s.onFragLoadEmergencyAborted=function(){this.state=st,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},s.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;if(t){var e=this.audioOnly?I.AUDIO:I.VIDEO;this.fragmentTracker.detectEvictedFragments(e,t.buffered)}this.state=st,this.fragPrevious=null},s.onLevelsUpdated=function(t){this.levels=t.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s._seekToStartPos=function(){var t=this.media,e=t.currentTime,o=this.startPosition;if(e!==o&&o>=0){if(t.seeking)return void u.b.log("could not seek to "+o+", already seeking at "+e);var f=(t.buffered.length?t.buffered.start(0):0)-o;f>0&&f<this.config.maxBufferHole&&(u.b.log("adjusting start position by "+f+" to match buffer start"),o+=f,this.startPosition=o),u.b.log("seek to target start position "+o+" from current time "+e+". ready state "+t.readyState),t.currentTime=o}},s._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(u.b.log("swapping playlist audio codec"),e&&(e=e.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),e},h=a,(r=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,u.b.log("main stream-controller: "+e+"->"+t),this.hls.trigger(d.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}])&&Zt(h.prototype,r),i&&Zt(h,i),a}(ne);function ee(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Fe=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,d.a.MANIFEST_LOADED,d.a.LEVEL_LOADED,d.a.AUDIO_TRACK_SWITCHED,d.a.FRAG_LOADED,d.a.ERROR)||this).canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,he=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},s.clearTimer=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},s.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(e){e.loadError=0;var o=e.details;o&&o.live&&(e.details=void 0)}),this.timer!==null&&this.loadLevel()},s.stopLoad=function(){this.canload=!1},s.onManifestLoaded=function(t){var e,o=[],f=[],p={},v=null,b=!1,L=!1;if(t.levels.forEach(function(N){var Q=N.attrs;N.loadError=0,N.fragmentError=!1,b=b||!!N.videoCodec,L=L||!!N.audioCodec,he&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0),(v=p[N.bitrate])?v.url.push(N.url):(N.url=[N.url],N.urlId=0,p[N.bitrate]=N,o.push(N)),Q&&(Q.AUDIO&&W(v||N,"audio",Q.AUDIO),Q.SUBTITLES&&W(v||N,"text",Q.SUBTITLES))}),b&&L&&(o=o.filter(function(N){return!!N.videoCodec})),o=o.filter(function(N){var Q=N.audioCodec,Z=N.videoCodec;return(!Q||St(Q,"audio"))&&(!Z||St(Z,"video"))}),t.audioTracks&&(f=t.audioTracks.filter(function(N){return!N.audioCodec||St(N.audioCodec,"audio")})).forEach(function(N,Q){N.id=Q}),o.length>0){e=o[0].bitrate,o.sort(function(N,Q){return N.bitrate-Q.bitrate}),this._levels=o;for(var C=0;C<o.length;C++)if(o[C].bitrate===e){this._firstLevel=C,u.b.log("manifest loaded,"+o.length+" level(s) found, first bitrate:"+e);break}var F=L&&!b;this.hls.trigger(d.a.MANIFEST_PARSED,{levels:o,audioTracks:f,firstLevel:this._firstLevel,stats:t.stats,audio:L,video:b,altAudio:!F&&f.some(function(N){return!!N.url})})}else this.hls.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},s.setLevelInternal=function(t){var e=this._levels,o=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){u.b.log("switching to level "+t),this.currentLevelIndex=t;var f=e[t];f.level=t,o.trigger(d.a.LEVEL_SWITCHING,f)}var p=e[t],v=p.details;if(!v||v.live){var b=p.urlId;o.trigger(d.a.LEVEL_LOADING,{url:p.url[b],level:t,id:b})}}else o.trigger(d.a.ERROR,{type:S.b.OTHER_ERROR,details:S.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},s.onError=function(t){if(t.fatal)t.type===S.b.NETWORK_ERROR&&this.clearTimer();else{var e,o=!1,f=!1;switch(t.details){case S.a.FRAG_LOAD_ERROR:case S.a.FRAG_LOAD_TIMEOUT:case S.a.KEY_LOAD_ERROR:case S.a.KEY_LOAD_TIMEOUT:e=t.frag.level,f=!0;break;case S.a.LEVEL_LOAD_ERROR:case S.a.LEVEL_LOAD_TIMEOUT:e=t.context.level,o=!0;break;case S.a.REMUX_ALLOC_ERROR:e=t.level,o=!0}e!==void 0&&this.recoverLevel(t,e,o,f)}},s.recoverLevel=function(t,e,o,f){var p,v,b,L=this,C=this.hls.config,F=t.details,N=this._levels[e];if(N.loadError++,N.fragmentError=f,o){if(!(this.levelRetryCount+1<=C.levelLoadingMaxRetry))return u.b.error("level controller, cannot recover from "+F+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);v=Math.min(Math.pow(2,this.levelRetryCount)*C.levelLoadingRetryDelay,C.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return L.loadLevel()},v),t.levelRetry=!0,this.levelRetryCount++,u.b.warn("level controller, "+F+", retry in "+v+" ms, current retry count is "+this.levelRetryCount)}(o||f)&&((p=N.url.length)>1&&N.loadError<p?(N.urlId=(N.urlId+1)%p,N.details=void 0,u.b.warn("level controller, "+F+" for level "+e+": switching to redundant URL-id "+N.urlId)):this.manualLevelIndex===-1?(b=e===0?this._levels.length-1:e-1,u.b.warn("level controller, "+F+": switch to "+b),this.hls.nextAutoLevel=this.currentLevelIndex=b):f&&(u.b.warn("level controller, "+F+": reload a fragment"),this.currentLevelIndex=null))},s.onFragLoaded=function(t){var e=t.frag;if(e!==void 0&&e.type==="main"){var o=this._levels[e.level];o!==void 0&&(o.fragmentError=!1,o.loadError=0,this.levelRetryCount=0)}},s.onLevelLoaded=function(t){var e=this,o=t.level,f=t.details;if(o===this.currentLevelIndex){var p=this._levels[o];if(p.fragmentError||(p.loadError=0,this.levelRetryCount=0),f.live){var v=tt(p.details,f,t.stats.trequest);u.b.log("live playlist, reload in "+Math.round(v)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},v)}else this.clearTimer()}},s.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,o=this.hls.levels[this.currentLevelIndex];if(o&&o.audioGroupIds){for(var f=-1,p=0;p<o.audioGroupIds.length;p++)if(o.audioGroupIds[p]===e){f=p;break}f!==o.urlId&&(o.urlId=f,this.startLoad())}},s.loadLevel=function(){if(u.b.debug("call to loadLevel"),this.currentLevelIndex!==null&&this.canload){var t=this._levels[this.currentLevelIndex];if(typeof t=="object"&&t.url.length>0){var e=this.currentLevelIndex,o=t.urlId,f=t.url[o];u.b.log("Attempt loading level index "+e+" with URL-id "+o),this.hls.trigger(d.a.LEVEL_LOADING,{url:f,level:e,id:o})}}},s.removeLevel=function(t,e){var o=this.levels.filter(function(f,p){return p!==t||f.url.length>1&&e!==void 0&&(f.url=f.url.filter(function(v,b){return b!==e}),f.urlId=0,!0)}).map(function(f,p){var v=f.details;return v&&v.fragments&&v.fragments.forEach(function(b){b.level=p}),f});this._levels=o,this.hls.trigger(d.a.LEVELS_UPDATED,{levels:o})},h=a,(r=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}])&&ee(h.prototype,r),i&&ee(h,i),a}(k),ye=J(4);function we(g,l){var n;try{n=new Event("addtrack")}catch(a){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=g,l.dispatchEvent(n)}function oe(g){if(g!=null&&g.cues)for(;g.cues.length>0;)g.removeCue(g.cues[0])}var De=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,d.a.MEDIA_ATTACHED,d.a.MEDIA_DETACHING,d.a.FRAG_PARSING_METADATA,d.a.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,i.media=void 0,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.destroy=function(){k.prototype.destroy.call(this)},h.onMediaAttached=function(r){this.media=r.media,this.media},h.onMediaDetaching=function(){oe(this.id3Track),this.id3Track=void 0,this.media=void 0},h.getID3Track=function(r){for(var i=0;i<r.length;i++){var s=r[i];if(s.kind==="metadata"&&s.label==="id3")return we(s,this.media),s}return this.media.addTextTrack("metadata","id3")},h.onFragParsingMetadata=function(r){var i=r.frag,s=r.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var t=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<s.length;e++){var o=ye.a.getID3Frames(s[e].data);if(o){var f=Math.max(s[e].pts,0),p=e<s.length-1?s[e+1].pts:i.endPTS;p||(p=i.start+i.duration),p-f<=0&&(p=f+.25);for(var v=0;v<o.length;v++){var b=o[v];if(!ye.a.isTimeStampFrame(b)){var L=new t(f,p,"");L.value=b,this.id3Track.addCue(L)}}}}},h.onLiveBackBufferReached=function(r){var i=r.bufferEnd,s=this.id3Track;if(s&&s.cues&&s.cues.length){var t=function(e,o){if(o<e[0].endTime)return e[0];if(o>e[e.length-1].endTime)return e[e.length-1];for(var f=0,p=e.length-1;f<=p;){var v=Math.floor((p+f)/2);if(o<e[v].endTime)p=v-1;else{if(!(o>e[v].endTime))return e[v];f=v+1}}return e[f].endTime-o<o-e[p].endTime?e[f]:e[p]}(s.cues,i);if(t)for(;s.cues[0]!==t;)s.removeCue(s.cues[0])}},a}(k),pe=function(){function g(n){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=n?Math.exp(Math.log(.5)/n):0,this.estimate_=0,this.totalWeight_=0}var l=g.prototype;return l.sample=function(n,a){var h=Math.pow(this.alpha_,n);this.estimate_=a*(1-h)+h*this.estimate_,this.totalWeight_+=n},l.getTotalWeight=function(){return this.totalWeight_},l.getEstimate=function(){if(this.alpha_){var n=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/n}return this.estimate_},g}(),Ue=function(){function g(n,a,h,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=n,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new pe(a),this.fast_=new pe(h)}var l=g.prototype;return l.sample=function(n,a){var h=(n=Math.max(n,this.minDelayMs_))/1e3,r=8*a/h;this.fast_.sample(h,r),this.slow_.sample(h,r)},l.canEstimate=function(){var n=this.fast_;return n&&n.getTotalWeight()>=this.minWeight_},l.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},l.destroy=function(){},g}();function Ce(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Se=window.performance,Ne=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,d.a.FRAG_LOADING,d.a.FRAG_LOADED,d.a.FRAG_BUFFERED,d.a.ERROR)||this).lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=t,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(function(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}(e)),e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.destroy=function(){this.clearTimer(),k.prototype.destroy.call(this)},s.onFragLoading=function(t){var e=t.frag;if(e.type==="main"&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var o,f,p=this.hls,v=p.config,b=e.level;p.levels[b].details.live?(o=v.abrEwmaFastLive,f=v.abrEwmaSlowLive):(o=v.abrEwmaFastVoD,f=v.abrEwmaSlowVoD),this._bwEstimator=new Ue(p,f,o,v.abrEwmaDefaultEstimate)}},s._abandonRulesCheck=function(){var t=this.hls,e=t.media,o=this.fragCurrent;if(o){var f=o.loader;if(!f||f.stats&&f.stats.aborted)return u.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var p=f.stats;if(e&&p&&(!e.paused&&e.playbackRate!==0||!e.readyState)&&o.autoLevel&&o.level){var v=Se.now()-p.trequest,b=Math.abs(e.playbackRate);if(v>500*o.duration/b){var L=t.levels,C=Math.max(1,p.bw?p.bw/8:1e3*p.loaded/v),F=L[o.level];if(!F)return;var N=F.realBitrate?Math.max(F.realBitrate,F.bitrate):F.bitrate,Q=p.total?p.total:Math.max(p.loaded,Math.round(o.duration*N/8)),Z=e.currentTime,lt=(Q-p.loaded)/C,pt=(T.bufferInfo(e,Z,t.config.maxBufferHole).end-Z)/b;if(pt<2*o.duration/b&&lt>pt){var vt,at=t.minAutoLevel;for(vt=o.level-1;vt>at;vt--){var Bt=L[vt].realBitrate?Math.max(L[vt].realBitrate,L[vt].bitrate):L[vt].bitrate;if(o.duration*Bt/(6.4*C)<pt)break}void 0<lt&&(u.b.warn("loading too slow, abort fragment loading and switch to level "+vt+":fragLoadedDelay["+vt+"]<fragLoadedDelay["+(o.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+lt.toFixed(1)+":"+pt.toFixed(1)),t.nextLoadLevel=vt,this._bwEstimator.sample(v,p.loaded),f.abort(),this.clearTimer(),t.trigger(d.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:o,stats:p}))}}}}},s.onFragLoaded=function(t){var e=t.frag;if(e.type==="main"&&Object(O.a)(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[e.level],f=(o.loaded?o.loaded.bytes:0)+t.stats.loaded,p=(o.loaded?o.loaded.duration:0)+t.frag.duration;o.loaded={bytes:f,duration:p},o.realBitrate=Math.round(8*f/p)}if(t.frag.bitrateTest){var v=t.stats;v.tparsed=v.tbuffered=v.tload,this.onFragBuffered(t)}}},s.onFragBuffered=function(t){var e=t.stats,o=t.frag;if(e.aborted!==!0&&o.type==="main"&&Object(O.a)(o.sn)&&(!o.bitrateTest||e.tload===e.tbuffered)){var f=e.tparsed-e.trequest;u.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(f,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),o.bitrateTest?this.bitrateTestDelay=f/1e3:this.bitrateTestDelay=0}},s.onError=function(t){switch(t.details){case S.a.FRAG_LOAD_ERROR:case S.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},s.clearTimer=function(){clearInterval(this.timer),this.timer=null},s._findBestLevel=function(t,e,o,f,p,v,b,L,C){for(var F=p;F>=f;F--){var N=C[F];if(N){var Q=N.details,Z=Q?Q.totalduration/Q.fragments.length:e,lt=!!Q&&Q.live,pt=void 0;pt=F<=t?b*o:L*o;var vt=C[F].realBitrate?Math.max(C[F].realBitrate,C[F].bitrate):C[F].bitrate,at=vt*Z/pt;if(u.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+F+"/"+Math.round(pt)+"/"+vt+"/"+Z+"/"+v+"/"+at),pt>vt&&(!at||lt&&!this.bitrateTestDelay||at<v))return F}}return-1},h=a,(r=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(t===-1||e&&e.canEstimate()))return t;var o=this._nextABRAutoLevel;return t!==-1&&(o=Math.min(t,o)),o},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,o=t.levels,f=t.config,p=t.minAutoLevel,v=t.media,b=this.lastLoadedFragLevel,L=this.fragCurrent?this.fragCurrent.duration:0,C=v?v.currentTime:0,F=v&&v.playbackRate!==0?Math.abs(v.playbackRate):1,N=this._bwEstimator?this._bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,Q=(T.bufferInfo(v,C,f.maxBufferHole).end-C)/F,Z=this._findBestLevel(b,L,N,p,e,Q,f.abrBandWidthFactor,f.abrBandWidthUpFactor,o);if(Z>=0)return Z;u.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var lt=L?Math.min(L,f.maxStarvationDelay):f.maxStarvationDelay,pt=f.abrBandWidthFactor,vt=f.abrBandWidthUpFactor;if(Q===0){var at=this.bitrateTestDelay;at&&(lt=(L?Math.min(L,f.maxLoadingDelay):f.maxLoadingDelay)-at,u.b.trace("bitrate test took "+Math.round(1e3*at)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*lt)+" ms"),pt=vt=1)}return Z=this._findBestLevel(b,L,N,p,e,Q+lt,pt,vt,o),Math.max(Z,0)}}])&&Ce(h.prototype,r),i&&Ce(h,i),a}(k),_e=E(),Oe=function(g){var l,n;function a(r){var i;return(i=g.call(this,r,d.a.MEDIA_ATTACHING,d.a.MEDIA_DETACHING,d.a.MANIFEST_PARSED,d.a.BUFFER_RESET,d.a.BUFFER_APPENDING,d.a.BUFFER_CODECS,d.a.BUFFER_EOS,d.a.BUFFER_FLUSHING,d.a.LEVEL_PTS_UPDATED,d.a.LEVEL_UPDATED)||this)._msDuration=null,i._levelDuration=null,i._levelTargetDuration=10,i._live=null,i._objectUrl=null,i._needsFlush=!1,i._needsEos=!1,i.config=void 0,i.audioTimestampOffset=void 0,i.bufferCodecEventsExpected=0,i._bufferCodecEventsTotal=0,i.media=null,i.mediaSource=null,i.segments=[],i.parent=void 0,i.appending=!1,i.appended=0,i.appendError=0,i.flushBufferCounter=0,i.tracks={},i.pendingTracks={},i.sourceBuffer={},i.flushRange=[],i._onMediaSourceOpen=function(){u.b.log("media source opened"),i.hls.trigger(d.a.MEDIA_ATTACHED,{media:i.media});var s=i.mediaSource;s&&s.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},i._onMediaSourceClose=function(){u.b.log("media source closed")},i._onMediaSourceEnded=function(){u.b.log("media source ended")},i._onSBUpdateEnd=function(){if(i.audioTimestampOffset&&i.sourceBuffer.audio){var s=i.sourceBuffer.audio;u.b.warn("change mpeg audio timestamp offset from "+s.timestampOffset+" to "+i.audioTimestampOffset),s.timestampOffset=i.audioTimestampOffset,delete i.audioTimestampOffset}i._needsFlush&&i.doFlush(),i._needsEos&&i.checkEos(),i.appending=!1;var t=i.parent,e=i.segments.reduce(function(b,L){return L.parent===t?b+1:b},0),o={},f=i.sourceBuffer;for(var p in f){var v=f[p];if(!v)throw Error("handling source buffer update end error: source buffer for "+p+" uninitilized and unable to update buffered TimeRanges.");o[p]=v.buffered}i.hls.trigger(d.a.BUFFER_APPENDED,{parent:t,pending:e,timeRanges:o}),i._needsFlush||i.doAppending(),i.updateMediaElementDuration(),e===0&&i.flushLiveBackBuffer()},i._onSBUpdateError=function(s){u.b.error("sourceBuffer error:",s),i.hls.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.BUFFER_APPENDING_ERROR,fatal:!1})},i.config=r.config,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.destroy=function(){k.prototype.destroy.call(this)},h.onLevelPtsUpdated=function(r){var i=r.type,s=this.tracks.audio;if(i==="audio"&&s&&s.container==="audio/mpeg"){var t=this.sourceBuffer.audio;if(!t)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(t.timestampOffset-r.start)>.1){var e=t.updating;try{t.abort()}catch(o){u.b.warn("can not abort audio buffer: "+o)}e?this.audioTimestampOffset=r.start:(u.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+r.start),t.timestampOffset=r.start)}}},h.onManifestParsed=function(r){var i=2;(r.audio&&!r.video||!r.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,u.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},h.onMediaAttaching=function(r){var i=this.media=r.media;if(i&&_e){var s=this.mediaSource=new _e;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),i.src=window.URL.createObjectURL(s),this._objectUrl=i.src}},h.onMediaDetaching=function(){u.b.log("media source detaching");var r=this.mediaSource;if(r){if(r.readyState==="open")try{r.endOfStream()}catch(i){u.b.warn("onMediaDetaching:"+i.message+" while calling endOfStream")}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):u.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(d.a.MEDIA_DETACHED)},h.checkPendingTracks=function(){var r=this.bufferCodecEventsExpected,i=this.pendingTracks,s=Object.keys(i).length;(s&&!r||s===2)&&(this.createSourceBuffers(i),this.pendingTracks={},this.doAppending())},h.onBufferReset=function(){var r=this.sourceBuffer;for(var i in r){var s=r[i];try{s&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(s),s.removeEventListener("updateend",this._onSBUpdateEnd),s.removeEventListener("error",this._onSBUpdateError))}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},h.onBufferCodecs=function(r){var i=this;Object.keys(this.sourceBuffer).length||(Object.keys(r).forEach(function(s){i.pendingTracks[s]=r[s]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},h.createSourceBuffers=function(r){var i=this.sourceBuffer,s=this.mediaSource;if(!s)throw Error("createSourceBuffers called when mediaSource was null");for(var t in r)if(!i[t]){var e=r[t];if(!e)throw Error("source buffer exists for track "+t+", however track does not");var o=e.levelCodec||e.codec,f=e.container+";codecs="+o;u.b.log("creating sourceBuffer("+f+")");try{var p=i[t]=s.addSourceBuffer(f);p.addEventListener("updateend",this._onSBUpdateEnd),p.addEventListener("error",this._onSBUpdateError),this.tracks[t]={buffer:p,codec:o,id:e.id,container:e.container,levelCodec:e.levelCodec}}catch(v){u.b.error("error while trying to add sourceBuffer:"+v.message),this.hls.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:v,mimeType:f})}}this.hls.trigger(d.a.BUFFER_CREATED,{tracks:this.tracks})},h.onBufferAppending=function(r){this._needsFlush||(this.segments?this.segments.push(r):this.segments=[r],this.doAppending())},h.onBufferEos=function(r){for(var i in this.sourceBuffer)if(!r.type||r.type===i){var s=this.sourceBuffer[i];s&&!s.ended&&(s.ended=!0,u.b.log(i+" sourceBuffer now EOS"))}this.checkEos()},h.checkEos=function(){var r=this.sourceBuffer,i=this.mediaSource;if(i&&i.readyState==="open"){for(var s in r){var t=r[s];if(t){if(!t.ended)return;if(t.updating)return void(this._needsEos=!0)}}u.b.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{i.endOfStream()}catch(e){u.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},h.onBufferFlushing=function(r){r.type?this.flushRange.push({start:r.startOffset,end:r.endOffset,type:r.type}):(this.flushRange.push({start:r.startOffset,end:r.endOffset,type:"video"}),this.flushRange.push({start:r.startOffset,end:r.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},h.flushLiveBackBuffer=function(){if(this._live){var r=this.config.liveBackBufferLength;if(isFinite(r)&&!(r<0))if(this.media)for(var i=this.media.currentTime,s=this.sourceBuffer,t=Object.keys(s),e=i-Math.max(r,this._levelTargetDuration),o=t.length-1;o>=0;o--){var f=t[o],p=s[f];if(p){var v=p.buffered;v.length>0&&e>v.start(0)&&this.removeBufferRange(f,p,0,e)&&this.hls.trigger(d.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:e})}}else u.b.error("flushLiveBackBuffer called without attaching media")}},h.onLevelUpdated=function(r){var i=r.details;i.fragments.length>0&&(this._levelDuration=i.totalduration+i.fragments[0].start,this._levelTargetDuration=i.averagetargetduration||i.targetduration||10,this._live=i.live,this.updateMediaElementDuration())},h.updateMediaElementDuration=function(){var r,i=this.config;if(this._levelDuration!==null&&this.media&&this.mediaSource&&this.sourceBuffer&&this.media.readyState!==0&&this.mediaSource.readyState==="open"){for(var s in this.sourceBuffer){var t=this.sourceBuffer[s];if(t&&t.updating===!0)return}r=this.media.duration,this._msDuration===null&&(this._msDuration=this.mediaSource.duration),this._live===!0&&i.liveDurationInfinity===!0?(u.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>r||!Object(O.a)(r))&&(u.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},h.doFlush=function(){for(;this.flushRange.length;){var r=this.flushRange[0];if(!this.flushBuffer(r.start,r.end,r.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(this.flushRange.length===0){this._needsFlush=!1;var i=0,s=this.sourceBuffer;try{for(var t in s){var e=s[t];e&&(i+=e.buffered.length)}}catch(o){u.b.error("error while accessing sourceBuffer.buffered")}this.appended=i,this.hls.trigger(d.a.BUFFER_FLUSHED)}},h.doAppending=function(){var r=this.config,i=this.hls,s=this.segments,t=this.sourceBuffer;if(Object.keys(t).length){if(!this.media||this.media.error)return this.segments=[],void u.b.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var e=s.shift();if(e)try{var o=t[e.type];if(!o)return void this._onSBUpdateEnd();if(o.updating)return void s.unshift(e);o.ended=!1,this.parent=e.parent,o.appendBuffer(e.data),this.appendError=0,this.appended++,this.appending=!0}catch(p){u.b.error("error while trying to append buffer:"+p.message),s.unshift(e);var f={type:S.b.MEDIA_ERROR,parent:e.parent,details:"",fatal:!1};p.code===22?(this.segments=[],f.details=S.a.BUFFER_FULL_ERROR):(this.appendError++,f.details=S.a.BUFFER_APPEND_ERROR,this.appendError>r.appendErrorMaxRetry&&(u.b.log("fail "+r.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],f.fatal=!0)),i.trigger(d.a.ERROR,f)}}}},h.flushBuffer=function(r,i,s){var t=this.sourceBuffer;if(!Object.keys(t).length)return!0;var e="null";if(this.media&&(e=this.media.currentTime.toFixed(3)),u.b.log("flushBuffer,pos/start/end: "+e+"/"+r+"/"+i),this.flushBufferCounter>=this.appended)return u.b.warn("abort flushing too many retries"),!0;var o=t[s];if(o){if(o.ended=!1,o.updating)return u.b.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(s,o,r,i))return this.flushBufferCounter++,!1}return u.b.log("buffer flushed"),!0},h.removeBufferRange=function(r,i,s,t){try{for(var e=0;e<i.buffered.length;e++){var o=i.buffered.start(e),f=i.buffered.end(e),p=Math.max(o,s),v=Math.min(f,t);if(Math.min(v,f)-p>.5){var b="null";return this.media&&(b=this.media.currentTime.toString()),u.b.log("sb remove "+r+" ["+p+","+v+"], of ["+o+","+f+"], pos:"+b),i.remove(p,v),!0}}}catch(L){u.b.warn("removeBufferRange failed",L)}return!1},a}(k);function ve(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Re=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,d.a.FPS_DROP_LEVEL_CAPPING,d.a.MEDIA_ATTACHING,d.a.MANIFEST_PARSED,d.a.LEVELS_UPDATED,d.a.BUFFER_CODECS,d.a.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e.clientRect=null,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},s.onFpsDropLevelCapping=function(t){a.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},s.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},s.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onLevelsUpdated=function(t){this.levels=t.levels},s.onMediaDetaching=function(){this.stopCapping()},s.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},s.getMaxLevel=function(t){var e=this;if(!this.levels)return-1;var o=this.levels.filter(function(f,p){return a.isLevelAllowed(p,e.restrictedLevels)&&p<=t});return this.clientRect=null,a.getMaxLevelByMediaSize(o,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var o=t.getBoundingClientRect();e.width=o.width,e.height=o.height,e.width||e.height||(e.width=o.right-o.left||t.width||0,e.height=o.bottom-o.top||t.height||0)}return this.clientRect=e,e},a.isLevelAllowed=function(t,e){return e===void 0&&(e=[]),e.indexOf(t)===-1},a.getMaxLevelByMediaSize=function(t,e,o){if(!t||t&&!t.length)return-1;for(var f,p,v=t.length-1,b=0;b<t.length;b+=1){var L=t[b];if((L.width>=e||L.height>=o)&&(f=L,!(p=t[b+1])||f.width!==p.width||f.height!==p.height)){v=b;break}}return v},h=a,i=[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(e){}return t}}],(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*a.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*a.contentScaleFactor}}])&&ve(h.prototype,r),i&&ve(h,i),a}(k),Be=window.performance,Ge=function(g){var l,n;function a(r){return g.call(this,r,d.a.MEDIA_ATTACHING)||this}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},h.onMediaAttaching=function(r){var i=this.hls.config;i.capLevelOnFPSDrop&&(typeof(this.video=r.media instanceof window.HTMLVideoElement?r.media:null).getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod))},h.checkFPS=function(r,i,s){var t=Be.now();if(i){if(this.lastTime){var e=t-this.lastTime,o=s-this.lastDroppedFrames,f=i-this.lastDecodedFrames,p=1e3*o/e,v=this.hls;if(v.trigger(d.a.FPS_DROP,{currentDropped:o,currentDecoded:f,totalDroppedFrames:s}),p>0&&o>v.config.fpsDroppedMonitoringThreshold*f){var b=v.currentLevel;u.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+b),b>0&&(v.autoLevelCapping===-1||v.autoLevelCapping>=b)&&(b-=1,v.trigger(d.a.FPS_DROP_LEVEL_CAPPING,{level:b,droppedLevel:v.currentLevel}),v.autoLevelCapping=b,v.streamController.nextLevelSwitch())}}this.lastTime=t,this.lastDroppedFrames=s,this.lastDecodedFrames=i}},h.checkFPSInterval=function(){var r=this.video;if(r)if(this.isVideoPlaybackQualityAvailable){var i=r.getVideoPlaybackQuality();this.checkFPS(r,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},a}(k),_r=function(){function g(n){n&&n.xhrSetup&&(this.xhrSetup=n.xhrSetup)}var l=g.prototype;return l.destroy=function(){this.abort(),this.loader=null},l.abort=function(){var n=this.loader;n&&n.readyState!==4&&(this.stats.aborted=!0,n.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},l.load=function(n,a,h){this.context=n,this.config=a,this.callbacks=h,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=a.retryDelay,this.loadInternal()},l.loadInternal=function(){var n,a=this.context;n=this.loader=new window.XMLHttpRequest;var h=this.stats;h.tfirst=0,h.loaded=0;var r=this.xhrSetup;try{if(r)try{r(n,a.url)}catch(i){n.open("GET",a.url,!0),r(n,a.url)}n.readyState||n.open("GET",a.url,!0)}catch(i){return void this.callbacks.onError({code:n.status,text:i.message},a,n)}a.rangeEnd&&n.setRequestHeader("Range","bytes="+a.rangeStart+"-"+(a.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=a.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),n.send()},l.readystatechange=function(n){var a=n.currentTarget,h=a.readyState,r=this.stats,i=this.context,s=this.config;if(!r.aborted&&h>=2)if(window.clearTimeout(this.requestTimeout),r.tfirst===0&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),h===4){var t=a.status;if(t>=200&&t<300){var e,o;r.tload=Math.max(r.tfirst,window.performance.now()),o=i.responseType==="arraybuffer"?(e=a.response).byteLength:(e=a.responseText).length,r.loaded=r.total=o;var f={url:a.responseURL,data:e};this.callbacks.onSuccess(f,r,i,a)}else r.retry>=s.maxRetry||t>=400&&t<499?(u.b.error(t+" while loading "+i.url),this.callbacks.onError({code:t,text:a.statusText},i,a)):(u.b.warn(t+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)},l.loadtimeout=function(){u.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},l.loadprogress=function(n){var a=n.currentTarget,h=this.stats;h.loaded=n.loaded,n.lengthComputable&&(h.total=n.total);var r=this.callbacks.onProgress;r&&r(h,this.context,null,a)},g}();function Qe(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Rr=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,d.a.MANIFEST_LOADING,d.a.MANIFEST_PARSED,d.a.AUDIO_TRACK_LOADED,d.a.AUDIO_TRACK_SWITCHED,d.a.LEVEL_LOADED,d.a.ERROR)||this)._trackId=-1,e._selectDefaultTrack=!0,e.tracks=[],e.trackIdBlacklist=Object.create(null),e.audioGroupId=null,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},s.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(d.a.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this._selectAudioGroup(this.hls.nextLoadLevel)},s.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)u.b.warn("Invalid audio track id:",t.id);else{if(u.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()}},s.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},s.onLevelLoaded=function(t){this._selectAudioGroup(t.level)},s.onError=function(t){t.type===S.b.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===S.a.AUDIO_TRACK_LOAD_ERROR&&(u.b.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},s._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)u.b.debug("Same id as current audio-track passed, and track details available -> no-op");else if(t<0||t>=this.tracks.length)u.b.warn("Invalid id passed to audio-track controller");else{var e=this.tracks[t];u.b.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var o=e.url,f=e.type,p=e.id;this.hls.trigger(d.a.AUDIO_TRACK_SWITCHING,{id:p,type:f,url:o}),this._loadTrackDetailsIfNeeded(e)}},s.doTick=function(){this._updateTrack(this._trackId)},s._selectAudioGroup=function(t){var e=this.hls.levels[t];if(e&&e.audioGroupIds){var o=e.audioGroupIds[e.urlId];this.audioGroupId!==o&&(this.audioGroupId=o,this._selectInitialAudioTrack())}},s._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var o=this.tracks[this._trackId],f=null;if(o&&(f=o.name),this._selectDefaultTrack){var p=e.filter(function(L){return L.default});p.length?e=p:u.b.warn("No default audio tracks defined")}var v=!1,b=function(){e.forEach(function(L){v||t.audioGroupId&&L.groupId!==t.audioGroupId||f&&f!==L.name||(t._setAudioTrack(L.id),v=!0)})};b(),v||(f=null,b()),v||(u.b.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:S.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},s._needsTrackLoading=function(t){var e=t.details,o=t.url;return!(e&&!e.live)&&!!o},s._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,o=t.id;u.b.log("loading audio-track playlist for id: "+o),this.hls.trigger(d.a.AUDIO_TRACK_LOADING,{url:e,id:o})}},s._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,u.b.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},s._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],o=e.name,f=e.language,p=e.groupId;u.b.warn("Loading failed on audio track id: "+t+", group-id: "+p+', name/language: "'+o+'" / "'+f+'"');for(var v=t,b=0;b<this.tracks.length;b++)if(!this.trackIdBlacklist[b]&&this.tracks[b].name===o){v=b;break}v!==t?(u.b.log("Attempting audio-track fallback id:",v,"group-id:",this.tracks[v].groupId),this._setAudioTrack(v)):u.b.warn('No fallback audio-track found for name/language: "'+o+'" / "'+f+'"')},h=a,(r=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1}}])&&Qe(h.prototype,r),i&&Qe(h,i),a}(xt);function $e(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Ae=window.performance,Ar=function(g){var l,n;function a(t,e){var o;return(o=g.call(this,t,d.a.MEDIA_ATTACHED,d.a.MEDIA_DETACHING,d.a.AUDIO_TRACKS_UPDATED,d.a.AUDIO_TRACK_SWITCHING,d.a.AUDIO_TRACK_LOADED,d.a.KEY_LOADED,d.a.FRAG_LOADED,d.a.FRAG_PARSING_INIT_SEGMENT,d.a.FRAG_PARSING_DATA,d.a.FRAG_PARSED,d.a.ERROR,d.a.BUFFER_RESET,d.a.BUFFER_CREATED,d.a.BUFFER_APPENDED,d.a.BUFFER_FLUSHED,d.a.INIT_PTS_FOUND)||this).fragmentTracker=e,o.config=t.config,o.audioCodecSwap=!1,o._state=kt,o.initPTS=[],o.waitingFragment=null,o.videoTrackCC=null,o.waitingVideoCC=null,o}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.onInitPtsFound=function(t){var e=t.id,o=t.frag.cc,f=t.initPTS;e==="main"&&(this.initPTS[o]=f,this.videoTrackCC=o,u.b.log("InitPTS for cc: "+o+" found from main: "+f),this.state===se&&this.tick())},s.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&t===-1?(u.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=st):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=Gt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=kt},s.doTick=function(){var t,e,o,f=this.hls,p=f.config;switch(this.state){case Yt:case Wt:case Vt:break;case Gt:this.state=qt,this.loadedmetadata=!1;break;case st:var v=this.tracks;if(!v||!this.media&&(this.startFragRequested||!p.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if((t=this.nextLoadPosition)===void 0)break;var b=this.mediaBuffer?this.mediaBuffer:this.media,L=this.videoBuffer?this.videoBuffer:this.media,C=t<p.maxBufferHole?Math.max(2,p.maxBufferHole):p.maxBufferHole,F=T.bufferInfo(b,t,C),N=T.bufferInfo(L,t,C),Q=F.len,Z=F.end,lt=this.fragPrevious,pt=Math.min(p.maxBufferLength,p.maxMaxBufferLength),vt=Math.max(pt,N.len),at=this.audioSwitch,Bt=this.trackId;if((Q<vt||at)&&Bt<v.length){if((o=v[Bt].details)===void 0){this.state=qt;break}if(!at&&this._streamEnded(F,o))return this.hls.trigger(d.a.BUFFER_EOS,{type:"audio"}),void(this.state=$t);var yt,Qt=o.fragments,fe=Qt.length,le=Qt[0].start,ke=Qt[fe-1].start+Qt[fe-1].duration;if(at){if(o.live&&!o.PTSKnown)u.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),Z=0;else if(Z=t,o.PTSKnown&&t<le){if(!(F.end>le||F.nextStart))return;u.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=le+.05}}if(o.initSegment&&!o.initSegment.data)yt=o.initSegment;else if(Z<=le){if(yt=Qt[0],this.videoTrackCC!==null&&yt.cc!==this.videoTrackCC&&(yt=function(Xe,Er){return y.search(Xe,function(Sr){return Sr.cc<Er?1:Sr.cc>Er?-1:0})}(Qt,this.videoTrackCC)),o.live&&yt.loadIdx&&yt.loadIdx===this.fragLoadIdx){var Ee=F.nextStart?F.nextStart:le;return u.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(Ee+.05)),void(this.media.currentTime=Ee+.05)}}else{var ue,Me=p.maxFragLookUpTolerance,We=lt?Qt[lt.sn-Qt[0].sn+1]:void 0;Z<ke?(Z>ke-Me&&(Me=0),ue=We&&!bt(Z,Me,We)?We:y.search(Qt,function(Xe){return bt(Z,Me,Xe)})):ue=Qt[fe-1],ue&&(yt=ue,le=ue.start,lt&&yt.level===lt.level&&yt.sn===lt.sn&&(yt.sn<o.endSN?(yt=Qt[yt.sn+1-o.startSN],this.fragmentTracker.getState(yt)!==te&&u.b.log("SN just loaded, load next one: "+yt.sn)):yt=null))}yt&&(yt.encrypted?(u.b.log("Loading key for "+yt.sn+" of ["+o.startSN+" ,"+o.endSN+"],track "+Bt),this.state=Ut,f.trigger(d.a.KEY_LOADING,{frag:yt})):(this.fragCurrent=yt,(at||this.fragmentTracker.getState(yt)===wt)&&(u.b.log("Loading "+yt.sn+", cc: "+yt.cc+" of ["+o.startSN+" ,"+o.endSN+"],track "+Bt+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+t+", bufferEnd: "+Z.toFixed(3)),yt.sn!=="initSegment"&&(this.startFragRequested=!0),Object(O.a)(yt.sn)&&(this.nextLoadPosition=yt.start+yt.duration),f.trigger(d.a.FRAG_LOADING,{frag:yt}),this.state=Dt)))}break;case qt:(e=this.tracks[this.trackId])&&e.details&&(this.state=st);break;case re:var zr=Ae.now(),br=this.retryDate,Qr=(b=this.media)&&b.seeking;(!br||zr>=br||Qr)&&(u.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=st);break;case se:var Le=this.waitingFragment;if(Le){var qe=Le.frag.cc;if(this.initPTS[qe]!==void 0)this.waitingFragment=null,this.state=Dt,this.onFragLoaded(Le);else if(this.videoTrackCC!==this.waitingVideoCC)u.b.log("Waiting fragment cc ("+qe+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Tr=T.bufferInfo(this.mediaBuffer,this.media.currentTime,p.maxBufferHole);bt(Tr.end,p.maxFragLookUpTolerance,Le.frag)<0&&(u.b.log("Waiting fragment cc ("+qe+") @ "+Le.frag.start+" cancelled because another fragment at "+Tr.end+" is needed"),this.clearWaitingFragment())}}else this.state=st}},s.clearWaitingFragment=function(){var t=this.waitingFragment;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=st)},s.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var o=this.config;this.tracks&&o.autoStartLoad&&this.startLoad(o.startPosition)},s.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(u.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onAudioTracksUpdated=function(t){u.b.log("audio tracks updated"),this.tracks=t.audioTracks},s.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=Wt,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=st),this.tick()},s.onAudioTrackLoaded=function(t){var e=t.details,o=t.id,f=this.tracks[o],p=f.details,v=e.totalduration,b=0;if(u.b.log("track "+o+" loaded ["+e.startSN+","+e.endSN+"],duration:"+v),e.live||p&&p.live?p&&e.fragments.length>0?(H(p,e),b=e.fragments[0].start,e.PTSKnown?u.b.log("live audio playlist sliding:"+b.toFixed(3)):u.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,u.b.log("live audio playlist - first load, unknown sliding")):e.PTSKnown=!1,f.details=e,!this.startFragRequested){if(this.startPosition===-1){var L=e.startTimeOffset;Object(O.a)(L)?(u.b.log("start time offset found in playlist, adjust startPosition to "+L),this.startPosition=L):e.live?(this.startPosition=this.computeLivePosition(b,e),u.b.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===qt&&(this.state=st),this.tick()},s.onKeyLoaded=function(){this.state===Ut&&(this.state=st,this.tick())},s.onFragLoaded=function(t){var e=this.fragCurrent,o=t.frag;if(this.state===Dt&&e&&o.type==="audio"&&o.level===e.level&&o.sn===e.sn){var f=this.tracks[this.trackId],p=f.details,v=p.totalduration,b=e.level,L=e.sn,C=e.cc,F=this.config.defaultAudioCodec||f.audioCodec||"mp4a.40.2",N=this.stats=t.stats;if(L==="initSegment")this.state=st,N.tparsed=N.tbuffered=Ae.now(),p.initSegment.data=t.payload,this.hls.trigger(d.a.FRAG_BUFFERED,{stats:N,frag:e,id:"audio"}),this.tick();else{this.state=Nt,this.appended=!1,this.demuxer||(this.demuxer=new x(this.hls,"audio"));var Q=this.initPTS[C],Z=p.initSegment?p.initSegment.data:[];Q!==void 0?(this.pendingBuffering=!0,u.b.log("Demuxing "+L+" of ["+p.startSN+" ,"+p.endSN+"],track "+b),this.demuxer.push(t.payload,Z,F,null,e,v,!1,Q)):(u.b.log("Unknown video PTS for cc "+C+", waiting for video PTS before demuxing audio frag "+L+" of ["+p.startSN+" ,"+p.endSN+"],track "+b),this.waitingFragment=t,this.waitingVideoCC=this.videoTrackCC,this.state=se)}}this.fragLoadError=0},s.onFragParsingInitSegment=function(t){var e=this.fragCurrent,o=t.frag;if(e&&t.id==="audio"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt){var f,p=t.tracks;if(p.video&&delete p.video,f=p.audio){f.levelCodec=f.codec,f.id=t.id,this.hls.trigger(d.a.BUFFER_CODECS,p),u.b.log("audio track:audio,container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]");var v=f.initSegment;if(v){var b={type:"audio",data:v,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[b]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(d.a.BUFFER_APPENDING,b))}this.tick()}}},s.onFragParsingData=function(t){var e=this,o=this.fragCurrent,f=t.frag;if(o&&t.id==="audio"&&t.type==="audio"&&f.sn===o.sn&&f.level===o.level&&this.state===Nt){var p=this.trackId,v=this.tracks[p],b=this.hls;Object(O.a)(t.endPTS)||(t.endPTS=t.startPTS+o.duration,t.endDTS=t.startDTS+o.duration),o.addElementaryStream(I.AUDIO),u.b.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),$(v.details,o,t.startPTS,t.endPTS);var L=this.media,C=!1;if(this.audioSwitch)if(L&&L.readyState){var F=L.currentTime;u.b.log("switching audio track : currentTime:"+F),F>=t.startPTS&&(u.b.log("switching audio track : flushing all audio"),this.state=Vt,b.trigger(d.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),C=!0,this.audioSwitch=!1,b.trigger(d.a.AUDIO_TRACK_SWITCHED,{id:p}))}else this.audioSwitch=!1,b.trigger(d.a.AUDIO_TRACK_SWITCHED,{id:p});var N=this.pendingData;if(!N)return u.b.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void b.trigger(d.a.ERROR,{type:S.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(Q){Q&&Q.length&&N.push({type:t.type,data:Q,parent:"audio",content:"data"})}),!C&&N.length&&(N.forEach(function(Q){e.state===Nt&&(e.pendingBuffering=!0,e.hls.trigger(d.a.BUFFER_APPENDING,Q))}),this.pendingData=[],this.appended=!0)),this.tick()}},s.onFragParsed=function(t){var e=this.fragCurrent,o=t.frag;e&&t.id==="audio"&&o.sn===e.sn&&o.level===e.level&&this.state===Nt&&(this.stats.tparsed=Ae.now(),this.state=Kt,this._checkAppendedParsed())},s.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},s.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},s.onBufferAppended=function(t){if(t.parent==="audio"){var e=this.state;e!==Nt&&e!==Kt||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},s._checkAppendedParsed=function(){if(!(this.state!==Kt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,o=this.hls;if(t){this.fragPrevious=t,e.tbuffered=Ae.now(),o.trigger(d.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var f=this.mediaBuffer?this.mediaBuffer:this.media;f&&u.b.log("audio buffered : "+it.toString(f.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,o.trigger(d.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=st}this.tick()}},s.onError=function(t){var e=t.frag;if(!e||e.type==="audio")switch(t.details){case S.a.FRAG_LOAD_ERROR:case S.a.FRAG_LOAD_TIMEOUT:var o=t.frag;if(o&&o.type!=="audio")break;if(!t.fatal){var f=this.fragLoadError;f?f++:f=1;var p=this.config;if(f<=p.fragLoadingMaxRetry){this.fragLoadError=f;var v=Math.min(Math.pow(2,f-1)*p.fragLoadingRetryDelay,p.fragLoadingMaxRetryTimeout);u.b.warn("AudioStreamController: frag loading failed, retry in "+v+" ms"),this.retryDate=Ae.now()+v,this.state=re}else u.b.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Yt}break;case S.a.AUDIO_TRACK_LOAD_ERROR:case S.a.AUDIO_TRACK_LOAD_TIMEOUT:case S.a.KEY_LOAD_ERROR:case S.a.KEY_LOAD_TIMEOUT:this.state!==Yt&&(this.state=t.fatal?Yt:st,u.b.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case S.a.BUFFER_FULL_ERROR:if(t.parent==="audio"&&(this.state===Nt||this.state===Kt)){var b=this.mediaBuffer,L=this.media.currentTime;if(b&&T.isBuffered(b,L)&&T.isBuffered(b,L+.5)){var C=this.config;C.maxMaxBufferLength>=C.maxBufferLength&&(C.maxMaxBufferLength/=2,u.b.warn("AudioStreamController: reduce max buffer length to "+C.maxMaxBufferLength+"s")),this.state=st}else u.b.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Vt,this.hls.trigger(d.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},s.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(u.b.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(o){t.hls.trigger(d.a.BUFFER_APPENDING,o)}),this.appended=!0,this.pendingData=[],this.state=Kt):(this.state=st,this.fragPrevious=null,this.tick())},h=a,(r=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,u.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}])&&$e(h.prototype,r),i&&$e(h,i),a}(ne),Ze=function(){if(typeof window!="undefined"&&window.VTTCue)return window.VTTCue;var g={"":!0,lr:!0,rl:!0},l={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(r){return typeof r=="string"&&!!l[r.toLowerCase()]&&r.toLowerCase()}function a(r){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var t in s)r[t]=s[t]}return r}function h(r,i,s){var t=this,e={enumerable:!0};t.hasBeenReset=!1;var o="",f=!1,p=r,v=i,b=s,L=null,C="",F=!0,N="auto",Q="start",Z=50,lt="middle",pt=50,vt="middle";Object.defineProperty(t,"id",a({},e,{get:function(){return o},set:function(at){o=""+at}})),Object.defineProperty(t,"pauseOnExit",a({},e,{get:function(){return f},set:function(at){f=!!at}})),Object.defineProperty(t,"startTime",a({},e,{get:function(){return p},set:function(at){if(typeof at!="number")throw new TypeError("Start time must be set to a number.");p=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"endTime",a({},e,{get:function(){return v},set:function(at){if(typeof at!="number")throw new TypeError("End time must be set to a number.");v=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"text",a({},e,{get:function(){return b},set:function(at){b=""+at,this.hasBeenReset=!0}})),Object.defineProperty(t,"region",a({},e,{get:function(){return L},set:function(at){L=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"vertical",a({},e,{get:function(){return C},set:function(at){var Bt=function(yt){return typeof yt=="string"&&!!g[yt.toLowerCase()]&&yt.toLowerCase()}(at);if(Bt===!1)throw new SyntaxError("An invalid or illegal string was specified.");C=Bt,this.hasBeenReset=!0}})),Object.defineProperty(t,"snapToLines",a({},e,{get:function(){return F},set:function(at){F=!!at,this.hasBeenReset=!0}})),Object.defineProperty(t,"line",a({},e,{get:function(){return N},set:function(at){if(typeof at!="number"&&at!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");N=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"lineAlign",a({},e,{get:function(){return Q},set:function(at){var Bt=n(at);if(!Bt)throw new SyntaxError("An invalid or illegal string was specified.");Q=Bt,this.hasBeenReset=!0}})),Object.defineProperty(t,"position",a({},e,{get:function(){return Z},set:function(at){if(at<0||at>100)throw new Error("Position must be between 0 and 100.");Z=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"positionAlign",a({},e,{get:function(){return lt},set:function(at){var Bt=n(at);if(!Bt)throw new SyntaxError("An invalid or illegal string was specified.");lt=Bt,this.hasBeenReset=!0}})),Object.defineProperty(t,"size",a({},e,{get:function(){return pt},set:function(at){if(at<0||at>100)throw new Error("Size must be between 0 and 100.");pt=at,this.hasBeenReset=!0}})),Object.defineProperty(t,"align",a({},e,{get:function(){return vt},set:function(at){var Bt=n(at);if(!Bt)throw new SyntaxError("An invalid or illegal string was specified.");vt=Bt,this.hasBeenReset=!0}})),t.displayState=void 0}return h.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},h}(),kr=function(){return{decode:function(g){if(!g)return"";if(typeof g!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(g))}}};function Je(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new kr,this.regionList=[]}function tr(){this.values=Object.create(null)}function er(g,l,n,a){var h=a?g.split(a):[g];for(var r in h)if(typeof h[r]=="string"){var i=h[r].split(n);i.length===2&&l(i[0],i[1])}}tr.prototype={set:function(g,l){this.get(g)||l===""||(this.values[g]=l)},get:function(g,l,n){return n?this.has(g)?this.values[g]:l[n]:this.has(g)?this.values[g]:l},has:function(g){return g in this.values},alt:function(g,l,n){for(var a=0;a<n.length;++a)if(l===n[a]){this.set(g,l);break}},integer:function(g,l){/^-?\d+$/.test(l)&&this.set(g,parseInt(l,10))},percent:function(g,l){return!!(l.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(l=parseFloat(l))>=0&&l<=100)&&(this.set(g,l),!0)}};var Ke=new Ze(0,0,0),Ie=Ke.align==="middle"?"middle":"center";function Lr(g,l,n){var a=g;function h(){var i=function(s){function t(o,f,p,v){return 3600*(0|o)+60*(0|f)+(0|p)+(0|v)/1e3}var e=s.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return e?e[3]?t(e[1],e[2],e[3].replace(":",""),e[4]):e[1]>59?t(e[1],e[2],0,e[4]):t(0,e[1],e[2],e[4]):null}(g);if(i===null)throw new Error("Malformed timestamp: "+a);return g=g.replace(/^[^\sa-zA-Z-]+/,""),i}function r(){g=g.replace(/^\s+/,"")}if(r(),l.startTime=h(),r(),g.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+a);g=g.substr(3),r(),l.endTime=h(),r(),function(i,s){var t=new tr;er(i,function(f,p){switch(f){case"region":for(var v=n.length-1;v>=0;v--)if(n[v].id===p){t.set(f,n[v].region);break}break;case"vertical":t.alt(f,p,["rl","lr"]);break;case"line":var b=p.split(","),L=b[0];t.integer(f,L),t.percent(f,L)&&t.set("snapToLines",!1),t.alt(f,L,["auto"]),b.length===2&&t.alt("lineAlign",b[1],["start",Ie,"end"]);break;case"position":b=p.split(","),t.percent(f,b[0]),b.length===2&&t.alt("positionAlign",b[1],["start",Ie,"end","line-left","line-right","auto"]);break;case"size":t.percent(f,p);break;case"align":t.alt(f,p,["start",Ie,"end","left","right"])}},/:/,/\s/),s.region=t.get("region",null),s.vertical=t.get("vertical","");var e=t.get("line","auto");e==="auto"&&Ke.line===-1&&(e=-1),s.line=e,s.lineAlign=t.get("lineAlign","start"),s.snapToLines=t.get("snapToLines",!0),s.size=t.get("size",100),s.align=t.get("align",Ie);var o=t.get("position","auto");o==="auto"&&Ke.position===50&&(o=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=o}(g,l)}function rr(g){return g.replace(/<br(?: \/)?>/gi,`
`)}Je.prototype={parse:function(g){var l=this;function n(){var s=l.buffer,t=0;for(s=rr(s);t<s.length&&s[t]!=="\r"&&s[t]!==`
`;)++t;var e=s.substr(0,t);return s[t]==="\r"&&++t,s[t]===`
`&&++t,l.buffer=s.substr(t),e}g&&(l.buffer+=l.decoder.decode(g,{stream:!0}));try{var a;if(l.state==="INITIAL"){if(!/\r\n|\n/.test(l.buffer))return this;var h=(a=n()).match(/^()?WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new Error("Malformed WebVTT signature.");l.state="HEADER"}for(var r=!1;l.buffer;){if(!/\r\n|\n/.test(l.buffer))return this;switch(r?r=!1:a=n(),l.state){case"HEADER":/:/.test(a)?er(a,function(s,t){},/:/):a||(l.state="ID");continue;case"NOTE":a||(l.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){l.state="NOTE";break}if(!a)continue;if(l.cue=new Ze(0,0,""),l.state="CUE",a.indexOf("-->")===-1){l.cue.id=a;continue}case"CUE":try{Lr(a,l.cue,l.regionList)}catch(s){l.cue=null,l.state="BADCUE";continue}l.state="CUETEXT";continue;case"CUETEXT":var i=a.indexOf("-->")!==-1;if(!a||i&&(r=!0)){l.oncue&&l.oncue(l.cue),l.cue=null,l.state="ID";continue}l.cue.text&&(l.cue.text+=`
`),l.cue.text+=a;continue;case"BADCUE":a||(l.state="ID");continue}}}catch(s){l.state==="CUETEXT"&&l.cue&&l.oncue&&l.oncue(l.cue),l.cue=null,l.state=l.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||this.state==="HEADER")&&(this.buffer+=`

`,this.parse()),this.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(g){throw g}return this.onflush&&this.onflush(),this}};var wr=Je;function Dr(g,l,n,a){for(var h,r,i,s,t,e=[],o=window.VTTCue||TextTrackCue,f=0;f<a.rows.length;f++)if(i=!0,s=0,t="",!(h=a.rows[f]).isEmpty()){for(var p=0;p<h.chars.length;p++)h.chars[p].uchar.match(/\s/)&&i?s++:(t+=h.chars[p].uchar,i=!1);h.cueStartTime=l,l===n&&(n+=1e-4),r=new o(l,n,rr(t.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?r.line=f+1:r.line=f>7?f-2:f+1,r.align="left",r.position=Math.max(0,Math.min(100,s/32*100)),e.push(r),g&&g.addCue(r)}return e}var ft,ir={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ar=function(g){var l=g;return ir.hasOwnProperty(g)&&(l=ir[g]),String.fromCharCode(l)},Cr={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Or={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ir={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Pr={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xr=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(g){g[g.ERROR=0]="ERROR",g[g.TEXT=1]="TEXT",g[g.WARNING=2]="WARNING",g[g.INFO=2]="INFO",g[g.DEBUG=3]="DEBUG",g[g.DATA=3]="DATA"})(ft||(ft={}));var Mr=function(){function g(){this.time=null,this.verboseLevel=ft.ERROR}return g.prototype.log=function(l,n){this.verboseLevel>=l&&u.b.log(this.time+" ["+l+"] "+n)},g}(),me=function(g){for(var l=[],n=0;n<g.length;n++)l.push(g[n].toString(16));return l},nr=function(){function g(n,a,h,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=n||"white",this.underline=a||!1,this.italics=h||!1,this.background=r||"black",this.flash=i||!1}var l=g.prototype;return l.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},l.setStyles=function(n){for(var a=["foreground","underline","italics","background","flash"],h=0;h<a.length;h++){var r=a[h];n.hasOwnProperty(r)&&(this[r]=n[r])}},l.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},l.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},l.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},l.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),Fr=function(){function g(n,a,h,r,i,s){this.uchar=void 0,this.penState=void 0,this.uchar=n||" ",this.penState=new nr(a,h,r,i,s)}var l=g.prototype;return l.reset=function(){this.uchar=" ",this.penState.reset()},l.setChar=function(n,a){this.uchar=n,this.penState.copy(a)},l.setPenState=function(n){this.penState.copy(n)},l.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},l.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},l.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),Ur=function(){function g(n){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<100;a++)this.chars.push(new Fr);this.logger=n,this.pos=0,this.currPenState=new nr}var l=g.prototype;return l.equals=function(n){for(var a=!0,h=0;h<100;h++)if(!this.chars[h].equals(n.chars[h])){a=!1;break}return a},l.copy=function(n){for(var a=0;a<100;a++)this.chars[a].copy(n.chars[a])},l.isEmpty=function(){for(var n=!0,a=0;a<100;a++)if(!this.chars[a].isEmpty()){n=!1;break}return n},l.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(ft.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(ft.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},l.moveCursor=function(n){var a=this.pos+n;if(n>1)for(var h=this.pos+1;h<a+1;h++)this.chars[h].setPenState(this.currPenState);this.setCursor(a)},l.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},l.insertChar=function(n){n>=144&&this.backSpace();var a=ar(n);this.pos>=100?this.logger.log(ft.ERROR,"Cannot insert "+n.toString(16)+" ("+a+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1))},l.clearFromPos=function(n){var a;for(a=n;a<100;a++)this.chars[a].reset()},l.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},l.clearToEndOfRow=function(){this.clearFromPos(this.pos)},l.getTextString=function(){for(var n=[],a=!0,h=0;h<100;h++){var r=this.chars[h].uchar;r!==" "&&(a=!1),n.push(r)}return a?"":n.join("")},l.setPenStyles=function(n){this.currPenState.setStyles(n),this.chars[this.pos].setPenState(this.currPenState)},g}(),je=function(){function g(n){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var a=0;a<15;a++)this.rows.push(new Ur(n));this.logger=n,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var l=g.prototype;return l.reset=function(){for(var n=0;n<15;n++)this.rows[n].clear();this.currRow=14},l.equals=function(n){for(var a=!0,h=0;h<15;h++)if(!this.rows[h].equals(n.rows[h])){a=!1;break}return a},l.copy=function(n){for(var a=0;a<15;a++)this.rows[a].copy(n.rows[a])},l.isEmpty=function(){for(var n=!0,a=0;a<15;a++)if(!this.rows[a].isEmpty()){n=!1;break}return n},l.backSpace=function(){this.rows[this.currRow].backSpace()},l.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},l.insertChar=function(n){this.rows[this.currRow].insertChar(n)},l.setPen=function(n){this.rows[this.currRow].setPenStyles(n)},l.moveCursor=function(n){this.rows[this.currRow].moveCursor(n)},l.setCursor=function(n){this.logger.log(ft.INFO,"setCursor: "+n),this.rows[this.currRow].setCursor(n)},l.setPAC=function(n){this.logger.log(ft.INFO,"pacData = "+JSON.stringify(n));var a=n.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(var h=0;h<15;h++)this.rows[h].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var s=i.rows[r].cueStartTime,t=this.logger.time;if(s&&t!==null&&s<t)for(var e=0;e<this.nrRollUpRows;e++)this.rows[a-this.nrRollUpRows+e+1].copy(i.rows[r+e])}}this.currRow=a;var o=this.rows[this.currRow];if(n.indent!==null){var f=n.indent,p=Math.max(f-1,0);o.setCursor(n.indent),n.color=o.chars[p].penState.foreground}var v={foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1};this.setPen(v)},l.setBkgData=function(n){this.logger.log(ft.INFO,"bkgData = "+JSON.stringify(n)),this.backSpace(),this.setPen(n),this.insertChar(32)},l.setRollUpRows=function(n){this.nrRollUpRows=n},l.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(ft.TEXT,this.getDisplayText());var n=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(n,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(ft.INFO,"Rolling up")}else this.logger.log(ft.DEBUG,"roll_up but nrRollUpRows not set yet")},l.getDisplayText=function(n){n=n||!1;for(var a=[],h="",r=-1,i=0;i<15;i++){var s=this.rows[i].getTextString();s&&(r=i+1,n?a.push("Row "+r+": '"+s+"'"):a.push(s.trim()))}return a.length>0&&(h=n?"["+a.join(" | ")+"]":a.join(`
`)),h},l.getTextAndFormat=function(){return this.rows},g}(),sr=function(){function g(n,a,h){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new je(h),this.nonDisplayedMemory=new je(h),this.lastOutputScreen=new je(h),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=h}var l=g.prototype;return l.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},l.getHandler=function(){return this.outputFilter},l.setHandler=function(n){this.outputFilter=n},l.setPAC=function(n){this.writeScreen.setPAC(n)},l.setBkgData=function(n){this.writeScreen.setBkgData(n)},l.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(ft.INFO,"MODE="+n),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},l.insertChars=function(n){for(var a=0;a<n.length;a++)this.writeScreen.insertChar(n[a]);var h=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(ft.INFO,h+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(ft.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},l.ccRCL=function(){this.logger.log(ft.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},l.ccBS=function(){this.logger.log(ft.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},l.ccAOF=function(){},l.ccAON=function(){},l.ccDER=function(){this.logger.log(ft.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},l.ccRU=function(n){this.logger.log(ft.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},l.ccFON=function(){this.logger.log(ft.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},l.ccRDC=function(){this.logger.log(ft.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},l.ccTR=function(){this.logger.log(ft.INFO,"TR"),this.setMode("MODE_TEXT")},l.ccRTD=function(){this.logger.log(ft.INFO,"RTD"),this.setMode("MODE_TEXT")},l.ccEDM=function(){this.logger.log(ft.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},l.ccCR=function(){this.logger.log(ft.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},l.ccENM=function(){this.logger.log(ft.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},l.ccEOC=function(){if(this.logger.log(ft.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=n,this.writeScreen=this.nonDisplayedMemory,this.logger.log(ft.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},l.ccTO=function(n){this.logger.log(ft.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},l.ccMIDROW=function(n){var a={flash:!1};if(a.underline=n%2==1,a.italics=n>=46,a.italics)a.foreground="white";else{var h=Math.floor(n/2)-16;a.foreground=["white","green","blue","cyan","red","yellow","magenta"][h]}this.logger.log(ft.INFO,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)},l.outputDataUpdate=function(n){n===void 0&&(n=!1);var a=this.logger.time;a!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))},l.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},g}();function be(g,l,n){n.a=g,n.b=l}function or(g,l,n){return n.a===g&&n.b===l}var lr=function(){function g(n,a,h){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Mr;this.channels=[null,new sr(n,a,r),new sr(n+1,h,r)],this.cmdHistory={a:null,b:null},this.logger=r}var l=g.prototype;return l.getHandler=function(n){return this.channels[n].getHandler()},l.setHandler=function(n,a){this.channels[n].setHandler(a)},l.addData=function(n,a){var h,r,i,s=!1;this.logger.time=n;for(var t=0;t<a.length;t+=2)if(r=127&a[t],i=127&a[t+1],r!==0||i!==0){if(this.logger.log(ft.DATA,"["+me([a[t],a[t+1]])+"] -> ("+me([r,i])+")"),(h=this.parseCmd(r,i))||(h=this.parseMidrow(r,i)),h||(h=this.parsePAC(r,i)),h||(h=this.parseBackgroundAttributes(r,i)),!h&&(s=this.parseChars(r,i))){var e=this.currentChannel;e&&e>0?this.channels[e].insertChars(s):this.logger.log(ft.WARNING,"No channel found yet. TEXT-MODE?")}h||s||this.logger.log(ft.WARNING,"Couldn't parse cleaned data "+me([r,i])+" orig: "+me([a[t],a[t+1]]))}},l.parseCmd=function(n,a){var h=this.cmdHistory;if(!((n===20||n===28||n===21||n===29)&&a>=32&&a<=47)&&!((n===23||n===31)&&a>=33&&a<=35))return!1;if(or(n,a,h))return be(null,null,h),this.logger.log(ft.DEBUG,"Repeated command ("+me([n,a])+") is dropped"),!0;var r=n===20||n===21||n===23?1:2,i=this.channels[r];return n===20||n===21||n===28||n===29?a===32?i.ccRCL():a===33?i.ccBS():a===34?i.ccAOF():a===35?i.ccAON():a===36?i.ccDER():a===37?i.ccRU(2):a===38?i.ccRU(3):a===39?i.ccRU(4):a===40?i.ccFON():a===41?i.ccRDC():a===42?i.ccTR():a===43?i.ccRTD():a===44?i.ccEDM():a===45?i.ccCR():a===46?i.ccENM():a===47&&i.ccEOC():i.ccTO(a-32),be(n,a,h),this.currentChannel=r,!0},l.parseMidrow=function(n,a){var h=0;if((n===17||n===25)&&a>=32&&a<=47){if((h=n===17?1:2)!==this.currentChannel)return this.logger.log(ft.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[h];return!!r&&(r.ccMIDROW(a),this.logger.log(ft.DEBUG,"MIDROW ("+me([n,a])+")"),!0)}return!1},l.parsePAC=function(n,a){var h,r=this.cmdHistory;if(!((n>=17&&n<=23||n>=25&&n<=31)&&a>=64&&a<=127)&&!((n===16||n===24)&&a>=64&&a<=95))return!1;if(or(n,a,r))return be(null,null,r),!0;var i=n<=23?1:2;h=a>=64&&a<=95?i===1?Cr[n]:Ir[n]:i===1?Or[n]:Pr[n];var s=this.channels[i];return!!s&&(s.setPAC(this.interpretPAC(h,a)),be(n,a,r),this.currentChannel=i,!0)},l.interpretPAC=function(n,a){var h=a,r={color:null,italics:!1,indent:null,underline:!1,row:n};return h=a>95?a-96:a-64,r.underline=(1&h)==1,h<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(h/2)]:h<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((h-16)/2),r},l.parseChars=function(n,a){var h,r=null,i=null;if(n>=25?(h=2,i=n-8):(h=1,i=n),i>=17&&i<=19){var s=a;s=i===17?a+80:i===18?a+112:a+144,this.logger.log(ft.INFO,"Special char '"+ar(s)+"' in channel "+h),r=[s]}else n>=32&&n<=127&&(r=a===0?[n]:[n,a]);if(r){var t=me(r);this.logger.log(ft.DEBUG,"Char codes =  "+t.join(",")),be(n,a,this.cmdHistory)}return r},l.parseBackgroundAttributes=function(n,a){var h;if(!((n===16||n===24)&&a>=32&&a<=47)&&!((n===23||n===31)&&a>=45&&a<=47))return!1;var r={};n===16||n===24?(h=Math.floor((a-32)/2),r.background=xr[h],a%2==1&&(r.background=r.background+"_semi")):a===45?r.background="transparent":(r.foreground="black",a===47&&(r.underline=!0));var i=n<=23?1:2;return this.channels[i].setBkgData(r),be(n,a,this.cmdHistory),!0},l.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var a=this.channels[n];a&&a.reset()}this.cmdHistory={a:null,b:null}},l.cueSplitAtTime=function(n){for(var a=0;a<this.channels.length;a++){var h=this.channels[a];h&&h.cueSplitAtTime(n)}},g}(),Pe=function(){function g(n,a){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=n,this.trackName=a}var l=g.prototype;return l.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},l.newCue=function(n,a,h){(this.startTime===null||this.startTime>n)&&(this.startTime=n),this.endTime=a,this.screen=h,this.timelineController.createCaptionsTrack(this.trackName)},l.reset=function(){this.cueRanges=[]},g}(),He=function(g,l,n){return g.substr(n||0,l.length)===l},Ve=function(g){for(var l=5381,n=g.length;n;)l=33*l^g.charCodeAt(--n);return(l>>>0).toString()},Nr={parse:function(g,l,n,a,h,r){var i,s=Object(ye.b)(new Uint8Array(g)).trim().replace(/\r\n|\n\r|\n|\r/g,`
`).split(`
`),t="00:00.000",e=0,o=0,f=0,p=[],v=!0,b=!1,L=new wr;L.oncue=function(C){var F=n[a],N=n.ccOffset;F&&F.new&&(o!==void 0?N=n.ccOffset=F.start:function(Q,Z,lt){var pt=Q[Z],vt=Q[pt.prevCC];if(!vt||!vt.new&&pt.new)return Q.ccOffset=Q.presentationOffset=pt.start,void(pt.new=!1);for(;vt&&vt.new;)Q.ccOffset+=pt.start-vt.start,pt.new=!1,vt=Q[(pt=vt).prevCC];Q.presentationOffset=lt}(n,a,f)),f&&(N=f-n.presentationOffset),b&&(C.startTime+=N-o,C.endTime+=N-o),C.id=Ve(C.startTime.toString())+Ve(C.endTime.toString())+Ve(C.text),C.text=decodeURIComponent(encodeURIComponent(C.text)),C.endTime>0&&p.push(C)},L.onparsingerror=function(C){i=C},L.onflush=function(){i&&r?r(i):h(p)},s.forEach(function(C){if(v){if(He(C,"X-TIMESTAMP-MAP=")){v=!1,b=!0,C.substr(16).split(",").forEach(function(F){He(F,"LOCAL:")?t=F.substr(6):He(F,"MPEGTS:")&&(e=parseInt(F.substr(7)))});try{l+(9e4*n[a].start||0)<0&&(l+=8589934592),e-=l,o=function(F){var N=parseInt(F.substr(-3)),Q=parseInt(F.substr(-6,2)),Z=parseInt(F.substr(-9,2)),lt=F.length>9?parseInt(F.substr(0,F.indexOf(":"))):0;if(!(Object(O.a)(N)&&Object(O.a)(Q)&&Object(O.a)(Z)&&Object(O.a)(lt)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+F);return N+=1e3*Q,N+=6e4*Z,N+=36e5*lt}(t)/1e3,f=e/9e4}catch(F){b=!1,i=F}return}C===""&&(v=!1)}L.parse(C+`
`)}),L.flush()}};function xe(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function Br(g,l){return g&&g.label===l.name&&!(g.textTrack1||g.textTrack2)}var Gr=function(g){var l,n;function a(r){var i;if((i=g.call(this,r,d.a.MEDIA_ATTACHING,d.a.MEDIA_DETACHING,d.a.FRAG_PARSING_USERDATA,d.a.FRAG_DECRYPTED,d.a.MANIFEST_LOADING,d.a.MANIFEST_LOADED,d.a.FRAG_LOADED,d.a.INIT_PTS_FOUND)||this).media=null,i.config=void 0,i.enabled=!0,i.Cues=void 0,i.textTracks=[],i.tracks=[],i.initPTS=[],i.unparsedVttFrags=[],i.captionsTracks={},i.nonNativeCaptionsTracks={},i.captionsProperties=void 0,i.cea608Parser1=void 0,i.cea608Parser2=void 0,i.lastSn=-1,i.prevCC=-1,i.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},i.hls=r,i.config=r.config,i.Cues=r.config.cueHandler,i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode},textTrack3:{label:i.config.captionsTextTrack3Label,languageCode:i.config.captionsTextTrack3LanguageCode},textTrack4:{label:i.config.captionsTextTrack4Label,languageCode:i.config.captionsTextTrack4LanguageCode}},i.config.enableCEA708Captions){var s=new Pe(xe(i),"textTrack1"),t=new Pe(xe(i),"textTrack2"),e=new Pe(xe(i),"textTrack3"),o=new Pe(xe(i),"textTrack4");i.cea608Parser1=new lr(1,s,t),i.cea608Parser2=new lr(3,e,o)}return i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.addCues=function(r,i,s,t,e){for(var o,f,p,v,b=!1,L=e.length;L--;){var C=e[L],F=(o=C[0],f=C[1],p=i,v=s,Math.min(f,v)-Math.max(o,p));if(F>=0&&(C[0]=Math.min(C[0],i),C[1]=Math.max(C[1],s),b=!0,F/(s-i)>.5))return}if(b||e.push([i,s]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[r],i,s,t);else{var N=this.Cues.newCue(null,i,s,t);this.hls.trigger(d.a.CUES_PARSED,{type:"captions",cues:N,track:r})}},h.onInitPtsFound=function(r){var i=this,s=r.frag,t=r.id,e=r.initPTS,o=this.unparsedVttFrags;t==="main"&&(this.initPTS[s.cc]=e),o.length&&(this.unparsedVttFrags=[],o.forEach(function(f){i.onFragLoaded(f)}))},h.getExistingTrack=function(r){var i=this.media;if(i)for(var s=0;s<i.textTracks.length;s++){var t=i.textTracks[s];if(t[r])return t}return null},h.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},h.createNativeTrack=function(r){if(!this.captionsTracks[r]){var i=this.captionsProperties,s=this.captionsTracks,t=this.media,e=i[r],o=e.label,f=e.languageCode,p=this.getExistingTrack(r);if(p)s[r]=p,oe(s[r]),we(s[r],t);else{var v=this.createTextTrack("captions",o,f);v&&(v[r]=!0,s[r]=v)}}},h.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var i=this.captionsProperties[r];if(i){var s={_id:r,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[r]=s,this.hls.trigger(d.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}}},h.createTextTrack=function(r,i,s){var t=this.media;if(t)return t.addTextTrack(r,i,s)},h.destroy=function(){g.prototype.destroy.call(this)},h.onMediaAttaching=function(r){this.media=r.media,this._cleanTracks()},h.onMediaDetaching=function(){var r=this.captionsTracks;Object.keys(r).forEach(function(i){oe(r[i]),delete r[i]}),this.nonNativeCaptionsTracks={}},h.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},h._cleanTracks=function(){var r=this.media;if(r){var i=r.textTracks;if(i)for(var s=0;s<i.length;s++)oe(i[s])}},h.onManifestLoaded=function(r){var i=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var s=r.subtitles||[],t=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=r.subtitles||[],this.config.renderTextTracksNatively){var e=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,p){var v;if(p<e.length){for(var b=null,L=0;L<e.length;L++)if(Br(e[L],f)){b=e[L];break}b&&(v=b)}v||(v=i.createTextTrack("subtitles",f.name,f.lang)),f.default?v.mode=i.hls.subtitleDisplay?"showing":"hidden":v.mode="disabled",i.textTracks.push(v)})}else if(!t&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(d.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}this.config.enableCEA708Captions&&r.captions&&r.captions.forEach(function(f){var p=/(?:CC|SERVICE)([1-4])/.exec(f.instreamId);if(p){var v="textTrack"+p[1],b=i.captionsProperties[v];b&&(b.label=f.name,f.lang&&(b.languageCode=f.lang),b.media=f)}})},h.onFragLoaded=function(r){var i=r.frag,s=r.payload,t=this.cea608Parser1,e=this.cea608Parser2,o=this.initPTS,f=this.lastSn,p=this.unparsedVttFrags;if(i.type==="main"){var v=i.sn;i.sn!==f+1&&t&&e&&(t.reset(),e.reset()),this.lastSn=v}else if(i.type==="subtitle")if(s.byteLength){if(!Object(O.a)(o[i.cc]))return p.push(r),void(o.length&&this.hls.trigger(d.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}));var b=i.decryptdata;b!=null&&b.key!=null&&b.method==="AES-128"||this._parseVTTs(i,s)}else this.hls.trigger(d.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i})},h._parseVTTs=function(r,i){var s=this,t=this.hls,e=this.prevCC,o=this.textTracks,f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:e,new:!0},this.prevCC=r.cc),Nr.parse(i,this.initPTS[r.cc],f,r.cc,function(p){if(s.config.renderTextTracksNatively){var v=o[r.level];if(v.mode==="disabled")return void t.trigger(d.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r});p.forEach(function(L){if(!v.cues.getCueById(L.id))try{if(v.addCue(L),!v.cues.getCueById(L.id))throw new Error("addCue is failed for: "+L)}catch(F){u.b.debug("Failed occurred on adding cues: "+F);var C=new window.TextTrackCue(L.startTime,L.endTime,L.text);C.id=L.id,v.addCue(C)}})}else{var b=s.tracks[r.level].default?"default":"subtitles"+r.level;t.trigger(d.a.CUES_PARSED,{type:"subtitles",cues:p,track:b})}t.trigger(d.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(p){u.b.log("Failed to parse VTT cue: "+p),t.trigger(d.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r})})},h.onFragDecrypted=function(r){var i=r.frag,s=r.payload;if(i.type==="subtitle"){if(!Object(O.a)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(r);this._parseVTTs(i,s)}},h.onFragParsingUserdata=function(r){var i=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&i&&s)for(var t=0;t<r.samples.length;t++){var e=r.samples[t].bytes;if(e){var o=this.extractCea608Data(e);i.addData(r.samples[t].pts,o[0]),s.addData(r.samples[t].pts,o[1])}}},h.extractCea608Data=function(r){for(var i=31&r[0],s=2,t=[[],[]],e=0;e<i;e++){var o=r[s++],f=127&r[s++],p=127&r[s++],v=3&o;f===0&&p===0||4&o&&(v!==0&&v!==1||(t[v].push(f),t[v].push(p)))}return t},a}(k);function ur(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}function Ye(g){for(var l=[],n=0;n<g.length;n++){var a=g[n];a.kind==="subtitles"&&a.label&&l.push(g[n])}return l}var Kr=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,d.a.MEDIA_ATTACHED,d.a.MEDIA_DETACHING,d.a.MANIFEST_LOADED,d.a.SUBTITLE_TRACK_LOADED)||this).tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=!0,e.queuedDefaultTrack=null,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.destroy=function(){k.prototype.destroy.call(this)},s.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(Object(O.a)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(O.a)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Ye(this.media.textTracks).forEach(function(t){oe(t)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoaded=function(t){var e=this,o=t.subtitles||[];this.tracks=o,this.hls.trigger(d.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:o}),o.forEach(function(f){f.default&&(e.media?e.subtitleTrack=f.id:e.queuedDefaultTrack=f.id)})},s.onSubtitleTrackLoaded=function(t){var e=this,o=t.id,f=t.details,p=this.trackId,v=this.tracks,b=v[p];if(o>=v.length||o!==p||!b||this.stopped)this._clearReloadTimer();else if(u.b.log("subtitle track "+o+" loaded"),f.live){var L=tt(b.details,f,t.stats.trequest);u.b.log("Reloading live subtitle playlist in "+L+"ms"),this.timer=setTimeout(function(){e._loadCurrentTrack()},L)}else this._clearReloadTimer()},s.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},s._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s._loadCurrentTrack=function(){var t=this.trackId,e=this.tracks,o=this.hls,f=e[t];t<0||!f||f.details&&!f.details.live||(u.b.log("Loading subtitle track "+t),o.trigger(d.a.SUBTITLE_TRACK_LOADING,{url:f.url,id:t}))},s._toggleTrackModes=function(t){var e=this.media,o=this.subtitleDisplay,f=this.trackId;if(e){var p=Ye(e.textTracks);if(t===-1)[].slice.call(p).forEach(function(L){L.mode="disabled"});else{var v=p[f];v&&(v.mode="disabled")}var b=p[t];b&&(b.mode=o?"showing":"hidden")}},s._setSubtitleTrackInternal=function(t){var e=this.hls,o=this.tracks;!Object(O.a)(t)||t<-1||t>=o.length||(this.trackId=t,u.b.log("Switching to subtitle track "+t),e.trigger(d.a.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},s._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=Ye(this.media.textTracks),o=0;o<e.length;o++)if(e[o].mode==="hidden")t=o;else if(e[o].mode==="showing"){t=o;break}this.subtitleTrack=t}},h=a,(r=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this._setSubtitleTrackInternal(t))}}])&&ur(h.prototype,r),i&&ur(h,i),a}(k),jr=J(7),Te,dr=window.performance,Hr=function(g){var l,n;function a(r,i){var s;return(s=g.call(this,r,d.a.MEDIA_ATTACHED,d.a.MEDIA_DETACHING,d.a.ERROR,d.a.KEY_LOADED,d.a.FRAG_LOADED,d.a.SUBTITLE_TRACKS_UPDATED,d.a.SUBTITLE_TRACK_SWITCH,d.a.SUBTITLE_TRACK_LOADED,d.a.SUBTITLE_FRAG_PROCESSED,d.a.LEVEL_UPDATED)||this).fragmentTracker=i,s.config=r.config,s.state=kt,s.tracks=[],s.tracksBuffered=[],s.currentTrackId=-1,s.decrypter=new jr.a(r,r.config),s.lastAVStart=0,s._onMediaSeeking=s.onMediaSeeking.bind(function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s)),s}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h=a.prototype;return h.startLoad=function(){this.stopLoad(),this.state=st;var r=this.tracks[this.currentTrackId];r&&r.details&&(this.setInterval(500),this.tick())},h.onSubtitleFragProcessed=function(r){var i=r.frag,s=r.success;if(this.fragPrevious=i,this.state=st,s){var t=this.tracksBuffered[this.currentTrackId];if(t){for(var e,o=i.start,f=0;f<t.length;f++)if(o>=t[f].start&&o<=t[f].end){e=t[f];break}var p=i.start+i.duration;e?e.end=p:(e={start:o,end:p},t.push(e))}}},h.onMediaAttached=function(r){var i=r.media;this.media=i,i.addEventListener("seeking",this._onMediaSeeking),this.state=st},h.onMediaDetaching=function(){var r=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(i){r.tracksBuffered[i.id]=[]}),this.media=null,this.state=kt)},h.onError=function(r){var i=r.frag;i&&i.type==="subtitle"&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=st)},h.onSubtitleTracksUpdated=function(r){var i=this;u.b.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=r.subtitleTracks,this.tracks.forEach(function(s){i.tracksBuffered[s.id]=[]})},h.onSubtitleTrackSwitch=function(r){if(this.currentTrackId=r.id,this.tracks&&this.tracks.length&&this.currentTrackId!==-1){var i=this.tracks[this.currentTrackId];i&&i.details&&this.setInterval(500)}else this.clearInterval()},h.onSubtitleTrackLoaded=function(r){var i=r.id,s=r.details,t=this.currentTrackId,e=this.tracks,o=e[t];i>=e.length||i!==t||!o||(s.live&&function(f,p,v){v===void 0&&(v=0);var b=-1;X(f,p,function(F,N,Q){N.start=F.start,b=Q});var L=p.fragments;if(b<0)L.forEach(function(F){F.start+=v});else for(var C=b+1;C<L.length;C++)L[C].start=L[C-1].start+L[C-1].duration}(o.details,s,this.lastAVStart),o.details=s,this.setInterval(500))},h.onKeyLoaded=function(){this.state===Ut&&(this.state=st)},h.onFragLoaded=function(r){var i=this.fragCurrent,s=r.frag.decryptdata,t=r.frag,e=this.hls;if(this.state===Dt&&i&&r.frag.type==="subtitle"&&i.sn===r.frag.sn&&r.payload.byteLength>0&&s&&s.key&&s.method==="AES-128"){var o=dr.now();this.decrypter.decrypt(r.payload,s.key.buffer,s.iv.buffer,function(f){var p=dr.now();e.trigger(d.a.FRAG_DECRYPTED,{frag:t,payload:f,stats:{tstart:o,tdecrypt:p}})})}},h.onLevelUpdated=function(r){var i=r.details.fragments;this.lastAVStart=i.length?i[0].start:0},h.doTick=function(){if(this.media)switch(this.state){case st:var r=this.config,i=this.currentTrackId,s=this.fragmentTracker,t=this.media,e=this.tracks;if(!e||!e[i]||!e[i].details)break;var o,f=r.maxBufferHole,p=r.maxFragLookUpTolerance,v=Math.min(r.maxBufferLength,r.maxMaxBufferLength),b=T.bufferedInfo(this._getBuffered(),t.currentTime,f),L=b.end,C=b.len,F=e[i].details,N=F.fragments,Q=N.length,Z=N[Q-1].start+N[Q-1].duration;if(C>v)return;var lt=this.fragPrevious;L<Z?(lt&&F.hasProgramDateTime&&(o=It(N,lt.endProgramDateTime,p)),o||(o=ht(lt,N,L,p))):o=N[Q-1],o&&o.encrypted?(u.b.log("Loading key for "+o.sn),this.state=Ut,this.hls.trigger(d.a.KEY_LOADING,{frag:o})):o&&s.getState(o)===wt&&(this.fragCurrent=o,this.state=Dt,this.hls.trigger(d.a.FRAG_LOADING,{frag:o}))}else this.state=st},h.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,g.prototype.stopLoad.call(this)},h._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},h.onMediaSeeking=function(){if(this.fragCurrent){var r=this.media?this.media.currentTime:0,i=this.config.maxFragLookUpTolerance,s=this.fragCurrent.start-i,t=this.fragCurrent.start+this.fragCurrent.duration+i;(r<s||r>t)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=st,this.tick())}},a}(ne);(function(g){g.WIDEVINE="com.widevine.alpha",g.PLAYREADY="com.microsoft.playready"})(Te||(Te={}));var Vr=typeof window!="undefined"&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function cr(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}var Yr=function(g){var l,n;function a(t){var e;return(e=g.call(this,t,d.a.MEDIA_ATTACHED,d.a.MEDIA_DETACHED,d.a.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,e._licenseXhrSetup=void 0,e._emeEnabled=void 0,e._requestMediaKeySystemAccess=void 0,e._drmSystemOptions=void 0,e._config=void 0,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._requestLicenseFailureCount=0,e.mediaKeysPromise=null,e._onMediaEncrypted=function(o){if(u.b.log('Media is encrypted using "'+o.initDataType+'" init data type'),!e.mediaKeysPromise)return u.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void e.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var f=function(p){e._media&&(e._attemptSetMediaKeys(p),e._generateRequestWithPreferredKeySession(o.initDataType,o.initData))};e.mediaKeysPromise.then(f).catch(f)},e._config=t.config,e._widevineLicenseUrl=e._config.widevineLicenseUrl,e._licenseXhrSetup=e._config.licenseXhrSetup,e._emeEnabled=e._config.emeEnabled,e._requestMediaKeySystemAccess=e._config.requestMediaKeySystemAccessFunc,e._drmSystemOptions=t.config.drmSystemOptions,e}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n;var h,r,i,s=a.prototype;return s.getLicenseServerUrl=function(t){switch(t){case Te.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},s._attemptKeySystemAccess=function(t,e,o){var f=this,p=function(b,L,C,F){switch(b){case Te.WIDEVINE:return function(N,Q,Z){var lt={audioCapabilities:[],videoCapabilities:[]};return N.forEach(function(pt){lt.audioCapabilities.push({contentType:'audio/mp4; codecs="'+pt+'"',robustness:Z.audioRobustness||""})}),Q.forEach(function(pt){lt.videoCapabilities.push({contentType:'video/mp4; codecs="'+pt+'"',robustness:Z.videoRobustness||""})}),[lt]}(L,C,F);default:throw new Error("Unknown key-system: "+b)}}(t,e,o,this._drmSystemOptions);u.b.log("Requesting encrypted media key-system access");var v=this.requestMediaKeySystemAccess(t,p);this.mediaKeysPromise=v.then(function(b){return f._onMediaKeySystemAccessObtained(t,b)}),v.catch(function(b){u.b.error('Failed to obtain key-system "'+t+'" access:',b)})},s._onMediaKeySystemAccessObtained=function(t,e){var o=this;u.b.log('Access for key-system "'+t+'" obtained');var f={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(f);var p=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(v){return f.mediaKeys=v,u.b.log('Media-keys created for key-system "'+t+'"'),o._onMediaKeysCreated(),v});return p.catch(function(v){u.b.error("Failed to create media-keys:",v)}),p},s._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},s._onNewMediaKeySession=function(t){var e=this;u.b.log("New key-system session "+t.sessionId),t.addEventListener("message",function(o){e._onKeySessionMessage(t,o.message)},!1)},s._onKeySessionMessage=function(t,e){u.b.log("Got EME message event, creating license request"),this._requestLicense(e,function(o){u.b.log("Received license data (length: "+(o&&o.byteLength)+"), updating key-session"),t.update(o)})},s._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return u.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_KEYS,fatal:!0});u.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},s._generateRequestWithPreferredKeySession=function(t,e){var o=this,f=this._mediaKeysList[0];if(!f)return u.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(f.mediaKeysSessionInitialized)u.b.warn("Key-Session already initialized but requested again");else{var p=f.mediaKeysSession;if(!p)return u.b.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return u.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});u.b.log('Generating key-session request for "'+t+'" init data type'),f.mediaKeysSessionInitialized=!0,p.generateRequest(t,e).then(function(){u.b.debug("Key-session generation succeeded")}).catch(function(v){u.b.error("Error generating key-session request:",v),o.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},s._createLicenseXhr=function(t,e,o){var f=new XMLHttpRequest,p=this._licenseXhrSetup;try{if(p)try{p(f,t)}catch(v){f.open("POST",t,!0),p(f,t)}f.readyState||f.open("POST",t,!0)}catch(v){throw new Error("issue setting up KeySystem license XHR "+v)}return f.responseType="arraybuffer",f.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,f,t,e,o),f},s._onLicenseRequestReadyStageChange=function(t,e,o,f){switch(t.readyState){case 4:if(t.status===200)this._requestLicenseFailureCount=0,u.b.log("License request succeeded"),t.responseType!=="arraybuffer"&&u.b.warn("xhr response type was not set to the expected arraybuffer for license request"),f(t.response);else{if(u.b.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var p=3-this._requestLicenseFailureCount+1;u.b.warn("Retrying license request, "+p+" attempts left"),this._requestLicense(o,f)}}},s._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case Te.WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},s._requestLicense=function(t,e){u.b.log("Requesting content license for key-system");var o=this._mediaKeysList[0];if(!o)return u.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var f=this.getLicenseServerUrl(o.mediaKeySystemDomain),p=this._createLicenseXhr(f,t,e);u.b.log("Sending license request to URL: "+f);var v=this._generateLicenseRequestChallenge(o,t);p.send(v)}catch(b){u.b.error("Failure requesting DRM license: "+b),this.hls.trigger(d.a.ERROR,{type:S.b.KEY_SYSTEM_ERROR,details:S.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},s.onMediaAttached=function(t){if(this._emeEnabled){var e=t.media;this._media=e,e.addEventListener("encrypted",this._onMediaEncrypted)}},s.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(o){if(o.mediaKeysSession)return o.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},s.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map(function(f){return f.audioCodec}),o=t.levels.map(function(f){return f.videoCodec});this._attemptKeySystemAccess(Te.WIDEVINE,e,o)}},h=a,(r=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&cr(h.prototype,r),i&&cr(h,i),a}(k);function hr(g,l){var n=Object.keys(g);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(g);l&&(a=a.filter(function(h){return Object.getOwnPropertyDescriptor(g,h).enumerable})),n.push.apply(n,a)}return n}function fr(g){for(var l=1;l<arguments.length;l++){var n=arguments[l]!=null?arguments[l]:{};l%2?hr(Object(n),!0).forEach(function(a){Wr(g,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(n)):hr(Object(n)).forEach(function(a){Object.defineProperty(g,a,Object.getOwnPropertyDescriptor(n,a))})}return g}function Wr(g,l,n){return l in g?Object.defineProperty(g,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):g[l]=n,g}var qr=fr(fr({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_r,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Ne,bufferController:Oe,capLevelController:Re,fpsController:Ge,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Vr,testBandwidth:!0},{cueHandler:z,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Hr,subtitleTrackController:Kr,timelineController:Gr,audioStreamController:Ar,audioTrackController:Rr,emeController:Yr});function gr(g,l){var n=Object.keys(g);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(g);l&&(a=a.filter(function(h){return Object.getOwnPropertyDescriptor(g,h).enumerable})),n.push.apply(n,a)}return n}function pr(g){for(var l=1;l<arguments.length;l++){var n=arguments[l]!=null?arguments[l]:{};l%2?gr(Object(n),!0).forEach(function(a){Xr(g,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(n)):gr(Object(n)).forEach(function(a){Object.defineProperty(g,a,Object.getOwnPropertyDescriptor(n,a))})}return g}function Xr(g,l,n){return l in g?Object.defineProperty(g,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):g[l]=n,g}function jt(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function vr(g,l){for(var n=0;n<l.length;n++){var a=l[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}function mr(g,l,n){return l&&vr(g.prototype,l),n&&vr(g,n),g}var yr=function(g){var l,n;function a(r){var i;r===void 0&&(r={}),(i=g.call(this)||this).config=void 0,i._autoLevelCapping=void 0,i.abrController=void 0,i.capLevelController=void 0,i.levelController=void 0,i.streamController=void 0,i.networkControllers=void 0,i.audioTrackController=void 0,i.subtitleTrackController=void 0,i.emeController=void 0,i.coreComponents=void 0,i.media=null,i.url=null;var s=a.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");i.config=pr(pr({},s),r);var t=jt(i).config;if(t.liveMaxLatencyDurationCount!==void 0&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(u.a)(t.debug),i._autoLevelCapping=-1;var e=i.abrController=new t.abrController(jt(i)),o=new t.bufferController(jt(i)),f=i.capLevelController=new t.capLevelController(jt(i)),p=new t.fpsController(jt(i)),v=new Ft(jt(i)),b=new de(jt(i)),L=new Ot(jt(i)),C=new De(jt(i)),F=i.levelController=new Fe(jt(i)),N=new ce(jt(i)),Q=[F,i.streamController=new ge(jt(i),N)],Z=t.audioStreamController;Z&&Q.push(new Z(jt(i),N)),i.networkControllers=Q;var lt=[v,b,L,e,o,f,p,C,N];if(Z=t.audioTrackController){var pt=new Z(jt(i));i.audioTrackController=pt,lt.push(pt)}if(Z=t.subtitleTrackController){var vt=new Z(jt(i));i.subtitleTrackController=vt,Q.push(vt)}if(Z=t.emeController){var at=new Z(jt(i));i.emeController=at,lt.push(at)}return(Z=t.subtitleStreamController)&&Q.push(new Z(jt(i),N)),(Z=t.timelineController)&&lt.push(new Z(jt(i))),i.coreComponents=lt,i}n=g,(l=a).prototype=Object.create(n.prototype),l.prototype.constructor=l,l.__proto__=n,a.isSupported=function(){return function(){var r=E();if(!r)return!1;var i=self.SourceBuffer||self.WebKitSourceBuffer,s=r&&typeof r.isTypeSupported=="function"&&r.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!i||i.prototype&&typeof i.prototype.appendBuffer=="function"&&typeof i.prototype.remove=="function";return!!s&&!!t}()},mr(a,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return d.a}},{key:"ErrorTypes",get:function(){return S.b}},{key:"ErrorDetails",get:function(){return S.a}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:qr},set:function(r){a.defaultConfig=r}}]);var h=a.prototype;return h.destroy=function(){u.b.log("destroy"),this.trigger(d.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(r){r.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},h.attachMedia=function(r){u.b.log("attachMedia"),this.media=r,this.trigger(d.a.MEDIA_ATTACHING,{media:r})},h.detachMedia=function(){u.b.log("detachMedia"),this.trigger(d.a.MEDIA_DETACHING),this.media=null},h.loadSource=function(r){r=Tt.buildAbsoluteURL(window.location.href,r,{alwaysNormalize:!0}),u.b.log("loadSource:"+r),this.url=r,this.trigger(d.a.MANIFEST_LOADING,{url:r})},h.startLoad=function(r){r===void 0&&(r=-1),u.b.log("startLoad("+r+")"),this.networkControllers.forEach(function(i){i.startLoad(r)})},h.stopLoad=function(){u.b.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},h.swapAudioCodec=function(){u.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},h.recoverMediaError=function(){u.b.log("recoverMediaError");var r=this.media;this.detachMedia(),r&&this.attachMedia(r)},h.removeLevel=function(r,i){i===void 0&&(i=0),this.levelController.removeLevel(r,i)},mr(a,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){u.b.log("set currentLevel:"+r),this.loadLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){u.b.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){u.b.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){u.b.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){u.b.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",set:function(r){var i=!!r;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){u.b.log("set autoLevelCapping:"+r),this._autoLevelCapping=r}},{key:"bandwidthEstimate",get:function(){var r=this.abrController._bwEstimator;return r?r.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var r=this.levels,i=this.config.minAutoBitrate,s=r?r.length:0,t=0;t<s;t++)if((r[t].realBitrate?Math.max(r[t].realBitrate,r[t].bitrate):r[t].bitrate)>i)return t;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,i=this.autoLevelCapping;return i===-1&&r&&r.length?r.length-1:i}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var i=this.audioTrackController;i&&(i.audioTrack=r)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var i=this.subtitleTrackController;i&&(i.subtitleTrack=r)}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return!!r&&r.subtitleDisplay},set:function(r){var i=this.subtitleTrackController;i&&(i.subtitleDisplay=r)}}]),a}(w);yr.defaultConfig=void 0}]).default})},2674:function(ze,Mt,ct){"use strict";ct.d(Mt,{Z:function(){return Tt}});var J=(d,u,R)=>new Promise((k,D)=>{var M=U=>{try{G(R.next(U))}catch(K){D(K)}},I=U=>{try{G(R.throw(U))}catch(K){D(K)}},G=U=>U.done?k(U.value):Promise.resolve(U.value).then(M,I);G((R=R.apply(d,u)).next())});const z="oplayer-plugin-hls",V=(d,u,R)=>u.format==="hls"||u.format==="m3u8"||(u.format==="auto"||typeof u.format=="undefined")&&/m3u8(#|\?|$)/i.test(u.src)&&(R||!(d.canPlayType("application/x-mpegURL")||d.canPlayType("application/vnd.apple.mpegURL")));class q{constructor(u){this.key="hls",this.name=z,this.version="1.2.23",this.options={config:{},forceHLS:!1,textControl:!0,audioControl:!0,qualityControl:!0,withBitrate:!1,qualitySwitch:"immediate",matcher:V},Object.assign(this.options,u)}apply(u){this.player=u}load(u,R){return J(this,null,function*(){var k,D;let M=u.$video;const I=this.options,G=I.matcher,U=I.forceHLS;if(!G(M,R,U)||((D=q.library)!==null&&D!==void 0||(q.library=(yield ct.e(817).then(ct.t.bind(ct,9588,19))).default),!q.library.isSupported()))return!1;const K=this.options,Y=K.config,rt=K.active;this.instance=new q.library(Y);const ot=this.instance,et=this.player;return rt&&rt(ot,q.library),ot.loadSource(R.src),ot.attachMedia(M),ot.on(q.library.Events.ERROR,function(gt,_t){const St=_t.type,ut=_t.details;_t.fatal&&(et.hasError=!0,et.emit("error",Object.assign({},_t,{pluginName:z,message:St+": "+ut})))}),(k=et.context.ui)!=null&&k.setting&&S(et,ot,this.options),this})}unload(){var u;(u=this.instance)==null||u.stopLoad()}destroy(){var u;if(this.instance){const R=this.player,k=this.instance,D=this.options.inactive;D&&D(k,q.library),(u=R.context.ui)!=null&&u.setting&&O(R),k.destroy()}}}q.library=globalThis.Hls;function Tt(d){return new q(d)}const S=function(d,u){let R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const k=d.context.ui;R.qualityControl&&(u.once(q.library.Events.MANIFEST_PARSED,()=>{D({icon:k.icons.quality,name:"Quality",settings(){return u.levels.length>1?u.levels.reduce((M,I,G)=>{let U=(I.name||I.height).toString();if(isFinite(+U)&&(U+="p"),R.withBitrate){const K=I.bitrate/1e3,Y=K>1e3,rt=Y?(K/1e3).toFixed(2):Math.floor(K);U+=" ("+rt+(Y?"m":"k")+"bps)"}return M.push({name:U,default:u.currentLevel==G,value:G}),M},[{name:d.locales.get("Auto"),default:u.autoLevelEnabled,value:-1}]):[]},onChange(M){R.qualitySwitch=="immediate"?(u.currentLevel=M.value,M.value!==-1&&(u.loadLevel=M.value)):(u.nextLevel=M.value,M.value!==-1&&(u.nextLoadLevel=M.value))}})}),u.on(q.library.Events.LEVEL_SWITCHED,function(I,G){let U=G.level;if(u.autoLevelEnabled){const K=u.levels[U].height,Y=d.locales.get("Auto")+(K?" ("+K+"p)":"");k.setting.updateLabel(z+"-Quality",Y)}else k.setting.select(z+"-Quality",U+1,!1)})),R.audioControl&&u.on(q.library.Events.AUDIO_TRACK_LOADED,()=>{D({icon:k.icons.lang,name:"Language",settings(){return u.audioTracks.length>1?u.audioTracks.map(M=>{let I=M.name,G=M.lang,U=M.id;return{name:G||I,default:u.audioTrack==U,value:U}}):[]},onChange(M){u.audioTrack=M.value}})}),R.textControl&&u.on(q.library.Events.SUBTITLE_TRACK_LOADED,()=>{D({icon:k.icons.subtitle,name:"Subtitle",settings(){return u.subtitleTracks.length>1?u.subtitleTracks.reduce((M,I)=>{let G=I.name,U=I.lang,K=I.id;return M.push({name:U||G,default:u.subtitleTrack==K,value:K}),M},[{name:d.locales.get("Off"),default:!u.subtitleDisplay,value:-1}]):[]},onChange(M){let I=M.value;(u.subtitleDisplay=I!=-1)&&(u.subtitleTrack=I)}})});function D(M){const I=M.settings();if(I&&I.length<2)return;const G=M.name,U=M.icon,K=M.onChange;d.context.ui.setting.unregister(z+"-"+G),d.context.ui.setting.register({name:d.locales.get(G),icon:U,onChange:K,type:"selector",key:z+"-"+G,children:I})}},O=d=>{["Quality","Language","Subtitle"].forEach(u=>d.context.ui.setting.unregister(z+"-"+u))}}}]);
