(self.webpackChunk_web_index=self.webpackChunk_web_index||[]).push([[4817],{7807:function(zr){typeof window!="undefined"&&function(Qt,Pt){zr.exports=Pt()}(this,()=>(()=>{var Qt={21:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{default:()=>U});var he=function(){function M(N,H){this.subtle=void 0,this.aesIV=void 0,this.subtle=N,this.aesIV=H}return M.prototype.decrypt=function(N,H){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},H,N)},M}(),J=function(){function M(N,H){this.subtle=void 0,this.key=void 0,this.subtle=N,this.key=H}return M.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},M}(),w=V(145),f=function(){function M(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var N=M.prototype;return N.uint8ArrayToUint32Array_=function(H){for(var Y=new DataView(H),te=new Uint32Array(4),ne=0;ne<4;ne++)te[ne]=Y.getUint32(4*ne);return te},N.initTable=function(){var H=this.sBox,Y=this.invSBox,te=this.subMix,ne=te[0],re=te[1],Z=te[2],ve=te[3],de=this.invSubMix,pe=de[0],x=de[1],p=de[2],A=de[3],T=new Uint32Array(256),K=0,ae=0,oe=0;for(oe=0;oe<256;oe++)T[oe]=oe<128?oe<<1:oe<<1^283;for(oe=0;oe<256;oe++){var D=ae^ae<<1^ae<<2^ae<<3^ae<<4;D=D>>>8^255&D^99,H[K]=D,Y[D]=K;var G=T[K],B=T[G],q=T[B],C=257*T[D]^16843008*D;ne[K]=C<<24|C>>>8,re[K]=C<<16|C>>>16,Z[K]=C<<8|C>>>24,ve[K]=C,C=16843009*q^65537*B^257*G^16843008*K,pe[D]=C<<24|C>>>8,x[D]=C<<16|C>>>16,p[D]=C<<8|C>>>24,A[D]=C,K?(K=G^T[T[T[q^G]]],ae^=T[T[ae]]):K=ae=1}},N.expandKey=function(H){for(var Y=this.uint8ArrayToUint32Array_(H),te=!0,ne=0;ne<Y.length&&te;)te=Y[ne]===this.key[ne],ne++;if(!te){this.key=Y;var re=this.keySize=Y.length;if(re!==4&&re!==6&&re!==8)throw new Error("Invalid aes key size="+re);var Z,ve,de,pe,x=this.ksRows=4*(re+6+1),p=this.keySchedule=new Uint32Array(x),A=this.invKeySchedule=new Uint32Array(x),T=this.sBox,K=this.rcon,ae=this.invSubMix,oe=ae[0],D=ae[1],G=ae[2],B=ae[3];for(Z=0;Z<x;Z++)Z<re?de=p[Z]=Y[Z]:(pe=de,Z%re==0?(pe=T[(pe=pe<<8|pe>>>24)>>>24]<<24|T[pe>>>16&255]<<16|T[pe>>>8&255]<<8|T[255&pe],pe^=K[Z/re|0]<<24):re>6&&Z%re==4&&(pe=T[pe>>>24]<<24|T[pe>>>16&255]<<16|T[pe>>>8&255]<<8|T[255&pe]),p[Z]=de=(p[Z-re]^pe)>>>0);for(ve=0;ve<x;ve++)Z=x-ve,pe=3&ve?p[Z]:p[Z-4],A[ve]=ve<4||Z<=4?pe:oe[T[pe>>>24]]^D[T[pe>>>16&255]]^G[T[pe>>>8&255]]^B[T[255&pe]],A[ve]=A[ve]>>>0}},N.networkToHostOrderSwap=function(H){return H<<24|(65280&H)<<8|(16711680&H)>>8|H>>>24},N.decrypt=function(H,Y,te){for(var ne,re,Z,ve,de,pe,x,p,A,T,K,ae,oe,D,G=this.keySize+6,B=this.invKeySchedule,q=this.invSBox,C=this.invSubMix,ge=C[0],me=C[1],Te=C[2],ke=C[3],ie=this.uint8ArrayToUint32Array_(te),De=ie[0],Re=ie[1],He=ie[2],_e=ie[3],Oe=new Int32Array(H),Ne=new Int32Array(Oe.length),Fe=this.networkToHostOrderSwap;Y<Oe.length;){for(A=Fe(Oe[Y]),T=Fe(Oe[Y+1]),K=Fe(Oe[Y+2]),ae=Fe(Oe[Y+3]),de=A^B[0],pe=ae^B[1],x=K^B[2],p=T^B[3],oe=4,D=1;D<G;D++)ne=ge[de>>>24]^me[pe>>16&255]^Te[x>>8&255]^ke[255&p]^B[oe],re=ge[pe>>>24]^me[x>>16&255]^Te[p>>8&255]^ke[255&de]^B[oe+1],Z=ge[x>>>24]^me[p>>16&255]^Te[de>>8&255]^ke[255&pe]^B[oe+2],ve=ge[p>>>24]^me[de>>16&255]^Te[pe>>8&255]^ke[255&x]^B[oe+3],de=ne,pe=re,x=Z,p=ve,oe+=4;ne=q[de>>>24]<<24^q[pe>>16&255]<<16^q[x>>8&255]<<8^q[255&p]^B[oe],re=q[pe>>>24]<<24^q[x>>16&255]<<16^q[p>>8&255]<<8^q[255&de]^B[oe+1],Z=q[x>>>24]<<24^q[p>>16&255]<<16^q[de>>8&255]<<8^q[255&pe]^B[oe+2],ve=q[p>>>24]<<24^q[de>>16&255]<<16^q[pe>>8&255]<<8^q[255&x]^B[oe+3],Ne[Y]=Fe(ne^De),Ne[Y+1]=Fe(ve^Re),Ne[Y+2]=Fe(Z^He),Ne[Y+3]=Fe(re^_e),De=A,Re=T,He=K,_e=ae,Y+=4}return Ne.buffer},M}(),_=V(93),S=V(63),U=function(){function M(H,Y,te){var ne=(te===void 0?{}:te).removePKCS7Padding,re=ne===void 0||ne;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=H,this.config=Y,this.removePKCS7Padding=re,re)try{var Z=self.crypto;Z&&(this.subtle=Z.subtle||Z.webkitSubtle)}catch(ve){}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var N=M.prototype;return N.destroy=function(){this.observer=null},N.isSync=function(){return this.config.enableSoftwareAES},N.flush=function(){var H=this.currentResult;if(H){var Y,te,ne,re=new Uint8Array(H);return this.reset(),this.removePKCS7Padding?(ne=(te=(Y=re).byteLength)&&new DataView(Y.buffer).getUint8(te-1))?(0,w.sliceUint8)(Y,0,te-ne):Y:re}this.reset()},N.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},N.decrypt=function(H,Y,te,ne){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(H),Y,te);var re=this.flush();re&&ne(re.buffer)}else this.webCryptoDecrypt(new Uint8Array(H),Y,te).then(ne)},N.softwareDecrypt=function(H,Y,te){var ne=this.currentIV,re=this.currentResult,Z=this.remainderData;this.logOnce("JS AES decrypt"),Z&&(H=(0,S.appendUint8Array)(Z,H),this.remainderData=null);var ve=this.getValidChunk(H);if(!ve.length)return null;ne&&(te=ne);var de=this.softwareDecrypter;de||(de=this.softwareDecrypter=new f),de.expandKey(Y);var pe=re;return this.currentResult=de.decrypt(ve.buffer,0,te),this.currentIV=(0,w.sliceUint8)(ve,-16).buffer,pe||null},N.webCryptoDecrypt=function(H,Y,te){var ne=this,re=this.subtle;return this.key===Y&&this.fastAesKey||(this.key=Y,this.fastAesKey=new J(re,Y)),this.fastAesKey.expandKey().then(function(Z){return re?new he(re,te).decrypt(H.buffer,Z):Promise.reject(new Error("web crypto not initialized"))}).catch(function(Z){return ne.onWebCryptoError(Z,H,Y,te)})},N.onWebCryptoError=function(H,Y,te,ne){return _.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",H),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(Y,te,ne)},N.getValidChunk=function(H){var Y=H,te=H.length-H.length%16;return te!==H.length&&(Y=(0,w.sliceUint8)(H,0,te),this.remainderData=(0,w.sliceUint8)(H,te)),Y},N.logOnce=function(H){this.logEnabled&&(_.logger.log("[decrypter.ts]: "+H),this.logEnabled=!1)},M}()},181:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{canParse:()=>S,decodeFrame:()=>Y,getID3Data:()=>f,getID3Frames:()=>H,getTimeStamp:()=>U,isFooter:()=>w,isHeader:()=>J,isTimeStampFrame:()=>M,testables:()=>de,utf8ArrayToStr:()=>ve});var he,J=function(x,p){return p+10<=x.length&&x[p]===73&&x[p+1]===68&&x[p+2]===51&&x[p+3]<255&&x[p+4]<255&&x[p+6]<128&&x[p+7]<128&&x[p+8]<128&&x[p+9]<128},w=function(x,p){return p+10<=x.length&&x[p]===51&&x[p+1]===68&&x[p+2]===73&&x[p+3]<255&&x[p+4]<255&&x[p+6]<128&&x[p+7]<128&&x[p+8]<128&&x[p+9]<128},f=function(x,p){for(var A=p,T=0;J(x,p);)T+=10,T+=_(x,p+6),w(x,p+10)&&(T+=10),p+=T;if(T>0)return x.subarray(A,A+T)},_=function(x,p){var A=0;return A=(127&x[p])<<21,A|=(127&x[p+1])<<14,(A|=(127&x[p+2])<<7)|127&x[p+3]},S=function(x,p){return J(x,p)&&_(x,p+6)+10<=x.length-p},U=function(x){for(var p=H(x),A=0;A<p.length;A++){var T=p[A];if(M(T))return Z(T)}},M=function(x){return x&&x.key==="PRIV"&&x.info==="com.apple.streaming.transportStreamTimestamp"},N=function(x){var p=String.fromCharCode(x[0],x[1],x[2],x[3]),A=_(x,4);return{type:p,size:A,data:x.subarray(10,10+A)}},H=function(x){for(var p=0,A=[];J(x,p);){for(var T=_(x,p+6),K=(p+=10)+T;p+8<K;){var ae=N(x.subarray(p)),oe=Y(ae);oe&&A.push(oe),p+=ae.size+10}w(x,p)&&(p+=10)}return A},Y=function(x){return x.type==="PRIV"?te(x):x.type[0]==="W"?re(x):ne(x)},te=function(x){if(!(x.size<2)){var p=ve(x.data,!0),A=new Uint8Array(x.data.subarray(p.length+1));return{key:x.type,info:p,data:A.buffer}}},ne=function(x){if(!(x.size<2)){if(x.type==="TXXX"){var p=1,A=ve(x.data.subarray(p),!0);p+=A.length+1;var T=ve(x.data.subarray(p));return{key:x.type,info:A,data:T}}var K=ve(x.data.subarray(1));return{key:x.type,data:K}}},re=function(x){if(x.type==="WXXX"){if(x.size<2)return;var p=1,A=ve(x.data.subarray(p),!0);p+=A.length+1;var T=ve(x.data.subarray(p));return{key:x.type,info:A,data:T}}var K=ve(x.data);return{key:x.type,data:K}},Z=function(x){if(x.data.byteLength===8){var p=new Uint8Array(x.data),A=1&p[3],T=(p[4]<<23)+(p[5]<<15)+(p[6]<<7)+p[7];return T/=45,A&&(T+=4772185884e-2),Math.round(T)}},ve=function(x,p){p===void 0&&(p=!1);var A=pe();if(A){var T=A.decode(x);if(p){var K=T.indexOf("\0");return K!==-1?T.substring(0,K):T}return T.replace(/\0/g,"")}for(var ae,oe,D,G=x.length,B="",q=0;q<G;){if((ae=x[q++])===0&&p)return B;if(ae!==0&&ae!==3)switch(ae>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:B+=String.fromCharCode(ae);break;case 12:case 13:oe=x[q++],B+=String.fromCharCode((31&ae)<<6|63&oe);break;case 14:oe=x[q++],D=x[q++],B+=String.fromCharCode((15&ae)<<12|(63&oe)<<6|(63&D)<<0)}}return B},de={decodeTextFrame:ne};function pe(){return he||self.TextDecoder===void 0||(he=new self.TextDecoder("utf-8")),he}},182:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{default:()=>_});var he=V(544),J=V(851),w=V(93),f=V(729);function _(N){var H=new f.EventEmitter,Y=function(te,ne){N.postMessage({event:te,data:ne})};H.on(J.Events.FRAG_DECRYPTED,Y),H.on(J.Events.ERROR,Y),N.addEventListener("message",function(te){var ne=te.data;switch(ne.cmd){case"init":var re=JSON.parse(ne.config);N.transmuxer=new he.default(H,ne.typeSupported,re,ne.vendor,ne.id),(0,w.enableLogs)(re.debug,ne.id),function(){var pe=function(p){w.logger[p]=function(A){Y("workerLog",{logType:p,message:A})}};for(var x in w.logger)pe(x)}(),Y("init",null);break;case"configure":N.transmuxer.configure(ne.config);break;case"demux":var Z=N.transmuxer.push(ne.data,ne.decryptdata,ne.chunkMeta,ne.state);(0,he.isPromise)(Z)?Z.then(function(pe){S(N,pe)}):S(N,Z);break;case"flush":var ve=ne.chunkMeta,de=N.transmuxer.flush(ve);(0,he.isPromise)(de)?de.then(function(pe){M(N,pe,ve)}):M(N,de,ve)}})}function S(N,H){if(!((Y=H.remuxResult).audio||Y.video||Y.text||Y.id3||Y.initSegment))return!1;var Y,te=[],ne=H.remuxResult,re=ne.audio,Z=ne.video;return re&&U(te,re),Z&&U(te,Z),N.postMessage({event:"transmuxComplete",data:H},te),!0}function U(N,H){H.data1&&N.push(H.data1.buffer),H.data2&&N.push(H.data2.buffer)}function M(N,H,Y){H.reduce(function(te,ne){return S(N,ne)||te},!1)||N.postMessage({event:"transmuxComplete",data:H[0]}),N.postMessage({event:"flush",data:Y})}},544:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{TransmuxConfig:()=>Tt,TransmuxState:()=>St,default:()=>yt,isPromise:()=>Et});var he=V(851),J=V(973),w=V(21),f=V(965),_=V(181),S=V(856);function U(O,L){return O===void 0&&(O=""),L===void 0&&(L=9e4),{type:O,id:-1,pid:-1,inputTimeScale:L,sequenceNumber:-1,samples:[],dropped:0}}var M=V(63),N=V(145),H=function(){function O(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var L=O.prototype;return L.resetInitSegment=function(g,b,E,R){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},L.resetTimeStamp=function(g){this.initPTS=g,this.resetContiguity()},L.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},L.canParse=function(g,b){return!1},L.appendFrame=function(g,b,E){},L.demux=function(g,b){this.cachedData&&(g=(0,M.appendUint8Array)(this.cachedData,g),this.cachedData=null);var E,R=_.getID3Data(g,0),P=R?R.length:0,F=this._audioTrack,X=this._id3Track,le=R?_.getTimeStamp(R):void 0,$=g.length;for((this.basePTS===null||this.frameIndex===0&&(0,f.isFiniteNumber)(le))&&(this.basePTS=Y(le,b,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),R&&R.length>0&&X.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:R,type:S.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});P<$;){if(this.canParse(g,P)){var fe=this.appendFrame(F,g,P);fe?(this.frameIndex++,this.lastPTS=fe.sample.pts,E=P+=fe.length):P=$}else _.canParse(g,P)?(R=_.getID3Data(g,P),X.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:R,type:S.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),E=P+=R.length):P++;if(P===$&&E!==$){var Se=(0,N.sliceUint8)(g,E);this.cachedData?this.cachedData=(0,M.appendUint8Array)(this.cachedData,Se):this.cachedData=Se}}return{audioTrack:F,videoTrack:U(),id3Track:X,textTrack:U()}},L.demuxSampleAes=function(g,b,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},L.flush=function(g){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),{audioTrack:this._audioTrack,videoTrack:U(),id3Track:this._id3Track,textTrack:U()}},L.destroy=function(){},O}(),Y=function(O,L,g){return(0,f.isFiniteNumber)(O)?90*O:9e4*L+(g||0)};const te=H;var ne=V(93);function re(O,L){return O[L]===255&&(246&O[L+1])==240}function Z(O,L){return 1&O[L+1]?7:9}function ve(O,L){return(3&O[L+3])<<11|O[L+4]<<3|(224&O[L+5])>>>5}function de(O,L){return L+1<O.length&&re(O,L)}function pe(O,L){if(de(O,L)){var g=Z(O,L);if(L+g>=O.length)return!1;var b=ve(O,L);if(b<=g)return!1;var E=L+b;return E===O.length||de(O,E)}return!1}function x(O,L,g,b,E){if(!O.samplerate){var R=function(P,F,X,le){var $,fe,Se,Ee,be=navigator.userAgent.toLowerCase(),Pe=le,je=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];$=1+((192&F[X+2])>>>6);var Le=(60&F[X+2])>>>2;if(!(Le>je.length-1))return Se=(1&F[X+2])<<2,Se|=(192&F[X+3])>>>6,ne.logger.log("manifest codec:"+le+", ADTS type:"+$+", samplingIndex:"+Le),/firefox/i.test(be)?Le>=6?($=5,Ee=new Array(4),fe=Le-3):($=2,Ee=new Array(2),fe=Le):be.indexOf("android")!==-1?($=2,Ee=new Array(2),fe=Le):($=5,Ee=new Array(4),le&&(le.indexOf("mp4a.40.29")!==-1||le.indexOf("mp4a.40.5")!==-1)||!le&&Le>=6?fe=Le-3:((le&&le.indexOf("mp4a.40.2")!==-1&&(Le>=6&&Se===1||/vivaldi/i.test(be))||!le&&Se===1)&&($=2,Ee=new Array(2)),fe=Le)),Ee[0]=$<<3,Ee[0]|=(14&Le)>>1,Ee[1]|=(1&Le)<<7,Ee[1]|=Se<<3,$===5&&(Ee[1]|=(14&fe)>>1,Ee[2]=(1&fe)<<7,Ee[2]|=8,Ee[3]=0),{config:Ee,samplerate:je[Le],channelCount:Se,codec:"mp4a.40."+$,manifestCodec:Pe};P.trigger(he.Events.ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+Le})}(L,g,b,E);if(!R)return;O.config=R.config,O.samplerate=R.samplerate,O.channelCount=R.channelCount,O.codec=R.codec,O.manifestCodec=R.manifestCodec,ne.logger.log("parsed codec:"+O.codec+", rate:"+R.samplerate+", channels:"+R.channelCount)}}function p(O){return 9216e4/O}function A(O,L,g,b,E){var R,P=b+E*p(O.samplerate),F=function(be,Pe){var je=Z(be,Pe);if(Pe+je<=be.length){var Le=ve(be,Pe)-je;if(Le>0)return{headerLength:je,frameLength:Le}}}(L,g);if(F){var X=F.frameLength,le=F.headerLength,$=le+X,fe=Math.max(0,g+$-L.length);fe?(R=new Uint8Array($-le)).set(L.subarray(g+le,L.length),0):R=L.subarray(g+le,g+$);var Se={unit:R,pts:P};return fe||O.samples.push(Se),{sample:Se,length:$,missing:fe}}var Ee=L.length-g;return(R=new Uint8Array(Ee)).set(L.subarray(g,L.length),0),{sample:{unit:R,pts:P},length:Ee,missing:-1}}function T(O,L){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,b){return g.__proto__=b,g},T(O,L)}const K=function(O){var L,g;function b(R,P){var F;return(F=O.call(this)||this).observer=void 0,F.config=void 0,F.observer=R,F.config=P,F}g=O,(L=b).prototype=Object.create(g.prototype),L.prototype.constructor=L,T(L,g);var E=b.prototype;return E.resetInitSegment=function(R,P,F,X){O.prototype.resetInitSegment.call(this,R,P,F,X),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:P,duration:X,inputTimeScale:9e4,dropped:0}},b.probe=function(R){if(!R)return!1;for(var P=(_.getID3Data(R,0)||[]).length,F=R.length;P<F;P++)if(pe(R,P))return ne.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(R,P){return function(F,X){return function(le,$){return $+5<le.length}(F,X)&&re(F,X)&&ve(F,X)<=F.length-X}(R,P)},E.appendFrame=function(R,P,F){x(R,this.observer,P,F,R.manifestCodec);var X=A(R,P,F,this.basePTS,this.frameIndex);if(X&&X.missing===0)return X},b}(te);var ae=/\/emsg[-/]ID3/i;const oe=function(){function O(g,b){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=b}var L=O.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(g,b,E,R){var P=(0,M.parseInitSegment)(g),F=this.videoTrack=U("video",1),X=this.audioTrack=U("audio",1),le=this.txtTrack=U("text",1);if(this.id3Track=U("id3",1),this.timeOffset=0,P.video){var $=P.video,fe=$.id,Se=$.timescale,Ee=$.codec;F.id=fe,F.timescale=le.timescale=Se,F.codec=Ee}if(P.audio){var be=P.audio,Pe=be.id,je=be.timescale,Le=be.codec;X.id=Pe,X.timescale=je,X.codec=Le}le.id=M.RemuxerTrackIdConfig.text,F.sampleDuration=0,F.duration=X.duration=R},L.resetContiguity=function(){},O.probe=function(g){return g=g.length>16384?g.subarray(0,16384):g,(0,M.findBox)(g,["moof"]).length>0},L.demux=function(g,b){this.timeOffset=b;var E=g,R=this.videoTrack,P=this.txtTrack;if(this.config.progressive){this.remainderData&&(E=(0,M.appendUint8Array)(this.remainderData,g));var F=(0,M.segmentValidRange)(E);this.remainderData=F.remainder,R.samples=F.valid||new Uint8Array}else R.samples=E;var X=this.extractID3Track(R,b);return P.samples=(0,M.parseSamples)(b,R),{videoTrack:R,audioTrack:this.audioTrack,id3Track:X,textTrack:this.txtTrack}},L.flush=function(){var g=this.timeOffset,b=this.videoTrack,E=this.txtTrack;b.samples=this.remainderData||new Uint8Array,this.remainderData=null;var R=this.extractID3Track(b,this.timeOffset);return E.samples=(0,M.parseSamples)(g,b),{videoTrack:b,audioTrack:U(),id3Track:R,textTrack:U()}},L.extractID3Track=function(g,b){var E=this.id3Track;if(g.samples.length){var R=(0,M.findBox)(g.samples,["emsg"]);R&&R.forEach(function(P){var F=(0,M.parseEmsg)(P);if(ae.test(F.schemeIdUri)){var X=(0,f.isFiniteNumber)(F.presentationTime)?F.presentationTime/F.timeScale:b+F.presentationTimeDelta/F.timeScale,le=F.eventDuration===4294967295?Number.POSITIVE_INFINITY:F.eventDuration/F.timeScale;le<=.001&&(le=Number.POSITIVE_INFINITY);var $=F.payload;E.samples.push({data:$,len:$.byteLength,dts:X,pts:X,type:S.MetadataSchema.emsg,duration:le})}})}return E},L.demuxSampleAes=function(g,b,E){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},O}();var D=null,G=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],B=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],q=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function ge(O,L,g,b,E){if(!(g+24>L.length)){var R=me(L,g);if(R&&g+R.frameLength<=L.length){var P=b+E*(9e4*R.samplesPerFrame/R.sampleRate),F={unit:L.subarray(g,g+R.frameLength),pts:P,dts:P};return O.config=[],O.channelCount=R.channelCount,O.samplerate=R.sampleRate,O.samples.push(F),{sample:F,length:R.frameLength,missing:0}}}}function me(O,L){var g=O[L+1]>>3&3,b=O[L+1]>>1&3,E=O[L+2]>>4&15,R=O[L+2]>>2&3;if(g!==1&&E!==0&&E!==15&&R!==3){var P=O[L+2]>>1&1,F=O[L+3]>>6,X=1e3*G[14*(g===3?3-b:b===3?3:4)+E-1],le=B[3*(g===3?0:g===2?1:2)+R],$=F===3?1:2,fe=q[g][b],Se=C[b],Ee=8*fe*Se,be=Math.floor(fe*X/le+P)*Se;if(D===null){var Pe=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);D=Pe?parseInt(Pe[1]):0}return!!D&&D<=87&&b===2&&X>=224e3&&F===0&&(O[L+3]=128|O[L+3]),{sampleRate:le,channelCount:$,frameLength:be,samplesPerFrame:Ee}}}function Te(O,L){return O[L]===255&&(224&O[L+1])==224&&(6&O[L+1])!=0}function ke(O,L){return L+1<O.length&&Te(O,L)}function ie(O,L){if(L+1<O.length&&Te(O,L)){var g=me(O,L),b=4;g!=null&&g.frameLength&&(b=g.frameLength);var E=L+b;return E===O.length||ke(O,E)}return!1}const De=function(){function O(g){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=g,this.bytesAvailable=g.byteLength,this.word=0,this.bitsAvailable=0}var L=O.prototype;return L.loadWord=function(){var g=this.data,b=this.bytesAvailable,E=g.byteLength-b,R=new Uint8Array(4),P=Math.min(4,b);if(P===0)throw new Error("no bytes available");R.set(g.subarray(E,E+P)),this.word=new DataView(R.buffer).getUint32(0),this.bitsAvailable=8*P,this.bytesAvailable-=P},L.skipBits=function(g){var b;this.bitsAvailable>g?(this.word<<=g,this.bitsAvailable-=g):(g-=this.bitsAvailable,g-=(b=g>>3)>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=g,this.bitsAvailable-=g)},L.readBits=function(g){var b=Math.min(this.bitsAvailable,g),E=this.word>>>32-b;return g>32&&ne.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),(b=g-b)>0&&this.bitsAvailable?E<<b|this.readBits(b):E},L.skipLZ=function(){var g;for(g=0;g<this.bitsAvailable;++g)if((this.word&2147483648>>>g)!=0)return this.word<<=g,this.bitsAvailable-=g,g;return this.loadWord(),g+this.skipLZ()},L.skipUEG=function(){this.skipBits(1+this.skipLZ())},L.skipEG=function(){this.skipBits(1+this.skipLZ())},L.readUEG=function(){var g=this.skipLZ();return this.readBits(g+1)-1},L.readEG=function(){var g=this.readUEG();return 1&g?1+g>>>1:-1*(g>>>1)},L.readBoolean=function(){return this.readBits(1)===1},L.readUByte=function(){return this.readBits(8)},L.readUShort=function(){return this.readBits(16)},L.readUInt=function(){return this.readBits(32)},L.skipScalingList=function(g){for(var b=8,E=8,R=0;R<g;R++)E!==0&&(E=(b+this.readEG()+256)%256),b=E===0?b:E},L.readSPS=function(){var g,b,E,R=0,P=0,F=0,X=0,le=this.readUByte.bind(this),$=this.readBits.bind(this),fe=this.readUEG.bind(this),Se=this.readBoolean.bind(this),Ee=this.skipBits.bind(this),be=this.skipEG.bind(this),Pe=this.skipUEG.bind(this),je=this.skipScalingList.bind(this);le();var Le=le();if($(5),Ee(3),le(),Pe(),Le===100||Le===110||Le===122||Le===244||Le===44||Le===83||Le===86||Le===118||Le===128){var ze=fe();if(ze===3&&Ee(1),Pe(),Pe(),Ee(1),Se())for(b=ze!==3?8:12,E=0;E<b;E++)Se()&&je(E<6?16:64)}Pe();var dt=fe();if(dt===0)fe();else if(dt===1)for(Ee(1),be(),be(),g=fe(),E=0;E<g;E++)be();Pe(),Ee(1);var nt=fe(),et=fe(),gt=$(1);gt===0&&Ee(1),Ee(1),Se()&&(R=fe(),P=fe(),F=fe(),X=fe());var xe=[1,1];if(Se()&&Se())switch(le()){case 1:xe=[1,1];break;case 2:xe=[12,11];break;case 3:xe=[10,11];break;case 4:xe=[16,11];break;case 5:xe=[40,33];break;case 6:xe=[24,11];break;case 7:xe=[20,11];break;case 8:xe=[32,11];break;case 9:xe=[80,33];break;case 10:xe=[18,11];break;case 11:xe=[15,11];break;case 12:xe=[64,33];break;case 13:xe=[160,99];break;case 14:xe=[4,3];break;case 15:xe=[3,2];break;case 16:xe=[2,1];break;case 255:xe=[le()<<8|le(),le()<<8|le()]}return{width:Math.ceil(16*(nt+1)-2*R-2*P),height:(2-gt)*(et+1)*16-(gt?2:4)*(F+X),pixelRatio:xe}},L.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},O}(),Re=function(){function O(g,b,E){this.keyData=void 0,this.decrypter=void 0,this.keyData=E,this.decrypter=new w.default(g,b,{removePKCS7Padding:!1})}var L=O.prototype;return L.decryptBuffer=function(g,b){this.decrypter.decrypt(g,this.keyData.key.buffer,this.keyData.iv.buffer,b)},L.decryptAacSample=function(g,b,E,R){var P=g[b].unit;if(!(P.length<=16)){var F=P.subarray(16,P.length-P.length%16),X=F.buffer.slice(F.byteOffset,F.byteOffset+F.length),le=this;this.decryptBuffer(X,function($){var fe=new Uint8Array($);P.set(fe,16),R||le.decryptAacSamples(g,b+1,E)})}},L.decryptAacSamples=function(g,b,E){for(;;b++){if(b>=g.length)return void E();if(!(g[b].unit.length<32)){var R=this.decrypter.isSync();if(this.decryptAacSample(g,b,E,R),!R)return}}},L.getAvcEncryptedData=function(g){for(var b=16*Math.floor((g.length-48)/160)+16,E=new Int8Array(b),R=0,P=32;P<g.length-16;P+=160,R+=16)E.set(g.subarray(P,P+16),R);return E},L.getAvcDecryptedUnit=function(g,b){for(var E=new Uint8Array(b),R=0,P=32;P<g.length-16;P+=160,R+=16)g.set(E.subarray(R,R+16),P);return g},L.decryptAvcSample=function(g,b,E,R,P,F){var X=(0,M.discardEPB)(P.data),le=this.getAvcEncryptedData(X),$=this;this.decryptBuffer(le.buffer,function(fe){P.data=$.getAvcDecryptedUnit(X,fe),F||$.decryptAvcSamples(g,b,E+1,R)})},L.decryptAvcSamples=function(g,b,E,R){if(g instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;b++,E=0){if(b>=g.length)return void R();for(var P=g[b].units;!(E>=P.length);E++){var F=P[E];if(!(F.data.length<=48||F.type!==1&&F.type!==5)){var X=this.decrypter.isSync();if(this.decryptAvcSample(g,b,E,R,F,X),!X)return}}}},O}();function He(){return He=Object.assign?Object.assign.bind():function(O){for(var L=1;L<arguments.length;L++){var g=arguments[L];for(var b in g)Object.prototype.hasOwnProperty.call(g,b)&&(O[b]=g[b])}return O},He.apply(this,arguments)}var _e=188;function Oe(O,L,g,b){return{key:O,frame:!1,pts:L,dts:g,units:[],debug:b,length:0}}function Ne(O,L){return(31&O[L+10])<<8|O[L+11]}function Fe(O,L,g,b){var E={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},R=L+3+((15&O[L+1])<<8|O[L+2])-4;for(L+=12+((15&O[L+10])<<8|O[L+11]);L<R;){var P=(31&O[L+1])<<8|O[L+2];switch(O[L]){case 207:if(!b){ne.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:E.audio===-1&&(E.audio=P);break;case 21:E.id3===-1&&(E.id3=P);break;case 219:if(!b){ne.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:E.avc===-1&&(E.avc=P);break;case 3:case 4:g.mpeg!==!0&&g.mp3!==!0?ne.logger.log("MPEG audio found, not supported in this browser"):E.audio===-1&&(E.audio=P,E.segmentCodec="mp3");break;case 36:ne.logger.warn("Unsupported HEVC stream type found")}L+=5+((15&O[L+3])<<8|O[L+4])}return E}function Ye(O){var L,g,b,E,R,P=0,F=O.data;if(!O||O.size===0)return null;for(;F[0].length<19&&F.length>1;){var X=new Uint8Array(F[0].length+F[1].length);X.set(F[0]),X.set(F[1],F[0].length),F[0]=X,F.splice(1,1)}if(((L=F[0])[0]<<16)+(L[1]<<8)+L[2]===1){if((g=(L[4]<<8)+L[5])&&g>O.size-6)return null;var le=L[7];192&le&&(E=536870912*(14&L[9])+4194304*(255&L[10])+16384*(254&L[11])+128*(255&L[12])+(254&L[13])/2,64&le?E-(R=536870912*(14&L[14])+4194304*(255&L[15])+16384*(254&L[16])+128*(255&L[17])+(254&L[18])/2)>54e5&&(ne.logger.warn(Math.round((E-R)/9e4)+"s delta between PTS and DTS, align them"),E=R):R=E);var $=(b=L[8])+9;if(O.size<=$)return null;O.size-=$;for(var fe=new Uint8Array(O.size),Se=0,Ee=F.length;Se<Ee;Se++){var be=(L=F[Se]).byteLength;if($){if($>be){$-=be;continue}L=L.subarray($),be-=$,$=0}fe.set(L,P),P+=be}return g&&(g-=b+3),{data:fe,pts:E,dts:R,len:g}}return null}function Ve(O,L){if(O.units.length&&O.frame){if(O.pts===void 0){var g=L.samples,b=g.length;if(!b)return void L.dropped++;var E=g[b-1];O.pts=E.pts,O.dts=E.dts}L.samples.push(O)}O.debug.length&&ne.logger.log(O.pts+"/"+O.dts+":"+O.debug)}const Me=function(){function O(g,b,E){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=g,this.config=b,this.typeSupported=E}O.probe=function(g){var b=O.syncOffset(g);return b>0&&ne.logger.warn("MPEG2-TS detected but first sync word found @ offset "+b),b!==-1},O.syncOffset=function(g){for(var b=Math.min(940,g.length-376)+1,E=0;E<b;){if(g[E]===71&&g[E+_e]===71)return E;E++}return-1},O.createTrack=function(g,b){return{container:g==="video"||g==="audio"?"video/mp2t":void 0,type:g,id:M.RemuxerTrackIdConfig[g],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:g==="audio"?b:void 0}};var L=O.prototype;return L.resetInitSegment=function(g,b,E,R){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=O.createTrack("video"),this._audioTrack=O.createTrack("audio",R),this._id3Track=O.createTrack("id3"),this._txtTrack=O.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=b,this.videoCodec=E,this._duration=R},L.resetTimeStamp=function(){},L.resetContiguity=function(){var g=this._audioTrack,b=this._avcTrack,E=this._id3Track;g&&(g.pesData=null),b&&(b.pesData=null),E&&(E.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},L.demux=function(g,b,E,R){var P;E===void 0&&(E=!1),R===void 0&&(R=!1),E||(this.sampleAes=null);var F=this._avcTrack,X=this._audioTrack,le=this._id3Track,$=this._txtTrack,fe=F.pid,Se=F.pesData,Ee=X.pid,be=le.pid,Pe=X.pesData,je=le.pesData,Le=null,ze=this.pmtParsed,dt=this._pmtId,nt=g.length;if(this.remainderData&&(nt=(g=(0,M.appendUint8Array)(this.remainderData,g)).length,this.remainderData=null),nt<_e&&!R)return this.remainderData=g,{audioTrack:X,videoTrack:F,id3Track:le,textTrack:$};var et=Math.max(0,O.syncOffset(g));(nt-=(nt-et)%_e)<g.byteLength&&!R&&(this.remainderData=new Uint8Array(g.buffer,nt,g.buffer.byteLength-nt));for(var gt=0,xe=et;xe<nt;xe+=_e)if(g[xe]===71){var ft=!!(64&g[xe+1]),Ct=((31&g[xe+1])<<8)+g[xe+2],ut=void 0;if((48&g[xe+3])>>4>1){if((ut=xe+5+g[xe+4])===xe+_e)continue}else ut=xe+4;switch(Ct){case fe:ft&&(Se&&(P=Ye(Se))&&this.parseAVCPES(F,$,P,!1),Se={data:[],size:0}),Se&&(Se.data.push(g.subarray(ut,xe+_e)),Se.size+=xe+_e-ut);break;case Ee:if(ft){if(Pe&&(P=Ye(Pe)))switch(X.segmentCodec){case"aac":this.parseAACPES(X,P);break;case"mp3":this.parseMPEGPES(X,P)}Pe={data:[],size:0}}Pe&&(Pe.data.push(g.subarray(ut,xe+_e)),Pe.size+=xe+_e-ut);break;case be:ft&&(je&&(P=Ye(je))&&this.parseID3PES(le,P),je={data:[],size:0}),je&&(je.data.push(g.subarray(ut,xe+_e)),je.size+=xe+_e-ut);break;case 0:ft&&(ut+=g[ut]+1),dt=this._pmtId=Ne(g,ut);break;case dt:ft&&(ut+=g[ut]+1);var bt=Fe(g,ut,this.typeSupported,E);(fe=bt.avc)>0&&(F.pid=fe),(Ee=bt.audio)>0&&(X.pid=Ee,X.segmentCodec=bt.segmentCodec),(be=bt.id3)>0&&(le.pid=be),Le===null||ze||(ne.logger.log("unknown PID '"+Le+"' in TS found"),Le=null,xe=et-188),ze=this.pmtParsed=!0;break;case 17:case 8191:break;default:Le=Ct}}else gt++;gt>0&&this.observer.emit(he.Events.ERROR,he.Events.ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+gt+" TS packet/s that do not start with 0x47"}),F.pesData=Se,X.pesData=Pe,le.pesData=je;var pt={audioTrack:X,videoTrack:F,id3Track:le,textTrack:$};return R&&this.extractRemainingSamples(pt),pt},L.flush=function(){var g,b=this.remainderData;return this.remainderData=null,g=b?this.demux(b,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(g),this.sampleAes?this.decrypt(g,this.sampleAes):g},L.extractRemainingSamples=function(g){var b,E=g.audioTrack,R=g.videoTrack,P=g.id3Track,F=g.textTrack,X=R.pesData,le=E.pesData,$=P.pesData;if(X&&(b=Ye(X))?(this.parseAVCPES(R,F,b,!0),R.pesData=null):R.pesData=X,le&&(b=Ye(le))){switch(E.segmentCodec){case"aac":this.parseAACPES(E,b);break;case"mp3":this.parseMPEGPES(E,b)}E.pesData=null}else le!=null&&le.size&&ne.logger.log("last AAC PES packet truncated,might overlap between fragments"),E.pesData=le;$&&(b=Ye($))?(this.parseID3PES(P,b),P.pesData=null):P.pesData=$},L.demuxSampleAes=function(g,b,E){var R=this.demux(g,E,!0,!this.config.progressive),P=this.sampleAes=new Re(this.observer,this.config,b);return this.decrypt(R,P)},L.decrypt=function(g,b){return new Promise(function(E){var R=g.audioTrack,P=g.videoTrack;R.samples&&R.segmentCodec==="aac"?b.decryptAacSamples(R.samples,0,function(){P.samples?b.decryptAvcSamples(P.samples,0,0,function(){E(g)}):E(g)}):P.samples&&b.decryptAvcSamples(P.samples,0,0,function(){E(g)})})},L.destroy=function(){this._duration=0},L.parseAVCPES=function(g,b,E,R){var P,F=this,X=this.parseAVCNALu(g,E.data),le=this.avcSample,$=!1;E.data=null,le&&X.length&&!g.audFound&&(Ve(le,g),le=this.avcSample=Oe(!1,E.pts,E.dts,"")),X.forEach(function(fe){switch(fe.type){case 1:P=!0,le||(le=F.avcSample=Oe(!0,E.pts,E.dts,"")),le.frame=!0;var Se=fe.data;if($&&Se.length>4){var Ee=new De(Se).readSliceType();Ee!==2&&Ee!==4&&Ee!==7&&Ee!==9||(le.key=!0)}break;case 5:P=!0,le||(le=F.avcSample=Oe(!0,E.pts,E.dts,"")),le.key=!0,le.frame=!0;break;case 6:P=!0,(0,M.parseSEIMessageFromNALu)(fe.data,1,E.pts,b.samples);break;case 7:if(P=!0,$=!0,!g.sps){var be=new De(fe.data).readSPS();g.width=be.width,g.height=be.height,g.pixelRatio=be.pixelRatio,g.sps=[fe.data],g.duration=F._duration;for(var Pe=fe.data.subarray(1,4),je="avc1.",Le=0;Le<3;Le++){var ze=Pe[Le].toString(16);ze.length<2&&(ze="0"+ze),je+=ze}g.codec=je}break;case 8:P=!0,g.pps||(g.pps=[fe.data]);break;case 9:P=!1,g.audFound=!0,le&&Ve(le,g),le=F.avcSample=Oe(!1,E.pts,E.dts,"");break;case 12:P=!0;break;default:P=!1,le&&(le.debug+="unknown NAL "+fe.type+" ")}le&&P&&le.units.push(fe)}),R&&le&&(Ve(le,g),this.avcSample=null)},L.getLastNalUnit=function(g){var b,E,R=this.avcSample;if(R&&R.units.length!==0||(R=g[g.length-1]),(b=R)!==null&&b!==void 0&&b.units){var P=R.units;E=P[P.length-1]}return E},L.parseAVCNALu=function(g,b){var E,R,P=b.byteLength,F=g.naluState||0,X=F,le=[],$=0,fe=-1,Se=0;for(F===-1&&(fe=0,Se=31&b[0],F=0,$=1);$<P;)if(E=b[$++],F)if(F!==1)if(E)if(E===1){if(fe>=0){var Ee={data:b.subarray(fe,$-F-1),type:Se};le.push(Ee)}else{var be=this.getLastNalUnit(g.samples);if(be&&(X&&$<=4-X&&be.state&&(be.data=be.data.subarray(0,be.data.byteLength-X)),(R=$-F-1)>0)){var Pe=new Uint8Array(be.data.byteLength+R);Pe.set(be.data,0),Pe.set(b.subarray(0,R),be.data.byteLength),be.data=Pe,be.state=0}}$<P?(fe=$,Se=31&b[$],F=0):F=-1}else F=0;else F=3;else F=E?0:2;else F=E?0:1;if(fe>=0&&F>=0){var je={data:b.subarray(fe,P),type:Se,state:F};le.push(je)}if(le.length===0){var Le=this.getLastNalUnit(g.samples);if(Le){var ze=new Uint8Array(Le.data.byteLength+b.byteLength);ze.set(Le.data,0),ze.set(b,Le.data.byteLength),Le.data=ze}}return g.naluState=F,le},L.parseAACPES=function(g,b){var E,R,P,F,X,le=0,$=this.aacOverFlow,fe=b.data;if($){this.aacOverFlow=null;var Se=$.missing,Ee=$.sample.unit.byteLength;if(Se===-1){var be=new Uint8Array(Ee+fe.byteLength);be.set($.sample.unit,0),be.set(fe,Ee),fe=be}else{var Pe=Ee-Se;$.sample.unit.set(fe.subarray(0,Se),Pe),g.samples.push($.sample),le=$.missing}}for(E=le,R=fe.length;E<R-1&&!de(fe,E);E++);if(E===le||(E<R-1?(P="AAC PES did not start with ADTS header,offset:"+E,F=!1):(P="no ADTS header found in AAC PES",F=!0),ne.logger.warn("parsing error:"+P),this.observer.emit(he.Events.ERROR,he.Events.ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:P}),!F)){if(x(g,this.observer,fe,E,this.audioCodec),b.pts!==void 0)X=b.pts;else{if(!$)return void ne.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var je=p(g.samplerate);X=$.sample.pts+je}for(var Le,ze=0;E<R;){if(E+=(Le=A(g,fe,E,X,ze)).length,Le.missing){this.aacOverFlow=Le;break}for(ze++;E<R-1&&!de(fe,E);E++);}}},L.parseMPEGPES=function(g,b){var E=b.data,R=E.length,P=0,F=0,X=b.pts;if(X!==void 0)for(;F<R;)if(ke(E,F)){var le=ge(g,E,F,X,P);if(!le)break;F+=le.length,P++}else F++;else ne.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},L.parseID3PES=function(g,b){if(b.pts!==void 0){var E=He({},b,{type:this._avcTrack?S.MetadataSchema.emsg:S.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});g.samples.push(E)}else ne.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},O}();function Je(O,L){return Je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,b){return g.__proto__=b,g},Je(O,L)}const $e=function(O){var L,g;function b(){return O.apply(this,arguments)||this}g=O,(L=b).prototype=Object.create(g.prototype),L.prototype.constructor=L,Je(L,g);var E=b.prototype;return E.resetInitSegment=function(R,P,F,X){O.prototype.resetInitSegment.call(this,R,P,F,X),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:P,duration:X,inputTimeScale:9e4,dropped:0}},b.probe=function(R){if(!R)return!1;for(var P=(_.getID3Data(R,0)||[]).length,F=R.length;P<F;P++)if(ie(R,P))return ne.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(R,P){return function(F,X){return Te(F,X)&&4<=F.length-X}(R,P)},E.appendFrame=function(R,P,F){if(this.basePTS!==null)return ge(R,P,F,this.basePTS,this.frameIndex)},b}(te);var ot=V(524),rt=V(923);function Ze(O,L){var g=O==null?void 0:O.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||L===rt.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const ht=function(){function O(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var L=O.prototype;return L.destroy=function(){},L.resetTimeStamp=function(g){this.initPTS=g,this.lastEndTime=null},L.resetNextTimestamp=function(){this.lastEndTime=null},L.resetInitSegment=function(g,b,E){this.audioCodec=b,this.videoCodec=E,this.generateInitSegment(g),this.emitInitSegment=!0},L.generateInitSegment=function(g){var b=this.audioCodec,E=this.videoCodec;if(!g||!g.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var R=this.initData=(0,M.parseInitSegment)(g);b||(b=Ze(R.audio,rt.ElementaryStreamTypes.AUDIO)),E||(E=Ze(R.video,rt.ElementaryStreamTypes.VIDEO));var P={};R.audio&&R.video?P.audiovideo={container:"video/mp4",codec:b+","+E,initSegment:g,id:"main"}:R.audio?P.audio={container:"audio/mp4",codec:b,initSegment:g,id:"audio"}:R.video?P.video={container:"video/mp4",codec:E,initSegment:g,id:"main"}:ne.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=P},L.remux=function(g,b,E,R,P){var F,X=this.initPTS,le=this.lastEndTime,$={audio:void 0,video:void 0,text:R,id3:E,initSegment:void 0};(0,f.isFiniteNumber)(le)||(le=this.lastEndTime=P||0);var fe=b.samples;if(!fe||!fe.length)return $;var Se={initPTS:void 0,timescale:1},Ee=this.initData;if(Ee&&Ee.length||(this.generateInitSegment(fe),Ee=this.initData),!Ee||!Ee.length)return ne.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),$;this.emitInitSegment&&(Se.tracks=this.initTracks,this.emitInitSegment=!1);var be=(0,M.getStartDTS)(Ee,fe);(0,f.isFiniteNumber)(X)||(this.initPTS=Se.initPTS=X=be-P);var Pe=(0,M.getDuration)(fe,Ee),je=g?be-X:le,Le=je+Pe;(0,M.offsetStartDTS)(Ee,fe,X),Pe>0?this.lastEndTime=Le:(ne.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var ze=!!Ee.audio,dt=!!Ee.video,nt="";ze&&(nt+="audio"),dt&&(nt+="video");var et={data1:fe,startPTS:je,startDTS:je,endPTS:Le,endDTS:Le,type:nt,hasAudio:ze,hasVideo:dt,nb:1,dropped:0};$.audio=et.type==="audio"?et:void 0,$.video=et.type!=="audio"?et:void 0,$.initSegment=Se;var gt=(F=this.initPTS)!=null?F:0;return $.id3=(0,ot.flushTextTrackMetadataCueSamples)(E,P,gt,gt),R.samples.length&&($.text=(0,ot.flushTextTrackUserdataCueSamples)(R,P,gt)),$},O}();var it;try{it=self.performance.now.bind(self.performance)}catch(O){ne.logger.debug("Unable to use Performance API on this environment"),it=self.Date.now}var lt=[{demux:Me,remux:ot.default},{demux:oe,remux:ht},{demux:K,remux:ot.default},{demux:$e,remux:ot.default}],yt=function(){function O(g,b,E,R,P){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=g,this.typeSupported=b,this.config=E,this.vendor=R,this.id=P}var L=O.prototype;return L.configure=function(g){this.transmuxConfig=g,this.decrypter&&this.decrypter.reset()},L.push=function(g,b,E,R){var P=this,F=E.transmuxing;F.executeStart=it();var X=new Uint8Array(g),le=this.config,$=this.currentTransmuxState,fe=this.transmuxConfig;R&&(this.currentTransmuxState=R);var Se=R||$,Ee=Se.contiguous,be=Se.discontinuity,Pe=Se.trackSwitch,je=Se.accurateTimeOffset,Le=Se.timeOffset,ze=Se.initSegmentChange,dt=fe.audioCodec,nt=fe.videoCodec,et=fe.defaultInitPts,gt=fe.duration,xe=fe.initSegmentData;(be||Pe||ze)&&this.resetInitSegment(xe,dt,nt,gt),(be||ze)&&this.resetInitialTimestamp(et),Ee||this.resetContiguity();var ft=function(Nt,It){var or=null;return Nt.byteLength>0&&It!=null&&It.key!=null&&It.iv!==null&&It.method!=null&&(or=It),or}(X,b);if(ft&&ft.method==="AES-128"){var Ct=this.getDecrypter();if(!le.enableSoftwareAES)return this.decryptionPromise=Ct.webCryptoDecrypt(X,ft.key.buffer,ft.iv.buffer).then(function(Nt){var It=P.push(Nt,null,E);return P.decryptionPromise=null,It}),this.decryptionPromise;var ut=Ct.softwareDecrypt(X,ft.key.buffer,ft.iv.buffer);if(!ut)return F.executeEnd=it(),ct(E);X=new Uint8Array(ut)}this.needsProbing(X,be,Pe)&&this.configureTransmuxer(X,fe);var bt=this.transmux(X,ft,Le,je,E),pt=this.currentTransmuxState;return pt.contiguous=!0,pt.discontinuity=!1,pt.trackSwitch=!1,F.executeEnd=it(),bt},L.flush=function(g){var b=this,E=g.transmuxing;E.executeStart=it();var R=this.decrypter,P=this.currentTransmuxState,F=this.decryptionPromise;if(F)return F.then(function(){return b.flush(g)});var X=[],le=P.timeOffset;if(R){var $=R.flush();$&&X.push(this.push($,null,g))}var fe=this.demuxer,Se=this.remuxer;if(!fe||!Se)return this.observer.emit(he.Events.ERROR,he.Events.ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),E.executeEnd=it(),[ct(g)];var Ee=fe.flush(le);return Et(Ee)?Ee.then(function(be){return b.flushRemux(X,be,g),X}):(this.flushRemux(X,Ee,g),X)},L.flushRemux=function(g,b,E){var R=b.audioTrack,P=b.videoTrack,F=b.id3Track,X=b.textTrack,le=this.currentTransmuxState,$=le.accurateTimeOffset,fe=le.timeOffset;ne.logger.log("[transmuxer.ts]: Flushed fragment "+E.sn+(E.part>-1?" p: "+E.part:"")+" of level "+E.level);var Se=this.remuxer.remux(R,P,F,X,fe,$,!0,this.id);g.push({remuxResult:Se,chunkMeta:E}),E.transmuxing.executeEnd=it()},L.resetInitialTimestamp=function(g){var b=this.demuxer,E=this.remuxer;b&&E&&(b.resetTimeStamp(g),E.resetTimeStamp(g))},L.resetContiguity=function(){var g=this.demuxer,b=this.remuxer;g&&b&&(g.resetContiguity(),b.resetNextTimestamp())},L.resetInitSegment=function(g,b,E,R){var P=this.demuxer,F=this.remuxer;P&&F&&(P.resetInitSegment(g,b,E,R),F.resetInitSegment(g,b,E))},L.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},L.transmux=function(g,b,E,R,P){return b&&b.method==="SAMPLE-AES"?this.transmuxSampleAes(g,b,E,R,P):this.transmuxUnencrypted(g,E,R,P)},L.transmuxUnencrypted=function(g,b,E,R){var P=this.demuxer.demux(g,b,!1,!this.config.progressive),F=P.audioTrack,X=P.videoTrack,le=P.id3Track,$=P.textTrack;return{remuxResult:this.remuxer.remux(F,X,le,$,b,E,!1,this.id),chunkMeta:R}},L.transmuxSampleAes=function(g,b,E,R,P){var F=this;return this.demuxer.demuxSampleAes(g,b,E).then(function(X){return{remuxResult:F.remuxer.remux(X.audioTrack,X.videoTrack,X.id3Track,X.textTrack,E,R,!1,F.id),chunkMeta:P}})},L.configureTransmuxer=function(g,b){for(var E,R=this.config,P=this.observer,F=this.typeSupported,X=this.vendor,le=b.audioCodec,$=b.defaultInitPts,fe=b.duration,Se=b.initSegmentData,Ee=b.videoCodec,be=0,Pe=lt.length;be<Pe;be++)if(lt[be].demux.probe(g)){E=lt[be];break}E||(ne.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),E={demux:oe,remux:ht});var je=this.demuxer,Le=this.remuxer,ze=E.remux,dt=E.demux;Le&&Le instanceof ze||(this.remuxer=new ze(P,R,F,X)),je&&je instanceof dt||(this.demuxer=new dt(P,R,F),this.probe=dt.probe),this.resetInitSegment(Se,le,Ee,fe),this.resetInitialTimestamp($)},L.needsProbing=function(g,b,E){return!this.demuxer||!this.remuxer||b||E},L.getDecrypter=function(){var g=this.decrypter;return g||(g=this.decrypter=new w.default(this.observer,this.config)),g},O}(),ct=function(O){return{remuxResult:{},chunkMeta:O}};function Et(O){return"then"in O&&O.then instanceof Function}var Tt=function(O,L,g,b,E){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=O,this.videoCodec=L,this.initSegmentData=g,this.duration=b,this.defaultInitPts=E},St=function(O,L,g,b,E,R){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=O,this.contiguous=L,this.accurateTimeOffset=g,this.trackSwitch=b,this.timeOffset=E,this.initSegmentChange=R}},973:(we,ye,V)=>{"use strict";var he,J;V.r(ye),V.d(ye,{ErrorDetails:()=>J,ErrorTypes:()=>he}),function(w){w.NETWORK_ERROR="networkError",w.MEDIA_ERROR="mediaError",w.KEY_SYSTEM_ERROR="keySystemError",w.MUX_ERROR="muxError",w.OTHER_ERROR="otherError"}(he||(he={})),function(w){w.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",w.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",w.KEY_SYSTEM_NO_SESSION="keySystemNoSession",w.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",w.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",w.MANIFEST_LOAD_ERROR="manifestLoadError",w.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",w.MANIFEST_PARSING_ERROR="manifestParsingError",w.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",w.LEVEL_EMPTY_ERROR="levelEmptyError",w.LEVEL_LOAD_ERROR="levelLoadError",w.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",w.LEVEL_SWITCH_ERROR="levelSwitchError",w.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",w.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",w.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",w.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",w.FRAG_LOAD_ERROR="fragLoadError",w.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",w.FRAG_DECRYPT_ERROR="fragDecryptError",w.FRAG_PARSING_ERROR="fragParsingError",w.REMUX_ALLOC_ERROR="remuxAllocError",w.KEY_LOAD_ERROR="keyLoadError",w.KEY_LOAD_TIMEOUT="keyLoadTimeOut",w.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",w.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",w.BUFFER_APPEND_ERROR="bufferAppendError",w.BUFFER_APPENDING_ERROR="bufferAppendingError",w.BUFFER_STALLED_ERROR="bufferStalledError",w.BUFFER_FULL_ERROR="bufferFullError",w.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",w.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",w.INTERNAL_EXCEPTION="internalException",w.INTERNAL_ABORTED="aborted",w.UNKNOWN="unknown"}(J||(J={}))},851:(we,ye,V)=>{"use strict";var he;V.r(ye),V.d(ye,{Events:()=>he}),function(J){J.MEDIA_ATTACHING="hlsMediaAttaching",J.MEDIA_ATTACHED="hlsMediaAttached",J.MEDIA_DETACHING="hlsMediaDetaching",J.MEDIA_DETACHED="hlsMediaDetached",J.BUFFER_RESET="hlsBufferReset",J.BUFFER_CODECS="hlsBufferCodecs",J.BUFFER_CREATED="hlsBufferCreated",J.BUFFER_APPENDING="hlsBufferAppending",J.BUFFER_APPENDED="hlsBufferAppended",J.BUFFER_EOS="hlsBufferEos",J.BUFFER_FLUSHING="hlsBufferFlushing",J.BUFFER_FLUSHED="hlsBufferFlushed",J.MANIFEST_LOADING="hlsManifestLoading",J.MANIFEST_LOADED="hlsManifestLoaded",J.MANIFEST_PARSED="hlsManifestParsed",J.LEVEL_SWITCHING="hlsLevelSwitching",J.LEVEL_SWITCHED="hlsLevelSwitched",J.LEVEL_LOADING="hlsLevelLoading",J.LEVEL_LOADED="hlsLevelLoaded",J.LEVEL_UPDATED="hlsLevelUpdated",J.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",J.LEVELS_UPDATED="hlsLevelsUpdated",J.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",J.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",J.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",J.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",J.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",J.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",J.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",J.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",J.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",J.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",J.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",J.CUES_PARSED="hlsCuesParsed",J.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",J.INIT_PTS_FOUND="hlsInitPtsFound",J.FRAG_LOADING="hlsFragLoading",J.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",J.FRAG_LOADED="hlsFragLoaded",J.FRAG_DECRYPTED="hlsFragDecrypted",J.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",J.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",J.FRAG_PARSING_METADATA="hlsFragParsingMetadata",J.FRAG_PARSED="hlsFragParsed",J.FRAG_BUFFERED="hlsFragBuffered",J.FRAG_CHANGED="hlsFragChanged",J.FPS_DROP="hlsFpsDrop",J.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",J.ERROR="hlsError",J.DESTROYING="hlsDestroying",J.KEY_LOADING="hlsKeyLoading",J.KEY_LOADED="hlsKeyLoaded",J.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",J.BACK_BUFFER_REACHED="hlsBackBufferReached"}(he||(he={}))},817:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{default:()=>Oi});var he,J=V(945),w=V(965),f=V(851),_=V(973),S=V(93),U=V(63),M=/^(\d+)x(\d+)$/,N=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,H=function(){function h(e){for(var t in typeof e=="string"&&(e=h.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var l=h.prototype;return l.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},l.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},l.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},l.decimalFloatingPoint=function(e){return parseFloat(this[e])},l.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},l.enumeratedString=function(e){return this[e]},l.bool=function(e){return this[e]==="YES"},l.decimalResolution=function(e){var t=M.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},h.parseAttrList=function(e){var t,i={};for(N.lastIndex=0;(t=N.exec(e))!==null;){var n=t[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},h}();function Y(){return Y=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Y.apply(this,arguments)}function te(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}(function(h){h.ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN"})(he||(he={}));var ne=function(){function h(t,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var s in n)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==n[s]){S.logger.warn('DATERANGE tag attribute: "'+s+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=s;break}t=Y(new H({}),n,t)}if(this.attr=t,this._startDate=new Date(t[he.START_DATE]),he.END_DATE in this.attr){var r=new Date(this.attr[he.END_DATE]);(0,w.isFiniteNumber)(r.getTime())&&(this._endDate=r)}}var l,e;return l=h,(e=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return t!==null?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(he.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(he.DURATION);if((0,w.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return he.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(he.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(he.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,w.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&te(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}(),re=V(923);function Z(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}var ve=function(){function h(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}var l,e;return h.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},l=h,(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,w.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!==null&&t!==void 0&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&Z(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}(),de=V(960),pe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function x(h,l){return MediaSource.isTypeSupported((l||"video")+'/mp4;codecs="'+h+'"')}var p=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,A=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),K=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ae=/\.(mp4|m4s|m4v|m4a)$/i,oe=function(){function h(){}return h.findGroup=function(l,e){for(var t=0;t<l.length;t++){var i=l[t];if(i.id===e)return i}},h.convertAVC1ToAVCOTI=function(l){var e=l.split(".");if(e.length>2){var t=e.shift()+".";return(t+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return l},h.resolve=function(l,e){return J.buildAbsoluteURL(e,l,{alwaysNormalize:!0})},h.parseMasterPlaylist=function(l,e){var t,i=[],n=[],s={},r=!1;for(p.lastIndex=0;(t=p.exec(l))!=null;)if(t[1]){var a,o=new H(t[1]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:h.resolve(t[2],e)},d=o.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),D((o.CODECS||"").split(/[ ,]+/).filter(function(v){return v}),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=h.convertAVC1ToAVCOTI(u.videoCodec)),(a=u.unknownCodecs)!==null&&a!==void 0&&a.length||n.push(u),i.push(u)}else if(t[3]){var c=new H(t[3]);c["DATA-ID"]&&(r=!0,s[c["DATA-ID"]]=c)}return{levels:n.length>0&&n.length<i.length?n:i,sessionData:r?s:null}},h.parseMasterPlaylistMedia=function(l,e,t,i){var n;i===void 0&&(i=[]);var s=[],r=0;for(A.lastIndex=0;(n=A.exec(l))!==null;){var a=new H(n[1]);if(a.TYPE===t){var o={attrs:a,bitrate:0,id:r++,groupId:a["GROUP-ID"],instreamId:a["INSTREAM-ID"],name:a.NAME||a.LANGUAGE||"",type:t,default:a.bool("DEFAULT"),autoselect:a.bool("AUTOSELECT"),forced:a.bool("FORCED"),lang:a.LANGUAGE,url:a.URI?h.resolve(a.URI,e):""};if(i.length){var u=h.findGroup(i,o.groupId)||i[0];G(o,u,"audioCodec"),G(o,u,"textCodec")}s.push(o)}}return s},h.parseLevelPlaylist=function(l,e,t,i,n){var s,r,a,o=new ve(e),u=o.fragments,d=null,c=0,v=0,m=0,y=0,I=null,k=new re.Fragment(i,e),z=-1,Q=!1;for(T.lastIndex=0,o.m3u8=l;(s=T.exec(l))!==null;){Q&&(Q=!1,(k=new re.Fragment(i,e)).start=m,k.sn=c,k.cc=y,k.level=t,d&&(k.initSegment=d,k.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var j=s[1];if(j){k.duration=parseFloat(j);var ee=(" "+s[2]).slice(1);k.title=ee||null,k.tagList.push(ee?["INF",j,ee]:["INF",j])}else if(s[3])(0,w.isFiniteNumber)(k.duration)&&(k.start=m,a&&(k.levelkey=a),k.sn=c,k.level=t,k.cc=y,k.urlId=n,u.push(k),k.relurl=(" "+s[3]).slice(1),B(k,I),I=k,m+=k.duration,c++,v=0,Q=!0);else if(s[4]){var se=(" "+s[4]).slice(1);I?k.setByteRange(se,I):k.setByteRange(se)}else if(s[5])k.rawProgramDateTime=(" "+s[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),z===-1&&(z=u.length);else{if(!(s=s[0].match(K))){S.logger.warn("No matches on slow regex match for level playlist!");continue}for(r=1;r<s.length&&s[r]===void 0;r++);var W=(" "+s[r]).slice(1),ce=(" "+s[r+1]).slice(1),ue=s[r+2]?(" "+s[r+2]).slice(1):"";switch(W){case"PLAYLIST-TYPE":o.type=ce.toUpperCase();break;case"MEDIA-SEQUENCE":c=o.startSN=parseInt(ce);break;case"SKIP":var Ae=new H(ce),Ie=Ae.decimalInteger("SKIPPED-SEGMENTS");if((0,w.isFiniteNumber)(Ie)){o.skippedSegments=Ie;for(var Ge=Ie;Ge--;)u.unshift(null);c+=Ie}var Xe=Ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");Xe&&(o.recentlyRemovedDateranges=Xe.split("	"));break;case"TARGETDURATION":o.targetduration=parseFloat(ce);break;case"VERSION":o.version=parseInt(ce);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(ce||ue)&&k.tagList.push(ue?[ce,ue]:[ce]);break;case"DISCONTINUITY":y++,k.tagList.push(["DIS"]);break;case"GAP":k.tagList.push([W]);break;case"BITRATE":k.tagList.push([W,ce]);break;case"DATERANGE":var Ue=new H(ce),Ke=new ne(Ue,o.dateRanges[Ue.ID]);Ke.isValid||o.skippedSegments?o.dateRanges[Ke.id]=Ke:S.logger.warn('Ignoring invalid DATERANGE tag: "'+ce+'"'),k.tagList.push(["EXT-X-DATERANGE",ce]);break;case"DISCONTINUITY-SEQUENCE":y=parseInt(ce);break;case"KEY":var Qe,at=new H(ce),vt=at.enumeratedString("METHOD"),tt=at.URI,st=at.hexadecimalInteger("IV"),Lt=at.enumeratedString("KEYFORMATVERSIONS"),er=at.enumeratedString("KEYID"),Ce=(Qe=at.enumeratedString("KEYFORMAT"))!=null?Qe:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Ce)>-1){S.logger.warn("Keyformat "+Ce+" is not supported from the manifest");continue}if(Ce!=="identity")continue;vt&&(a=de.LevelKey.fromURL(e,tt),tt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(vt)>=0&&(a.method=vt,a.keyFormat=Ce,er&&(a.keyID=er),Lt&&(a.keyFormatVersions=Lt),a.iv=st));break;case"START":var Be=new H(ce).decimalFloatingPoint("TIME-OFFSET");(0,w.isFiniteNumber)(Be)&&(o.startTimeOffset=Be);break;case"MAP":var tr=new H(ce);if(k.duration){var Ft=new re.Fragment(i,e);q(Ft,tr,t,a),d=Ft,k.initSegment=d,d.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=d.rawProgramDateTime)}else q(k,tr,t,a),d=k,Q=!0;break;case"SERVER-CONTROL":var At=new H(ce);o.canBlockReload=At.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=At.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&At.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=At.optionalFloat("PART-HOLD-BACK",0),o.holdBack=At.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var rr=new H(ce);o.partTarget=rr.decimalFloatingPoint("PART-TARGET");break;case"PART":var kt=o.partList;kt||(kt=o.partList=[]);var Mt=v>0?kt[kt.length-1]:void 0,Kt=v++,Rt=new re.Part(new H(ce),k,e,Kt,Mt);kt.push(Rt),k.duration+=Rt.duration;break;case"PRELOAD-HINT":var ir=new H(ce);o.preloadHint=ir;break;case"RENDITION-REPORT":var zt=new H(ce);o.renditionReports=o.renditionReports||[],o.renditionReports.push(zt);break;default:S.logger.warn("line parsed but not handled: "+s)}}}I&&!I.relurl?(u.pop(),m-=I.duration,o.partList&&(o.fragmentHint=I)):o.partList&&(B(k,I),k.cc=y,o.fragmentHint=k);var Yr=u.length,vr=u[0],qr=u[Yr-1];if((m+=o.skippedSegments*o.targetduration)>0&&Yr&&qr){o.averagetargetduration=m/Yr;var Pi=qr.sn;o.endSN=Pi!=="initSegment"?Pi:0,vr&&(o.startCC=vr.cc,vr.initSegment||o.fragments.every(function(nr){return nr.relurl&&(ar=nr.relurl,ae.test((sr=(Xt=J.parseURL(ar))===null||Xt===void 0?void 0:Xt.path)!=null?sr:""));var ar,sr,Xt})&&(S.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(k=new re.Fragment(i,e)).relurl=qr.relurl,k.level=t,k.sn="initSegment",vr.initSegment=k,o.needSidxRanges=!0))}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(m+=o.fragmentHint.duration),o.totalduration=m,o.endCC=y,z>0&&function(nr,ar){for(var sr=nr[ar],Xt=ar;Xt--;){var pr=nr[Xt];if(!pr)return;pr.programDateTime=sr.programDateTime-1e3*pr.duration,sr=pr}}(u,z),o},h}();function D(h,l){["video","audio","text"].forEach(function(e){var t=h.filter(function(n){return function(s,r){var a=pe[r];return!!a&&a[s.slice(0,4)]===!0}(n,e)});if(t.length){var i=t.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});l[e+"Codec"]=i.length>0?i[0]:t[0],h=h.filter(function(n){return t.indexOf(n)===-1})}}),l.unknownCodecs=h}function G(h,l,e){var t=l[e];t&&(h[e]=t)}function B(h,l){h.rawProgramDateTime?h.programDateTime=Date.parse(h.rawProgramDateTime):l!=null&&l.programDateTime&&(h.programDateTime=l.endProgramDateTime),(0,w.isFiniteNumber)(h.programDateTime)||(h.programDateTime=null,h.rawProgramDateTime=null)}function q(h,l,e,t){h.relurl=l.URI,l.BYTERANGE&&h.setByteRange(l.BYTERANGE),h.level=e,h.sn="initSegment",t&&(h.levelkey=t),h.initSegment=null}var C=V(308);function ge(h,l){var e=h.url;return e!==void 0&&e.indexOf("data:")!==0||(e=l.url),e}const me=function(){function h(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var l=h.prototype;return l.startLoad=function(e){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var e=this.hls;e.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(f.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(f.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var e=this.hls;e.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(f.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(f.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,s=new(i||n)(t);return e.loader=s,this.loaders[e.type]=s,s},l.getInternalLoader=function(e){return this.loaders[e.type]},l.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},l.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:C.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},l.onLevelLoading=function(e,t){var i=t.id,n=t.level,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:C.PlaylistContextType.LEVEL,url:s,deliveryDirectives:r})},l.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:C.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:r})},l.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:C.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:r})},l.load=function(e){var t,i,n,s,r,a,o=this.hls.config,u=this.getInternalLoader(e);if(u){var d=u.context;if(d&&d.url===e.url)return void S.logger.trace("[playlist-loader]: playlist request ongoing");S.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),u.abort()}switch(e.type){case C.PlaylistContextType.MANIFEST:i=o.manifestLoadingMaxRetry,n=o.manifestLoadingTimeOut,s=o.manifestLoadingRetryDelay,r=o.manifestLoadingMaxRetryTimeout;break;case C.PlaylistContextType.LEVEL:case C.PlaylistContextType.AUDIO_TRACK:case C.PlaylistContextType.SUBTITLE_TRACK:i=0,n=o.levelLoadingTimeOut;break;default:i=o.levelLoadingMaxRetry,n=o.levelLoadingTimeOut,s=o.levelLoadingRetryDelay,r=o.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part&&(e.type===C.PlaylistContextType.LEVEL&&e.level!==null?a=this.hls.levels[e.level].details:e.type===C.PlaylistContextType.AUDIO_TRACK&&e.id!==null?a=this.hls.audioTracks[e.id].details:e.type===C.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(a=this.hls.subtitleTracks[e.id].details),a)){var c=a.partTarget,v=a.targetduration;c&&v&&(n=Math.min(1e3*Math.max(3*c,.8*v),n))}var m={timeout:n,maxRetry:i,retryDelay:s,maxRetryDelay:r,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(e,m,y)},l.loadsuccess=function(e,t,i,n){if(n===void 0&&(n=null),i.isSidxRequest)return this.handleSidxRequest(e,i),void this.handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var s=e.data;s.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,n):this.handleMasterPlaylist(e,t,i,n)):this.handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},l.loaderror=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,e)},l.loadtimeout=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},l.handleMasterPlaylist=function(e,t,i,n){var s=this.hls,r=e.data,a=ge(e,i),o=oe.parseMasterPlaylist(r,a),u=o.levels,d=o.sessionData;if(u.length){var c=u.map(function(k){return{id:k.attrs.AUDIO,audioCodec:k.audioCodec}}),v=u.map(function(k){return{id:k.attrs.SUBTITLES,textCodec:k.textCodec}}),m=oe.parseMasterPlaylistMedia(r,a,"AUDIO",c),y=oe.parseMasterPlaylistMedia(r,a,"SUBTITLES",v),I=oe.parseMasterPlaylistMedia(r,a,"CLOSED-CAPTIONS");m.length&&(m.some(function(k){return!k.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(S.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new H({}),bitrate:0,url:""}))),s.trigger(f.Events.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:y,captions:I,url:a,stats:t,networkDetails:n,sessionData:d})}else this.handleManifestParsingError(e,i,"no level found in manifest",n)},l.handleTrackOrLevelPlaylist=function(e,t,i,n){var s=this.hls,r=i.id,a=i.level,o=i.type,u=ge(e,i),d=(0,w.isFiniteNumber)(r)?r:0,c=(0,w.isFiniteNumber)(a)?a:d,v=function(z){switch(z.type){case C.PlaylistContextType.AUDIO_TRACK:return C.PlaylistLevelType.AUDIO;case C.PlaylistContextType.SUBTITLE_TRACK:return C.PlaylistLevelType.SUBTITLE;default:return C.PlaylistLevelType.MAIN}}(i),m=oe.parseLevelPlaylist(e.data,u,c,v,d);if(m.fragments.length){if(o===C.PlaylistContextType.MANIFEST){var y={attrs:new H({}),bitrate:0,details:m,name:"",url:u};s.trigger(f.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null})}if(t.parsing.end=performance.now(),m.needSidxRanges){var I,k=(I=m.fragments[0].initSegment)===null||I===void 0?void 0:I.url;this.load({url:k,isSidxRequest:!0,type:o,level:a,levelDetails:m,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=m,this.handlePlaylistLoaded(e,t,i,n)}else s.trigger(f.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},l.handleSidxRequest=function(e,t){var i=new Uint8Array(e.data),n=(0,U.findBox)(i,["sidx"])[0];if(n){var s=(0,U.parseSegmentIndex)(n);if(s){var r=s.references,a=t.levelDetails;r.forEach(function(o,u){var d=o.info,c=a.fragments[u];if(c.byteRange.length===0&&c.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),c.initSegment){var v=(0,U.findBox)(i,["moov"])[0],m=v?v.length:null;c.initSegment.setByteRange(String(m)+"@0")}})}}},l.handleManifestParsingError=function(e,t,i,n){this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===C.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:n})},l.handleNetworkError=function(e,t,i,n){i===void 0&&(i=!1),S.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=_.ErrorDetails.UNKNOWN,r=!1,a=this.getInternalLoader(e);switch(e.type){case C.PlaylistContextType.MANIFEST:s=i?_.ErrorDetails.MANIFEST_LOAD_TIMEOUT:_.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case C.PlaylistContextType.LEVEL:s=i?_.ErrorDetails.LEVEL_LOAD_TIMEOUT:_.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case C.PlaylistContextType.AUDIO_TRACK:s=i?_.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:_.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case C.PlaylistContextType.SUBTITLE_TRACK:s=i?_.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:_.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1}a&&this.resetInternalLoader(e.type);var o={type:_.ErrorTypes.NETWORK_ERROR,details:s,fatal:r,url:e.url,loader:a,context:e,networkDetails:t};n&&(o.response=n),this.hls.trigger(f.Events.ERROR,o)},l.handlePlaylistLoaded=function(e,t,i,n){var s=i.type,r=i.level,a=i.id,o=i.groupId,u=i.loader,d=i.levelDetails,c=i.deliveryDirectives;if(d!=null&&d.targetduration){if(u)switch(d.live&&(u.getCacheAge&&(d.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),s){case C.PlaylistContextType.MANIFEST:case C.PlaylistContextType.LEVEL:this.hls.trigger(f.Events.LEVEL_LOADED,{details:d,level:r||0,id:a||0,stats:t,networkDetails:n,deliveryDirectives:c});break;case C.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(f.Events.AUDIO_TRACK_LOADED,{details:d,id:a||0,groupId:o||"",stats:t,networkDetails:n,deliveryDirectives:c});break;case C.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(f.Events.SUBTITLE_TRACK_LOADED,{details:d,id:a||0,groupId:o||"",stats:t,networkDetails:n,deliveryDirectives:c})}}else this.handleManifestParsingError(e,i,"invalid target duration",n)},h}();var Te=function(){function h(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this.registerListeners()}var l=h.prototype;return l.startLoad=function(e){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){this.hls.on(f.Events.KEY_LOADING,this.onKeyLoading,this)},l.unregisterListeners=function(){this.hls.off(f.Events.KEY_LOADING,this.onKeyLoading)},l.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onKeyLoading=function(e,t){var i=t.frag,n=i.type,s=this.loaders[n];if(i.decryptdata){var r=i.decryptdata.uri;if(r!==this.decrypturl||this.decryptkey===null){var a=this.hls.config;if(s&&(S.logger.warn("abort previous key loader for type:"+n),s.abort()),!r)return void S.logger.warn("key uri is falsy");var o=a.loader,u=i.loader=this.loaders[n]=new o(a);this.decrypturl=r,this.decryptkey=null;var d={url:r,frag:i,responseType:"arraybuffer"},c={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(d,c,v)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(f.Events.KEY_LOADED,{frag:i}))}else S.logger.warn("Missing decryption data on fragment in onKeyLoading")},l.loadsuccess=function(e,t,i){var n=i.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(f.Events.KEY_LOADED,{frag:n})):S.logger.error("after key load, decryptdata unset")},l.loaderror=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},l.loadtimeout=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},h}();function ke(h,l){var e;try{e=new Event("addtrack")}catch(t){(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=h,l.dispatchEvent(e)}function ie(h,l){var e=h.mode;if(e==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(l.id))try{if(h.addCue(l),!h.cues.getCueById(l.id))throw new Error("addCue is failed for: "+l)}catch(i){S.logger.debug("[texttrack-utils]: "+i);var t=new self.TextTrackCue(l.startTime,l.endTime,l.text);t.id=l.id,h.addCue(t)}e==="disabled"&&(h.mode=e)}function De(h){var l=h.mode;if(l==="disabled"&&(h.mode="hidden"),h.cues)for(var e=h.cues.length;e--;)h.removeCue(h.cues[e]);l==="disabled"&&(h.mode=l)}function Re(h,l,e,t){var i=h.mode;if(i==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0)for(var n=function(r,a,o){var u=[],d=function(y,I){if(I<y[0].startTime)return 0;var k=y.length-1;if(I>y[k].endTime)return-1;for(var z=0,Q=k;z<=Q;){var j=Math.floor((Q+z)/2);if(I<y[j].startTime)Q=j-1;else{if(!(I>y[j].startTime&&z<k))return j;z=j+1}}return y[z].startTime-I<I-y[Q].startTime?z:Q}(r,a);if(d>-1)for(var c=d,v=r.length;c<v;c++){var m=r[c];if(m.startTime>=a&&m.endTime<=o)u.push(m);else if(m.startTime>o)return u}return u}(h.cues,l,e),s=0;s<n.length;s++)t&&!t(n[s])||h.removeCue(n[s]);i==="disabled"&&(h.mode=i)}var He=V(181),_e=V(856);function Oe(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Ne=function(){var h=Oe();try{new h(0,Number.POSITIVE_INFINITY,"")}catch(l){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Fe(h,l){return h.getTime()/1e3-l}const Ye=function(){function h(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var l=h.prototype;return l.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},l._registerListeners=function(){var e=this.hls;e.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l._unregisterListeners=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l.onMediaAttached=function(e,t){this.media=t.media},l.onMediaDetaching=function(){this.id3Track&&(De(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},l.onManifestLoading=function(){this.dateRangeCuesAppended={}},l.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},l.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if(i.kind==="metadata"&&i.label==="id3")return ke(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},l.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,s=i.enableID3MetadataCues;if(n||s){t.frag;var r=t.samples;t.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=Oe(),o=0;o<r.length;o++){var u=r[o].type;if((u!==_e.MetadataSchema.emsg||n)&&s){var d=He.getID3Frames(r[o].data);if(d){var c=r[o].pts,v=c+r[o].duration;v>Ne&&(v=Ne),v-c<=0&&(v=c+.25);for(var m=0;m<d.length;m++){var y=d[m];if(!He.isTimeStampFrame(y)){this.updateId3CueEnds(c);var I=new a(c,v,"");I.value=y,u&&(I.type=u),this.id3Track.addCue(I)}}}}}}}},l.updateId3CueEnds=function(e){var t,i=(t=this.id3Track)===null||t===void 0?void 0:t.cues;if(i)for(var n=i.length;n--;){var s=i[n];s.startTime<e&&s.endTime===Ne&&(s.endTime=e)}},l.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,s=t.type,r=this.id3Track,a=this.hls;if(a){var o=a.config,u=o.enableEmsgMetadataCues,d=o.enableID3MetadataCues;r&&(u||d)&&Re(r,i,n,s==="audio"?function(c){return c.type===_e.MetadataSchema.audioId3&&d}:s==="video"?function(c){return c.type===_e.MetadataSchema.emsg&&u}:function(c){return c.type===_e.MetadataSchema.audioId3&&d||c.type===_e.MetadataSchema.emsg&&u})}},l.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,r=this.id3Track,a=n.dateRanges,o=Object.keys(a);if(r)for(var u=Object.keys(s).filter(function(z){return!o.includes(z)}),d=function(z){var Q=u[z];Object.keys(s[Q].cues).forEach(function(j){r.removeCue(s[Q].cues[j])}),delete s[Q]},c=u.length;c--;)d(c);var v=n.fragments[n.fragments.length-1];if(o.length!==0&&(0,w.isFiniteNumber)(v==null?void 0:v.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var m=v.programDateTime/1e3-v.start,y=Oe(),I=function(z){var Q=o[z],j=a[Q],ee=s[Q],se=(ee==null?void 0:ee.cues)||{},W=(ee==null?void 0:ee.durationKnown)||!1,ce=Fe(j.startDate,m),ue=Ne,Ae=j.endDate;if(Ae)ue=Fe(Ae,m),W=!0;else if(j.endOnNext&&!W){var Ie=o.reduce(function(vt,tt){var st=a[tt];return st.class===j.class&&st.id!==tt&&st.startDate>j.startDate&&vt.push(st),vt},[]).sort(function(vt,tt){return vt.startDate.getTime()-tt.startDate.getTime()})[0];Ie&&(ue=Fe(Ie.startDate,m),W=!0)}for(var Ge,Xe=Object.keys(j.attr),Ue=0;Ue<Xe.length;Ue++){var Ke=Xe[Ue];if(Ke!==he.ID&&Ke!==he.CLASS&&Ke!==he.START_DATE&&Ke!==he.DURATION&&Ke!==he.END_DATE&&Ke!==he.END_ON_NEXT){var Qe=se[Ke];if(Qe)W&&!ee.durationKnown&&(Qe.endTime=ue);else{var at=j.attr[Ke];Qe=new y(ce,ue,""),Ke!==he.SCTE35_OUT&&Ke!==he.SCTE35_IN||(Ge=at,at=Uint8Array.from(Ge.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),Qe.value={key:Ke,data:at},Qe.type=_e.MetadataSchema.dateRange,i.id3Track.addCue(Qe),se[Ke]=Qe}}}s[Q]={cues:se,dateRange:j,durationKnown:W}},k=0;k<o.length;k++)I(k)}}},h}();function Ve(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}var Me,Je=function(){function h(i){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=i,this.config=i.config,this.registerListeners()}var l,e,t=h.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(f.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(f.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(f.Events.ERROR,this.onError)},t.onMediaAttached=function(i,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(i,n){var s=n.details;this.levelDetails=s,s.advanced&&this.timeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(i,n){n.details===_.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,S.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var i=this.media,n=this.levelDetails;if(i&&n){this.currentTime=i.currentTime;var s=this.computeLatency();if(s!==null){this._latency=s;var r=this.config,a=r.lowLatencyMode,o=r.maxLiveSyncPlaybackRate;if(a&&o!==1){var u=this.targetLatency;if(u!==null){var d=s-u,c=d<Math.min(this.maxLatency,u+n.targetduration);if(n.live&&c&&d>.05&&this.forwardBufferLength>1){var v=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20;i.playbackRate=Math.min(v,Math.max(1,m))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var i=this.levelDetails;return i===null?null:i.edge+i.age},t.computeLatency=function(){var i=this.estimateLiveEdge();return i===null?null:i-this.currentTime},l=h,(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var i=this.config,n=this.levelDetails;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:n?i.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var i=this.levelDetails;if(i===null)return null;var n=i.holdBack,s=i.partHoldBack,r=i.targetduration,a=this.config,o=a.liveSyncDuration,u=a.liveSyncDurationCount,d=a.lowLatencyMode,c=this.hls.userConfig,v=d&&s||n;(c.liveSyncDuration||c.liveSyncDurationCount||v===0)&&(v=o!==void 0?o:u*r);var m=r;return v+Math.min(1*this.stallCount,m)}},{key:"liveSyncPosition",get:function(){var i=this.estimateLiveEdge(),n=this.targetLatency,s=this.levelDetails;if(i===null||n===null||s===null)return null;var r=s.edge,a=i-n-this.edgeStalled,o=r-s.totalduration,u=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,a),u)}},{key:"drift",get:function(){var i=this.levelDetails;return i===null?1:i.drift}},{key:"edgeStalled",get:function(){var i=this.levelDetails;if(i===null)return 0;var n=3*(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.max(i.age-n,0)}},{key:"forwardBufferLength",get:function(){var i=this.media,n=this.levelDetails;if(!i||!n)return 0;var s=i.buffered.length;return(s?i.buffered.end(s-1):n.edge)-this.currentTime}}])&&Ve(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();function $e(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}(function(h){h.No="",h.Yes="YES",h.v2="v2"})(Me||(Me={}));var ot=function(){function h(l,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=l,this.part=e,this.skip=t}return h.prototype.addDirectives=function(l){var e=new self.URL(l);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},h}(),rt=function(){function h(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(i){return i}).join(",").replace(/\.[^.,]+/g,"")}var l,e;return l=h,(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&$e(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();function Ze(){return Ze=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Ze.apply(this,arguments)}function ht(h,l,e){switch(l){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(e);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(e)}}function it(h){var l={};h.forEach(function(e){var t=e.groupId||"";e.id=l[t]=l[t]||0,l[t]++})}function lt(h,l){var e=l.startPTS;if((0,w.isFiniteNumber)(e)){var t,i=0;l.sn>h.sn?(i=e-h.start,t=h):(i=h.start-e,t=l),t.duration!==i&&(t.duration=i)}else l.sn>h.sn?h.cc===l.cc&&h.minEndPTS?l.start=h.start+(h.minEndPTS-h.start):l.start=h.start+h.duration:l.start=Math.max(h.start-l.duration,0)}function yt(h,l,e,t,i,n){t-e<=0&&(S.logger.warn("Fragment should have a positive duration",l),t=e+l.duration,n=i+l.duration);var s=e,r=t,a=l.startPTS,o=l.endPTS;if((0,w.isFiniteNumber)(a)){var u=Math.abs(a-e);(0,w.isFiniteNumber)(l.deltaPTS)?l.deltaPTS=Math.max(u,l.deltaPTS):l.deltaPTS=u,s=Math.max(e,a),e=Math.min(e,a),i=Math.min(i,l.startDTS),r=Math.min(t,o),t=Math.max(t,o),n=Math.max(n,l.endDTS)}l.duration=t-e;var d=e-l.start;l.appendedPTS=t,l.start=l.startPTS=e,l.maxStartPTS=s,l.startDTS=i,l.endPTS=t,l.minEndPTS=r,l.endDTS=n;var c,v=l.sn;if(!h||v<h.startSN||v>h.endSN)return 0;var m=v-h.startSN,y=h.fragments;for(y[m]=l,c=m;c>0;c--)lt(y[c],y[c-1]);for(c=m;c<y.length-1;c++)lt(y[c],y[c+1]);return h.fragmentHint&&lt(y[y.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,d}function ct(h,l){var e=l.startSN+l.skippedSegments-h.startSN,t=h.fragments;e<0||e>=t.length||Et(l,t[e].start)}function Et(h,l){if(l){for(var e=h.fragments,t=h.skippedSegments;t<e.length;t++)e[t].start+=l;h.fragmentHint&&(h.fragmentHint.start+=l)}}var Tt=function(){function h(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=S.logger.log.bind(S.logger,t+":"),this.warn=S.logger.warn.bind(S.logger,t+":"),this.hls=e}var l=h.prototype;return l.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},l.onError=function(e,t){t.fatal&&t.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},l.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},l.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},l.stopLoad=function(){this.canLoad=!1,this.clearTimer()},l.switchParams=function(e,t){var i=t==null?void 0:t.renditionReports;if(i)for(var n=0;n<i.length;n++){var s=i[n],r=""+s.URI;if(r===e.slice(-r.length)){var a=parseInt(s["LAST-MSN"]),o=parseInt(s["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var u=Math.min(t.age-t.partTarget,t.targetduration);o!==void 0&&u>t.partTarget&&(o+=1)}if((0,w.isFiniteNumber)(a))return new ot(a,(0,w.isFiniteNumber)(o)?o:void 0,Me.No)}}},l.loadPlaylist=function(e){},l.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},l.playlistLoaded=function(e,t,i){var n=this,s=t.details,r=t.stats,a=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(s.advancedDateTime=Date.now()-a,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),i&&s.fragments.length>0&&function(se,W){for(var ce=null,ue=se.fragments,Ae=ue.length-1;Ae>=0;Ae--){var Ie=ue[Ae].initSegment;if(Ie){ce=Ie;break}}se.fragmentHint&&delete se.fragmentHint.endPTS;var Ge,Xe,Ue,Ke,Qe,at=0;if(function(Ce,Be,tr){for(var Ft=Be.skippedSegments,At=Math.max(Ce.startSN,Be.startSN)-Be.startSN,rr=(Ce.fragmentHint?1:0)+(Ft?Be.endSN:Math.min(Ce.endSN,Be.endSN))-Be.startSN,kt=Be.startSN-Ce.startSN,Mt=Be.fragmentHint?Be.fragments.concat(Be.fragmentHint):Be.fragments,Kt=Ce.fragmentHint?Ce.fragments.concat(Ce.fragmentHint):Ce.fragments,Rt=At;Rt<=rr;Rt++){var ir=Kt[kt+Rt],zt=Mt[Rt];Ft&&!zt&&Rt<Ft&&(zt=Be.fragments[Rt]=ir),ir&&zt&&tr(ir,zt)}}(se,W,function(Ce,Be){Ce.relurl&&(at=Ce.cc-Be.cc),(0,w.isFiniteNumber)(Ce.startPTS)&&(0,w.isFiniteNumber)(Ce.endPTS)&&(Be.start=Be.startPTS=Ce.startPTS,Be.startDTS=Ce.startDTS,Be.appendedPTS=Ce.appendedPTS,Be.maxStartPTS=Ce.maxStartPTS,Be.endPTS=Ce.endPTS,Be.endDTS=Ce.endDTS,Be.minEndPTS=Ce.minEndPTS,Be.duration=Ce.endPTS-Ce.startPTS,Be.duration&&(Ge=Be),W.PTSKnown=W.alignedSliding=!0),Be.elementaryStreams=Ce.elementaryStreams,Be.loader=Ce.loader,Be.stats=Ce.stats,Be.urlId=Ce.urlId,Ce.initSegment&&(Be.initSegment=Ce.initSegment,ce=Ce.initSegment)}),ce&&(W.fragmentHint?W.fragments.concat(W.fragmentHint):W.fragments).forEach(function(Ce){var Be;Ce.initSegment&&Ce.initSegment.relurl!==((Be=ce)===null||Be===void 0?void 0:Be.relurl)||(Ce.initSegment=ce)}),W.skippedSegments)if(W.deltaUpdateFailed=W.fragments.some(function(Ce){return!Ce}),W.deltaUpdateFailed){S.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var vt=W.skippedSegments;vt--;)W.fragments.shift();W.startSN=W.fragments[0].sn,W.startCC=W.fragments[0].cc}else W.canSkipDateRanges&&(W.dateRanges=(Xe=se.dateRanges,Ue=W.dateRanges,Ke=W.recentlyRemovedDateranges,Qe=Ze({},Xe),Ke&&Ke.forEach(function(Ce){delete Qe[Ce]}),Object.keys(Ue).forEach(function(Ce){var Be=new ne(Ue[Ce].attr,Qe[Ce]);Be.isValid?Qe[Ce]=Be:S.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Ue[Ce].attr)+'"')}),Qe));var tt=W.fragments;if(at){S.logger.warn("discontinuity sliding from playlist, take drift into account");for(var st=0;st<tt.length;st++)tt[st].cc+=at}W.skippedSegments&&(W.startCC=W.fragments[0].cc),function(Ce,Be,tr){if(Ce&&Be)for(var Ft=0,At=0,rr=Ce.length;At<=rr;At++){var kt=Ce[At],Mt=Be[At+Ft];kt&&Mt&&kt.index===Mt.index&&kt.fragment.sn===Mt.fragment.sn?(Kt=kt,(Rt=Mt).elementaryStreams=Kt.elementaryStreams,Rt.stats=Kt.stats):Ft--}var Kt,Rt}(se.partList,W.partList),Ge?yt(W,Ge,Ge.startPTS,Ge.endPTS,Ge.startDTS,Ge.endDTS):ct(se,W),tt.length&&(W.totalduration=W.edge-tt[0].start),W.driftStartTime=se.driftStartTime,W.driftStart=se.driftStart;var Lt=W.advancedDateTime;if(W.advanced&&Lt){var er=W.edge;W.driftStart||(W.driftStartTime=Lt,W.driftStart=er),W.driftEndTime=Lt,W.driftEnd=er}else W.driftEndTime=se.driftEndTime,W.driftEnd=se.driftEnd,W.advancedDateTime=se.advancedDateTime}(i,s),!this.canLoad||!s.live)return;var o,u=void 0,d=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var c=this.hls.config.lowLatencyMode,v=s.lastPartSn,m=s.endSN,y=s.lastPartIndex,I=v===m;y!==-1?(u=I?m+1:v,d=I?c?0:y:y+1):u=m+1;var k=s.age,z=k+s.ageHeader,Q=Math.min(z-s.partTarget,1.5*s.targetduration);if(Q>0){if(i&&Q>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+Q+" with playlist age: "+s.age),Q=0;else{var j=Math.floor(Q/s.targetduration);u+=j,d!==void 0&&(d+=Math.round(Q%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+k.toFixed(2)+"s goal: "+Q+" skip sn "+j+" to part "+d)}s.tuneInGoal=Q}if(o=this.getDeliveryDirectives(s,t.deliveryDirectives,u,d),c||!I)return void this.loadPlaylist(o)}else o=this.getDeliveryDirectives(s,t.deliveryDirectives,u,d);var ee=function(se,W){var ce,ue=1e3*se.levelTargetDuration,Ae=ue/2,Ie=se.age,Ge=Ie>0&&Ie<3*ue,Xe=W.loading.end-W.loading.start,Ue=se.availabilityDelay;if(se.updated===!1)if(Ge){var Ke=333*se.misses;ce=Math.max(Math.min(Ae,2*Xe),Ke),se.availabilityDelay=(se.availabilityDelay||0)+ce}else ce=Ae;else Ge?(Ue=Math.min(Ue||ue/2,Ie),se.availabilityDelay=Ue,ce=Ue+ue-Ie):ce=ue-Xe;return Math.round(ce)}(s,r);u!==void 0&&s.canBlockReload&&(ee-=s.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(ee)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(o)},ee)}else this.clearTimer()},l.getDeliveryDirectives=function(e,t,i,n){var s=function(r,a){var o=r.canSkipUntil,u=r.canSkipDateRanges,d=r.endSN;return o&&(a!==void 0?a-d:0)<o?u?Me.v2:Me.Yes:Me.No}(e,i);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,s=Me.No),new ot(i,n,s)},l.retryLoadingOrFail=function(e){var t,i=this,n=this.hls.config,s=this.retryCount<n.levelLoadingMaxRetry;if(s)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&(t=e.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return i.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return s},h}();function St(){return St=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},St.apply(this,arguments)}function O(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function L(h,l){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(h,l)}var g,b=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),E=function(h){var l,e;function t(r){var a;return(a=h.call(this,r,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,L(l,e);var i,n,s=t.prototype;return s._registerListeners=function(){var r=this.hls;r.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(f.Events.ERROR,this.onError,this)},s._unregisterListeners=function(){var r=this.hls;r.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(f.Events.ERROR,this.onError,this)},s.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,h.prototype.destroy.call(this)},s.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),h.prototype.startLoad.call(this)},s.onManifestLoaded=function(r,a){var o,u,d=[],c=[],v=[],m={},y=!1,I=!1,k=!1;if(a.levels.forEach(function(ee){var se=ee.attrs;y=y||!(!ee.width||!ee.height),I=I||!!ee.videoCodec,k=k||!!ee.audioCodec,b&&ee.audioCodec&&ee.audioCodec.indexOf("mp4a.40.34")!==-1&&(ee.audioCodec=void 0);var W=ee.bitrate+"-"+ee.attrs.RESOLUTION+"-"+ee.attrs.CODECS;(u=m[W])?u.url.push(ee.url):(u=new rt(ee),m[W]=u,d.push(u)),se&&(se.AUDIO&&ht(u,"audio",se.AUDIO),se.SUBTITLES&&ht(u,"text",se.SUBTITLES))}),(y||I)&&k&&(d=d.filter(function(ee){var se=ee.videoCodec,W=ee.width,ce=ee.height;return!!se||!(!W||!ce)})),d=d.filter(function(ee){var se=ee.audioCodec,W=ee.videoCodec;return(!se||x(se,"audio"))&&(!W||x(W,"video"))}),a.audioTracks&&it(c=a.audioTracks.filter(function(ee){return!ee.audioCodec||x(ee.audioCodec,"audio")})),a.subtitles&&it(v=a.subtitles),d.length>0){o=d[0].bitrate,d.sort(function(ee,se){return ee.bitrate-se.bitrate}),this._levels=d;for(var z=0;z<d.length;z++)if(d[z].bitrate===o){this._firstLevel=z,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+o);break}var Q=k&&!I,j={levels:d,audioTracks:c,subtitleTracks:v,firstLevel:this._firstLevel,stats:a.stats,audio:k,video:I,altAudio:!Q&&c.some(function(ee){return!!ee.url})};this.hls.trigger(f.Events.MANIFEST_PARSED,j),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},s.onError=function(r,a){var o;if(h.prototype.onError.call(this,r,a),!a.fatal){var u=a.context,d=this._levels[this.currentLevelIndex];if(u&&(u.type===C.PlaylistContextType.AUDIO_TRACK&&d.audioGroupIds&&u.groupId===d.audioGroupIds[d.urlId]||u.type===C.PlaylistContextType.SUBTITLE_TRACK&&d.textGroupIds&&u.groupId===d.textGroupIds[d.urlId]))this.redundantFailover(this.currentLevelIndex);else{var c,v=!1,m=!0;switch(a.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var y=a.frag.type===C.PlaylistLevelType.MAIN?a.frag.level:this.currentLevelIndex,I=this._levels[y];I?(I.fragmentError++,I.fragmentError>this.hls.config.fragLoadingMaxRetry&&(c=y)):c=y}break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:u&&(u.deliveryDirectives&&(m=!1),c=u.level),v=!0;break;case _.ErrorDetails.REMUX_ALLOC_ERROR:c=(o=a.level)!=null?o:this.currentLevelIndex,v=!0}c!==void 0&&this.recoverLevel(a,c,v,m)}}},s.recoverLevel=function(r,a,o,u){var d=r.details,c=this._levels[a];if(c.loadError++,o){if(!this.retryLoadingOrFail(r))return void(this.currentLevelIndex=-1);r.levelRetry=!0}if(u){var v=c.url.length;if(v>1&&c.loadError<v)r.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){for(var m=-1,y=this._levels,I=y.length;I--;){var k=(I+this.currentLevelIndex)%y.length;if(k!==this.currentLevelIndex&&y[k].loadError===0){m=k;break}}m>-1&&this.currentLevelIndex!==m&&(this.warn(d+": switch to "+m),r.levelRetry=!0,this.hls.nextAutoLevel=m)}}},s.redundantFailover=function(r){var a=this._levels[r],o=a.url.length;if(o>1){var u=(a.urlId+1)%o;this.warn("Switching to redundant URL-id "+u),this._levels.forEach(function(d){d.urlId=u}),this.level=r}},s.onFragLoaded=function(r,a){var o=a.frag;if(o!==void 0&&o.type===C.PlaylistLevelType.MAIN){var u=this._levels[o.level];u!==void 0&&(u.fragmentError=0,u.loadError=0)}},s.onLevelLoaded=function(r,a){var o,u,d=a.level,c=a.details,v=this._levels[d];if(!v)return this.warn("Invalid level index "+d),void((u=a.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(c.deltaUpdateFailed=!0));d===this.currentLevelIndex?(v.fragmentError===0&&(v.loadError=0,this.retryCount=0),this.playlistLoaded(d,a,v.details)):(o=a.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(c.deltaUpdateFailed=!0)},s.onAudioTrackSwitched=function(r,a){var o=this.hls.levels[this.currentLevelIndex];if(o&&o.audioGroupIds){for(var u=-1,d=this.hls.audioTracks[a.id].groupId,c=0;c<o.audioGroupIds.length;c++)if(o.audioGroupIds[c]===d){u=c;break}u!==o.urlId&&(o.urlId=u,this.startLoad())}},s.loadPlaylist=function(r){var a=this.currentLevelIndex,o=this._levels[a];if(this.canLoad&&o&&o.url.length>0){var u=o.urlId,d=o.url[u];if(r)try{d=r.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Attempt loading level index "+a+(r?" at sn "+r.msn+" part "+r.part:"")+" with URL-id "+u+" "+d),this.clearTimer(),this.hls.trigger(f.Events.LEVEL_LOADING,{url:d,level:a,id:u,deliveryDirectives:r||null})}},s.removeLevel=function(r,a){var o=function(d,c){return c!==a},u=this._levels.filter(function(d,c){return c!==r||d.url.length>1&&a!==void 0&&(d.url=d.url.filter(o),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(o)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(o)),d.urlId=0,!0)}).map(function(d,c){var v=d.details;return v!=null&&v.fragments&&v.fragments.forEach(function(m){m.level=c}),d});this._levels=u,this.hls.trigger(f.Events.LEVELS_UPDATED,{levels:u})},i=t,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var a,o=this._levels;if(o.length!==0&&(this.currentLevelIndex!==r||(a=o[r])===null||a===void 0||!a.details)){if(r<0||r>=o.length){var u=r<0;if(this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.LEVEL_SWITCH_ERROR,level:r,fatal:u,reason:"invalid level idx"}),u)return;r=Math.min(r,o.length-1)}this.clearTimer();var d=this.currentLevelIndex,c=o[d],v=o[r];this.log("switching to level "+r+" from "+d),this.currentLevelIndex=r;var m=St({},v,{level:r,maxBitrate:v.maxBitrate,uri:v.uri,urlId:v.urlId});delete m._urlId,this.hls.trigger(f.Events.LEVEL_SWITCHING,m);var y=v.details;if(!y||y.live){var I=this.switchParams(v.uri,c==null?void 0:c.details);this.loadPlaylist(I)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this._firstLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}])&&O(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Tt);(function(h){h.NOT_LOADED="NOT_LOADED",h.APPENDING="APPENDING",h.PARTIAL="PARTIAL",h.OK="OK"})(g||(g={}));var R=function(){function h(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var l=h.prototype;return l._registerListeners=function(){var e=this.hls;e.on(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(f.Events.FRAG_LOADED,this.onFragLoaded,this)},l._unregisterListeners=function(){var e=this.hls;e.off(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(f.Events.FRAG_LOADED,this.onFragLoaded,this)},l.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},l.getAppendedFrag=function(e,t){if(t===C.PlaylistLevelType.MAIN){var i=this.activeFragment,n=this.activeParts;if(!i)return null;if(n)for(var s=n.length;s--;){var r=n[s],a=r?r.end:i.appendedPTS;if(r.start<=e&&a!==void 0&&e<=a)return s>9&&(this.activeParts=n.slice(s-9)),r}else if(i.start<=e&&i.appendedPTS!==void 0&&e<=i.appendedPTS)return i}return this.getBufferedFrag(e,t)},l.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),s=n.length;s--;){var r=i[n[s]];if((r==null?void 0:r.body.type)===t&&r.buffered){var a=r.body;if(a.start<=e&&e<=a.end)return a}}return null},l.detectEvictedFragments=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r)if(r.buffered){var a=r.range[e];a&&a.time.some(function(o){var u=!n.isTimeBuffered(o.startPTS,o.endPTS,t);return u&&n.removeFragment(r.body),u})}else r.body.type===i&&n.removeFragment(r.body)})},l.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,s=e.part;if(i&&n.sn!=="initSegment"){var r=F(n),a=this.fragments[r];a&&(Object.keys(i).forEach(function(o){var u=n.elementaryStreams[o];if(u){var d=i[o],c=s!==null||u.partial===!0;a.range[o]=t.getBufferedTimes(n,s,c,d)}}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},l.fragBuffered=function(e){var t=F(e),i=this.fragments[t];i&&(i.loaded=null,i.buffered=!0)},l.getBufferedTimes=function(e,t,i,n){for(var s={time:[],partial:i},r=t?t.start:e.start,a=t?t.end:e.end,o=e.minEndPTS||a,u=e.maxStartPTS||r,d=0;d<n.length;d++){var c=n.start(d)-this.bufferPadding,v=n.end(d)+this.bufferPadding;if(u>=c&&o<=v){s.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(a,n.end(d))});break}if(r<v&&a>c)s.partial=!0,s.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(a,n.end(d))});else if(a<=c)break}return s},l.getPartialFragment=function(e){var t,i,n,s=null,r=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(u){var d=o[u];d&&P(d)&&(i=d.body.start-a,n=d.body.end+a,e>=i&&e<=n&&(t=Math.min(e-i,n-e),r<=t&&(s=d.body,r=t)))}),s},l.getState=function(e){var t=F(e),i=this.fragments[t];return i?i.buffered?P(i)?g.PARTIAL:g.OK:g.APPENDING:g.NOT_LOADED},l.isTimeBuffered=function(e,t,i){for(var n,s,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,s=i.end(r)+this.bufferPadding,e>=n&&t<=s)return!0;if(t<=n)return!1}return!1},l.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if(i.sn!=="initSegment"&&!i.bitrateTest&&!n){var s=F(i);this.fragments[s]={body:i,loaded:t,buffered:!1,range:Object.create(null)}}},l.onBufferAppended=function(e,t){var i=this,n=t.frag,s=t.part,r=t.timeRanges;if(n.type===C.PlaylistLevelType.MAIN)if(this.activeFragment=n,s){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(s)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(o){var u=r[o];if(i.detectEvictedFragments(o,u),!s)for(var d=0;d<u.length;d++)n.appendedPTS=Math.max(u.end(d),n.appendedPTS||0)})},l.onFragBuffered=function(e,t){this.detectPartialFragments(t)},l.hasFragment=function(e){var t=F(e);return!!this.fragments[t]},l.removeFragmentsInRange=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r&&r.buffered){var a=r.body;a.type===i&&a.start<t&&a.end>e&&n.removeFragment(a)}})},l.removeFragment=function(e){var t=F(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},l.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},h}();function P(h){var l,e;return h.buffered&&(((l=h.range.video)===null||l===void 0?void 0:l.partial)||((e=h.range.audio)===null||e===void 0?void 0:e.partial))}function F(h){return h.type+"_"+h.level+"_"+h.urlId+"_"+h.sn}var X=function(){function h(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var l=h.prototype;return l.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},l.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},l.onHandlerDestroyed=function(){},l.hasInterval=function(){return!!this._tickInterval},l.hasNextTick=function(){return!!this._tickTimer},l.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},l.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},l.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},l.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},l.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},l.doTick=function(){},h}(),le={length:0,start:function(){return 0},end:function(){return 0}},$=function(){function h(){}return h.isBuffered=function(l,e){try{if(l){for(var t=h.getBuffered(l),i=0;i<t.length;i++)if(e>=t.start(i)&&e<=t.end(i))return!0}}catch(n){}return!1},h.bufferInfo=function(l,e,t){try{if(l){var i,n=h.getBuffered(l),s=[];for(i=0;i<n.length;i++)s.push({start:n.start(i),end:n.end(i)});return this.bufferedInfo(s,e,t)}}catch(r){}return{len:0,start:e,end:e,nextStart:void 0}},h.bufferedInfo=function(l,e,t){e=Math.max(0,e),l.sort(function(y,I){return y.start-I.start||I.end-y.end});var i=[];if(t)for(var n=0;n<l.length;n++){var s=i.length;if(s){var r=i[s-1].end;l[n].start-r<t?l[n].end>r&&(i[s-1].end=l[n].end):i.push(l[n])}else i.push(l[n])}else i=l;for(var a,o=0,u=e,d=e,c=0;c<i.length;c++){var v=i[c].start,m=i[c].end;if(e+t>=v&&e<m)u=v,o=(d=m)-e;else if(e+t<v){a=v;break}}return{len:o,start:u||0,end:d||0,nextStart:a}},h.getBuffered=function(l){try{return l.buffered}catch(e){return S.logger.log("failed to get media.buffered",e),le}},h}(),fe=function(h,l,e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=h,this.sn=l,this.id=e,this.size=t,this.part=i,this.partial=n};function Se(h,l){for(var e=null,t=0,i=h.length;t<i;t++){var n=h[t];if(n&&n.cc===l){e=n;break}}return e}function Ee(h,l){if(h){var e=h.start+l;h.start=h.startPTS=e,h.endPTS=e+h.duration}}function be(h,l){for(var e=l.fragments,t=0,i=e.length;t<i;t++)Ee(e[t],h);l.fragmentHint&&Ee(l.fragmentHint,h),l.alignedSliding=!0}function Pe(h,l){if(h.hasProgramDateTime&&l.hasProgramDateTime){var e=h.fragments,t=l.fragments;if(e.length&&t.length){var i=t[Math.round(t.length/2)-1],n=Se(e,i.cc)||e[Math.round(e.length/2)-1],s=i.programDateTime,r=n.programDateTime;s!==null&&r!==null&&be((r-s)/1e3-(n.start-i.start),h)}}}const je=function(h,l){for(var e=0,t=h.length-1,i=null,n=null;e<=t;){var s=l(n=h[i=(e+t)/2|0]);if(s>0)e=i+1;else{if(!(s<0))return n;t=i-1}}return null};function Le(h,l,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var i=null;return h?i=l[h.sn-l[0].sn+1]||null:e===0&&l[0].start===0&&(i=l[0]),i&&ze(e,t,i)===0?i:je(l,ze.bind(null,e,t))||i}function ze(h,l,e){h===void 0&&(h=0),l===void 0&&(l=0);var t=Math.min(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=h?1:e.start-t>h&&e.start?-1:0}function dt(h,l,e){var t=1e3*Math.min(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>h}function nt(h){var l=typeof Map=="function"?new Map:void 0;return nt=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,i)}function i(){return et(e,arguments,ft(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),xe(i,e)},nt(h)}function et(h,l,e){return et=gt()?Reflect.construct.bind():function(t,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(t,s));return n&&xe(r,n.prototype),r},et.apply(null,arguments)}function gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(h){return!1}}function xe(h,l){return xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xe(h,l)}function ft(h){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},ft(h)}var Ct=Math.pow(2,17),ut=function(){function h(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var l=h.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(e,t){var i=this,n=e.url;if(!n)return Promise.reject(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(o,u){i.loader&&i.loader.destroy();var d=i.loader=e.loader=r?new r(s):new a(s),c=bt(e),v={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:e.sn==="initSegment"?1/0:Ct};e.stats=d.stats,d.load(c,v,{onSuccess:function(m,y,I,k){i.resetLoader(e,d),o({frag:e,part:null,payload:m.data,networkDetails:k})},onError:function(m,y,I){i.resetLoader(e,d),u(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:m,networkDetails:I}))},onAbort:function(m,y,I){i.resetLoader(e,d),u(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:I}))},onTimeout:function(m,y,I){i.resetLoader(e,d),u(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:I}))},onProgress:function(m,y,I,k){t&&t({frag:e,part:null,payload:I,networkDetails:k})}})})},l.loadPart=function(e,t,i){var n=this;this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(o,u){n.loader&&n.loader.destroy();var d=n.loader=e.loader=r?new r(s):new a(s),c=bt(e,t),v={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:Ct};t.stats=d.stats,d.load(c,v,{onSuccess:function(m,y,I,k){n.resetLoader(e,d),n.updateStatsFromPart(e,t);var z={frag:e,part:t,payload:m.data,networkDetails:k};i(z),o(z)},onError:function(m,y,I){n.resetLoader(e,d),u(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:m,networkDetails:I}))},onAbort:function(m,y,I){e.stats.aborted=t.stats.aborted,n.resetLoader(e,d),u(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:I}))},onTimeout:function(m,y,I){n.resetLoader(e,d),u(new pt({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:I}))}})})},l.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,s=n.total;if(i.loaded+=n.loaded,s){var r=Math.round(e.duration/t.duration),a=Math.min(Math.round(i.loaded/s),r),o=(r-a)*Math.round(i.loaded/a);i.total=i.loaded+o}else i.total=Math.max(i.loaded,i.total);var u=i.loading,d=n.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},l.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},h}();function bt(h,l){l===void 0&&(l=null);var e=l||h,t={frag:h,part:l,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return(0,w.isFiniteNumber)(i)&&(0,w.isFiniteNumber)(n)&&(t.rangeStart=i,t.rangeEnd=n),t}var pt=function(h){var l,e;function t(i){for(var n,s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return(n=h.call.apply(h,[this].concat(r))||this).data=void 0,n.data=i,n}return e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,xe(l,e),t}(nt(Error)),Nt=V(21);const It=function(h){for(var l="",e=h.length,t=0;t<e;t++)l+="["+h.start(t).toFixed(3)+","+h.end(t).toFixed(3)+"]";return l};function or(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Xr(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function mr(h,l){return mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mr(h,l)}var wt="STOPPED",qe="IDLE",yr="KEY_LOADING",Ht="FRAG_LOADING",jt="FRAG_LOADING_WAITING_RETRY",lr="WAITING_TRACK",Ot="PARSING",$t="PARSED",ur="ENDED",Ut="ERROR",Jt="WAITING_INIT_PTS",Vt="WAITING_LEVEL",Er=function(h){var l,e;function t(r,a,o){var u;return(u=h.call(this)||this).hls=void 0,u.fragPrevious=null,u.fragCurrent=null,u.fragmentTracker=void 0,u.transmuxer=null,u._state=wt,u.media=null,u.mediaBuffer=null,u.config=void 0,u.bitrateTest=!1,u.lastCurrentTime=0,u.nextLoadPosition=0,u.startPosition=0,u.loadedmetadata=!1,u.fragLoadError=0,u.retryDate=0,u.levels=null,u.fragmentLoader=void 0,u.levelLastLoaded=null,u.startFragRequested=!1,u.decrypter=void 0,u.initPTS=[],u.onvseeking=null,u.onvended=null,u.logPrefix="",u.log=void 0,u.warn=void 0,u.logPrefix=o,u.log=S.logger.log.bind(S.logger,o+":"),u.warn=S.logger.warn.bind(S.logger,o+":"),u.hls=r,u.fragmentLoader=new ut(r.config),u.fragmentTracker=a,u.config=r.config,u.decrypter=new Nt.default(r,r.config),r.on(f.Events.KEY_LOADED,u.onKeyLoaded,Xr(u)),r.on(f.Events.LEVEL_SWITCHING,u.onLevelSwitching,Xr(u)),u}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,mr(l,e);var i,n,s=t.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(r){},s.stopLoad=function(){this.fragmentLoader.abort();var r=this.fragCurrent;r&&this.fragmentTracker.removeFragment(r),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=wt},s._streamEnded=function(r,a){var o=this.fragCurrent,u=this.fragmentTracker;if(!a.live&&o&&this.media&&o.sn>=a.endSN&&!r.nextStart){var d=a.partList;if(d!=null&&d.length){var c=d[d.length-1];return $.isBuffered(this.media,c.start+c.duration/2)}var v=u.getState(o);return v===g.PARTIAL||v===g.OK}return!1},s.onMediaAttached=function(r,a){var o=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),o.addEventListener("seeking",this.onvseeking),o.addEventListener("ended",this.onvended);var u=this.config;this.levels&&u.autoStartLoad&&this.state===wt&&this.startLoad(u.startPosition)},s.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var r=this.config,a=this.fragCurrent,o=this.media,u=this.mediaBuffer,d=this.state,c=o?o.currentTime:0,v=$.bufferInfo(u||o,c,r.maxBufferHole);if(this.log("media seeking to "+((0,w.isFiniteNumber)(c)?c.toFixed(3):c)+", state: "+d),d===ur)this.resetLoadingState();else if(a){var m=r.maxFragLookUpTolerance,y=a.start-m,I=a.start+a.duration+m;if(!v.len||I<v.start||y>v.end){var k=c>I;(c<y||k)&&(k&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.resetLoadingState())}}o&&(this.lastCurrentTime=c),this.loadedmetadata||v.len||(this.nextLoadPosition=this.startPosition=c),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onKeyLoaded=function(r,a){if(this.state===yr&&a.frag===this.fragCurrent&&this.levels){this.state=qe;var o=this.levels[a.frag.level].details;o&&this.loadFragment(a.frag,o,a.frag.start)}},s.onLevelSwitching=function(r,a){this.fragLoadError=0},s.onHandlerDestroying=function(){this.stopLoad(),h.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=wt,this.hls.off(f.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,h.prototype.onHandlerDestroyed.call(this)},s.loadKey=function(r,a){this.log("Loading key for "+r.sn+" of ["+a.startSN+"-"+a.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=yr,this.fragCurrent=r,this.hls.trigger(f.Events.KEY_LOADING,{frag:r})},s.loadFragment=function(r,a,o){this._loadFragForPlayback(r,a,o)},s._loadFragForPlayback=function(r,a,o){var u=this;this._doFragLoad(r,a,o,function(d){if(u.fragContextChanged(r))return u.warn("Fragment "+r.sn+(d.part?" p: "+d.part.index:"")+" of level "+r.level+" was dropped during download."),void u.fragmentTracker.removeFragment(r);r.stats.chunkCount++,u._handleFragmentLoadProgress(d)}).then(function(d){if(d){u.fragLoadError=0;var c=u.state;u.fragContextChanged(r)?(c===Ht||!u.fragCurrent&&c===Ot)&&(u.fragmentTracker.removeFragment(r),u.state=qe):("payload"in d&&(u.log("Loaded fragment "+r.sn+" of level "+r.level),u.hls.trigger(f.Events.FRAG_LOADED,d)),u._handleFragmentLoadComplete(d))}}).catch(function(d){u.state!==wt&&u.state!==Ut&&(u.warn(d),u.resetFragmentLoading(r))})},s.flushMainBuffer=function(r,a,o){if(o===void 0&&(o=null),r-a){var u={startOffset:r,endOffset:a,type:o};this.fragLoadError=0,this.hls.trigger(f.Events.BUFFER_FLUSHING,u)}},s._loadInitSegment=function(r){var a=this;this._doFragLoad(r).then(function(o){if(!o||a.fragContextChanged(r)||!a.levels)throw new Error("init load aborted");return o}).then(function(o){var u=a.hls,d=o.payload,c=r.decryptdata;if(d&&d.byteLength>0&&c&&c.key&&c.iv&&c.method==="AES-128"){var v=self.performance.now();return a.decrypter.webCryptoDecrypt(new Uint8Array(d),c.key.buffer,c.iv.buffer).then(function(m){var y=self.performance.now();return u.trigger(f.Events.FRAG_DECRYPTED,{frag:r,payload:m,stats:{tstart:v,tdecrypt:y}}),o.payload=m,o})}return o}).then(function(o){var u=a.fragCurrent,d=a.hls,c=a.levels;if(!c)throw new Error("init load aborted, missing levels");c[r.level].details;var v=r.stats;a.state=qe,a.fragLoadError=0,r.data=new Uint8Array(o.payload),v.parsing.start=v.buffering.start=self.performance.now(),v.parsing.end=v.buffering.end=self.performance.now(),o.frag===u&&d.trigger(f.Events.FRAG_BUFFERED,{stats:v,frag:u,part:null,id:r.type}),a.tick()}).catch(function(o){a.state!==wt&&a.state!==Ut&&(a.warn(o),a.resetFragmentLoading(r))})},s.fragContextChanged=function(r){var a=this.fragCurrent;return!r||!a||r.level!==a.level||r.sn!==a.sn||r.urlId!==a.urlId},s.fragBufferedComplete=function(r,a){var o,u,d=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+r.type+" sn: "+r.sn+(a?" part: "+a.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level+" "+(d?It($.getBuffered(d)):"(detached)")),this.state=qe,d&&(!this.loadedmetadata&&r.type==C.PlaylistLevelType.MAIN&&d.buffered.length&&((o=this.fragCurrent)===null||o===void 0?void 0:o.sn)===((u=this.fragPrevious)===null||u===void 0?void 0:u.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},s.seekToStartPos=function(){},s._handleFragmentLoadComplete=function(r){var a=this.transmuxer;if(a){var o=r.frag,u=r.part,d=r.partsLoaded,c=!d||d.length===0||d.some(function(m){return!m}),v=new fe(o.level,o.sn,o.stats.chunkCount+1,0,u?u.index:-1,!c);a.flush(v)}},s._handleFragmentLoadProgress=function(r){},s._doFragLoad=function(r,a,o,u){var d=this;if(o===void 0&&(o=null),!this.levels)throw new Error("frag load aborted, missing levels");if(o=Math.max(r.start,o||0),this.config.lowLatencyMode&&a){var c=a.partList;if(c&&u){o>r.end&&a.fragmentHint&&(r=a.fragmentHint);var v=this.getNextPart(c,r,o);if(v>-1){var m=c[v];return this.log("Loading part sn: "+r.sn+" p: "+m.index+" cc: "+r.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+v+"-"+(c.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(o.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=Ht,this.hls.trigger(f.Events.FRAG_LOADING,{frag:r,part:c[v],targetBufferTime:o}),this.doFragPartsLoad(r,c,v,u).catch(function(y){return d.handleFragLoadError(y)})}if(!r.url||this.loadedEndOfParts(c,o))return Promise.resolve(null)}}return this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(o.toFixed(3))),(0,w.isFiniteNumber)(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=Ht,this.hls.trigger(f.Events.FRAG_LOADING,{frag:r,targetBufferTime:o}),this.fragmentLoader.load(r,u).catch(function(y){return d.handleFragLoadError(y)})},s.doFragPartsLoad=function(r,a,o,u){var d=this;return new Promise(function(c,v){var m=[];(function y(I){var k=a[I];d.fragmentLoader.loadPart(r,k,u).then(function(z){m[k.index]=z;var Q=z.part;d.hls.trigger(f.Events.FRAG_LOADED,z);var j=a[I+1];if(!j||j.fragment!==r)return c({frag:r,part:Q,partsLoaded:m});y(I+1)}).catch(v)})(o)})},s.handleFragLoadError=function(r){var a=r.data;return a&&a.details===_.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(f.Events.ERROR,a),null},s._handleTransmuxerFlush=function(r){var a=this.getCurrentContext(r);if(a&&this.state===Ot){var o=a.frag,u=a.part,d=a.level,c=self.performance.now();o.stats.parsing.end=c,u&&(u.stats.parsing.end=c),this.updateLevelTiming(o,u,d,r.partial)}else this.fragCurrent||(this.state=qe)},s.getCurrentContext=function(r){var a=this.levels,o=r.level,u=r.sn,d=r.part;if(!a||!a[o])return this.warn("Levels object was unset while buffering fragment "+u+" of level "+o+". The current chunk will not be buffered."),null;var c=a[o],v=d>-1?function(y,I,k){if(!y||!y.details)return null;var z=y.details.partList;if(z)for(var Q=z.length;Q--;){var j=z[Q];if(j.index===k&&j.fragment.sn===I)return j}return null}(c,u,d):null,m=v?v.fragment:function(y,I,k){if(!y||!y.details)return null;var z=y.details,Q=z.fragments[I-z.startSN];return Q||((Q=z.fragmentHint)&&Q.sn===I?Q:I<z.startSN&&k&&k.sn===I?k:null)}(c,u,this.fragCurrent);return m?{frag:m,part:v,level:c}:null},s.bufferFragmentData=function(r,a,o,u){if(r&&this.state===Ot){var d=r.data1,c=r.data2,v=d;if(d&&c&&(v=(0,U.appendUint8Array)(d,c)),v&&v.length){var m={type:r.type,frag:a,part:o,chunkMeta:u,parent:a.type,data:v};this.hls.trigger(f.Events.BUFFER_APPENDING,m),r.dropped&&r.independent&&!o&&this.flushBufferGap(a)}}},s.flushBufferGap=function(r){var a=this.media;if(a)if($.isBuffered(a,a.currentTime)){var o=a.currentTime,u=$.bufferInfo(a,o,0),d=r.duration,c=Math.min(2*this.config.maxFragLookUpTolerance,.25*d),v=Math.max(Math.min(r.start-c,u.end-c),o+c);r.start-v>c&&this.flushMainBuffer(v,r.start)}else this.flushMainBuffer(0,r.start)},s.getFwdBufferInfo=function(r,a){var o=this.config,u=this.getLoadPosition();if(!(0,w.isFiniteNumber)(u))return null;var d=$.bufferInfo(r,u,o.maxBufferHole);if(d.len===0&&d.nextStart!==void 0){var c=this.fragmentTracker.getBufferedFrag(u,a);if(c&&d.nextStart<c.end)return $.bufferInfo(r,u,Math.max(d.nextStart,o.maxBufferHole))}return d},s.getMaxBufferLength=function(r){var a,o=this.config;return a=r?Math.max(8*o.maxBufferSize/r,o.maxBufferLength):o.maxBufferLength,Math.min(a,o.maxMaxBufferLength)},s.reduceMaxBufferLength=function(r){var a=this.config,o=r||a.maxBufferLength;return a.maxMaxBufferLength>=o&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},s.getNextFragment=function(r,a){var o=a.fragments,u=o.length;if(!u)return null;var d,c=this.config,v=o[0].start;if(a.live){var m=c.initialLiveManifestSize;if(u<m)return this.warn("Not enough fragments to start playback (have: "+u+", need: "+m+")"),null;a.PTSKnown||this.startFragRequested||this.startPosition!==-1||(d=this.getInitialLiveFragment(a,o),this.startPosition=d?this.hls.liveSyncPosition||d.start:r)}else r<=v&&(d=o[0]);if(!d){var y=c.lowLatencyMode?a.partEnd:a.fragmentEnd;d=this.getFragmentAtPosition(r,y,a)}return this.mapToInitFragWhenRequired(d)},s.mapToInitFragWhenRequired=function(r){return r==null||!r.initSegment||r!=null&&r.initSegment.data||this.bitrateTest?r:r.initSegment},s.getNextPart=function(r,a,o){for(var u=-1,d=!1,c=!0,v=0,m=r.length;v<m;v++){var y=r[v];if(c=c&&!y.independent,u>-1&&o<y.start)break;var I=y.loaded;!I&&(d||y.independent||c)&&y.fragment===a&&(u=v),d=I}return u},s.loadedEndOfParts=function(r,a){var o=r[r.length-1];return o&&a>o.start&&o.loaded},s.getInitialLiveFragment=function(r,a){var o=this.fragPrevious,u=null;if(o){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+o.programDateTime),u=function(m,y,I){if(y===null||!Array.isArray(m)||!m.length||!(0,w.isFiniteNumber)(y)||y<(m[0].programDateTime||0)||y>=(m[m.length-1].endProgramDateTime||0))return null;I=I||0;for(var k=0;k<m.length;++k){var z=m[k];if(dt(y,I,z))return z}return null}(a,o.endProgramDateTime,this.config.maxFragLookUpTolerance)),!u){var d=o.sn+1;if(d>=r.startSN&&d<=r.endSN){var c=a[d-r.startSN];o.cc===c.cc&&(u=c,this.log("Live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=function(m,y){return je(m,function(I){return I.cc<y?1:I.cc>y?-1:0})}(a,o.cc),u&&this.log("Live playlist, switching playlist, load frag with same CC: "+u.sn))}}else{var v=this.hls.liveSyncPosition;v!==null&&(u=this.getFragmentAtPosition(v,this.bitrateTest?r.fragmentEnd:r.edge,r))}return u},s.getFragmentAtPosition=function(r,a,o){var u,d=this.config,c=this.fragPrevious,v=o.fragments,m=o.endSN,y=o.fragmentHint,I=d.maxFragLookUpTolerance,k=!!(d.lowLatencyMode&&o.partList&&y);if(k&&y&&!this.bitrateTest&&(v=v.concat(y),m=y.sn),u=r<a?Le(c,v,r,r>a-I?0:I):v[v.length-1]){var z=u.sn-o.startSN;if(this.fragmentTracker.getState(u)===g.OK&&(c=u),c&&u.sn===c.sn&&!k&&c&&u.level===c.level){var Q=v[z+1];u.sn<m&&this.fragmentTracker.getState(Q)!==g.OK?(this.log("SN "+u.sn+" just loaded, load next one: "+Q.sn),u=Q):u=null}}return u},s.synchronizeToLiveEdge=function(r){var a=this.config,o=this.media;if(o){var u=this.hls.liveSyncPosition,d=o.currentTime,c=r.fragments[0].start,v=r.edge,m=d>=c-a.maxFragLookUpTolerance&&d<=v;if(u!==null&&o.duration>u&&(d<u||!m)){var y=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*r.targetduration;(!m&&o.readyState<4||d<v-y)&&(this.loadedmetadata||(this.nextLoadPosition=u),o.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+v+", reset currentTime to : "+u.toFixed(3)),o.currentTime=u))}}},s.alignPlaylists=function(r,a){var o=this.levels,u=this.levelLastLoaded,d=this.fragPrevious,c=u!==null?o[u]:null,v=r.fragments.length;if(!v)return this.warn("No fragments in live playlist"),0;var m=r.fragments[0].start,y=!a,I=r.alignedSliding&&(0,w.isFiniteNumber)(m);if(y||!I&&!m){(function(z,Q,j){Q&&(function(ee,se,W){if(function(ue,Ae,Ie){return!(!Ae.details||!(Ie.endCC>Ie.startCC||ue&&ue.cc<Ie.startCC))}(ee,W,se)){var ce=function(ue,Ae,Ie){Ie===void 0&&(Ie=0);var Ge=ue.fragments,Xe=Ae.fragments;if(Xe.length&&Ge.length){var Ue=Se(Ge,Xe[0].cc);if(Ue&&(!Ue||Ue.startPTS))return Ue;S.logger.log("No frag in previous level to align on")}else S.logger.log("No fragments to align")}(W.details,se);ce&&(0,w.isFiniteNumber)(ce.start)&&(S.logger.log("Adjusting PTS using last level due to CC increase within current level "+se.url),be(ce.start,se))}}(z,j,Q),!j.alignedSliding&&Q.details&&function(ee,se){if(se.fragments.length&&ee.hasProgramDateTime&&se.hasProgramDateTime){var W=se.fragments[0].programDateTime,ce=ee.fragments[0].programDateTime,ue=(ce-W)/1e3+se.fragments[0].start;ue&&(0,w.isFiniteNumber)(ue)&&(S.logger.log("Adjusting PTS using programDateTime delta "+(ce-W)+"ms, sliding:"+ue.toFixed(3)+" "+ee.url+" "),be(ue,ee))}}(j,Q.details),j.alignedSliding||!Q.details||j.skippedSegments||ct(Q.details,j))})(d,c,r);var k=r.fragments[0].start;return this.log("Live playlist sliding: "+k.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+r.startSN+" prev-sn: "+(d?d.sn:"na")+" fragments: "+v),k}return m},s.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,3*r.partTarget)},s.setStartPosition=function(r,a){var o=this.startPosition;if(o<a&&(o=-1),o===-1||this.lastCurrentTime===-1){var u=r.startTimeOffset;(0,w.isFiniteNumber)(u)?(o=a+u,u<0&&(o+=r.totalduration),o=Math.min(Math.max(a,o),a+r.totalduration),this.log("Start time offset "+u+" found in playlist, adjust startPosition to "+o),this.startPosition=o):r.live?o=this.hls.liveSyncPosition||a:this.startPosition=o=0,this.lastCurrentTime=o}this.nextLoadPosition=o},s.getLoadPosition=function(){var r=this.media,a=0;return this.loadedmetadata&&r?a=r.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},s.handleFragLoadAborted=function(r,a){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(a?" part"+a.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},s.resetFragmentLoading=function(r){this.fragCurrent&&(this.fragContextChanged(r)||this.state===jt)||(this.state=qe)},s.onFragmentOrKeyLoadError=function(r,a){if(!a.fatal){var o=a.frag;if(o&&o.type===r){this.fragCurrent;var u=this.config;if(this.fragLoadError+1<=u.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var d=Math.min(Math.pow(2,this.fragLoadError)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout);this.warn("Fragment "+o.sn+" of "+r+" "+o.level+" failed to load, retrying in "+d+"ms"),this.retryDate=self.performance.now()+d,this.fragLoadError++,this.state=jt}else a.levelRetry?(r===C.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=qe):(S.logger.error(a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.stopLoad(),this.state=Ut)}}},s.afterBufferFlushed=function(r,a,o){if(r){var u=$.getBuffered(r);this.fragmentTracker.detectEvictedFragments(a,u,o),this.state===ur&&this.resetLoadingState()}},s.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=qe},s.resetStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[r].details:null;a!=null&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},s.updateLevelTiming=function(r,a,o,u){var d=this,c=o.details;Object.keys(r.elementaryStreams).reduce(function(v,m){var y=r.elementaryStreams[m];if(y){var I=y.endPTS-y.startPTS;if(I<=0)return d.warn("Could not parse fragment "+r.sn+" "+m+" duration reliably ("+I+")"),v||!1;var k=u?0:yt(c,r,y.startPTS,y.endPTS,y.startDTS,y.endDTS);return d.hls.trigger(f.Events.LEVEL_PTS_UPDATED,{details:c,level:o,drift:k,type:m,frag:r,start:y.startPTS,end:y.endPTS}),!0}return v},!1)||(this.warn("Found no media in fragment "+r.sn+" of level "+o.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=$t,this.hls.trigger(f.Events.FRAG_PARSED,{frag:r,part:a})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=t,(n=[{key:"state",get:function(){return this._state},set:function(r){var a=this._state;a!==r&&(this._state=r,this.log(a+"->"+r))}}])&&or(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(X);function Tr(){return self.MediaSource||self.WebKitMediaSource}function Qr(){return self.SourceBuffer||self.WebKitSourceBuffer}var Sr=function(){var h=ENTRY_MODULE,l={},e=function i(n){var s=l[n];if(s!==void 0)return s.exports;var r=l[n]={exports:{}};return h[n].call(r.exports,r,r.exports,i),r.exports};e.m=h,e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,{a:n}),n},e.d=function(i,n){for(var s in n)e.o(n,s)&&!e.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:n[s]})},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var t=e(ENTRY_MODULE);return t.default||t}.toString().split("ENTRY_MODULE"),$r="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function Jr(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function xi(h,l,e){var t={};t[e]=[];var i=l.toString().replace(/^"[^"]+"/,"function"),n=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return t;for(var s,r=n[1],a=new RegExp("(\\\\n|\\W)"+Jr(r)+$r,"g");s=a.exec(i);)s[3]!=="dll-reference"&&t[e].push(s[3]);for(a=new RegExp("\\("+Jr(r)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+$r,"g");s=a.exec(i);)h[s[2]]||(t[e].push(s[1]),h[s[2]]=V(s[1]).m),t[s[2]]=t[s[2]]||[],t[s[2]].push(s[4]);for(var o,u=Object.keys(t),d=0;d<u.length;d++)for(var c=0;c<t[u[d]].length;c++)o=t[u[d]][c],isNaN(1*o)||(t[u[d]][c]=1*t[u[d]][c]);return t}function Fi(h){return Object.keys(h).reduce(function(l,e){return l||h[e].length>0},!1)}function Zr(h,l,e,t){var i=h[t].map(function(n){return'"'+n+'": '+l[t][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return Sr[0]+"{"+i+"}"+Sr[1]+'"'+e+'"'+Sr[2]}var Wt=V(544),ei=V(729),br=Tr()||{isTypeSupported:function(){return!1}},ti=function(){function h(e,t,i,n){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var a=function(c,v){(v=v||{}).frag=s.frag,v.id=s.id,s.hls.trigger(c,v)};this.observer=new ei.EventEmitter,this.observer.on(f.Events.FRAG_DECRYPTED,a),this.observer.on(f.Events.ERROR,a);var o={mp4:br.isTypeSupported("video/mp4"),mpeg:br.isTypeSupported("audio/mpeg"),mp3:br.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){var d;S.logger.log("demuxing in webworker");try{d=this.worker=function(c,v){v=v||{};var m={main:V.m},y=v.all?{main:Object.keys(m.main)}:function(j,ee){for(var se={main:[ee]},W={main:[]},ce={main:{}};Fi(se);)for(var ue=Object.keys(se),Ae=0;Ae<ue.length;Ae++){var Ie=ue[Ae],Ge=se[Ie].pop();if(ce[Ie]=ce[Ie]||{},!ce[Ie][Ge]&&j[Ie][Ge]){ce[Ie][Ge]=!0,W[Ie]=W[Ie]||[],W[Ie].push(Ge);for(var Xe=xi(j,j[Ie][Ge],Ie),Ue=Object.keys(Xe),Ke=0;Ke<Ue.length;Ke++)se[Ue[Ke]]=se[Ue[Ke]]||[],se[Ue[Ke]]=se[Ue[Ke]].concat(Xe[Ue[Ke]])}}return W}(m,c),I="";Object.keys(y).filter(function(j){return j!=="main"}).forEach(function(j){for(var ee=0;y[j][ee];)ee++;y[j].push(ee),m[j][ee]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",I=I+"var "+j+" = ("+Zr(y,m,ee,modules)+`)();
`}),I=I+"new (("+Zr(y,m,c,"main")+")())(self);";var k=new window.Blob([I],{type:"text/javascript"}),z=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(k),Q=new window.Worker(z);return Q.objectURL=z,Q}(182),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(c){s.useWorker=!1,S.logger.warn("Exception in webworker, fallback to inline"),s.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},d.postMessage({cmd:"init",typeSupported:o,vendor:u,id:t,config:JSON.stringify(r)})}catch(c){S.logger.warn("Error in worker:",c),S.logger.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new Wt.default(this.observer,o,r,u,t),this.worker=null}}else this.transmuxer=new Wt.default(this.observer,o,r,u,t)}var l=h.prototype;return l.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},l.push=function(e,t,i,n,s,r,a,o,u,d){var c,v,m=this;u.transmuxing.start=self.performance.now();var y=this.transmuxer,I=this.worker,k=r?r.start:s.start,z=s.decryptdata,Q=this.frag,j=!(Q&&s.cc===Q.cc),ee=!(Q&&u.level===Q.level),se=Q?u.sn-Q.sn:-1,W=this.part?u.part-this.part.index:-1,ce=se===0&&u.id>1&&u.id===(Q==null?void 0:Q.stats.chunkCount),ue=!ee&&(se===1||se===0&&(W===1||ce&&W<=0)),Ae=self.performance.now();(ee||se||s.stats.parsing.start===0)&&(s.stats.parsing.start=Ae),!r||!W&&ue||(r.stats.parsing.start=Ae);var Ie=!(Q&&((c=s.initSegment)===null||c===void 0?void 0:c.url)===((v=Q.initSegment)===null||v===void 0?void 0:v.url)),Ge=new Wt.TransmuxState(j,ue,o,ee,k,Ie);if(!ue||j||Ie){S.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+j+`
        trackSwitch: `+ee+`
        contiguous: `+ue+`
        accurateTimeOffset: `+o+`
        timeOffset: `+k+`
        initSegmentChange: `+Ie);var Xe=new Wt.TransmuxConfig(i,n,t,a,d);this.configureTransmuxer(Xe)}if(this.frag=s,this.part=r,I)I.postMessage({cmd:"demux",data:e,decryptdata:z,chunkMeta:u,state:Ge},e instanceof ArrayBuffer?[e]:[]);else if(y){var Ue=y.push(e,z,u,Ge);(0,Wt.isPromise)(Ue)?Ue.then(function(Ke){m.handleTransmuxComplete(Ke)}):this.handleTransmuxComplete(Ue)}},l.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(i){var s=i.flush(e);(0,Wt.isPromise)(s)?s.then(function(r){t.handleFlushResult(r,e)}):this.handleFlushResult(s,e)}},l.handleFlushResult=function(e,t){var i=this;e.forEach(function(n){i.handleTransmuxComplete(n)}),this.onFlush(t)},l.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":S.logger[t.data.logType]&&S.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},l.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},l.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},h}(),Mi=function(){function h(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var l=h.prototype;return l.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},l.poll=function(e,t){var i=this.config,n=this.media,s=this.stalled;if(n!==null){var r=n.currentTime,a=n.seeking,o=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,r===e){if((u||o)&&(this.stalled=null),!(n.paused&&!a||n.ended||n.playbackRate===0)&&$.getBuffered(n).length){var d=$.bufferInfo(n,r,0),c=d.len>0,v=d.nextStart||0;if(c||v){if(a){var m=d.len>2,y=!v||t&&t.start<=r||v-r>2&&!this.fragmentTracker.getPartialFragment(r);if(m||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var I,k=Math.max(v,d.start||0)-r,z=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Q=!(z==null||(I=z.details)===null||I===void 0)&&I.live?2*z.details.targetduration:2;if(k>0&&k<=Q)return void this._trySkipBufferHole(null)}var j=self.performance.now();if(s!==null){var ee=j-s;if(a||!(ee>=250)||(this._reportStall(d),this.media)){var se=$.bufferInfo(n,r,i.maxBufferHole);this._tryFixBufferStall(se,ee)}}else this.stalled=j}}}else if(this.moved=!0,s!==null){if(this.stallReported){var W=self.performance.now()-s;S.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(W)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},l._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,s=this.media;if(s!==null){var r=s.currentTime,a=n.getPartialFragment(r);if(a&&(this._trySkipBufferHole(a)||!this.media))return;e.len>i.maxBufferHole&&t>1e3*i.highBufferWatchdogPeriod&&(S.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},l._reportStall=function(e){var t=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,S.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},l._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(n===null)return 0;for(var s=n.currentTime,r=0,a=$.getBuffered(n),o=0;o<a.length;o++){var u=a.start(o);if(s+t.maxBufferHole>=r&&s<u){var d=Math.max(u+.05,n.currentTime+.1);return S.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+d),this.moved=!0,this.stalled=null,n.currentTime=d,e&&i.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+d,frag:e}),d}r=a.end(o)}return 0},l._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(i!==null){var s=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var r=s+(n+1)*e.nudgeOffset;S.logger.warn("Nudging 'currentTime' from "+s+" to "+r),i.currentTime=r,t.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else S.logger.error("Playhead still not moving while enough data buffered @"+s+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},h}();function Ni(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Lr(h,l){return Lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lr(h,l)}var Ui=function(h){var l,e;function t(r,a){var o;return(o=h.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,o.gapController=null,o.level=-1,o._forceStartLoad=!1,o.altAudio=!1,o.audioOnly=!1,o.fragPlaying=null,o.onvplaying=null,o.onvseeked=null,o.fragLastKbps=0,o.couldBacktrack=!1,o.backtrackFragment=null,o.audioCodecSwitch=!1,o.videoBuffer=null,o._registerListeners(),o}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Lr(l,e);var i,n,s=t.prototype;return s._registerListeners=function(){var r=this.hls;r.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(f.Events.ERROR,this.onError,this),r.on(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(f.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(f.Events.ERROR,this.onError,this),r.off(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(f.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},s.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=o.startLevel;u===-1&&(o.config.testBandwidth&&this.levels.length>1?(u=0,this.bitrateTest=!0):u=o.nextAutoLevel),this.level=o.nextLoadLevel=u,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=qe,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=wt},s.stopLoad=function(){this._forceStartLoad=!1,h.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case qe:this.doTickIdle();break;case Vt:var r,a=this.levels,o=this.level,u=a==null||(r=a[o])===null||r===void 0?void 0:r.details;if(u&&(!u.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(u))break;this.state=qe;break}break;case jt:var d,c=self.performance.now(),v=this.retryDate;(!v||c>=v||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=qe)}this.onTickEnd()},s.onTickEnd=function(){h.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},s.doTickIdle=function(){var r,a,o=this.hls,u=this.levelLastLoaded,d=this.levels,c=this.media,v=o.config,m=o.nextLoadLevel;if(u!==null&&(c||!this.startFragRequested&&v.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&d&&d[m]){var y=d[m];this.level=o.nextLoadLevel=m;var I=y.details;if(!I||this.state===Vt||I.live&&this.levelLastLoaded!==m)this.state=Vt;else{var k=this.getMainFwdBufferInfo();if(k!==null&&!(k.len>=this.getMaxBufferLength(y.maxBitrate))){if(this._streamEnded(k,I)){var z={};return this.altAudio&&(z.type="video"),this.hls.trigger(f.Events.BUFFER_EOS,z),void(this.state=ur)}this.backtrackFragment&&this.backtrackFragment.start>k.end&&(this.backtrackFragment=null);var Q=this.backtrackFragment?this.backtrackFragment.start:k.end,j=this.getNextFragment(Q,I);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"&&this.fragmentTracker.getState(j)!==g.OK){var ee,se=((ee=this.backtrackFragment)!=null?ee:j).sn-I.startSN,W=I.fragments[se-1];W&&j.cc===W.cc&&(j=W,this.fragmentTracker.removeFragment(W))}else this.backtrackFragment&&k.len&&(this.backtrackFragment=null);if(j&&this.fragmentTracker.getState(j)===g.OK&&this.nextLoadPosition>Q){var ce=this.audioOnly&&!this.altAudio?re.ElementaryStreamTypes.AUDIO:re.ElementaryStreamTypes.VIDEO;c&&this.afterBufferFlushed(c,ce,C.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,I)}j&&(!j.initSegment||j.initSegment.data||this.bitrateTest||(j=j.initSegment),((r=j.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=j.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(j,I,Q):this.loadKey(j,I))}}}},s.loadFragment=function(r,a,o){var u,d=this.fragmentTracker.getState(r);this.fragCurrent=r,d===g.NOT_LOADED?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,a,o)):d===g.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((u=this.media)===null||u===void 0?void 0:u.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},s.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,C.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},s.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,C.PlaylistLevelType.MAIN)},s.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},s.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var o,u=this.getAppendedFrag(a.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!a.paused&&r){var d=r[this.hls.nextLoadLevel],c=this.fragLastKbps;o=c&&this.fragCurrent?this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:0}else o=0;var v=this.getBufferedFrag(a.currentTime+o);if(v){var m=this.followingBufferedFrag(v);if(m){this.abortCurrentFrag();var y=m.maxStartPTS?m.maxStartPTS:m.start,I=m.duration,k=Math.max(v.end,y+Math.min(Math.max(I-this.config.maxFragLookUpTolerance,.5*I),.75*I));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},s.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r!=null&&r.loader&&r.loader.abort(),this.state){case yr:case Ht:case jt:case Ot:case $t:this.state=qe}this.nextLoadPosition=this.getLoadPosition()},s.flushMainBuffer=function(r,a){h.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},s.onMediaAttached=function(r,a){h.prototype.onMediaAttached.call(this,r,a);var o=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),o.addEventListener("playing",this.onvplaying),o.addEventListener("seeked",this.onvseeked),this.gapController=new Mi(this.config,o,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var r=this.media;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),h.prototype.onMediaDetaching.call(this)},s.onMediaPlaying=function(){this.tick()},s.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;(0,w.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},s.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(f.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},s.onManifestParsed=function(r,a){var o,u,d,c=!1,v=!1;a.levels.forEach(function(m){(o=m.audioCodec)&&(o.indexOf("mp4a.40.2")!==-1&&(c=!0),o.indexOf("mp4a.40.5")!==-1&&(v=!0))}),this.audioCodecSwitch=c&&v&&typeof((d=Qr())==null||(u=d.prototype)===null||u===void 0?void 0:u.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},s.onLevelLoading=function(r,a){var o=this.levels;if(o&&this.state===qe){var u=o[a.level];(!u.details||u.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(u.details))&&(this.state=Vt)}},s.onLevelLoaded=function(r,a){var o,u=this.levels,d=a.level,c=a.details,v=c.totalduration;if(u){this.log("Level "+d+" loaded ["+c.startSN+","+c.endSN+"], cc ["+c.startCC+", "+c.endCC+"] duration:"+v);var m=this.fragCurrent;!m||this.state!==Ht&&this.state!==jt||m.level!==a.level&&m.loader&&(this.state=qe,this.backtrackFragment=null,m.loader.abort());var y=u[d],I=0;if(c.live||(o=y.details)!==null&&o!==void 0&&o.live){if(c.fragments[0]||(c.deltaUpdateFailed=!0),c.deltaUpdateFailed)return;I=this.alignPlaylists(c,y.details)}if(y.details=c,this.levelLastLoaded=d,this.hls.trigger(f.Events.LEVEL_UPDATED,{details:c,level:d}),this.state===Vt){if(this.waitForCdnTuneIn(c))return;this.state=qe}this.startFragRequested?c.live&&this.synchronizeToLiveEdge(c):this.setStartPosition(c,I),this.tick()}else this.warn("Levels were reset while loading level "+d)},s._handleFragmentLoadProgress=function(r){var a,o=r.frag,u=r.part,d=r.payload,c=this.levels;if(c){var v=c[o.level],m=v.details;if(m){var y=v.videoCodec,I=m.PTSKnown||!m.live,k=(a=o.initSegment)===null||a===void 0?void 0:a.data,z=this._getAudioCodec(v),Q=this.transmuxer=this.transmuxer||new ti(this.hls,C.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),j=u?u.index:-1,ee=j!==-1,se=new fe(o.level,o.sn,o.stats.chunkCount,d.byteLength,j,ee),W=this.initPTS[o.cc];Q.push(d,k,z,y,o,u,m.totalduration,I,se,W)}else this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered")},s.onAudioTrackSwitching=function(r,a){var o=this.altAudio,u=!!a.url,d=a.id;if(!u){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var c=this.fragCurrent;c!=null&&c.loader&&(this.log("Switching to main audio track, cancel main fragment load"),c.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var v=this.hls;o&&v.trigger(f.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),v.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:d})}},s.onAudioTrackSwitched=function(r,a){var o=a.id,u=!!this.hls.audioTracks[o].url;if(u){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=u,this.tick()},s.onBufferCreated=function(r,a){var o,u,d=a.tracks,c=!1;for(var v in d){var m=d[v];if(m.id==="main"){if(u=v,o=m,v==="video"){var y=d[v];y&&(this.videoBuffer=y.buffer)}}else c=!0}c&&o?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(r,a){var o=a.frag,u=a.part;if(!o||o.type===C.PlaylistLevelType.MAIN){if(this.fragContextChanged(o))return this.warn("Fragment "+o.sn+(u?" p: "+u.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===$t&&(this.state=qe));var d=u?u.stats:o.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),o.sn!=="initSegment"&&(this.fragPrevious=o),this.fragBufferedComplete(o,u)}},s.onError=function(r,a){switch(a.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.MAIN,a);break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Ut&&(a.fatal?(this.warn(""+a.details),this.state=Ut):a.levelRetry||this.state!==Vt||(this.state=qe));break;case _.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===Ot||this.state===$t)){var o=!0,u=this.getFwdBufferInfo(this.media,C.PlaylistLevelType.MAIN);u&&u.len>.5&&(o=!this.reduceMaxBufferLength(u.len)),o&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},s.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){if(this.loadedmetadata||!$.getBuffered(r).length){var o=this.state!==qe?this.fragCurrent:null;a.poll(this.lastCurrentTime,o)}this.lastCurrentTime=r.currentTime}},s.onFragLoadEmergencyAborted=function(){this.state=qe,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},s.onBufferFlushed=function(r,a){var o=a.type;if(o!==re.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var u=(o===re.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(u,o,C.PlaylistLevelType.MAIN)}},s.onLevelsUpdated=function(r,a){this.levels=a.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s.seekToStartPos=function(){var r=this.media;if(r){var a=r.currentTime,o=this.startPosition;if(o>=0&&a<o){if(r.seeking)return void this.log("could not seek to "+o+", already seeking at "+a);var u=$.getBuffered(r),d=(u.length?u.start(0):0)-o;d>0&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+d+" to match buffer start"),o+=d,this.startPosition=o),this.log("seek to target start position "+o+" from current time "+a),r.currentTime=o}}},s._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},s._loadBitrateTestFrag=function(r){var a=this;r.bitrateTest=!0,this._doFragLoad(r).then(function(o){var u=a.hls;if(o&&!u.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=qe,a.startFragRequested=!1,a.bitrateTest=!1;var d=r.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),u.trigger(f.Events.FRAG_LOADED,o),r.bitrateTest=!1}})},s._handleTransmuxComplete=function(r){var a,o="main",u=this.hls,d=r.remuxResult,c=r.chunkMeta,v=this.getCurrentContext(c);if(!v)return this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(c.level);var m=v.frag,y=v.part,I=v.level,k=d.video,z=d.text,Q=d.id3,j=d.initSegment,ee=I.details,se=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(m)){if(this.state=Ot,j){j.tracks&&(this._bufferInitSegment(I,j.tracks,m,c),u.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:o,tracks:j.tracks}));var W=j.initPTS,ce=j.timescale;(0,w.isFiniteNumber)(W)&&(this.initPTS[m.cc]=W,u.trigger(f.Events.INIT_PTS_FOUND,{frag:m,id:o,initPTS:W,timescale:ce}))}if(k&&d.independent!==!1){if(ee){var ue=k.startPTS,Ae=k.endPTS,Ie=k.startDTS,Ge=k.endDTS;if(y)y.elementaryStreams[k.type]={startPTS:ue,endPTS:Ae,startDTS:Ie,endDTS:Ge};else if(k.firstKeyFrame&&k.independent&&(this.couldBacktrack=!0),k.dropped&&k.independent){var Xe=this.getMainFwdBufferInfo();if((Xe?Xe.end:this.getLoadPosition())+this.config.maxBufferHole<(k.firstKeyFramePTS?k.firstKeyFramePTS:ue)-this.config.maxBufferHole)return void this.backtrack(m);m.setElementaryStreamInfo(k.type,m.start,Ae,m.start,Ge,!0)}m.setElementaryStreamInfo(k.type,ue,Ae,Ie,Ge),this.backtrackFragment&&(this.backtrackFragment=m),this.bufferFragmentData(k,m,y,c)}}else if(d.independent===!1)return void this.backtrack(m);if(se){var Ue=se.startPTS,Ke=se.endPTS,Qe=se.startDTS,at=se.endDTS;y&&(y.elementaryStreams[re.ElementaryStreamTypes.AUDIO]={startPTS:Ue,endPTS:Ke,startDTS:Qe,endDTS:at}),m.setElementaryStreamInfo(re.ElementaryStreamTypes.AUDIO,Ue,Ke,Qe,at),this.bufferFragmentData(se,m,y,c)}if(ee&&Q!=null&&(a=Q.samples)!==null&&a!==void 0&&a.length){var vt={id:o,frag:m,details:ee,samples:Q.samples};u.trigger(f.Events.FRAG_PARSING_METADATA,vt)}if(ee&&z){var tt={id:o,frag:m,details:ee,samples:z.samples};u.trigger(f.Events.FRAG_PARSING_USERDATA,tt)}}},s._bufferInitSegment=function(r,a,o,u){var d=this;if(this.state===Ot){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var c=a.audio,v=a.video,m=a.audiovideo;if(c){var y=r.audioCodec,I=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(y&&(y=y.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),c.metadata.channelCount!==1&&I.indexOf("firefox")===-1&&(y="mp4a.40.5")),I.indexOf("android")!==-1&&c.container!=="audio/mpeg"&&(y="mp4a.40.2",this.log("Android: force audio codec to "+y)),r.audioCodec&&r.audioCodec!==y&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+y+'"'),c.levelCodec=y,c.id="main",this.log("Init audio buffer, container:"+c.container+", codecs[selected/level/parsed]=["+(y||"")+"/"+(r.audioCodec||"")+"/"+c.codec+"]")}v&&(v.levelCodec=r.videoCodec,v.id="main",this.log("Init video buffer, container:"+v.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+v.codec+"]")),m&&this.log("Init audiovideo buffer, container:"+m.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+m.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(k){var z=a[k].initSegment;z!=null&&z.byteLength&&d.hls.trigger(f.Events.BUFFER_APPENDING,{type:k,data:z,frag:o,part:null,chunkMeta:u,parent:o.type})}),this.tick()}},s.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,C.PlaylistLevelType.MAIN)},s.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=qe},s.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var o=r.currentTime;if($.isBuffered(r,o)?a=this.getAppendedFrag(o):$.isBuffered(r,o+.1)&&(a=this.getAppendedFrag(o+.1)),a){this.backtrackFragment=null;var u=this.fragPlaying,d=a.level;u&&a.sn===u.sn&&u.level===d&&a.urlId===u.urlId||(this.hls.trigger(f.Events.FRAG_CHANGED,{frag:a}),u&&u.level===d||this.hls.trigger(f.Events.LEVEL_SWITCHED,{level:d}),this.fragPlaying=a)}}},i=t,(n=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var a=r.currentTime,o=this.currentFrag;if(o&&(0,w.isFiniteNumber)(a)&&(0,w.isFiniteNumber)(o.programDateTime)){var u=o.programDateTime+1e3*(a-o.start);return new Date(u)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&Ni(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Er);const hr=function(){function h(e,t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var l=h.prototype;return l.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},l.getTotalWeight=function(){return this.totalWeight_},l.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},h}(),Bi=function(){function h(e,t,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new hr(e),this.fast_=new hr(t)}var l=h.prototype;return l.update=function(e,t){var i=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new hr(e,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new hr(t,n.getEstimate(),n.getTotalWeight()))},l.sample=function(e,t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},l.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},l.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},l.destroy=function(){},h}();function Gi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}const Ki=function(){function h(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var n=i.config;this.bwEstimator=new Bi(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var l,e,t=h.prototype;return t.registerListeners=function(){var i=this.hls;i.on(f.Events.FRAG_LOADING,this.onFragLoading,this),i.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(f.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var i=this.hls;i.off(f.Events.FRAG_LOADING,this.onFragLoading,this),i.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(f.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(i,n){var s,r=n.frag;r.type===C.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=(s=n.part)!=null?s:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(i,n){var s=this.hls.config;n.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.autoLevelEnabled,a=(s.config,s.media);if(i&&a){var o=n?n.stats:i.stats,u=n?n.duration:i.duration;if(o.aborted||o.loaded&&o.loaded===o.total||i.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!a.paused&&a.playbackRate&&a.readyState){var d=s.mainForwardBufferInfo;if(d!==null){var c=performance.now()-o.loading.start,v=Math.abs(a.playbackRate);if(!(c<=500*u/v)){var m=o.loaded&&o.loading.first,y=this.bwEstimator.getEstimate(),I=s.levels,k=s.minAutoLevel,z=I[i.level],Q=o.total||Math.max(o.loaded,Math.round(u*z.maxBitrate/8)),j=m?1e3*o.loaded/c:0,ee=j?(Q-o.loaded)/j:8*Q/y,se=d.len/v;if(!(ee<=se)){var W,ce=Number.POSITIVE_INFINITY;for(W=i.level-1;W>k;W--){var ue=I[W].maxBitrate;if((ce=j?u*ue/(6.4*j):u*ue/y)<se)break}ce>=ee||(S.logger.warn("Fragment "+i.sn+(n?" part "+n.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+W+`
      Current BW estimate: `+((0,w.isFiniteNumber)(y)?(y/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+ee.toFixed(3)+` s
      Estimated load time for the next fragment: `+ce.toFixed(3)+` s
      Time to underbuffer: `+se.toFixed(3)+" s"),s.nextLoadLevel=W,m&&this.bwEstimator.sample(c,o.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),s.trigger(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:o}))}}}}}},t.onFragLoaded=function(i,n){var s=n.frag,r=n.part;if(s.type===C.PlaylistLevelType.MAIN&&(0,w.isFiniteNumber)(s.sn)){var a=r?r.stats:s.stats,o=r?r.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[s.level],d=(u.loaded?u.loaded.bytes:0)+a.loaded,c=(u.loaded?u.loaded.duration:0)+o;u.loaded={bytes:d,duration:c},u.realBitrate=Math.round(8*d/c)}if(s.bitrateTest){var v={stats:a,frag:s,part:r,id:s.type};this.onFragBuffered(f.Events.FRAG_BUFFERED,v)}}},t.onFragBuffered=function(i,n){var s=n.frag,r=n.part,a=r?r.stats:s.stats;if(!a.aborted&&s.type===C.PlaylistLevelType.MAIN&&s.sn!=="initSegment"){var o=a.parsing.end-a.loading.start;this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},t.onError=function(i,n){switch(n.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.maxAutoLevel,a=s.config,o=s.minAutoLevel,u=s.media,d=n?n.duration:i?i.duration:0,c=(u&&u.currentTime,u&&u.playbackRate!==0?Math.abs(u.playbackRate):1),v=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,m=s.mainForwardBufferInfo,y=(m?m.len:0)/c,I=this.findBestLevel(v,o,r,y,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(I>=0)return I;S.logger.trace((y?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var k=d?Math.min(d,a.maxStarvationDelay):a.maxStarvationDelay,z=a.abrBandWidthFactor,Q=a.abrBandWidthUpFactor;if(!y){var j=this.bitrateTestDelay;j&&(k=(d?Math.min(d,a.maxLoadingDelay):a.maxLoadingDelay)-j,S.logger.trace("bitrate test took "+Math.round(1e3*j)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*k)+" ms"),z=Q=1)}return I=this.findBestLevel(v,o,r,y+k,z,Q),Math.max(I,0)},t.findBestLevel=function(i,n,s,r,a,o){for(var u,d=this.fragCurrent,c=this.partCurrent,v=this.lastLoadedFragLevel,m=this.hls.levels,y=m[v],I=!(y==null||(u=y.details)===null||u===void 0||!u.live),k=y==null?void 0:y.codecSet,z=c?c.duration:d?d.duration:0,Q=s;Q>=n;Q--){var j=m[Q];if(j&&(!k||j.codecSet===k)){var ee,se=j.details,W=(c?se==null?void 0:se.partTarget:se==null?void 0:se.averagetargetduration)||z;ee=Q<=v?a*i:o*i;var ce=m[Q].maxBitrate,ue=ce*W/ee;if(S.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+Q+"/"+Math.round(ee)+"/"+ce+"/"+W+"/"+r+"/"+ue),ee>ce&&(ue===0||!(0,w.isFiniteNumber)(ue)||I&&!this.bitrateTestDelay||ue<r))return Q}}return-1},l=h,(e=[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,n=this.bwEstimator;if(i!==-1&&!n.canEstimate())return i;var s=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[s].loadError?i:(i!==-1&&(s=Math.min(i,s)),s)},set:function(i){this._nextAutoLevel=i}}])&&Gi(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();var ri=function(){function h(){this.chunks=[],this.dataLength=0}var l=h.prototype;return l.push=function(e){this.chunks.push(e),this.dataLength+=e.length},l.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=t.length===1?t[0]:function(n,s){for(var r=new Uint8Array(s),a=0,o=0;o<n.length;o++){var u=n[o];r.set(u,a),a+=u.length}return r}(t,i),this.reset(),e):new Uint8Array(0)},l.reset=function(){this.chunks.length=0,this.dataLength=0},h}();function dr(){return dr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},dr.apply(this,arguments)}function Dr(h,l){return Dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Dr(h,l)}var Hi=function(h){var l,e;function t(n,s){var r;return(r=h.call(this,n,s,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Dr(l,e);var i=t.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var n=this.hls;n.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(f.Events.ERROR,this.onError,this),n.on(f.Events.BUFFER_RESET,this.onBufferReset,this),n.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var n=this.hls;n.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(f.Events.ERROR,this.onError,this),n.off(f.Events.BUFFER_RESET,this.onBufferReset,this),n.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(n,s){var r=s.frag,a=s.id,o=s.initPTS;if(a==="main"){var u=r.cc;this.initPTS[r.cc]=o,this.log("InitPTS for cc: "+u+" found from main: "+o),this.videoTrackCC=u,this.state===Jt&&this.tick()}},i.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=wt);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),n=s,this.state=qe):(this.loadedmetadata=!1,this.state=lr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},i.doTick=function(){switch(this.state){case qe:this.doTickIdle();break;case lr:var n,s=this.levels,r=this.trackId,a=s==null||(n=s[r])===null||n===void 0?void 0:n.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=Jt}break;case jt:var o,u=performance.now(),d=this.retryDate;(!d||u>=d||(o=this.media)!==null&&o!==void 0&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=qe);break;case Jt:var c=this.waitingData;if(c){var v=c.frag,m=c.part,y=c.cache,I=c.complete;if(this.initPTS[v.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Ht;var k={frag:v,part:m,payload:y.flush(),networkDetails:null};this._handleFragmentLoadProgress(k),I&&h.prototype._handleFragmentLoadComplete.call(this,k)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+v.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var z=this.getLoadPosition(),Q=$.bufferInfo(this.mediaBuffer,z,this.config.maxBufferHole);ze(Q.end,this.config.maxFragLookUpTolerance,v)<0&&(this.log("Waiting fragment cc ("+v.cc+") @ "+v.start+" cancelled because another fragment at "+Q.end+" is needed"),this.clearWaitingFragment())}}else this.state=qe}this.onTickEnd()},i.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=qe)},i.resetLoadingState=function(){this.clearWaitingFragment(),h.prototype.resetLoadingState.call(this)},i.onTickEnd=function(){var n=this.media;n&&n.readyState&&(this.lastCurrentTime=n.currentTime)},i.doTickIdle=function(){var n,s,r=this.hls,a=this.levels,o=this.media,u=this.trackId,d=r.config;if(a&&a[u]&&(o||!this.startFragRequested&&d.startFragPrefetch)){var c=a[u].details;if(!c||c.live&&this.levelLastLoaded!==u||this.waitForCdnTuneIn(c))this.state=lr;else{var v=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&v&&(this.bufferFlushed=!1,this.afterBufferFlushed(v,re.ElementaryStreamTypes.AUDIO,C.PlaylistLevelType.AUDIO));var m=this.getFwdBufferInfo(v,C.PlaylistLevelType.AUDIO);if(m!==null){var y=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,C.PlaylistLevelType.MAIN),I=m.len,k=this.getMaxBufferLength(y==null?void 0:y.len),z=this.audioSwitch;if(!(I>=k)||z){if(!z&&this._streamEnded(m,c))return r.trigger(f.Events.BUFFER_EOS,{type:"audio"}),void(this.state=ur);var Q=c.fragments[0].start,j=m.end;if(z&&o){var ee=this.getLoadPosition();j=ee,c.PTSKnown&&ee<Q&&(m.end>Q||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=Q+.05)}if(!(y&&j>y.end+c.targetduration)&&(y&&y.len||!m.len)){var se=this.getNextFragment(j,c);se?((n=se.decryptdata)===null||n===void 0?void 0:n.keyFormat)!=="identity"||(s=se.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(se,c,j):this.loadKey(se,c):this.bufferFlushed=!0}}}}}},i.getMaxBufferLength=function(n){var s=h.prototype.getMaxBufferLength.call(this);return n?Math.max(s,n):s},i.onMediaDetaching=function(){this.videoBuffer=null,h.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(n,s){var r=s.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(a){return new rt(a)})},i.onAudioTrackSwitching=function(n,s){var r=!!s.url;this.trackId=s.id;var a=this.fragCurrent;a!=null&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=qe):this.state=wt,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(n,s){this.mainDetails=s.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(f.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(n,s){var r;if(this.mainDetails!=null){var a=this.levels,o=s.details,u=s.id;if(a){this.log("Track "+u+" loaded ["+o.startSN+","+o.endSN+"],duration:"+o.totalduration);var d=a[u],c=0;if(o.live||(r=d.details)!==null&&r!==void 0&&r.live){var v=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!v)return;!d.details&&o.hasProgramDateTime&&v.hasProgramDateTime?(Pe(o,v),c=o.fragments[0].start):c=this.alignPlaylists(o,d.details)}d.details=o,this.levelLastLoaded=u,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(d.details,c),this.state!==lr||this.waitForCdnTuneIn(o)||(this.state=qe),this.tick()}else this.warn("Audio tracks were reset while loading level "+u)}else this.cachedTrackLoadedData=s},i._handleFragmentLoadProgress=function(n){var s,r=n.frag,a=n.part,o=n.payload,u=this.config,d=this.trackId,c=this.levels;if(c){var v=c[d],m=v.details,y=u.defaultAudioCodec||v.audioCodec||"mp4a.40.2",I=this.transmuxer;I||(I=this.transmuxer=new ti(this.hls,C.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var k=this.initPTS[r.cc],z=(s=r.initSegment)===null||s===void 0?void 0:s.data;if(k!==void 0){var Q=a?a.index:-1,j=Q!==-1,ee=new fe(r.level,r.sn,r.stats.chunkCount,o.byteLength,Q,j);I.push(o,z,y,"",r,a,m.totalduration,!1,ee,k)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+m.startSN+" ,"+m.endSN+"],track "+d),(this.waitingData=this.waitingData||{frag:r,part:a,cache:new ri,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=Jt}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:h.prototype._handleFragmentLoadComplete.call(this,n)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(n,s){var r=s.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer||null)},i.onFragBuffered=function(n,s){var r,a=s.frag,o=s.part;a.type===C.PlaylistLevelType.AUDIO?this.fragContextChanged(a)?this.warn("Fragment "+a.sn+(o?" p: "+o.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,o)):this.loadedmetadata||a.type!==C.PlaylistLevelType.MAIN||(r=this.videoBuffer||this.media)!==null&&r!==void 0&&r.buffered.length&&(this.loadedmetadata=!0)},i.onError=function(n,s){switch(s.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.AUDIO,s);break;case _.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case _.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Ut&&this.state!==wt&&(this.state=s.fatal?Ut:qe,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case _.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===Ot||this.state===$t)){var r=!0,a=this.getFwdBufferInfo(this.mediaBuffer,C.PlaylistLevelType.AUDIO);a&&a.len>.5&&(r=!this.reduceMaxBufferLength(a.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},i.onBufferFlushed=function(n,s){s.type===re.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},i._handleTransmuxComplete=function(n){var s,r="audio",a=this.hls,o=n.remuxResult,u=n.chunkMeta,d=this.getCurrentContext(u);if(!d)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(u.level);var c=d.frag,v=d.part,m=d.level.details,y=o.audio,I=o.text,k=o.id3,z=o.initSegment;if(!this.fragContextChanged(c)&&m){if(this.state=Ot,this.audioSwitch&&y&&this.completeAudioSwitch(),z!=null&&z.tracks&&(this._bufferInitSegment(z.tracks,c,u),a.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:r,tracks:z.tracks})),y){var Q=y.startPTS,j=y.endPTS,ee=y.startDTS,se=y.endDTS;v&&(v.elementaryStreams[re.ElementaryStreamTypes.AUDIO]={startPTS:Q,endPTS:j,startDTS:ee,endDTS:se}),c.setElementaryStreamInfo(re.ElementaryStreamTypes.AUDIO,Q,j,ee,se),this.bufferFragmentData(y,c,v,u)}if(k!=null&&(s=k.samples)!==null&&s!==void 0&&s.length){var W=dr({id:r,frag:c,details:m},k);a.trigger(f.Events.FRAG_PARSING_METADATA,W)}if(I){var ce=dr({id:r,frag:c,details:m},I);a.trigger(f.Events.FRAG_PARSING_USERDATA,ce)}}},i._bufferInitSegment=function(n,s,r){if(this.state===Ot){n.video&&delete n.video;var a=n.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,n);var o=a.initSegment;if(o!=null&&o.byteLength){var u={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:o};this.hls.trigger(f.Events.BUFFER_APPENDING,u)}this.tick()}}},i.loadFragment=function(n,s,r){var a=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||a===g.NOT_LOADED||a===g.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):s.live&&!(0,w.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=Jt):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,n,s,r)))},i.completeAudioSwitch=function(){var n=this.hls,s=this.media,r=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:r})},t}(Er);const ji=Hi;function Vi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Ar(h,l){return Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ar(h,l)}const Wi=function(h){var l,e;function t(r){var a;return(a=h.call(this,r,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Ar(l,e);var i,n,s=t.prototype;return s.registerListeners=function(){var r=this.hls;r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(f.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(f.Events.ERROR,this.onError,this)},s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,h.prototype.destroy.call(this)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.audioTracks||[]},s.onAudioTrackLoaded=function(r,a){var o=a.id,u=a.details,d=this.tracksInGroup[o];if(d){var c=d.details;d.details=a.details,this.log("audioTrack "+o+" loaded ["+u.startSN+"-"+u.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,a,c))}else this.warn("Invalid audio track id "+o)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.audioGroupIds){var o=a.audioGroupIds[a.urlId];if(this.groupId!==o){this.groupId=o;var u=this.tracks.filter(function(c){return!o||c.groupId===o});this.selectDefaultTrack&&!u.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var d={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(f.Events.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}}},s.onError=function(r,a){h.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===C.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.setAudioTrack=function(r){var a=this.tracksInGroup;if(r<0||r>=a.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var o=a[this.trackId];this.log("Now switching to audio-track index "+r);var u=a[r],d=u.id,c=u.groupId,v=c===void 0?"":c,m=u.name,y=u.type,I=u.url;if(this.trackId=r,this.trackName=m,this.selectDefaultTrack=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHING,{id:d,groupId:v,name:m,type:y,url:I}),!u.details||u.details.live){var k=this.switchParams(u.url,o==null?void 0:o.details);this.loadPlaylist(k)}}},s.selectInitialTrack=function(){this.tracksInGroup;var r=this.trackName,a=this.findTrackId(r)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},s.findTrackId=function(r){for(var a=this.tracksInGroup,o=0;o<a.length;o++){var u=a[o];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var o=a.id,u=a.groupId,d=a.url;if(r)try{d=r.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist for id: "+o),this.clearTimer(),this.hls.trigger(f.Events.AUDIO_TRACK_LOADING,{url:d,id:o,groupId:u,deliveryDirectives:r||null})}},i=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}])&&Vi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Tt);function Yi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function kr(h,l){return kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kr(h,l)}var qi=function(h){var l,e;function t(r,a){var o;return(o=h.call(this,r,a,"[subtitle-stream-controller]")||this).levels=[],o.currentTrackId=-1,o.tracksBuffered=[],o.mainDetails=null,o._registerListeners(),o}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,kr(l,e);var i,n,s=t.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var r=this.hls;r.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.Events.ERROR,this.onError,this),r.on(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(f.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(f.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.Events.ERROR,this.onError,this),r.off(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(f.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(f.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.startLoad=function(r){this.stopLoad(),this.state=qe,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(r,a){this.mainDetails=a.details},s.onSubtitleFragProcessed=function(r,a){var o=a.frag,u=a.success;if(this.fragPrevious=o,this.state=qe,u){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var c,v=o.start,m=0;m<d.length;m++)if(v>=d[m].start&&v<=d[m].end){c=d[m];break}var y=o.start+o.duration;c?c.end=y:(c={start:v,end:y},d.push(c)),this.fragmentTracker.fragBuffered(o)}}},s.onBufferFlushing=function(r,a){var o=a.startOffset,u=a.endOffset;if(o===0&&u!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,c=this.levels;if(!c.length||!c[d]||!c[d].details)return;var v=u-c[d].details.targetduration;if(v<=0)return;a.endOffsetSubtitles=Math.max(0,v),this.tracksBuffered.forEach(function(m){for(var y=0;y<m.length;)if(m[y].end<=v)m.shift();else{if(!(m[y].start<v))break;m[y].start=v,y++}}),this.fragmentTracker.removeFragmentsInRange(o,v,C.PlaylistLevelType.SUBTITLE)}},s.onFragBuffered=function(r,a){var o;this.loadedmetadata||a.frag.type!==C.PlaylistLevelType.MAIN||(o=this.media)!==null&&o!==void 0&&o.buffered.length&&(this.loadedmetadata=!0)},s.onError=function(r,a){var o,u=a.frag;u&&u.type===C.PlaylistLevelType.SUBTITLE&&((o=this.fragCurrent)!==null&&o!==void 0&&o.loader&&this.fragCurrent.loader.abort(),this.state=qe)},s.onSubtitleTracksUpdated=function(r,a){var o=this,u=a.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(d){return new rt(d)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(d){o.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(r,a){if(this.currentTrackId=a.id,this.levels.length&&this.currentTrackId!==-1){var o=this.levels[this.currentTrackId];o!=null&&o.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,o&&this.setInterval(500)}else this.clearInterval()},s.onSubtitleTrackLoaded=function(r,a){var o,u=a.details,d=a.id,c=this.currentTrackId,v=this.levels;if(v.length){var m=v[c];if(!(d>=v.length||d!==c)&&m){this.mediaBuffer=this.mediaBufferTimeRanges;var y=0;if(u.live||(o=m.details)!==null&&o!==void 0&&o.live){var I=this.mainDetails;if(u.deltaUpdateFailed||!I)return;var k=I.fragments[0];m.details?(y=this.alignPlaylists(u,m.details))===0&&k&&Et(u,y=k.start):u.hasProgramDateTime&&I.hasProgramDateTime?(Pe(u,I),y=u.fragments[0].start):k&&Et(u,y=k.start)}m.details=u,this.levelLastLoaded=d,this.startFragRequested||!this.mainDetails&&u.live||this.setStartPosition(m.details,y),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===qe&&(Le(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),m.details=void 0))}}},s._handleFragmentLoadComplete=function(r){var a=r.frag,o=r.payload,u=a.decryptdata,d=this.hls;if(!this.fragContextChanged(a)&&o&&o.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer).then(function(v){var m=performance.now();d.trigger(f.Events.FRAG_DECRYPTED,{frag:a,payload:v,stats:{tstart:c,tdecrypt:m}})})}},s.doTick=function(){if(this.media){if(this.state===qe){var r=this.currentTrackId,a=this.levels;if(!a.length||!a[r]||!a[r].details)return;var o=a[r].details,u=o.targetduration,d=this.config,c=this.getLoadPosition(),v=$.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],c-u,d.maxBufferHole),m=v.end,y=v.len,I=this.getFwdBufferInfo(this.media,C.PlaylistLevelType.MAIN);if(y>this.getMaxBufferLength(I==null?void 0:I.len)+u)return;var k,z=o.fragments,Q=z.length,j=o.edge,ee=this.fragPrevious;if(m<j){var se=d.maxFragLookUpTolerance;!(k=Le(ee,z,Math.max(z[0].start,m),se))&&ee&&ee.start<z[0].start&&(k=z[0])}else k=z[Q-1];if(!(k=this.mapToInitFragWhenRequired(k))||this.fragmentTracker.getState(k)!==g.NOT_LOADED)return;k.encrypted?this.loadKey(k,o):this.loadFragment(k,o,m)}}else this.state=qe},s.getMaxBufferLength=function(r){var a=h.prototype.getMaxBufferLength.call(this);return r?Math.max(a,r):a},s.loadFragment=function(r,a,o){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,a,o))},i=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return new zi(this.tracksBuffered[this.currentTrackId]||[])}}])&&Yi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Er),zi=function(h){this.buffered=void 0;var l=function(e,t,i){if((t>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return h[t][e]};this.buffered={get length(){return h.length},end:function(e){return l("end",e,h.length)},start:function(e){return l("start",e,h.length)}}};function Xi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Rr(h,l){return Rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rr(h,l)}function Ir(h){for(var l=[],e=0;e<h.length;e++){var t=h[e];t.kind==="subtitles"&&t.label&&l.push(h[e])}return l}const Qi=function(h){var l,e;function t(r){var a;return(a=h.call(this,r,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a._subtitleDisplay=!0,a.registerListeners(),a}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Rr(l,e);var i,n,s=t.prototype;return s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,h.prototype.destroy.call(this)},s.registerListeners=function(){var r=this.hls;r.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(f.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(f.Events.ERROR,this.onError,this)},s.onMediaAttached=function(r,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},s.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},s.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Ir(this.media.textTracks).forEach(function(r){De(r)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.subtitleTracks},s.onSubtitleTrackLoaded=function(r,a){var o=a.id,u=a.details,d=this.trackId,c=this.tracksInGroup[d];if(c){var v=c.details;c.details=a.details,this.log("subtitle track "+o+" loaded ["+u.startSN+"-"+u.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,a,v))}else this.warn("Invalid subtitle track id "+o)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.textGroupIds){var o=a.textGroupIds[a.urlId];if(this.groupId!==o){var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(m){return!o||m.groupId===o});this.tracksInGroup=d;var c=this.findTrackId(u==null?void 0:u.name)||this.findTrackId();this.groupId=o;var v={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(f.Events.SUBTITLE_TRACKS_UPDATED,v),c!==-1&&this.setSubtitleTrack(c,u)}}},s.findTrackId=function(r){for(var a=this.tracksInGroup,o=0;o<a.length;o++){var u=a[o];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},s.onError=function(r,a){h.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===C.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var o=a.id,u=a.groupId,d=a.url;if(r)try{d=r.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Loading subtitle playlist for id "+o),this.hls.trigger(f.Events.SUBTITLE_TRACK_LOADING,{url:d,id:o,groupId:u,deliveryDirectives:r||null})}},s.toggleTrackModes=function(r){var a=this,o=this.media,u=this.trackId;if(o){var d=Ir(o.textTracks),c=d.filter(function(y){return y.groupId===a.groupId});if(r===-1)[].slice.call(d).forEach(function(y){y.mode="disabled"});else{var v=c[u];v&&(v.mode="disabled")}var m=c[r];m&&(m.mode=this.subtitleDisplay?"showing":"hidden")}},s.setSubtitleTrack=function(r,a){var o,u=this.tracksInGroup;if(this.media){if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(o=u[r])!==null&&o!==void 0&&o.details)||r<-1||r>=u.length)){this.clearTimer();var d=u[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,d){var c=d.id,v=d.groupId,m=v===void 0?"":v,y=d.name,I=d.type,k=d.url;this.hls.trigger(f.Events.SUBTITLE_TRACK_SWITCH,{id:c,groupId:m,name:y,type:I,url:k});var z=this.switchParams(d.url,a==null?void 0:a.details);this.loadPlaylist(z)}else this.hls.trigger(f.Events.SUBTITLE_TRACK_SWITCH,{id:r})}}else this.queuedDefaultTrack=r},s.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var r=-1,a=Ir(this.media.textTracks),o=0;o<a.length;o++)if(a[o].mode==="hidden")r=o;else if(a[o].mode==="showing"){r=o;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},i=t,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,a)}}])&&Xi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Tt);var We,$i=function(){function h(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var l=h.prototype;return l.append=function(e,t){var i=this.queues[t];i.push(e),i.length===1&&this.buffers[t]&&this.executeNext(t)},l.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},l.appendBlocker=function(e){var t,i=new Promise(function(s){t=s}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},l.executeNext=function(e){var t=this.buffers,i=this.queues,n=t[e],s=i[e];if(s.length){var r=s[0];try{r.execute()}catch(a){S.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(a),n&&n.updating||(s.shift(),this.executeNext(e))}}},l.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},l.current=function(e){return this.queues[e][0]},h}(),ii=Tr(),ni=/([ha]vc.)(?:\.[^.,]+)+/,Ji=function(){function h(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=t.hls,n=t.media,s=t.mediaSource;S.logger.log("[buffer-controller]: Media source opened"),n&&(t.updateMediaElementDuration(),i.trigger(f.Events.MEDIA_ATTACHED,{media:n})),s&&s.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){S.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){S.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var l=h.prototype;return l.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},l.destroy=function(){this.unregisterListeners(),this.details=null},l.registerListeners=function(){var e=this.hls;e.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.Events.BUFFER_RESET,this.onBufferReset,this),e.on(f.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(f.Events.BUFFER_EOS,this.onBufferEos,this),e.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(f.Events.FRAG_PARSED,this.onFragParsed,this),e.on(f.Events.FRAG_CHANGED,this.onFragChanged,this)},l.unregisterListeners=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.Events.BUFFER_RESET,this.onBufferReset,this),e.off(f.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(f.Events.BUFFER_EOS,this.onBufferEos,this),e.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(f.Events.FRAG_PARSED,this.onFragParsed,this),e.off(f.Events.FRAG_CHANGED,this.onFragChanged,this)},l._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new $i(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},l.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,S.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},l.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&ii){var n=this.mediaSource=new ii;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src}},l.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(S.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(n){S.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):S.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(f.Events.MEDIA_DETACHED,void 0)},l.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(n){S.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",n)}}),this._initSourceBuffer()},l.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(s){if(n){var r=i.tracks[s];if(r&&typeof r.buffer.changeType=="function"){var a=t[s],o=a.id,u=a.codec,d=a.levelCodec,c=a.container,v=a.metadata,m=(r.levelCodec||r.codec).replace(ni,"$1"),y=(d||u).replace(ni,"$1");if(m!==y){var I=c+";codecs="+(d||u);i.appendChangeType(s,I),S.logger.log("[buffer-controller]: switching codec "+m+" to "+y),i.tracks[s]={buffer:r.buffer,codec:u,container:c,levelCodec:d,metadata:v,id:o}}}}else i.pendingTracks[s]=t[s]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},l.appendChangeType=function(e,t){var i=this,n=this.operationQueue,s={execute:function(){var r=i.sourceBuffer[e];r&&(S.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(r){S.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",r)}};n.append(s,e)},l.onBufferAppending=function(e,t){var i=this,n=this.hls,s=this.operationQueue,r=this.tracks,a=t.data,o=t.type,u=t.frag,d=t.part,c=t.chunkMeta,v=c.buffering[o],m=self.performance.now();v.start=m;var y=u.stats.buffering,I=d?d.stats.buffering:null;y.start===0&&(y.start=m),I&&I.start===0&&(I.start=m);var k=r.audio,z=o==="audio"&&c.id===1&&(k==null?void 0:k.container)==="audio/mpeg",Q={execute:function(){if(v.executeStart=self.performance.now(),z){var j=i.sourceBuffer[o];if(j){var ee=u.start-j.timestampOffset;Math.abs(ee)>=.1&&(S.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+u.start+" (delta: "+ee+") sn: "+u.sn+")"),j.timestampOffset=u.start)}}i.appendExecutor(a,o)},onStart:function(){},onComplete:function(){var j=self.performance.now();v.executeEnd=v.end=j,y.first===0&&(y.first=j),I&&I.first===0&&(I.first=j);var ee=i.sourceBuffer,se={};for(var W in ee)se[W]=$.getBuffered(ee[W]);i.appendError=0,i.hls.trigger(f.Events.BUFFER_APPENDED,{type:o,frag:u,part:d,chunkMeta:c,parent:u.type,timeRanges:se})},onError:function(j){S.logger.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",j);var ee={type:_.ErrorTypes.MEDIA_ERROR,parent:u.type,details:_.ErrorDetails.BUFFER_APPEND_ERROR,err:j,fatal:!1};j.code===DOMException.QUOTA_EXCEEDED_ERR?ee.details=_.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,ee.details=_.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(S.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),ee.fatal=!0,n.stopLoad())),n.trigger(f.Events.ERROR,ee)}};s.append(Q,o)},l.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,s=function(r){return{execute:i.removeExecutor.bind(i,r,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(f.Events.BUFFER_FLUSHED,{type:r})},onError:function(a){S.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",a)}}};t.type?n.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(function(r){n.append(s(r),r)})},l.onFragParsed=function(e,t){var i=this,n=t.frag,s=t.part,r=[],a=s?s.elementaryStreams:n.elementaryStreams;a[re.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(a[re.ElementaryStreamTypes.AUDIO]&&r.push("audio"),a[re.ElementaryStreamTypes.VIDEO]&&r.push("video")),r.length===0&&S.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var o=self.performance.now();n.stats.buffering.end=o,s&&(s.stats.buffering.end=o);var u=s?s.stats:n.stats;i.hls.trigger(f.Events.FRAG_BUFFERED,{frag:n,part:s,stats:u,id:n.type})},r)},l.onFragChanged=function(e,t){this.flushBackBuffer()},l.onBufferEos=function(e,t){var i=this;this.getSourceBufferTypes().reduce(function(n,s){var r=i.sourceBuffer[s];return t.type&&t.type!==s||r&&!r.ended&&(r.ended=!0,S.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS")),n&&!(r&&!r.ended)},!0)&&this.blockBuffers(function(){var n=i.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},l.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},l.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,n=this.sourceBuffer;if(i&&t!==null){var s=this.getSourceBufferTypes();if(s.length){var r=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,w.isFiniteNumber)(r)&&!(r<0)){var a=i.currentTime,o=t.levelTargetDuration,u=Math.max(r,o),d=Math.floor(a/o)*o-u;s.forEach(function(c){var v=n[c];if(v){var m=$.getBuffered(v);m.length>0&&d>m.start(0)&&(e.trigger(f.Events.BACK_BUFFER_REACHED,{bufferEnd:d}),t.live&&e.trigger(f.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d}),e.trigger(f.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:c}))}})}}}},l.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,s=e.fragments[0].start+e.totalduration,r=i.duration,a=(0,w.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(S.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>r||!(0,w.isFiniteNumber)(r))&&(S.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},l.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){var n=Math.max(0,i[0].start),s=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,s)}},l.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!e||n===2){this.createSourceBuffers(i),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0)return void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach(function(r){t.executeNext(r)})}},l.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var s in e)if(!t[s]){var r=e[s];if(!r)throw Error("source buffer exists for track "+s+", however track does not");var a=r.levelCodec||r.codec,o=r.container+";codecs="+a;S.logger.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var u=t[s]=i.addSourceBuffer(o),d=s;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[s]={buffer:u,codec:a,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},n++}catch(c){S.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+c.message),this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,mimeType:o})}}n&&this.hls.trigger(f.Events.BUFFER_CREATED,{tracks:this.tracks})},l._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},l._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},l._onSBUpdateError=function(e,t){S.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},l.removeExecutor=function(e,t,i){var n=this.media,s=this.mediaSource,r=this.operationQueue,a=this.sourceBuffer[e];if(!n||!s||!a)return S.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);var o=(0,w.isFiniteNumber)(n.duration)?n.duration:1/0,u=(0,w.isFiniteNumber)(s.duration)?s.duration:1/0,d=Math.max(0,t),c=Math.min(i,o,u);c>d?(S.logger.log("[buffer-controller]: Removing ["+d+","+c+"] from the "+e+" SourceBuffer"),a.remove(d,c)):r.shiftAndExecuteNext(e)},l.appendExecutor=function(e,t){var i=this.operationQueue,n=this.sourceBuffer[t];if(!n)return S.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)},l.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return S.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,s=t.map(function(r){return n.appendBlocker(r)});Promise.all(s).then(function(){e(),t.forEach(function(r){var a=i.sourceBuffer[r];a&&a.updating||n.shiftAndExecuteNext(r)})})},l.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},l.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var s=i.bind(this,e);this.listeners[e].push({event:t,listener:s}),n.addEventListener(t,s)}},l.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(i){t.removeEventListener(i.event,i.listener)})},h}(),ai={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},si=function(h){var l=h;return ai.hasOwnProperty(h)&&(l=ai[h]),String.fromCharCode(l)},Bt=15,xt=100,Zi={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},en={17:2,18:4,21:6,22:8,23:10,19:13,20:15},tn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rn={25:2,26:4,29:6,30:8,31:10,27:13,28:15},nn=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(We||(We={}));var an=function(){function h(){this.time=null,this.verboseLevel=We.ERROR}return h.prototype.log=function(l,e){this.verboseLevel>=l&&S.logger.log(this.time+" ["+l+"] "+e)},h}(),Gt=function(h){for(var l=[],e=0;e<h.length;e++)l.push(h[e].toString(16));return l},oi=function(){function h(e,t,i,n,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}var l=h.prototype;return l.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},l.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},l.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},l.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},l.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},l.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),sn=function(){function h(e,t,i,n,s,r){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new oi(t,i,n,s,r)}var l=h.prototype;return l.reset=function(){this.uchar=" ",this.penState.reset()},l.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},l.setPenState=function(e){this.penState.copy(e)},l.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},l.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},l.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),on=function(){function h(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<xt;t++)this.chars.push(new sn);this.logger=e,this.pos=0,this.currPenState=new oi}var l=h.prototype;return l.equals=function(e){for(var t=!0,i=0;i<xt;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},l.copy=function(e){for(var t=0;t<xt;t++)this.chars[t].copy(e.chars[t])},l.isEmpty=function(){for(var e=!0,t=0;t<xt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},l.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(We.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>xt&&(this.logger.log(We.DEBUG,"Too large cursor position "+this.pos),this.pos=xt)},l.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},l.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},l.insertChar=function(e){e>=144&&this.backSpace();var t=si(e);this.pos>=xt?this.logger.log(We.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},l.clearFromPos=function(e){var t;for(t=e;t<xt;t++)this.chars[t].reset()},l.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},l.clearToEndOfRow=function(){this.clearFromPos(this.pos)},l.getTextString=function(){for(var e=[],t=!0,i=0;i<xt;i++){var n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")},l.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},h}(),_r=function(){function h(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Bt;t++)this.rows.push(new on(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var l=h.prototype;return l.reset=function(){for(var e=0;e<Bt;e++)this.rows[e].clear();this.currRow=14},l.equals=function(e){for(var t=!0,i=0;i<Bt;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},l.copy=function(e){for(var t=0;t<Bt;t++)this.rows[t].copy(e.rows[t])},l.isEmpty=function(){for(var e=!0,t=0;t<Bt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},l.backSpace=function(){this.rows[this.currRow].backSpace()},l.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},l.insertChar=function(e){this.rows[this.currRow].insertChar(e)},l.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},l.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},l.setCursor=function(e){this.logger.log(We.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},l.setPAC=function(e){this.logger.log(We.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<Bt;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var r=s.rows[n].cueStartTime,a=this.logger.time;if(r&&a!==null&&r<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(s.rows[n+o])}}this.currRow=t;var u=this.rows[this.currRow];if(e.indent!==null){var d=e.indent,c=Math.max(d-1,0);u.setCursor(e.indent),e.color=u.chars[c].penState.foreground}var v={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(v)},l.setBkgData=function(e){this.logger.log(We.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},l.setRollUpRows=function(e){this.nrRollUpRows=e},l.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(We.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(We.INFO,"Rolling up")}else this.logger.log(We.DEBUG,"roll_up but nrRollUpRows not set yet")},l.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,s=0;s<Bt;s++){var r=this.rows[s].getTextString();r&&(n=s+1,e?t.push("Row "+n+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join(`
`)),i},l.getTextAndFormat=function(){return this.rows},h}(),li=function(){function h(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new _r(i),this.nonDisplayedMemory=new _r(i),this.lastOutputScreen=new _r(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var l=h.prototype;return l.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},l.getHandler=function(){return this.outputFilter},l.setHandler=function(e){this.outputFilter=e},l.setPAC=function(e){this.writeScreen.setPAC(e)},l.setBkgData=function(e){this.writeScreen.setBkgData(e)},l.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(We.INFO,"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},l.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(We.INFO,i+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(We.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},l.ccRCL=function(){this.logger.log(We.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},l.ccBS=function(){this.logger.log(We.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},l.ccAOF=function(){},l.ccAON=function(){},l.ccDER=function(){this.logger.log(We.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},l.ccRU=function(e){this.logger.log(We.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},l.ccFON=function(){this.logger.log(We.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},l.ccRDC=function(){this.logger.log(We.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},l.ccTR=function(){this.logger.log(We.INFO,"TR"),this.setMode("MODE_TEXT")},l.ccRTD=function(){this.logger.log(We.INFO,"RTD"),this.setMode("MODE_TEXT")},l.ccEDM=function(){this.logger.log(We.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},l.ccCR=function(){this.logger.log(We.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},l.ccENM=function(){this.logger.log(We.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},l.ccEOC=function(){if(this.logger.log(We.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(We.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},l.ccTO=function(e){this.logger.log(We.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},l.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(We.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},l.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},l.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},h}(),ln=function(){function h(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new an;this.channels=[null,new li(e,t,n),new li(e+1,i,n)],this.cmdHistory={a:null,b:null},this.logger=n}var l=h.prototype;return l.getHandler=function(e){return this.channels[e].getHandler()},l.setHandler=function(e,t){this.channels[e].setHandler(t)},l.addData=function(e,t){var i,n,s,r=!1;this.logger.time=e;for(var a=0;a<t.length;a+=2)if(n=127&t[a],s=127&t[a+1],n!==0||s!==0){if(this.logger.log(We.DATA,"["+Gt([t[a],t[a+1]])+"] -> ("+Gt([n,s])+")"),(i=this.parseCmd(n,s))||(i=this.parseMidrow(n,s)),i||(i=this.parsePAC(n,s)),i||(i=this.parseBackgroundAttributes(n,s)),!i&&(r=this.parseChars(n,s))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(r):this.logger.log(We.WARNING,"No channel found yet. TEXT-MODE?")}i||r||this.logger.log(We.WARNING,"Couldn't parse cleaned data "+Gt([n,s])+" orig: "+Gt([t[a],t[a+1]]))}},l.parseCmd=function(e,t){var i=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(ui(e,t,i))return Yt(null,null,i),this.logger.log(We.DEBUG,"Repeated command ("+Gt([e,t])+") is dropped"),!0;var n=e===20||e===21||e===23?1:2,s=this.channels[n];return e===20||e===21||e===28||e===29?t===32?s.ccRCL():t===33?s.ccBS():t===34?s.ccAOF():t===35?s.ccAON():t===36?s.ccDER():t===37?s.ccRU(2):t===38?s.ccRU(3):t===39?s.ccRU(4):t===40?s.ccFON():t===41?s.ccRDC():t===42?s.ccTR():t===43?s.ccRTD():t===44?s.ccEDM():t===45?s.ccCR():t===46?s.ccENM():t===47&&s.ccEOC():s.ccTO(t-32),Yt(e,t,i),this.currentChannel=n,!0},l.parseMidrow=function(e,t){var i=0;if((e===17||e===25)&&t>=32&&t<=47){if((i=e===17?1:2)!==this.currentChannel)return this.logger.log(We.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[i];return!!n&&(n.ccMIDROW(t),this.logger.log(We.DEBUG,"MIDROW ("+Gt([e,t])+")"),!0)}return!1},l.parsePAC=function(e,t){var i,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(ui(e,t,n))return Yt(null,null,n),!0;var s=e<=23?1:2;i=t>=64&&t<=95?s===1?Zi[e]:tn[e]:s===1?en[e]:rn[e];var r=this.channels[s];return!!r&&(r.setPAC(this.interpretPAC(i,t)),Yt(e,t,n),this.currentChannel=s,!0)},l.interpretPAC=function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=(1&i)==1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},l.parseChars=function(e,t){var i,n,s=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19?(n=r===17?t+80:r===18?t+112:t+144,this.logger.log(We.INFO,"Special char '"+si(n)+"' in channel "+i),s=[n]):e>=32&&e<=127&&(s=t===0?[e]:[e,t]),s){var a=Gt(s);this.logger.log(We.DEBUG,"Char codes =  "+a.join(",")),Yt(e,t,this.cmdHistory)}return s},l.parseBackgroundAttributes=function(e,t){var i;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var n={};e===16||e===24?(i=Math.floor((t-32)/2),n.background=nn[i],t%2==1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));var s=e<=23?1:2;return this.channels[s].setBkgData(n),Yt(e,t,this.cmdHistory),!0},l.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},l.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t];i&&i.cueSplitAtTime(e)}},h}();function Yt(h,l,e){e.a=h,e.b=l}function ui(h,l,e){return e.a===h&&e.b===l}const hi=ln;var fr=function(){function h(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var l=h.prototype;return l.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},l.newCue=function(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},l.reset=function(){this.cueRanges=[],this.startTime=null},h}();const Cr=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var h=["","lr","rl"],l=["start","middle","end","left","right"];function e(s,r){if(typeof r!="string"||!Array.isArray(s))return!1;var a=r.toLowerCase();return!!~s.indexOf(a)&&a}function t(s){return e(l,s)}function i(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var c in d)s[c]=d[c]}return s}function n(s,r,a){var o=this,u={enumerable:!0};o.hasBeenReset=!1;var d="",c=!1,v=s,m=r,y=a,I=null,k="",z=!0,Q="auto",j="start",ee=50,se="middle",W=50,ce="middle";Object.defineProperty(o,"id",i({},u,{get:function(){return d},set:function(ue){d=""+ue}})),Object.defineProperty(o,"pauseOnExit",i({},u,{get:function(){return c},set:function(ue){c=!!ue}})),Object.defineProperty(o,"startTime",i({},u,{get:function(){return v},set:function(ue){if(typeof ue!="number")throw new TypeError("Start time must be set to a number.");v=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},u,{get:function(){return m},set:function(ue){if(typeof ue!="number")throw new TypeError("End time must be set to a number.");m=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},u,{get:function(){return y},set:function(ue){y=""+ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},u,{get:function(){return I},set:function(ue){I=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},u,{get:function(){return k},set:function(ue){var Ae=function(Ie){return e(h,Ie)}(ue);if(Ae===!1)throw new SyntaxError("An invalid or illegal string was specified.");k=Ae,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},u,{get:function(){return z},set:function(ue){z=!!ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},u,{get:function(){return Q},set:function(ue){if(typeof ue!="number"&&ue!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Q=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},u,{get:function(){return j},set:function(ue){var Ae=t(ue);if(!Ae)throw new SyntaxError("An invalid or illegal string was specified.");j=Ae,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},u,{get:function(){return ee},set:function(ue){if(ue<0||ue>100)throw new Error("Position must be between 0 and 100.");ee=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},u,{get:function(){return se},set:function(ue){var Ae=t(ue);if(!Ae)throw new SyntaxError("An invalid or illegal string was specified.");se=Ae,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},u,{get:function(){return W},set:function(ue){if(ue<0||ue>100)throw new Error("Size must be between 0 and 100.");W=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},u,{get:function(){return ce},set:function(ue){var Ae=t(ue);if(!Ae)throw new SyntaxError("An invalid or illegal string was specified.");ce=Ae,this.hasBeenReset=!0}})),o.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();var un=function(){function h(){}return h.prototype.decode=function(l,e){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},h}();function di(h){function l(t,i,n,s){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(s||0)}var e=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?l(e[2],e[3],0,e[4]):l(e[1],e[2],e[3],e[4]):null}var hn=function(){function h(){this.values=Object.create(null)}var l=h.prototype;return l.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},l.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},l.has=function(e){return e in this.values},l.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},l.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},l.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},h}();function fi(h,l,e,t){var i=t?h.split(t):[h];for(var n in i)if(typeof i[n]=="string"){var s=i[n].split(e);s.length===2&&l(s[0],s[1])}}var wr=new Cr(0,0,""),cr=wr.align==="middle"?"middle":"center";function dn(h,l,e){var t=h;function i(){var s=di(h);if(s===null)throw new Error("Malformed timestamp: "+t);return h=h.replace(/^[^\sa-zA-Z-]+/,""),s}function n(){h=h.replace(/^\s+/,"")}if(n(),l.startTime=i(),n(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);h=h.slice(3),n(),l.endTime=i(),n(),function(s,r){var a=new hn;fi(s,function(d,c){var v;switch(d){case"region":for(var m=e.length-1;m>=0;m--)if(e[m].id===c){a.set(d,e[m].region);break}break;case"vertical":a.alt(d,c,["rl","lr"]);break;case"line":v=c.split(","),a.integer(d,v[0]),a.percent(d,v[0])&&a.set("snapToLines",!1),a.alt(d,v[0],["auto"]),v.length===2&&a.alt("lineAlign",v[1],["start",cr,"end"]);break;case"position":v=c.split(","),a.percent(d,v[0]),v.length===2&&a.alt("positionAlign",v[1],["start",cr,"end","line-left","line-right","auto"]);break;case"size":a.percent(d,c);break;case"align":a.alt(d,c,["start",cr,"end","left","right"])}},/:/,/\s/),r.region=a.get("region",null),r.vertical=a.get("vertical","");var o=a.get("line","auto");o==="auto"&&wr.line===-1&&(o=-1),r.line=o,r.lineAlign=a.get("lineAlign","start"),r.snapToLines=a.get("snapToLines",!0),r.size=a.get("size",100),r.align=a.get("align",cr);var u=a.get("position","auto");u==="auto"&&wr.position===50&&(u=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=u}(h,l)}function ci(h){return h.replace(/<br(?: \/)?>/gi,`
`)}var fn=function(){function h(){this.state="INITIAL",this.buffer="",this.decoder=new un,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var l=h.prototype;return l.parse=function(e){var t=this;function i(){var o=t.buffer,u=0;for(o=ci(o);u<o.length&&o[u]!=="\r"&&o[u]!==`
`;)++u;var d=o.slice(0,u);return o[u]==="\r"&&++u,o[u]===`
`&&++u,t.buffer=o.slice(u),d}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(n=i()).match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?fi(n,function(o,u){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Cr(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{dn(n,t.cue,t.regionList)}catch(o){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=n.indexOf("-->")!==-1;if(!n||a&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(o){t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},l.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},h}(),gi=V(673),cn=V(524),gn=/\r\n|\n\r|\n|\r/g,Or=function(h,l,e){return e===void 0&&(e=0),h.slice(e,e+l.length)===l},Pr=function(h){for(var l=5381,e=h.length;e;)l=33*l^h.charCodeAt(--e);return(l>>>0).toString()};function xr(h,l,e){return Pr(h.toString())+Pr(l.toString())+Pr(e)}function Fr(){return Fr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Fr.apply(this,arguments)}var Mr="stpp.ttml.im1t",vi=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,pi=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,vn={left:"start",center:"center",right:"end",start:"start",end:"end"};function mi(h,l,e,t,i){var n=(0,U.findBox)(new Uint8Array(h),["mdat"]);if(n.length!==0){var s=n.map(function(a){return(0,He.utf8ArrayToStr)(a)}),r=(0,gi.toTimescaleFromScale)(l,1,e);try{s.forEach(function(a){return t(function(o,u){var d=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},v=Object.keys(c).reduce(function(z,Q){return z[Q]=d.getAttribute("ttp:"+Q)||c[Q],z},{}),m=d.getAttribute("xml:space")!=="preserve",y=yi(Nr(d,"styling","style")),I=yi(Nr(d,"layout","region")),k=Nr(d,"body","[begin]");return[].map.call(k,function(z){var Q=Ei(z,m);if(!Q||!z.hasAttribute("begin"))return null;var j=Br(z.getAttribute("begin"),v),ee=Br(z.getAttribute("dur"),v),se=Br(z.getAttribute("end"),v);if(j===null)throw Ti(z);if(se===null){if(ee===null)throw Ti(z);se=j+ee}var W=new Cr(j-u,se-u,Q);W.id=xr(W.startTime,W.endTime,W.text);var ce=I[z.getAttribute("region")],ue=y[z.getAttribute("style")];W.position=10,W.size=80;var Ae=function(Xe,Ue,Ke){var Qe="http://www.w3.org/ns/ttml#styling",at=null,vt=Xe!=null&&Xe.hasAttribute("style")?Xe.getAttribute("style"):null;return vt&&Ke.hasOwnProperty(vt)&&(at=Ke[vt]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(tt,st){var Lt=Ur(Ue,Qe,st)||Ur(Xe,Qe,st)||Ur(at,Qe,st);return Lt&&(tt[st]=Lt),tt},{})}(ce,ue,y),Ie=Ae.textAlign;if(Ie){var Ge=vn[Ie];Ge&&(W.lineAlign=Ge),W.align=Ie}return Fr(W,Ae),W}).filter(function(z){return z!==null})}(a,r))})}catch(a){i(a)}}else i(new Error("Could not parse IMSC1 mdat"))}function Nr(h,l,e){var t=h.getElementsByTagName(l)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function yi(h){return h.reduce(function(l,e){var t=e.getAttribute("xml:id");return t&&(l[t]=e),l},{})}function Ei(h,l){return[].slice.call(h.childNodes).reduce(function(e,t,i){var n;return t.nodeName==="br"&&i?e+`
`:(n=t.childNodes)!==null&&n!==void 0&&n.length?Ei(t,l):l?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function Ur(h,l,e){return h&&h.hasAttributeNS(l,e)?h.getAttributeNS(l,e):null}function Ti(h){return new Error("Could not parse ttml timestamp "+h)}function Br(h,l){if(!h)return null;var e=di(h);return e===null&&(vi.test(h)?e=function(t,i){var n=vi.exec(t),s=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+s/i.frameRate}(h,l):pi.test(h)&&(e=function(t,i){var n=pi.exec(t),s=Number(n[1]);switch(n[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/i.frameRate;case"t":return s/i.tickRate}return s}(h,l))),e}var pn=function(){function h(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new fr(this,"textTrack1"),i=new fr(this,"textTrack2"),n=new fr(this,"textTrack3"),s=new fr(this,"textTrack4");this.cea608Parser1=new hi(1,t,i),this.cea608Parser2=new hi(3,n,s)}e.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(f.Events.FRAG_LOADING,this.onFragLoading,this),e.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(f.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(f.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(f.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var l=h.prototype;return l.destroy=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(f.Events.FRAG_LOADING,this.onFragLoading,this),e.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(f.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(f.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(f.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(e,t,i,n,s){for(var r,a,o,u,d=!1,c=s.length;c--;){var v=s[c],m=(r=v[0],a=v[1],o=t,u=i,Math.min(a,u)-Math.max(r,o));if(m>=0&&(v[0]=Math.min(v[0],t),v[1]=Math.max(v[1],i),d=!0,m/(i-t)>.5))return}if(d||s.push([t,i]),this.config.renderTextTracksNatively){var y=this.captionsTracks[e];this.Cues.newCue(y,t,i,n)}else{var I=this.Cues.newCue(null,t,i,n);this.hls.trigger(f.Events.CUES_PARSED,{type:"captions",cues:I,track:e})}},l.onInitPtsFound=function(e,t){var i=this,n=t.frag,s=t.id,r=t.initPTS,a=t.timescale,o=this.unparsedVttFrags;s==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=a),o.length&&(this.unparsedVttFrags=[],o.forEach(function(u){i.onFragLoaded(f.Events.FRAG_LOADED,u)}))},l.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null},l.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},l.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,i=this.captionsTracks,n=this.media,s=t[e],r=s.label,a=s.languageCode,o=this.getExistingTrack(e);if(o)i[e]=o,De(i[e]),ke(i[e],n);else{var u=this.createTextTrack("captions",r,a);u&&(u[e]=!0,i[e]=u)}}},l.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(f.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},l.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},l.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},l.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){De(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)De(t[i])}},l.onSubtitleTracksUpdated=function(e,t){var i=this;this.textTracks=[];var n=t.subtitleTracks||[],s=n.some(function(u){return u.textCodec===Mr});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,d){var c;if(d<a.length){for(var v=null,m=0;m<a.length;m++)if(mn(a[m],u)){v=a[m];break}v&&(c=v)}if(c)De(c);else{var y=i._captionsOrSubtitlesFromCharacteristics(u);(c=i.createTextTrack(y,u.name,u.lang))&&(c.mode="disabled")}c&&(c.groupId=u.groupId,i.textTracks.push(c))})}else if(!r&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(f.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}},l._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!==null&&t!==void 0&&t.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"},l.onManifestLoaded=function(e,t){var i=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(n){var s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(s){var r="textTrack"+s[1],a=i.captionsProperties[r];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)}})},l.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},l.onFragLoading=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2,s=this.lastSn,r=this.lastPartIndex;if(this.enabled&&i&&n&&t.frag.type===C.PlaylistLevelType.MAIN){var a,o,u=t.frag.sn,d=(a=t==null||(o=t.part)===null||o===void 0?void 0:o.index)!=null?a:-1;u===s+1||u===s&&d===r+1||(i.reset(),n.reset()),this.lastSn=u,this.lastPartIndex=d}},l.onFragLoaded=function(e,t){var i=t.frag,n=t.payload,s=this.initPTS,r=this.unparsedVttFrags;if(i.type===C.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,w.isFiniteNumber)(s[i.cc]))return r.push(t),void(s.length&&this.hls.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var a=i.decryptdata,o="stats"in t;if(a==null||a.key==null||a.method!=="AES-128"||o){var u=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===Mr?this._parseIMSC1(i,n):this._parseVTTs(i,n,d)}}else this.hls.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},l._parseIMSC1=function(e,t){var i=this,n=this.hls;mi(t,this.initPTS[e.cc],this.timescale[e.cc],function(s){i._appendCues(s,e.level),n.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){S.logger.log("Failed to parse IMSC1: "+s),n.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},l._parseVTTs=function(e,t,i){var n,s=this,r=this.hls;(function(a,o,u,d,c,v,m,y){var I,k=new fn,z=(0,He.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(gn,`
`).split(`
`),Q=[],j=(0,gi.toMpegTsClockFromTimescale)(o,u),ee="00:00.000",se=0,W=0,ce=!0;k.oncue=function(ue){var Ae=d[c],Ie=d.ccOffset,Ge=(se-j)/9e4;Ae!=null&&Ae.new&&(W!==void 0?Ie=d.ccOffset=Ae.start:function(Qe,at,vt){var tt=Qe[at],st=Qe[tt.prevCC];if(!st||!st.new&&tt.new)return Qe.ccOffset=Qe.presentationOffset=tt.start,void(tt.new=!1);for(;(Lt=st)!==null&&Lt!==void 0&&Lt.new;){var Lt;Qe.ccOffset+=tt.start-st.start,tt.new=!1,st=Qe[(tt=st).prevCC]}Qe.presentationOffset=vt}(d,c,Ge)),Ge&&(Ie=Ge-d.presentationOffset);var Xe=ue.endTime-ue.startTime,Ue=(0,cn.normalizePts)(9e4*(ue.startTime+Ie-W),9e4*v)/9e4;ue.startTime=Math.max(Ue,0),ue.endTime=Math.max(Ue+Xe,0);var Ke=ue.text.trim();ue.text=decodeURIComponent(encodeURIComponent(Ke)),ue.id||(ue.id=xr(ue.startTime,ue.endTime,Ke)),ue.endTime>0&&Q.push(ue)},k.onparsingerror=function(ue){I=ue},k.onflush=function(){I?y(I):m(Q)},z.forEach(function(ue){if(ce){if(Or(ue,"X-TIMESTAMP-MAP=")){ce=!1,ue.slice(16).split(",").forEach(function(Ae){Or(Ae,"LOCAL:")?ee=Ae.slice(6):Or(Ae,"MPEGTS:")&&(se=parseInt(Ae.slice(7)))});try{W=function(Ae){var Ie=parseInt(Ae.slice(-3)),Ge=parseInt(Ae.slice(-6,-4)),Xe=parseInt(Ae.slice(-9,-7)),Ue=Ae.length>9?parseInt(Ae.substring(0,Ae.indexOf(":"))):0;if(!((0,w.isFiniteNumber)(Ie)&&(0,w.isFiniteNumber)(Ge)&&(0,w.isFiniteNumber)(Xe)&&(0,w.isFiniteNumber)(Ue)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+Ae);return Ie+=1e3*Ge,(Ie+=6e4*Xe)+36e5*Ue}(ee)/1e3}catch(Ae){I=Ae}return}ue===""&&(ce=!1)}k.parse(ue+`
`)}),k.flush()})((n=e.initSegment)!==null&&n!==void 0&&n.data?(0,U.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],this.timescale[e.cc],i,e.cc,e.start,function(a){s._appendCues(a,e.level),r.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){s._fallbackToIMSC1(e,t),S.logger.log("Failed to parse VTT cue: "+a),r.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},l._fallbackToIMSC1=function(e,t){var i=this,n=this.tracks[e.level];n.textCodec||mi(t,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=Mr,i._parseIMSC1(e,t)},function(){n.textCodec="wvtt"})},l._appendCues=function(e,t){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(function(a){return ie(n,a)})}else{var s=this.tracks[t];if(!s)return;var r=s.default?"default":"subtitles"+t;i.trigger(f.Events.CUES_PARSED,{type:"subtitles",cues:e,track:r})}},l.onFragDecrypted=function(e,t){var i=t.frag;if(i.type===C.PlaylistLevelType.SUBTITLE){if(!(0,w.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(f.Events.FRAG_LOADED,t)}},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&i&&n){var s=t.frag,r=t.samples;if(s.type!==C.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(s)!=="NONE")for(var a=0;a<r.length;a++){var o=r[a].bytes;if(o){var u=this.extractCea608Data(o);i.addData(r[a].pts,u[0]),n.addData(r[a].pts,u[1])}}}},l.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,s=t.endOffsetSubtitles,r=t.type,a=this.media;if(a&&!(a.currentTime<n)){if(!r||r==="video"){var o=this.captionsTracks;Object.keys(o).forEach(function(d){return Re(o[d],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&s!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return Re(u[d],i,s)})}}},l.extractCea608Data=function(e){for(var t=[[],[]],i=31&e[0],n=2,s=0;s<i;s++){var r=e[n++],a=127&e[n++],o=127&e[n++];if((a!==0||o!==0)&&(4&r)!=0){var u=3&r;u!==0&&u!==1||(t[u].push(a),t[u].push(o))}}return t},h}();function mn(h,l){return h&&h.label===l.name&&!(h.textTrack1||h.textTrack2)}function yn(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}const En=function(){function h(i){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var l,e,t=h.prototype;return t.setStreamController=function(i){this.streamController=i},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var i=this.hls;i.on(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var i=this.hls;i.off(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(i,n){h.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},t.onMediaAttaching=function(i,n){this.media=n.media instanceof HTMLVideoElement?n.media:null},t.onManifestParsed=function(i,n){var s=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,s.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onBufferCodecs=function(i,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(i.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},t.getMaxLevel=function(i){var n=this,s=this.hls.levels;if(!s.length)return-1;var r=s.filter(function(a,o){return h.isLevelAllowed(o,n.restrictedLevels)&&o<=i});return this.clientRect=null,h.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,n={width:0,height:0};if(i){var s=i.getBoundingClientRect();n.width=s.width,n.height=s.height,n.width||n.height||(n.width=s.right-s.left||i.width||0,n.height=s.bottom-s.top||i.height||0)}return this.clientRect=n,n},h.isLevelAllowed=function(i,n){return n===void 0&&(n=[]),n.indexOf(i)===-1},h.getMaxLevelByMediaSize=function(i,n,s){if(!i||!i.length)return-1;for(var r,a,o=i.length-1,u=0;u<i.length;u+=1){var d=i[u];if((d.width>=n||d.height>=s)&&(r=d,!(a=i[u+1])||r.width!==a.width||r.height!==a.height)){o=u;break}}return o},l=h,(e=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch(n){}return i}}])&&yn(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}(),Tn=function(){function h(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var l=h.prototype;return l.setStreamController=function(e){this.streamController=e},l.registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},l.unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching)},l.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},l.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},l.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var s=n-this.lastTime,r=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,o=1e3*r/s,u=this.hls;if(u.trigger(f.Events.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:i}),o>0&&r>u.config.fpsDroppedMonitoringThreshold*a){var d=u.currentLevel;S.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d-=1,u.trigger(f.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},l.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},h}();var qt;(function(h){h.WIDEVINE="com.widevine.alpha",h.PLAYREADY="com.microsoft.playready"})(qt||(qt={}));var Sn=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function bn(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}const Ln=function(){function h(i){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=i,this._config=i.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var l,e,t=h.prototype;return t.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},t._registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t._unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t.getLicenseServerUrl=function(i){switch(i){case qt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},t._attemptKeySystemAccess=function(i,n,s){var r=this,a=function(u,d,c,v){if(u===qt.WIDEVINE)return function(m,y,I){var k={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(z){k.audioCapabilities.push({contentType:'audio/mp4; codecs="'+z+'"',robustness:I.audioRobustness||""})}),y.forEach(function(z){k.videoCapabilities.push({contentType:'video/mp4; codecs="'+z+'"',robustness:I.videoRobustness||""})}),[k]}(d,c,v);throw new Error("Unknown key-system: "+u)}(i,n,s,this._drmSystemOptions);S.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(i,a);this.mediaKeysPromise=o.then(function(u){return r._onMediaKeySystemAccessObtained(i,u)}),o.catch(function(u){S.logger.error('Failed to obtain key-system "'+i+'" access:',u)})},t._onMediaKeySystemAccessObtained=function(i,n){var s=this;S.logger.log('Access for key-system "'+i+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:n,mediaKeySystemDomain:i};this._mediaKeysList.push(r);var a=Promise.resolve().then(function(){return n.createMediaKeys()}).then(function(o){return r.mediaKeys=o,S.logger.log('Media-keys created for key-system "'+i+'"'),s._onMediaKeysCreated(),o});return a.catch(function(o){S.logger.error("Failed to create media-keys:",o)}),a},t._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(n){n.mediaKeysSession||(n.mediaKeysSession=n.mediaKeys.createSession(),i._onNewMediaKeySession(n.mediaKeysSession))})},t._onNewMediaKeySession=function(i){var n=this;S.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(s){n._onKeySessionMessage(i,s.message)},!1)},t._onKeySessionMessage=function(i,n){S.logger.log("Got EME message event, creating license request"),this._requestLicense(n,function(s){S.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),i.update(s).catch(function(r){S.logger.warn("Updating key-session failed: "+r)})})},t.onMediaEncrypted=function(i){var n=this;if(S.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise)return S.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var s=function(r){n._media&&(n._attemptSetMediaKeys(r),n._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(s).catch(s)},t._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var n=this._mediaKeysList[0];if(!n||!n.mediaKeys)return S.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});S.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(n.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(i,n){var s=this,r=this._mediaKeysList[0];if(!r)return S.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)S.logger.warn("Key-Session already initialized but requested again");else{var a=r.mediaKeysSession;if(!a)return S.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!n)return S.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});S.logger.log('Generating key-session request for "'+i+'" init data type'),r.mediaKeysSessionInitialized=!0,a.generateRequest(i,n).then(function(){S.logger.debug("Key-session generation succeeded")}).catch(function(o){S.logger.error("Error generating key-session request:",o),s.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t._createLicenseXhr=function(i,n,s){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,i,n,s);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,r,i),a=void 0}catch(o){S.logger.error(o)}try{r.readyState||r.open("POST",i,!0),a&&a.call(this.hls,r,i)}catch(o){throw new Error("issue setting up KeySystem license XHR "+o)}return r},t._onLicenseRequestReadyStageChange=function(i,n,s,r){if(i.readyState===4)if(i.status===200){this._requestLicenseFailureCount=0,S.logger.log("License request succeeded");var a=i.response,o=this._licenseResponseCallback;if(o)try{a=o.call(this.hls,i,n)}catch(d){S.logger.error(d)}r(a)}else{if(S.logger.error("License Request XHR failed ("+n+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var u=3-this._requestLicenseFailureCount+1;S.logger.warn("Retrying license request, "+u+" attempts left"),this._requestLicense(s,r)}},t._generateLicenseRequestChallenge=function(i,n){if(i.mediaKeySystemDomain===qt.WIDEVINE)return n;throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},t._requestLicense=function(i,n){S.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s)return S.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(s.mediaKeySystemDomain),a=this._createLicenseXhr(r,i,n);S.logger.log("Sending license request to URL: "+r);var o=this._generateLicenseRequestChallenge(s,i);a.send(o)}catch(u){S.logger.error("Failure requesting DRM license: "+u),this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(i,n){if(this._emeEnabled){var s=n.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){var i=this._media,n=this._mediaKeysList;i&&(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(n.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},t.onManifestParsed=function(i,n){if(this._emeEnabled){var s=n.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),r=n.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(qt.WIDEVINE,s,r)}},l=h,(e=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&bn(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();var mt,Gr,Si;function bi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Li(h,l,e){return l&&bi(h.prototype,l),e&&bi(h,e),Object.defineProperty(h,"prototype",{writable:!1}),h}function Di(h,l){var e=typeof Symbol!="undefined"&&h[Symbol.iterator]||h["@@iterator"];if(e)return(e=e.call(h)).next.bind(e);if(Array.isArray(h)||(e=function(i,n){if(i){if(typeof i=="string")return Ai(i,n);var s=Object.prototype.toString.call(i).slice(8,-1);return s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set"?Array.from(i):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Ai(i,n):void 0}}(h))||l&&h&&typeof h.length=="number"){e&&(h=e);var t=0;return function(){return t>=h.length?{done:!0}:{done:!1,value:h[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ai(h,l){(l==null||l>h.length)&&(l=h.length);for(var e=0,t=new Array(l);e<l;e++)t[e]=h[e];return t}function gr(){return gr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},gr.apply(this,arguments)}(function(h){h.MANIFEST="m",h.AUDIO="a",h.VIDEO="v",h.MUXED="av",h.INIT="i",h.CAPTION="c",h.TIMED_TEXT="tt",h.KEY="k",h.OTHER="o"})(mt||(mt={})),function(h){h.DASH="d",h.HLS="h",h.SMOOTH="s",h.OTHER="o"}(Gr||(Gr={})),function(h){h.VOD="v",h.LIVE="l"}(Si||(Si={}));var Dn=function(){function h(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(s){try{t.apply(s,{ot:mt.MANIFEST,su:!t.initialized})}catch(r){S.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=function(s){try{var r=s.frag,a=t.hls.levels[r.level],o=t.getObjectType(r),u={d:1e3*r.duration,ot:o};o!==mt.VIDEO&&o!==mt.AUDIO&&o!=mt.MUXED||(u.br=a.bitrate/1e3,u.tb=t.getTopBandwidth(o)/1e3,u.bl=t.getBufferLength(o)),t.apply(s,u)}catch(d){S.logger.warn("Could not generate segment CMCD data.",d)}},this.hls=e;var i=this.config=e.config,n=i.cmcd;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||h.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var l=h.prototype;return l.registerListeners=function(){var e=this.hls;e.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this)},l.unregisterListeners=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},l.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},l.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},l.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},l.onBufferCreated=function(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)===null||n===void 0?void 0:n.buffer},l.createData=function(){var e;return{v:1,sf:Gr.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},l.apply=function(e,t){t===void 0&&(t={}),gr(t,this.createData());var i=t.ot===mt.INIT||t.ot===mt.VIDEO||t.ot===mt.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var n=h.toHeaders(t);if(!Object.keys(n).length)return;e.headers||(e.headers={}),gr(e.headers,n)}else{var s=h.toQuery(t);if(!s)return;e.url=h.appendQueryToUri(e.url,s)}},l.getObjectType=function(e){var t=e.type;return t==="subtitle"?mt.TIMED_TEXT:e.sn==="initSegment"?mt.INIT:t==="audio"?mt.AUDIO:t==="main"?this.hls.audioTracks.length?mt.VIDEO:mt.MUXED:void 0},l.getTopBandwidth=function(e){var t,i=0,n=this.hls;if(e===mt.AUDIO)t=n.audioTracks;else{var s=n.maxAutoLevel,r=s>-1?s+1:n.levels.length;t=n.levels.slice(0,r)}for(var a,o=Di(t);!(a=o()).done;){var u=a.value;u.bitrate>i&&(i=u.bitrate)}return i>0?i:NaN},l.getBufferLength=function(e){var t=this.hls.media,i=e===mt.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*$.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN},l.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,o){t(r),this.loader.load(r,a,o)},Li(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},l.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,o){t(r),this.loader.load(r,a,o)},Li(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},h.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},h.serialize=function(e){for(var t,i=[],n=function(y){return!Number.isNaN(y)&&y!=null&&y!==""&&y!==!1},s=function(y){return Math.round(y)},r=function(y){return 100*s(y/100)},a={br:s,d:s,bl:r,dl:r,mtp:r,nor:function(y){return encodeURIComponent(y)},rtp:r,tb:s},o=Di(Object.keys(e||{}).sort());!(t=o()).done;){var u=t.value,d=e[u];if(n(d)&&!(u==="v"&&d===1||u=="pr"&&d===1)){var c=a[u];c&&(d=c(d));var v,m=typeof d;v=u==="ot"||u==="sf"||u==="st"?u+"="+d:m==="boolean"?u:m==="number"?u+"="+d:u+"="+JSON.stringify(d),i.push(v)}}return i.join(",")},h.toHeaders=function(e){for(var t={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];n[s[o]!=null?s[o]:1][o]=e[o]}for(var u=0;u<n.length;u++){var d=h.serialize(n[u]);d&&(t["CMCD-"+i[u]]=d)}return t},h.toQuery=function(e){return"CMCD="+encodeURIComponent(h.serialize(e))},h.appendQueryToUri=function(e,t){if(!t)return e;var i=e.includes("?")?"&":"?";return""+e+i+t},h}(),ki=V(408),An=/^age:\s*[\d.]+\s*$/m;const Ri=function(){function h(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new ki.LoadStats,this.retryDelay=0}var l=h.prototype;return l.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},l.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},l.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},l.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.retryDelay=t.retryDelay,this.loadInternal()},l.loadInternal=function(){var e=this.config,t=this.context;if(e){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var s=this.xhrSetup;try{if(s)try{s(i,t.url)}catch(o){i.open("GET",t.url,!0),s(i,t.url)}i.readyState||i.open("GET",t.url,!0);var r=this.context.headers;if(r)for(var a in r)i.setRequestHeader(a,r[a])}catch(o){return void this.callbacks.onError({code:i.status,text:o.message},t,i)}t.rangeEnd&&i.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),i.send()}},l.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,s=this.config;if(!i.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),n===4){t.onreadystatechange=null,t.onprogress=null;var r=t.status,a=t.responseType==="arraybuffer";if(r>=200&&r<300&&(a&&t.response||t.responseText!==null)){var o,u;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),u=a?(o=t.response).byteLength:(o=t.responseText).length,i.loaded=i.total=u,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(i,e,o,t),!this.callbacks)return;var c={url:t.responseURL,data:o};this.callbacks.onSuccess(c,i,e,t)}else i.retry>=s.maxRetry||r>=400&&r<499?(S.logger.error(r+" while loading "+e.url),this.callbacks.onError({code:r,text:t.statusText},e,t)):(S.logger.warn(r+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},l.loadtimeout=function(){S.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},l.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},l.getCacheAge=function(){var e=null;if(this.loader&&An.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},h}();function Kr(h){var l=typeof Map=="function"?new Map:void 0;return Kr=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,i)}function i(){return Hr(e,arguments,jr(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Zt(i,e)},Kr(h)}function Hr(h,l,e){return Hr=kn()?Reflect.construct.bind():function(t,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(t,s));return n&&Zt(r,n.prototype),r},Hr.apply(null,arguments)}function kn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(h){return!1}}function Zt(h,l){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zt(h,l)}function jr(h){return jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},jr(h)}function Vr(){return Vr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Vr.apply(this,arguments)}var Rn=function(){function h(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||In,this.controller=new self.AbortController,this.stats=new ki.LoadStats}var l=h.prototype;return l.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},l.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},l.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},l.load=function(e,t,i){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var r=function(d,c){var v={method:"GET",mode:"cors",credentials:"same-origin",signal:c,headers:new self.Headers(Vr({},d.headers))};return d.rangeEnd&&v.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),v}(e,this.controller.signal),a=i.onProgress,o=e.responseType==="arraybuffer",u=o?"byteLength":"length";this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),i.onTimeout(s,e,n.response)},t.timeout),self.fetch(this.request).then(function(d){if(n.response=n.loader=d,!d.ok){var c=d.status,v=d.statusText;throw new _n(v||"fetch, bad network response",c,d)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(d.headers.get("Content-Length")||"0"),a&&(0,w.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(d,s,e,t.highWaterMark,a):o?d.arrayBuffer():d.text()}).then(function(d){var c=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var v=d[u];v&&(s.loaded=s.total=v);var m={url:c.url,data:d};a&&!(0,w.isFiniteNumber)(t.highWaterMark)&&a(s,e,d,c),i.onSuccess(m,s,e,c)}).catch(function(d){if(self.clearTimeout(n.requestTimeout),!s.aborted){var c=d&&d.code||0,v=d?d.message:null;i.onError({code:c,text:v},e,d?d.details:null)}})},l.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},l.loadProgressively=function(e,t,i,n,s){n===void 0&&(n=0);var r=new ri,a=e.body.getReader();return function o(){return a.read().then(function(u){if(u.done)return r.dataLength&&s(t,i,r.flush(),e),Promise.resolve(new ArrayBuffer(0));var d=u.value,c=d.length;return t.loaded+=c,c<n||r.dataLength?(r.push(d),r.dataLength>=n&&s(t,i,r.flush(),e)):s(t,i,d,e),o()}).catch(function(){return Promise.reject()})}()},h}();function In(h,l){return new self.Request(h.url,l)}var _n=function(h){var l,e;function t(i,n,s){var r;return(r=h.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=s,r}return e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Zt(l,e),t}(Kr(Error));const Ii=Rn;var Cn=/\s/;function Wr(){return Wr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Wr.apply(this,arguments)}function _i(h,l){var e=Object.keys(h);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(h);l&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(h,i).enumerable})),e.push.apply(e,t)}return e}function Ci(h){for(var l=1;l<arguments.length;l++){var e=arguments[l]!=null?arguments[l]:{};l%2?_i(Object(e),!0).forEach(function(t){wn(h,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(e)):_i(Object(e)).forEach(function(t){Object.defineProperty(h,t,Object.getOwnPropertyDescriptor(e,t))})}return h}function wn(h,l,e){return l in h?Object.defineProperty(h,l,{value:e,enumerable:!0,configurable:!0,writable:!0}):h[l]=e,h}var On=Ci(Ci({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ri,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ki,bufferController:Ji,capLevelController:En,fpsController:Tn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Sn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(h,l,e,t){for(var i,n,s,r,a,o=[],u=self.VTTCue||self.TextTrackCue,d=0;d<t.rows.length;d++)if(s=!0,r=0,a="",!(i=t.rows[d]).isEmpty()){for(var c=0;c<i.chars.length;c++)Cn.test(i.chars[c].uchar)&&s?r++:(a+=i.chars[c].uchar,s=!1);i.cueStartTime=l,l===e&&(e+=1e-4),r>=16?r--:r++;var v=ci(a.trim()),m=xr(l,e,v);h&&h.cues&&h.cues.getCueById(m)||((n=new u(l,e,v)).id=m,n.line=d+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*r/32)),o.push(n))}return h&&o.length&&(o.sort(function(y,I){return y.line==="auto"||I.line==="auto"?0:y.line>8&&I.line>8?I.line-y.line:y.line-I.line}),o.forEach(function(y){return ie(h,y)})),o}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:qi,subtitleTrackController:Qi,timelineController:pn,audioStreamController:ji,audioTrackController:Wi,emeController:Ln,cmcdController:Dn});function wi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}var Oi=function(){function h(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ei.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var s=this.config=function(W,ce){if((ce.liveSyncDurationCount||ce.liveMaxLatencyDurationCount)&&(ce.liveSyncDuration||ce.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(ce.liveMaxLatencyDurationCount!==void 0&&(ce.liveSyncDurationCount===void 0||ce.liveMaxLatencyDurationCount<=ce.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(ce.liveMaxLatencyDuration!==void 0&&(ce.liveSyncDuration===void 0||ce.liveMaxLatencyDuration<=ce.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return Wr({},W,ce)}(h.DefaultConfig,n);this.userConfig=n,(0,S.enableLogs)(s.debug,"Hls instance"),this._autoLevelCapping=-1,s.progressive&&function(W){var ce=W.loader;ce!==Ii&&ce!==Ri?(S.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),W.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(ue){}return!1}()&&(W.loader=Ii,W.progressive=!0,W.enableSoftwareAES=!0,S.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(s);var r=s.abrController,a=s.bufferController,o=s.capLevelController,u=s.fpsController,d=this.abrController=new r(this),c=this.bufferController=new a(this),v=this.capLevelController=new o(this),m=new u(this),y=new me(this),I=new Te(this),k=new Ye(this),z=this.levelController=new E(this),Q=new R(this),j=this.streamController=new Ui(this,Q);v.setStreamController(j),m.setStreamController(j);var ee=[y,I,z,j];this.networkControllers=ee;var se=[d,c,v,m,k,Q];this.audioTrackController=this.createController(s.audioTrackController,null,ee),this.createController(s.audioStreamController,Q,ee),this.subtitleTrackController=this.createController(s.subtitleTrackController,null,ee),this.createController(s.subtitleStreamController,Q,ee),this.createController(s.timelineController,null,se),this.emeController=this.createController(s.emeController,null,se),this.cmcdController=this.createController(s.cmcdController,null,se),this.latencyController=this.createController(Je,null,se),this.coreComponents=se}h.isSupported=function(){return function(){var n=Tr();if(!n)return!1;var s=Qr(),r=n&&typeof n.isTypeSupported=="function"&&n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function";return!!r&&!!a}()};var l,e,t,i=h.prototype;return i.createController=function(n,s,r){if(n){var a=s?new n(this,s):new n(this);return r&&r.push(a),a}return null},i.on=function(n,s,r){r===void 0&&(r=this),this._emitter.on(n,s,r)},i.once=function(n,s,r){r===void 0&&(r=this),this._emitter.once(n,s,r)},i.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},i.off=function(n,s,r,a){r===void 0&&(r=this),this._emitter.off(n,s,r,a)},i.listeners=function(n){return this._emitter.listeners(n)},i.emit=function(n,s,r){return this._emitter.emit(n,s,r)},i.trigger=function(n,s){if(this.config.debug)return this.emit(n,n,s);try{return this.emit(n,n,s)}catch(r){S.logger.error("An internal error happened while handling event "+n+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(f.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:r})}return!1},i.listenerCount=function(n){return this._emitter.listenerCount(n)},i.destroy=function(){S.logger.log("destroy"),this.trigger(f.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},i.attachMedia=function(n){S.logger.log("attachMedia"),this._media=n,this.trigger(f.Events.MEDIA_ATTACHING,{media:n})},i.detachMedia=function(){S.logger.log("detachMedia"),this.trigger(f.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(n){this.stopLoad();var s=this.media,r=this.url,a=this.url=J.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});S.logger.log("loadSource:"+a),s&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(f.Events.MANIFEST_LOADING,{url:n})},i.startLoad=function(n){n===void 0&&(n=-1),S.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(s){s.startLoad(n)})},i.stopLoad=function(){S.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},i.swapAudioCodec=function(){S.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){S.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},i.removeLevel=function(n,s){s===void 0&&(s=0),this.levelController.removeLevel(n,s)},l=h,t=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return f.Events}},{key:"ErrorTypes",get:function(){return _.ErrorTypes}},{key:"ErrorDetails",get:function(){return _.ErrorDetails}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:On},set:function(n){h.defaultConfig=n}}],(e=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){S.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){S.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){S.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){S.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){S.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var s=!!n;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(S.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,s=this.config.minAutoBitrate;if(!n)return 0;for(var r=n.length,a=0;a<r;a++)if(n[a].maxBitrate>=s)return a;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,s=this.autoLevelCapping;return s===-1&&n&&n.length?n.length-1:s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var s=this.audioTrackController;s&&(s.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&wi(l.prototype,e),t&&wi(l,t),Object.defineProperty(l,"prototype",{writable:!1}),h}();Oi.defaultConfig=void 0},923:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{BaseSegment:()=>Y,ElementaryStreamTypes:()=>he,Fragment:()=>te,Part:()=>ne});var he,J=V(965),w=V(945),f=V(93),_=V(960),S=V(408);function U(re,Z){re.prototype=Object.create(Z.prototype),re.prototype.constructor=re,M(re,Z)}function M(re,Z){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(ve,de){return ve.__proto__=de,ve},M(re,Z)}function N(re,Z){for(var ve=0;ve<Z.length;ve++){var de=Z[ve];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(re,de.key,de)}}function H(re,Z,ve){return Z&&N(re.prototype,Z),ve&&N(re,ve),Object.defineProperty(re,"prototype",{writable:!1}),re}(function(re){re.AUDIO="audio",re.VIDEO="video",re.AUDIOVIDEO="audiovideo"})(he||(he={}));var Y=function(){function re(Z){var ve;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((ve={})[he.AUDIO]=null,ve[he.VIDEO]=null,ve[he.AUDIOVIDEO]=null,ve),this.baseurl=Z}return re.prototype.setByteRange=function(Z,ve){var de=Z.split("@",2),pe=[];de.length===1?pe[0]=ve?ve.byteRangeEndOffset:0:pe[0]=parseInt(de[1]),pe[1]=parseInt(de[0])+pe[0],this._byteRange=pe},H(re,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,w.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(Z){this._url=Z}}]),re}(),te=function(re){function Z(de,pe){var x;return(x=re.call(this,pe)||this)._decryptdata=null,x.rawProgramDateTime=null,x.programDateTime=null,x.tagList=[],x.duration=0,x.sn=0,x.levelkey=void 0,x.type=void 0,x.loader=null,x.level=-1,x.cc=0,x.startPTS=void 0,x.endPTS=void 0,x.appendedPTS=void 0,x.startDTS=void 0,x.endDTS=void 0,x.start=0,x.deltaPTS=void 0,x.maxStartPTS=void 0,x.minEndPTS=void 0,x.stats=new S.LoadStats,x.urlId=0,x.data=void 0,x.bitrateTest=!1,x.title=null,x.initSegment=null,x.type=de,x}U(Z,re);var ve=Z.prototype;return ve.createInitializationVector=function(de){for(var pe=new Uint8Array(16),x=12;x<16;x++)pe[x]=de>>8*(15-x)&255;return pe},ve.setDecryptDataFromLevelKey=function(de,pe){var x=de;return(de==null?void 0:de.method)==="AES-128"&&de.uri&&!de.iv&&((x=_.LevelKey.fromURI(de.uri)).method=de.method,x.iv=this.createInitializationVector(pe),x.keyFormat="identity"),x},ve.setElementaryStreamInfo=function(de,pe,x,p,A,T){T===void 0&&(T=!1);var K=this.elementaryStreams,ae=K[de];ae?(ae.startPTS=Math.min(ae.startPTS,pe),ae.endPTS=Math.max(ae.endPTS,x),ae.startDTS=Math.min(ae.startDTS,p),ae.endDTS=Math.max(ae.endDTS,A)):K[de]={startPTS:pe,endPTS:x,startDTS:p,endDTS:A,partial:T}},ve.clearElementaryStreamInfo=function(){var de=this.elementaryStreams;de[he.AUDIO]=null,de[he.VIDEO]=null,de[he.AUDIOVIDEO]=null},H(Z,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var de=this.sn;typeof de!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&f.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),de=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,de)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,J.isFiniteNumber)(this.programDateTime))return null;var de=(0,J.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*de}},{key:"encrypted",get:function(){var de;return!((de=this.decryptdata)===null||de===void 0||!de.keyFormat||!this.decryptdata.uri)}}]),Z}(Y),ne=function(re){function Z(ve,de,pe,x,p){var A;(A=re.call(this,pe)||this).fragOffset=0,A.duration=0,A.gap=!1,A.independent=!1,A.relurl=void 0,A.fragment=void 0,A.index=void 0,A.stats=new S.LoadStats,A.duration=ve.decimalFloatingPoint("DURATION"),A.gap=ve.bool("GAP"),A.independent=ve.bool("INDEPENDENT"),A.relurl=ve.enumeratedString("URI"),A.fragment=de,A.index=x;var T=ve.enumeratedString("BYTERANGE");return T&&A.setByteRange(T,p),p&&(A.fragOffset=p.fragOffset+p.duration),A}return U(Z,re),H(Z,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var ve=this.elementaryStreams;return!!(ve.audio||ve.video||ve.audiovideo)}}]),Z}(Y)},960:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{LevelKey:()=>w});var he=V(945);function J(f,_){for(var S=0;S<_.length;S++){var U=_[S];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(f,U.key,U)}}var w=function(){function f(U,M){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=M?(0,he.buildAbsoluteURL)(U,M,{alwaysNormalize:!0}):U}var _,S;return f.fromURL=function(U,M){return new f(U,M)},f.fromURI=function(U){return new f(U)},_=f,(S=[{key:"uri",get:function(){return this._uri}}])&&J(_.prototype,S),Object.defineProperty(_,"prototype",{writable:!1}),f}()},408:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{LoadStats:()=>he});var he=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{MAX_SAFE_INTEGER:()=>J,isFiniteNumber:()=>he});var he=Number.isFinite||function(w){return typeof w=="number"&&isFinite(w)},J=Number.MAX_SAFE_INTEGER||9007199254740991},524:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{default:()=>re,flushTextTrackMetadataCueSamples:()=>ve,flushTextTrackUserdataCueSamples:()=>de,normalizePts:()=>Z});var he=V(965);const J=function(){function p(){}return p.getSilentFrame=function(A,T){if(A==="mp4a.40.2"){if(T===1)return new Uint8Array([0,200,0,128,35,128]);if(T===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(T===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(T===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(T===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(T===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(T===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(T===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(T===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},p}();var w=Math.pow(2,32)-1,f=function(){function p(){}return p.init=function(){var A;for(A in p.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},p.types)p.types.hasOwnProperty(A)&&(p.types[A]=[A.charCodeAt(0),A.charCodeAt(1),A.charCodeAt(2),A.charCodeAt(3)]);var T=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),K=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);p.HDLR_TYPES={video:T,audio:K};var ae=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),oe=new Uint8Array([0,0,0,0,0,0,0,0]);p.STTS=p.STSC=p.STCO=oe,p.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),p.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),p.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),p.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var D=new Uint8Array([105,115,111,109]),G=new Uint8Array([97,118,99,49]),B=new Uint8Array([0,0,0,1]);p.FTYP=p.box(p.types.ftyp,D,B,D,G),p.DINF=p.box(p.types.dinf,p.box(p.types.dref,ae))},p.box=function(A){for(var T=8,K=arguments.length,ae=new Array(K>1?K-1:0),oe=1;oe<K;oe++)ae[oe-1]=arguments[oe];for(var D=ae.length,G=D;D--;)T+=ae[D].byteLength;var B=new Uint8Array(T);for(B[0]=T>>24&255,B[1]=T>>16&255,B[2]=T>>8&255,B[3]=255&T,B.set(A,4),D=0,T=8;D<G;D++)B.set(ae[D],T),T+=ae[D].byteLength;return B},p.hdlr=function(A){return p.box(p.types.hdlr,p.HDLR_TYPES[A])},p.mdat=function(A){return p.box(p.types.mdat,A)},p.mdhd=function(A,T){T*=A;var K=Math.floor(T/(w+1)),ae=Math.floor(T%(w+1));return p.box(p.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,255&A,K>>24,K>>16&255,K>>8&255,255&K,ae>>24,ae>>16&255,ae>>8&255,255&ae,85,196,0,0]))},p.mdia=function(A){return p.box(p.types.mdia,p.mdhd(A.timescale,A.duration),p.hdlr(A.type),p.minf(A))},p.mfhd=function(A){return p.box(p.types.mfhd,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,255&A]))},p.minf=function(A){return A.type==="audio"?p.box(p.types.minf,p.box(p.types.smhd,p.SMHD),p.DINF,p.stbl(A)):p.box(p.types.minf,p.box(p.types.vmhd,p.VMHD),p.DINF,p.stbl(A))},p.moof=function(A,T,K){return p.box(p.types.moof,p.mfhd(A),p.traf(K,T))},p.moov=function(A){for(var T=A.length,K=[];T--;)K[T]=p.trak(A[T]);return p.box.apply(null,[p.types.moov,p.mvhd(A[0].timescale,A[0].duration)].concat(K).concat(p.mvex(A)))},p.mvex=function(A){for(var T=A.length,K=[];T--;)K[T]=p.trex(A[T]);return p.box.apply(null,[p.types.mvex].concat(K))},p.mvhd=function(A,T){T*=A;var K=Math.floor(T/(w+1)),ae=Math.floor(T%(w+1)),oe=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,255&A,K>>24,K>>16&255,K>>8&255,255&K,ae>>24,ae>>16&255,ae>>8&255,255&ae,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return p.box(p.types.mvhd,oe)},p.sdtp=function(A){var T,K,ae=A.samples||[],oe=new Uint8Array(4+ae.length);for(T=0;T<ae.length;T++)K=ae[T].flags,oe[T+4]=K.dependsOn<<4|K.isDependedOn<<2|K.hasRedundancy;return p.box(p.types.sdtp,oe)},p.stbl=function(A){return p.box(p.types.stbl,p.stsd(A),p.box(p.types.stts,p.STTS),p.box(p.types.stsc,p.STSC),p.box(p.types.stsz,p.STSZ),p.box(p.types.stco,p.STCO))},p.avc1=function(A){var T,K,ae,oe=[],D=[];for(T=0;T<A.sps.length;T++)ae=(K=A.sps[T]).byteLength,oe.push(ae>>>8&255),oe.push(255&ae),oe=oe.concat(Array.prototype.slice.call(K));for(T=0;T<A.pps.length;T++)ae=(K=A.pps[T]).byteLength,D.push(ae>>>8&255),D.push(255&ae),D=D.concat(Array.prototype.slice.call(K));var G=p.box(p.types.avcC,new Uint8Array([1,oe[3],oe[4],oe[5],255,224|A.sps.length].concat(oe).concat([A.pps.length]).concat(D))),B=A.width,q=A.height,C=A.pixelRatio[0],ge=A.pixelRatio[1];return p.box(p.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,B>>8&255,255&B,q>>8&255,255&q,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),G,p.box(p.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),p.box(p.types.pasp,new Uint8Array([C>>24,C>>16&255,C>>8&255,255&C,ge>>24,ge>>16&255,ge>>8&255,255&ge])))},p.esds=function(A){var T=A.config.length;return new Uint8Array([0,0,0,0,3,23+T,0,1,0,4,15+T,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([T]).concat(A.config).concat([6,1,2]))},p.mp4a=function(A){var T=A.samplerate;return p.box(p.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,T>>8&255,255&T,0,0]),p.box(p.types.esds,p.esds(A)))},p.mp3=function(A){var T=A.samplerate;return p.box(p.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,T>>8&255,255&T,0,0]))},p.stsd=function(A){return A.type==="audio"?A.segmentCodec==="mp3"&&A.codec==="mp3"?p.box(p.types.stsd,p.STSD,p.mp3(A)):p.box(p.types.stsd,p.STSD,p.mp4a(A)):p.box(p.types.stsd,p.STSD,p.avc1(A))},p.tkhd=function(A){var T=A.id,K=A.duration*A.timescale,ae=A.width,oe=A.height,D=Math.floor(K/(w+1)),G=Math.floor(K%(w+1));return p.box(p.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,255&T,0,0,0,0,D>>24,D>>16&255,D>>8&255,255&D,G>>24,G>>16&255,G>>8&255,255&G,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ae>>8&255,255&ae,0,0,oe>>8&255,255&oe,0,0]))},p.traf=function(A,T){var K=p.sdtp(A),ae=A.id,oe=Math.floor(T/(w+1)),D=Math.floor(T%(w+1));return p.box(p.types.traf,p.box(p.types.tfhd,new Uint8Array([0,0,0,0,ae>>24,ae>>16&255,ae>>8&255,255&ae])),p.box(p.types.tfdt,new Uint8Array([1,0,0,0,oe>>24,oe>>16&255,oe>>8&255,255&oe,D>>24,D>>16&255,D>>8&255,255&D])),p.trun(A,K.length+16+20+8+16+8+8),K)},p.trak=function(A){return A.duration=A.duration||4294967295,p.box(p.types.trak,p.tkhd(A),p.mdia(A))},p.trex=function(A){var T=A.id;return p.box(p.types.trex,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,255&T,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},p.trun=function(A,T){var K,ae,oe,D,G,B,q=A.samples||[],C=q.length,ge=12+16*C,me=new Uint8Array(ge);for(T+=8+ge,me.set([A.type==="video"?1:0,0,15,1,C>>>24&255,C>>>16&255,C>>>8&255,255&C,T>>>24&255,T>>>16&255,T>>>8&255,255&T],0),K=0;K<C;K++)oe=(ae=q[K]).duration,D=ae.size,G=ae.flags,B=ae.cts,me.set([oe>>>24&255,oe>>>16&255,oe>>>8&255,255&oe,D>>>24&255,D>>>16&255,D>>>8&255,255&D,G.isLeading<<2|G.dependsOn,G.isDependedOn<<6|G.hasRedundancy<<4|G.paddingValue<<1|G.isNonSync,61440&G.degradPrio,15&G.degradPrio,B>>>24&255,B>>>16&255,B>>>8&255,255&B],12+16*K);return p.box(p.types.trun,me)},p.initSegment=function(A){p.types||p.init();var T=p.moov(A),K=new Uint8Array(p.FTYP.byteLength+T.byteLength);return K.set(p.FTYP),K.set(T,p.FTYP.byteLength),K},p}();f.types=void 0,f.HDLR_TYPES=void 0,f.STTS=void 0,f.STSC=void 0,f.STCO=void 0,f.STSZ=void 0,f.VMHD=void 0,f.SMHD=void 0,f.STSD=void 0,f.FTYP=void 0,f.DINF=void 0;const _=f;var S=V(851),U=V(973),M=V(93),N=V(308),H=V(673);function Y(){return Y=Object.assign?Object.assign.bind():function(p){for(var A=1;A<arguments.length;A++){var T=arguments[A];for(var K in T)Object.prototype.hasOwnProperty.call(T,K)&&(p[K]=T[K])}return p},Y.apply(this,arguments)}var te=null,ne=null,re=function(){function p(T,K,ae,oe){if(oe===void 0&&(oe=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=T,this.config=K,this.typeSupported=ae,this.ISGenerated=!1,te===null){var D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);te=D?parseInt(D[1]):0}if(ne===null){var G=navigator.userAgent.match(/Safari\/(\d+)/i);ne=G?parseInt(G[1]):0}}var A=p.prototype;return A.destroy=function(){},A.resetTimeStamp=function(T){M.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=T},A.resetNextTimestamp=function(){M.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},A.resetInitSegment=function(){M.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},A.getVideoStartPts=function(T){var K=!1,ae=T.reduce(function(oe,D){var G=D.pts-oe;return G<-4294967296?(K=!0,Z(oe,D.pts)):G>0?oe:D.pts},T[0].pts);return K&&M.logger.debug("PTS rollover detected"),ae},A.remux=function(T,K,ae,oe,D,G,B,q){var C,ge,me,Te,ke,ie,De=D,Re=D,He=T.pid>-1,_e=K.pid>-1,Oe=K.samples.length,Ne=T.samples.length>0,Fe=B&&Oe>0||Oe>1;if((!He||Ne)&&(!_e||Fe)||this.ISGenerated||B){this.ISGenerated||(me=this.generateIS(T,K,D));var Ye,Ve=this.isVideoContiguous,Me=-1;if(Fe&&(Me=function(Ze){for(var ht=0;ht<Ze.length;ht++)if(Ze[ht].key)return ht;return-1}(K.samples),!Ve&&this.config.forceKeyFrameOnDiscontinuity))if(ie=!0,Me>0){M.logger.warn("[mp4-remuxer]: Dropped "+Me+" out of "+Oe+" video samples due to a missing keyframe");var Je=this.getVideoStartPts(K.samples);K.samples=K.samples.slice(Me),K.dropped+=Me,Ye=Re+=(K.samples[0].pts-Je)/K.inputTimeScale}else Me===-1&&(M.logger.warn("[mp4-remuxer]: No keyframe found out of "+Oe+" video samples"),ie=!1);if(this.ISGenerated){if(Ne&&Fe){var $e=this.getVideoStartPts(K.samples),ot=(Z(T.samples[0].pts,$e)-$e)/K.inputTimeScale;De+=Math.max(0,ot),Re+=Math.max(0,-ot)}if(Ne){if(T.samplerate||(M.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),me=this.generateIS(T,K,D)),ge=this.remuxAudio(T,De,this.isAudioContiguous,G,_e||Fe||q===N.PlaylistLevelType.AUDIO?Re:void 0),Fe){var rt=ge?ge.endPTS-ge.startPTS:0;K.inputTimeScale||(M.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),me=this.generateIS(T,K,D)),C=this.remuxVideo(K,Re,Ve,rt)}}else Fe&&(C=this.remuxVideo(K,Re,Ve,0));C&&(C.firstKeyFrame=Me,C.independent=Me!==-1,C.firstKeyFramePTS=Ye)}}return this.ISGenerated&&(ae.samples.length&&(ke=ve(ae,D,this._initPTS,this._initDTS)),oe.samples.length&&(Te=de(oe,D,this._initPTS))),{audio:ge,video:C,initSegment:me,independent:ie,text:Te,id3:ke}},A.generateIS=function(T,K,ae){var oe,D,G,B=T.samples,q=K.samples,C=this.typeSupported,ge={},me=!(0,he.isFiniteNumber)(this._initPTS),Te="audio/mp4";if(me&&(oe=D=1/0),T.config&&B.length&&(T.timescale=T.samplerate,T.segmentCodec==="mp3"&&(C.mpeg?(Te="audio/mpeg",T.codec=""):C.mp3&&(T.codec="mp3")),ge.audio={id:"audio",container:Te,codec:T.codec,initSegment:T.segmentCodec==="mp3"&&C.mpeg?new Uint8Array(0):_.initSegment([T]),metadata:{channelCount:T.channelCount}},me&&(G=T.inputTimeScale,oe=D=B[0].pts-Math.round(G*ae))),K.sps&&K.pps&&q.length&&(K.timescale=K.inputTimeScale,ge.video={id:"main",container:"video/mp4",codec:K.codec,initSegment:_.initSegment([K]),metadata:{width:K.width,height:K.height}},me)){G=K.inputTimeScale;var ke=this.getVideoStartPts(q),ie=Math.round(G*ae);D=Math.min(D,Z(q[0].dts,ke)-ie),oe=Math.min(oe,ke-ie)}if(Object.keys(ge).length)return this.ISGenerated=!0,me&&(this._initPTS=oe,this._initDTS=D),{tracks:ge,initPTS:oe,timescale:G}},A.remuxVideo=function(T,K,ae,oe){var D,G,B=T.inputTimeScale,q=T.samples,C=[],ge=q.length,me=this._initPTS,Te=this.nextAvcDts,ke=8,ie=this.videoSampleDuration,De=Number.POSITIVE_INFINITY,Re=Number.NEGATIVE_INFINITY,He=!1;ae&&Te!==null||(Te=K*B-(q[0].pts-Z(q[0].dts,q[0].pts)));for(var _e=0;_e<ge;_e++){var Oe=q[_e];Oe.pts=Z(Oe.pts-me,Te),Oe.dts=Z(Oe.dts-me,Te),Oe.dts<q[_e>0?_e-1:_e].dts&&(He=!0)}He&&q.sort(function(bt,pt){var Nt=bt.dts-pt.dts,It=bt.pts-pt.pts;return Nt||It}),D=q[0].dts;var Ne=q[q.length-1].dts-D,Fe=Ne?Math.round(Ne/(ge-1)):ie||T.inputTimeScale/30;if(ae){var Ye=D-Te,Ve=Ye>Fe,Me=Ye<-1;if((Ve||Me)&&(Ve?M.logger.warn("AVC: "+(0,H.toMsFromMpegTsClock)(Ye,!0)+" ms ("+Ye+"dts) hole between fragments detected, filling it"):M.logger.warn("AVC: "+(0,H.toMsFromMpegTsClock)(-Ye,!0)+" ms ("+Ye+"dts) overlapping between fragments detected"),!Me||Te>q[0].pts)){D=Te;var Je=q[0].pts-Ye;q[0].dts=D,q[0].pts=Je,M.logger.log("Video: First PTS/DTS adjusted: "+(0,H.toMsFromMpegTsClock)(Je,!0)+"/"+(0,H.toMsFromMpegTsClock)(D,!0)+", delta: "+(0,H.toMsFromMpegTsClock)(Ye,!0)+" ms")}}D=Math.max(0,D);for(var $e=0,ot=0,rt=0;rt<ge;rt++){for(var Ze=q[rt],ht=Ze.units,it=ht.length,lt=0,yt=0;yt<it;yt++)lt+=ht[yt].data.length;ot+=lt,$e+=it,Ze.length=lt,Ze.dts=Math.max(Ze.dts,D),De=Math.min(Ze.pts,De),Re=Math.max(Ze.pts,Re)}G=q[ge-1].dts;var ct,Et=ot+4*$e+8;try{ct=new Uint8Array(Et)}catch(bt){return void this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:U.ErrorTypes.MUX_ERROR,details:U.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Et,reason:"fail allocating video mdat "+Et})}var Tt=new DataView(ct.buffer);Tt.setUint32(0,Et),ct.set(_.types.mdat,4);for(var St=!1,O=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,b=Number.NEGATIVE_INFINITY,E=0;E<ge;E++){for(var R=q[E],P=R.units,F=0,X=0,le=P.length;X<le;X++){var $=P[X],fe=$.data,Se=$.data.byteLength;Tt.setUint32(ke,Se),ke+=4,ct.set(fe,ke),ke+=Se,F+=4+Se}var Ee=void 0;if(E<ge-1)ie=q[E+1].dts-R.dts,Ee=q[E+1].pts-R.pts;else{var be=this.config,Pe=E>0?R.dts-q[E-1].dts:Fe;if(Ee=E>0?R.pts-q[E-1].pts:Fe,be.stretchShortVideoTrack&&this.nextAudioPts!==null){var je=Math.floor(be.maxBufferHole*B),Le=(oe?De+oe*B:this.nextAudioPts)-R.pts;Le>je?((ie=Le-Pe)<0?ie=Pe:St=!0,M.logger.log("[mp4-remuxer]: It is approximately "+Le/90+" ms to the next segment; using duration "+ie/90+" ms for the last video frame.")):ie=Pe}else ie=Pe}var ze=Math.round(R.pts-R.dts);O=Math.min(O,ie),g=Math.max(g,ie),L=Math.min(L,Ee),b=Math.max(b,Ee),C.push(new pe(R.key,ie,F,ze))}if(C.length){if(te){if(te<70){var dt=C[0].flags;dt.dependsOn=2,dt.isNonSync=0}}else if(ne&&b-L<g-O&&Fe/g<.025&&C[0].cts===0){M.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var nt=D,et=0,gt=C.length;et<gt;et++){var xe=nt+C[et].duration,ft=nt+C[et].cts;if(et<gt-1){var Ct=xe+C[et+1].cts;C[et].duration=Ct-ft}else C[et].duration=et?C[et-1].duration:Fe;C[et].cts=0,nt=xe}}}ie=St||!ie?Fe:ie,this.nextAvcDts=Te=G+ie,this.videoSampleDuration=ie,this.isVideoContiguous=!0;var ut={data1:_.moof(T.sequenceNumber++,D,Y({},T,{samples:C})),data2:ct,startPTS:De/B,endPTS:(Re+ie)/B,startDTS:D/B,endDTS:Te/B,type:"video",hasAudio:!1,hasVideo:!0,nb:C.length,dropped:T.dropped};return T.samples=[],T.dropped=0,ut},A.remuxAudio=function(T,K,ae,oe,D){var G=T.inputTimeScale,B=G/(T.samplerate?T.samplerate:G),q=T.segmentCodec==="aac"?1024:1152,C=q*B,ge=this._initPTS,me=T.segmentCodec==="mp3"&&this.typeSupported.mpeg,Te=[],ke=D!==void 0,ie=T.samples,De=me?0:8,Re=this.nextAudioPts||-1,He=K*G;if(this.isAudioContiguous=ae=ae||ie.length&&Re>0&&(oe&&Math.abs(He-Re)<9e3||Math.abs(Z(ie[0].pts-ge,He)-Re)<20*C),ie.forEach(function(X){X.pts=Z(X.pts-ge,He)}),!ae||Re<0){if(ie=ie.filter(function(X){return X.pts>=0}),!ie.length)return;Re=D===0?0:oe&&!ke?Math.max(0,He):ie[0].pts}if(T.segmentCodec==="aac")for(var _e=this.config.maxAudioFramesDrift,Oe=0,Ne=Re;Oe<ie.length;Oe++){var Fe=ie[Oe],Ye=Fe.pts,Ve=Ye-Ne,Me=Math.abs(1e3*Ve/G);if(Ve<=-_e*C&&ke)Oe===0&&(M.logger.warn("Audio frame @ "+(Ye/G).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Ve/G)+" ms."),this.nextAudioPts=Re=Ne=Ye);else if(Ve>=_e*C&&Me<1e4&&ke){var Je=Math.round(Ve/C);(Ne=Ye-Je*C)<0&&(Je--,Ne+=C),Oe===0&&(this.nextAudioPts=Re=Ne),M.logger.warn("[mp4-remuxer]: Injecting "+Je+" audio frame @ "+(Ne/G).toFixed(3)+"s due to "+Math.round(1e3*Ve/G)+" ms gap.");for(var $e=0;$e<Je;$e++){var ot=Math.max(Ne,0),rt=J.getSilentFrame(T.manifestCodec||T.codec,T.channelCount);rt||(M.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),rt=Fe.unit.subarray()),ie.splice(Oe,0,{unit:rt,pts:ot}),Ne+=C,Oe++}}Fe.pts=Ne,Ne+=C}for(var Ze,ht=null,it=null,lt=0,yt=ie.length;yt--;)lt+=ie[yt].unit.byteLength;for(var ct=0,Et=ie.length;ct<Et;ct++){var Tt=ie[ct],St=Tt.unit,O=Tt.pts;if(it!==null)Te[ct-1].duration=Math.round((O-it)/B);else{if(ae&&T.segmentCodec==="aac"&&(O=Re),ht=O,!(lt>0))return;lt+=De;try{Ze=new Uint8Array(lt)}catch(X){return void this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:U.ErrorTypes.MUX_ERROR,details:U.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:lt,reason:"fail allocating audio mdat "+lt})}me||(new DataView(Ze.buffer).setUint32(0,lt),Ze.set(_.types.mdat,4))}Ze.set(St,De);var L=St.byteLength;De+=L,Te.push(new pe(!0,q,L,0)),it=O}var g=Te.length;if(g){var b=Te[Te.length-1];this.nextAudioPts=Re=it+B*b.duration;var E=me?new Uint8Array(0):_.moof(T.sequenceNumber++,ht/B,Y({},T,{samples:Te}));T.samples=[];var R=ht/G,P=Re/G,F={data1:E,data2:Ze,startPTS:R,endPTS:P,startDTS:R,endDTS:P,type:"audio",hasAudio:!0,hasVideo:!1,nb:g};return this.isAudioContiguous=!0,F}},A.remuxEmptyAudio=function(T,K,ae,oe){var D=T.inputTimeScale,G=D/(T.samplerate?T.samplerate:D),B=this.nextAudioPts,q=(B!==null?B:oe.startDTS*D)+this._initDTS,C=oe.endDTS*D+this._initDTS,ge=1024*G,me=Math.ceil((C-q)/ge),Te=J.getSilentFrame(T.manifestCodec||T.codec,T.channelCount);if(M.logger.warn("[mp4-remuxer]: remux empty Audio"),Te){for(var ke=[],ie=0;ie<me;ie++){var De=q+ie*ge;ke.push({unit:Te,pts:De,dts:De})}return T.samples=ke,this.remuxAudio(T,K,ae,!1)}M.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},p}();function Z(p,A){var T;if(A===null)return p;for(T=A<p?-8589934592:8589934592;Math.abs(p-A)>4294967296;)p+=T;return p}function ve(p,A,T,K){var ae=p.samples.length;if(ae){for(var oe=p.inputTimeScale,D=0;D<ae;D++){var G=p.samples[D];G.pts=Z(G.pts-T,A*oe)/oe,G.dts=Z(G.dts-K,A*oe)/oe}var B=p.samples;return p.samples=[],{samples:B}}}function de(p,A,T){var K=p.samples.length;if(K){for(var ae=p.inputTimeScale,oe=0;oe<K;oe++){var D=p.samples[oe];D.pts=Z(D.pts-T,A*ae)/ae}p.samples.sort(function(B,q){return B.pts-q.pts});var G=p.samples;return p.samples=[],{samples:G}}}var pe=function(p,A,T,K){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=A,this.size=T,this.cts=K,this.flags=new x(p)},x=function(p){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=p?2:1,this.isNonSync=p?0:1}},856:(we,ye,V)=>{"use strict";var he;V.r(ye),V.d(ye,{MetadataSchema:()=>he}),function(J){J.audioId3="org.id3",J.dateRange="com.apple.quicktime.HLS",J.emsg="https://aomedia.org/emsg/ID3"}(he||(he={}))},308:(we,ye,V)=>{"use strict";var he,J;V.r(ye),V.d(ye,{PlaylistContextType:()=>he,PlaylistLevelType:()=>J}),function(w){w.MANIFEST="manifest",w.LEVEL="level",w.AUDIO_TRACK="audioTrack",w.SUBTITLE_TRACK="subtitleTrack"}(he||(he={})),function(w){w.MAIN="main",w.AUDIO="audio",w.SUBTITLE="subtitle"}(J||(J={}))},93:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{enableLogs:()=>_,logger:()=>S});var he=function(){},J={trace:he,debug:he,log:he,warn:he,info:he,error:he},w=J;function f(U){var M=self.console[U];return M?M.bind(self.console,"["+U+"] >"):he}function _(U,M){if(self.console&&U===!0||typeof U=="object"){(function(N){for(var H=arguments.length,Y=new Array(H>1?H-1:0),te=1;te<H;te++)Y[te-1]=arguments[te];Y.forEach(function(ne){w[ne]=N[ne]?N[ne].bind(N):f(ne)})})(U,"debug","log","info","warn","error");try{w.log('Debug logs enabled for "'+M+'"')}catch(N){w=J}}else w=J}var S=J},63:(we,ye,V)=>{"use strict";V.r(ye),V.d(ye,{RemuxerTrackIdConfig:()=>S,appendUint8Array:()=>p,bin2str:()=>U,computeRawDurationFromSamples:()=>de,discardEPB:()=>ae,findBox:()=>te,getDuration:()=>ve,getStartDTS:()=>Z,offsetStartDTS:()=>pe,parseEmsg:()=>oe,parseInitSegment:()=>re,parseSEIMessageFromNALu:()=>K,parseSamples:()=>A,parseSegmentIndex:()=>ne,readSint32:()=>H,readUint16:()=>M,readUint32:()=>N,segmentValidRange:()=>x,writeUint32:()=>Y});var he=V(145),J=V(923),w=V(181),f=Math.pow(2,32)-1,_=[].push,S={video:1,audio:2,id3:3,text:4};function U(D){return String.fromCharCode.apply(null,D)}function M(D,G){var B=D[G]<<8|D[G+1];return B<0?65536+B:B}function N(D,G){var B=H(D,G);return B<0?4294967296+B:B}function H(D,G){return D[G]<<24|D[G+1]<<16|D[G+2]<<8|D[G+3]}function Y(D,G,B){D[G]=B>>24,D[G+1]=B>>16&255,D[G+2]=B>>8&255,D[G+3]=255&B}function te(D,G){var B=[];if(!G.length)return B;for(var q=D.byteLength,C=0;C<q;){var ge=N(D,C),me=ge>1?C+ge:q;if(U(D.subarray(C+4,C+8))===G[0])if(G.length===1)B.push(D.subarray(C+8,me));else{var Te=te(D.subarray(C+8,me),G.slice(1));Te.length&&_.apply(B,Te)}C=me}return B}function ne(D){var G=[],B=D[0],q=8,C=N(D,q);q+=4,q+=B===0?8:16,q+=2;var ge=D.length+0,me=M(D,q);q+=2;for(var Te=0;Te<me;Te++){var ke=q,ie=N(D,ke);ke+=4;var De=2147483647&ie;if((2147483648&ie)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Re=N(D,ke);ke+=4,G.push({referenceSize:De,subsegmentDuration:Re,info:{duration:Re/C,start:ge,end:ge+De-1}}),ge+=De,q=ke+=4}return{earliestPresentationTime:0,timescale:C,version:B,referencesCount:me,references:G}}function re(D){for(var G=[],B=te(D,["moov","trak"]),q=0;q<B.length;q++){var C=B[q],ge=te(C,["tkhd"])[0];if(ge){var me=ge[0],Te=me===0?12:20,ke=N(ge,Te),ie=te(C,["mdia","mdhd"])[0];if(ie){var De=N(ie,Te=(me=ie[0])===0?12:20),Re=te(C,["mdia","hdlr"])[0];if(Re){var He=U(Re.subarray(8,12)),_e={soun:J.ElementaryStreamTypes.AUDIO,vide:J.ElementaryStreamTypes.VIDEO}[He];if(_e){var Oe=te(C,["mdia","minf","stbl","stsd"])[0],Ne=void 0;Oe&&(Ne=U(Oe.subarray(12,16))),G[ke]={timescale:De,type:_e},G[_e]={timescale:De,id:ke,codec:Ne}}}}}}return te(D,["moov","mvex","trex"]).forEach(function(Fe){var Ye=N(Fe,4),Ve=G[Ye];Ve&&(Ve.default={duration:N(Fe,12),flags:N(Fe,20)})}),G}function Z(D,G){return te(G,["moof","traf"]).reduce(function(B,q){var C=te(q,["tfdt"])[0],ge=C[0],me=te(q,["tfhd"]).reduce(function(Te,ke){var ie=N(ke,4),De=D[ie];if(De){var Re=N(C,4);ge===1&&(Re*=Math.pow(2,32),Re+=N(C,8));var He=Re/(De.timescale||9e4);if(isFinite(He)&&(Te===null||He<Te))return He}return Te},null);return me!==null&&isFinite(me)&&(B===null||me<B)?me:B},null)||0}function ve(D,G){for(var B=0,q=0,C=0,ge=te(D,["moof","traf"]),me=0;me<ge.length;me++){var Te=ge[me],ke=te(Te,["tfhd"])[0],ie=G[N(ke,4)];if(ie){var De=ie.default,Re=N(ke,0)|(De==null?void 0:De.flags),He=De==null?void 0:De.duration;8&Re&&(He=N(ke,2&Re?12:8));for(var _e=ie.timescale||9e4,Oe=te(Te,["trun"]),Ne=0;Ne<Oe.length;Ne++)!(B=de(Oe[Ne]))&&He&&(B=He*N(Oe[Ne],4)),ie.type===J.ElementaryStreamTypes.VIDEO?q+=B/_e:ie.type===J.ElementaryStreamTypes.AUDIO&&(C+=B/_e)}}if(q===0&&C===0){for(var Fe=0,Ye=te(D,["sidx"]),Ve=0;Ve<Ye.length;Ve++){var Me=ne(Ye[Ve]);Me!=null&&Me.references&&(Fe+=Me.references.reduce(function(Je,$e){return Je+$e.info.duration||0},0))}return Fe}return q||C}function de(D){var G=N(D,0),B=8;1&G&&(B+=4),4&G&&(B+=4);for(var q=0,C=N(D,4),ge=0;ge<C;ge++)256&G&&(q+=N(D,B),B+=4),512&G&&(B+=4),1024&G&&(B+=4),2048&G&&(B+=4);return q}function pe(D,G,B){te(G,["moof","traf"]).forEach(function(q){te(q,["tfhd"]).forEach(function(C){var ge=N(C,4),me=D[ge];if(me){var Te=me.timescale||9e4;te(q,["tfdt"]).forEach(function(ke){var ie=ke[0],De=N(ke,4);if(ie===0)De-=B*Te,Y(ke,4,De=Math.max(De,0));else{De*=Math.pow(2,32),De+=N(ke,8),De-=B*Te,De=Math.max(De,0);var Re=Math.floor(De/(f+1)),He=Math.floor(De%(f+1));Y(ke,4,Re),Y(ke,8,He)}})}})})}function x(D){var G={valid:null,remainder:null},B=te(D,["moof"]);if(!B)return G;if(B.length<2)return G.remainder=D,G;var q=B[B.length-1];return G.valid=(0,he.sliceUint8)(D,0,q.byteOffset-8),G.remainder=(0,he.sliceUint8)(D,q.byteOffset-8),G}function p(D,G){var B=new Uint8Array(D.length+G.length);return B.set(D),B.set(G,D.length),B}function A(D,G){var B=[],q=G.samples,C=G.timescale,ge=G.id,me=!1;return te(q,["moof"]).map(function(Te){var ke=Te.byteOffset-8;te(Te,["traf"]).map(function(ie){var De=te(ie,["tfdt"]).map(function(Re){var He=Re[0],_e=N(Re,4);return He===1&&(_e*=Math.pow(2,32),_e+=N(Re,8)),_e/C})[0];return De!==void 0&&(D=De),te(ie,["tfhd"]).map(function(Re){var He=N(Re,4),_e=16777215&N(Re,0),Oe=0,Ne=(16&_e)!=0,Fe=0,Ye=(32&_e)!=0,Ve=8;He===ge&&((1&_e)!=0&&(Ve+=8),(2&_e)!=0&&(Ve+=4),(8&_e)!=0&&(Oe=N(Re,Ve),Ve+=4),Ne&&(Fe=N(Re,Ve),Ve+=4),Ye&&(Ve+=4),G.type==="video"&&(me=function(Me){if(!Me)return!1;var Je=Me.indexOf("."),$e=Je<0?Me:Me.substring(0,Je);return $e==="hvc1"||$e==="hev1"||$e==="dvh1"||$e==="dvhe"}(G.codec)),te(ie,["trun"]).map(function(Me){var Je=Me[0],$e=16777215&N(Me,0),ot=(1&$e)!=0,rt=0,Ze=(4&$e)!=0,ht=(256&$e)!=0,it=0,lt=(512&$e)!=0,yt=0,ct=(1024&$e)!=0,Et=(2048&$e)!=0,Tt=0,St=N(Me,4),O=8;ot&&(rt=N(Me,O),O+=4),Ze&&(O+=4);for(var L=rt+ke,g=0;g<St;g++){if(ht?(it=N(Me,O),O+=4):it=Oe,lt?(yt=N(Me,O),O+=4):yt=Fe,ct&&(O+=4),Et&&(Tt=Je===0?N(Me,O):H(Me,O),O+=4),G.type===J.ElementaryStreamTypes.VIDEO)for(var b=0;b<yt;){var E=N(q,L);T(me,q[L+=4])&&K(q.subarray(L,L+E),me?2:1,D+Tt/C,B),L+=E,b+=E+4}D+=it/C}}))})})}),B}function T(D,G){if(D){var B=G>>1&63;return B===39||B===40}return(31&G)==6}function K(D,G,B,q){var C=ae(D),ge=0;ge+=G;for(var me=0,Te=0,ke=!1,ie=0;ge<C.length;){me=0;do{if(ge>=C.length)break;me+=ie=C[ge++]}while(ie===255);Te=0;do{if(ge>=C.length)break;Te+=ie=C[ge++]}while(ie===255);var De=C.length-ge;if(!ke&&me===4&&ge<C.length){if(ke=!0,C[ge++]===181){var Re=M(C,ge);if(ge+=2,Re===49){var He=N(C,ge);if(ge+=4,He===1195456820){var _e=C[ge++];if(_e===3){var Oe=C[ge++],Ne=64&Oe,Fe=Ne?2+3*(31&Oe):0,Ye=new Uint8Array(Fe);if(Ne){Ye[0]=Oe;for(var Ve=1;Ve<Fe;Ve++)Ye[Ve]=C[ge++]}q.push({type:_e,payloadType:me,pts:B,bytes:Ye})}}}}}else if(me===5&&Te<De){if(ke=!0,Te>16){for(var Me=[],Je=0;Je<16;Je++){var $e=C[ge++].toString(16);Me.push($e.length==1?"0"+$e:$e),Je!==3&&Je!==5&&Je!==7&&Je!==9||Me.push("-")}for(var ot=Te-16,rt=new Uint8Array(ot),Ze=0;Ze<ot;Ze++)rt[Ze]=C[ge++];q.push({payloadType:me,pts:B,uuid:Me.join(""),userData:(0,w.utf8ArrayToStr)(rt),userDataBytes:rt})}}else if(Te<De)ge+=Te;else if(Te>De)break}}function ae(D){for(var G=D.byteLength,B=[],q=1;q<G-2;)D[q]===0&&D[q+1]===0&&D[q+2]===3?(B.push(q+2),q+=2):q++;if(B.length===0)return D;var C=G-B.length,ge=new Uint8Array(C),me=0;for(q=0;q<C;me++,q++)me===B[0]&&(me++,B.shift()),ge[q]=D[me];return ge}function oe(D){var G=D[0],B="",q="",C=0,ge=0,me=0,Te=0,ke=0,ie=0;if(G===0){for(;U(D.subarray(ie,ie+1))!=="\0";)B+=U(D.subarray(ie,ie+1)),ie+=1;for(B+=U(D.subarray(ie,ie+1)),ie+=1;U(D.subarray(ie,ie+1))!=="\0";)q+=U(D.subarray(ie,ie+1)),ie+=1;q+=U(D.subarray(ie,ie+1)),ie+=1,C=N(D,12),ge=N(D,16),Te=N(D,20),ke=N(D,24),ie=28}else if(G===1){C=N(D,ie+=4);var De=N(D,ie+=4),Re=N(D,ie+=4);for(ie+=4,me=Math.pow(2,32)*De+Re,Number.isSafeInteger(me)||(me=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Te=N(D,ie),ke=N(D,ie+=4),ie+=4;U(D.subarray(ie,ie+1))!=="\0";)B+=U(D.subarray(ie,ie+1)),ie+=1;for(B+=U(D.subarray(ie,ie+1)),ie+=1;U(D.subarray(ie,ie+1))!=="\0";)q+=U(D.subarray(ie,ie+1)),ie+=1;q+=U(D.subarray(ie,ie+1)),ie+=1}return{schemeIdUri:B,value:q,timeScale:C,presentationTime:me,presentationTimeDelta:ge,eventDuration:Te,id:ke,payload:D.subarray(ie,D.byteLength)}}},673:(we,ye,V)=>{"use strict";function he(_,S,U,M){U===void 0&&(U=1),M===void 0&&(M=!1);var N=_*S*U;return M?Math.round(N):N}function J(_,S,U,M){return U===void 0&&(U=1),M===void 0&&(M=!1),he(_,S,1/U,M)}function w(_,S){return S===void 0&&(S=!1),he(_,1e3,11111111111111112e-21,S)}function f(_,S){return S===void 0&&(S=1),he(_,9e4,1/S)}V.r(ye),V.d(ye,{toMpegTsClockFromTimescale:()=>f,toMsFromMpegTsClock:()=>w,toTimescaleFromBase:()=>he,toTimescaleFromScale:()=>J})},145:(we,ye,V)=>{"use strict";function he(J,w,f){return Uint8Array.prototype.slice?J.slice(w,f):new Uint8Array(Array.prototype.slice.call(J,w,f))}V.r(ye),V.d(ye,{sliceUint8:()=>he})},729:we=>{"use strict";var ye=Object.prototype.hasOwnProperty,V="~";function he(){}function J(S,U,M){this.fn=S,this.context=U,this.once=M||!1}function w(S,U,M,N,H){if(typeof M!="function")throw new TypeError("The listener must be a function");var Y=new J(M,N||S,H),te=V?V+U:U;return S._events[te]?S._events[te].fn?S._events[te]=[S._events[te],Y]:S._events[te].push(Y):(S._events[te]=Y,S._eventsCount++),S}function f(S,U){--S._eventsCount==0?S._events=new he:delete S._events[U]}function _(){this._events=new he,this._eventsCount=0}Object.create&&(he.prototype=Object.create(null),new he().__proto__||(V=!1)),_.prototype.eventNames=function(){var S,U,M=[];if(this._eventsCount===0)return M;for(U in S=this._events)ye.call(S,U)&&M.push(V?U.slice(1):U);return Object.getOwnPropertySymbols?M.concat(Object.getOwnPropertySymbols(S)):M},_.prototype.listeners=function(S){var U=V?V+S:S,M=this._events[U];if(!M)return[];if(M.fn)return[M.fn];for(var N=0,H=M.length,Y=new Array(H);N<H;N++)Y[N]=M[N].fn;return Y},_.prototype.listenerCount=function(S){var U=V?V+S:S,M=this._events[U];return M?M.fn?1:M.length:0},_.prototype.emit=function(S,U,M,N,H,Y){var te=V?V+S:S;if(!this._events[te])return!1;var ne,re,Z=this._events[te],ve=arguments.length;if(Z.fn){switch(Z.once&&this.removeListener(S,Z.fn,void 0,!0),ve){case 1:return Z.fn.call(Z.context),!0;case 2:return Z.fn.call(Z.context,U),!0;case 3:return Z.fn.call(Z.context,U,M),!0;case 4:return Z.fn.call(Z.context,U,M,N),!0;case 5:return Z.fn.call(Z.context,U,M,N,H),!0;case 6:return Z.fn.call(Z.context,U,M,N,H,Y),!0}for(re=1,ne=new Array(ve-1);re<ve;re++)ne[re-1]=arguments[re];Z.fn.apply(Z.context,ne)}else{var de,pe=Z.length;for(re=0;re<pe;re++)switch(Z[re].once&&this.removeListener(S,Z[re].fn,void 0,!0),ve){case 1:Z[re].fn.call(Z[re].context);break;case 2:Z[re].fn.call(Z[re].context,U);break;case 3:Z[re].fn.call(Z[re].context,U,M);break;case 4:Z[re].fn.call(Z[re].context,U,M,N);break;default:if(!ne)for(de=1,ne=new Array(ve-1);de<ve;de++)ne[de-1]=arguments[de];Z[re].fn.apply(Z[re].context,ne)}}return!0},_.prototype.on=function(S,U,M){return w(this,S,U,M,!1)},_.prototype.once=function(S,U,M){return w(this,S,U,M,!0)},_.prototype.removeListener=function(S,U,M,N){var H=V?V+S:S;if(!this._events[H])return this;if(!U)return f(this,H),this;var Y=this._events[H];if(Y.fn)Y.fn!==U||N&&!Y.once||M&&Y.context!==M||f(this,H);else{for(var te=0,ne=[],re=Y.length;te<re;te++)(Y[te].fn!==U||N&&!Y[te].once||M&&Y[te].context!==M)&&ne.push(Y[te]);ne.length?this._events[H]=ne.length===1?ne[0]:ne:f(this,H)}return this},_.prototype.removeAllListeners=function(S){var U;return S?(U=V?V+S:S,this._events[U]&&f(this,U)):(this._events=new he,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=V,_.EventEmitter=_,we.exports=_},945:function(we){var ye,V,he,J,w;ye=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,V=/^(?=([^\/?#]*))\1([^]*)$/,he=/(?:\/|^)\.(?=\/)/g,J=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,w={buildAbsoluteURL:function(f,_,S){if(S=S||{},f=f.trim(),!(_=_.trim())){if(!S.alwaysNormalize)return f;var U=w.parseURL(f);if(!U)throw new Error("Error trying to parse base URL.");return U.path=w.normalizePath(U.path),w.buildURLFromParts(U)}var M=w.parseURL(_);if(!M)throw new Error("Error trying to parse relative URL.");if(M.scheme)return S.alwaysNormalize?(M.path=w.normalizePath(M.path),w.buildURLFromParts(M)):_;var N=w.parseURL(f);if(!N)throw new Error("Error trying to parse base URL.");if(!N.netLoc&&N.path&&N.path[0]!=="/"){var H=V.exec(N.path);N.netLoc=H[1],N.path=H[2]}N.netLoc&&!N.path&&(N.path="/");var Y={scheme:N.scheme,netLoc:M.netLoc,path:null,params:M.params,query:M.query,fragment:M.fragment};if(!M.netLoc&&(Y.netLoc=N.netLoc,M.path[0]!=="/"))if(M.path){var te=N.path,ne=te.substring(0,te.lastIndexOf("/")+1)+M.path;Y.path=w.normalizePath(ne)}else Y.path=N.path,M.params||(Y.params=N.params,M.query||(Y.query=N.query));return Y.path===null&&(Y.path=S.alwaysNormalize?w.normalizePath(M.path):M.path),w.buildURLFromParts(Y)},parseURL:function(f){var _=ye.exec(f);return _?{scheme:_[1]||"",netLoc:_[2]||"",path:_[3]||"",params:_[4]||"",query:_[5]||"",fragment:_[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(he,"");f.length!==(f=f.replace(J,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}},we.exports=w}},Pt={};function Dt(we){var ye=Pt[we];if(ye!==void 0)return ye.exports;var V=Pt[we]={exports:{}};return Qt[we].call(V.exports,V,V.exports,Dt),V.exports}Dt.m=Qt,Dt.n=we=>{var ye=we&&we.__esModule?()=>we.default:()=>we;return Dt.d(ye,{a:ye}),ye},Dt.d=(we,ye)=>{for(var V in ye)Dt.o(ye,V)&&!Dt.o(we,V)&&Object.defineProperty(we,V,{enumerable:!0,get:ye[V]})},Dt.o=(we,ye)=>Object.prototype.hasOwnProperty.call(we,ye),Dt.r=we=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(we,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(we,"__esModule",{value:!0})};var _t=Dt(817);return _t.default})())},681:function(zr,Qt,Pt){"use strict";Pt.d(Qt,{Z:function(){return J}});var Dt=(w,f,_)=>new Promise((S,U)=>{var M=Y=>{try{H(_.next(Y))}catch(te){U(te)}},N=Y=>{try{H(_.throw(Y))}catch(te){U(te)}},H=Y=>Y.done?S(Y.value):Promise.resolve(Y.value).then(M,N);H((_=_.apply(w,f)).next())});const _t="oplayer-plugin-hls";let we=globalThis.Hls;const ye=(w,f)=>!(Boolean(w.canPlayType("application/x-mpegURL"))||Boolean(w.canPlayType("application/vnd.apple.mpegURL")))&&(f.format==="hls"||f.format==="m3u8"||(f.format==="auto"||typeof f.format=="undefined")&&/m3u8(#|\?|$)/i.test(f.src)),V=function(w,f){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};_.qualityControl&&(f.once(we.Events.MANIFEST_PARSED,()=>{S({icon:w.plugins.ui.icons.quality,name:"Quality",settings(){return f.levels.length>1?f.levels.reduce((U,M,N)=>{let H=(M.name||M.height).toString();if(isFinite(+H)&&(H+="p"),_.withBitrate){const Y=M.bitrate/1e3,te=Y>1e3,ne=te?~~(Y/1e3):Math.floor(Y);H+=" ("+ne+(te?"m":"k")+"bps)"}return U.push({name:H,default:f.currentLevel==N,value:N}),U},[{name:w.locales.get("Auto"),default:f.autoLevelEnabled,value:-1}]):[]},onChange(U){_.qualitySwitch=="immediate"?(f.currentLevel=U.value,U.value!==-1&&(f.loadLevel=U.value)):(f.nextLevel=U.value,U.value!==-1&&(f.nextLoadLevel=U.value))}})}),f.on(we.Events.LEVEL_SWITCHED,function(M,N){let H=N.level;if(f.autoLevelEnabled){const Y=f.levels[H].height,te=w.locales.get("Auto")+(Y?" ("+Y+"p)":"");w.plugins.ui.setting.updateLabel(_t+"-Quality",te)}else w.plugins.ui.setting.select(_t+"-Quality",H+1,!1)})),_.audioControl&&f.on(we.Events.AUDIO_TRACK_LOADED,()=>{S({icon:w.plugins.ui.icons.lang,name:"Language",settings(){return f.audioTracks.length>1?f.audioTracks.map(U=>{let M=U.name,N=U.lang,H=U.id;return{name:N||M,default:f.audioTrack==H,value:H}}):[]},onChange(U){f.audioTrack=U.value}})}),_.textControl&&f.on(we.Events.SUBTITLE_TRACK_LOADED,()=>{S({icon:w.plugins.ui.icons.subtitle,name:"Subtitle",settings(){return f.subtitleTracks.length>1?f.subtitleTracks.reduce((U,M)=>{let N=M.name,H=M.lang,Y=M.id;return U.push({name:H||N,default:f.subtitleTrack==Y,value:Y}),U},[{name:w.locales.get("Off"),default:!f.subtitleDisplay,value:-1}]):[]},onChange(U){let M=U.value;(f.subtitleDisplay=M!=-1)&&(f.subtitleTrack=M)}})});function S(U){const M=U.settings();if(M.length<2)return;const N=U.name,H=U.icon,Y=U.onChange;w.plugins.ui.setting.unregister(_t+"-"+N),w.plugins.ui.setting.register({name:w.locales.get(N),icon:H,onChange:Y,type:"selector",key:_t+"-"+N,children:M})}},he=w=>{["Quality","Language","Subtitle"].forEach(f=>{var _;return(_=w.plugins.ui)==null?void 0:_.setting.unregister(_t+"-"+f)})},J=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=w.config,_=w.showWarning,S=_===void 0?!1:_,U=w.withBitrate,M=U===void 0?!1:U,N=w.qualityControl,H=N===void 0?!0:N,Y=w.qualitySwitch,te=Y===void 0?"immediate":Y,ne=w.audioControl,re=ne===void 0?!0:ne,Z=w.textControl,ve=Z===void 0?!0:Z,de=w.matcher,pe=de===void 0?ye:de,x,p;function A(T){x&&(he(T),p==null||p.call(x),p=null,x=null)}return{name:_t,key:"hls",load:(T,K)=>Dt(this,null,function*(){var ae;return!pe(T.$video,K)||(we!=null||(we=(yield Pt.e(4817).then(Pt.t.bind(Pt,7807,19))).default),!we.isSupported())?!1:(x=new we(f),x.loadSource(K.src),x.attachMedia(T.$video),!T.isNativeUI&&((ae=T.plugins.ui)==null?void 0:ae.setting)&&V(T,x,{qualityControl:H,qualitySwitch:te,withBitrate:M,audioControl:re,textControl:ve}),x.on(we.Events.ERROR,function(oe,D){const G=D.type,B=D.details;D.fatal?(T.hasError=!0,T.emit("error",Object.assign({},D,{pluginName:_t,message:G+": "+B}))):S&&T.emit("notice",Object.assign({},D,{pluginName:_t,text:G+": "+B}))}),p=x.destroy,x.destroy=()=>{A(T)},x)}),apply:T=>(T.on("destroy",()=>{A(T)}),()=>we)}}}}]);
